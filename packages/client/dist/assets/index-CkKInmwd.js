var Gc=Object.defineProperty;var Zc=(n,e,t)=>e in n?Gc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ae=(n,e,t)=>Zc(n,typeof e!="symbol"?e+"":e,t);import{P as ii,c as Go,g as Ra,p as Cn}from"./phaser-CxRn4yEY.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Me=class Me{constructor(e){ae(this,"game");ae(this,"canvas");ae(this,"parent");ae(this,"guide");const t=e.width,r=e.height;Me.width=t,Me.height=r,Me.center=new ii.Math.Vector2(t/2,r/2),Me.isLandscape=Me.width>Me.height,Me.gameZone=new ii.Geom.Rectangle(0,0,t,r),Me.uiZone=new ii.Geom.Rectangle(0,0,t,r),Me.cameras=new Set,e.callbacks={postBoot:()=>this.gameBootHandler()},this.game=new ii.Game(e)}gameBootHandler(){Me.scaleManager=this.game.scale,Me.scaleManager.on("resize",()=>this.onResizeHandler()),this.canvas=this.game.canvas,this.parent=this.canvas.parentElement,this.guide=document.getElementById("guide"),window.setTimeout(()=>this.onResizeHandler(),16)}onResizeHandler(){const e=this.parent.getBoundingClientRect(),t=this.canvas.getBoundingClientRect(),r=this.guide.getBoundingClientRect(),s=e.width/Me.width,i=e.height/Me.height,l=Math.max(s,i),c=e.width-s,h=e.height-i,f=c*(1/l),p=h*(1/l),d=Me.width/2-f/2,S=Me.width/2+f/2,M=Me.height/2-p/2,Y=Me.height/2+p/2;Me.uiZone.left=d,Me.uiZone.right=S,Me.uiZone.top=M,Me.uiZone.bottom=Y;const V=r.width/t.width,H=r.height/t.height,ce=Math.min(V,H);Me.scaleFactor=ce,Me.cameras.forEach(fe=>{fe.zoom=ce}),this.game.events.emit(Me.RESIZE)}static addCamera(e){this.cameras.add(e),e.zoom=Me.scaleFactor}static removeCamera(e){this.cameras.delete(e)}static getX(e){if(typeof e=="number")return e;const t=this.scaleManager.width,r=parseInt(e,10);return t*(r/100)}static getY(e){if(typeof e=="number")return e;const t=this.scaleManager.height,r=parseInt(e,10);return t*(r/100)}static getUIX(e){if(typeof e=="number")return e;const t=Me.uiZone.width,r=parseInt(e,10);return t*(r/100)}static getUIY(e){if(typeof e=="number")return e;const t=Me.uiZone.height,r=parseInt(e,10);return t*(r/100)}};ae(Me,"scaleManager"),ae(Me,"cameras"),ae(Me,"gameZone"),ae(Me,"uiZone"),ae(Me,"width"),ae(Me,"height"),ae(Me,"center"),ae(Me,"isLandscape"),ae(Me,"scaleFactor",1),ae(Me,"scaleFactor2",1),ae(Me,"RESIZE","scaleflowresize");let ga=Me;var ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pa(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ea={exports:{}},oo;function zc(){return oo||(oo=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(h,f,p){this.fn=h,this.context=f,this.once=p||!1}function i(h,f,p,d,S){if(typeof p!="function")throw new TypeError("The listener must be a function");var M=new s(p,d||h,S),Y=t?t+f:f;return h._events[Y]?h._events[Y].fn?h._events[Y]=[h._events[Y],M]:h._events[Y].push(M):(h._events[Y]=M,h._eventsCount++),h}function l(h,f){--h._eventsCount===0?h._events=new r:delete h._events[f]}function c(){this._events=new r,this._eventsCount=0}c.prototype.eventNames=function(){var f=[],p,d;if(this._eventsCount===0)return f;for(d in p=this._events)e.call(p,d)&&f.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(p)):f},c.prototype.listeners=function(f){var p=t?t+f:f,d=this._events[p];if(!d)return[];if(d.fn)return[d.fn];for(var S=0,M=d.length,Y=new Array(M);S<M;S++)Y[S]=d[S].fn;return Y},c.prototype.listenerCount=function(f){var p=t?t+f:f,d=this._events[p];return d?d.fn?1:d.length:0},c.prototype.emit=function(f,p,d,S,M,Y){var V=t?t+f:f;if(!this._events[V])return!1;var H=this._events[V],ce=arguments.length,fe,te;if(H.fn){switch(H.once&&this.removeListener(f,H.fn,void 0,!0),ce){case 1:return H.fn.call(H.context),!0;case 2:return H.fn.call(H.context,p),!0;case 3:return H.fn.call(H.context,p,d),!0;case 4:return H.fn.call(H.context,p,d,S),!0;case 5:return H.fn.call(H.context,p,d,S,M),!0;case 6:return H.fn.call(H.context,p,d,S,M,Y),!0}for(te=1,fe=new Array(ce-1);te<ce;te++)fe[te-1]=arguments[te];H.fn.apply(H.context,fe)}else{var ye=H.length,Xe;for(te=0;te<ye;te++)switch(H[te].once&&this.removeListener(f,H[te].fn,void 0,!0),ce){case 1:H[te].fn.call(H[te].context);break;case 2:H[te].fn.call(H[te].context,p);break;case 3:H[te].fn.call(H[te].context,p,d);break;case 4:H[te].fn.call(H[te].context,p,d,S);break;default:if(!fe)for(Xe=1,fe=new Array(ce-1);Xe<ce;Xe++)fe[Xe-1]=arguments[Xe];H[te].fn.apply(H[te].context,fe)}}return!0},c.prototype.on=function(f,p,d){return i(this,f,p,d,!1)},c.prototype.once=function(f,p,d){return i(this,f,p,d,!0)},c.prototype.removeListener=function(f,p,d,S){var M=t?t+f:f;if(!this._events[M])return this;if(!p)return l(this,M),this;var Y=this._events[M];if(Y.fn)Y.fn===p&&(!S||Y.once)&&(!d||Y.context===d)&&l(this,M);else{for(var V=0,H=[],ce=Y.length;V<ce;V++)(Y[V].fn!==p||S&&!Y[V].once||d&&Y[V].context!==d)&&H.push(Y[V]);H.length?this._events[M]=H.length===1?H[0]:H:l(this,M)}return this},c.prototype.removeAllListeners=function(f){var p;return f?(p=t?t+f:f,this._events[p]&&l(this,p)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,n.exports=c}(ea)),ea.exports}var Kc=zc(),Zo=Pa(Kc),qe;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const l of s)i[l]=l;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(c=>typeof s[s[c]]!="number"),l={};for(const c of i)l[c]=s[c];return n.objectValues(l)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const l in s)Object.prototype.hasOwnProperty.call(s,l)&&i.push(l);return i},n.find=(s,i)=>{for(const l of s)if(i(l))return l},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(l=>typeof l=="string"?`'${l}'`:l).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(qe||(qe={}));var ma;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(ma||(ma={}));const ue=qe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),rr=n=>{switch(typeof n){case"undefined":return ue.undefined;case"string":return ue.string;case"number":return isNaN(n)?ue.nan:ue.number;case"boolean":return ue.boolean;case"function":return ue.function;case"bigint":return ue.bigint;case"symbol":return ue.symbol;case"object":return Array.isArray(n)?ue.array:n===null?ue.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?ue.promise:typeof Map<"u"&&n instanceof Map?ue.map:typeof Set<"u"&&n instanceof Set?ue.set:typeof Date<"u"&&n instanceof Date?ue.date:ue.object;default:return ue.unknown}},X=qe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Wc=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class Qt extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const l of i.issues)if(l.code==="invalid_union")l.unionErrors.map(s);else if(l.code==="invalid_return_type")s(l.returnTypeError);else if(l.code==="invalid_arguments")s(l.argumentsError);else if(l.path.length===0)r._errors.push(t(l));else{let c=r,h=0;for(;h<l.path.length;){const f=l.path[h];h===l.path.length-1?(c[f]=c[f]||{_errors:[]},c[f]._errors.push(t(l))):c[f]=c[f]||{_errors:[]},c=c[f],h++}}};return s(this),r}static assert(e){if(!(e instanceof Qt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,qe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Qt.create=n=>new Qt(n);const ns=(n,e)=>{let t;switch(n.code){case X.invalid_type:n.received===ue.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case X.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,qe.jsonStringifyReplacer)}`;break;case X.unrecognized_keys:t=`Unrecognized key(s) in object: ${qe.joinValues(n.keys,", ")}`;break;case X.invalid_union:t="Invalid input";break;case X.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${qe.joinValues(n.options)}`;break;case X.invalid_enum_value:t=`Invalid enum value. Expected ${qe.joinValues(n.options)}, received '${n.received}'`;break;case X.invalid_arguments:t="Invalid function arguments";break;case X.invalid_return_type:t="Invalid function return type";break;case X.invalid_date:t="Invalid date";break;case X.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:qe.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case X.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case X.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case X.custom:t="Invalid input";break;case X.invalid_intersection_types:t="Intersection results could not be merged";break;case X.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case X.not_finite:t="Number must be finite";break;default:t=e.defaultError,qe.assertNever(n)}return{message:t}};let zo=ns;function qc(n){zo=n}function yi(){return zo}const vi=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],l={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let c="";const h=r.filter(f=>!!f).slice().reverse();for(const f of h)c=f(l,{data:e,defaultError:c}).message;return{...s,path:i,message:c}},Yc=[];function le(n,e){const t=yi(),r=vi({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===ns?void 0:ns].filter(s=>!!s)});n.common.issues.push(r)}class Ct{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return Oe;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,l=await s.value;r.push({key:i,value:l})}return Ct.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:l}=s;if(i.status==="aborted"||l.status==="aborted")return Oe;i.status==="dirty"&&e.dirty(),l.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof l.value<"u"||s.alwaysSet)&&(r[i.value]=l.value)}return{status:e.value,value:r}}}const Oe=Object.freeze({status:"aborted"}),es=n=>({status:"dirty",value:n}),Ht=n=>({status:"valid",value:n}),ya=n=>n.status==="aborted",va=n=>n.status==="dirty",vs=n=>n.status==="valid",bs=n=>typeof Promise<"u"&&n instanceof Promise;function bi(n,e,t,r){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function Ko(n,e,t,r,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var _e;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(_e||(_e={}));var ps,gs;class Ln{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const lo=(n,e)=>{if(vs(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Qt(n.common.issues);return this._error=t,this._error}}};function Be(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(l,c)=>{var h,f;const{message:p}=n;return l.code==="invalid_enum_value"?{message:p??c.defaultError}:typeof c.data>"u"?{message:(h=p??r)!==null&&h!==void 0?h:c.defaultError}:l.code!=="invalid_type"?{message:c.defaultError}:{message:(f=p??t)!==null&&f!==void 0?f:c.defaultError}},description:s}}class Ce{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return rr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:rr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ct,ctx:{common:e.parent.common,data:e.data,parsedType:rr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(bs(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:rr(e)},i=this._parseSync({data:e,path:s.path,parent:s});return lo(s,i)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:rr(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(bs(s)?s:Promise.resolve(s));return lo(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const l=e(s),c=()=>i.addIssue({code:X.custom,...r(s)});return typeof Promise<"u"&&l instanceof Promise?l.then(h=>h?!0:(c(),!1)):l?!0:(c(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new bn({schema:this,typeName:Ie.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Pn.create(this,this._def)}nullable(){return dr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return yn.create(this,this._def)}promise(){return ss.create(this,this._def)}or(e){return Ss.create([this,e],this._def)}and(e){return Ts.create(this,e,this._def)}transform(e){return new bn({...Be(this._def),schema:this,typeName:Ie.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Ds({...Be(this._def),innerType:this,defaultValue:t,typeName:Ie.ZodDefault})}brand(){return new ka({typeName:Ie.ZodBranded,type:this,...Be(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Ns({...Be(this._def),innerType:this,catchValue:t,typeName:Ie.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ls.create(this,e)}readonly(){return Rs.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Xc=/^c[^\s-]{8,}$/i,Jc=/^[0-9a-z]+$/,Qc=/^[0-9A-HJKMNP-TV-Z]{26}$/,eu=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,tu=/^[a-z0-9_-]{21}$/i,nu=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ru=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,su="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ta;const iu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,au=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ou=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Wo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",lu=new RegExp(`^${Wo}$`);function qo(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function cu(n){return new RegExp(`^${qo(n)}$`)}function Yo(n){let e=`${Wo}T${qo(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function uu(n,e){return!!((e==="v4"||!e)&&iu.test(n)||(e==="v6"||!e)&&au.test(n))}class mn extends Ce{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ue.string){const i=this._getOrReturnCtx(e);return le(i,{code:X.invalid_type,expected:ue.string,received:i.parsedType}),Oe}const r=new Ct;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),le(s,{code:X.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),le(s,{code:X.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const l=e.data.length>i.value,c=e.data.length<i.value;(l||c)&&(s=this._getOrReturnCtx(e,s),l?le(s,{code:X.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&le(s,{code:X.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")ru.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"email",code:X.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")ta||(ta=new RegExp(su,"u")),ta.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"emoji",code:X.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")eu.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"uuid",code:X.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")tu.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"nanoid",code:X.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")Xc.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"cuid",code:X.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")Jc.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"cuid2",code:X.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")Qc.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"ulid",code:X.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),le(s,{validation:"url",code:X.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"regex",code:X.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),le(s,{code:X.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),le(s,{code:X.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),le(s,{code:X.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?Yo(i).test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{code:X.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?lu.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{code:X.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?cu(i).test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{code:X.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?nu.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"duration",code:X.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?uu(e.data,i.version)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"ip",code:X.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?ou.test(e.data)||(s=this._getOrReturnCtx(e,s),le(s,{validation:"base64",code:X.invalid_string,message:i.message}),r.dirty()):qe.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:X.invalid_string,..._e.errToObj(r)})}_addCheck(e){return new mn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._e.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._e.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._e.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._e.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._e.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._e.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._e.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._e.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._e.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._e.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,..._e.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,..._e.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",..._e.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,..._e.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,..._e.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,..._e.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,..._e.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,..._e.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,..._e.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,..._e.errToObj(t)})}nonempty(e){return this.min(1,_e.errToObj(e))}trim(){return new mn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new mn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new mn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}mn.create=n=>{var e;return new mn({checks:[],typeName:Ie.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Be(n)})};function fu(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),l=parseInt(e.toFixed(s).replace(".",""));return i%l/Math.pow(10,s)}class cr extends Ce{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ue.number){const i=this._getOrReturnCtx(e);return le(i,{code:X.invalid_type,expected:ue.number,received:i.parsedType}),Oe}let r;const s=new Ct;for(const i of this._def.checks)i.kind==="int"?qe.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),le(r,{code:X.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),le(r,{code:X.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),le(r,{code:X.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?fu(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),le(r,{code:X.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),le(r,{code:X.not_finite,message:i.message}),s.dirty()):qe.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,_e.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_e.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_e.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_e.toString(t))}setLimit(e,t,r,s){return new cr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:_e.toString(s)}]})}_addCheck(e){return new cr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_e.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_e.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_e.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_e.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_e.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_e.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:_e.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_e.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_e.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&qe.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}cr.create=n=>new cr({checks:[],typeName:Ie.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Be(n)});class ur extends Ce{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==ue.bigint){const i=this._getOrReturnCtx(e);return le(i,{code:X.invalid_type,expected:ue.bigint,received:i.parsedType}),Oe}let r;const s=new Ct;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),le(r,{code:X.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),le(r,{code:X.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),le(r,{code:X.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):qe.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,_e.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_e.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_e.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_e.toString(t))}setLimit(e,t,r,s){return new ur({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:_e.toString(s)}]})}_addCheck(e){return new ur({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_e.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_e.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_e.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_e.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_e.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ur.create=n=>{var e;return new ur({checks:[],typeName:Ie.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Be(n)})};class _s extends Ce{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ue.boolean){const r=this._getOrReturnCtx(e);return le(r,{code:X.invalid_type,expected:ue.boolean,received:r.parsedType}),Oe}return Ht(e.data)}}_s.create=n=>new _s({typeName:Ie.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Be(n)});class Ur extends Ce{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ue.date){const i=this._getOrReturnCtx(e);return le(i,{code:X.invalid_type,expected:ue.date,received:i.parsedType}),Oe}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return le(i,{code:X.invalid_date}),Oe}const r=new Ct;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),le(s,{code:X.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),le(s,{code:X.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):qe.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ur({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:_e.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:_e.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Ur.create=n=>new Ur({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Ie.ZodDate,...Be(n)});class _i extends Ce{_parse(e){if(this._getType(e)!==ue.symbol){const r=this._getOrReturnCtx(e);return le(r,{code:X.invalid_type,expected:ue.symbol,received:r.parsedType}),Oe}return Ht(e.data)}}_i.create=n=>new _i({typeName:Ie.ZodSymbol,...Be(n)});class Es extends Ce{_parse(e){if(this._getType(e)!==ue.undefined){const r=this._getOrReturnCtx(e);return le(r,{code:X.invalid_type,expected:ue.undefined,received:r.parsedType}),Oe}return Ht(e.data)}}Es.create=n=>new Es({typeName:Ie.ZodUndefined,...Be(n)});class ws extends Ce{_parse(e){if(this._getType(e)!==ue.null){const r=this._getOrReturnCtx(e);return le(r,{code:X.invalid_type,expected:ue.null,received:r.parsedType}),Oe}return Ht(e.data)}}ws.create=n=>new ws({typeName:Ie.ZodNull,...Be(n)});class rs extends Ce{constructor(){super(...arguments),this._any=!0}_parse(e){return Ht(e.data)}}rs.create=n=>new rs({typeName:Ie.ZodAny,...Be(n)});class Mr extends Ce{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ht(e.data)}}Mr.create=n=>new Mr({typeName:Ie.ZodUnknown,...Be(n)});class Kn extends Ce{_parse(e){const t=this._getOrReturnCtx(e);return le(t,{code:X.invalid_type,expected:ue.never,received:t.parsedType}),Oe}}Kn.create=n=>new Kn({typeName:Ie.ZodNever,...Be(n)});class Ei extends Ce{_parse(e){if(this._getType(e)!==ue.undefined){const r=this._getOrReturnCtx(e);return le(r,{code:X.invalid_type,expected:ue.void,received:r.parsedType}),Oe}return Ht(e.data)}}Ei.create=n=>new Ei({typeName:Ie.ZodVoid,...Be(n)});class yn extends Ce{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==ue.array)return le(t,{code:X.invalid_type,expected:ue.array,received:t.parsedType}),Oe;if(s.exactLength!==null){const l=t.data.length>s.exactLength.value,c=t.data.length<s.exactLength.value;(l||c)&&(le(t,{code:l?X.too_big:X.too_small,minimum:c?s.exactLength.value:void 0,maximum:l?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(le(t,{code:X.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(le(t,{code:X.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((l,c)=>s.type._parseAsync(new Ln(t,l,t.path,c)))).then(l=>Ct.mergeArray(r,l));const i=[...t.data].map((l,c)=>s.type._parseSync(new Ln(t,l,t.path,c)));return Ct.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new yn({...this._def,minLength:{value:e,message:_e.toString(t)}})}max(e,t){return new yn({...this._def,maxLength:{value:e,message:_e.toString(t)}})}length(e,t){return new yn({...this._def,exactLength:{value:e,message:_e.toString(t)}})}nonempty(e){return this.min(1,e)}}yn.create=(n,e)=>new yn({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Ie.ZodArray,...Be(e)});function Qr(n){if(n instanceof ut){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Pn.create(Qr(r))}return new ut({...n._def,shape:()=>e})}else return n instanceof yn?new yn({...n._def,type:Qr(n.element)}):n instanceof Pn?Pn.create(Qr(n.unwrap())):n instanceof dr?dr.create(Qr(n.unwrap())):n instanceof Bn?Bn.create(n.items.map(e=>Qr(e))):n}class ut extends Ce{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=qe.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ue.object){const f=this._getOrReturnCtx(e);return le(f,{code:X.invalid_type,expected:ue.object,received:f.parsedType}),Oe}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:l}=this._getCached(),c=[];if(!(this._def.catchall instanceof Kn&&this._def.unknownKeys==="strip"))for(const f in s.data)l.includes(f)||c.push(f);const h=[];for(const f of l){const p=i[f],d=s.data[f];h.push({key:{status:"valid",value:f},value:p._parse(new Ln(s,d,s.path,f)),alwaysSet:f in s.data})}if(this._def.catchall instanceof Kn){const f=this._def.unknownKeys;if(f==="passthrough")for(const p of c)h.push({key:{status:"valid",value:p},value:{status:"valid",value:s.data[p]}});else if(f==="strict")c.length>0&&(le(s,{code:X.unrecognized_keys,keys:c}),r.dirty());else if(f!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const f=this._def.catchall;for(const p of c){const d=s.data[p];h.push({key:{status:"valid",value:p},value:f._parse(new Ln(s,d,s.path,p)),alwaysSet:p in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const f=[];for(const p of h){const d=await p.key,S=await p.value;f.push({key:d,value:S,alwaysSet:p.alwaysSet})}return f}).then(f=>Ct.mergeObjectSync(r,f)):Ct.mergeObjectSync(r,h)}get shape(){return this._def.shape()}strict(e){return _e.errToObj,new ut({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,l,c;const h=(l=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&l!==void 0?l:r.defaultError;return t.code==="unrecognized_keys"?{message:(c=_e.errToObj(e).message)!==null&&c!==void 0?c:h}:{message:h}}}:{}})}strip(){return new ut({...this._def,unknownKeys:"strip"})}passthrough(){return new ut({...this._def,unknownKeys:"passthrough"})}extend(e){return new ut({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ut({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ie.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ut({...this._def,catchall:e})}pick(e){const t={};return qe.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ut({...this._def,shape:()=>t})}omit(e){const t={};return qe.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ut({...this._def,shape:()=>t})}deepPartial(){return Qr(this)}partial(e){const t={};return qe.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new ut({...this._def,shape:()=>t})}required(e){const t={};return qe.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof Pn;)i=i._def.innerType;t[r]=i}}),new ut({...this._def,shape:()=>t})}keyof(){return Xo(qe.objectKeys(this.shape))}}ut.create=(n,e)=>new ut({shape:()=>n,unknownKeys:"strip",catchall:Kn.create(),typeName:Ie.ZodObject,...Be(e)});ut.strictCreate=(n,e)=>new ut({shape:()=>n,unknownKeys:"strict",catchall:Kn.create(),typeName:Ie.ZodObject,...Be(e)});ut.lazycreate=(n,e)=>new ut({shape:n,unknownKeys:"strip",catchall:Kn.create(),typeName:Ie.ZodObject,...Be(e)});class Ss extends Ce{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const c of i)if(c.result.status==="valid")return c.result;for(const c of i)if(c.result.status==="dirty")return t.common.issues.push(...c.ctx.common.issues),c.result;const l=i.map(c=>new Qt(c.ctx.common.issues));return le(t,{code:X.invalid_union,unionErrors:l}),Oe}if(t.common.async)return Promise.all(r.map(async i=>{const l={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:l}),ctx:l}})).then(s);{let i;const l=[];for(const h of r){const f={...t,common:{...t.common,issues:[]},parent:null},p=h._parseSync({data:t.data,path:t.path,parent:f});if(p.status==="valid")return p;p.status==="dirty"&&!i&&(i={result:p,ctx:f}),f.common.issues.length&&l.push(f.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const c=l.map(h=>new Qt(h));return le(t,{code:X.invalid_union,unionErrors:c}),Oe}}get options(){return this._def.options}}Ss.create=(n,e)=>new Ss({options:n,typeName:Ie.ZodUnion,...Be(e)});const Hn=n=>n instanceof Is?Hn(n.schema):n instanceof bn?Hn(n.innerType()):n instanceof Os?[n.value]:n instanceof fr?n.options:n instanceof xs?qe.objectValues(n.enum):n instanceof Ds?Hn(n._def.innerType):n instanceof Es?[void 0]:n instanceof ws?[null]:n instanceof Pn?[void 0,...Hn(n.unwrap())]:n instanceof dr?[null,...Hn(n.unwrap())]:n instanceof ka||n instanceof Rs?Hn(n.unwrap()):n instanceof Ns?Hn(n._def.innerType):[];class Di extends Ce{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ue.object)return le(t,{code:X.invalid_type,expected:ue.object,received:t.parsedType}),Oe;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(le(t,{code:X.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Oe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const l=Hn(i.shape[e]);if(!l.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const c of l){if(s.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);s.set(c,i)}}return new Di({typeName:Ie.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Be(r)})}}function ba(n,e){const t=rr(n),r=rr(e);if(n===e)return{valid:!0,data:n};if(t===ue.object&&r===ue.object){const s=qe.objectKeys(e),i=qe.objectKeys(n).filter(c=>s.indexOf(c)!==-1),l={...n,...e};for(const c of i){const h=ba(n[c],e[c]);if(!h.valid)return{valid:!1};l[c]=h.data}return{valid:!0,data:l}}else if(t===ue.array&&r===ue.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const l=n[i],c=e[i],h=ba(l,c);if(!h.valid)return{valid:!1};s.push(h.data)}return{valid:!0,data:s}}else return t===ue.date&&r===ue.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Ts extends Ce{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,l)=>{if(ya(i)||ya(l))return Oe;const c=ba(i.value,l.value);return c.valid?((va(i)||va(l))&&t.dirty(),{status:t.value,value:c.data}):(le(r,{code:X.invalid_intersection_types}),Oe)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,l])=>s(i,l)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Ts.create=(n,e,t)=>new Ts({left:n,right:e,typeName:Ie.ZodIntersection,...Be(t)});class Bn extends Ce{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ue.array)return le(r,{code:X.invalid_type,expected:ue.array,received:r.parsedType}),Oe;if(r.data.length<this._def.items.length)return le(r,{code:X.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Oe;!this._def.rest&&r.data.length>this._def.items.length&&(le(r,{code:X.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((l,c)=>{const h=this._def.items[c]||this._def.rest;return h?h._parse(new Ln(r,l,r.path,c)):null}).filter(l=>!!l);return r.common.async?Promise.all(i).then(l=>Ct.mergeArray(t,l)):Ct.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Bn({...this._def,rest:e})}}Bn.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Bn({items:n,typeName:Ie.ZodTuple,rest:null,...Be(e)})};class As extends Ce{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ue.object)return le(r,{code:X.invalid_type,expected:ue.object,received:r.parsedType}),Oe;const s=[],i=this._def.keyType,l=this._def.valueType;for(const c in r.data)s.push({key:i._parse(new Ln(r,c,r.path,c)),value:l._parse(new Ln(r,r.data[c],r.path,c)),alwaysSet:c in r.data});return r.common.async?Ct.mergeObjectAsync(t,s):Ct.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Ce?new As({keyType:e,valueType:t,typeName:Ie.ZodRecord,...Be(r)}):new As({keyType:mn.create(),valueType:e,typeName:Ie.ZodRecord,...Be(t)})}}class wi extends Ce{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ue.map)return le(r,{code:X.invalid_type,expected:ue.map,received:r.parsedType}),Oe;const s=this._def.keyType,i=this._def.valueType,l=[...r.data.entries()].map(([c,h],f)=>({key:s._parse(new Ln(r,c,r.path,[f,"key"])),value:i._parse(new Ln(r,h,r.path,[f,"value"]))}));if(r.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const h of l){const f=await h.key,p=await h.value;if(f.status==="aborted"||p.status==="aborted")return Oe;(f.status==="dirty"||p.status==="dirty")&&t.dirty(),c.set(f.value,p.value)}return{status:t.value,value:c}})}else{const c=new Map;for(const h of l){const f=h.key,p=h.value;if(f.status==="aborted"||p.status==="aborted")return Oe;(f.status==="dirty"||p.status==="dirty")&&t.dirty(),c.set(f.value,p.value)}return{status:t.value,value:c}}}}wi.create=(n,e,t)=>new wi({valueType:e,keyType:n,typeName:Ie.ZodMap,...Be(t)});class $r extends Ce{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ue.set)return le(r,{code:X.invalid_type,expected:ue.set,received:r.parsedType}),Oe;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(le(r,{code:X.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(le(r,{code:X.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function l(h){const f=new Set;for(const p of h){if(p.status==="aborted")return Oe;p.status==="dirty"&&t.dirty(),f.add(p.value)}return{status:t.value,value:f}}const c=[...r.data.values()].map((h,f)=>i._parse(new Ln(r,h,r.path,f)));return r.common.async?Promise.all(c).then(h=>l(h)):l(c)}min(e,t){return new $r({...this._def,minSize:{value:e,message:_e.toString(t)}})}max(e,t){return new $r({...this._def,maxSize:{value:e,message:_e.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}$r.create=(n,e)=>new $r({valueType:n,minSize:null,maxSize:null,typeName:Ie.ZodSet,...Be(e)});class ts extends Ce{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ue.function)return le(t,{code:X.invalid_type,expected:ue.function,received:t.parsedType}),Oe;function r(c,h){return vi({data:c,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,yi(),ns].filter(f=>!!f),issueData:{code:X.invalid_arguments,argumentsError:h}})}function s(c,h){return vi({data:c,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,yi(),ns].filter(f=>!!f),issueData:{code:X.invalid_return_type,returnTypeError:h}})}const i={errorMap:t.common.contextualErrorMap},l=t.data;if(this._def.returns instanceof ss){const c=this;return Ht(async function(...h){const f=new Qt([]),p=await c._def.args.parseAsync(h,i).catch(M=>{throw f.addIssue(r(h,M)),f}),d=await Reflect.apply(l,this,p);return await c._def.returns._def.type.parseAsync(d,i).catch(M=>{throw f.addIssue(s(d,M)),f})})}else{const c=this;return Ht(function(...h){const f=c._def.args.safeParse(h,i);if(!f.success)throw new Qt([r(h,f.error)]);const p=Reflect.apply(l,this,f.data),d=c._def.returns.safeParse(p,i);if(!d.success)throw new Qt([s(p,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ts({...this._def,args:Bn.create(e).rest(Mr.create())})}returns(e){return new ts({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new ts({args:e||Bn.create([]).rest(Mr.create()),returns:t||Mr.create(),typeName:Ie.ZodFunction,...Be(r)})}}class Is extends Ce{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Is.create=(n,e)=>new Is({getter:n,typeName:Ie.ZodLazy,...Be(e)});class Os extends Ce{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return le(t,{received:t.data,code:X.invalid_literal,expected:this._def.value}),Oe}return{status:"valid",value:e.data}}get value(){return this._def.value}}Os.create=(n,e)=>new Os({value:n,typeName:Ie.ZodLiteral,...Be(e)});function Xo(n,e){return new fr({values:n,typeName:Ie.ZodEnum,...Be(e)})}class fr extends Ce{constructor(){super(...arguments),ps.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return le(t,{expected:qe.joinValues(r),received:t.parsedType,code:X.invalid_type}),Oe}if(bi(this,ps)||Ko(this,ps,new Set(this._def.values)),!bi(this,ps).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return le(t,{received:t.data,code:X.invalid_enum_value,options:r}),Oe}return Ht(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return fr.create(e,{...this._def,...t})}exclude(e,t=this._def){return fr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}ps=new WeakMap;fr.create=Xo;class xs extends Ce{constructor(){super(...arguments),gs.set(this,void 0)}_parse(e){const t=qe.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ue.string&&r.parsedType!==ue.number){const s=qe.objectValues(t);return le(r,{expected:qe.joinValues(s),received:r.parsedType,code:X.invalid_type}),Oe}if(bi(this,gs)||Ko(this,gs,new Set(qe.getValidEnumValues(this._def.values))),!bi(this,gs).has(e.data)){const s=qe.objectValues(t);return le(r,{received:r.data,code:X.invalid_enum_value,options:s}),Oe}return Ht(e.data)}get enum(){return this._def.values}}gs=new WeakMap;xs.create=(n,e)=>new xs({values:n,typeName:Ie.ZodNativeEnum,...Be(e)});class ss extends Ce{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ue.promise&&t.common.async===!1)return le(t,{code:X.invalid_type,expected:ue.promise,received:t.parsedType}),Oe;const r=t.parsedType===ue.promise?t.data:Promise.resolve(t.data);return Ht(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ss.create=(n,e)=>new ss({type:n,typeName:Ie.ZodPromise,...Be(e)});class bn extends Ce{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ie.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:l=>{le(r,l),l.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const l=s.transform(r.data,i);if(r.common.async)return Promise.resolve(l).then(async c=>{if(t.value==="aborted")return Oe;const h=await this._def.schema._parseAsync({data:c,path:r.path,parent:r});return h.status==="aborted"?Oe:h.status==="dirty"||t.value==="dirty"?es(h.value):h});{if(t.value==="aborted")return Oe;const c=this._def.schema._parseSync({data:l,path:r.path,parent:r});return c.status==="aborted"?Oe:c.status==="dirty"||t.value==="dirty"?es(c.value):c}}if(s.type==="refinement"){const l=c=>{const h=s.refinement(c,i);if(r.common.async)return Promise.resolve(h);if(h instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(r.common.async===!1){const c=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return c.status==="aborted"?Oe:(c.status==="dirty"&&t.dirty(),l(c.value),{status:t.value,value:c.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(c=>c.status==="aborted"?Oe:(c.status==="dirty"&&t.dirty(),l(c.value).then(()=>({status:t.value,value:c.value}))))}if(s.type==="transform")if(r.common.async===!1){const l=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!vs(l))return l;const c=s.transform(l.value,i);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:c}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(l=>vs(l)?Promise.resolve(s.transform(l.value,i)).then(c=>({status:t.value,value:c})):l);qe.assertNever(s)}}bn.create=(n,e,t)=>new bn({schema:n,typeName:Ie.ZodEffects,effect:e,...Be(t)});bn.createWithPreprocess=(n,e,t)=>new bn({schema:e,effect:{type:"preprocess",transform:n},typeName:Ie.ZodEffects,...Be(t)});class Pn extends Ce{_parse(e){return this._getType(e)===ue.undefined?Ht(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Pn.create=(n,e)=>new Pn({innerType:n,typeName:Ie.ZodOptional,...Be(e)});class dr extends Ce{_parse(e){return this._getType(e)===ue.null?Ht(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}dr.create=(n,e)=>new dr({innerType:n,typeName:Ie.ZodNullable,...Be(e)});class Ds extends Ce{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===ue.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ds.create=(n,e)=>new Ds({innerType:n,typeName:Ie.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Be(e)});class Ns extends Ce{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return bs(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Qt(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Qt(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Ns.create=(n,e)=>new Ns({innerType:n,typeName:Ie.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Be(e)});class Si extends Ce{_parse(e){if(this._getType(e)!==ue.nan){const r=this._getOrReturnCtx(e);return le(r,{code:X.invalid_type,expected:ue.nan,received:r.parsedType}),Oe}return{status:"valid",value:e.data}}}Si.create=n=>new Si({typeName:Ie.ZodNaN,...Be(n)});const du=Symbol("zod_brand");class ka extends Ce{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ls extends Ce{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Oe:i.status==="dirty"?(t.dirty(),es(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?Oe:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new Ls({in:e,out:t,typeName:Ie.ZodPipeline})}}class Rs extends Ce{_parse(e){const t=this._def.innerType._parse(e),r=s=>(vs(s)&&(s.value=Object.freeze(s.value)),s);return bs(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}Rs.create=(n,e)=>new Rs({innerType:n,typeName:Ie.ZodReadonly,...Be(e)});function La(n,e={},t){return n?rs.create().superRefine((r,s)=>{var i,l;if(!n(r)){const c=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,h=(l=(i=c.fatal)!==null&&i!==void 0?i:t)!==null&&l!==void 0?l:!0,f=typeof c=="string"?{message:c}:c;s.addIssue({code:"custom",...f,fatal:h})}}):rs.create()}const hu={object:ut.lazycreate};var Ie;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Ie||(Ie={}));const pu=(n,e={message:`Input not instance of ${n.name}`})=>La(t=>t instanceof n,e),I=mn.create,Ee=cr.create,gu=Si.create,Jo=ur.create,De=_s.create,mu=Ur.create,yu=_i.create,vu=Es.create,Ni=ws.create,bu=rs.create,Ps=Mr.create,_u=Kn.create,Eu=Ei.create,We=yn.create,re=ut.create,wu=ut.strictCreate,Ba=Ss.create,Su=Di.create,Tu=Ts.create,Au=Bn.create,Iu=As.create,Ou=wi.create,xu=$r.create,Du=ts.create,Nu=Is.create,Tt=Os.create,Ru=fr.create,os=xs.create,Pu=ss.create,co=bn.create,Qo=Pn.create,ku=dr.create,el=bn.createWithPreprocess,Lu=Ls.create,Bu=()=>I().optional(),Mu=()=>Ee().optional(),Cu=()=>De().optional(),Uu={string:n=>mn.create({...n,coerce:!0}),number:n=>cr.create({...n,coerce:!0}),boolean:n=>_s.create({...n,coerce:!0}),bigint:n=>ur.create({...n,coerce:!0}),date:n=>Ur.create({...n,coerce:!0})},$u=Oe;var se=Object.freeze({__proto__:null,defaultErrorMap:ns,setErrorMap:qc,getErrorMap:yi,makeIssue:vi,EMPTY_PATH:Yc,addIssueToContext:le,ParseStatus:Ct,INVALID:Oe,DIRTY:es,OK:Ht,isAborted:ya,isDirty:va,isValid:vs,isAsync:bs,get util(){return qe},get objectUtil(){return ma},ZodParsedType:ue,getParsedType:rr,ZodType:Ce,datetimeRegex:Yo,ZodString:mn,ZodNumber:cr,ZodBigInt:ur,ZodBoolean:_s,ZodDate:Ur,ZodSymbol:_i,ZodUndefined:Es,ZodNull:ws,ZodAny:rs,ZodUnknown:Mr,ZodNever:Kn,ZodVoid:Ei,ZodArray:yn,ZodObject:ut,ZodUnion:Ss,ZodDiscriminatedUnion:Di,ZodIntersection:Ts,ZodTuple:Bn,ZodRecord:As,ZodMap:wi,ZodSet:$r,ZodFunction:ts,ZodLazy:Is,ZodLiteral:Os,ZodEnum:fr,ZodNativeEnum:xs,ZodPromise:ss,ZodEffects:bn,ZodTransformer:bn,ZodOptional:Pn,ZodNullable:dr,ZodDefault:Ds,ZodCatch:Ns,ZodNaN:Si,BRAND:du,ZodBranded:ka,ZodPipeline:Ls,ZodReadonly:Rs,custom:La,Schema:Ce,ZodSchema:Ce,late:hu,get ZodFirstPartyTypeKind(){return Ie},coerce:Uu,any:bu,array:We,bigint:Jo,boolean:De,date:mu,discriminatedUnion:Su,effect:co,enum:Ru,function:Du,instanceof:pu,intersection:Tu,lazy:Nu,literal:Tt,map:Ou,nan:gu,nativeEnum:os,never:_u,null:Ni,nullable:ku,number:Ee,object:re,oboolean:Cu,onumber:Mu,optional:Qo,ostring:Bu,pipeline:Lu,preprocess:el,promise:Pu,record:Iu,set:xu,strictObject:wu,string:I,symbol:yu,transformer:co,tuple:Au,undefined:vu,union:Ba,unknown:Ps,void:Eu,NEVER:$u,ZodIssueCode:X,quotelessJson:Wc,ZodError:Qt}),na={exports:{}},uo;function Vu(){return uo||(uo=1,function(n){var e=function(t){var r=1e7,s=7,i=9007199254740992,l=Y(i),c="0123456789abcdefghijklmnopqrstuvwxyz",h=typeof BigInt=="function";function f(g,b,A,O){return typeof g>"u"?f[0]:typeof b<"u"?+b==10&&!A?Te(g):$n(g,b,A,O):Te(g)}function p(g,b){this.value=g,this.sign=b,this.isSmall=!1}p.prototype=Object.create(f.prototype);function d(g){this.value=g,this.sign=g<0,this.isSmall=!0}d.prototype=Object.create(f.prototype);function S(g){this.value=g}S.prototype=Object.create(f.prototype);function M(g){return-9007199254740992<g&&g<i}function Y(g){return g<1e7?[g]:g<1e14?[g%1e7,Math.floor(g/1e7)]:[g%1e7,Math.floor(g/1e7)%1e7,Math.floor(g/1e14)]}function V(g){H(g);var b=g.length;if(b<4&&Se(g,l)<0)switch(b){case 0:return 0;case 1:return g[0];case 2:return g[0]+g[1]*r;default:return g[0]+(g[1]+g[2]*r)*r}return g}function H(g){for(var b=g.length;g[--b]===0;);g.length=b+1}function ce(g){for(var b=new Array(g),A=-1;++A<g;)b[A]=0;return b}function fe(g){return g>0?Math.floor(g):Math.ceil(g)}function te(g,b){var A=g.length,O=b.length,C=new Array(A),k=0,$=r,j,Z;for(Z=0;Z<O;Z++)j=g[Z]+b[Z]+k,k=j>=$?1:0,C[Z]=j-k*$;for(;Z<A;)j=g[Z]+k,k=j===$?1:0,C[Z++]=j-k*$;return k>0&&C.push(k),C}function ye(g,b){return g.length>=b.length?te(g,b):te(b,g)}function Xe(g,b){var A=g.length,O=new Array(A),C=r,k,$;for($=0;$<A;$++)k=g[$]-C+b,b=Math.floor(k/C),O[$]=k-b*C,b+=1;for(;b>0;)O[$++]=b%C,b=Math.floor(b/C);return O}p.prototype.add=function(g){var b=Te(g);if(this.sign!==b.sign)return this.subtract(b.negate());var A=this.value,O=b.value;return b.isSmall?new p(Xe(A,Math.abs(O)),this.sign):new p(ye(A,O),this.sign)},p.prototype.plus=p.prototype.add,d.prototype.add=function(g){var b=Te(g),A=this.value;if(A<0!==b.sign)return this.subtract(b.negate());var O=b.value;if(b.isSmall){if(M(A+O))return new d(A+O);O=Y(Math.abs(O))}return new p(Xe(O,Math.abs(A)),A<0)},d.prototype.plus=d.prototype.add,S.prototype.add=function(g){return new S(this.value+Te(g).value)},S.prototype.plus=S.prototype.add;function Je(g,b){var A=g.length,O=b.length,C=new Array(A),k=0,$=r,j,Z;for(j=0;j<O;j++)Z=g[j]-k-b[j],Z<0?(Z+=$,k=1):k=0,C[j]=Z;for(j=O;j<A;j++){if(Z=g[j]-k,Z<0)Z+=$;else{C[j++]=Z;break}C[j]=Z}for(;j<A;j++)C[j]=g[j];return H(C),C}function He(g,b,A){var O;return Se(g,b)>=0?O=Je(g,b):(O=Je(b,g),A=!A),O=V(O),typeof O=="number"?(A&&(O=-O),new d(O)):new p(O,A)}function tt(g,b,A){var O=g.length,C=new Array(O),k=-b,$=r,j,Z;for(j=0;j<O;j++)Z=g[j]+k,k=Math.floor(Z/$),Z%=$,C[j]=Z<0?Z+$:Z;return C=V(C),typeof C=="number"?(A&&(C=-C),new d(C)):new p(C,A)}p.prototype.subtract=function(g){var b=Te(g);if(this.sign!==b.sign)return this.add(b.negate());var A=this.value,O=b.value;return b.isSmall?tt(A,Math.abs(O),this.sign):He(A,O,this.sign)},p.prototype.minus=p.prototype.subtract,d.prototype.subtract=function(g){var b=Te(g),A=this.value;if(A<0!==b.sign)return this.add(b.negate());var O=b.value;return b.isSmall?new d(A-O):tt(O,Math.abs(A),A>=0)},d.prototype.minus=d.prototype.subtract,S.prototype.subtract=function(g){return new S(this.value-Te(g).value)},S.prototype.minus=S.prototype.subtract,p.prototype.negate=function(){return new p(this.value,!this.sign)},d.prototype.negate=function(){var g=this.sign,b=new d(-this.value);return b.sign=!g,b},S.prototype.negate=function(){return new S(-this.value)},p.prototype.abs=function(){return new p(this.value,!1)},d.prototype.abs=function(){return new d(Math.abs(this.value))},S.prototype.abs=function(){return new S(this.value>=0?this.value:-this.value)};function Ge(g,b){var A=g.length,O=b.length,C=A+O,k=ce(C),$=r,j,Z,ve,Re,xe;for(ve=0;ve<A;++ve){Re=g[ve];for(var ke=0;ke<O;++ke)xe=b[ke],j=Re*xe+k[ve+ke],Z=Math.floor(j/$),k[ve+ke]=j-Z*$,k[ve+ke+1]+=Z}return H(k),k}function Lt(g,b){var A=g.length,O=new Array(A),C=r,k=0,$,j;for(j=0;j<A;j++)$=g[j]*b+k,k=Math.floor($/C),O[j]=$-k*C;for(;k>0;)O[j++]=k%C,k=Math.floor(k/C);return O}function Qe(g,b){for(var A=[];b-- >0;)A.push(0);return A.concat(g)}function $e(g,b){var A=Math.max(g.length,b.length);if(A<=30)return Ge(g,b);A=Math.ceil(A/2);var O=g.slice(A),C=g.slice(0,A),k=b.slice(A),$=b.slice(0,A),j=$e(C,$),Z=$e(O,k),ve=$e(ye(C,O),ye($,k)),Re=ye(ye(j,Qe(Je(Je(ve,j),Z),A)),Qe(Z,2*A));return H(Re),Re}function B(g,b){return-.012*g-.012*b+15e-6*g*b>0}p.prototype.multiply=function(g){var b=Te(g),A=this.value,O=b.value,C=this.sign!==b.sign,k;if(b.isSmall){if(O===0)return f[0];if(O===1)return this;if(O===-1)return this.negate();if(k=Math.abs(O),k<r)return new p(Lt(A,k),C);O=Y(k)}return B(A.length,O.length)?new p($e(A,O),C):new p(Ge(A,O),C)},p.prototype.times=p.prototype.multiply;function J(g,b,A){return g<r?new p(Lt(b,g),A):new p(Ge(b,Y(g)),A)}d.prototype._multiplyBySmall=function(g){return M(g.value*this.value)?new d(g.value*this.value):J(Math.abs(g.value),Y(Math.abs(this.value)),this.sign!==g.sign)},p.prototype._multiplyBySmall=function(g){return g.value===0?f[0]:g.value===1?this:g.value===-1?this.negate():J(Math.abs(g.value),this.value,this.sign!==g.sign)},d.prototype.multiply=function(g){return Te(g)._multiplyBySmall(this)},d.prototype.times=d.prototype.multiply,S.prototype.multiply=function(g){return new S(this.value*Te(g).value)},S.prototype.times=S.prototype.multiply;function W(g){var b=g.length,A=ce(b+b),O=r,C,k,$,j,Z;for($=0;$<b;$++){j=g[$],k=0-j*j;for(var ve=$;ve<b;ve++)Z=g[ve],C=2*(j*Z)+A[$+ve]+k,k=Math.floor(C/O),A[$+ve]=C-k*O;A[$+b]=k}return H(A),A}p.prototype.square=function(){return new p(W(this.value),!1)},d.prototype.square=function(){var g=this.value*this.value;return M(g)?new d(g):new p(W(Y(Math.abs(this.value))),!1)},S.prototype.square=function(g){return new S(this.value*this.value)};function q(g,b){var A=g.length,O=b.length,C=r,k=ce(b.length),$=b[O-1],j=Math.ceil(C/(2*$)),Z=Lt(g,j),ve=Lt(b,j),Re,xe,ke,At,ze,En,wt;for(Z.length<=A&&Z.push(0),ve.push(0),$=ve[O-1],xe=A-O;xe>=0;xe--){for(Re=C-1,Z[xe+O]!==$&&(Re=Math.floor((Z[xe+O]*C+Z[xe+O-1])/$)),ke=0,At=0,En=ve.length,ze=0;ze<En;ze++)ke+=Re*ve[ze],wt=Math.floor(ke/C),At+=Z[xe+ze]-(ke-wt*C),ke=wt,At<0?(Z[xe+ze]=At+C,At=-1):(Z[xe+ze]=At,At=0);for(;At!==0;){for(Re-=1,ke=0,ze=0;ze<En;ze++)ke+=Z[xe+ze]-C+ve[ze],ke<0?(Z[xe+ze]=ke+C,ke=0):(Z[xe+ze]=ke,ke=1);At+=ke}k[xe]=Re}return Z=me(Z,j)[0],[V(k),V(Z)]}function ee(g,b){for(var A=g.length,O=b.length,C=[],k=[],$=r,j,Z,ve,Re,xe;A;){if(k.unshift(g[--A]),H(k),Se(k,b)<0){C.push(0);continue}Z=k.length,ve=k[Z-1]*$+k[Z-2],Re=b[O-1]*$+b[O-2],Z>O&&(ve=(ve+1)*$),j=Math.ceil(ve/Re);do{if(xe=Lt(b,j),Se(xe,k)<=0)break;j--}while(j);C.push(j),k=Je(k,xe)}return C.reverse(),[V(C),V(k)]}function me(g,b){var A=g.length,O=ce(A),C=r,k,$,j,Z;for(j=0,k=A-1;k>=0;--k)Z=j*C+g[k],$=fe(Z/b),j=Z-$*b,O[k]=$|0;return[O,j|0]}function Ne(g,b){var A,O=Te(b);if(h)return[new S(g.value/O.value),new S(g.value%O.value)];var C=g.value,k=O.value,$;if(k===0)throw new Error("Cannot divide by zero");if(g.isSmall)return O.isSmall?[new d(fe(C/k)),new d(C%k)]:[f[0],g];if(O.isSmall){if(k===1)return[g,f[0]];if(k==-1)return[g.negate(),f[0]];var j=Math.abs(k);if(j<r){A=me(C,j),$=V(A[0]);var Z=A[1];return g.sign&&(Z=-Z),typeof $=="number"?(g.sign!==O.sign&&($=-$),[new d($),new d(Z)]):[new p($,g.sign!==O.sign),new d(Z)]}k=Y(j)}var ve=Se(C,k);if(ve===-1)return[f[0],g];if(ve===0)return[f[g.sign===O.sign?1:-1],f[0]];C.length+k.length<=200?A=q(C,k):A=ee(C,k),$=A[0];var Re=g.sign!==O.sign,xe=A[1],ke=g.sign;return typeof $=="number"?(Re&&($=-$),$=new d($)):$=new p($,Re),typeof xe=="number"?(ke&&(xe=-xe),xe=new d(xe)):xe=new p(xe,ke),[$,xe]}p.prototype.divmod=function(g){var b=Ne(this,g);return{quotient:b[0],remainder:b[1]}},S.prototype.divmod=d.prototype.divmod=p.prototype.divmod,p.prototype.divide=function(g){return Ne(this,g)[0]},S.prototype.over=S.prototype.divide=function(g){return new S(this.value/Te(g).value)},d.prototype.over=d.prototype.divide=p.prototype.over=p.prototype.divide,p.prototype.mod=function(g){return Ne(this,g)[1]},S.prototype.mod=S.prototype.remainder=function(g){return new S(this.value%Te(g).value)},d.prototype.remainder=d.prototype.mod=p.prototype.remainder=p.prototype.mod,p.prototype.pow=function(g){var b=Te(g),A=this.value,O=b.value,C,k,$;if(O===0)return f[1];if(A===0)return f[0];if(A===1)return f[1];if(A===-1)return b.isEven()?f[1]:f[-1];if(b.sign)return f[0];if(!b.isSmall)throw new Error("The exponent "+b.toString()+" is too large.");if(this.isSmall&&M(C=Math.pow(A,O)))return new d(fe(C));for(k=this,$=f[1];O&!0&&($=$.times(k),--O),O!==0;)O/=2,k=k.square();return $},d.prototype.pow=p.prototype.pow,S.prototype.pow=function(g){var b=Te(g),A=this.value,O=b.value,C=BigInt(0),k=BigInt(1),$=BigInt(2);if(O===C)return f[1];if(A===C)return f[0];if(A===k)return f[1];if(A===BigInt(-1))return b.isEven()?f[1]:f[-1];if(b.isNegative())return new S(C);for(var j=this,Z=f[1];(O&k)===k&&(Z=Z.times(j),--O),O!==C;)O/=$,j=j.square();return Z},p.prototype.modPow=function(g,b){if(g=Te(g),b=Te(b),b.isZero())throw new Error("Cannot take modPow with modulus 0");var A=f[1],O=this.mod(b);for(g.isNegative()&&(g=g.multiply(f[-1]),O=O.modInv(b));g.isPositive();){if(O.isZero())return f[0];g.isOdd()&&(A=A.multiply(O).mod(b)),g=g.divide(2),O=O.square().mod(b)}return A},S.prototype.modPow=d.prototype.modPow=p.prototype.modPow;function Se(g,b){if(g.length!==b.length)return g.length>b.length?1:-1;for(var A=g.length-1;A>=0;A--)if(g[A]!==b[A])return g[A]>b[A]?1:-1;return 0}p.prototype.compareAbs=function(g){var b=Te(g),A=this.value,O=b.value;return b.isSmall?1:Se(A,O)},d.prototype.compareAbs=function(g){var b=Te(g),A=Math.abs(this.value),O=b.value;return b.isSmall?(O=Math.abs(O),A===O?0:A>O?1:-1):-1},S.prototype.compareAbs=function(g){var b=this.value,A=Te(g).value;return b=b>=0?b:-b,A=A>=0?A:-A,b===A?0:b>A?1:-1},p.prototype.compare=function(g){if(g===1/0)return-1;if(g===-1/0)return 1;var b=Te(g),A=this.value,O=b.value;return this.sign!==b.sign?b.sign?1:-1:b.isSmall?this.sign?-1:1:Se(A,O)*(this.sign?-1:1)},p.prototype.compareTo=p.prototype.compare,d.prototype.compare=function(g){if(g===1/0)return-1;if(g===-1/0)return 1;var b=Te(g),A=this.value,O=b.value;return b.isSmall?A==O?0:A>O?1:-1:A<0!==b.sign?A<0?-1:1:A<0?1:-1},d.prototype.compareTo=d.prototype.compare,S.prototype.compare=function(g){if(g===1/0)return-1;if(g===-1/0)return 1;var b=this.value,A=Te(g).value;return b===A?0:b>A?1:-1},S.prototype.compareTo=S.prototype.compare,p.prototype.equals=function(g){return this.compare(g)===0},S.prototype.eq=S.prototype.equals=d.prototype.eq=d.prototype.equals=p.prototype.eq=p.prototype.equals,p.prototype.notEquals=function(g){return this.compare(g)!==0},S.prototype.neq=S.prototype.notEquals=d.prototype.neq=d.prototype.notEquals=p.prototype.neq=p.prototype.notEquals,p.prototype.greater=function(g){return this.compare(g)>0},S.prototype.gt=S.prototype.greater=d.prototype.gt=d.prototype.greater=p.prototype.gt=p.prototype.greater,p.prototype.lesser=function(g){return this.compare(g)<0},S.prototype.lt=S.prototype.lesser=d.prototype.lt=d.prototype.lesser=p.prototype.lt=p.prototype.lesser,p.prototype.greaterOrEquals=function(g){return this.compare(g)>=0},S.prototype.geq=S.prototype.greaterOrEquals=d.prototype.geq=d.prototype.greaterOrEquals=p.prototype.geq=p.prototype.greaterOrEquals,p.prototype.lesserOrEquals=function(g){return this.compare(g)<=0},S.prototype.leq=S.prototype.lesserOrEquals=d.prototype.leq=d.prototype.lesserOrEquals=p.prototype.leq=p.prototype.lesserOrEquals,p.prototype.isEven=function(){return(this.value[0]&1)===0},d.prototype.isEven=function(){return(this.value&1)===0},S.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},p.prototype.isOdd=function(){return(this.value[0]&1)===1},d.prototype.isOdd=function(){return(this.value&1)===1},S.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},p.prototype.isPositive=function(){return!this.sign},d.prototype.isPositive=function(){return this.value>0},S.prototype.isPositive=d.prototype.isPositive,p.prototype.isNegative=function(){return this.sign},d.prototype.isNegative=function(){return this.value<0},S.prototype.isNegative=d.prototype.isNegative,p.prototype.isUnit=function(){return!1},d.prototype.isUnit=function(){return Math.abs(this.value)===1},S.prototype.isUnit=function(){return this.abs().value===BigInt(1)},p.prototype.isZero=function(){return!1},d.prototype.isZero=function(){return this.value===0},S.prototype.isZero=function(){return this.value===BigInt(0)},p.prototype.isDivisibleBy=function(g){var b=Te(g);return b.isZero()?!1:b.isUnit()?!0:b.compareAbs(2)===0?this.isEven():this.mod(b).isZero()},S.prototype.isDivisibleBy=d.prototype.isDivisibleBy=p.prototype.isDivisibleBy;function Ze(g){var b=g.abs();if(b.isUnit())return!1;if(b.equals(2)||b.equals(3)||b.equals(5))return!0;if(b.isEven()||b.isDivisibleBy(3)||b.isDivisibleBy(5))return!1;if(b.lesser(49))return!0}function Fe(g,b){for(var A=g.prev(),O=A,C=0,k,$,j;O.isEven();)O=O.divide(2),C++;e:for($=0;$<b.length;$++)if(!g.lesser(b[$])&&(j=e(b[$]).modPow(O,g),!(j.isUnit()||j.equals(A)))){for(k=C-1;k!=0;k--){if(j=j.square().mod(g),j.isUnit())return!1;if(j.equals(A))continue e}return!1}return!0}p.prototype.isPrime=function(g){var b=Ze(this);if(b!==t)return b;var A=this.abs(),O=A.bitLength();if(O<=64)return Fe(A,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var C=Math.log(2)*O.toJSNumber(),k=Math.ceil(g===!0?2*Math.pow(C,2):C),$=[],j=0;j<k;j++)$.push(e(j+2));return Fe(A,$)},S.prototype.isPrime=d.prototype.isPrime=p.prototype.isPrime,p.prototype.isProbablePrime=function(g,b){var A=Ze(this);if(A!==t)return A;for(var O=this.abs(),C=g===t?5:g,k=[],$=0;$<C;$++)k.push(e.randBetween(2,O.minus(2),b));return Fe(O,k)},S.prototype.isProbablePrime=d.prototype.isProbablePrime=p.prototype.isProbablePrime,p.prototype.modInv=function(g){for(var b=e.zero,A=e.one,O=Te(g),C=this.abs(),k,$,j;!C.isZero();)k=O.divide(C),$=b,j=O,b=A,O=C,A=$.subtract(k.multiply(A)),C=j.subtract(k.multiply(C));if(!O.isUnit())throw new Error(this.toString()+" and "+g.toString()+" are not co-prime");return b.compare(0)===-1&&(b=b.add(g)),this.isNegative()?b.negate():b},S.prototype.modInv=d.prototype.modInv=p.prototype.modInv,p.prototype.next=function(){var g=this.value;return this.sign?tt(g,1,this.sign):new p(Xe(g,1),this.sign)},d.prototype.next=function(){var g=this.value;return g+1<i?new d(g+1):new p(l,!1)},S.prototype.next=function(){return new S(this.value+BigInt(1))},p.prototype.prev=function(){var g=this.value;return this.sign?new p(Xe(g,1),!0):tt(g,1,this.sign)},d.prototype.prev=function(){var g=this.value;return g-1>-9007199254740992?new d(g-1):new p(l,!0)},S.prototype.prev=function(){return new S(this.value-BigInt(1))};for(var it=[1];2*it[it.length-1]<=r;)it.push(2*it[it.length-1]);var _t=it.length,Rt=it[_t-1];function Fr(g){return Math.abs(g)<=r}p.prototype.shiftLeft=function(g){var b=Te(g).toJSNumber();if(!Fr(b))throw new Error(String(b)+" is too large for shifting.");if(b<0)return this.shiftRight(-b);var A=this;if(A.isZero())return A;for(;b>=_t;)A=A.multiply(Rt),b-=_t-1;return A.multiply(it[b])},S.prototype.shiftLeft=d.prototype.shiftLeft=p.prototype.shiftLeft,p.prototype.shiftRight=function(g){var b,A=Te(g).toJSNumber();if(!Fr(A))throw new Error(String(A)+" is too large for shifting.");if(A<0)return this.shiftLeft(-A);for(var O=this;A>=_t;){if(O.isZero()||O.isNegative()&&O.isUnit())return O;b=Ne(O,Rt),O=b[1].isNegative()?b[0].prev():b[0],A-=_t-1}return b=Ne(O,it[A]),b[1].isNegative()?b[0].prev():b[0]},S.prototype.shiftRight=d.prototype.shiftRight=p.prototype.shiftRight;function Ye(g,b,A){b=Te(b);for(var O=g.isNegative(),C=b.isNegative(),k=O?g.not():g,$=C?b.not():b,j=0,Z=0,ve=null,Re=null,xe=[];!k.isZero()||!$.isZero();)ve=Ne(k,Rt),j=ve[1].toJSNumber(),O&&(j=Rt-1-j),Re=Ne($,Rt),Z=Re[1].toJSNumber(),C&&(Z=Rt-1-Z),k=ve[0],$=Re[0],xe.push(A(j,Z));for(var ke=A(O?1:0,C?1:0)!==0?e(-1):e(0),At=xe.length-1;At>=0;At-=1)ke=ke.multiply(Rt).add(e(xe[At]));return ke}p.prototype.not=function(){return this.negate().prev()},S.prototype.not=d.prototype.not=p.prototype.not,p.prototype.and=function(g){return Ye(this,g,function(b,A){return b&A})},S.prototype.and=d.prototype.and=p.prototype.and,p.prototype.or=function(g){return Ye(this,g,function(b,A){return b|A})},S.prototype.or=d.prototype.or=p.prototype.or,p.prototype.xor=function(g){return Ye(this,g,function(b,A){return b^A})},S.prototype.xor=d.prototype.xor=p.prototype.xor;var yt=1<<30,Un=(r&-1e7)*(r&-1e7)|yt;function ht(g){var b=g.value,A=typeof b=="number"?b|yt:typeof b=="bigint"?b|BigInt(yt):b[0]+b[1]*r|Un;return A&-A}function mr(g,b){if(b.compareTo(g)<=0){var A=mr(g,b.square(b)),O=A.p,C=A.e,k=O.multiply(b);return k.compareTo(g)<=0?{p:k,e:C*2+1}:{p:O,e:C*2}}return{p:e(1),e:0}}p.prototype.bitLength=function(){var g=this;return g.compareTo(e(0))<0&&(g=g.negate().subtract(e(1))),g.compareTo(e(0))===0?e(0):e(mr(g,e(2)).e).add(e(1))},S.prototype.bitLength=d.prototype.bitLength=p.prototype.bitLength;function yr(g,b){return g=Te(g),b=Te(b),g.greater(b)?g:b}function vr(g,b){return g=Te(g),b=Te(b),g.lesser(b)?g:b}function br(g,b){if(g=Te(g).abs(),b=Te(b).abs(),g.equals(b))return g;if(g.isZero())return b;if(b.isZero())return g;for(var A=f[1],O,C;g.isEven()&&b.isEven();)O=vr(ht(g),ht(b)),g=g.divide(O),b=b.divide(O),A=A.multiply(O);for(;g.isEven();)g=g.divide(ht(g));do{for(;b.isEven();)b=b.divide(ht(b));g.greater(b)&&(C=b,b=g,g=C),b=b.subtract(g)}while(!b.isZero());return A.isUnit()?g:g.multiply(A)}function _r(g,b){return g=Te(g).abs(),b=Te(b).abs(),g.divide(br(g,b)).multiply(b)}function Er(g,b,A){g=Te(g),b=Te(b);var O=A||Math.random,C=vr(g,b),k=yr(g,b),$=k.subtract(C).add(1);if($.isSmall)return C.add(Math.floor(O()*$));for(var j=Et($,r).value,Z=[],ve=!0,Re=0;Re<j.length;Re++){var xe=ve?j[Re]+(Re+1<j.length?j[Re+1]/r:0):r,ke=fe(O()*xe);Z.push(ke),ke<j[Re]&&(ve=!1)}return C.add(f.fromArray(Z,r,!1))}var $n=function(g,b,A,O){A=A||c,g=String(g),O||(g=g.toLowerCase(),A=A.toLowerCase());var C=g.length,k,$=Math.abs(b),j={};for(k=0;k<A.length;k++)j[A[k]]=k;for(k=0;k<C;k++){var Z=g[k];if(Z!=="-"&&Z in j&&j[Z]>=$){if(Z==="1"&&$===1)continue;throw new Error(Z+" is not a valid digit in base "+b+".")}}b=Te(b);var ve=[],Re=g[0]==="-";for(k=Re?1:0;k<g.length;k++){var Z=g[k];if(Z in j)ve.push(Te(j[Z]));else if(Z==="<"){var xe=k;do k++;while(g[k]!==">"&&k<g.length);ve.push(Te(g.slice(xe+1,k)))}else throw new Error(Z+" is not a valid character")}return wr(ve,b,Re)};function wr(g,b,A){var O=f[0],C=f[1],k;for(k=g.length-1;k>=0;k--)O=O.add(g[k].times(C)),C=C.times(b);return A?O.negate():O}function Wn(g,b){return b=b||c,g<b.length?b[g]:"<"+g+">"}function Et(g,b){if(b=e(b),b.isZero()){if(g.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(b.equals(-1)){if(g.isZero())return{value:[0],isNegative:!1};if(g.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-g.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var A=Array.apply(null,Array(g.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return A.unshift([1]),{value:[].concat.apply([],A),isNegative:!1}}var O=!1;if(g.isNegative()&&b.isPositive()&&(O=!0,g=g.abs()),b.isUnit())return g.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(g.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:O};for(var C=[],k=g,$;k.isNegative()||k.compareAbs(b)>=0;){$=k.divmod(b),k=$.quotient;var j=$.remainder;j.isNegative()&&(j=b.minus(j).abs(),k=k.next()),C.push(j.toJSNumber())}return C.push(k.toJSNumber()),{value:C.reverse(),isNegative:O}}function dn(g,b,A){var O=Et(g,b);return(O.isNegative?"-":"")+O.value.map(function(C){return Wn(C,A)}).join("")}p.prototype.toArray=function(g){return Et(this,g)},d.prototype.toArray=function(g){return Et(this,g)},S.prototype.toArray=function(g){return Et(this,g)},p.prototype.toString=function(g,b){if(g===t&&(g=10),g!==10||b)return dn(this,g,b);for(var A=this.value,O=A.length,C=String(A[--O]),k="0000000",$;--O>=0;)$=String(A[O]),C+=k.slice($.length)+$;var j=this.sign?"-":"";return j+C},d.prototype.toString=function(g,b){return g===t&&(g=10),g!=10||b?dn(this,g,b):String(this.value)},S.prototype.toString=d.prototype.toString,S.prototype.toJSON=p.prototype.toJSON=d.prototype.toJSON=function(){return this.toString()},p.prototype.valueOf=function(){return parseInt(this.toString(),10)},p.prototype.toJSNumber=p.prototype.valueOf,d.prototype.valueOf=function(){return this.value},d.prototype.toJSNumber=d.prototype.valueOf,S.prototype.valueOf=S.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function Sr(g){if(M(+g)){var b=+g;if(b===fe(b))return h?new S(BigInt(b)):new d(b);throw new Error("Invalid integer: "+g)}var A=g[0]==="-";A&&(g=g.slice(1));var O=g.split(/e/i);if(O.length>2)throw new Error("Invalid integer: "+O.join("e"));if(O.length===2){var C=O[1];if(C[0]==="+"&&(C=C.slice(1)),C=+C,C!==fe(C)||!M(C))throw new Error("Invalid integer: "+C+" is not a valid exponent.");var k=O[0],$=k.indexOf(".");if($>=0&&(C-=k.length-$-1,k=k.slice(0,$)+k.slice($+1)),C<0)throw new Error("Cannot include negative exponent part for integers");k+=new Array(C+1).join("0"),g=k}var j=/^([0-9][0-9]*)$/.test(g);if(!j)throw new Error("Invalid integer: "+g);if(h)return new S(BigInt(A?"-"+g:g));for(var Z=[],ve=g.length,Re=s,xe=ve-Re;ve>0;)Z.push(+g.slice(xe,ve)),xe-=Re,xe<0&&(xe=0),ve-=Re;return H(Z),new p(Z,A)}function qn(g){if(h)return new S(BigInt(g));if(M(g)){if(g!==fe(g))throw new Error(g+" is not an integer.");return new d(g)}return Sr(g.toString())}function Te(g){return typeof g=="number"?qn(g):typeof g=="string"?Sr(g):typeof g=="bigint"?new S(g):g}for(var Kt=0;Kt<1e3;Kt++)f[Kt]=Te(Kt),Kt>0&&(f[-Kt]=Te(-Kt));return f.one=f[1],f.zero=f[0],f.minusOne=f[-1],f.max=yr,f.min=vr,f.gcd=br,f.lcm=_r,f.isInstance=function(g){return g instanceof p||g instanceof d||g instanceof S},f.randBetween=Er,f.fromArray=function(g,b,A){return wr(g.map(Te),Te(b||10),A)},f}();n.hasOwnProperty("exports")&&(n.exports=e)}(na)),na.exports}var Fu=Vu(),tl=Pa(Fu);const nl=64,_a=16,sr=nl/_a;function ju(){try{return!0}catch{return!1}}function Hu(n,e,t){let r=0;for(let s=0;s<t;s++){const i=n[e+s];if(i===void 0)break;r+=i*16**s}return r}function rl(n){const e=[];for(let t=0;t<n.length;t++){let r=Number(n[t]);for(let s=0;r||s<e.length;s++)r+=(e[s]||0)*10,e[s]=r%16,r=(r-e[s])/16}return e}function Gu(n){const e=rl(n),t=Array(sr);for(let r=0;r<sr;r++)t[sr-1-r]=Hu(e,r*sr,sr);return t}class xn{static fromString(e){return new xn(Gu(e),e)}static fromBit(e){const t=Array(sr),r=Math.floor(e/_a);for(let s=0;s<sr;s++)t[sr-1-s]=s===r?1<<e-r*_a:0;return new xn(t)}constructor(e,t){this.parts=e,this.str=t}and({parts:e}){return new xn(this.parts.map((t,r)=>t&e[r]))}or({parts:e}){return new xn(this.parts.map((t,r)=>t|e[r]))}xor({parts:e}){return new xn(this.parts.map((t,r)=>t^e[r]))}not(){return new xn(this.parts.map(e=>~e))}equals({parts:e}){return this.parts.every((t,r)=>t===e[r])}toString(){if(this.str!=null)return this.str;const e=new Array(nl/4);return this.parts.forEach((t,r)=>{const s=rl(t.toString());for(let i=0;i<4;i++)e[i+r*4]=s[3-i]||0}),this.str=tl.fromArray(e,16).toString()}toJSON(){return this.toString()}}const gr=ju();gr&&BigInt.prototype.toJSON==null&&(BigInt.prototype.toJSON=function(){return this.toString()});const oi={},sl=gr?function(e){return BigInt(e)}:function(e){return e instanceof xn?e:(typeof e=="number"&&(e=e.toString()),oi[e]!=null||(oi[e]=xn.fromString(e)),oi[e])},kt=sl(0),Ri=gr?function(e=kt,t=kt){return e&t}:function(e=kt,t=kt){return e.and(t)},il=gr?function(e=kt,t=kt){return e|t}:function(e=kt,t=kt){return e.or(t)},Zu=gr?function(e=kt,t=kt){return e^t}:function(e=kt,t=kt){return e.xor(t)},zu=gr?function(e=kt){return~e}:function(e=kt){return e.not()},Ma=gr?function(e,t){return e===t}:function(e,t){return e==null||t==null?e==t:e.equals(t)};function Ku(...n){let e=n[0];for(let t=1;t<n.length;t++)e=il(e,n[t]);return e}function Wu(n,e){return Ma(Ri(n,e),e)}function qu(n,e){return!Ma(Ri(n,e),kt)}function Yu(n,e){return e===kt?n:il(n,e)}function Xu(n,e){return e===kt?n:Zu(n,Ri(n,e))}const Ju=gr?function(e){return BigInt(1)<<BigInt(e)}:function(e){return xn.fromBit(e)};var Ae={combine:Ku,add:Yu,remove:Xu,filter:Ri,invert:zu,has:Wu,hasAny:qu,equals:Ma,deserialize:sl,getFlag:Ju},fo;(function(n){n[n.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",n[n.CLOSE_UNSUPPORTED=1003]="CLOSE_UNSUPPORTED",n[n.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",n[n.INVALID_CLIENTID=4e3]="INVALID_CLIENTID",n[n.INVALID_ORIGIN=4001]="INVALID_ORIGIN",n[n.RATELIMITED=4002]="RATELIMITED",n[n.TOKEN_REVOKED=4003]="TOKEN_REVOKED",n[n.INVALID_VERSION=4004]="INVALID_VERSION",n[n.INVALID_ENCODING=4005]="INVALID_ENCODING"})(fo||(fo={}));var Ea;(function(n){n[n.INVALID_PAYLOAD=4e3]="INVALID_PAYLOAD",n[n.INVALID_COMMAND=4002]="INVALID_COMMAND",n[n.INVALID_EVENT=4004]="INVALID_EVENT",n[n.INVALID_PERMISSIONS=4006]="INVALID_PERMISSIONS"})(Ea||(Ea={}));var wa;(function(n){n.LANDSCAPE="landscape",n.PORTRAIT="portrait"})(wa||(wa={}));var Dn;(function(n){n.MOBILE="mobile",n.DESKTOP="desktop"})(Dn||(Dn={}));Object.freeze({CREATE_INSTANT_INVITE:Ae.getFlag(0),KICK_MEMBERS:Ae.getFlag(1),BAN_MEMBERS:Ae.getFlag(2),ADMINISTRATOR:Ae.getFlag(3),MANAGE_CHANNELS:Ae.getFlag(4),MANAGE_GUILD:Ae.getFlag(5),ADD_REACTIONS:Ae.getFlag(6),VIEW_AUDIT_LOG:Ae.getFlag(7),PRIORITY_SPEAKER:Ae.getFlag(8),STREAM:Ae.getFlag(9),VIEW_CHANNEL:Ae.getFlag(10),SEND_MESSAGES:Ae.getFlag(11),SEND_TTS_MESSAGES:Ae.getFlag(12),MANAGE_MESSAGES:Ae.getFlag(13),EMBED_LINKS:Ae.getFlag(14),ATTACH_FILES:Ae.getFlag(15),READ_MESSAGE_HISTORY:Ae.getFlag(16),MENTION_EVERYONE:Ae.getFlag(17),USE_EXTERNAL_EMOJIS:Ae.getFlag(18),VIEW_GUILD_INSIGHTS:Ae.getFlag(19),CONNECT:Ae.getFlag(20),SPEAK:Ae.getFlag(21),MUTE_MEMBERS:Ae.getFlag(22),DEAFEN_MEMBERS:Ae.getFlag(23),MOVE_MEMBERS:Ae.getFlag(24),USE_VAD:Ae.getFlag(25),CHANGE_NICKNAME:Ae.getFlag(26),MANAGE_NICKNAMES:Ae.getFlag(27),MANAGE_ROLES:Ae.getFlag(28),MANAGE_WEBHOOKS:Ae.getFlag(29),MANAGE_GUILD_EXPRESSIONS:Ae.getFlag(30),USE_APPLICATION_COMMANDS:Ae.getFlag(31),REQUEST_TO_SPEAK:Ae.getFlag(32),MANAGE_EVENTS:Ae.getFlag(33),MANAGE_THREADS:Ae.getFlag(34),CREATE_PUBLIC_THREADS:Ae.getFlag(35),CREATE_PRIVATE_THREADS:Ae.getFlag(36),USE_EXTERNAL_STICKERS:Ae.getFlag(37),SEND_MESSAGES_IN_THREADS:Ae.getFlag(38),USE_EMBEDDED_ACTIVITIES:Ae.getFlag(39),MODERATE_MEMBERS:Ae.getFlag(40),VIEW_CREATOR_MONETIZATION_ANALYTICS:Ae.getFlag(41),USE_SOUNDBOARD:Ae.getFlag(42),CREATE_GUILD_EXPRESSIONS:Ae.getFlag(43),CREATE_EVENTS:Ae.getFlag(44),USE_EXTERNAL_SOUNDS:Ae.getFlag(45),SEND_VOICE_MESSAGES:Ae.getFlag(46),SEND_POLLS:Ae.getFlag(49),USE_EXTERNAL_APPS:Ae.getFlag(50)});const ho=-1,Qu=250;function Ut(n){return el(e=>{var t;const[r]=(t=Object.entries(n).find(([,s])=>s===e))!==null&&t!==void 0?t:[];return e!=null&&r===void 0?n.UNHANDLED:e},I().or(Ee()))}function al(n){const e=La().transform(t=>{const r=n.safeParse(t);return r.success?r.data:n._def.defaultValue()});return e.overlayType=n,e}const ef=se.object({image_url:se.string()}),tf=se.object({mediaUrl:se.string().max(1024)}),nf=se.object({access_token:se.union([se.string(),se.null()]).optional()}),ol=se.object({access_token:se.string(),user:se.object({username:se.string(),discriminator:se.string(),id:se.string(),avatar:se.union([se.string(),se.null()]).optional(),public_flags:se.number(),global_name:se.union([se.string(),se.null()]).optional()}),scopes:se.array(al(se.enum(["identify","email","connections","guilds","guilds.join","guilds.members.read","guilds.channels.read","gdm.join","bot","rpc","rpc.notifications.read","rpc.voice.read","rpc.voice.write","rpc.video.read","rpc.video.write","rpc.screenshare.read","rpc.screenshare.write","rpc.activities.write","webhook.incoming","messages.read","applications.builds.upload","applications.builds.read","applications.commands","applications.commands.permissions.update","applications.commands.update","applications.store.update","applications.entitlements","activities.read","activities.write","relationships.read","relationships.write","voice","dm_channels.read","role_connections.write","presences.read","presences.write","openid","dm_channels.messages.read","dm_channels.messages.write","gateway.connect","account.global_name.update","payment_sources.country_code","sdk.social_layer"]).or(se.literal(-1)).default(-1))),expires:se.string(),application:se.object({description:se.string(),icon:se.union([se.string(),se.null()]).optional(),id:se.string(),rpc_origins:se.array(se.string()).optional(),name:se.string()})}),ll=se.object({participants:se.array(se.object({id:se.string(),username:se.string(),global_name:se.union([se.string(),se.null()]).optional(),discriminator:se.string(),avatar:se.union([se.string(),se.null()]).optional(),flags:se.number(),bot:se.boolean(),avatar_decoration_data:se.union([se.object({asset:se.string(),skuId:se.string().optional()}),se.null()]).optional(),premium_type:se.union([se.number(),se.null()]).optional(),nickname:se.string().optional()}))}),rf=se.object({command:se.string(),content:se.string().max(2e3).optional(),preview_image:se.object({height:se.number(),url:se.string(),width:se.number()}).optional(),components:se.array(se.object({type:se.literal(1),components:se.array(se.object({type:se.literal(2),style:se.number().gte(1).lte(5),label:se.string().max(80).optional(),custom_id:se.string().max(100).describe("Developer-defined identifier for the button; max 100 characters").optional()})).max(5).optional()})).optional()}),sf=se.object({referrer_id:se.string().max(64).optional(),custom_id:se.string().max(64).optional(),message:se.string().max(1e3)}),af=se.object({success:se.boolean()});var Xt;(function(n){n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.AUTHENTICATE="AUTHENTICATE",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS",n.SHARE_INTERACTION="SHARE_INTERACTION",n.SHARE_LINK="SHARE_LINK"})(Xt||(Xt={}));const po=se.object({}).optional().nullable(),go=se.void(),cl={[Xt.INITIATE_IMAGE_UPLOAD]:{request:go,response:ef},[Xt.OPEN_SHARE_MOMENT_DIALOG]:{request:tf,response:po},[Xt.AUTHENTICATE]:{request:nf,response:ol},[Xt.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS]:{request:go,response:ll},[Xt.SHARE_INTERACTION]:{request:rf,response:po},[Xt.SHARE_LINK]:{request:sf,response:af}},of="DISPATCH";var we;(function(n){n.AUTHORIZE="AUTHORIZE",n.AUTHENTICATE="AUTHENTICATE",n.GET_GUILDS="GET_GUILDS",n.GET_GUILD="GET_GUILD",n.GET_CHANNEL="GET_CHANNEL",n.GET_CHANNELS="GET_CHANNELS",n.SELECT_VOICE_CHANNEL="SELECT_VOICE_CHANNEL",n.SELECT_TEXT_CHANNEL="SELECT_TEXT_CHANNEL",n.SUBSCRIBE="SUBSCRIBE",n.UNSUBSCRIBE="UNSUBSCRIBE",n.CAPTURE_SHORTCUT="CAPTURE_SHORTCUT",n.SET_CERTIFIED_DEVICES="SET_CERTIFIED_DEVICES",n.SET_ACTIVITY="SET_ACTIVITY",n.GET_SKUS="GET_SKUS",n.GET_ENTITLEMENTS="GET_ENTITLEMENTS",n.GET_SKUS_EMBEDDED="GET_SKUS_EMBEDDED",n.GET_ENTITLEMENTS_EMBEDDED="GET_ENTITLEMENTS_EMBEDDED",n.START_PURCHASE="START_PURCHASE",n.SET_CONFIG="SET_CONFIG",n.SEND_ANALYTICS_EVENT="SEND_ANALYTICS_EVENT",n.USER_SETTINGS_GET_LOCALE="USER_SETTINGS_GET_LOCALE",n.OPEN_EXTERNAL_LINK="OPEN_EXTERNAL_LINK",n.ENCOURAGE_HW_ACCELERATION="ENCOURAGE_HW_ACCELERATION",n.CAPTURE_LOG="CAPTURE_LOG",n.SET_ORIENTATION_LOCK_STATE="SET_ORIENTATION_LOCK_STATE",n.OPEN_INVITE_DIALOG="OPEN_INVITE_DIALOG",n.GET_PLATFORM_BEHAVIORS="GET_PLATFORM_BEHAVIORS",n.GET_CHANNEL_PERMISSIONS="GET_CHANNEL_PERMISSIONS",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS",n.SHARE_LINK="SHARE_LINK"})(we||(we={}));const ls=re({cmd:I(),data:Ps(),evt:Ni(),nonce:I()}).passthrough(),lf=Object.assign(Object.assign({},ol.shape.scopes.element.overlayType._def.innerType.options[0].Values),{UNHANDLED:-1});Ut(lf);const hr=re({id:I(),username:I(),discriminator:I(),global_name:I().optional().nullable(),avatar:I().optional().nullable(),avatar_decoration_data:re({asset:I(),sku_id:I().optional()}).nullable(),bot:De(),flags:Ee().optional().nullable(),premium_type:Ee().optional().nullable()}),Ca=re({user:hr,nick:I().optional().nullable(),roles:We(I()),joined_at:I(),deaf:De(),mute:De()}),cf=re({user_id:I(),nick:I().optional().nullable(),guild_id:I(),avatar:I().optional().nullable(),avatar_decoration_data:re({asset:I(),sku_id:I().optional().nullable()}).optional().nullable(),color_string:I().optional().nullable()}),Ua=re({id:I(),name:I().optional().nullable(),roles:We(I()).optional().nullable(),user:hr.optional().nullable(),require_colons:De().optional().nullable(),managed:De().optional().nullable(),animated:De().optional().nullable(),available:De().optional().nullable()}),ul=re({mute:De(),deaf:De(),self_mute:De(),self_deaf:De(),suppress:De()}),fl=re({mute:De(),nick:I(),user:hr,voice_state:ul,volume:Ee()}),uf={UNHANDLED:-1,IDLE:"idle",DND:"dnd",ONLINE:"online",OFFLINE:"offline"},li=Ut(uf),ys=re({name:I(),type:Ee(),url:I().optional().nullable(),created_at:Ee().optional().nullable(),timestamps:re({start:Ee(),end:Ee()}).partial().optional().nullable(),application_id:I().optional().nullable(),details:I().optional().nullable(),state:I().optional().nullable(),emoji:Ua.optional().nullable(),party:re({id:I().optional().nullable(),size:We(Ee()).optional().nullable()}).optional().nullable(),assets:re({large_image:I().nullable(),large_text:I().nullable(),small_image:I().nullable(),small_text:I().nullable()}).partial().optional().nullable(),secrets:re({join:I(),match:I()}).partial().optional().nullable(),instance:De().optional().nullable(),flags:Ee().optional().nullable()}),ff={UNHANDLED:-1,ROLE:0,MEMBER:1},df=re({id:I(),type:Ut(ff),allow:I(),deny:I()}),$a={UNHANDLED:-1,DM:1,GROUP_DM:3,GUILD_TEXT:0,GUILD_VOICE:2,GUILD_CATEGORY:4,GUILD_ANNOUNCEMENT:5,GUILD_STORE:6,ANNOUNCEMENT_THREAD:10,PUBLIC_THREAD:11,PRIVATE_THREAD:12,GUILD_STAGE_VOICE:13,GUILD_DIRECTORY:14,GUILD_FORUM:15},dl=re({id:I(),type:Ut($a),guild_id:I().optional().nullable(),position:Ee().optional().nullable(),permission_overwrites:We(df).optional().nullable(),name:I().optional().nullable(),topic:I().optional().nullable(),nsfw:De().optional().nullable(),last_message_id:I().optional().nullable(),bitrate:Ee().optional().nullable(),user_limit:Ee().optional().nullable(),rate_limit_per_user:Ee().optional().nullable(),recipients:We(hr).optional().nullable(),icon:I().optional().nullable(),owner_id:I().optional().nullable(),application_id:I().optional().nullable(),parent_id:I().optional().nullable(),last_pin_timestamp:I().optional().nullable()}),hf=re({user:hr,guild_id:I(),status:li,activities:We(ys),client_status:re({desktop:li,mobile:li,web:li}).partial()}),pf=re({id:I(),name:I(),color:Ee(),hoist:De(),position:Ee(),permissions:I(),managed:De(),mentionable:De()});re({id:I(),name:I(),owner_id:I(),icon:I().nullable(),icon_hash:I().optional().nullable(),splash:I().nullable(),discovery_splash:I().nullable(),owner:De().optional().nullable(),permissions:I().optional().nullable(),region:I(),afk_channel_id:I().nullable(),afk_timeout:Ee(),widget_enabled:De().optional().nullable(),widget_channel_id:I().optional().nullable(),verification_level:Ee(),default_message_notifications:Ee(),explicit_content_filter:Ee(),roles:We(pf),emojis:We(Ua),features:We(I()),mfa_level:Ee(),application_id:I().nullable(),system_channel_id:I().nullable(),system_channel_flags:Ee(),rules_channel_id:I().nullable(),joined_at:I().optional().nullable(),large:De().optional().nullable(),unavailable:De().optional().nullable(),member_count:Ee().optional().nullable(),voice_states:We(ul).optional().nullable(),members:We(Ca).optional().nullable(),channels:We(dl).optional().nullable(),presences:We(hf).optional().nullable(),max_presences:Ee().optional().nullable(),max_members:Ee().optional().nullable(),vanity_url_code:I().nullable(),description:I().nullable(),banner:I().nullable(),premium_tier:Ee(),premium_subscription_count:Ee().optional().nullable(),preferred_locale:I(),public_updates_channel_id:I().nullable(),max_video_channel_users:Ee().optional().nullable(),approximate_member_count:Ee().optional().nullable(),approximate_presence_count:Ee().optional().nullable()});const gf=re({id:I(),guild_id:I(),type:Ee(),name:I()}),mf=re({id:I(),filename:I(),size:Ee(),url:I(),proxy_url:I(),height:Ee().optional().nullable(),width:Ee().optional().nullable()}),yf=re({text:I(),icon_url:I().optional().nullable(),proxy_icon_url:I().optional().nullable()}),Sa=re({url:I().optional().nullable(),proxy_url:I().optional().nullable(),height:Ee().optional().nullable(),width:Ee().optional().nullable()}),vf=Sa.omit({proxy_url:!0}),bf=re({name:I().optional().nullable(),url:I().optional().nullable()}),_f=re({name:I().optional().nullable(),url:I().optional().nullable(),icon_url:I().optional().nullable(),proxy_icon_url:I().optional().nullable()}),Ef=re({name:I(),value:I(),inline:De()}),wf=re({title:I().optional().nullable(),type:I().optional().nullable(),description:I().optional().nullable(),url:I().optional().nullable(),timestamp:I().optional().nullable(),color:Ee().optional().nullable(),footer:yf.optional().nullable(),image:Sa.optional().nullable(),thumbnail:Sa.optional().nullable(),video:vf.optional().nullable(),provider:bf.optional().nullable(),author:_f.optional().nullable(),fields:We(Ef).optional().nullable()}),Sf=re({count:Ee(),me:De(),emoji:Ua}),Tf=re({type:Ee(),party_id:I().optional().nullable()}),Af=re({id:I(),cover_image:I().optional().nullable(),description:I(),icon:I().optional().nullable(),name:I()}),If=re({message_id:I().optional().nullable(),channel_id:I().optional().nullable(),guild_id:I().optional().nullable()}),Of=re({id:I(),channel_id:I(),guild_id:I().optional().nullable(),author:hr.optional().nullable(),member:Ca.optional().nullable(),content:I(),timestamp:I(),edited_timestamp:I().optional().nullable(),tts:De(),mention_everyone:De(),mentions:We(hr),mention_roles:We(I()),mention_channels:We(gf),attachments:We(mf),embeds:We(wf),reactions:We(Sf).optional().nullable(),nonce:Ba([I(),Ee()]).optional().nullable(),pinned:De(),webhook_id:I().optional().nullable(),type:Ee(),activity:Tf.optional().nullable(),application:Af.optional().nullable(),message_reference:If.optional().nullable(),flags:Ee().optional().nullable(),stickers:We(Ps()).optional().nullable(),referenced_message:Ps().optional().nullable()}),xf=re({id:I(),name:I()}),Df={UNHANDLED:-1,KEYBOARD_KEY:0,MOUSE_BUTTON:1,KEYBOARD_MODIFIER_KEY:2,GAMEPAD_BUTTON:3},hl=re({type:Ut(Df),code:Ee(),name:I()}),Nf={UNHANDLED:-1,PUSH_TO_TALK:"PUSH_TO_TALK",VOICE_ACTIVITY:"VOICE_ACTIVITY"},Rf=re({type:Ut(Nf),auto_threshold:De(),threshold:Ee(),shortcut:We(hl),delay:Ee()}),mo=re({device_id:I(),volume:Ee(),available_devices:We(xf)}),Pf={UNHANDLED:-1,AUDIO_INPUT:"AUDIO_INPUT",AUDIO_OUTPUT:"AUDIO_OUTPUT",VIDEO_INPUT:"VIDEO_INPUT"};re({type:Ut(Pf),id:I(),vendor:re({name:I(),url:I()}),model:re({name:I(),url:I()}),related:We(I()),echo_cancellation:De().optional().nullable(),noise_suppression:De().optional().nullable(),automatic_gain_control:De().optional().nullable(),hardware_mute:De().optional().nullable()});const kf={UNHANDLED:-1,APPLICATION:1,DLC:2,CONSUMABLE:3,BUNDLE:4,SUBSCRIPTION:5},Lf=re({id:I(),name:I(),type:Ut(kf),price:re({amount:Ee(),currency:I()}),application_id:I(),flags:Ee(),release_date:I().nullable()}),Bf={UNHANDLED:-1,PURCHASE:1,PREMIUM_SUBSCRIPTION:2,DEVELOPER_GIFT:3,TEST_MODE_PURCHASE:4,FREE_PURCHASE:5,USER_GIFT:6,PREMIUM_PURCHASE:7},Va=re({id:I(),sku_id:I(),application_id:I(),user_id:I(),gift_code_flags:Ee(),type:Ut(Bf),gifter_user_id:I().optional().nullable(),branches:We(I()).optional().nullable(),starts_at:I().optional().nullable(),ends_at:I().optional().nullable(),parent_id:I().optional().nullable(),consumed:De().optional().nullable(),deleted:De().optional().nullable(),gift_code_batch_id:I().optional().nullable()}),Mf={UNHANDLED:-1,UNLOCKED:1,PORTRAIT:2,LANDSCAPE:3};Ut(Mf);const Cf={UNHANDLED:-1,NOMINAL:0,FAIR:1,SERIOUS:2,CRITICAL:3},Uf=Ut(Cf),pl={UNHANDLED:-1,PORTRAIT:0,LANDSCAPE:1};Ut(pl);const gl={UNHANDLED:-1,FOCUSED:0,PIP:1,GRID:2};Ut(gl);const Fa="ERROR";var et;(function(n){n.READY="READY",n.VOICE_STATE_UPDATE="VOICE_STATE_UPDATE",n.SPEAKING_START="SPEAKING_START",n.SPEAKING_STOP="SPEAKING_STOP",n.ACTIVITY_LAYOUT_MODE_UPDATE="ACTIVITY_LAYOUT_MODE_UPDATE",n.ORIENTATION_UPDATE="ORIENTATION_UPDATE",n.CURRENT_USER_UPDATE="CURRENT_USER_UPDATE",n.CURRENT_GUILD_MEMBER_UPDATE="CURRENT_GUILD_MEMBER_UPDATE",n.ENTITLEMENT_CREATE="ENTITLEMENT_CREATE",n.THERMAL_STATE_UPDATE="THERMAL_STATE_UPDATE",n.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE="ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE"})(et||(et={}));const Yt=ls.extend({evt:os(et),nonce:I().nullable(),cmd:Tt(of),data:re({}).passthrough()}),ml=ls.extend({evt:Tt(Fa),data:re({code:Ee(),message:I().optional()}).passthrough(),cmd:os(we),nonce:I().nullable()}),$f=Yt.extend({evt:I()}),Vf=Ba([Yt,$f,ml]);function Ff(n){const e=n.evt;if(!(e in et))throw new Error(`Unrecognized event type ${n.evt}`);return jf[e].payload.parse(n)}const jf={[et.READY]:{payload:Yt.extend({evt:Tt(et.READY),data:re({v:Ee(),config:re({cdn_host:I().optional(),api_endpoint:I(),environment:I()}),user:re({id:I(),username:I(),discriminator:I(),avatar:I().optional()}).optional()})})},[et.VOICE_STATE_UPDATE]:{payload:Yt.extend({evt:Tt(et.VOICE_STATE_UPDATE),data:fl}),subscribeArgs:re({channel_id:I()})},[et.SPEAKING_START]:{payload:Yt.extend({evt:Tt(et.SPEAKING_START),data:re({lobby_id:I().optional(),channel_id:I().optional(),user_id:I()})}),subscribeArgs:re({lobby_id:I().nullable().optional(),channel_id:I().nullable().optional()})},[et.SPEAKING_STOP]:{payload:Yt.extend({evt:Tt(et.SPEAKING_STOP),data:re({lobby_id:I().optional(),channel_id:I().optional(),user_id:I()})}),subscribeArgs:re({lobby_id:I().nullable().optional(),channel_id:I().nullable().optional()})},[et.ACTIVITY_LAYOUT_MODE_UPDATE]:{payload:Yt.extend({evt:Tt(et.ACTIVITY_LAYOUT_MODE_UPDATE),data:re({layout_mode:Ut(gl)})})},[et.ORIENTATION_UPDATE]:{payload:Yt.extend({evt:Tt(et.ORIENTATION_UPDATE),data:re({screen_orientation:Ut(pl),orientation:os(wa)})})},[et.CURRENT_USER_UPDATE]:{payload:Yt.extend({evt:Tt(et.CURRENT_USER_UPDATE),data:hr})},[et.CURRENT_GUILD_MEMBER_UPDATE]:{payload:Yt.extend({evt:Tt(et.CURRENT_GUILD_MEMBER_UPDATE),data:cf}),subscribeArgs:re({guild_id:I()})},[et.ENTITLEMENT_CREATE]:{payload:Yt.extend({evt:Tt(et.ENTITLEMENT_CREATE),data:re({entitlement:Va})})},[et.THERMAL_STATE_UPDATE]:{payload:Yt.extend({evt:Tt(et.THERMAL_STATE_UPDATE),data:re({thermal_state:Uf})})},[et.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE]:{payload:Yt.extend({evt:Tt(et.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE),data:re({participants:ll.shape.participants})})}};function Hf(n,e){throw e}const Pi=re({}).nullable(),yl=re({code:I()}),Gf=re({guilds:We(re({id:I(),name:I()}))}),Zf=re({id:I(),name:I(),icon_url:I().optional(),members:We(Ca)}),is=re({id:I(),type:Ut($a),guild_id:I().optional().nullable(),name:I().optional().nullable(),topic:I().optional().nullable(),bitrate:Ee().optional().nullable(),user_limit:Ee().optional().nullable(),position:Ee().optional().nullable(),voice_states:We(fl),messages:We(Of)}),zf=re({channels:We(dl)});is.nullable();const Kf=is.nullable(),Wf=is.nullable();re({input:mo,output:mo,mode:Rf,automatic_gain_control:De(),echo_cancellation:De(),noise_suppression:De(),qos:De(),silence_warning:De(),deaf:De(),mute:De()});const qf=re({evt:I()}),Yf=re({shortcut:hl}),vl=ys,bl=re({skus:We(Lf)}),_l=re({entitlements:We(Va)}),El=We(Va).nullable(),wl=re({use_interactive_pip:De()}),Sl=re({locale:I()}),Tl=re({enabled:De()}),Al=re({permissions:Jo().or(I())}),Il=al(re({opened:De().or(Ni())}).default({opened:null})),Ol=re({iosKeyboardResizesView:Qo(De())}),Xf=ls.extend({cmd:os(we),evt:Ni()});function Jf({cmd:n,data:e}){switch(n){case we.AUTHORIZE:return yl.parse(e);case we.CAPTURE_SHORTCUT:return Yf.parse(e);case we.ENCOURAGE_HW_ACCELERATION:return Tl.parse(e);case we.GET_CHANNEL:return is.parse(e);case we.GET_CHANNELS:return zf.parse(e);case we.GET_CHANNEL_PERMISSIONS:return Al.parse(e);case we.GET_GUILD:return Zf.parse(e);case we.GET_GUILDS:return Gf.parse(e);case we.GET_PLATFORM_BEHAVIORS:return Ol.parse(e);case we.GET_CHANNEL:return is.parse(e);case we.SELECT_TEXT_CHANNEL:return Wf.parse(e);case we.SELECT_VOICE_CHANNEL:return Kf.parse(e);case we.SET_ACTIVITY:return vl.parse(e);case we.GET_SKUS_EMBEDDED:return bl.parse(e);case we.GET_ENTITLEMENTS_EMBEDDED:return _l.parse(e);case we.SET_CONFIG:return wl.parse(e);case we.START_PURCHASE:return El.parse(e);case we.SUBSCRIBE:case we.UNSUBSCRIBE:return qf.parse(e);case we.USER_SETTINGS_GET_LOCALE:return Sl.parse(e);case we.OPEN_EXTERNAL_LINK:return Il.parse(e);case we.SET_ORIENTATION_LOCK_STATE:case we.SET_CERTIFIED_DEVICES:case we.SEND_ANALYTICS_EVENT:case we.OPEN_INVITE_DIALOG:case we.CAPTURE_LOG:case we.GET_SKUS:case we.GET_ENTITLEMENTS:return Pi.parse(e);case we.AUTHENTICATE:case we.INITIATE_IMAGE_UPLOAD:case we.OPEN_SHARE_MOMENT_DIALOG:case we.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS:case we.SHARE_LINK:const{response:t}=cl[n];return t.parse(e);default:Hf(n,new Error(`Unrecognized command ${n}`))}}function Qf(n){return Object.assign(Object.assign({},n),{data:Jf(n)})}re({frame_id:I(),platform:os(Dn).optional().nullable()});re({v:Tt(1),encoding:Tt("json").optional(),client_id:I(),frame_id:I()});const ed=re({code:Ee(),message:I().optional()}),td=re({evt:I().nullable(),nonce:I().nullable(),data:Ps().nullable(),cmd:I()}).passthrough();function nd(n){const e=td.parse(n);return e.evt!=null?e.evt===Fa?ml.parse(e):Ff(Vf.parse(e)):Qf(Xf.passthrough().parse(e))}function zt(n,e,t,r=()=>{}){const s=ls.extend({cmd:Tt(e),data:t});return async i=>{const l=await n({cmd:e,args:i,transfer:r(i)});return s.parse(l).data}}function Bs(n,e=()=>{}){const t=cl[n].response,r=ls.extend({cmd:Tt(n),data:t});return s=>async i=>{const l=await s({cmd:n,args:i,transfer:e(i)});return r.parse(l).data}}const rd=Bs(Xt.AUTHENTICATE),sd=n=>zt(n,we.AUTHORIZE,yl),id=n=>zt(n,we.CAPTURE_LOG,Pi),ad=n=>zt(n,we.ENCOURAGE_HW_ACCELERATION,Tl),od=n=>zt(n,we.GET_ENTITLEMENTS_EMBEDDED,_l),ld=n=>zt(n,we.GET_SKUS_EMBEDDED,bl),cd=n=>zt(n,we.GET_CHANNEL_PERMISSIONS,Al),ud=n=>zt(n,we.GET_PLATFORM_BEHAVIORS,Ol),fd=n=>zt(n,we.OPEN_EXTERNAL_LINK,Il),dd=n=>zt(n,we.OPEN_INVITE_DIALOG,Pi),hd=Bs(Xt.OPEN_SHARE_MOMENT_DIALOG);ys.pick({state:!0,details:!0,timestamps:!0,assets:!0,party:!0,secrets:!0,instance:!0,type:!0}).extend({type:ys.shape.type.optional(),instance:ys.shape.instance.optional()}).nullable();const pd=n=>zt(n,we.SET_ACTIVITY,vl),gd=n=>zt(n,we.SET_CONFIG,wl);function md({sendCommand:n,cmd:e,response:t,fallbackTransform:r,transferTransform:s=()=>{}}){const i=ls.extend({cmd:Tt(e),data:t});return async l=>{try{const c=await n({cmd:e,args:l,transfer:s(l)});return i.parse(c).data}catch(c){if(c.code===Ea.INVALID_PAYLOAD){const h=r(l),f=await n({cmd:e,args:h,transfer:s(h)});return i.parse(f).data}else throw c}}}const yd=n=>({lock_state:n.lock_state,picture_in_picture_lock_state:n.picture_in_picture_lock_state}),vd=n=>md({sendCommand:n,cmd:we.SET_ORIENTATION_LOCK_STATE,response:Pi,fallbackTransform:yd}),bd=Bs(Xt.SHARE_LINK),_d=n=>zt(n,we.START_PURCHASE,El),Ed=n=>zt(n,we.USER_SETTINGS_GET_LOCALE,Sl),wd=Bs(Xt.INITIATE_IMAGE_UPLOAD),Sd=n=>zt(n,we.GET_CHANNEL,is),Td=Bs(Xt.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS);function Ad(n){return{authenticate:rd(n),authorize:sd(n),captureLog:id(n),encourageHardwareAcceleration:ad(n),getChannel:Sd(n),getChannelPermissions:cd(n),getEntitlements:od(n),getPlatformBehaviors:ud(n),getSkus:ld(n),openExternalLink:fd(n),openInviteDialog:dd(n),openShareMomentDialog:hd(n),setActivity:pd(n),setConfig:gd(n),setOrientationLockState:vd(n),shareLink:bd(n),startPurchase:_d(n),userSettingsGetLocale:Ed(n),initiateImageUpload:wd(n),getInstanceConnectedParticipants:Td(n)}}class Id extends Error{constructor(e,t=""){super(t),this.code=e,this.message=t,this.name="Discord SDK Error"}}function xl(){return{disableConsoleLogOverride:!1}}const Od=["log","warn","debug","info","error"];function xd(n,e,t){const r=n[e],s=n;r&&(n[e]=function(){const i=[].slice.call(arguments),l=""+i.join(" ");t(e,l),r.apply(s,i)})}var Dd="1.9.0",Nd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),yo={randomUUID:Nd},ci,Rd=new Uint8Array(16);function Pd(){if(!ci&&(ci=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ci))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ci(Rd)}var Pt=[];for(var ra=0;ra<256;++ra)Pt.push((ra+256).toString(16).slice(1));function kd(n,e=0){return(Pt[n[e+0]]+Pt[n[e+1]]+Pt[n[e+2]]+Pt[n[e+3]]+"-"+Pt[n[e+4]]+Pt[n[e+5]]+"-"+Pt[n[e+6]]+Pt[n[e+7]]+"-"+Pt[n[e+8]]+Pt[n[e+9]]+"-"+Pt[n[e+10]]+Pt[n[e+11]]+Pt[n[e+12]]+Pt[n[e+13]]+Pt[n[e+14]]+Pt[n[e+15]]).toLowerCase()}function vo(n,e,t){if(yo.randomUUID&&!n)return yo.randomUUID();n=n||{};var r=n.random||(n.rng||Pd)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,kd(r)}var Gn;(function(n){n[n.HANDSHAKE=0]="HANDSHAKE",n[n.FRAME=1]="FRAME",n[n.CLOSE=2]="CLOSE",n[n.HELLO=3]="HELLO"})(Gn||(Gn={}));const Ld=new Set(Bd());function Bd(){return typeof window>"u"?[]:[window.location.origin,"https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]}function Md(){var n;return[(n=window.parent.opener)!==null&&n!==void 0?n:window.parent,document.referrer?document.referrer:"*"]}class Cd{getTransfer(e){var t;switch(e.cmd){case we.SUBSCRIBE:case we.UNSUBSCRIBE:return;default:return(t=e.transfer)!==null&&t!==void 0?t:void 0}}constructor(e,t){if(this.sdkVersion=Dd,this.mobileAppVersion=null,this.source=null,this.sourceOrigin="",this.eventBus=new Zo,this.pendingCommands=new Map,this.sendCommand=c=>{var h;if(this.source==null)throw new Error("Attempting to send message before initialization");const f=vo();return(h=this.source)===null||h===void 0||h.postMessage([Gn.FRAME,Object.assign(Object.assign({},c),{nonce:f})],this.sourceOrigin,this.getTransfer(c)),new Promise((d,S)=>{this.pendingCommands.set(f,{resolve:d,reject:S})})},this.commands=Ad(this.sendCommand),this.handleMessage=c=>{if(!Ld.has(c.origin))return;const h=c.data;if(!Array.isArray(h))return;const[f,p]=h;switch(f){case Gn.HELLO:return;case Gn.CLOSE:return this.handleClose(p);case Gn.HANDSHAKE:return this.handleHandshake();case Gn.FRAME:return this.handleFrame(p);default:throw new Error("Invalid message format")}},this.isReady=!1,this.clientId=e,this.configuration=t??xl(),typeof window<"u"&&window.addEventListener("message",this.handleMessage),typeof window>"u"){this.frameId="",this.instanceId="",this.customId=null,this.referrerId=null,this.platform=Dn.DESKTOP,this.guildId=null,this.channelId=null,this.locationId=null;return}const r=new URLSearchParams(this._getSearch()),s=r.get("frame_id");if(!s)throw new Error("frame_id query param is not defined");this.frameId=s;const i=r.get("instance_id");if(!i)throw new Error("instance_id query param is not defined");this.instanceId=i;const l=r.get("platform");if(l){if(l!==Dn.DESKTOP&&l!==Dn.MOBILE)throw new Error(`Invalid query param "platform" of "${l}". Valid values are "${Dn.DESKTOP}" or "${Dn.MOBILE}"`)}else throw new Error("platform query param is not defined");this.platform=l,this.customId=r.get("custom_id"),this.referrerId=r.get("referrer_id"),this.guildId=r.get("guild_id"),this.channelId=r.get("channel_id"),this.locationId=r.get("location_id"),this.mobileAppVersion=r.get("mobile_app_version"),[this.source,this.sourceOrigin]=Md(),this.addOnReadyListener(),this.handshake()}close(e,t){var r;window.removeEventListener("message",this.handleMessage);const s=vo();(r=this.source)===null||r===void 0||r.postMessage([Gn.CLOSE,{code:e,message:t,nonce:s}],this.sourceOrigin)}async subscribe(e,t,...r){const[s]=r,i=this.eventBus.listenerCount(e),l=this.eventBus.on(e,t);return Object.values(et).includes(e)&&e!==et.READY&&i===0&&await this.sendCommand({cmd:we.SUBSCRIBE,args:s,evt:e}),l}async unsubscribe(e,t,...r){const[s]=r;return e!==et.READY&&this.eventBus.listenerCount(e)===1&&await this.sendCommand({cmd:we.UNSUBSCRIBE,evt:e,args:s}),this.eventBus.off(e,t)}async ready(){this.isReady||await new Promise(e=>{this.eventBus.once(et.READY,e)})}parseMajorMobileVersion(){if(this.mobileAppVersion&&this.mobileAppVersion.includes("."))try{return parseInt(this.mobileAppVersion.split(".")[0])}catch{return ho}return ho}handshake(){var e;const t={v:1,encoding:"json",client_id:this.clientId,frame_id:this.frameId},r=this.parseMajorMobileVersion();(this.platform===Dn.DESKTOP||r>=Qu)&&(t.sdk_version=this.sdkVersion),(e=this.source)===null||e===void 0||e.postMessage([Gn.HANDSHAKE,t],this.sourceOrigin)}addOnReadyListener(){this.eventBus.once(et.READY,()=>{this.overrideConsoleLogging(),this.isReady=!0})}overrideConsoleLogging(){if(this.configuration.disableConsoleLogOverride)return;const e=(t,r)=>{this.commands.captureLog({level:t,message:r})};Od.forEach(t=>{xd(console,t,e)})}handleClose(e){ed.parse(e)}handleHandshake(){}handleFrame(e){var t,r;let s;try{s=nd(e)}catch(i){console.error("Failed to parse",e),console.error(i);return}if(s.cmd==="DISPATCH")this.eventBus.emit(s.evt,s.data);else{if(s.evt===Fa){if(s.nonce!=null){(t=this.pendingCommands.get(s.nonce))===null||t===void 0||t.reject(s.data),this.pendingCommands.delete(s.nonce);return}this.eventBus.emit("error",new Id(s.data.code,s.data.message))}if(s.nonce==null){console.error("Missing nonce",e);return}(r=this.pendingCommands.get(s.nonce))===null||r===void 0||r.resolve(s),this.pendingCommands.delete(s.nonce)}}_getSearch(){return typeof window>"u"?"":window.location.search}}var cs=1e9,Ud={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Ll,lt=!0,fn="[DecimalError] ",Cr=fn+"Invalid argument: ",ja=fn+"Exponent out of range: ",us=Math.floor,Br=Math.pow,$d=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Jt,Dt=1e7,ot=7,Dl=9007199254740991,Ti=us(Dl/ot),he={};he.absoluteValue=he.abs=function(){var n=new this.constructor(this);return n.s&&(n.s=1),n};he.comparedTo=he.cmp=function(n){var e,t,r,s,i=this;if(n=new i.constructor(n),i.s!==n.s)return i.s||-n.s;if(i.e!==n.e)return i.e>n.e^i.s<0?1:-1;for(r=i.d.length,s=n.d.length,e=0,t=r<s?r:s;e<t;++e)if(i.d[e]!==n.d[e])return i.d[e]>n.d[e]^i.s<0?1:-1;return r===s?0:r>s^i.s<0?1:-1};he.decimalPlaces=he.dp=function(){var n=this,e=n.d.length-1,t=(e-n.e)*ot;if(e=n.d[e],e)for(;e%10==0;e/=10)t--;return t<0?0:t};he.dividedBy=he.div=function(n){return Zn(this,new this.constructor(n))};he.dividedToIntegerBy=he.idiv=function(n){var e=this,t=e.constructor;return nt(Zn(e,new t(n),0,1),t.precision)};he.equals=he.eq=function(n){return!this.cmp(n)};he.exponent=function(){return bt(this)};he.greaterThan=he.gt=function(n){return this.cmp(n)>0};he.greaterThanOrEqualTo=he.gte=function(n){return this.cmp(n)>=0};he.isInteger=he.isint=function(){return this.e>this.d.length-2};he.isNegative=he.isneg=function(){return this.s<0};he.isPositive=he.ispos=function(){return this.s>0};he.isZero=function(){return this.s===0};he.lessThan=he.lt=function(n){return this.cmp(n)<0};he.lessThanOrEqualTo=he.lte=function(n){return this.cmp(n)<1};he.logarithm=he.log=function(n){var e,t=this,r=t.constructor,s=r.precision,i=s+5;if(n===void 0)n=new r(10);else if(n=new r(n),n.s<1||n.eq(Jt))throw Error(fn+"NaN");if(t.s<1)throw Error(fn+(t.s?"NaN":"-Infinity"));return t.eq(Jt)?new r(0):(lt=!1,e=Zn(ks(t,i),ks(n,i),i),lt=!0,nt(e,s))};he.minus=he.sub=function(n){var e=this;return n=new e.constructor(n),e.s==n.s?Pl(e,n):Nl(e,(n.s=-n.s,n))};he.modulo=he.mod=function(n){var e,t=this,r=t.constructor,s=r.precision;if(n=new r(n),!n.s)throw Error(fn+"NaN");return t.s?(lt=!1,e=Zn(t,n,0,1).times(n),lt=!0,t.minus(e)):nt(new r(t),s)};he.naturalExponential=he.exp=function(){return Rl(this)};he.naturalLogarithm=he.ln=function(){return ks(this)};he.negated=he.neg=function(){var n=new this.constructor(this);return n.s=-n.s||0,n};he.plus=he.add=function(n){var e=this;return n=new e.constructor(n),e.s==n.s?Nl(e,n):Pl(e,(n.s=-n.s,n))};he.precision=he.sd=function(n){var e,t,r,s=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Cr+n);if(e=bt(s)+1,r=s.d.length-1,t=r*ot+1,r=s.d[r],r){for(;r%10==0;r/=10)t--;for(r=s.d[0];r>=10;r/=10)t++}return n&&e>t?e:t};he.squareRoot=he.sqrt=function(){var n,e,t,r,s,i,l,c=this,h=c.constructor;if(c.s<1){if(!c.s)return new h(0);throw Error(fn+"NaN")}for(n=bt(c),lt=!1,s=Math.sqrt(+c),s==0||s==1/0?(e=Rn(c.d),(e.length+n)%2==0&&(e+="0"),s=Math.sqrt(e),n=us((n+1)/2)-(n<0||n%2),s==1/0?e="5e"+n:(e=s.toExponential(),e=e.slice(0,e.indexOf("e")+1)+n),r=new h(e)):r=new h(s.toString()),t=h.precision,s=l=t+3;;)if(i=r,r=i.plus(Zn(c,i,l+2)).times(.5),Rn(i.d).slice(0,l)===(e=Rn(r.d)).slice(0,l)){if(e=e.slice(l-3,l+1),s==l&&e=="4999"){if(nt(i,t+1,0),i.times(i).eq(c)){r=i;break}}else if(e!="9999")break;l+=4}return lt=!0,nt(r,t)};he.times=he.mul=function(n){var e,t,r,s,i,l,c,h,f,p=this,d=p.constructor,S=p.d,M=(n=new d(n)).d;if(!p.s||!n.s)return new d(0);for(n.s*=p.s,t=p.e+n.e,h=S.length,f=M.length,h<f&&(i=S,S=M,M=i,l=h,h=f,f=l),i=[],l=h+f,r=l;r--;)i.push(0);for(r=f;--r>=0;){for(e=0,s=h+r;s>r;)c=i[s]+M[r]*S[s-r-1]+e,i[s--]=c%Dt|0,e=c/Dt|0;i[s]=(i[s]+e)%Dt|0}for(;!i[--l];)i.pop();return e?++t:i.shift(),n.d=i,n.e=t,lt?nt(n,d.precision):n};he.toDecimalPlaces=he.todp=function(n,e){var t=this,r=t.constructor;return t=new r(t),n===void 0?t:(Mn(n,0,cs),e===void 0?e=r.rounding:Mn(e,0,8),nt(t,n+bt(t)+1,e))};he.toExponential=function(n,e){var t,r=this,s=r.constructor;return n===void 0?t=Vr(r,!0):(Mn(n,0,cs),e===void 0?e=s.rounding:Mn(e,0,8),r=nt(new s(r),n+1,e),t=Vr(r,!0,n+1)),t};he.toFixed=function(n,e){var t,r,s=this,i=s.constructor;return n===void 0?Vr(s):(Mn(n,0,cs),e===void 0?e=i.rounding:Mn(e,0,8),r=nt(new i(s),n+bt(s)+1,e),t=Vr(r.abs(),!1,n+bt(r)+1),s.isneg()&&!s.isZero()?"-"+t:t)};he.toInteger=he.toint=function(){var n=this,e=n.constructor;return nt(new e(n),bt(n)+1,e.rounding)};he.toNumber=function(){return+this};he.toPower=he.pow=function(n){var e,t,r,s,i,l,c=this,h=c.constructor,f=12,p=+(n=new h(n));if(!n.s)return new h(Jt);if(c=new h(c),!c.s){if(n.s<1)throw Error(fn+"Infinity");return c}if(c.eq(Jt))return c;if(r=h.precision,n.eq(Jt))return nt(c,r);if(e=n.e,t=n.d.length-1,l=e>=t,i=c.s,l){if((t=p<0?-p:p)<=Dl){for(s=new h(Jt),e=Math.ceil(r/ot+4),lt=!1;t%2&&(s=s.times(c),_o(s.d,e)),t=us(t/2),t!==0;)c=c.times(c),_o(c.d,e);return lt=!0,n.s<0?new h(Jt).div(s):nt(s,r)}}else if(i<0)throw Error(fn+"NaN");return i=i<0&&n.d[Math.max(e,t)]&1?-1:1,c.s=1,lt=!1,s=n.times(ks(c,r+f)),lt=!0,s=Rl(s),s.s=i,s};he.toPrecision=function(n,e){var t,r,s=this,i=s.constructor;return n===void 0?(t=bt(s),r=Vr(s,t<=i.toExpNeg||t>=i.toExpPos)):(Mn(n,1,cs),e===void 0?e=i.rounding:Mn(e,0,8),s=nt(new i(s),n,e),t=bt(s),r=Vr(s,n<=t||t<=i.toExpNeg,n)),r};he.toSignificantDigits=he.tosd=function(n,e){var t=this,r=t.constructor;return n===void 0?(n=r.precision,e=r.rounding):(Mn(n,1,cs),e===void 0?e=r.rounding:Mn(e,0,8)),nt(new r(t),n,e)};he.toString=he.valueOf=he.val=he.toJSON=he[Symbol.for("nodejs.util.inspect.custom")]=function(){var n=this,e=bt(n),t=n.constructor;return Vr(n,e<=t.toExpNeg||e>=t.toExpPos)};function Nl(n,e){var t,r,s,i,l,c,h,f,p=n.constructor,d=p.precision;if(!n.s||!e.s)return e.s||(e=new p(n)),lt?nt(e,d):e;if(h=n.d,f=e.d,l=n.e,s=e.e,h=h.slice(),i=l-s,i){for(i<0?(r=h,i=-i,c=f.length):(r=f,s=l,c=h.length),l=Math.ceil(d/ot),c=l>c?l+1:c+1,i>c&&(i=c,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for(c=h.length,i=f.length,c-i<0&&(i=c,r=f,f=h,h=r),t=0;i;)t=(h[--i]=h[i]+f[i]+t)/Dt|0,h[i]%=Dt;for(t&&(h.unshift(t),++s),c=h.length;h[--c]==0;)h.pop();return e.d=h,e.e=s,lt?nt(e,d):e}function Mn(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Cr+n)}function Rn(n){var e,t,r,s=n.length-1,i="",l=n[0];if(s>0){for(i+=l,e=1;e<s;e++)r=n[e]+"",t=ot-r.length,t&&(i+=nr(t)),i+=r;l=n[e],r=l+"",t=ot-r.length,t&&(i+=nr(t))}else if(l===0)return"0";for(;l%10===0;)l/=10;return i+l}var Zn=function(){function n(r,s){var i,l=0,c=r.length;for(r=r.slice();c--;)i=r[c]*s+l,r[c]=i%Dt|0,l=i/Dt|0;return l&&r.unshift(l),r}function e(r,s,i,l){var c,h;if(i!=l)h=i>l?1:-1;else for(c=h=0;c<i;c++)if(r[c]!=s[c]){h=r[c]>s[c]?1:-1;break}return h}function t(r,s,i){for(var l=0;i--;)r[i]-=l,l=r[i]<s[i]?1:0,r[i]=l*Dt+r[i]-s[i];for(;!r[0]&&r.length>1;)r.shift()}return function(r,s,i,l){var c,h,f,p,d,S,M,Y,V,H,ce,fe,te,ye,Xe,Je,He,tt,Ge=r.constructor,Lt=r.s==s.s?1:-1,Qe=r.d,$e=s.d;if(!r.s)return new Ge(r);if(!s.s)throw Error(fn+"Division by zero");for(h=r.e-s.e,He=$e.length,Xe=Qe.length,M=new Ge(Lt),Y=M.d=[],f=0;$e[f]==(Qe[f]||0);)++f;if($e[f]>(Qe[f]||0)&&--h,i==null?fe=i=Ge.precision:l?fe=i+(bt(r)-bt(s))+1:fe=i,fe<0)return new Ge(0);if(fe=fe/ot+2|0,f=0,He==1)for(p=0,$e=$e[0],fe++;(f<Xe||p)&&fe--;f++)te=p*Dt+(Qe[f]||0),Y[f]=te/$e|0,p=te%$e|0;else{for(p=Dt/($e[0]+1)|0,p>1&&($e=n($e,p),Qe=n(Qe,p),He=$e.length,Xe=Qe.length),ye=He,V=Qe.slice(0,He),H=V.length;H<He;)V[H++]=0;tt=$e.slice(),tt.unshift(0),Je=$e[0],$e[1]>=Dt/2&&++Je;do p=0,c=e($e,V,He,H),c<0?(ce=V[0],He!=H&&(ce=ce*Dt+(V[1]||0)),p=ce/Je|0,p>1?(p>=Dt&&(p=Dt-1),d=n($e,p),S=d.length,H=V.length,c=e(d,V,S,H),c==1&&(p--,t(d,He<S?tt:$e,S))):(p==0&&(c=p=1),d=$e.slice()),S=d.length,S<H&&d.unshift(0),t(V,d,H),c==-1&&(H=V.length,c=e($e,V,He,H),c<1&&(p++,t(V,He<H?tt:$e,H))),H=V.length):c===0&&(p++,V=[0]),Y[f++]=p,c&&V[0]?V[H++]=Qe[ye]||0:(V=[Qe[ye]],H=1);while((ye++<Xe||V[0]!==void 0)&&fe--)}return Y[0]||Y.shift(),M.e=h,nt(M,l?i+bt(M)+1:i)}}();function Rl(n,e){var t,r,s,i,l,c,h=0,f=0,p=n.constructor,d=p.precision;if(bt(n)>16)throw Error(ja+bt(n));if(!n.s)return new p(Jt);for(lt=!1,c=d,l=new p(.03125);n.abs().gte(.1);)n=n.times(l),f+=5;for(r=Math.log(Br(2,f))/Math.LN10*2+5|0,c+=r,t=s=i=new p(Jt),p.precision=c;;){if(s=nt(s.times(n),c),t=t.times(++h),l=i.plus(Zn(s,t,c)),Rn(l.d).slice(0,c)===Rn(i.d).slice(0,c)){for(;f--;)i=nt(i.times(i),c);return p.precision=d,e==null?(lt=!0,nt(i,d)):i}i=l}}function bt(n){for(var e=n.e*ot,t=n.d[0];t>=10;t/=10)e++;return e}function sa(n,e,t){if(e>n.LN10.sd())throw lt=!0,t&&(n.precision=t),Error(fn+"LN10 precision limit exceeded");return nt(new n(n.LN10),e)}function nr(n){for(var e="";n--;)e+="0";return e}function ks(n,e){var t,r,s,i,l,c,h,f,p,d=1,S=10,M=n,Y=M.d,V=M.constructor,H=V.precision;if(M.s<1)throw Error(fn+(M.s?"NaN":"-Infinity"));if(M.eq(Jt))return new V(0);if(e==null?(lt=!1,f=H):f=e,M.eq(10))return e==null&&(lt=!0),sa(V,f);if(f+=S,V.precision=f,t=Rn(Y),r=t.charAt(0),i=bt(M),Math.abs(i)<15e14){for(;r<7&&r!=1||r==1&&t.charAt(1)>3;)M=M.times(n),t=Rn(M.d),r=t.charAt(0),d++;i=bt(M),r>1?(M=new V("0."+t),i++):M=new V(r+"."+t.slice(1))}else return h=sa(V,f+2,H).times(i+""),M=ks(new V(r+"."+t.slice(1)),f-S).plus(h),V.precision=H,e==null?(lt=!0,nt(M,H)):M;for(c=l=M=Zn(M.minus(Jt),M.plus(Jt),f),p=nt(M.times(M),f),s=3;;){if(l=nt(l.times(p),f),h=c.plus(Zn(l,new V(s),f)),Rn(h.d).slice(0,f)===Rn(c.d).slice(0,f))return c=c.times(2),i!==0&&(c=c.plus(sa(V,f+2,H).times(i+""))),c=Zn(c,new V(d),f),V.precision=H,e==null?(lt=!0,nt(c,H)):c;c=h,s+=2}}function bo(n,e){var t,r,s;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(t<0&&(t=r),t+=+e.slice(r+1),e=e.substring(0,r)):t<0&&(t=e.length),r=0;e.charCodeAt(r)===48;)++r;for(s=e.length;e.charCodeAt(s-1)===48;)--s;if(e=e.slice(r,s),e){if(s-=r,t=t-r-1,n.e=us(t/ot),n.d=[],r=(t+1)%ot,t<0&&(r+=ot),r<s){for(r&&n.d.push(+e.slice(0,r)),s-=ot;r<s;)n.d.push(+e.slice(r,r+=ot));e=e.slice(r),r=ot-e.length}else r-=s;for(;r--;)e+="0";if(n.d.push(+e),lt&&(n.e>Ti||n.e<-Ti))throw Error(ja+t)}else n.s=0,n.e=0,n.d=[0];return n}function nt(n,e,t){var r,s,i,l,c,h,f,p,d=n.d;for(l=1,i=d[0];i>=10;i/=10)l++;if(r=e-l,r<0)r+=ot,s=e,f=d[p=0];else{if(p=Math.ceil((r+1)/ot),i=d.length,p>=i)return n;for(f=i=d[p],l=1;i>=10;i/=10)l++;r%=ot,s=r-ot+l}if(t!==void 0&&(i=Br(10,l-s-1),c=f/i%10|0,h=e<0||d[p+1]!==void 0||f%i,h=t<4?(c||h)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||h||t==6&&(r>0?s>0?f/Br(10,l-s):0:d[p-1])%10&1||t==(n.s<0?8:7))),e<1||!d[0])return h?(i=bt(n),d.length=1,e=e-i-1,d[0]=Br(10,(ot-e%ot)%ot),n.e=us(-e/ot)||0):(d.length=1,d[0]=n.e=n.s=0),n;if(r==0?(d.length=p,i=1,p--):(d.length=p+1,i=Br(10,ot-r),d[p]=s>0?(f/Br(10,l-s)%Br(10,s)|0)*i:0),h)for(;;)if(p==0){(d[0]+=i)==Dt&&(d[0]=1,++n.e);break}else{if(d[p]+=i,d[p]!=Dt)break;d[p--]=0,i=1}for(r=d.length;d[--r]===0;)d.pop();if(lt&&(n.e>Ti||n.e<-Ti))throw Error(ja+bt(n));return n}function Pl(n,e){var t,r,s,i,l,c,h,f,p,d,S=n.constructor,M=S.precision;if(!n.s||!e.s)return e.s?e.s=-e.s:e=new S(n),lt?nt(e,M):e;if(h=n.d,d=e.d,r=e.e,f=n.e,h=h.slice(),l=f-r,l){for(p=l<0,p?(t=h,l=-l,c=d.length):(t=d,r=f,c=h.length),s=Math.max(Math.ceil(M/ot),c)+2,l>s&&(l=s,t.length=1),t.reverse(),s=l;s--;)t.push(0);t.reverse()}else{for(s=h.length,c=d.length,p=s<c,p&&(c=s),s=0;s<c;s++)if(h[s]!=d[s]){p=h[s]<d[s];break}l=0}for(p&&(t=h,h=d,d=t,e.s=-e.s),c=h.length,s=d.length-c;s>0;--s)h[c++]=0;for(s=d.length;s>l;){if(h[--s]<d[s]){for(i=s;i&&h[--i]===0;)h[i]=Dt-1;--h[i],h[s]+=Dt}h[s]-=d[s]}for(;h[--c]===0;)h.pop();for(;h[0]===0;h.shift())--r;return h[0]?(e.d=h,e.e=r,lt?nt(e,M):e):new S(0)}function Vr(n,e,t){var r,s=bt(n),i=Rn(n.d),l=i.length;return e?(t&&(r=t-l)>0?i=i.charAt(0)+"."+i.slice(1)+nr(r):l>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(s<0?"e":"e+")+s):s<0?(i="0."+nr(-s-1)+i,t&&(r=t-l)>0&&(i+=nr(r))):s>=l?(i+=nr(s+1-l),t&&(r=t-s-1)>0&&(i=i+"."+nr(r))):((r=s+1)<l&&(i=i.slice(0,r)+"."+i.slice(r)),t&&(r=t-l)>0&&(s+1===l&&(i+="."),i+=nr(r))),n.s<0?"-"+i:i}function _o(n,e){if(n.length>e)return n.length=e,!0}function kl(n){var e,t,r;function s(i){var l=this;if(!(l instanceof s))return new s(i);if(l.constructor=s,i instanceof s){l.s=i.s,l.e=i.e,l.d=(i=i.d)?i.slice():i;return}if(typeof i=="number"){if(i*0!==0)throw Error(Cr+i);if(i>0)l.s=1;else if(i<0)i=-i,l.s=-1;else{l.s=0,l.e=0,l.d=[0];return}if(i===~~i&&i<1e7){l.e=0,l.d=[i];return}return bo(l,i.toString())}else if(typeof i!="string")throw Error(Cr+i);if(i.charCodeAt(0)===45?(i=i.slice(1),l.s=-1):l.s=1,$d.test(i))bo(l,i);else throw Error(Cr+i)}if(s.prototype=he,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=kl,s.config=s.set=Vd,n===void 0&&(n={}),n)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<r.length;)n.hasOwnProperty(t=r[e++])||(n[t]=this[t]);return s.config(n),s}function Vd(n){if(!n||typeof n!="object")throw Error(fn+"Object expected");var e,t,r,s=["precision",1,cs,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<s.length;e+=3)if((r=n[t=s[e]])!==void 0)if(us(r)===r&&r>=s[e+1]&&r<=s[e+2])this[t]=r;else throw Error(Cr+t+": "+r);if((r=n[t="LN10"])!==void 0)if(r==Math.LN10)this[t]=new this(r);else throw Error(Cr+t+": "+r);return this}var Ll=kl(Ud);Jt=new Ll(1);var x;(function(n){n.AED="aed",n.AFN="afn",n.ALL="all",n.AMD="amd",n.ANG="ang",n.AOA="aoa",n.ARS="ars",n.AUD="aud",n.AWG="awg",n.AZN="azn",n.BAM="bam",n.BBD="bbd",n.BDT="bdt",n.BGN="bgn",n.BHD="bhd",n.BIF="bif",n.BMD="bmd",n.BND="bnd",n.BOB="bob",n.BOV="bov",n.BRL="brl",n.BSD="bsd",n.BTN="btn",n.BWP="bwp",n.BYN="byn",n.BYR="byr",n.BZD="bzd",n.CAD="cad",n.CDF="cdf",n.CHE="che",n.CHF="chf",n.CHW="chw",n.CLF="clf",n.CLP="clp",n.CNY="cny",n.COP="cop",n.COU="cou",n.CRC="crc",n.CUC="cuc",n.CUP="cup",n.CVE="cve",n.CZK="czk",n.DJF="djf",n.DKK="dkk",n.DOP="dop",n.DZD="dzd",n.EGP="egp",n.ERN="ern",n.ETB="etb",n.EUR="eur",n.FJD="fjd",n.FKP="fkp",n.GBP="gbp",n.GEL="gel",n.GHS="ghs",n.GIP="gip",n.GMD="gmd",n.GNF="gnf",n.GTQ="gtq",n.GYD="gyd",n.HKD="hkd",n.HNL="hnl",n.HRK="hrk",n.HTG="htg",n.HUF="huf",n.IDR="idr",n.ILS="ils",n.INR="inr",n.IQD="iqd",n.IRR="irr",n.ISK="isk",n.JMD="jmd",n.JOD="jod",n.JPY="jpy",n.KES="kes",n.KGS="kgs",n.KHR="khr",n.KMF="kmf",n.KPW="kpw",n.KRW="krw",n.KWD="kwd",n.KYD="kyd",n.KZT="kzt",n.LAK="lak",n.LBP="lbp",n.LKR="lkr",n.LRD="lrd",n.LSL="lsl",n.LTL="ltl",n.LVL="lvl",n.LYD="lyd",n.MAD="mad",n.MDL="mdl",n.MGA="mga",n.MKD="mkd",n.MMK="mmk",n.MNT="mnt",n.MOP="mop",n.MRO="mro",n.MUR="mur",n.MVR="mvr",n.MWK="mwk",n.MXN="mxn",n.MXV="mxv",n.MYR="myr",n.MZN="mzn",n.NAD="nad",n.NGN="ngn",n.NIO="nio",n.NOK="nok",n.NPR="npr",n.NZD="nzd",n.OMR="omr",n.PAB="pab",n.PEN="pen",n.PGK="pgk",n.PHP="php",n.PKR="pkr",n.PLN="pln",n.PYG="pyg",n.QAR="qar",n.RON="ron",n.RSD="rsd",n.RUB="rub",n.RWF="rwf",n.SAR="sar",n.SBD="sbd",n.SCR="scr",n.SDG="sdg",n.SEK="sek",n.SGD="sgd",n.SHP="shp",n.SLL="sll",n.SOS="sos",n.SRD="srd",n.SSP="ssp",n.STD="std",n.SVC="svc",n.SYP="syp",n.SZL="szl",n.THB="thb",n.TJS="tjs",n.TMT="tmt",n.TND="tnd",n.TOP="top",n.TRY="try",n.TTD="ttd",n.TWD="twd",n.TZS="tzs",n.UAH="uah",n.UGX="ugx",n.USD="usd",n.USN="usn",n.USS="uss",n.UYI="uyi",n.UYU="uyu",n.UZS="uzs",n.VEF="vef",n.VND="vnd",n.VUV="vuv",n.WST="wst",n.XAF="xaf",n.XAG="xag",n.XAU="xau",n.XBA="xba",n.XBB="xbb",n.XBC="xbc",n.XBD="xbd",n.XCD="xcd",n.XDR="xdr",n.XFU="xfu",n.XOF="xof",n.XPD="xpd",n.XPF="xpf",n.XPT="xpt",n.XSU="xsu",n.XTS="xts",n.XUA="xua",n.YER="yer",n.ZAR="zar",n.ZMW="zmw",n.ZWL="zwl"})(x||(x={}));x.AED+"",x.AFN+"",x.ALL+"",x.AMD+"",x.ANG+"",x.AOA+"",x.ARS+"",x.AUD+"",x.AWG+"",x.AZN+"",x.BAM+"",x.BBD+"",x.BDT+"",x.BGN+"",x.BHD+"",x.BIF+"",x.BMD+"",x.BND+"",x.BOB+"",x.BOV+"",x.BRL+"",x.BSD+"",x.BTN+"",x.BWP+"",x.BYR+"",x.BYN+"",x.BZD+"",x.CAD+"",x.CDF+"",x.CHE+"",x.CHF+"",x.CHW+"",x.CLF+"",x.CLP+"",x.CNY+"",x.COP+"",x.COU+"",x.CRC+"",x.CUC+"",x.CUP+"",x.CVE+"",x.CZK+"",x.DJF+"",x.DKK+"",x.DOP+"",x.DZD+"",x.EGP+"",x.ERN+"",x.ETB+"",x.EUR+"",x.FJD+"",x.FKP+"",x.GBP+"",x.GEL+"",x.GHS+"",x.GIP+"",x.GMD+"",x.GNF+"",x.GTQ+"",x.GYD+"",x.HKD+"",x.HNL+"",x.HRK+"",x.HTG+"",x.HUF+"",x.IDR+"",x.ILS+"",x.INR+"",x.IQD+"",x.IRR+"",x.ISK+"",x.JMD+"",x.JOD+"",x.JPY+"",x.KES+"",x.KGS+"",x.KHR+"",x.KMF+"",x.KPW+"",x.KRW+"",x.KWD+"",x.KYD+"",x.KZT+"",x.LAK+"",x.LBP+"",x.LKR+"",x.LRD+"",x.LSL+"",x.LTL+"",x.LVL+"",x.LYD+"",x.MAD+"",x.MDL+"",x.MGA+"",x.MKD+"",x.MMK+"",x.MNT+"",x.MOP+"",x.MRO+"",x.MUR+"",x.MVR+"",x.MWK+"",x.MXN+"",x.MXV+"",x.MYR+"",x.MZN+"",x.NAD+"",x.NGN+"",x.NIO+"",x.NOK+"",x.NPR+"",x.NZD+"",x.OMR+"",x.PAB+"",x.PEN+"",x.PGK+"",x.PHP+"",x.PKR+"",x.PLN+"",x.PYG+"",x.QAR+"",x.RON+"",x.RSD+"",x.RUB+"",x.RWF+"",x.SAR+"",x.SBD+"",x.SCR+"",x.SDG+"",x.SEK+"",x.SGD+"",x.SHP+"",x.SLL+"",x.SOS+"",x.SRD+"",x.SSP+"",x.STD+"",x.SVC+"",x.SYP+"",x.SZL+"",x.THB+"",x.TJS+"",x.TMT+"",x.TND+"",x.TOP+"",x.TRY+"",x.TTD+"",x.TWD+"",x.TZS+"",x.UAH+"",x.UGX+"",x.USD+"",x.USN+"",x.USS+"",x.UYI+"",x.UYU+"",x.UZS+"",x.VEF+"",x.VND+"",x.VUV+"",x.WST+"",x.XAF+"",x.XAG+"",x.XAU+"",x.XBA+"",x.XBB+"",x.XBC+"",x.XBD+"",x.XCD+"",x.XDR+"",x.XFU+"",x.XOF+"",x.XPD+"",x.XPF+"",x.XPT+"",x.XSU+"",x.XTS+"",x.XUA+"",x.YER+"",x.ZAR+"",x.ZMW+"",x.ZWL+"";var ms={exports:{}};ms.exports;var Eo;function Fd(){return Eo||(Eo=1,function(n,e){var t=200,r="Expected a function",s="__lodash_hash_undefined__",i=1,l=2,c=9007199254740991,h="[object Arguments]",f="[object Array]",p="[object Boolean]",d="[object Date]",S="[object Error]",M="[object Function]",Y="[object GeneratorFunction]",V="[object Map]",H="[object Number]",ce="[object Object]",fe="[object Promise]",te="[object RegExp]",ye="[object Set]",Xe="[object String]",Je="[object Symbol]",He="[object WeakMap]",tt="[object ArrayBuffer]",Ge="[object DataView]",Lt="[object Float32Array]",Qe="[object Float64Array]",$e="[object Int8Array]",B="[object Int16Array]",J="[object Int32Array]",W="[object Uint8Array]",q="[object Uint8ClampedArray]",ee="[object Uint16Array]",me="[object Uint32Array]",Ne=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Se=/^\w*$/,Ze=/^\./,Fe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,_t=/\\(\\)?/g,Rt=/^\[object .+?Constructor\]$/,Fr=/^(?:0|[1-9]\d*)$/,Ye={};Ye[Lt]=Ye[Qe]=Ye[$e]=Ye[B]=Ye[J]=Ye[W]=Ye[q]=Ye[ee]=Ye[me]=!0,Ye[h]=Ye[f]=Ye[tt]=Ye[p]=Ye[Ge]=Ye[d]=Ye[S]=Ye[M]=Ye[V]=Ye[H]=Ye[ce]=Ye[te]=Ye[ye]=Ye[Xe]=Ye[He]=!1;var yt=typeof ai=="object"&&ai&&ai.Object===Object&&ai,Un=typeof self=="object"&&self&&self.Object===Object&&self,ht=yt||Un||Function("return this")(),mr=e&&!e.nodeType&&e,yr=mr&&!0&&n&&!n.nodeType&&n,vr=yr&&yr.exports===mr,br=vr&&yt.process,_r=function(){try{return br&&br.binding("util")}catch{}}(),Er=_r&&_r.isTypedArray;function $n(y,w){for(var U=-1,ne=y?y.length:0;++U<ne&&w(y[U],U,y)!==!1;);return y}function wr(y,w){for(var U=-1,ne=y?y.length:0;++U<ne;)if(w(y[U],U,y))return!0;return!1}function Wn(y){return function(w){return w==null?void 0:w[y]}}function Et(y,w){for(var U=-1,ne=Array(y);++U<y;)ne[U]=w(U);return ne}function dn(y){return function(w){return y(w)}}function Sr(y,w){return y==null?void 0:y[w]}function qn(y){var w=!1;if(y!=null&&typeof y.toString!="function")try{w=!!(y+"")}catch{}return w}function Te(y){var w=-1,U=Array(y.size);return y.forEach(function(ne,Pe){U[++w]=[Pe,ne]}),U}function Kt(y,w){return function(U){return y(w(U))}}function g(y){var w=-1,U=Array(y.size);return y.forEach(function(ne){U[++w]=ne}),U}var b=Array.prototype,A=Function.prototype,O=Object.prototype,C=ht["__core-js_shared__"],k=function(){var y=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),$=A.toString,j=O.hasOwnProperty,Z=O.toString,ve=RegExp("^"+$.call(j).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Re=ht.Symbol,xe=ht.Uint8Array,ke=Kt(Object.getPrototypeOf,Object),At=Object.create,ze=O.propertyIsEnumerable,En=b.splice,wt=Kt(Object.keys,Object),jr=T(ht,"DataView"),pt=T(ht,"Map"),wn=T(ht,"Promise"),Tr=T(ht,"Set"),Hr=T(ht,"WeakMap"),Sn=T(Object,"create"),$s=Ve(jr),Vs=Ve(pt),fs=Ve(wn),Fs=Ve(Tr),Gr=Ve(Hr),Zr=Re?Re.prototype:void 0,zr=Zr?Zr.valueOf:void 0,js=Zr?Zr.toString:void 0;function en(y){var w=-1,U=y?y.length:0;for(this.clear();++w<U;){var ne=y[w];this.set(ne[0],ne[1])}}function Hs(){this.__data__=Sn?Sn(null):{}}function Gs(y){return this.has(y)&&delete this.__data__[y]}function Hi(y){var w=this.__data__;if(Sn){var U=w[y];return U===s?void 0:U}return j.call(w,y)?w[y]:void 0}function tn(y){var w=this.__data__;return Sn?w[y]!==void 0:j.call(w,y)}function Zs(y,w){var U=this.__data__;return U[y]=Sn&&w===void 0?s:w,this}en.prototype.clear=Hs,en.prototype.delete=Gs,en.prototype.get=Hi,en.prototype.has=tn,en.prototype.set=Zs;function nn(y){var w=-1,U=y?y.length:0;for(this.clear();++w<U;){var ne=y[w];this.set(ne[0],ne[1])}}function Tn(){this.__data__=[]}function hn(y){var w=this.__data__,U=Wr(w,y);if(U<0)return!1;var ne=w.length-1;return U==ne?w.pop():En.call(w,U,1),!0}function Gi(y){var w=this.__data__,U=Wr(w,y);return U<0?void 0:w[U][1]}function zs(y){return Wr(this.__data__,y)>-1}function Wt(y,w){var U=this.__data__,ne=Wr(U,y);return ne<0?U.push([y,w]):U[ne][1]=w,this}nn.prototype.clear=Tn,nn.prototype.delete=hn,nn.prototype.get=Gi,nn.prototype.has=zs,nn.prototype.set=Wt;function rn(y){var w=-1,U=y?y.length:0;for(this.clear();++w<U;){var ne=y[w];this.set(ne[0],ne[1])}}function Zi(){this.__data__={hash:new en,map:new(pt||nn),string:new en}}function zi(y){return m(this,y).delete(y)}function Ks(y){return m(this,y).get(y)}function Kr(y){return m(this,y).has(y)}function Ki(y,w){return m(this,y).set(y,w),this}rn.prototype.clear=Zi,rn.prototype.delete=zi,rn.prototype.get=Ks,rn.prototype.has=Kr,rn.prototype.set=Ki;function Ar(y){var w=-1,U=y?y.length:0;for(this.__data__=new rn;++w<U;)this.add(y[w])}function Ws(y){return this.__data__.set(y,s),this}function ft(y){return this.__data__.has(y)}Ar.prototype.add=Ar.prototype.push=Ws,Ar.prototype.has=ft;function sn(y){this.__data__=new nn(y)}function qs(){this.__data__=new nn}function Ir(y){return this.__data__.delete(y)}function Ys(y){return this.__data__.get(y)}function Xs(y){return this.__data__.has(y)}function Or(y,w){var U=this.__data__;if(U instanceof nn){var ne=U.__data__;if(!pt||ne.length<t-1)return ne.push([y,w]),this;U=this.__data__=new rn(ne)}return U.set(y,w),this}sn.prototype.clear=qs,sn.prototype.delete=Ir,sn.prototype.get=Ys,sn.prototype.has=Xs,sn.prototype.set=Or;function An(y,w){var U=It(y)||vt(y)?Et(y.length,String):[],ne=U.length,Pe=!!ne;for(var be in y)j.call(y,be)&&!(Pe&&(be=="length"||F(be,ne)))&&U.push(be);return U}function Wr(y,w){for(var U=y.length;U--;)if(St(y[U][0],w))return U;return-1}function qr(y){return Yr(y)?At(y):{}}var Js=v();function Qs(y,w){return y&&Js(y,w,ni)}function ei(y,w){w=G(w,y)?[w]:Dr(w);for(var U=0,ne=w.length;y!=null&&U<ne;)y=y[de(w[U++])];return U&&U==ne?y:void 0}function ds(y){return Z.call(y)}function Yn(y,w){return y!=null&&w in Object(y)}function In(y,w,U,ne,Pe){return y===w?!0:y==null||w==null||!Yr(y)&&!ti(w)?y!==y&&w!==w:Xn(y,w,In,U,ne,Pe)}function Xn(y,w,U,ne,Pe,be){var Ue=It(y),gt=It(w),dt=f,Bt=f;Ue||(dt=R(y),dt=dt==h?ce:dt),gt||(Bt=R(w),Bt=Bt==h?ce:Bt);var Gt=dt==ce&&!qn(y),Zt=Bt==ce&&!qn(w),Vt=dt==Bt;if(Vt&&!Gt)return be||(be=new sn),Ue||io(y)?a(y,w,U,ne,Pe,be):o(y,w,dt,U,ne,Pe,be);if(!(Pe&l)){var on=Gt&&j.call(y,"__wrapped__"),ln=Zt&&j.call(w,"__wrapped__");if(on||ln){var er=on?y.value():y,Vn=ln?w.value():w;return be||(be=new sn),U(er,Vn,ne,Pe,be)}}return Vt?(be||(be=new sn),u(y,w,U,ne,Pe,be)):!1}function Wi(y,w,U,ne){var Pe=U.length,be=Pe;if(y==null)return!be;for(y=Object(y);Pe--;){var Ue=U[Pe];if(Ue[2]?Ue[1]!==y[Ue[0]]:!(Ue[0]in y))return!1}for(;++Pe<be;){Ue=U[Pe];var gt=Ue[0],dt=y[gt],Bt=Ue[1];if(Ue[2]){if(dt===void 0&&!(gt in y))return!1}else{var Gt=new sn,Zt;if(!(Zt===void 0?In(Bt,dt,ne,i|l,Gt):Zt))return!1}}return!0}function qi(y){if(!Yr(y)||z(y))return!1;var w=Xi(y)||qn(y)?ve:Rt;return w.test(Ve(y))}function Yi(y){return ti(y)&&Ji(y.length)&&!!Ye[Z.call(y)]}function an(y){return typeof y=="function"?y:y==null?jc:typeof y=="object"?It(y)?xr(y[0],y[1]):On(y):Hc(y)}function qt(y){if(!ge(y))return wt(y);var w=[];for(var U in Object(y))j.call(y,U)&&U!="constructor"&&w.push(U);return w}function On(y){var w=_(y);return w.length==1&&w[0][2]?ie(w[0][0],w[0][1]):function(U){return U===y||Wi(U,y,w)}}function xr(y,w){return G(y)&&pe(w)?ie(de(y),w):function(U){var ne=$c(U,y);return ne===void 0&&ne===w?Vc(U,y):In(w,ne,void 0,i|l)}}function Jn(y){return function(w){return ei(w,y)}}function Qn(y){if(typeof y=="string")return y;if(Qi(y))return js?js.call(y):"";var w=y+"";return w=="0"&&1/y==-1/0?"-0":w}function Dr(y){return It(y)?y:K(y)}function v(y){return function(w,U,ne){for(var Pe=-1,be=Object(w),Ue=ne(w),gt=Ue.length;gt--;){var dt=Ue[++Pe];if(U(be[dt],dt,be)===!1)break}return w}}function a(y,w,U,ne,Pe,be){var Ue=Pe&l,gt=y.length,dt=w.length;if(gt!=dt&&!(Ue&&dt>gt))return!1;var Bt=be.get(y);if(Bt&&be.get(w))return Bt==w;var Gt=-1,Zt=!0,Vt=Pe&i?new Ar:void 0;for(be.set(y,w),be.set(w,y);++Gt<gt;){var on=y[Gt],ln=w[Gt];if(ne)var er=Ue?ne(ln,on,Gt,w,y,be):ne(on,ln,Gt,y,w,be);if(er!==void 0){if(er)continue;Zt=!1;break}if(Vt){if(!wr(w,function(Vn,Nr){if(!Vt.has(Nr)&&(on===Vn||U(on,Vn,ne,Pe,be)))return Vt.add(Nr)})){Zt=!1;break}}else if(!(on===ln||U(on,ln,ne,Pe,be))){Zt=!1;break}}return be.delete(y),be.delete(w),Zt}function o(y,w,U,ne,Pe,be,Ue){switch(U){case Ge:if(y.byteLength!=w.byteLength||y.byteOffset!=w.byteOffset)return!1;y=y.buffer,w=w.buffer;case tt:return!(y.byteLength!=w.byteLength||!ne(new xe(y),new xe(w)));case p:case d:case H:return St(+y,+w);case S:return y.name==w.name&&y.message==w.message;case te:case Xe:return y==w+"";case V:var gt=Te;case ye:var dt=be&l;if(gt||(gt=g),y.size!=w.size&&!dt)return!1;var Bt=Ue.get(y);if(Bt)return Bt==w;be|=i,Ue.set(y,w);var Gt=a(gt(y),gt(w),ne,Pe,be,Ue);return Ue.delete(y),Gt;case Je:if(zr)return zr.call(y)==zr.call(w)}return!1}function u(y,w,U,ne,Pe,be){var Ue=Pe&l,gt=ni(y),dt=gt.length,Bt=ni(w),Gt=Bt.length;if(dt!=Gt&&!Ue)return!1;for(var Zt=dt;Zt--;){var Vt=gt[Zt];if(!(Ue?Vt in w:j.call(w,Vt)))return!1}var on=be.get(y);if(on&&be.get(w))return on==w;var ln=!0;be.set(y,w),be.set(w,y);for(var er=Ue;++Zt<dt;){Vt=gt[Zt];var Vn=y[Vt],Nr=w[Vt];if(ne)var ao=Ue?ne(Nr,Vn,Vt,w,y,be):ne(Vn,Nr,Vt,y,w,be);if(!(ao===void 0?Vn===Nr||U(Vn,Nr,ne,Pe,be):ao)){ln=!1;break}er||(er=Vt=="constructor")}if(ln&&!er){var ri=y.constructor,si=w.constructor;ri!=si&&"constructor"in y&&"constructor"in w&&!(typeof ri=="function"&&ri instanceof ri&&typeof si=="function"&&si instanceof si)&&(ln=!1)}return be.delete(y),be.delete(w),ln}function m(y,w){var U=y.__data__;return Q(w)?U[typeof w=="string"?"string":"hash"]:U.map}function _(y){for(var w=ni(y),U=w.length;U--;){var ne=w[U],Pe=y[ne];w[U]=[ne,Pe,pe(Pe)]}return w}function T(y,w){var U=Sr(y,w);return qi(U)?U:void 0}var R=ds;(jr&&R(new jr(new ArrayBuffer(1)))!=Ge||pt&&R(new pt)!=V||wn&&R(wn.resolve())!=fe||Tr&&R(new Tr)!=ye||Hr&&R(new Hr)!=He)&&(R=function(y){var w=Z.call(y),U=w==ce?y.constructor:void 0,ne=U?Ve(U):void 0;if(ne)switch(ne){case $s:return Ge;case Vs:return V;case fs:return fe;case Fs:return ye;case Gr:return He}return w});function P(y,w,U){w=G(w,y)?[w]:Dr(w);for(var ne,Pe=-1,Ue=w.length;++Pe<Ue;){var be=de(w[Pe]);if(!(ne=y!=null&&U(y,be)))break;y=y[be]}if(ne)return ne;var Ue=y?y.length:0;return!!Ue&&Ji(Ue)&&F(be,Ue)&&(It(y)||vt(y))}function F(y,w){return w=w??c,!!w&&(typeof y=="number"||Fr.test(y))&&y>-1&&y%1==0&&y<w}function G(y,w){if(It(y))return!1;var U=typeof y;return U=="number"||U=="symbol"||U=="boolean"||y==null||Qi(y)?!0:Se.test(y)||!Ne.test(y)||w!=null&&y in Object(w)}function Q(y){var w=typeof y;return w=="string"||w=="number"||w=="symbol"||w=="boolean"?y!=="__proto__":y===null}function z(y){return!!k&&k in y}function ge(y){var w=y&&y.constructor,U=typeof w=="function"&&w.prototype||O;return y===U}function pe(y){return y===y&&!Yr(y)}function ie(y,w){return function(U){return U==null?!1:U[y]===w&&(w!==void 0||y in Object(U))}}var K=at(function(y){y=Uc(y);var w=[];return Ze.test(y)&&w.push(""),y.replace(Fe,function(U,ne,Pe,be){w.push(Pe?be.replace(_t,"$1"):ne||U)}),w});function de(y){if(typeof y=="string"||Qi(y))return y;var w=y+"";return w=="0"&&1/y==-1/0?"-0":w}function Ve(y){if(y!=null){try{return $.call(y)}catch{}try{return y+""}catch{}}return""}function at(y,w){if(typeof y!="function"||w&&typeof w!="function")throw new TypeError(r);var U=function(){var ne=arguments,Pe=w?w.apply(this,ne):ne[0],be=U.cache;if(be.has(Pe))return be.get(Pe);var Ue=y.apply(this,ne);return U.cache=be.set(Pe,Ue),Ue};return U.cache=new(at.Cache||rn),U}at.Cache=rn;function St(y,w){return y===w||y!==y&&w!==w}function vt(y){return Cc(y)&&j.call(y,"callee")&&(!ze.call(y,"callee")||Z.call(y)==h)}var It=Array.isArray;function so(y){return y!=null&&Ji(y.length)&&!Xi(y)}function Cc(y){return ti(y)&&so(y)}function Xi(y){var w=Yr(y)?Z.call(y):"";return w==M||w==Y}function Ji(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=c}function Yr(y){var w=typeof y;return!!y&&(w=="object"||w=="function")}function ti(y){return!!y&&typeof y=="object"}function Qi(y){return typeof y=="symbol"||ti(y)&&Z.call(y)==Je}var io=Er?dn(Er):Yi;function Uc(y){return y==null?"":Qn(y)}function $c(y,w,U){var ne=y==null?void 0:ei(y,w);return ne===void 0?U:ne}function Vc(y,w){return y!=null&&P(y,w,Yn)}function ni(y){return so(y)?An(y):qt(y)}function Fc(y,w,U){var ne=It(y)||io(y);if(w=an(w),U==null)if(ne||Yr(y)){var Pe=y.constructor;ne?U=It(y)?new Pe:[]:U=Xi(Pe)?qr(ke(y)):{}}else U={};return(ne?$n:Qs)(y,function(be,Ue,gt){return w(U,be,Ue,gt)}),U}function jc(y){return y}function Hc(y){return G(y)?Wn(de(y)):Jn(y)}n.exports=Fc}(ms,ms.exports)),ms.exports}var jd=Fd(),Hd=Pa(jd);class Bl{constructor(e,t,r,s){this.platform=Dn.DESKTOP,this.instanceId="123456789012345678",this.configuration=xl(),this.source=null,this.sourceOrigin="",this.sdkVersion="mock",this.mobileAppVersion="unknown",this.frameId="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",this.eventBus=new Zo,this.clientId=e,this.commands=this._updateCommandMocks({}),this.guildId=t,this.channelId=r,this.locationId=s,this.customId=null,this.referrerId=null}_updateCommandMocks(e){return this.commands=Hd(Object.assign({},Gd,e),(t,r,s)=>{t[s]=async(...i)=>(console.info(`DiscordSDKMock: ${String(s)}(${JSON.stringify(i)})`),await r(...i))}),this.commands}emitReady(){this.emitEvent("READY",void 0)}close(...e){console.info(`DiscordSDKMock: close(${JSON.stringify(e)})`)}ready(){return Promise.resolve()}async subscribe(e,t,...r){return await this.eventBus.on(e,t)}async unsubscribe(e,t,...r){return await this.eventBus.off(e,t)}emitEvent(e,t){this.eventBus.emit(e,t)}}const Gd={authorize:()=>Promise.resolve({code:"mock_code"}),authenticate:()=>Promise.resolve({access_token:"mock_token",user:{username:"mock_user_username",discriminator:"mock_user_discriminator",id:"mock_user_id",avatar:null,public_flags:1},scopes:[],expires:new Date(2121,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}}),setActivity:()=>Promise.resolve({name:"mock_activity_name",type:0}),getChannel:()=>Promise.resolve({id:"mock_channel_id",name:"mock_channel_name",type:$a.GUILD_TEXT,voice_states:[],messages:[]}),getSkus:()=>Promise.resolve({skus:[]}),getEntitlements:()=>Promise.resolve({entitlements:[]}),startPurchase:()=>Promise.resolve([]),setConfig:()=>Promise.resolve({use_interactive_pip:!1}),userSettingsGetLocale:()=>Promise.resolve({locale:""}),openExternalLink:()=>Promise.resolve({opened:!1}),encourageHardwareAcceleration:()=>Promise.resolve({enabled:!0}),captureLog:()=>Promise.resolve(null),setOrientationLockState:()=>Promise.resolve(null),openInviteDialog:()=>Promise.resolve(null),getPlatformBehaviors:()=>Promise.resolve({iosKeyboardResizesView:!0}),getChannelPermissions:()=>Promise.resolve({permissions:tl(1234567890)}),openShareMomentDialog:()=>Promise.resolve(null),shareLink:()=>Promise.resolve({success:!1}),initiateImageUpload:()=>Promise.resolve({image_url:"https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0b52aa9e99b832574a53_full_logo_blurple_RGB.png"}),getInstanceConnectedParticipants:()=>Promise.resolve({participants:[]})};var vn={};ArrayBuffer.isView||(ArrayBuffer.isView=n=>n!==null&&typeof n=="object"&&n.buffer instanceof ArrayBuffer);typeof FormData>"u"&&(Go.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var Ha={},Ta=function(n,e){return Ta=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])},Ta(n,e)};function Ml(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ta(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ai=function(){return Ai=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ai.apply(this,arguments)};function Cl(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function Ul(n,e,t,r){var s=arguments.length,i=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(l=n[c])&&(i=(s<3?l(i):s>3?l(e,t,i):l(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i}function $l(n,e){return function(t,r){e(t,r,n)}}function Vl(n,e,t,r,s,i){function l(ce){if(ce!==void 0&&typeof ce!="function")throw new TypeError("Function expected");return ce}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",f=!e&&n?r.static?n:n.prototype:null,p=e||(f?Object.getOwnPropertyDescriptor(f,r.name):{}),d,S=!1,M=t.length-1;M>=0;M--){var Y={};for(var V in r)Y[V]=V==="access"?{}:r[V];for(var V in r.access)Y.access[V]=r.access[V];Y.addInitializer=function(ce){if(S)throw new TypeError("Cannot add initializers after decoration has completed");i.push(l(ce||null))};var H=(0,t[M])(c==="accessor"?{get:p.get,set:p.set}:p[h],Y);if(c==="accessor"){if(H===void 0)continue;if(H===null||typeof H!="object")throw new TypeError("Object expected");(d=l(H.get))&&(p.get=d),(d=l(H.set))&&(p.set=d),(d=l(H.init))&&s.unshift(d)}else(d=l(H))&&(c==="field"?s.unshift(d):p[h]=d)}f&&Object.defineProperty(f,r.name,p),S=!0}function Fl(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0}function jl(n){return typeof n=="symbol"?n:"".concat(n)}function Hl(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function Gl(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function Zl(n,e,t,r){function s(i){return i instanceof t?i:new t(function(l){l(i)})}return new(t||(t=Promise))(function(i,l){function c(p){try{f(r.next(p))}catch(d){l(d)}}function h(p){try{f(r.throw(p))}catch(d){l(d)}}function f(p){p.done?i(p.value):s(p.value).then(c,h)}f((r=r.apply(n,e||[])).next())})}function zl(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,l=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return l.next=c(0),l.throw=c(1),l.return=c(2),typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function c(f){return function(p){return h([f,p])}}function h(f){if(r)throw new TypeError("Generator is already executing.");for(;l&&(l=0,f[0]&&(t=0)),t;)try{if(r=1,s&&(i=f[0]&2?s.return:f[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,f[1])).done)return i;switch(s=0,i&&(f=[f[0]&2,i.value]),f[0]){case 0:case 1:i=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,s=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){t.label=f[1];break}if(f[0]===6&&t.label<i[1]){t.label=i[1],i=f;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(f);break}i[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(n,t)}catch(p){f=[6,p],s=0}finally{r=i=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}var ki=Object.create?function(n,e,t,r){r===void 0&&(r=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,s)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]};function Kl(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&ki(e,n,t)}function Ii(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ga(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),s,i=[],l;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)i.push(s.value)}catch(c){l={error:c}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(l)throw l.error}}return i}function Wl(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Ga(arguments[e]));return n}function ql(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),s=0,e=0;e<t;e++)for(var i=arguments[e],l=0,c=i.length;l<c;l++,s++)r[s]=i[l];return r}function Yl(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}function as(n){return this instanceof as?(this.v=n,this):new as(n)}function Xl(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",l),s[Symbol.asyncIterator]=function(){return this},s;function l(M){return function(Y){return Promise.resolve(Y).then(M,d)}}function c(M,Y){r[M]&&(s[M]=function(V){return new Promise(function(H,ce){i.push([M,V,H,ce])>1||h(M,V)})},Y&&(s[M]=Y(s[M])))}function h(M,Y){try{f(r[M](Y))}catch(V){S(i[0][3],V)}}function f(M){M.value instanceof as?Promise.resolve(M.value.v).then(p,d):S(i[0][2],M)}function p(M){h("next",M)}function d(M){h("throw",M)}function S(M,Y){M(Y),i.shift(),i.length&&h(i[0][0],i[0][1])}}function Jl(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(l){return(t=!t)?{value:as(n[s](l)),done:!1}:i?i(l):l}:i}}function Ql(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Ii=="function"?Ii(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(l){return new Promise(function(c,h){l=n[i](l),s(c,h,l.done,l.value)})}}function s(i,l,c,h){Promise.resolve(h).then(function(f){i({value:f,done:c})},l)}}function ec(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var Zd=Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e},Aa=function(n){return Aa=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},Aa(n)};function tc(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t=Aa(n),r=0;r<t.length;r++)t[r]!=="default"&&ki(e,n,t[r]);return Zd(e,n),e}function nc(n){return n&&n.__esModule?n:{default:n}}function rc(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function sc(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t}function ic(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function ac(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e}var zd=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r};function oc(n){function e(i){n.error=n.hasError?new zd(i,n.error,"An error was suppressed during disposal."):i,n.hasError=!0}var t,r=0;function s(){for(;t=n.stack.pop();)try{if(!t.async&&r===1)return r=0,n.stack.push(t),Promise.resolve().then(s);if(t.dispose){var i=t.dispose.call(t.value);if(t.async)return r|=2,Promise.resolve(i).then(s,function(l){return e(l),s()})}else r|=1}catch(l){e(l)}if(r===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return s()}function lc(n,e){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,s,i,l){return r?e?".jsx":".js":s&&(!i||!l)?t:s+i+"."+l.toLowerCase()+"js"}):n}const Kd={__extends:Ml,__assign:Ai,__rest:Cl,__decorate:Ul,__param:$l,__esDecorate:Vl,__runInitializers:Fl,__propKey:jl,__setFunctionName:Hl,__metadata:Gl,__awaiter:Zl,__generator:zl,__createBinding:ki,__exportStar:Kl,__values:Ii,__read:Ga,__spread:Wl,__spreadArrays:ql,__spreadArray:Yl,__await:as,__asyncGenerator:Xl,__asyncDelegator:Jl,__asyncValues:Ql,__makeTemplateObject:ec,__importStar:tc,__importDefault:nc,__classPrivateFieldGet:rc,__classPrivateFieldSet:sc,__classPrivateFieldIn:ic,__addDisposableResource:ac,__disposeResources:oc,__rewriteRelativeImportExtension:lc},Wd=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:ac,get __assign(){return Ai},__asyncDelegator:Jl,__asyncGenerator:Xl,__asyncValues:Ql,__await:as,__awaiter:Zl,__classPrivateFieldGet:rc,__classPrivateFieldIn:ic,__classPrivateFieldSet:sc,__createBinding:ki,__decorate:Ul,__disposeResources:oc,__esDecorate:Vl,__exportStar:Kl,__extends:Ml,__generator:zl,__importDefault:nc,__importStar:tc,__makeTemplateObject:ec,__metadata:Gl,__param:$l,__propKey:jl,__read:Ga,__rest:Cl,__rewriteRelativeImportExtension:lc,__runInitializers:Fl,__setFunctionName:Hl,__spread:Wl,__spreadArray:Yl,__spreadArrays:ql,__values:Ii,default:Kd},Symbol.toStringTag,{value:"Module"})),Li=Ra(Wd);var Ms={};(function(n){n.CloseCode=void 0,function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(n.CloseCode||(n.CloseCode={}));class e extends Error{constructor(r,s){super(s),this.name="ServerError",this.code=r}}n.ServerError=e})(Ms);var Za={},uc={},fc={},Ia={exports:{}};(function(n,e){(function(t,r){r(e)})(Go,function(t){t.OPERATION=void 0,function(v){v[v.ADD=128]="ADD",v[v.REPLACE=0]="REPLACE",v[v.DELETE=64]="DELETE",v[v.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",v[v.MOVE_AND_ADD=160]="MOVE_AND_ADD",v[v.DELETE_AND_ADD=192]="DELETE_AND_ADD",v[v.CLEAR=10]="CLEAR",v[v.REVERSE=15]="REVERSE",v[v.MOVE=32]="MOVE",v[v.DELETE_BY_REFID=33]="DELETE_BY_REFID",v[v.ADD_BY_REFID=129]="ADD_BY_REFID"}(t.OPERATION||(t.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const i=Symbol("$track"),l=Symbol("$encoder"),c=Symbol("$decoder"),h=Symbol("$filter"),f=Symbol("$getByIndex"),p=Symbol("$deleteByIndex"),d=Symbol("$changes"),S=Symbol("$childType"),M=Symbol("$onEncodeEnd"),Y=Symbol("$onDecodeEnd"),V=Symbol("$descriptors"),H="$__numFields",ce="$__refTypeFieldIndexes",fe="$__viewFieldIndexes",te="$__fieldIndexesByViewTag";let ye;try{ye=new TextEncoder}catch{}const Xe=new ArrayBuffer(8),Je=new Int32Array(Xe),He=new Float32Array(Xe),tt=new Float64Array(Xe),Ge=new BigInt64Array(Xe),Qe=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(v,a){for(var o=0,u=0,m=0,_=v.length;m<_;m++)o=v.charCodeAt(m),o<128?u+=1:o<2048?u+=2:o<55296||o>=57344?u+=3:(m++,u+=4);return u};function $e(v,a,o){for(var u=0,m=0,_=a.length;m<_;m++)u=a.charCodeAt(m),u<128?v[o.offset++]=u:u<2048?(v[o.offset]=192|u>>6,v[o.offset+1]=128|u&63,o.offset+=2):u<55296||u>=57344?(v[o.offset]=224|u>>12,v[o.offset+1]=128|u>>6&63,v[o.offset+2]=128|u&63,o.offset+=3):(m++,u=65536+((u&1023)<<10|a.charCodeAt(m)&1023),v[o.offset]=240|u>>18,v[o.offset+1]=128|u>>12&63,v[o.offset+2]=128|u>>6&63,v[o.offset+3]=128|u&63,o.offset+=4)}function B(v,a,o){v[o.offset++]=a&255}function J(v,a,o){v[o.offset++]=a&255}function W(v,a,o){v[o.offset++]=a&255,v[o.offset++]=a>>8&255}function q(v,a,o){v[o.offset++]=a&255,v[o.offset++]=a>>8&255}function ee(v,a,o){v[o.offset++]=a&255,v[o.offset++]=a>>8&255,v[o.offset++]=a>>16&255,v[o.offset++]=a>>24&255}function me(v,a,o){const u=a>>24,m=a>>16,_=a>>8,T=a;v[o.offset++]=T&255,v[o.offset++]=_&255,v[o.offset++]=m&255,v[o.offset++]=u&255}function Ne(v,a,o){const u=Math.floor(a/Math.pow(2,32)),m=a>>>0;me(v,m,o),me(v,u,o)}function Se(v,a,o){const u=a/Math.pow(2,32)>>0,m=a>>>0;me(v,m,o),me(v,u,o)}function Ze(v,a,o){Ge[0]=BigInt.asIntN(64,a),ee(v,Je[0],o),ee(v,Je[1],o)}function Fe(v,a,o){Ge[0]=BigInt.asIntN(64,a),ee(v,Je[0],o),ee(v,Je[1],o)}function it(v,a,o){He[0]=a,ee(v,Je[0],o)}function _t(v,a,o){tt[0]=a,ee(v,Je[0],o),ee(v,Je[1],o)}function Rt(v,a,o){v[o.offset++]=a?1:0}function Fr(v,a,o){a||(a="");let u=Qe(a,"utf8"),m=0;if(u<32)v[o.offset++]=u|160,m=1;else if(u<256)v[o.offset++]=217,v[o.offset++]=u%255,m=2;else if(u<65536)v[o.offset++]=218,q(v,u,o),m=3;else if(u<4294967296)v[o.offset++]=219,me(v,u,o),m=5;else throw new Error("String too long");return $e(v,a,o),m+u}function Ye(v,a,o){if(isNaN(a))return Ye(v,0,o);if(isFinite(a)){if(a!==(a|0))return Math.abs(a)<=34028235e31&&(He[0]=a,Math.abs(Math.abs(He[0])-Math.abs(a))<1e-4)?(v[o.offset++]=202,it(v,a,o),5):(v[o.offset++]=203,_t(v,a,o),9)}else return Ye(v,a>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,o);return a>=0?a<128?(v[o.offset++]=a&255,1):a<256?(v[o.offset++]=204,v[o.offset++]=a&255,2):a<65536?(v[o.offset++]=205,q(v,a,o),3):a<4294967296?(v[o.offset++]=206,me(v,a,o),5):(v[o.offset++]=207,Se(v,a,o),9):a>=-32?(v[o.offset++]=224|a+32,1):a>=-128?(v[o.offset++]=208,B(v,a,o),2):a>=-32768?(v[o.offset++]=209,W(v,a,o),3):a>=-2147483648?(v[o.offset++]=210,ee(v,a,o),5):(v[o.offset++]=211,Ne(v,a,o),9)}const yt={int8:B,uint8:J,int16:W,uint16:q,int32:ee,uint32:me,int64:Ne,uint64:Se,bigint64:Ze,biguint64:Fe,float32:it,float64:_t,boolean:Rt,string:Fr,number:Ye,utf8Write:$e,utf8Length:Qe},Un=new ArrayBuffer(8),ht=new Int32Array(Un),mr=new Float32Array(Un),yr=new Float64Array(Un),vr=new BigUint64Array(Un),br=new BigInt64Array(Un);function _r(v,a,o){for(var u="",m=0,_=a.offset,T=a.offset+o;_<T;_++){var R=v[_];if(!(R&128)){u+=String.fromCharCode(R);continue}if((R&224)===192){u+=String.fromCharCode((R&31)<<6|v[++_]&63);continue}if((R&240)===224){u+=String.fromCharCode((R&15)<<12|(v[++_]&63)<<6|(v[++_]&63)<<0);continue}if((R&248)===240){m=(R&7)<<18|(v[++_]&63)<<12|(v[++_]&63)<<6|(v[++_]&63)<<0,m>=65536?(m-=65536,u+=String.fromCharCode((m>>>10)+55296,(m&1023)+56320)):u+=String.fromCharCode(m);continue}console.error("Invalid byte "+R.toString(16))}return a.offset+=o,u}function Er(v,a){return $n(v,a)<<24>>24}function $n(v,a){return v[a.offset++]}function wr(v,a){return Wn(v,a)<<16>>16}function Wn(v,a){return v[a.offset++]|v[a.offset++]<<8}function Et(v,a){return v[a.offset++]|v[a.offset++]<<8|v[a.offset++]<<16|v[a.offset++]<<24}function dn(v,a){return Et(v,a)>>>0}function Sr(v,a){return ht[0]=Et(v,a),mr[0]}function qn(v,a){return ht[0]=Et(v,a),ht[1]=Et(v,a),yr[0]}function Te(v,a){const o=dn(v,a);return Et(v,a)*Math.pow(2,32)+o}function Kt(v,a){const o=dn(v,a);return dn(v,a)*Math.pow(2,32)+o}function g(v,a){return ht[0]=Et(v,a),ht[1]=Et(v,a),br[0]}function b(v,a){return ht[0]=Et(v,a),ht[1]=Et(v,a),vr[0]}function A(v,a){return $n(v,a)>0}function O(v,a){const o=v[a.offset++];let u;return o<192?u=o&31:o===217?u=$n(v,a):o===218?u=Wn(v,a):o===219&&(u=dn(v,a)),_r(v,a,u)}function C(v,a){const o=v[a.offset++];if(o<128)return o;if(o===202)return Sr(v,a);if(o===203)return qn(v,a);if(o===204)return $n(v,a);if(o===205)return Wn(v,a);if(o===206)return dn(v,a);if(o===207)return Kt(v,a);if(o===208)return Er(v,a);if(o===209)return wr(v,a);if(o===210)return Et(v,a);if(o===211)return Te(v,a);if(o>223)return(255-o+1)*-1}function k(v,a){const o=v[a.offset];return o<192&&o>160||o===217||o===218||o===219}const $={utf8Read:_r,int8:Er,uint8:$n,int16:wr,uint16:Wn,int32:Et,uint32:dn,float32:Sr,float64:qn,int64:Te,uint64:Kt,bigint64:g,biguint64:b,boolean:A,string:O,number:C,stringCheck:k},j={},Z=new Map;function ve(v,a){a.constructor&&(Z.set(a.constructor,v),j[v]=a),a.encode&&(yt[v]=a.encode),a.decode&&($[v]=a.decode)}function Re(v){return j[v]}function xe(v){for(const a in v)ve(a,v[a]);return a=>Wt(a)}const an=class an{static register(a){const o=Object.getPrototypeOf(a);if(o!==ft){let u=an.inheritedTypes.get(o);u||(u=new Set,an.inheritedTypes.set(o,u)),u.add(a)}}static cache(a){let o=an.cachedContexts.get(a);return o||(o=new an(a),an.cachedContexts.set(a,o)),o}constructor(a){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},a&&this.discoverTypes(a)}has(a){return this.schemas.has(a)}get(a){return this.types[a]}add(a,o=this.schemas.size){return this.schemas.has(a)?!1:(this.types[o]=a,a[Symbol.metadata]===void 0&&ze.initialize(a),this.schemas.set(a,o),!0)}getTypeId(a){return this.schemas.get(a)}discoverTypes(a,o,u,m){var R,P;if(m&&this.registerFilteredByParent(a,o,u),!this.add(a))return;(R=an.inheritedTypes.get(a))==null||R.forEach(F=>{this.discoverTypes(F,o,u,m)});let _=a;for(;(_=Object.getPrototypeOf(_))&&_!==ft&&_!==Function.prototype;)this.discoverTypes(_);const T=a[P=Symbol.metadata]??(a[P]={});T[fe]&&(this.hasFilters=!0);for(const F in T){const G=F,Q=T[G].type,z=T[G].tag!==void 0;if(typeof Q!="string")if(Array.isArray(Q)){const ge=Q[0];if(ge==="string")continue;this.discoverTypes(ge,a,G,m||z)}else if(typeof Q=="function")this.discoverTypes(Q,a,G,m||z);else{const ge=Object.values(Q)[0];if(typeof ge=="string")continue;this.discoverTypes(ge,a,G,m||z)}}}registerFilteredByParent(a,o,u){let _=`${this.schemas.get(a)??this.schemas.size}`;o&&(_+=`-${this.schemas.get(o)}`),_+=`-${u}`,this.parentFiltered[_]=!0}debug(){let a="";for(const o in this.parentFiltered){const u=o.split("-").map(Number),m=u.pop();a+=`
		`,a+=`${o}: ${u.reverse().map((_,T)=>{const R=this.types[_],P=R[Symbol.metadata];let F=R.name;return T===0&&(F+=`[${P[m].name}]`),`${F}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${a}`}};an.inheritedTypes=new Map,an.cachedContexts=new Map;let ke=an;function At(v){return Array.isArray(v)?{array:v[0]}:typeof v.type<"u"?v.type:v}const ze={addField(v,a,o,u,m){if(a>64)throw new Error(`Can't define field '${o}'.
Schema instances may only have up to 64 fields.`);v[a]=Object.assign(v[a]||{},{type:At(u),index:a,name:o}),Object.defineProperty(v,V,{value:v[V]||{},enumerable:!1,configurable:!0}),m?(v[V][o]=m,v[V][`_${o}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):v[V][o]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(v,H,{value:a,enumerable:!1,configurable:!0}),Object.defineProperty(v,o,{value:a,enumerable:!1,configurable:!0}),typeof v[a].type!="string"&&(v[ce]===void 0&&Object.defineProperty(v,ce,{value:[],enumerable:!1,configurable:!0}),v[ce].push(a))},setTag(v,a,o){const u=v[a],m=v[u];m.tag=o,v[fe]||(Object.defineProperty(v,fe,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(v,te,{value:{},enumerable:!1,configurable:!0})),v[fe].push(u),v[te][o]||(v[te][o]=[]),v[te][o].push(u)},setFields(v,a){const o=v.prototype.constructor;ke.register(o);const u=Object.getPrototypeOf(o),m=u&&u[Symbol.metadata],_=ze.initialize(o);o[i]||(o[i]=ft[i]),o[l]||(o[l]=ft[l]),o[c]||(o[c]=ft[c]),o.prototype.toJSON||(o.prototype.toJSON=ft.prototype.toJSON);let T=_[H]??(m&&m[H])??-1;T++;for(const R in a){const P=a[R],F=Array.isArray(P)?Re("array"):typeof Object.keys(P)[0]=="string"&&Re(Object.keys(P)[0]),G=F?Object.values(P)[0]:At(P);ze.addField(_,T,R,P,rn(`_${R}`,T,G,F)),T++}return v},isDeprecated(v,a){return v[a].deprecated===!0},init(v){const a={};v[Symbol.metadata]=a,Object.defineProperty(a,H,{value:0,enumerable:!1,configurable:!0})},initialize(v){const a=Object.getPrototypeOf(v),o=a[Symbol.metadata];let u=v[Symbol.metadata]??Object.create(null);return a!==ft&&u===o&&(u=Object.create(null),o&&(Object.setPrototypeOf(u,o),Object.defineProperty(u,H,{value:o[H],enumerable:!1,configurable:!0,writable:!0}),o[fe]!==void 0&&(Object.defineProperty(u,fe,{value:[...o[fe]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(u,te,{value:{...o[te]},enumerable:!1,configurable:!0,writable:!0})),o[ce]!==void 0&&Object.defineProperty(u,ce,{value:[...o[ce]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(u,V,{value:{...o[V]},enumerable:!1,configurable:!0,writable:!0}))),v[Symbol.metadata]=u,u},isValidInstance(v){return v.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(v.constructor[Symbol.metadata],H)},getFields(v){const a=v[Symbol.metadata],o={};for(let u=0;u<=a[H];u++)o[a[u].name]=a[u].type;return o},hasViewTagAtIndex(v,a){var o;return(o=v==null?void 0:v[fe])==null?void 0:o.includes(a)}};function En(){return{indexes:{},operations:[]}}function wt(v,a){const o=v.indexes[a];o===void 0?v.indexes[a]=v.operations.push(a)-1:v.operations[o]=a}function jr(v,a){var u;let o=v.indexes[a];o===void 0&&(o=Object.values(v.indexes).at(-1),a=(u=Object.entries(v.indexes).find(([m,_])=>_===o))==null?void 0:u[0]),v.operations[o]=void 0,delete v.indexes[a]}function pt(v,a,o,u=a[o].queueRootIndex){if(v)v[o][u]!==a&&(a[o].queueRootIndex=v[o].push(a)-1);else return}class wn{constructor(a){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=a;const o=a.constructor[Symbol.metadata];o!=null&&o[fe]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(a){var u;this.root=a,this.checkIsFiltered(this.parent,this.parentIndex);const o=this.ref.constructor[Symbol.metadata];o?(u=o[ce])==null||u.forEach(m=>{var R;const _=o[m],T=(R=this.ref[_.name])==null?void 0:R[d];T&&(T.root!==a?T.setRoot(a):a.add(T))}):this.ref[S]&&typeof this.ref[S]!="string"&&this.ref.forEach((m,_)=>{const T=m[d];T.root!==a?T.setRoot(a):a.add(T)})}setParent(a,o,u){var _;if(this.parent=a,this.parentIndex=u,!o)return;o!==this.root?(this.root=o,this.checkIsFiltered(a,u)):o.add(this);const m=this.ref.constructor[Symbol.metadata];m?(_=m[ce])==null||_.forEach(T=>{var F;const R=m[T],P=(F=this.ref[R.name])==null?void 0:F[d];P&&P.root!==o&&P.setParent(this.ref,o,T)}):this.ref[S]&&typeof this.ref[S]!="string"&&this.ref.forEach((T,R)=>{const P=T[d];P.root!==o&&P.setParent(this.ref,o,this.indexes[R]??R)})}forEachChild(a){var u;const o=this.ref.constructor[Symbol.metadata];o?(u=o[ce])==null||u.forEach(m=>{const _=o[m],T=this.ref[_.name];T&&a(T[d],m)}):this.ref[S]&&typeof this.ref[S]!="string"&&this.ref.forEach((m,_)=>{a(m[d],this.indexes[_]??_)})}operation(a){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-a),pt(this.root,this,"filteredChanges")):(this.changes.operations.push(-a),pt(this.root,this,"changes"))}change(a,o=t.OPERATION.ADD){var R;const u=this.ref.constructor[Symbol.metadata],m=this.isFiltered||((R=u==null?void 0:u[a])==null?void 0:R.tag)!==void 0,_=m?this.filteredChanges:this.changes,T=this.indexedOperations[a];if(!T||T===t.OPERATION.DELETE){const P=T&&T===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:o;this.indexedOperations[a]=P}wt(_,a),m?(wt(this.allFilteredChanges,a),this.root&&(pt(this.root,this,"filteredChanges"),pt(this.root,this,"allFilteredChanges"))):(wt(this.allChanges,a),pt(this.root,this,"changes"))}shiftChangeIndexes(a){const o=this.isFiltered?this.filteredChanges:this.changes,u={},m={};for(const _ in this.indexedOperations)u[Number(_)+a]=this.indexedOperations[_],m[Number(_)+a]=o.indexes[_];this.indexedOperations=u,o.indexes=m,o.operations=o.operations.map(_=>_+a)}shiftAllChangeIndexes(a,o=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(a,o,this.allFilteredChanges),this._shiftAllChangeIndexes(a,o,this.allChanges)):this._shiftAllChangeIndexes(a,o,this.allChanges)}_shiftAllChangeIndexes(a,o=0,u){const m={};let _=0;for(const T in u.indexes)m[_++]=u.indexes[T];u.indexes=m;for(let T=0;T<u.operations.length;T++){const R=u.operations[T];R>o&&(u.operations[T]=R+a)}}indexedOperation(a,o,u=a){this.indexedOperations[a]=o,this.filteredChanges!==void 0?(wt(this.allFilteredChanges,u),wt(this.filteredChanges,a),pt(this.root,this,"filteredChanges")):(wt(this.allChanges,u),wt(this.changes,a),pt(this.root,this,"changes"))}getType(a){return ze.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][a].type:this.ref[S]}getChange(a){return this.indexedOperations[a]}getValue(a,o=!1){return this.ref[f](a,o)}delete(a,o,u=a){var T;if(a===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${a}'`)}catch(R){console.warn(R)}return}const m=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[a]=o??t.OPERATION.DELETE,wt(m,a),jr(this.allChanges,u);const _=this.getValue(a);return _&&_[d]&&((T=this.root)==null||T.remove(_[d])),this.filteredChanges!==void 0?(jr(this.allFilteredChanges,u),pt(this.root,this,"filteredChanges")):pt(this.root,this,"changes"),_}endEncode(a){var o,u;this.indexedOperations={},this[a].indexes={},this[a].operations.length=0,this[a].queueRootIndex=void 0,(u=(o=this.ref)[M])==null||u.call(o),this.isNew=!1}discard(a=!1){var o,u;(u=(o=this.ref)[M])==null||u.call(o),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),a&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0))}discardAll(){const a=Object.keys(this.indexedOperations);for(let o=0,u=a.length;o<u;o++){const m=this.getValue(Number(a[o]));m&&m[d]&&m[d].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(a,o){const u=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(a,o),this.filteredChanges!==void 0&&(pt(this.root,this,"filteredChanges"),u&&this.root.allFilteredChanges.push(this))),this.isFiltered||(pt(this.root,this,"changes"),u&&this.root.allChanges.push(this))}_checkFilteredByParent(a,o){if(!a)return;const u=ze.isValidInstance(this.ref)?this.ref.constructor:this.ref[S];let m,_=!ze.isValidInstance(a);_?(m=a[d],a=m.parent,o=m.parentIndex):m=a[d];const T=a.constructor;let R=`${this.root.types.getTypeId(u)}`;T&&(R+=`-${this.root.types.schemas.get(T)}`),R+=`-${o}`;const P=ze.hasViewTagAtIndex(T==null?void 0:T[Symbol.metadata],o);this.isFiltered=a[d].isFiltered||this.root.types.parentFiltered[R]||P,this.isFiltered&&(this.isVisibilitySharedWithParent=m.isFiltered&&typeof u!="string"&&!P&&_,this.filteredChanges||(this.filteredChanges=En(),this.allFilteredChanges=En()),this.changes.operations.length>0&&(this.changes.operations.forEach(F=>wt(this.filteredChanges,F)),this.allChanges.operations.forEach(F=>wt(this.allFilteredChanges,F)),this.changes=En(),this.allChanges=En()))}}function Tr(v,a,o,u,m,_){var T;typeof o=="string"?(T=yt[o])==null||T.call(yt,a,u,_):o[Symbol.metadata]!==void 0?(yt.number(a,u[d].refId,_),(m&t.OPERATION.ADD)===t.OPERATION.ADD&&v.tryEncodeTypeId(a,o,u.constructor,_)):yt.number(a,u[d].refId,_)}const Hr=function(v,a,o,u,m,_,T,R,P){if(a[_.offset++]=(u|m)&255,m===t.OPERATION.DELETE)return;const F=o.ref,G=P[u];Tr(v,a,P[u].type,F[G.name],m,_)},Sn=function(v,a,o,u,m,_){if(a[_.offset++]=m&255,m===t.OPERATION.CLEAR||(yt.number(a,u,_),m===t.OPERATION.DELETE))return;const T=o.ref;if((m&t.OPERATION.ADD)===t.OPERATION.ADD&&typeof T.set=="function"){const F=o.ref.$indexes.get(u);yt.string(a,F,_)}const R=T[S],P=T[f](u);Tr(v,a,R,P,m,_)},$s=function(v,a,o,u,m,_,T,R){const P=o.ref,F=R&&o.isFiltered&&typeof o.getType(u)!="string";let G;if(F?(G=P.tmpItems[u][d].refId,m===t.OPERATION.DELETE?m=t.OPERATION.DELETE_BY_REFID:m===t.OPERATION.ADD&&(m=t.OPERATION.ADD_BY_REFID)):G=u,a[_.offset++]=m&255,m===t.OPERATION.CLEAR||m===t.OPERATION.REVERSE||(yt.number(a,G,_),m===t.OPERATION.DELETE||m===t.OPERATION.DELETE_BY_REFID))return;const Q=o.getType(u),z=o.getValue(u,T);Tr(v,a,Q,z,m,_)},Vs=-1;function fs(v,a,o,u,m,_,T,R){const P=v.root,F=o[f](u);let G;if((a&t.OPERATION.DELETE)===t.OPERATION.DELETE){const Q=P.refIds.get(F);Q!==void 0&&P.removeRef(Q),a!==t.OPERATION.DELETE_AND_ADD&&o[p](u),G=void 0}if(a!==t.OPERATION.DELETE)if(ft.is(m)){const Q=$.number(_,T);if(G=P.refs.get(Q),(a&t.OPERATION.ADD)===t.OPERATION.ADD){const z=v.getInstanceType(_,T,m);G||(G=v.createInstanceOfType(z)),P.addRef(Q,G,G!==F||a===t.OPERATION.DELETE_AND_ADD&&G===F)}}else if(typeof m=="string")G=$[m](_,T);else{const Q=Re(Object.keys(m)[0]),z=$.number(_,T),ge=P.refs.has(z)?F||P.refs.get(z):new Q.constructor;if(G=ge.clone(!0),G[S]=Object.values(m)[0],F){let pe=P.refIds.get(F);if(pe!==void 0&&z!==pe){const ie=F.entries();let K;for(;(K=ie.next())&&!K.done;){const[de,Ve]=K.value;typeof Ve=="object"&&(pe=P.refIds.get(Ve),P.removeRef(pe)),R.push({ref:F,refId:pe,op:t.OPERATION.DELETE,field:de,value:void 0,previousValue:Ve})}}}P.addRef(z,G,ge!==F||a===t.OPERATION.DELETE_AND_ADD&&ge===F)}return{value:G,previousValue:F}}const Fs=function(v,a,o,u,m){const _=a[o.offset++],T=u.constructor[Symbol.metadata],R=_>>6<<6,P=_%(R||255),F=T[P];if(F===void 0)return console.warn("@colyseus/schema: field not defined at",{index:P,ref:u.constructor.name,metadata:T}),Vs;const{value:G,previousValue:Q}=fs(v,R,u,P,F.type,a,o,m);G!=null&&(u[F.name]=G),Q!==G&&m.push({ref:u,refId:v.currentRefId,op:R,field:F.name,value:G,previousValue:Q})},Gr=function(v,a,o,u,m){const _=a[o.offset++];if(_===t.OPERATION.CLEAR){v.removeChildRefs(u,m),u.clear();return}const T=$.number(a,o),R=u[S];let P;(_&t.OPERATION.ADD)===t.OPERATION.ADD?typeof u.set=="function"?(P=$.string(a,o),u.setIndex(T,P)):P=T:P=u.getIndex(T);const{value:F,previousValue:G}=fs(v,_,u,T,R,a,o,m);if(F!=null){if(typeof u.set=="function")u.$items.set(P,F);else if(typeof u.$setAt=="function")u.$setAt(T,F,_);else if(typeof u.add=="function"){const Q=u.add(F);typeof Q=="number"&&u.setIndex(Q,Q)}}G!==F&&m.push({ref:u,refId:v.currentRefId,op:_,field:"",dynamicIndex:P,value:F,previousValue:G})},Zr=function(v,a,o,u,m){let _=a[o.offset++],T;if(_===t.OPERATION.CLEAR){v.removeChildRefs(u,m),u.clear();return}else if(_===t.OPERATION.REVERSE){u.reverse();return}else if(_===t.OPERATION.DELETE_BY_REFID){const Q=$.number(a,o),z=v.root.refs.get(Q);T=u.findIndex(ge=>ge===z),u[p](T),m.push({ref:u,refId:v.currentRefId,op:t.OPERATION.DELETE,field:"",dynamicIndex:T,value:void 0,previousValue:z});return}else if(_===t.OPERATION.ADD_BY_REFID){const Q=$.number(a,o),z=v.root.refs.get(Q);z&&(T=u.findIndex(ge=>ge===z)),(T===-1||T===void 0)&&(T=u.length)}else T=$.number(a,o);const R=u[S];let P=T;const{value:F,previousValue:G}=fs(v,_,u,T,R,a,o,m);F!=null&&F!==G&&u.$setAt(T,F,_),G!==F&&m.push({ref:u,refId:v.currentRefId,op:_,field:"",dynamicIndex:P,value:F,previousValue:G})};class zr extends Error{}function js(v,a,o,u){let m,_=!1;switch(a){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":m="number",isNaN(v)&&console.log(`trying to encode "NaN" in ${o.constructor.name}#${u}`);break;case"bigint64":case"biguint64":m="bigint";break;case"string":m="string",_=!0;break;case"boolean":return;default:return}if(typeof v!==m&&(!_||_&&v!==null)){let T=`'${JSON.stringify(v)}'${v&&v.constructor&&` (${v.constructor.name})`||""}`;throw new zr(`a '${m}' was expected, but ${T} was provided in ${o.constructor.name}#${u}`)}}function en(v,a,o,u){if(!(v instanceof a))throw new zr(`a '${a.name}' was expected, but '${v&&v.constructor.name}' was provided in ${o.constructor.name}#${u}`)}var Hs,Gs;const Hi=(v,a)=>{const o=v.toString(),u=a.toString();return o<u?-1:o>u?1:0},qt=class qt{static[(Hs=l,Gs=c,h)](a,o,u){var m;return!u||typeof a[S]=="string"||u.isChangeTreeVisible((m=a.tmpItems[o])==null?void 0:m[d])}static is(a){return Array.isArray(a)||a.array!==void 0}static from(a){return new qt(...Array.from(a))}constructor(...a){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,S,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const o=new Proxy(this,{get:(u,m)=>typeof m!="symbol"&&!isNaN(m)?this.items[m]:Reflect.get(u,m),set:(u,m,_)=>{var T;if(typeof m!="symbol"&&!isNaN(m)){if(_==null)u.$deleteAt(m);else{if(_[d]){en(_,u[S],u,m);const R=u.items[m];u.isMovingItems?(R!==void 0?_[d].isNew?u[d].indexedOperation(Number(m),t.OPERATION.MOVE_AND_ADD):(u[d].getChange(Number(m))&t.OPERATION.DELETE)===t.OPERATION.DELETE?u[d].indexedOperation(Number(m),t.OPERATION.DELETE_AND_MOVE):u[d].indexedOperation(Number(m),t.OPERATION.MOVE):_[d].isNew&&u[d].indexedOperation(Number(m),t.OPERATION.ADD),_[d].setParent(this,u[d].root,m)):u.$changeAt(Number(m),_),R!==void 0&&((T=R[d].root)==null||T.remove(R[d]))}else u.$changeAt(Number(m),_);u.items[m]=_,u.tmpItems[m]=_}return!0}else return Reflect.set(u,m,_)},deleteProperty:(u,m)=>(typeof m=="number"?u.$deleteAt(m):delete u[m],!0),has:(u,m)=>typeof m!="symbol"&&!isNaN(Number(m))?Reflect.has(this.items,m):Reflect.has(u,m)});return this[d]=new wn(o),this[d].indexes={},a.length>0&&this.push(...a),o}set length(a){a===0?this.clear():a<this.items.length?this.splice(a,this.length-a):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...a){var m;let o=this.tmpItems.length;const u=this[d];for(let _=0,T=a.length;_<T;_++,o++){const R=a[_];if(R==null)return;typeof R=="object"&&this[S]&&en(R,this[S],this,_),u.indexedOperation(o,t.OPERATION.ADD,this.items.length),this.items.push(R),this.tmpItems.push(R),(m=R[d])==null||m.setParent(this,u.root,o)}return o}pop(){let a=-1;for(let o=this.tmpItems.length-1;o>=0;o--)if(this.deletedIndexes[o]!==!0){a=o;break}if(!(a<0))return this[d].delete(a,void 0,this.items.length-1),this.deletedIndexes[a]=!0,this.items.pop()}at(a){return a<0&&(a+=this.length),this.items[a]}$changeAt(a,o){var _;if(o==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[a]===o)return;const u=this.items[a]!==void 0?typeof o=="object"?t.OPERATION.DELETE_AND_ADD:t.OPERATION.REPLACE:t.OPERATION.ADD,m=this[d];m.change(a,u),(_=o[d])==null||_.setParent(this,m.root,a)}$deleteAt(a,o){this[d].delete(a,o)}$setAt(a,o,u){a===0&&u===t.OPERATION.ADD&&this.items[a]!==void 0?this.items.unshift(o):u===t.OPERATION.DELETE_AND_MOVE?(this.items.splice(a,1),this.items[a]=o):this.items[a]=o}clear(){if(this.items.length===0)return;const a=this[d];a.forEachChild((o,u)=>{var m;(m=a.root)==null||m.remove(o)}),a.discard(!0),a.operation(t.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...a){return new qt(...this.items.concat(...a))}join(a){return this.items.join(a)}reverse(){return this[d].operation(t.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const a=this[d],o=this.tmpItems.findIndex(m=>m===this.items[0]),u=this.items.findIndex(m=>m===this.items[0]);return a.delete(o,t.OPERATION.DELETE,u),a.shiftAllChangeIndexes(-1,u),this.items.shift()}slice(a,o){const u=new qt;return u.push(...this.items.slice(a,o)),u}sort(a=Hi){this.isMovingItems=!0;const o=this[d];return this.items.sort(a).forEach((m,_)=>o.change(_,t.OPERATION.REPLACE)),this.tmpItems.sort(a),this.isMovingItems=!1,this}splice(a,o,...u){var F;const m=this[d],_=this.items.length,T=this.tmpItems.length,R=u.length,P=[];for(let G=0;G<T;G++)this.deletedIndexes[G]!==!0&&P.push(G);if(_>a){o===void 0&&(o=_-a);for(let G=a;G<a+o;G++){const Q=P[G];m.delete(Q,t.OPERATION.DELETE),this.deletedIndexes[Q]=!0}}else o=0;if(R>0){if(R>o)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let G=0;G<R;G++){const Q=(P[a]??_)+G;m.indexedOperation(Q,this.deletedIndexes[Q]?t.OPERATION.DELETE_AND_ADD:t.OPERATION.ADD),(F=u[G][d])==null||F.setParent(this,m.root,Q)}}return o>R&&m.shiftAllChangeIndexes(-(o-R),P[a+R]),m.filteredChanges!==void 0?pt(m.root,m,"filteredChanges"):pt(m.root,m,"changes"),this.items.splice(a,o,...u)}unshift(...a){const o=this[d];return o.shiftChangeIndexes(a.length),o.isFiltered?wt(o.filteredChanges,this.items.length):wt(o.allChanges,this.items.length),a.forEach((u,m)=>{o.change(m,t.OPERATION.ADD)}),this.tmpItems.unshift(...a),this.items.unshift(...a)}indexOf(a,o){return this.items.indexOf(a,o)}lastIndexOf(a,o=this.length-1){return this.items.lastIndexOf(a,o)}every(a,o){return this.items.every(a,o)}some(a,o){return this.items.some(a,o)}forEach(a,o){return this.items.forEach(a,o)}map(a,o){return this.items.map(a,o)}filter(a,o){return this.items.filter(a,o)}reduce(a,o){return this.items.reduce(a,o)}reduceRight(a,o){return this.items.reduceRight(a,o)}find(a,o){return this.items.find(a,o)}findIndex(a,o){return this.items.findIndex(a,o)}fill(a,o,u){throw new Error("ArraySchema#fill() not implemented")}copyWithin(a,o,u){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return qt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(a,o){return this.items.includes(a,o)}flatMap(a,o){throw new Error("ArraySchema#flatMap() is not supported.")}flat(a){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...a){return this.items.findLastIndex.apply(this.items,arguments)}with(a,o){const u=this.items.slice();return a<0&&(a+=this.length),u[a]=o,new qt(...u)}toReversed(){return this.items.slice().reverse()}toSorted(a){return this.items.slice().sort(a)}toSpliced(a,o,...u){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(a=>{let o=this.items.length;for(;o!=0;){let u=Math.floor(Math.random()*o);o--,[this[o],this[u]]=[this[u],this[o]]}})}move(a){return this.isMovingItems=!0,a(this),this.isMovingItems=!1,this}[f](a,o=!1){return o?this.items[a]:this.deletedIndexes[a]?this.items[a]:this.tmpItems[a]||this.items[a]}[p](a){this.items[a]=void 0,this.tmpItems[a]=void 0}[M](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[Y](){this.items=this.items.filter(a=>a!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(a=>typeof a.toJSON=="function"?a.toJSON():a)}clone(a){let o;return a?(o=new qt,o.push(...this.items)):o=new qt(...this.map(u=>u[d]?u.clone():u)),o}};qt[Hs]=$s,qt[Gs]=Zr;let tn=qt;ve("array",{constructor:tn});var Zs,nn;const On=class On{static[(Zs=l,nn=c,h)](a,o,u){return!u||typeof a[S]=="string"||u.isChangeTreeVisible((a[f](o)??a.deletedItems[o])[d])}static is(a){return a.map!==void 0}constructor(a){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[d]=new wn(this),this[d].indexes={},a)if(a instanceof Map||a instanceof On)a.forEach((o,u)=>this.set(u,o));else for(const o in a)this.set(o,a[o]);Object.defineProperty(this,S,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return On}set(a,o){var R;if(o==null)throw new Error(`MapSchema#set('${a}', ${o}): trying to set ${o} value on '${a}'.`);typeof o=="object"&&this[S]&&en(o,this[S],this,a),a=a.toString();const u=this[d],m=o[d]!==void 0;let _,T;if(typeof u.indexes[a]<"u"){_=u.indexes[a],T=t.OPERATION.REPLACE;const P=this.$items.get(a);if(P===o)return;m&&(T=t.OPERATION.DELETE_AND_ADD,P!==void 0&&((R=P[d].root)==null||R.remove(P[d])))}else _=u.indexes[H]??0,T=t.OPERATION.ADD,this.$indexes.set(_,a),u.indexes[a]=_,u.indexes[H]=_+1;return this.$items.set(a,o),u.change(_,T),m&&o[d].setParent(this,u.root,_),this}get(a){return this.$items.get(a)}delete(a){const o=this[d].indexes[a];return this.deletedItems[o]=this[d].delete(o),this.$items.delete(a)}clear(){const a=this[d];a.discard(!0),a.indexes={},a.forEachChild((o,u)=>{var m;(m=a.root)==null||m.remove(o)}),this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){return this.$items.has(a)}forEach(a){this.$items.forEach(a)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(a,o){this.$indexes.set(a,o)}getIndex(a){return this.$indexes.get(a)}[f](a){return this.$items.get(this.$indexes.get(a))}[p](a){const o=this.$indexes.get(a);this.$items.delete(o),this.$indexes.delete(a)}[M](){this.deletedItems={}}toJSON(){const a={};return this.forEach((o,u)=>{a[u]=typeof o.toJSON=="function"?o.toJSON():o}),a}clone(a){let o;return a?o=Object.assign(new On,this):(o=new On,this.forEach((u,m)=>{u[d]?o.set(m,u.clone()):o.set(m,u)})),o}};On[Zs]=Sn,On[nn]=Gr;let Tn=On;ve("map",{constructor:Tn});const hn=-1;function Gi(v){return ke.register(v),v}function zs(v=hn){return function(a,o){var R;const u=a.constructor,_=Object.getPrototypeOf(u)[Symbol.metadata],T=u[R=Symbol.metadata]??(u[R]=Object.assign({},u[Symbol.metadata],_??Object.create(null)));ze.setTag(T,o,v)}}function Wt(v,a){return function(o,u){const m=o.constructor;if(!v)throw new Error(`${m.name}: @type() reference provided for "${u}" is undefined. Make sure you don't have any circular dependencies.`);ke.register(m);const T=Object.getPrototypeOf(m)[Symbol.metadata],R=ze.initialize(m);let P=R[u];if(R[P]!==void 0){if(R[P].deprecated)return;if(R[P].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${u}' definition on '${m.name}'.
Check @type() annotation`)}catch(F){const G=F.stack.split(`
`)[4].trim();throw new Error(`${F.message} ${G}`)}}else P=R[H]??(T&&T[H])??-1,P++;if(a&&a.manual)ze.addField(R,P,u,v,{enumerable:!0,configurable:!0,writable:!0});else{const F=Array.isArray(v)?Re("array"):typeof Object.keys(v)[0]=="string"&&Re(Object.keys(v)[0]),G=F?Object.values(v)[0]:v;ze.addField(R,P,u,v,rn(`_${u}`,P,G,F))}}}function rn(v,a,o,u){return{get:function(){return this[v]},set:function(m){var T,R;const _=this[v]??void 0;if(m!==_){if(m!=null){u?(u.constructor===tn&&!(m instanceof tn)&&(m=new tn(...m)),u.constructor===Tn&&!(m instanceof Tn)&&(m=new Tn(m)),m[S]=o):typeof o!="string"?en(m,o,this,v.substring(1)):js(m,o,this,v.substring(1));const P=this[d];_!==void 0&&_[d]?((T=P.root)==null||T.remove(_[d]),this.constructor[i](P,a,t.OPERATION.DELETE_AND_ADD)):this.constructor[i](P,a,t.OPERATION.ADD),(R=m[d])==null||R.setParent(this,P.root,a)}else _!==void 0&&this[d].delete(a);this[v]=m}},enumerable:!0,configurable:!0}}function Zi(v=!0){return function(a,o){var P;const u=a.constructor,_=Object.getPrototypeOf(u)[Symbol.metadata],T=u[P=Symbol.metadata]??(u[P]=Object.assign({},u[Symbol.metadata],_??Object.create(null))),R=T[o];T[R].deprecated=!0,v&&(T[V]??(T[V]={}),T[V][o]={get:function(){throw new Error(`${o} is deprecated.`)},set:function(F){},enumerable:!1,configurable:!0}),Object.defineProperty(T,R,{value:T[R],enumerable:!1,configurable:!0})}}function zi(v,a,o){for(let u in a)Wt(a[u],o)(v.prototype,u);return v}function Ks(v,a,o=ft){const u={},m={};for(let T in v){const R=v[T];typeof R=="object"&&(R.default!==void 0&&(u[T]=R.default),R.view!==void 0&&(m[T]=typeof R.view=="boolean"?hn:R.view))}const _=ze.setFields(class extends o{constructor(...T){T[0]=Object.assign({},u,T[0]),super(...T)}},v);for(let T in m)zs(m[T])(_.prototype,T);return a&&Object.defineProperty(_,"name",{value:a}),_.extends=(T,R)=>Ks(T,R,_),_}function Kr(v){return new Array(v).fill(0).map((a,o)=>o===v-1?"└─ ":"   ").join("")}function Ki(v){const a=v[d].root,o={ops:{},refs:[]};return a.changes.forEach(u=>{if(u===void 0)return;const m=u.indexedOperations;o.refs.push(`refId#${u.refId}`);for(const _ in m){const T=m[_],R=t.OPERATION[T];o.ops[R]||(o.ops[R]=0),o.ops[t.OPERATION[T]]++}}),o}var Ar,Ws;const xr=class xr{static initialize(a){var o;Object.defineProperty(a,d,{value:new wn(a),enumerable:!1,writable:!0}),Object.defineProperties(a,((o=a.constructor[Symbol.metadata])==null?void 0:o[V])||{})}static is(a){return typeof a[Symbol.metadata]=="object"}static[(Ar=l,Ws=c,i)](a,o,u=t.OPERATION.ADD){a.change(o,u)}static[h](a,o,u){var T,R;const _=(T=a.constructor[Symbol.metadata][o])==null?void 0:T.tag;if(u===void 0)return _===void 0;if(_===void 0)return!0;if(_===hn)return u.isChangeTreeVisible(a[d]);{const P=(R=u.tags)==null?void 0:R.get(a[d]);return P&&P.has(_)}}constructor(...a){xr.initialize(this),a[0]&&Object.assign(this,a[0])}assign(a){return Object.assign(this,a),this}setDirty(a,o){const u=this.constructor[Symbol.metadata];this[d].change(u[u[a]].index,o)}clone(){var u;const a=new this.constructor,o=this.constructor[Symbol.metadata];for(const m in o){const _=o[m].name;typeof this[_]=="object"&&typeof((u=this[_])==null?void 0:u.clone)=="function"?a[_]=this[_].clone():a[_]=this[_]}return a}toJSON(){const a={},o=this.constructor[Symbol.metadata];for(const u in o){const m=o[u],_=m.name;!m.deprecated&&this[_]!==null&&typeof this[_]<"u"&&(a[_]=typeof this[_].toJSON=="function"?this[_].toJSON():this[_])}return a}discardAllChanges(){this[d].discardAll()}[f](a){const o=this.constructor[Symbol.metadata];return this[o[a].name]}[p](a){const o=this.constructor[Symbol.metadata];this[o[a].name]=void 0}static debugRefIds(a,o=!1,u=0){var F,G;const m=o?` - ${JSON.stringify(a.toJSON())}`:"",_=a[d],T=_.refId,R=((G=(F=_.root)==null?void 0:F.refCount)==null?void 0:G[T])>1?` [×${_.root.refCount[T]}]`:"";let P=`${Kr(u)}${a.constructor.name} (refId: ${T})${R}${m}
`;return _.forEachChild(Q=>P+=this.debugRefIds(Q.ref,o,u+1)),P}static debugChanges(a,o=!1){const u=a[d],m=o?u.allChanges:u.changes,_=o?"allChanges":"changes";let T=`${a.constructor.name} (${u.refId}) -> .${_}:
`;function R(P){P.operations.filter(F=>F).forEach(F=>{const G=u.indexedOperations[F];console.log({index:F,operation:G}),T+=`- [${F}]: ${t.OPERATION[G]} (${JSON.stringify(u.getValue(Number(F),o))})
`})}return R(m),!o&&u.filteredChanges&&u.filteredChanges.operations.filter(P=>P).length>0&&(T+=`${a.constructor.name} (${u.refId}) -> .filteredChanges:
`,R(u.filteredChanges)),o&&u.allFilteredChanges&&u.allFilteredChanges.operations.filter(P=>P).length>0&&(T+=`${a.constructor.name} (${u.refId}) -> .allFilteredChanges:
`,R(u.allFilteredChanges)),T}static debugChangesDeep(a,o="changes"){var G,Q;let u="";const m=a[d],_=m.root,T=new Map,R=[];let P=0;for(const[z,ge]of Object.entries(_[o])){const pe=_.changeTrees[z];let ie=!1,K=[],de=(G=pe.parent)==null?void 0:G[d];if(pe===m)ie=!0;else for(;de!==void 0;){if(K.push(de),de.ref===a){ie=!0;break}de=(Q=de.parent)==null?void 0:Q[d]}ie&&(R.push(pe.refId),P+=Object.keys(ge).length,T.set(pe,K.reverse()))}u+=`---
`,u+=`root refId: ${m.refId}
`,u+=`Total instances: ${R.length} (refIds: ${R.join(", ")})
`,u+=`Total changes: ${P}
`,u+=`---
`;const F=new WeakSet;for(const[z,ge]of T.entries()){ge.forEach((Ve,at)=>{F.has(Ve)||(u+=`${Kr(at)}${Ve.ref.constructor.name} (refId: ${Ve.refId})
`,F.add(Ve))});const pe=z.indexedOperations,ie=ge.length,K=Kr(ie),de=ie>0?`(${z.parentIndex}) `:"";u+=`${K}${de}${z.ref.constructor.name} (refId: ${z.refId}) - changes: ${Object.keys(pe).length}
`;for(const Ve in pe){const at=pe[Ve];u+=`${Kr(ie+1)}${t.OPERATION[at]}: ${Ve}
`}}return`${u}`}};xr[Ar]=Hr,xr[Ws]=Fs;let ft=xr;var sn,qs;const Jn=class Jn{static[(sn=l,qs=c,h)](a,o,u){return!u||typeof a[S]=="string"||u.isChangeTreeVisible((a[f](o)??a.deletedItems[o])[d])}static is(a){return a.collection!==void 0}constructor(a){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[d]=new wn(this),this[d].indexes={},a&&a.forEach(o=>this.add(o)),Object.defineProperty(this,S,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(a){const o=this.$refId++;return a[d]!==void 0&&a[d].setParent(this,this[d].root,o),this[d].indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,a),this[d].change(o),o}at(a){const o=Array.from(this.$items.keys())[a];return this.$items.get(o)}entries(){return this.$items.entries()}delete(a){const o=this.$items.entries();let u,m;for(;(m=o.next())&&!m.done;)if(a===m.value[1]){u=m.value[0];break}return u===void 0?!1:(this.deletedItems[u]=this[d].delete(u),this.$indexes.delete(u),this.$items.delete(u))}clear(){const a=this[d];a.discard(!0),a.indexes={},a.forEachChild((o,u)=>{var m;(m=a.root)==null||m.remove(o)}),this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){return Array.from(this.$items.values()).some(o=>o===a)}forEach(a){this.$items.forEach((o,u,m)=>a(o,u,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(a,o){this.$indexes.set(a,o)}getIndex(a){return this.$indexes.get(a)}[f](a){return this.$items.get(this.$indexes.get(a))}[p](a){const o=this.$indexes.get(a);this.$items.delete(o),this.$indexes.delete(a)}[M](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const a=[];return this.forEach((o,u)=>{a.push(typeof o.toJSON=="function"?o.toJSON():o)}),a}clone(a){let o;return a?o=Object.assign(new Jn,this):(o=new Jn,this.forEach(u=>{u[d]?o.add(u.clone()):o.add(u)})),o}};Jn[sn]=Sn,Jn[qs]=Gr;let Ir=Jn;ve("collection",{constructor:Ir});var Ys,Xs;const Qn=class Qn{static[(Ys=l,Xs=c,h)](a,o,u){return!u||typeof a[S]=="string"||u.visible.has((a[f](o)??a.deletedItems[o])[d])}static is(a){return a.set!==void 0}constructor(a){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[d]=new wn(this),this[d].indexes={},a&&a.forEach(o=>this.add(o)),Object.defineProperty(this,S,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(a){var m;if(this.has(a))return!1;const o=this.$refId++;a[d]!==void 0&&a[d].setParent(this,this[d].root,o);const u=((m=this[d].indexes[o])==null?void 0:m.op)??t.OPERATION.ADD;return this[d].indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,a),this[d].change(o,u),o}entries(){return this.$items.entries()}delete(a){const o=this.$items.entries();let u,m;for(;(m=o.next())&&!m.done;)if(a===m.value[1]){u=m.value[0];break}return u===void 0?!1:(this.deletedItems[u]=this[d].delete(u),this.$indexes.delete(u),this.$items.delete(u))}clear(){const a=this[d];a.discard(!0),a.indexes={},this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){const o=this.$items.values();let u=!1,m;for(;(m=o.next())&&!m.done;)if(a===m.value){u=!0;break}return u}forEach(a){this.$items.forEach((o,u,m)=>a(o,u,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(a,o){this.$indexes.set(a,o)}getIndex(a){return this.$indexes.get(a)}[f](a){return this.$items.get(this.$indexes.get(a))}[p](a){const o=this.$indexes.get(a);this.$items.delete(o),this.$indexes.delete(a)}[M](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const a=[];return this.forEach((o,u)=>{a.push(typeof o.toJSON=="function"?o.toJSON():o)}),a}clone(a){let o;return a?o=Object.assign(new Qn,this):(o=new Qn,this.forEach(u=>{u[d]?o.add(u.clone()):o.add(u)})),o}};Qn[Ys]=Sn,Qn[Xs]=Gr;let Or=Qn;ve("set",{constructor:Or});function An(v,a,o,u){var m=arguments.length,_=m<3?a:u,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(v,a,o,u);else for(var R=v.length-1;R>=0;R--)(T=v[R])&&(_=(m<3?T(_):m>3?T(a,o,_):T(a,o))||_);return m>3&&_&&Object.defineProperty(a,o,_),_}typeof SuppressedError=="function"&&SuppressedError;class Wr{constructor(a){this.types=a,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(a){a.ensureRefId();const o=this.changeTrees[a.refId]===void 0;o&&(this.changeTrees[a.refId]=a);const u=this.refCount[a.refId];if(u===0){const m=a.allChanges.operations;let _=m.length;for(;_--;)a.indexedOperations[m[_]]=t.OPERATION.ADD,wt(a.changes,_)}return this.refCount[a.refId]=(u||0)+1,o}remove(a){const o=this.refCount[a.refId]-1;return o<=0?(a.root=void 0,delete this.changeTrees[a.refId],this.removeChangeFromChangeSet("allChanges",a),this.removeChangeFromChangeSet("changes",a),a.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",a),this.removeChangeFromChangeSet("filteredChanges",a)),this.refCount[a.refId]=0,a.forEachChild((u,m)=>this.remove(u))):(this.refCount[a.refId]=o,a.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",a),pt(this,a,"filteredChanges")):(this.removeChangeFromChangeSet("changes",a),pt(this,a,"changes"))),o}removeChangeFromChangeSet(a,o){const u=this[a],m=u.indexOf(o);if(m!==-1)return o[a].queueRootIndex=-1,u[m]=void 0,!0}clear(){this.changes.length=0}}const Dr=class Dr{constructor(a){this.sharedBuffer=Buffer.allocUnsafe(Dr.BUFFER_SIZE),this.context=ke.cache(a.constructor),this.root=new Wr(this.context),this.setState(a)}setState(a){this.state=a,this.state[d].setRoot(this.root)}encode(a={offset:0},o,u=this.sharedBuffer,m="changes",_=m==="allChanges",T=a.offset){const R=o!==void 0,P=this.state[d],F=this.root[m];for(let G=0,Q=F.length;G<Q;G++){const z=F[G];if(!z)continue;if(R){if(!o.isChangeTreeVisible(z)){o.invisible.add(z);continue}o.invisible.delete(z)}const ge=z[m],pe=z.ref,ie=ge.operations.length;if(ie===0)continue;const K=pe.constructor,de=K[l],Ve=K[h],at=K[Symbol.metadata];(R||a.offset>T||z!==P)&&(u[a.offset++]=255,yt.number(u,z.refId,a));for(let St=0;St<ie;St++){const vt=ge.operations[St],It=vt<0?Math.abs(vt):_?t.OPERATION.ADD:z.indexedOperations[vt];vt===void 0||It===void 0||Ve&&!Ve(pe,vt,o)||de(this,u,z,vt,It,a,_,R,at)}}if(a.offset>u.byteLength){const G=Math.ceil(a.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(G/1024)} * 1024; // ${Math.round(G/1024)} KB
`),u=Buffer.alloc(G,u),u===this.sharedBuffer&&(this.sharedBuffer=u),this.encode({offset:T},o,u,m,_)}else return u.subarray(0,a.offset)}encodeAll(a={offset:0},o=this.sharedBuffer){return this.encode(a,void 0,o,"allChanges",!0)}encodeAllView(a,o,u,m=this.sharedBuffer){const _=u.offset;return this.encode(u,a,m,"allFilteredChanges",!0,_),Buffer.concat([m.subarray(0,o),m.subarray(_,u.offset)])}debugChanges(a){(typeof a=="string"?this.root[a]:a).forEach(u=>{const m=u[a],_=u.ref.constructor[Symbol.metadata];console.log("->",{ref:u.ref.constructor.name,refId:u.refId,changes:Object.keys(m).length});for(const T in m){const R=m[T];console.log("  ->",{index:T,field:_==null?void 0:_[T],op:t.OPERATION[R]})}})}encodeView(a,o,u,m=this.sharedBuffer){const _=u.offset;for(const[T,R]of a.changes){const P=this.root.changeTrees[T];if(P===void 0){a.changes.delete(T);continue}const F=Object.keys(R);if(F.length===0)continue;const Q=P.ref.constructor,z=Q[l],ge=Q[Symbol.metadata];m[u.offset++]=255,yt.number(m,P.refId,u);for(let pe=0,ie=F.length;pe<ie;pe++){const K=Number(F[pe]),Ve=P.ref[f](K)!==void 0&&R[K]||t.OPERATION.DELETE;z(this,m,P,K,Ve,u,!1,!0,ge)}}return a.changes.clear(),this.encode(u,a,m,"filteredChanges",!1,_),Buffer.concat([m.subarray(0,o),m.subarray(_,u.offset)])}discardChanges(){var o,u;let a=this.root.changes.length;if(a>0){for(;a--;)(o=this.root.changes[a])==null||o.endEncode("changes");this.root.changes.length=0}if(a=this.root.filteredChanges.length,a>0){for(;a--;)(u=this.root.filteredChanges[a])==null||u.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(a,o,u,m){const _=this.context.getTypeId(o),T=this.context.getTypeId(u);if(T===void 0){console.warn(`@colyseus/schema WARNING: Class "${u.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}_!==T&&(a[m.offset++]=213,yt.number(a,T,m))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};Dr.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let qr=Dr;function Js(v,a){if(a===-1||a>=v.length)return!1;const o=v.length-1;for(let u=a;u<o;u++)v[u]=v[u+1];return v.length=o,!0}class Qs extends Error{constructor(a){super(a),this.name="DecodingWarning"}}class ei{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(a,o,u=!0){this.refs.set(a,o),this.refIds.set(o,a),u&&(this.refCounts[a]=(this.refCounts[a]||0)+1),this.deletedRefs.has(a)&&this.deletedRefs.delete(a)}removeRef(a){const o=this.refCounts[a];if(o===void 0){try{throw new Qs("trying to remove refId that doesn't exist: "+a)}catch(u){console.warn(u)}return}if(o===0){try{const u=this.refs.get(a);throw new Qs(`trying to remove refId '${a}' with 0 refCount (${u.constructor.name}: ${JSON.stringify(u)})`)}catch(u){console.warn(u)}return}(this.refCounts[a]=o-1)<=0&&this.deletedRefs.add(a)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(a=>{if(this.refCounts[a]>0)return;const o=this.refs.get(a);if(o.constructor[Symbol.metadata]!==void 0){const u=o.constructor[Symbol.metadata];for(const m in u){const _=u[m].name,T=typeof o[_]=="object"&&this.refIds.get(o[_]);T&&!this.deletedRefs.has(T)&&this.removeRef(T)}}else typeof o[S]=="function"&&Array.from(o.values()).forEach(u=>{const m=this.refIds.get(u);this.deletedRefs.has(m)||this.removeRef(m)});this.refs.delete(a),delete this.refCounts[a],delete this.callbacks[a]}),this.deletedRefs.clear()}addCallback(a,o,u){if(a===void 0){const m=typeof o=="number"?t.OPERATION[o]:o;throw new Error(`Can't addCallback on '${m}' (refId is undefined)`)}return this.callbacks[a]||(this.callbacks[a]={}),this.callbacks[a][o]||(this.callbacks[a][o]=[]),this.callbacks[a][o].push(u),()=>this.removeCallback(a,o,u)}removeCallback(a,o,u){var _,T,R;const m=(R=(T=(_=this.callbacks)==null?void 0:_[a])==null?void 0:T[o])==null?void 0:R.indexOf(u);m!==void 0&&m!==-1&&Js(this.callbacks[a][o],m)}}class ds{constructor(a,o){this.currentRefId=0,this.setState(a),this.context=o||new ke(a.constructor)}setState(a){this.state=a,this.root=new ei,this.root.addRef(0,a)}decode(a,o={offset:0},u=this.state){var P,F,G;const m=[],_=this.root,T=a.byteLength;let R=u.constructor[c];for(this.currentRefId=0;o.offset<T;){if(a[o.offset]==255){o.offset++,this.currentRefId=$.number(a,o);const z=_.refs.get(this.currentRefId);if(!z)throw new Error(`"refId" not found: ${this.currentRefId}`);(P=u[Y])==null||P.call(u),u=z,R=u.constructor[c];continue}if(R(this,a,o,u,m)===Vs){console.warn("@colyseus/schema: definition mismatch");const z={offset:o.offset};for(;o.offset<T&&!(a[o.offset]===255&&(z.offset=o.offset+1,_.refs.has($.number(a,z))));)o.offset++;continue}}return(F=u[Y])==null||F.call(u),(G=this.triggerChanges)==null||G.call(this,m),_.garbageCollectDeletedRefs(),m}getInstanceType(a,o,u){let m;if(a[o.offset]===213){o.offset++;const _=$.number(a,o);m=this.context.get(_)}return m||u}createInstanceOfType(a){return new a}removeChildRefs(a,o){const u=typeof a[S]!="string",m=this.root.refIds.get(a);a.forEach((_,T)=>{o.push({ref:a,refId:m,op:t.OPERATION.DELETE,field:T,value:void 0,previousValue:_}),u&&this.root.removeRef(this.root.refIds.get(_))})}}class Yn extends ft{}An([Wt("string")],Yn.prototype,"name",void 0),An([Wt("string")],Yn.prototype,"type",void 0),An([Wt("number")],Yn.prototype,"referencedType",void 0);class In extends ft{constructor(){super(...arguments),this.fields=new tn}}An([Wt("number")],In.prototype,"id",void 0),An([Wt("number")],In.prototype,"extendsId",void 0),An([Wt([Yn])],In.prototype,"fields",void 0);class Xn extends ft{constructor(){super(...arguments),this.types=new tn}static encode(a,o={offset:0}){const u=a.context,m=new Xn,_=new qr(m),T=u.schemas.get(a.state.constructor);T>0&&(m.rootType=T);const R=new Set,P={},F=Q=>{if(Q.extendsId===void 0||R.has(Q.extendsId)){R.add(Q.id),m.types.push(Q);const z=P[Q.id];z!==void 0&&(delete P[Q.id],z.forEach(ge=>F(ge)))}else P[Q.extendsId]===void 0&&(P[Q.extendsId]=[]),P[Q.extendsId].push(Q)};u.schemas.forEach((Q,z)=>{const ge=new In;ge.id=Number(Q);const pe=Object.getPrototypeOf(z);pe!==ft&&(ge.extendsId=u.schemas.get(pe));const ie=z[Symbol.metadata];if(ie!==pe[Symbol.metadata])for(const K in ie){const de=Number(K),Ve=ie[de].name;if(!Object.prototype.hasOwnProperty.call(ie,Ve))continue;const at=new Yn;at.name=Ve;let St;const vt=ie[de];if(typeof vt.type=="string")St=vt.type;else{let It;ft.is(vt.type)?(St="ref",It=vt.type):(St=Object.keys(vt.type)[0],typeof vt.type[St]=="string"?St+=":"+vt.type[St]:It=vt.type[St]),at.referencedType=It?u.getTypeId(It):-1}at.type=St,ge.fields.push(at)}F(ge)});for(const Q in P)P[Q].forEach(z=>m.types.push(z));const G=_.encodeAll(o);return Buffer.from(G,0,o.offset)}static decode(a,o){const u=new Xn;new ds(u).decode(a,o);const _=new ke;u.types.forEach(P=>{const F=_.get(P.extendsId)??ft,G=class extends F{};ke.register(G),_.add(G,P.id)},{});const T=(P,F,G)=>{F.fields.forEach((Q,z)=>{const ge=G+z;if(Q.referencedType!==void 0){let pe=Q.type,ie=_.get(Q.referencedType);if(!ie){const K=Q.type.split(":");pe=K[0],ie=K[1]}pe==="ref"?ze.addField(P,ge,Q.name,ie):ze.addField(P,ge,Q.name,{[pe]:ie})}else ze.addField(P,ge,Q.name,Q.type)})};u.types.forEach(P=>{const F=_.get(P.id),G=ze.initialize(F),Q=[];let z=P;do Q.push(z),z=u.types.find(pe=>pe.id===z.extendsId);while(z);let ge=0;Q.reverse().forEach(pe=>{T(G,pe,ge),ge+=pe.fields.length})});const R=new(_.get(u.rootType||0));return new ds(R,_)}}An([Wt([In])],Xn.prototype,"types",void 0),An([Wt("number")],Xn.prototype,"rootType",void 0);function Wi(v){const a=v.root,o=a.callbacks,u=new WeakMap;let m;v.triggerChanges=function(R){var F;const P=new Set;for(let G=0,Q=R.length;G<Q;G++){const z=R[G],ge=z.refId,pe=z.ref,ie=o[ge];if(ie){if((z.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&z.previousValue instanceof ft){const K=(F=o[a.refIds.get(z.previousValue)])==null?void 0:F[t.OPERATION.DELETE];for(let de=(K==null?void 0:K.length)-1;de>=0;de--)K[de]()}if(pe instanceof ft){if(!P.has(ge)){const K=ie==null?void 0:ie[t.OPERATION.REPLACE];for(let de=(K==null?void 0:K.length)-1;de>=0;de--)K[de]()}if(ie.hasOwnProperty(z.field)){const K=ie[z.field];for(let de=(K==null?void 0:K.length)-1;de>=0;de--)K[de](z.value,z.previousValue)}}else{if((z.op&t.OPERATION.DELETE)===t.OPERATION.DELETE){if(z.previousValue!==void 0){const K=ie[t.OPERATION.DELETE];for(let de=(K==null?void 0:K.length)-1;de>=0;de--)K[de](z.previousValue,z.dynamicIndex??z.field)}if((z.op&t.OPERATION.ADD)===t.OPERATION.ADD){const K=ie[t.OPERATION.ADD];for(let de=(K==null?void 0:K.length)-1;de>=0;de--)K[de](z.value,z.dynamicIndex??z.field)}}else if((z.op&t.OPERATION.ADD)===t.OPERATION.ADD&&z.previousValue!==z.value){const K=ie[t.OPERATION.ADD];for(let de=(K==null?void 0:K.length)-1;de>=0;de--)K[de](z.value,z.dynamicIndex??z.field)}if(z.value!==z.previousValue&&(z.value!==void 0||z.previousValue!==void 0)){const K=ie[t.OPERATION.REPLACE];for(let de=(K==null?void 0:K.length)-1;de>=0;de--)K[de](z.value,z.dynamicIndex??z.field)}}P.add(ge)}}};function _(R,P){var Q;let F=((Q=P.instance)==null?void 0:Q.constructor[Symbol.metadata])||R,G=P.instance&&typeof P.instance.forEach=="function"||R&&typeof R[Symbol.metadata]>"u";if(F&&!G){const z=function(ge,pe,ie,K){return K&&P.instance[pe]!==void 0&&!u.has(m)&&ie(P.instance[pe],void 0),a.addCallback(a.refIds.get(ge),pe,ie)};return new Proxy({listen:function(pe,ie,K=!0){if(P.instance)return z(P.instance,pe,ie,K);{let de=()=>{};return P.onInstanceAvailable((Ve,at)=>{de=z(Ve,pe,ie,K&&at&&!u.has(m))}),()=>de()}},onChange:function(pe){return a.addCallback(a.refIds.get(P.instance),t.OPERATION.REPLACE,pe)},bindTo:function(pe,ie){return ie||(ie=Object.keys(F).map(K=>F[K].name)),a.addCallback(a.refIds.get(P.instance),t.OPERATION.REPLACE,()=>{ie.forEach(K=>pe[K]=P.instance[K])})}},{get(ge,pe){var K;const ie=F[F[pe]];if(ie){const de=(K=P.instance)==null?void 0:K[pe],Ve=at=>{const St=T(P.instance).listen(pe,(vt,It)=>{at(vt,!1),St==null||St()},!1);a.refIds.get(de)!==void 0&&at(de,!0)};return _(ie.type,{instance:a.refIds.get(de)&&de,parentInstance:P.instance,onInstanceAvailable:Ve})}else return ge[pe]},has(ge,pe){return F[pe]!==void 0},set(ge,pe,ie){throw new Error("not allowed")},deleteProperty(ge,pe){throw new Error("not allowed")}})}else{const z=function(ie,K,de){return de&&ie.forEach((Ve,at)=>K(Ve,at)),a.addCallback(a.refIds.get(ie),t.OPERATION.ADD,(Ve,at)=>{u.set(K,!0),m=K,K(Ve,at),u.delete(K),m=void 0})},ge=function(ie,K){return a.addCallback(a.refIds.get(ie),t.OPERATION.DELETE,K)},pe=function(ie,K){return a.addCallback(a.refIds.get(ie),t.OPERATION.REPLACE,K)};return new Proxy({onAdd:function(ie,K=!0){if(P.instance)return z(P.instance,ie,K&&!u.has(m));if(P.onInstanceAvailable){let de=()=>{};return P.onInstanceAvailable((Ve,at)=>{de=z(Ve,ie,K&&at&&!u.has(m))}),()=>de()}},onRemove:function(ie){if(P.instance)return ge(P.instance,ie);if(P.onInstanceAvailable){let K=()=>{};return P.onInstanceAvailable(de=>{K=ge(de,ie)}),()=>K()}},onChange:function(ie){if(P.instance)return pe(P.instance,ie);if(P.onInstanceAvailable){let K=()=>{};return P.onInstanceAvailable(de=>{K=pe(de,ie)}),()=>K()}}},{get(ie,K){if(!ie[K])throw new Error(`Can't access '${K}' through callback proxy. access the instance directly.`);return ie[K]},has(ie,K){return ie[K]!==void 0},set(ie,K,de){throw new Error("not allowed")},deleteProperty(ie,K){throw new Error("not allowed")}})}}function T(R){return _(void 0,{instance:R})}return T}function qi(v,a){v.triggerChanges=a}class Yi{constructor(a=!1){this.iterable=a,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,a&&(this.items=[])}add(a,o=hn,u=!0){var R,P;const m=a==null?void 0:a[d];if(m){if(!m.parent&&m.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${m.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",a),this;const _=a.constructor[Symbol.metadata];this.visible.add(m),this.iterable&&u&&this.items.push(a),u&&m.parent&&this.addParentOf(m,o);let T=this.changes.get(m.refId);if(T===void 0&&(T={},this.changes.set(m.refId,T)),o!==hn){this.tags||(this.tags=new WeakMap);let F;this.tags.has(m)?F=this.tags.get(m):(F=new Set,this.tags.set(m,F)),F.add(o),(P=(R=_==null?void 0:_[te])==null?void 0:R[o])==null||P.forEach(G=>{m.getChange(G)!==t.OPERATION.DELETE&&(T[G]=t.OPERATION.ADD)})}else{const F=this.invisible.has(m),G=m.filteredChanges!==void 0?m.allFilteredChanges:m.allChanges;for(let Q=0,z=G.operations.length;Q<z;Q++){const ge=G.operations[Q];if(ge===void 0)continue;const pe=m.indexedOperations[ge]??t.OPERATION.ADD,ie=_==null?void 0:_[ge].tag;!m.isNew&&(F||ie===void 0||ie===o)&&pe!==t.OPERATION.DELETE&&(T[ge]=pe)}}return m.forEachChild((F,G)=>{_&&_[G].tag!==void 0&&_[G].tag!==o||this.add(F.ref,o,!1)}),this}addParentOf(a,o){var _;const u=a.parent[d],m=a.parentIndex;if(!this.visible.has(u)){this.visible.add(u);const T=(_=u.parent)==null?void 0:_[d];T&&T.filteredChanges!==void 0&&this.addParentOf(u,o)}if(u.getChange(m)!==t.OPERATION.DELETE){let T=this.changes.get(u.refId);T===void 0&&(T={},this.changes.set(u.refId,T)),this.tags||(this.tags=new WeakMap);let R;this.tags.has(u)?R=this.tags.get(u):(R=new Set,this.tags.set(u,R)),R.add(o),T[m]=t.OPERATION.ADD}}remove(a,o=hn,u=!1){var P;const m=a[d];if(!m)return console.warn("StateView#remove(), invalid object:",a),this;this.visible.delete(m),this.iterable&&!u&&Js(this.items,this.items.indexOf(a));const T=m.ref.constructor[Symbol.metadata];let R=this.changes.get(m.refId);if(R===void 0&&(R={},this.changes.set(m.refId,R)),o===hn){const F=m.parent;if(!ze.isValidInstance(F)&&m.isFiltered){const G=F[d];let Q=this.changes.get(G.refId);Q===void 0&&(Q={},this.changes.set(G.refId,Q)),Q[m.parentIndex]=t.OPERATION.DELETE}else(P=T==null?void 0:T[fe])==null||P.forEach(G=>R[G]=t.OPERATION.DELETE)}else T==null||T[te][o].forEach(F=>R[F]=t.OPERATION.DELETE);if(this.tags&&this.tags.has(m)){const F=this.tags.get(m);o===void 0?this.tags.delete(m):(F.delete(o),F.size===0&&this.tags.delete(m))}return this}has(a){return this.visible.has(a[d])}hasTag(a,o=hn){var m;const u=(m=this.tags)==null?void 0:m.get(a[d]);return(u==null?void 0:u.has(o))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let a=0,o=this.items.length;a<o;a++)this.remove(this.items[a],hn,!0);this.items.length=0}isChangeTreeVisible(a){let o=this.visible.has(a);return!o&&a.isVisibilitySharedWithParent&&this.visible.has(a.parent[d])&&(this.visible.add(a),o=!0),o}}ve("map",{constructor:Tn}),ve("array",{constructor:tn}),ve("set",{constructor:Or}),ve("collection",{constructor:Ir}),t.$changes=d,t.$childType=S,t.$decoder=c,t.$deleteByIndex=p,t.$encoder=l,t.$filter=h,t.$getByIndex=f,t.$track=i,t.ArraySchema=tn,t.ChangeTree=wn,t.CollectionSchema=Ir,t.Decoder=ds,t.Encoder=qr,t.MapSchema=Tn,t.Metadata=ze,t.Reflection=Xn,t.ReflectionField=Yn,t.ReflectionType=In,t.Schema=ft,t.SetSchema=Or,t.StateView=Yi,t.TypeContext=ke,t.decode=$,t.decodeKeyValueOperation=Gr,t.decodeSchemaOperation=Fs,t.defineCustomTypes=xe,t.defineTypes=zi,t.deprecated=Zi,t.dumpChanges=Ki,t.encode=yt,t.encodeArray=$s,t.encodeKeyValueOperation=Sn,t.encodeSchemaOperation=Hr,t.entity=Gi,t.getDecoderStateCallbacks=Wi,t.getRawChangesCallback=qi,t.registerType=ve,t.schema=Ks,t.type=Wt,t.view=zs})})(Ia,Ia.exports);var za=Ia.exports,wo=Li,Rr=za;class qd{constructor(e){this.events=e,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(e,t={}){const r=t.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(t.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(e,r),this.wt.ready.then(s=>{console.log("WebTransport ready!",s),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(l=>{this.reader=l.value.readable.getReader(),this.writer=l.value.writable.getWriter(),this.sendSeatReservation(t.room.roomId,t.sessionId,t.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(l=>{console.error("failed to read incoming stream",l),console.error("TODO: close the connection")})}).catch(s=>{console.log("WebTransport not ready!",s),this._close()}),this.wt.closed.then(s=>{console.log("WebTransport closed w/ success",s),this.events.onclose({code:s.closeCode,reason:s.reason})}).catch(s=>{console.log("WebTransport closed w/ error",s),this.events.onerror(s),this.events.onclose({code:s.closeCode,reason:s.reason})}).finally(()=>{this._close()})}send(e){const t=Rr.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),r=new Uint8Array(t+e.length);r.set(this.lengthPrefixBuffer.subarray(0,t),0),r.set(e,t),this.writer.write(r)}sendUnreliable(e){const t=Rr.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),r=new Uint8Array(t+e.length);r.set(this.lengthPrefixBuffer.subarray(0,t),0),r.set(e,t),this.unreliableWriter.write(r)}close(e,t){try{this.wt.close({closeCode:e,reason:t})}catch(r){console.error(r)}}readIncomingData(){return wo.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.reader.read();const t=e.value,r={offset:0};do{const s=Rr.decode.number(t,r);this.events.onmessage({data:t.subarray(r.offset,r.offset+s)}),r.offset+=s}while(r.offset<t.length)}catch(t){t.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",t);break}if(e.done)break}})}readIncomingUnreliableData(){return wo.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.unreliableReader.read();const t=e.value,r={offset:0};do{const s=Rr.decode.number(t,r);this.events.onmessage({data:t.subarray(r.offset,r.offset+s)}),r.offset+=s}while(r.offset<t.length)}catch(t){t.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",t);break}if(e.done)break}})}sendSeatReservation(e,t,r){const s={offset:0},i=[];Rr.encode.string(i,e,s),Rr.encode.string(i,t,s),r&&Rr.encode.string(i,r,s),this.writer.write(new Uint8Array(i).buffer)}_close(){this.isOpen=!1}}fc.H3TransportTransport=qd;var dc={},Yd=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},Xd=Yd;const ia=globalThis.WebSocket||Xd;let Jd=class{constructor(e){this.events=e}send(e){this.ws.send(e)}sendUnreliable(e){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(e,t){try{this.ws=new ia(e,{headers:t,protocols:this.protocols})}catch{this.ws=new ia(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,t){this.ws.close(e,t)}get isOpen(){return this.ws.readyState===ia.OPEN}};dc.WebSocketTransport=Jd;var Qd=fc,eh=dc;let th=class{constructor(e){switch(this.events={},e){case"h3":this.transport=new Qd.H3TransportTransport(this.events);break;default:this.transport=new eh.WebSocketTransport(this.events);break}}connect(e,t){this.transport.connect.call(this.transport,e,t)}send(e){this.transport.send(e)}sendUnreliable(e){this.transport.sendUnreliable(e)}close(e,t){this.transport.close(e,t)}get isOpen(){return this.transport.isOpen}};uc.Connection=th;var Ka={};(function(n){n.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(n.Protocol||(n.Protocol={})),n.ErrorCode=void 0,function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(n.ErrorCode||(n.ErrorCode={}))})(Ka);var Bi={};const hc={};function nh(n,e){hc[n]=e}function rh(n){const e=hc[n];if(!e)throw new Error("missing serializer: "+n);return e}Bi.getSerializer=rh;Bi.registerSerializer=nh;var Wa={};const sh=()=>({emit(n,...e){let t=this.events[n]||[];for(let r=0,s=t.length;r<s;r++)t[r](...e)},events:{},on(n,e){var t;return!((t=this.events[n])===null||t===void 0)&&t.push(e)||(this.events[n]=[e]),()=>{var r;this.events[n]=(r=this.events[n])===null||r===void 0?void 0:r.filter(s=>e!==s)}}});Wa.createNanoEvents=sh;var qa={};class pc{constructor(){this.handlers=[]}register(e,t=!1){return this.handlers.push(e),this}invoke(...e){this.handlers.forEach(t=>t.apply(this,e))}invokeAsync(...e){return Promise.all(this.handlers.map(t=>t.apply(this,e)))}remove(e){const t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function ih(){const n=new pc;function e(t){return n.register(t,this===null)}return e.once=t=>{const r=function(...s){t.apply(this,s),n.remove(r)};n.register(r)},e.remove=t=>n.remove(t),e.invoke=(...t)=>n.invoke(...t),e.invokeAsync=(...t)=>n.invokeAsync(...t),e.clear=()=>n.clear(),e}qa.EventEmitter=pc;qa.createSignal=ih;var Mi={},hi=za;function ah(n){try{return hi.getDecoderStateCallbacks(n.serializer.decoder)}catch{return}}let oh=class{setState(e,t){this.decoder.decode(e,t)}getState(){return this.state}patch(e,t){return this.decoder.decode(e,t)}teardown(){this.decoder.root.clearRefs()}handshake(e,t){this.state?(hi.Reflection.decode(e,t),this.decoder=new hi.Decoder(this.state)):(this.decoder=hi.Reflection.decode(e,t),this.state=this.decoder.state)}};Mi.SchemaSerializer=oh;Mi.getStateCallbacks=ah;var Oa;try{Oa=new TextDecoder}catch{}var oe,kn,D=0,st={},Ke,ir,un=0,Nn=0,Nt,zn,$t=[],je,So={useRecords:!1,mapsAsObjects:!0};class gc{}const Ya=new gc;Ya.name="MessagePack 0xC1";var lr=!1,mc=2,lh;try{new Function("")}catch{mc=1/0}class pr{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(oe)return wc(()=>(Oi(),this?this.unpack(e,t):pr.prototype.unpack.call(So,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof t=="object"?(kn=t.end||e.length,D=t.start||0):(D=0,kn=t>-1?t:e.length),Nn=0,ir=null,Nt=null,oe=e;try{je=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw oe=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof pr){if(st=this,this.structures)return Ke=this.structures,ui(t);(!Ke||Ke.length>0)&&(Ke=[])}else st=So,(!Ke||Ke.length>0)&&(Ke=[]);return ui(t)}unpackMultiple(e,t){let r,s=0;try{lr=!0;let i=e.length,l=this?this.unpack(e,i):Ui.unpack(e,i);if(t){if(t(l,s,D)===!1)return;for(;D<i;)if(s=D,t(ui(),s,D)===!1)return}else{for(r=[l];D<i;)s=D,r.push(ui());return r}}catch(i){throw i.lastPosition=s,i.values=r,i}finally{lr=!1,Oi()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,s=e.length;r<s;r++){let i=e[r];i&&(i.isShared=!0,r>=32&&(i.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let s=e[r],i=t[r];i&&(s&&((e.restoreStructures||(e.restoreStructures=[]))[r]=s),e[r]=i)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function ui(n){try{if(!st.trusted&&!lr){let t=Ke.sharedLength||0;t<Ke.length&&(Ke.length=t)}let e;if(st.randomAccessStructure&&oe[D]<64&&oe[D]>=32&&lh||(e=mt()),Nt&&(D=Nt.postBundlePosition,Nt=null),lr&&(Ke.restoreStructures=null),D==kn)Ke&&Ke.restoreStructures&&To(),Ke=null,oe=null,zn&&(zn=null);else{if(D>kn)throw new Error("Unexpected end of MessagePack data");if(!lr){let t;try{t=JSON.stringify(e,(r,s)=>typeof s=="bigint"?`${s}n`:s).slice(0,100)}catch(r){t="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw Ke&&Ke.restoreStructures&&To(),Oi(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||D>kn)&&(e.incomplete=!0),e}}function To(){for(let n in Ke.restoreStructures)Ke[n]=Ke.restoreStructures[n];Ke.restoreStructures=null}function mt(){let n=oe[D++];if(n<160)if(n<128){if(n<64)return n;{let e=Ke[n&63]||st.getStructures&&yc()[n&63];return e?(e.read||(e.read=Xa(e,n&63)),e.read()):n}}else if(n<144)if(n-=128,st.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=bc();r==="__proto__"&&(r="__proto_"),e[r]=mt()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(mt(),mt());return e}else{n-=144;let e=new Array(n);for(let t=0;t<n;t++)e[t]=mt();return st.freezeData?Object.freeze(e):e}else if(n<192){let e=n-160;if(Nn>=D)return ir.slice(D-un,(D+=e)-un);if(Nn==0&&kn<140){let t=e<16?Ja(e):vc(e);if(t!=null)return t}return xa(e)}else{let e;switch(n){case 192:return null;case 193:return Nt?(e=mt(),e>0?Nt[1].slice(Nt.position1,Nt.position1+=e):Nt[0].slice(Nt.position0,Nt.position0-=e)):Ya;case 194:return!1;case 195:return!0;case 196:if(e=oe[D++],e===void 0)throw new Error("Unexpected end of buffer");return aa(e);case 197:return e=je.getUint16(D),D+=2,aa(e);case 198:return e=je.getUint32(D),D+=4,aa(e);case 199:return Pr(oe[D++]);case 200:return e=je.getUint16(D),D+=2,Pr(e);case 201:return e=je.getUint32(D),D+=4,Pr(e);case 202:if(e=je.getFloat32(D),st.useFloat32>2){let t=Ci[(oe[D]&127)<<1|oe[D+1]>>7];return D+=4,(t*e+(e>0?.5:-.5)>>0)/t}return D+=4,e;case 203:return e=je.getFloat64(D),D+=8,e;case 204:return oe[D++];case 205:return e=je.getUint16(D),D+=2,e;case 206:return e=je.getUint32(D),D+=4,e;case 207:return st.int64AsType==="number"?(e=je.getUint32(D)*4294967296,e+=je.getUint32(D+4)):st.int64AsType==="string"?e=je.getBigUint64(D).toString():st.int64AsType==="auto"?(e=je.getBigUint64(D),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=je.getBigUint64(D),D+=8,e;case 208:return je.getInt8(D++);case 209:return e=je.getInt16(D),D+=2,e;case 210:return e=je.getInt32(D),D+=4,e;case 211:return st.int64AsType==="number"?(e=je.getInt32(D)*4294967296,e+=je.getUint32(D+4)):st.int64AsType==="string"?e=je.getBigInt64(D).toString():st.int64AsType==="auto"?(e=je.getBigInt64(D),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=je.getBigInt64(D),D+=8,e;case 212:if(e=oe[D++],e==114)return No(oe[D++]&63);{let t=$t[e];if(t)return t.read?(D++,t.read(mt())):t.noBuffer?(D++,t()):t(oe.subarray(D,++D));throw new Error("Unknown extension "+e)}case 213:return e=oe[D],e==114?(D++,No(oe[D++]&63,oe[D++])):Pr(2);case 214:return Pr(4);case 215:return Pr(8);case 216:return Pr(16);case 217:return e=oe[D++],Nn>=D?ir.slice(D-un,(D+=e)-un):uh(e);case 218:return e=je.getUint16(D),D+=2,Nn>=D?ir.slice(D-un,(D+=e)-un):fh(e);case 219:return e=je.getUint32(D),D+=4,Nn>=D?ir.slice(D-un,(D+=e)-un):dh(e);case 220:return e=je.getUint16(D),D+=2,Io(e);case 221:return e=je.getUint32(D),D+=4,Io(e);case 222:return e=je.getUint16(D),D+=2,Oo(e);case 223:return e=je.getUint32(D),D+=4,Oo(e);default:if(n>=224)return n-256;if(n===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+n)}}}const ch=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Xa(n,e){function t(){if(t.count++>mc){let s=n.read=new Function("r","return function(){return "+(st.freezeData?"Object.freeze":"")+"({"+n.map(i=>i==="__proto__"?"__proto_:r()":ch.test(i)?i+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"})}")(mt);return n.highByte===0&&(n.read=Ao(e,n.read)),s()}let r={};for(let s=0,i=n.length;s<i;s++){let l=n[s];l==="__proto__"&&(l="__proto_"),r[l]=mt()}return st.freezeData?Object.freeze(r):r}return t.count=0,n.highByte===0?Ao(e,t):t}const Ao=(n,e)=>function(){let t=oe[D++];if(t===0)return e();let r=n<32?-(n+(t<<5)):n+(t<<5),s=Ke[r]||yc()[r];if(!s)throw new Error("Record id is not defined for "+r);return s.read||(s.read=Xa(s,n)),s.read()};function yc(){let n=wc(()=>(oe=null,st.getStructures()));return Ke=st._mergeStructures(n,Ke)}var xa=Cs,uh=Cs,fh=Cs,dh=Cs;let hh=!1;function Cs(n){let e;if(n<16&&(e=Ja(n)))return e;if(n>64&&Oa)return Oa.decode(oe.subarray(D,D+=n));const t=D+n,r=[];for(e="";D<t;){const s=oe[D++];if(!(s&128))r.push(s);else if((s&224)===192){const i=oe[D++]&63;r.push((s&31)<<6|i)}else if((s&240)===224){const i=oe[D++]&63,l=oe[D++]&63;r.push((s&31)<<12|i<<6|l)}else if((s&248)===240){const i=oe[D++]&63,l=oe[D++]&63,c=oe[D++]&63;let h=(s&7)<<18|i<<12|l<<6|c;h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|h&1023),r.push(h)}else r.push(s);r.length>=4096&&(e+=xt.apply(String,r),r.length=0)}return r.length>0&&(e+=xt.apply(String,r)),e}function Io(n){let e=new Array(n);for(let t=0;t<n;t++)e[t]=mt();return st.freezeData?Object.freeze(e):e}function Oo(n){if(st.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=bc();r==="__proto__"&&(r="__proto_"),e[r]=mt()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(mt(),mt());return e}}var xt=String.fromCharCode;function vc(n){let e=D,t=new Array(n);for(let r=0;r<n;r++){const s=oe[D++];if((s&128)>0){D=e;return}t[r]=s}return xt.apply(String,t)}function Ja(n){if(n<4)if(n<2){if(n===0)return"";{let e=oe[D++];if((e&128)>1){D-=1;return}return xt(e)}}else{let e=oe[D++],t=oe[D++];if((e&128)>0||(t&128)>0){D-=2;return}if(n<3)return xt(e,t);let r=oe[D++];if((r&128)>0){D-=3;return}return xt(e,t,r)}else{let e=oe[D++],t=oe[D++],r=oe[D++],s=oe[D++];if((e&128)>0||(t&128)>0||(r&128)>0||(s&128)>0){D-=4;return}if(n<6){if(n===4)return xt(e,t,r,s);{let i=oe[D++];if((i&128)>0){D-=5;return}return xt(e,t,r,s,i)}}else if(n<8){let i=oe[D++],l=oe[D++];if((i&128)>0||(l&128)>0){D-=6;return}if(n<7)return xt(e,t,r,s,i,l);let c=oe[D++];if((c&128)>0){D-=7;return}return xt(e,t,r,s,i,l,c)}else{let i=oe[D++],l=oe[D++],c=oe[D++],h=oe[D++];if((i&128)>0||(l&128)>0||(c&128)>0||(h&128)>0){D-=8;return}if(n<10){if(n===8)return xt(e,t,r,s,i,l,c,h);{let f=oe[D++];if((f&128)>0){D-=9;return}return xt(e,t,r,s,i,l,c,h,f)}}else if(n<12){let f=oe[D++],p=oe[D++];if((f&128)>0||(p&128)>0){D-=10;return}if(n<11)return xt(e,t,r,s,i,l,c,h,f,p);let d=oe[D++];if((d&128)>0){D-=11;return}return xt(e,t,r,s,i,l,c,h,f,p,d)}else{let f=oe[D++],p=oe[D++],d=oe[D++],S=oe[D++];if((f&128)>0||(p&128)>0||(d&128)>0||(S&128)>0){D-=12;return}if(n<14){if(n===12)return xt(e,t,r,s,i,l,c,h,f,p,d,S);{let M=oe[D++];if((M&128)>0){D-=13;return}return xt(e,t,r,s,i,l,c,h,f,p,d,S,M)}}else{let M=oe[D++],Y=oe[D++];if((M&128)>0||(Y&128)>0){D-=14;return}if(n<15)return xt(e,t,r,s,i,l,c,h,f,p,d,S,M,Y);let V=oe[D++];if((V&128)>0){D-=15;return}return xt(e,t,r,s,i,l,c,h,f,p,d,S,M,Y,V)}}}}}function xo(){let n=oe[D++],e;if(n<192)e=n-160;else switch(n){case 217:e=oe[D++];break;case 218:e=je.getUint16(D),D+=2;break;case 219:e=je.getUint32(D),D+=4;break;default:throw new Error("Expected string")}return Cs(e)}function aa(n){return st.copyBuffers?Uint8Array.prototype.slice.call(oe,D,D+=n):oe.subarray(D,D+=n)}function Pr(n){let e=oe[D++];if($t[e]){let t;return $t[e](oe.subarray(D,t=D+=n),r=>{D=r;try{return mt()}finally{D=t}})}else throw new Error("Unknown extension type "+e)}var Do=new Array(4096);function bc(){let n=oe[D++];if(n>=160&&n<192){if(n=n-160,Nn>=D)return ir.slice(D-un,(D+=n)-un);if(!(Nn==0&&kn<180))return xa(n)}else return D--,_c(mt());let e=(n<<5^(n>1?je.getUint16(D):n>0?oe[D]:0))&4095,t=Do[e],r=D,s=D+n-3,i,l=0;if(t&&t.bytes==n){for(;r<s;){if(i=je.getUint32(r),i!=t[l++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(i=oe[r++],i!=t[l++]){r=1879048192;break}if(r===s)return D=r,t.string;s-=3,r=D}for(t=[],Do[e]=t,t.bytes=n;r<s;)i=je.getUint32(r),t.push(i),r+=4;for(s+=3;r<s;)i=oe[r++],t.push(i);let c=n<16?Ja(n):vc(n);return c!=null?t.string=c:t.string=xa(n)}function _c(n){if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";if(st.allowArraysInMapKeys&&Array.isArray(n)&&n.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return n.flat().toString();throw new Error(`Invalid property type for record: ${typeof n}`)}const No=(n,e)=>{let t=mt().map(_c),r=n;e!==void 0&&(n=n<32?-((e<<5)+n):(e<<5)+n,t.highByte=e);let s=Ke[n];return s&&(s.isShared||lr)&&((Ke.restoreStructures||(Ke.restoreStructures=[]))[n]=s),Ke[n]=t,t.read=Xa(t,r),t.read()};$t[0]=()=>{};$t[0].noBuffer=!0;$t[66]=n=>{let e=n.length,t=BigInt(n[0]&128?n[0]-256:n[0]);for(let r=1;r<e;r++)t<<=BigInt(8),t+=BigInt(n[r]);return t};let ph={Error,TypeError,ReferenceError};$t[101]=()=>{let n=mt();return(ph[n[0]]||Error)(n[1],{cause:n[2]})};$t[105]=n=>{if(st.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=je.getUint32(D-4);zn||(zn=new Map);let t=oe[D],r;t>=144&&t<160||t==220||t==221?r=[]:r={};let s={target:r};zn.set(e,s);let i=mt();return s.used?Object.assign(r,i):(s.target=i,i)};$t[112]=n=>{if(st.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=je.getUint32(D-4),t=zn.get(e);return t.used=!0,t.target};$t[115]=()=>new Set(mt());const Ec=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(n=>n+"Array");let gh=typeof globalThis=="object"?globalThis:window;$t[116]=n=>{let e=n[0],t=Ec[e];if(!t){if(e===16){let r=new ArrayBuffer(n.length-1);return new Uint8Array(r).set(n.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new gh[t](Uint8Array.prototype.slice.call(n,1).buffer)};$t[120]=()=>{let n=mt();return new RegExp(n[0],n[1])};const mh=[];$t[98]=n=>{let e=(n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3],t=D;return D+=e-n.length,Nt=mh,Nt=[xo(),xo()],Nt.position0=0,Nt.position1=0,Nt.postBundlePosition=D,D=t,mt()};$t[255]=n=>n.length==4?new Date((n[0]*16777216+(n[1]<<16)+(n[2]<<8)+n[3])*1e3):n.length==8?new Date(((n[0]<<22)+(n[1]<<14)+(n[2]<<6)+(n[3]>>2))/1e6+((n[3]&3)*4294967296+n[4]*16777216+(n[5]<<16)+(n[6]<<8)+n[7])*1e3):n.length==12?new Date(((n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3])/1e6+((n[4]&128?-281474976710656:0)+n[6]*1099511627776+n[7]*4294967296+n[8]*16777216+(n[9]<<16)+(n[10]<<8)+n[11])*1e3):new Date("invalid");function wc(n){let e=kn,t=D,r=un,s=Nn,i=ir,l=zn,c=Nt,h=new Uint8Array(oe.slice(0,kn)),f=Ke,p=Ke.slice(0,Ke.length),d=st,S=lr,M=n();return kn=e,D=t,un=r,Nn=s,ir=i,zn=l,Nt=c,oe=h,lr=S,Ke=f,Ke.splice(0,Ke.length,...p),st=d,je=new DataView(oe.buffer,oe.byteOffset,oe.byteLength),M}function Oi(){oe=null,zn=null,Ke=null}function yh(n){n.unpack?$t[n.type]=n.unpack:$t[n.type]=n}const Ci=new Array(147);for(let n=0;n<256;n++)Ci[n]=+("1e"+Math.floor(45.15-n*.30103));const vh=pr;var Ui=new pr({useRecords:!1});const bh=Ui.unpack,_h=Ui.unpackMultiple,Eh=Ui.unpack,Sc={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let Tc=new Float32Array(1),Ro=new Uint8Array(Tc.buffer,0,4);function wh(n){Tc[0]=n;let e=Ci[(Ro[3]&127)<<1|Ro[2]>>7];return(e*n+(n>0?.5:-.5)>>0)/e}let pi;try{pi=new TextEncoder}catch{}let xi,Qa;const $i=typeof Buffer<"u",fi=$i?function(n){return Buffer.allocUnsafeSlow(n)}:Uint8Array,Ac=$i?Buffer:Uint8Array,Po=$i?4294967296:2144337920;let L,hs,rt,N=0,Ft,ct=null,Sh;const Th=21760,Ah=/[\u0080-\uFFFF]/,Xr=Symbol("record-id");class Us extends pr{constructor(e){super(e),this.offset=0;let t,r,s,i,l=Ac.prototype.utf8Write?function(B,J){return L.utf8Write(B,J,L.byteLength-J)}:pi&&pi.encodeInto?function(B,J){return pi.encodeInto(B,L.subarray(J)).written}:!1,c=this;e||(e={});let h=e&&e.sequential,f=e.structures||e.saveStructures,p=e.maxSharedStructures;if(p==null&&(p=f?32:0),p>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let d=e.maxOwnStructures;d==null&&(d=f?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let S=p>32||d+p>64,M=p+64,Y=p+d+64;if(Y>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let V=[],H=0,ce=0;this.pack=this.encode=function(B,J){if(L||(L=new fi(8192),rt=L.dataView||(L.dataView=new DataView(L.buffer,0,8192)),N=0),Ft=L.length-10,Ft-N<2048?(L=new fi(L.length),rt=L.dataView||(L.dataView=new DataView(L.buffer,0,L.length)),Ft=L.length-10,N=0):N=N+7&2147483640,t=N,J&Dc&&(N+=J&255),i=c.structuredClone?new Map:null,c.bundleStrings&&typeof B!="string"?(ct=[],ct.size=1/0):ct=null,s=c.structures,s){s.uninitialized&&(s=c._mergeStructures(c.getStructures()));let q=s.sharedLength||0;if(q>p)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+s.sharedLength);if(!s.transitions){s.transitions=Object.create(null);for(let ee=0;ee<q;ee++){let me=s[ee];if(!me)continue;let Ne,Se=s.transitions;for(let Ze=0,Fe=me.length;Ze<Fe;Ze++){let it=me[Ze];Ne=Se[it],Ne||(Ne=Se[it]=Object.create(null)),Se=Ne}Se[Xr]=ee+64}this.lastNamedStructuresLength=q}h||(s.nextId=q+64)}r&&(r=!1);let W;try{c.randomAccessStructure&&B&&B.constructor&&B.constructor===Object?$e(B):ye(B);let q=ct;if(ct&&Bo(t,ye,0),i&&i.idsToInsert){let ee=i.idsToInsert.sort((Ze,Fe)=>Ze.offset>Fe.offset?1:-1),me=ee.length,Ne=-1;for(;q&&me>0;){let Ze=ee[--me].offset+t;Ze<q.stringsPosition+t&&Ne===-1&&(Ne=0),Ze>q.position+t?Ne>=0&&(Ne+=6):(Ne>=0&&(rt.setUint32(q.position+t,rt.getUint32(q.position+t)+Ne),Ne=-1),q=q.previous,me++)}Ne>=0&&q&&rt.setUint32(q.position+t,rt.getUint32(q.position+t)+Ne),N+=ee.length*6,N>Ft&&Ge(N),c.offset=N;let Se=Oh(L.subarray(t,N),ee);return i=null,Se}return c.offset=N,J&Oc?(L.start=t,L.end=N,L):L.subarray(t,N)}catch(q){throw W=q,q}finally{if(s&&(fe(),r&&c.saveStructures)){let q=s.sharedLength||0,ee=L.subarray(t,N),me=Dh(s,c);if(!W)return c.saveStructures(me,me.isCompatible)===!1?c.pack(B,J):(c.lastNamedStructuresLength=q,L.length>1073741824&&(L=null),ee)}L.length>1073741824&&(L=null),J&xc&&(N=t)}};const fe=()=>{ce<10&&ce++;let B=s.sharedLength||0;if(s.length>B&&!h&&(s.length=B),H>1e4)s.transitions=null,ce=0,H=0,V.length>0&&(V=[]);else if(V.length>0&&!h){for(let J=0,W=V.length;J<W;J++)V[J][Xr]=0;V=[]}},te=B=>{var J=B.length;J<16?L[N++]=144|J:J<65536?(L[N++]=220,L[N++]=J>>8,L[N++]=J&255):(L[N++]=221,rt.setUint32(N,J),N+=4);for(let W=0;W<J;W++)ye(B[W])},ye=B=>{N>Ft&&(L=Ge(N));var J=typeof B,W;if(J==="string"){let q=B.length;if(ct&&q>=4&&q<4096){if((ct.size+=q)>Th){let Se,Ze=(ct[0]?ct[0].length*3+ct[1].length:0)+10;N+Ze>Ft&&(L=Ge(N+Ze));let Fe;ct.position?(Fe=ct,L[N]=200,N+=3,L[N++]=98,Se=N-t,N+=4,Bo(t,ye,0),rt.setUint16(Se+t-3,N-t-Se)):(L[N++]=214,L[N++]=98,Se=N-t,N+=4),ct=["",""],ct.previous=Fe,ct.size=0,ct.position=Se}let Ne=Ah.test(B);ct[Ne?0:1]+=B,L[N++]=193,ye(Ne?-q:q);return}let ee;q<32?ee=1:q<256?ee=2:q<65536?ee=3:ee=5;let me=q*3;if(N+me>Ft&&(L=Ge(N+me)),q<64||!l){let Ne,Se,Ze,Fe=N+ee;for(Ne=0;Ne<q;Ne++)Se=B.charCodeAt(Ne),Se<128?L[Fe++]=Se:Se<2048?(L[Fe++]=Se>>6|192,L[Fe++]=Se&63|128):(Se&64512)===55296&&((Ze=B.charCodeAt(Ne+1))&64512)===56320?(Se=65536+((Se&1023)<<10)+(Ze&1023),Ne++,L[Fe++]=Se>>18|240,L[Fe++]=Se>>12&63|128,L[Fe++]=Se>>6&63|128,L[Fe++]=Se&63|128):(L[Fe++]=Se>>12|224,L[Fe++]=Se>>6&63|128,L[Fe++]=Se&63|128);W=Fe-N-ee}else W=l(B,N+ee);W<32?L[N++]=160|W:W<256?(ee<2&&L.copyWithin(N+2,N+1,N+1+W),L[N++]=217,L[N++]=W):W<65536?(ee<3&&L.copyWithin(N+3,N+2,N+2+W),L[N++]=218,L[N++]=W>>8,L[N++]=W&255):(ee<5&&L.copyWithin(N+5,N+3,N+3+W),L[N++]=219,rt.setUint32(N,W),N+=4),N+=W}else if(J==="number")if(B>>>0===B)B<32||B<128&&this.useRecords===!1||B<64&&!this.randomAccessStructure?L[N++]=B:B<256?(L[N++]=204,L[N++]=B):B<65536?(L[N++]=205,L[N++]=B>>8,L[N++]=B&255):(L[N++]=206,rt.setUint32(N,B),N+=4);else if(B>>0===B)B>=-32?L[N++]=256+B:B>=-128?(L[N++]=208,L[N++]=B+256):B>=-32768?(L[N++]=209,rt.setInt16(N,B),N+=2):(L[N++]=210,rt.setInt32(N,B),N+=4);else{let q;if((q=this.useFloat32)>0&&B<4294967296&&B>=-2147483648){L[N++]=202,rt.setFloat32(N,B);let ee;if(q<4||(ee=B*Ci[(L[N]&127)<<1|L[N+1]>>7])>>0===ee){N+=4;return}else N--}L[N++]=203,rt.setFloat64(N,B),N+=8}else if(J==="object"||J==="function")if(!B)L[N++]=192;else{if(i){let ee=i.get(B);if(ee){if(!ee.id){let me=i.idsToInsert||(i.idsToInsert=[]);ee.id=me.push(ee)}L[N++]=214,L[N++]=112,rt.setUint32(N,ee.id),N+=4;return}else i.set(B,{offset:N-t})}let q=B.constructor;if(q===Object)tt(B);else if(q===Array)te(B);else if(q===Map)if(this.mapAsEmptyObject)L[N++]=128;else{W=B.size,W<16?L[N++]=128|W:W<65536?(L[N++]=222,L[N++]=W>>8,L[N++]=W&255):(L[N++]=223,rt.setUint32(N,W),N+=4);for(let[ee,me]of B)ye(ee),ye(me)}else{for(let ee=0,me=xi.length;ee<me;ee++){let Ne=Qa[ee];if(B instanceof Ne){let Se=xi[ee];if(Se.write){Se.type&&(L[N++]=212,L[N++]=Se.type,L[N++]=0);let Rt=Se.write.call(this,B);Rt===B?Array.isArray(B)?te(B):tt(B):ye(Rt);return}let Ze=L,Fe=rt,it=N;L=null;let _t;try{_t=Se.pack.call(this,B,Rt=>(L=Ze,Ze=null,N+=Rt,N>Ft&&Ge(N),{target:L,targetView:rt,position:N-Rt}),ye)}finally{Ze&&(L=Ze,rt=Fe,N=it,Ft=L.length-10)}_t&&(_t.length+N>Ft&&Ge(_t.length+N),N=Ih(_t,L,N,Se.type));return}}if(Array.isArray(B))te(B);else{if(B.toJSON){const ee=B.toJSON();if(ee!==B)return ye(ee)}if(J==="function")return ye(this.writeFunction&&this.writeFunction(B));tt(B)}}}else if(J==="boolean")L[N++]=B?195:194;else if(J==="bigint"){if(B<BigInt(1)<<BigInt(63)&&B>=-(BigInt(1)<<BigInt(63)))L[N++]=211,rt.setBigInt64(N,B);else if(B<BigInt(1)<<BigInt(64)&&B>0)L[N++]=207,rt.setBigUint64(N,B);else if(this.largeBigIntToFloat)L[N++]=203,rt.setFloat64(N,Number(B));else{if(this.largeBigIntToString)return ye(B.toString());if(this.useBigIntExtension&&B<BigInt(2)**BigInt(1023)&&B>-(BigInt(2)**BigInt(1023))){L[N++]=199,N++,L[N++]=66;let q=[],ee;do{let me=B&BigInt(255);ee=(me&BigInt(128))===(B<BigInt(0)?BigInt(128):BigInt(0)),q.push(me),B>>=BigInt(8)}while(!((B===BigInt(0)||B===BigInt(-1))&&ee));L[N-2]=q.length;for(let me=q.length;me>0;)L[N++]=Number(q[--me]);return}else throw new RangeError(B+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}N+=8}else if(J==="undefined")this.encodeUndefinedAsNil?L[N++]=192:(L[N++]=212,L[N++]=0,L[N++]=0);else throw new Error("Unknown type: "+J)},Xe=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?B=>{let J;if(this.skipValues){J=[];for(let ee in B)(typeof B.hasOwnProperty!="function"||B.hasOwnProperty(ee))&&!this.skipValues.includes(B[ee])&&J.push(ee)}else J=Object.keys(B);let W=J.length;W<16?L[N++]=128|W:W<65536?(L[N++]=222,L[N++]=W>>8,L[N++]=W&255):(L[N++]=223,rt.setUint32(N,W),N+=4);let q;if(this.coercibleKeyAsNumber)for(let ee=0;ee<W;ee++){q=J[ee];let me=Number(q);ye(isNaN(me)?q:me),ye(B[q])}else for(let ee=0;ee<W;ee++)ye(q=J[ee]),ye(B[q])}:B=>{L[N++]=222;let J=N-t;N+=2;let W=0;for(let q in B)(typeof B.hasOwnProperty!="function"||B.hasOwnProperty(q))&&(ye(q),ye(B[q]),W++);if(W>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');L[J+++t]=W>>8,L[J+t]=W&255},Je=this.useRecords===!1?Xe:e.progressiveRecords&&!S?B=>{let J,W=s.transitions||(s.transitions=Object.create(null)),q=N++-t,ee;for(let me in B)if(typeof B.hasOwnProperty!="function"||B.hasOwnProperty(me)){if(J=W[me],J)W=J;else{let Ne=Object.keys(B),Se=W;W=s.transitions;let Ze=0;for(let Fe=0,it=Ne.length;Fe<it;Fe++){let _t=Ne[Fe];J=W[_t],J||(J=W[_t]=Object.create(null),Ze++),W=J}q+t+1==N?(N--,Lt(W,Ne,Ze)):Qe(W,Ne,q,Ze),ee=!0,W=Se[me]}ye(B[me])}if(!ee){let me=W[Xr];me?L[q+t]=me:Qe(W,Object.keys(B),q,0)}}:B=>{let J,W=s.transitions||(s.transitions=Object.create(null)),q=0;for(let me in B)(typeof B.hasOwnProperty!="function"||B.hasOwnProperty(me))&&(J=W[me],J||(J=W[me]=Object.create(null),q++),W=J);let ee=W[Xr];ee?ee>=96&&S?(L[N++]=((ee-=96)&31)+96,L[N++]=ee>>5):L[N++]=ee:Lt(W,W.__keys__||Object.keys(B),q);for(let me in B)(typeof B.hasOwnProperty!="function"||B.hasOwnProperty(me))&&ye(B[me])},He=typeof this.useRecords=="function"&&this.useRecords,tt=He?B=>{He(B)?Je(B):Xe(B)}:Je,Ge=B=>{let J;if(B>16777216){if(B-t>Po)throw new Error("Packed buffer would be larger than maximum buffer size");J=Math.min(Po,Math.round(Math.max((B-t)*(B>67108864?1.25:2),4194304)/4096)*4096)}else J=(Math.max(B-t<<2,L.length-1)>>12)+1<<12;let W=new fi(J);return rt=W.dataView||(W.dataView=new DataView(W.buffer,0,J)),B=Math.min(B,L.length),L.copy?L.copy(W,0,t,B):W.set(L.slice(t,B)),N-=t,t=0,Ft=W.length-10,L=W},Lt=(B,J,W)=>{let q=s.nextId;q||(q=64),q<M&&this.shouldShareStructure&&!this.shouldShareStructure(J)?(q=s.nextOwnId,q<Y||(q=M),s.nextOwnId=q+1):(q>=Y&&(q=M),s.nextId=q+1);let ee=J.highByte=q>=96&&S?q-96>>5:-1;B[Xr]=q,B.__keys__=J,s[q-64]=J,q<M?(J.isShared=!0,s.sharedLength=q-63,r=!0,ee>=0?(L[N++]=(q&31)+96,L[N++]=ee):L[N++]=q):(ee>=0?(L[N++]=213,L[N++]=114,L[N++]=(q&31)+96,L[N++]=ee):(L[N++]=212,L[N++]=114,L[N++]=q),W&&(H+=ce*W),V.length>=d&&(V.shift()[Xr]=0),V.push(B),ye(J))},Qe=(B,J,W,q)=>{let ee=L,me=N,Ne=Ft,Se=t;L=hs,N=0,t=0,L||(hs=L=new fi(8192)),Ft=L.length-10,Lt(B,J,q),hs=L;let Ze=N;if(L=ee,N=me,Ft=Ne,t=Se,Ze>1){let Fe=N+Ze-1;Fe>Ft&&Ge(Fe);let it=W+t;L.copyWithin(it+Ze,it+1,N),L.set(hs.slice(0,Ze),it),N=Fe}else L[W+t]=hs[0]},$e=B=>{let J=Sh(B,L,t,N,s,Ge,(W,q,ee)=>{if(ee)return r=!0;N=q;let me=L;return ye(W),fe(),me!==L?{position:N,targetView:rt,target:L}:N},this);if(J===0)return tt(B);N=J}}useBuffer(e){L=e,L.dataView||(L.dataView=new DataView(L.buffer,L.byteOffset,L.byteLength)),N=0}set position(e){N=e}get position(){return N}set buffer(e){L=e}get buffer(){return L}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Qa=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,gc];xi=[{pack(n,e,t){let r=n.getTime()/1e3;if((this.useTimestamp32||n.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:s,targetView:i,position:l}=e(6);s[l++]=214,s[l++]=255,i.setUint32(l,r)}else if(r>0&&r<4294967296){let{target:s,targetView:i,position:l}=e(10);s[l++]=215,s[l++]=255,i.setUint32(l,n.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),i.setUint32(l+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:s,targetView:i,position:l}=e(3);s[l++]=212,s[l++]=255,s[l++]=255}else{let{target:s,targetView:i,position:l}=e(15);s[l++]=199,s[l++]=12,s[l++]=255,i.setUint32(l,n.getMilliseconds()*1e6),i.setBigInt64(l+4,BigInt(Math.floor(r)))}}},{pack(n,e,t){if(this.setAsEmptyObject)return e(0),t({});let r=Array.from(n),{target:s,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(s[i++]=212,s[i++]=115,s[i++]=0),t(r)}},{pack(n,e,t){let{target:r,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(r[s++]=212,r[s++]=101,r[s++]=0),t([n.name,n.message,n.cause])}},{pack(n,e,t){let{target:r,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(r[s++]=212,r[s++]=120,r[s++]=0),t([n.source,n.flags])}},{pack(n,e){this.moreTypes?ko(n,16,e):Lo($i?Buffer.from(n):new Uint8Array(n),e)}},{pack(n,e){let t=n.constructor;t!==Ac&&this.moreTypes?ko(n,Ec.indexOf(t.name),e):Lo(n,e)}},{pack(n,e){let{target:t,position:r}=e(1);t[r]=193}}];function ko(n,e,t,r){let s=n.byteLength;if(s+1<256){var{target:i,position:l}=t(4+s);i[l++]=199,i[l++]=s+1}else if(s+1<65536){var{target:i,position:l}=t(5+s);i[l++]=200,i[l++]=s+1>>8,i[l++]=s+1&255}else{var{target:i,position:l,targetView:c}=t(7+s);i[l++]=201,c.setUint32(l,s+1),l+=4}i[l++]=116,i[l++]=e,n.buffer||(n=new Uint8Array(n)),i.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),l)}function Lo(n,e){let t=n.byteLength;var r,s;if(t<256){var{target:r,position:s}=e(t+2);r[s++]=196,r[s++]=t}else if(t<65536){var{target:r,position:s}=e(t+3);r[s++]=197,r[s++]=t>>8,r[s++]=t&255}else{var{target:r,position:s,targetView:i}=e(t+5);r[s++]=198,i.setUint32(s,t),s+=4}r.set(n,s)}function Ih(n,e,t,r){let s=n.length;switch(s){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:s<256?(e[t++]=199,e[t++]=s):s<65536?(e[t++]=200,e[t++]=s>>8,e[t++]=s&255):(e[t++]=201,e[t++]=s>>24,e[t++]=s>>16&255,e[t++]=s>>8&255,e[t++]=s&255)}return e[t++]=r,e.set(n,t),t+=s,t}function Oh(n,e){let t,r=e.length*6,s=n.length-r;for(;t=e.pop();){let i=t.offset,l=t.id;n.copyWithin(i+r,i,s),r-=6;let c=i+r;n[c++]=214,n[c++]=105,n[c++]=l>>24,n[c++]=l>>16&255,n[c++]=l>>8&255,n[c++]=l&255,s=i}return n}function Bo(n,e,t){if(ct.length>0){rt.setUint32(ct.position+n,N+t-ct.position-n),ct.stringsPosition=N-n;let r=ct;ct=null,e(r[0]),e(r[1])}}function xh(n){if(n.Class){if(!n.pack&&!n.write)throw new Error("Extension has no pack or write function");if(n.pack&&!n.type)throw new Error("Extension has no type (numeric code to identify the extension)");Qa.unshift(n.Class),xi.unshift(n)}yh(n)}function Dh(n,e){return n.isCompatible=t=>{let r=!t||(e.lastNamedStructuresLength||0)===t.length;return r||e._mergeStructures(t),r},n}let Ic=new Us({useRecords:!1});const Nh=Ic.pack,Rh=Ic.pack,Ph=Us,{NEVER:kh,ALWAYS:Lh,DECIMAL_ROUND:Bh,DECIMAL_FIT:Mh}=Sc,Oc=512,xc=1024,Dc=2048;function Ch(n,e={}){if(!n||typeof n!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof n[Symbol.iterator]=="function")return Uh(n,e);if(typeof n.then=="function"||typeof n[Symbol.asyncIterator]=="function")return $h(n,e);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Uh(n,e){const t=new Us(e);for(const r of n)yield t.pack(r)}async function*$h(n,e){const t=new Us(e);for await(const r of n)yield t.pack(r)}function Vh(n,e={}){if(!n||typeof n!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const t=new pr(e);let r;const s=i=>{let l;r&&(i=Buffer.concat([r,i]),r=void 0);try{l=t.unpackMultiple(i)}catch(c){if(c.incomplete)r=i.slice(c.lastPosition),l=c.values;else throw c}return l};if(typeof n[Symbol.iterator]=="function")return function*(){for(const l of n)yield*s(l)}();if(typeof n[Symbol.asyncIterator]=="function")return async function*(){for await(const l of n)yield*s(l)}()}const Fh=Vh,jh=Ch,Hh=!1,Gh=!0,Zh=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:Lh,C1:Ya,DECIMAL_FIT:Mh,DECIMAL_ROUND:Bh,Decoder:vh,Encoder:Ph,FLOAT32_OPTIONS:Sc,NEVER:kh,Packr:Us,RESERVE_START_SPACE:Dc,RESET_BUFFER_MODE:xc,REUSE_BUFFER_MODE:Oc,Unpackr:pr,addExtension:xh,clearSource:Oi,decode:Eh,decodeIter:Fh,encode:Rh,encodeIter:jh,isNativeAccelerationEnabled:hh,mapsAsObjects:Gh,pack:Nh,roundFloat32:wh,unpack:bh,unpackMultiple:_h,useRecords:Hh},Symbol.toStringTag,{value:"Module"})),zh=Ra(Zh);var Kh=uc,cn=Ka,Mo=Bi,Wh=Wa,di=qa,Mt=za,qh=Mi,Co=Ms,Uo=zh;let Yh=class Nc{constructor(e,t){this.onStateChange=di.createSignal(),this.onError=di.createSignal(),this.onLeave=di.createSignal(),this.onJoin=di.createSignal(),this.hasJoined=!1,this.onMessageHandlers=Wh.createNanoEvents(),this.roomId=null,this.name=e,this.packr=new Uo.Packr,this.packr.encode(void 0),t&&(this.serializer=new(Mo.getSerializer("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError((r,s)=>{var i;return(i=console.warn)===null||i===void 0?void 0:i.call(console,`colyseus.js - onError => (${r}) ${s}`)}),this.onLeave(()=>this.removeAllListeners())}connect(e,t,r=this,s,i){const l=new Kh.Connection(s.protocol);if(r.connection=l,l.events.onmessage=Nc.prototype.onMessageCallback.bind(r),l.events.onclose=function(c){var h;if(!r.hasJoined){(h=console.warn)===null||h===void 0||h.call(console,`Room connection was closed unexpectedly (${c.code}): ${c.reason}`),r.onError.invoke(c.code,c.reason);return}c.code===Co.CloseCode.DEVMODE_RESTART&&t?t():(r.onLeave.invoke(c.code,c.reason),r.destroy())},l.events.onerror=function(c){var h;(h=console.warn)===null||h===void 0||h.call(console,`Room, onError (${c.code}): ${c.reason}`),r.onError.invoke(c.code,c.reason)},s.protocol==="h3"){const c=new URL(e);l.connect(c.origin,s)}else l.connect(e,i)}leave(e=!0){return new Promise(t=>{this.onLeave(r=>t(r)),this.connection?e?(this.packr.buffer[0]=cn.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(Co.CloseCode.CONSENTED)})}onMessage(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)}send(e,t){const r={offset:1};this.packr.buffer[0]=cn.Protocol.ROOM_DATA,typeof e=="string"?Mt.encode.string(this.packr.buffer,e,r):Mt.encode.number(this.packr.buffer,e,r),this.packr.position=0;const s=t!==void 0?this.packr.pack(t,2048+r.offset):this.packr.buffer.subarray(0,r.offset);this.connection.send(s)}sendUnreliable(e,t){const r={offset:1};this.packr.buffer[0]=cn.Protocol.ROOM_DATA,typeof e=="string"?Mt.encode.string(this.packr.buffer,e,r):Mt.encode.number(this.packr.buffer,e,r),this.packr.position=0;const s=t!==void 0?this.packr.pack(t,2048+r.offset):this.packr.buffer.subarray(0,r.offset);this.connection.sendUnreliable(s)}sendBytes(e,t){const r={offset:1};if(this.packr.buffer[0]=cn.Protocol.ROOM_DATA_BYTES,typeof e=="string"?Mt.encode.string(this.packr.buffer,e,r):Mt.encode.number(this.packr.buffer,e,r),t.byteLength+r.offset>this.packr.buffer.byteLength){const s=new Uint8Array(r.offset+t.byteLength);s.set(this.packr.buffer),this.packr.useBuffer(s)}this.packr.buffer.set(t,r.offset),this.connection.send(this.packr.buffer.subarray(0,r.offset+t.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof qh.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(e){const t=new Uint8Array(e.data),r={offset:1},s=t[0];if(s===cn.Protocol.JOIN_ROOM){const i=Mt.decode.utf8Read(t,r,t[r.offset++]);if(this.serializerId=Mt.decode.utf8Read(t,r,t[r.offset++]),!this.serializer){const l=Mo.getSerializer(this.serializerId);this.serializer=new l}t.byteLength>r.offset&&this.serializer.handshake&&this.serializer.handshake(t,r),this.reconnectionToken=`${this.roomId}:${i}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=cn.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(s===cn.Protocol.ERROR){const i=Mt.decode.number(t,r),l=Mt.decode.string(t,r);this.onError.invoke(i,l)}else if(s===cn.Protocol.LEAVE_ROOM)this.leave();else if(s===cn.Protocol.ROOM_STATE)this.serializer.setState(t,r),this.onStateChange.invoke(this.serializer.getState());else if(s===cn.Protocol.ROOM_STATE_PATCH)this.serializer.patch(t,r),this.onStateChange.invoke(this.serializer.getState());else if(s===cn.Protocol.ROOM_DATA){const i=Mt.decode.stringCheck(t,r)?Mt.decode.string(t,r):Mt.decode.number(t,r),l=t.byteLength>r.offset?Uo.unpack(t,{start:r.offset}):void 0;this.dispatchMessage(i,l)}else if(s===cn.Protocol.ROOM_DATA_BYTES){const i=Mt.decode.stringCheck(t,r)?Mt.decode.string(t,r):Mt.decode.number(t,r);this.dispatchMessage(i,t.subarray(r.offset))}}dispatchMessage(e,t){var r;const s=this.getMessageHandlerKey(e);this.onMessageHandlers.events[s]?this.onMessageHandlers.emit(s,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):(r=console.warn)===null||r===void 0||r.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}};Za.Room=Yh;var Rc={};function $o(n,e){e.headers=n.headers||{},e.statusMessage=n.statusText,e.statusCode=n.status,e.data=n.response}function _n(n,e,t){return new Promise(function(r,s){t=t||{};var i=new XMLHttpRequest,l,c,h,f=t.body,p=t.headers||{};t.timeout&&(i.timeout=t.timeout),i.ontimeout=i.onerror=function(d){d.timeout=d.type=="timeout",s(d)},i.open(n,e.href||e),i.onload=function(){for(h=i.getAllResponseHeaders().trim().split(/[\r\n]+/),$o(i,i);c=h.shift();)c=c.split(": "),i.headers[c.shift().toLowerCase()]=c.join(": ");if(c=i.headers["content-type"],c&&~c.indexOf("application/json"))try{i.data=JSON.parse(i.data,t.reviver)}catch(d){return $o(i,d),s(d)}(i.status>=400?s:r)(i)},typeof FormData<"u"&&f instanceof FormData||f&&typeof f=="object"&&(p["content-type"]="application/json",f=JSON.stringify(f)),i.withCredentials=!!t.withCredentials;for(l in p)i.setRequestHeader(l,p[l]);i.send(f)})}var Xh=_n.bind(_n,"GET"),Jh=_n.bind(_n,"POST"),Qh=_n.bind(_n,"PATCH"),ep=_n.bind(_n,"DELETE"),tp=_n.bind(_n,"PUT");const np=Object.freeze(Object.defineProperty({__proto__:null,del:ep,get:Xh,patch:Qh,post:Jh,put:tp,send:_n},Symbol.toStringTag,{value:"Module"})),rp=Ra(np);var sp=Ms,ip=rp;function ap(n){var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,Object.freeze(e)}var op=ap(ip);let lp=class{constructor(e,t={}){this.client=e,this.headers=t}get(e,t={}){return this.request("get",e,t)}post(e,t={}){return this.request("post",e,t)}del(e,t={}){return this.request("del",e,t)}put(e,t={}){return this.request("put",e,t)}request(e,t,r={}){return op[e](this.client.getHttpEndpoint(t),this.getOptions(r)).catch(s=>{var i;const l=s.statusCode,c=((i=s.data)===null||i===void 0?void 0:i.error)||s.statusMessage||s.message;throw!l&&!c?s:new sp.ServerError(l,c)})}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}};Rc.HTTP=lp;var eo={},Vi={},Vo=Li;let kr;function to(){if(!kr)try{kr=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!kr&&typeof globalThis.indexedDB<"u"&&(kr=new dp),kr||(kr={cache:{},setItem:function(n,e){this.cache[n]=e},getItem:function(n){this.cache[n]},removeItem:function(n){delete this.cache[n]}}),kr}function cp(n,e){to().setItem(n,e)}function up(n){to().removeItem(n)}function fp(n,e){const t=to().getItem(n);typeof Promise>"u"||!(t instanceof Promise)?e(t):t.then(r=>e(r))}class dp{constructor(){this.dbPromise=new Promise(e=>{const t=indexedDB.open("_colyseus_storage",1);t.onupgradeneeded=()=>t.result.createObjectStore("store"),t.onsuccess=()=>e(t.result)})}tx(e,t){return Vo.__awaiter(this,void 0,void 0,function*(){const s=(yield this.dbPromise).transaction("store",e).objectStore("store");return t(s)})}setItem(e,t){return this.tx("readwrite",r=>r.put(t,e)).then()}getItem(e){return Vo.__awaiter(this,void 0,void 0,function*(){const t=yield this.tx("readonly",r=>r.get(e));return new Promise(r=>{t.onsuccess=()=>r(t.result)})})}removeItem(e){return this.tx("readwrite",t=>t.delete(e)).then()}}Vi.getItem=fp;Vi.removeItem=up;Vi.setItem=cp;var Ot=Li,oa=Vi,hp=Wa,gi,Da,tr,mi;let pp=class{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},gi.set(this,!1),Da.set(this,void 0),tr.set(this,void 0),mi.set(this,hp.createNanoEvents()),oa.getItem(this.settings.key,t=>this.token=t)}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){const t=Ot.__classPrivateFieldGet(this,mi,"f").on("change",e);return Ot.__classPrivateFieldGet(this,gi,"f")||Ot.__classPrivateFieldSet(this,Da,new Promise((r,s)=>{this.getUserData().then(i=>{this.emitChange(Object.assign(Object.assign({},i),{token:this.token}))}).catch(i=>{this.emitChange({user:null,token:void 0})}).finally(()=>{r()})}),"f"),Ot.__classPrivateFieldSet(this,gi,!0,"f"),t}getUserData(){return Ot.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(e,t,r){return Ot.__awaiter(this,void 0,void 0,function*(){const s=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:t,options:r}})).data;return this.emitChange(s),s})}signInWithEmailAndPassword(e,t){return Ot.__awaiter(this,void 0,void 0,function*(){const r=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:t}})).data;return this.emitChange(r),r})}signInAnonymously(e){return Ot.__awaiter(this,void 0,void 0,function*(){const t=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(t),t})}sendPasswordResetEmail(e){return Ot.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data})}signInWithProvider(e){return Ot.__awaiter(this,arguments,void 0,function*(t,r={}){return new Promise((s,i)=>{const l=r.width||480,c=r.height||768,h=this.token?`?token=${this.token}`:"",f=`Login with ${t[0].toUpperCase()+t.substring(1)}`,p=this.http.client.getHttpEndpoint(`${r.prefix||`${this.settings.path}/provider`}/${t}${h}`),d=screen.width/2-l/2,S=screen.height/2-c/2;Ot.__classPrivateFieldSet(this,tr,window.open(p,f,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+l+", height="+c+", top="+S+", left="+d),"f");const M=V=>{V.data.user===void 0&&V.data.token===void 0||(clearInterval(Y),Ot.__classPrivateFieldGet(this,tr,"f").close(),Ot.__classPrivateFieldSet(this,tr,void 0,"f"),window.removeEventListener("message",M),V.data.error!==void 0?i(V.data.error):(s(V.data),this.emitChange(V.data)))},Y=setInterval(()=>{(!Ot.__classPrivateFieldGet(this,tr,"f")||Ot.__classPrivateFieldGet(this,tr,"f").closed)&&(Ot.__classPrivateFieldSet(this,tr,void 0,"f"),i("cancelled"),window.removeEventListener("message",M))},200);window.addEventListener("message",M)})})}signOut(){return Ot.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(e){e.token!==void 0&&(this.token=e.token,e.token===null?oa.removeItem(this.settings.key):oa.setItem(this.settings.key,e.token)),Ot.__classPrivateFieldGet(this,mi,"f").emit("change",e)}};gi=new WeakMap,Da=new WeakMap,tr=new WeakMap,mi=new WeakMap;eo.Auth=pp;var Pc={};function gp(n){var e;const t=((e=window==null?void 0:window.location)===null||e===void 0?void 0:e.hostname)||"localhost",r=n.hostname.split("."),s=!n.hostname.includes("trycloudflare.com")&&!n.hostname.includes("discordsays.com")&&r.length>2?`/${r[0]}`:"";return n.pathname.startsWith("/.proxy")?`${n.protocol}//${t}${s}${n.pathname}${n.search}`:`${n.protocol}//${t}/.proxy/colyseus${s}${n.pathname}${n.search}`}Pc.discordURLBuilder=gp;var Fn=Li,mp=Ms,yp=Za,vp=Rc,bp=eo,_p=Pc,la;class Fi extends Error{constructor(e,t){super(e),this.code=t,this.name="MatchMakeError",Object.setPrototypeOf(this,Fi.prototype)}}const Fo=typeof window<"u"&&typeof((la=window==null?void 0:window.location)===null||la===void 0?void 0:la.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class kc{constructor(e=Fo,t){var r,s;if(typeof e=="string"){const i=e.startsWith("/")?new URL(e,Fo):new URL(e),l=i.protocol==="https:"||i.protocol==="wss:",c=Number(i.port||(l?443:80));this.settings={hostname:i.hostname,pathname:i.pathname,port:c,secure:l}}else e.port===void 0&&(e.port=e.secure?443:80),e.pathname===void 0&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new vp.HTTP(this,(t==null?void 0:t.headers)||{}),this.auth=new bp.Auth(this.http),this.urlBuilder=t==null?void 0:t.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((s=(r=window==null?void 0:window.location)===null||r===void 0?void 0:r.hostname)===null||s===void 0)&&s.includes("discordsays.com"))&&(this.urlBuilder=_p.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e){return Fn.__awaiter(this,arguments,void 0,function*(t,r={},s){return yield this.createMatchMakeRequest("joinOrCreate",t,r,s)})}create(e){return Fn.__awaiter(this,arguments,void 0,function*(t,r={},s){return yield this.createMatchMakeRequest("create",t,r,s)})}join(e){return Fn.__awaiter(this,arguments,void 0,function*(t,r={},s){return yield this.createMatchMakeRequest("join",t,r,s)})}joinById(e){return Fn.__awaiter(this,arguments,void 0,function*(t,r={},s){return yield this.createMatchMakeRequest("joinById",t,r,s)})}reconnect(e,t){return Fn.__awaiter(this,void 0,void 0,function*(){if(typeof e=="string"&&typeof t=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[r,s]=e.split(":");if(!r||!s)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",r,{reconnectionToken:s},t)})}consumeSeatReservation(e,t,r){return Fn.__awaiter(this,void 0,void 0,function*(){const s=this.createRoom(e.room.name,t);s.roomId=e.room.roomId,s.sessionId=e.sessionId;const i={sessionId:s.sessionId};e.reconnectionToken&&(i.reconnectionToken=e.reconnectionToken);const l=r||s;return s.connect(this.buildEndpoint(e.room,i,e.protocol),e.devMode&&(()=>Fn.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${s.roomId}'...`);let c=0,h=8;const f=()=>Fn.__awaiter(this,void 0,void 0,function*(){c++;try{yield this.consumeSeatReservation(e,t,l),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${s.roomId}'`)}catch{c<h?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${c} out of ${h})`),setTimeout(f,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(f,2e3)})),l,e,this.http.headers),new Promise((c,h)=>{const f=(p,d)=>h(new mp.ServerError(p,d));l.onError.once(f),l.onJoin.once(()=>{l.onError.remove(f),c(l)})})})}createMatchMakeRequest(e,t){return Fn.__awaiter(this,arguments,void 0,function*(r,s,i={},l,c){const h=(yield this.http.post(`matchmake/${r}/${s}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).data;if(h.error)throw new Fi(h.error,h.code);return r==="reconnect"&&(h.reconnectionToken=i.reconnectionToken),yield this.consumeSeatReservation(h,l,c)})}createRoom(e,t){return new yp.Room(e,t)}buildEndpoint(e,t={},r="ws"){const s=[];this.http.authToken&&(t._authToken=this.http.authToken);for(const c in t)t.hasOwnProperty(c)&&s.push(`${c}=${t[c]}`);r==="h3"&&(r="http");let i=this.settings.secure?`${r}s://`:`${r}://`;e.publicAddress?i+=`${e.publicAddress}`:i+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const l=`${i}/${e.processId}/${e.roomId}?${s.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(l)):l}getHttpEndpoint(e=""){const t=e.startsWith("/")?e:`/${e}`,r=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${t}`;return this.urlBuilder?this.urlBuilder(new URL(r)):r}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}kc.VERSION="0.16.17";Ha.Client=kc;Ha.MatchMakeError=Fi;var Lc={};class Ep{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}}Lc.NoneSerializer=Ep;(function(n){var e=Ha,t=Ka,r=Za,s=eo,i=Ms,l=Mi,c=Lc,h=Bi;h.registerSerializer("schema",l.SchemaSerializer),h.registerSerializer("none",c.NoneSerializer),n.Client=e.Client,n.MatchMakeError=e.MatchMakeError,Object.defineProperty(n,"ErrorCode",{enumerable:!0,get:function(){return t.ErrorCode}}),Object.defineProperty(n,"Protocol",{enumerable:!0,get:function(){return t.Protocol}}),n.Room=r.Room,n.Auth=s.Auth,n.ServerError=i.ServerError,n.SchemaSerializer=l.SchemaSerializer,n.getStateCallbacks=l.getStateCallbacks,n.registerSerializer=h.registerSerializer})(vn);let E=null,jo=null,ar=new Map;async function no(){return E?new Promise(n=>{const e=setTimeout(()=>{console.error("loadAllCardData: Timeout while waiting for card data"),n(!1)},5e3);E.send("getAllCards"),E.onMessage("allCards",t=>{clearTimeout(e),console.log(`Received ${t.length} cards from server`),ar.clear(),t.forEach(r=>{ar.set(r.id,r)}),n(!0)})}):!1}async function Bc(n,e){const t=location.host.includes("localhost")?"ws://localhost:4001":`wss://${location.host}/.proxy/api`;jo=new vn.Client(t);try{console.log("Attempting to join or create Colyseus room..."),E=await jo.joinOrCreate("game",{accessToken:n,username:e}),console.log("Successfully joined room:",E.roomId),console.log("Session ID:",E.sessionId),console.log("Initial room state:",E.state.toJSON()),console.log("Loading all card data..."),await no(),console.log("Card data loaded, cache size:",ar.size),E.onStateChange(r=>{}),E.onError((r,s)=>{console.error("Colyseus room error:",r,s),E=null}),E.onLeave(r=>{console.log("Left Colyseus room, code:",r),E=null})}catch(r){throw console.error("Failed to connect to Colyseus:",r),r instanceof ProgressEvent?(console.error("Connection failed: Network error (ProgressEvent). Potential causes:"),console.error("- Colyseus server might not be running or accessible at the target URL:",t),console.error("- WebSocket connection blocked by firewall or proxy."),console.error("- Incorrect WebSocket proxy configuration on the deployment server (if applicable)."),alert("Failed to connect to game server: Network Error. Please ensure the server is running and accessible.")):r instanceof Error?(console.error("Connection failed due to error:",r.message),alert(`Failed to connect to game server: ${r.message}`)):(console.error("Connection failed due to unknown error:",r),alert("Failed to connect to game server: An unknown error occurred.")),E=null,r}}let jt;const Mc=new URLSearchParams(window.location.search),ro=Mc.get("frame_id")!=null;let or;const Na="1363939642289946886",ca=ji("user_id"),wp=ji("guild_id"),Sp=ji("channel_id"),Tp=async()=>{if(ro){const n=Na;console.log("Discord SDK: Using embedded client ID:",n),or=new Cd(n),await or.ready()}else{or=new Bl(Na,wp,Sp);const n=String(ca.charCodeAt(0)%5),e={access_token:"mock_token",user:{username:ca,discriminator:n,id:ca,avatar:null,public_flags:1},scopes:[],expires:new Date(2112,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}};or._updateCommandMocks({authenticate:async()=>(jt=e,console.log("Mock Authentication successful:",jt),await Bc(jt.access_token,jt.user.username),e),authorize:async()=>(console.log("Mock Authorize called"),{code:"mock_code"})})}},Ap=async()=>{if(!ro){console.log("Running locally, attempting mock authentication...");try{return await or.commands.authenticate({}),!0}catch(e){return console.error("Mock authentication failed:",e),!1}}let n="authorize";try{console.log("Requesting Discord authorization...");const{code:e}=await or.commands.authorize({client_id:Na,response_type:"code",state:"",prompt:"none",scope:["identify","guilds"]});console.log("Authorization code received:",e),n="fetchToken",console.log("Fetching access token from /.proxy/api/token...");const t=await fetch("/.proxy/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(console.log("Token fetch response received. Status:",t.status),!t.ok){const s=await t.text();throw console.error("Token fetch failed:",t.status,t.statusText,s),new Error(`Token fetch failed: ${t.status} ${t.statusText} - ${s}`)}const{access_token:r}=await t.json();if(console.log("Access token received successfully."),n="discordAuthenticate",console.log("Authenticating with Discord SDK..."),jt=await or.commands.authenticate({access_token:r}),!(jt!=null&&jt.user))throw console.error("Discord SDK Authentication failed: No user data received.",jt),new Error("Discord SDK Authentication failed to return user data.");console.log("Discord SDK Authentication successful:",jt.user.username),n="connectColyseus",console.log("Connecting to Colyseus...");try{await Bc(jt.access_token,jt.user.username),console.log("Colyseus connection successful.")}catch(s){throw console.error("Colyseus connection failed:",s),s}return!0}catch(e){return console.error(`Error during step: ${n}`),console.error("Discord authorization or Colyseus connection failed:",e),e instanceof ProgressEvent?console.error("Network error (ProgressEvent) occurred, likely during fetch."):e.message&&e.message.includes("Token fetch failed")?console.error("Error specifically during token fetch step."):n==="connectColyseus"&&console.error("Error specifically during Colyseus connection step."),jt=null,!1}},Ip=()=>jt?jt.user.username:!ro&&or instanceof Bl?ji("user_id")||"MockUser":"User";function ji(n){const e=Mc.get(n);if(e!=null)return e;const t=sessionStorage.getItem(n);if(t!=null)return t;const r=Math.random().toString(36).slice(2,10);return sessionStorage.setItem(n,r),r}class Op extends Cn.Scene{constructor(){super("Boot")}preload(){this.load.setPath("/assets"),this.load.image("background","bg.png"),this.load.image("fridge_bg","fridge_bg.png")}create(){this.scene.start("Preloader")}}class xp extends Cn.Scene{constructor(){super("Game");ae(this,"room")}async create(){this.scene.launch("background"),this.add.image(this.cameras.main.width*.5,this.cameras.main.height*.4,"grid").setScale(.6),await this.connect(),this.room.state.draggables.onAdd((r,s)=>{const i=this.add.image(r.x,r.y,s).setInteractive();i.name=s,i.setScale(.8),this.input.setDraggable(i),i.on("drag",(l,c,h)=>{this.room&&(i.x=Phaser.Math.Clamp(c,i.displayWidth/2,Number(this.game.config.width)-i.displayWidth/2),i.y=Phaser.Math.Clamp(h,i.displayHeight/2,Number(this.game.config.height)-i.displayHeight/2),this.room.send("move",{imageId:s,x:i.x,y:i.y}))})}),this.add.text(this.cameras.main.width*.5,this.cameras.main.height*.95,`Connected as: ${Ip()}`,{font:"14px Arial",color:"#000000"}).setOrigin(.5)}async connect(){const t=location.host==="localhost:3000"?"ws://localhost:3001":`wss://${location.host}/.proxy/api/colyseus`,r=new vn.Client(`${t}`);try{this.room=await r.joinOrCreate("some_other_room",{screenWidth:this.game.config.width,screenHeight:this.game.config.height}),this.room.onMessage("move",s=>{}),console.log("Successfully connected!")}catch(s){console.log(`Could not connect with the server: ${s}`)}}}class Dp extends Cn.Scene{constructor(){super("MainMenu");ae(this,"statusText")}create(){const t=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let r=this.cameras.main.width/t.width+.2,s=this.cameras.main.height/t.height+.2,i=Math.max(r,s);t.setScale(i).setScrollFactor(0),this.add.text(Number(this.game.config.width)*.5,300,"Legends of the Friend",{fontFamily:"Arial Black",fontSize:58,color:"#ffff00",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(Number(this.game.config.width)*.5,460,"Click to Start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,520,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.input.once("pointerdown",async()=>{this.statusText.setText("Authorizing with Discord..."),await Ap()?(this.statusText.setText("Connecting to server..."),await new Promise(c=>setTimeout(c,1e3)),E?(this.statusText.setText("Loading game data..."),await no()?(this.statusText.setText("Connected! Entering Lobby..."),this.scene.start("Lobby")):this.statusText.setText("Failed to load game data. Please try again.")):this.statusText.setText("Failed to connect to server. Please try again.")):this.statusText.setText("Discord authorization failed. Please try again.")})}}class Np extends Cn.Scene{constructor(){super("Preloader")}init(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let t=this.cameras.main.width/e.width+.2,r=this.cameras.main.height/e.height+.2,s=Math.max(t,r);e.setScale(s).setScrollFactor(0),this.add.rectangle(Number(this.game.config.width)*.5,Number(this.game.config.height)*.5,468,32).setStrokeStyle(1,16777215);const i=this.add.rectangle(Number(this.game.config.width)*.5-230,Number(this.game.config.height)*.5,4,28,16777215);this.load.on("progress",l=>{i.width=4+460*l})}preload(){this.load.setPath("/assets"),this.load.image("logo","logo.png"),this.load.image("cardFullTier1","CardFullTier1.png"),this.load.image("cardMinionTier1","CardMinionTier1.png")}create(){this.scene.start("MainMenu")}}class Rp extends Cn.Scene{constructor(){super("background")}create(){this.cameras.main.setBackgroundColor(11393254),this.scene.sendToBack()}}var Le=(n=>(n.Lobby="Lobby",n.Shop="Shop",n.Preparation="Preparation",n.Battle="Battle",n.BattleEnd="BattleEnd",n.GameOver="GameOver",n))(Le||{});class Pp extends Cn.Scene{constructor(){super("Lobby");ae(this,"playerTextObjects",new Map);ae(this,"statusText");ae(this,"readyButton");ae(this,"waitingText");ae(this,"phaseListenerUnsub",null);ae(this,"playerAddListenerUnsub",null);ae(this,"playerRemoveListenerUnsub",null);ae(this,"playerStateListeners",new Map);ae(this,"listenersAttached",!1)}create(){if(this.scene.launch("background"),this.listenersAttached=!1,!E||!E.sessionId){console.error("Lobby Scene: Not connected to Colyseus room or no session ID!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Not connected to server.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{E==null||E.leave()}catch{}this.scene.start("MainMenu")});return}this.add.text(this.cameras.main.centerX,100,"Lobby",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,200,"Players in Lobby:",{fontFamily:"Arial",fontSize:32,color:"#dddddd",align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-100,"Connecting to lobby...",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.readyButton=this.add.text(this.cameras.main.centerX,this.cameras.main.height-150,"Ready Up",{fontFamily:"Arial Black",fontSize:40,color:"#888888",backgroundColor:"#333333",padding:{x:20,y:10},stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setVisible(!1).disableInteractive(),this.waitingText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-110,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.readyButton.on("pointerdown",()=>{var t;E&&((t=this.readyButton.input)!=null&&t.enabled)&&(console.log("Lobby: Sending playerReady message."),E.send("playerReady"))}),this.readyButton.on("pointerover",()=>{var t;(t=this.readyButton.input)!=null&&t.enabled&&this.readyButton.setColor("#55ff55")}),this.readyButton.on("pointerout",()=>{var t;(t=this.readyButton.input)!=null&&t.enabled?this.readyButton.setColor("#00ff00"):this.readyButton.setColor("#888888")}),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}attachMainListenersAndUI(){if(this.listenersAttached){console.log("Lobby: Main listeners and UI setup already performed, skipping.");return}if(!this.scene.isActive()){console.warn("Lobby: attachMainListenersAndUI called but scene is not active. Aborting.");return}if(!E||!E.state){console.warn("Lobby: attachMainListenersAndUI called but Colyseus room or state is not ready. Aborting.");return}console.log("Lobby: Attaching main Colyseus listeners and performing initial UI update."),this.attachMainListeners(),this.updateLobbyUI(),this.listenersAttached=!0}setupColyseusListeners(){if(!E){console.error("Lobby: setupColyseusListeners called but colyseusRoom is null.");return}console.log("Lobby: Setting up Colyseus general listeners."),E.state&&!this.listenersAttached&&(console.log("Lobby: State already available on setup. Scheduling attachMainListenersAndUI."),this.time.delayedCall(1,this.attachMainListenersAndUI,[],this)),E.onStateChange.once(t=>{if(console.log("Lobby: Initial state received via onStateChange.once."),!this.scene.isActive()){console.log("Lobby: Scene became inactive before onStateChange.once processing could complete.");return}this.attachMainListenersAndUI()})}attachMainListeners(){if(!E||!E.state){console.error("Lobby: attachMainListeners - colyseusRoom or state is null.");return}const t=vn.getStateCallbacks(E);this.phaseListenerUnsub&&this.phaseListenerUnsub(),this.phaseListenerUnsub=t(E.state).listen("currentPhase",(r,s)=>{this.scene.isActive()&&(console.log(`Lobby: Phase changed from ${s} to: ${r}`),r===Le.Shop?(this.statusText.setText("Starting Game!"),this.time.delayedCall(500,()=>{this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"))})):r===Le.Lobby?this.updateLobbyUI():r===Le.GameOver&&(this.statusText.setText("Game Over. Returning to Main Menu."),this.time.delayedCall(1500,()=>{if(this.scene.isActive()){try{E==null||E.leave()}catch{}this.scene.stop(),this.scene.start("MainMenu")}})))}),this.playerAddListenerUnsub&&this.playerAddListenerUnsub(),this.playerAddListenerUnsub=t(E.state.players).onAdd((r,s)=>{this.scene.isActive()&&(console.log(`Lobby: Player joined: ${r.username} (${s})`),this.addPlayerStateListener(r,s),this.updateLobbyUI())}),this.playerRemoveListenerUnsub&&this.playerRemoveListenerUnsub(),this.playerRemoveListenerUnsub=t(E.state.players).onRemove((r,s)=>{this.scene.isActive()&&(console.log(`Lobby: Player left: ${r.username} (${s})`),this.removePlayerStateListener(s),this.updateLobbyUI())}),E.state.players.forEach((r,s)=>{this.addPlayerStateListener(r,s)})}addPlayerStateListener(t,r){var l;if(!E)return;const s=vn.getStateCallbacks(E);(l=this.playerStateListeners.get(r))==null||l(),console.log(`Lobby: Adding 'isReady' listener for player ${r}`);const i=s(t).listen("isReady",(c,h)=>{console.log(`Lobby: isReady changed for player ${r}: ${h} -> ${c}`),this.scene.isActive()&&this.updateLobbyUI()});this.playerStateListeners.set(r,i)}removePlayerStateListener(t){const r=this.playerStateListeners.get(t);r&&(console.log(`Lobby: Removing 'isReady' listener for player ${t}`),r(),this.playerStateListeners.delete(t))}updateLobbyUI(){if(!this.scene.isActive()){console.warn("Lobby: updateLobbyUI called but scene is NOT ACTIVE. Aborting UI update.");return}if(!E){console.warn("Lobby: updateLobbyUI called but colyseusRoom is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Connection lost.");return}if(!E.state){console.warn("Lobby: updateLobbyUI called but colyseusRoom.state is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Game state unavailable.");return}ar.size===0&&(console.log("Lobby: Card data not loaded yet. Loading..."),no().then(d=>{d?console.log("Lobby: Card data loaded successfully"):console.warn("Lobby: Failed to load card data")}));const t=E.state.players,r=E.sessionId,s=t.size,i=250,l=40;this.playerTextObjects.forEach(d=>d.destroy()),this.playerTextObjects.clear();let c=0,h=s>0,f=!1;const p=t.get(r);p&&(f=p.isReady),t.forEach((d,S)=>{const M=S===r,Y=d.isReady?" [Ready]":" [Not Ready]",V=`${d.username||"Joining..."}${M?" (You)":""}${Y}`,H=this.add.text(this.cameras.main.centerX,i+c*l,V,{fontFamily:"Arial",fontSize:24,color:d.isReady?"#00ff00":"#ffffff",align:"center"}).setOrigin(.5);this.playerTextObjects.set(S,H),c++,d.isReady||(h=!1)}),s<2?(this.statusText.setText("Waiting for opponent..."),this.readyButton.setVisible(!1).disableInteractive(),this.waitingText.setVisible(!1)):(this.readyButton.setVisible(!0),f?(this.statusText.setText("Waiting for opponent to ready up..."),this.readyButton.setText("Waiting...").setColor("#888888").disableInteractive(),this.waitingText.setText(h?"Starting game...":"Waiting for opponent...").setVisible(!0)):(this.statusText.setText("Lobby full. Ready up!"),this.readyButton.setText("Ready Up").setColor("#00ff00").setInteractive({useHandCursor:!0}),this.waitingText.setVisible(!1)),h&&(this.statusText.setText("Starting game..."),this.readyButton.setVisible(!1),this.waitingText.setVisible(!1)))}shutdown(){var t,r,s,i,l,c,h,f,p;console.log("Lobby scene shutting down."),this.listenersAttached=!1,(t=this.phaseListenerUnsub)==null||t.call(this),(r=this.playerAddListenerUnsub)==null||r.call(this),(s=this.playerRemoveListenerUnsub)==null||s.call(this),this.playerStateListeners.forEach(d=>d()),this.playerStateListeners.clear(),this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerTextObjects.forEach(d=>d.destroy()),this.playerTextObjects.clear(),(i=this.statusText)==null||i.destroy(),(l=this.readyButton)==null||l.destroy(),(c=this.waitingText)==null||c.destroy(),(h=this.readyButton)==null||h.off("pointerdown"),(f=this.readyButton)==null||f.off("pointerover"),(p=this.readyButton)==null||p.off("pointerout"),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const jn=120,Jr=168;class kp extends Cn.Scene{constructor(){super("Shop");ae(this,"continueButton");ae(this,"shopCardObjects",[]);ae(this,"waitingText");ae(this,"refreshButton");ae(this,"cardDataCache",new Map);ae(this,"shopOffersContainer");ae(this,"shopOffersBackground");ae(this,"toggleShopButton");ae(this,"shopOffersVisible",!0);ae(this,"phaseListenerUnsub",null);ae(this,"playerStateListenersUnsub",new Map);ae(this,"shopOfferListenersUnsub",[]);ae(this,"listeners",[])}create(){var h;if(this.scene.launch("background"),(h=this.scene.get("BoardView"))!=null&&h.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!E||!E.state||!E.sessionId){console.error("Shop Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{E==null||E.leave(!0)}catch{}this.scene.start("MainMenu")});return}const t=this.cameras.main.centerX,r=this.cameras.main.centerY,s=this.cameras.main.width,i=this.cameras.main.height;this.createShopCardsDisplay(t,r,s),this.setupDragAndDrop(),this.requestMissingCardData();const l=E.state.players.get(E.sessionId),c=(l==null?void 0:l.shopRefreshCost)||2;this.refreshButton=this.add.text(s-150,180,`Refresh: ${c} 🍺`,{fontFamily:"Arial",fontSize:18,color:"#FFFFFF",backgroundColor:"#4444AA",padding:{x:10,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.refreshButton.on("pointerdown",()=>{const f=E==null?void 0:E.state.players.get(E.sessionId);E&&f&&f.brews>=f.shopRefreshCost&&E.send("refreshShop")}),this.refreshButton.on("pointerover",()=>{var f;(f=this.refreshButton.input)!=null&&f.enabled&&this.refreshButton.setBackgroundColor("#6666CC")}),this.refreshButton.on("pointerout",()=>{var f;(f=this.refreshButton.input)!=null&&f.enabled&&this.refreshButton.setBackgroundColor("#4444AA")}),this.updateRefreshButtonState(),this.continueButton=this.add.text(t,i-50,"Continue",{fontFamily:"Arial Black",fontSize:40,color:"#00ff00",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.continueButton.on("pointerdown",()=>{const f=E==null?void 0:E.state.players.get(E.sessionId);E&&f&&!f.isReady&&E.state.currentPhase===Le.Shop&&E.send("playerReady")}),this.continueButton.on("pointerover",()=>{var f;(f=this.continueButton.input)!=null&&f.enabled&&this.continueButton.setColor("#55ff55")}),this.continueButton.on("pointerout",()=>{var f;(f=this.continueButton.input)!=null&&f.enabled?this.continueButton.setColor("#00ff00"):this.continueButton.setColor("#888888")}),this.waitingText=this.add.text(t,i-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(50,()=>this.createShopCardsDisplay(t,r,s)),this.toggleShopButton=this.add.text(s-100,r-250,"Toggle Shop",{fontFamily:"Arial",fontSize:16,color:"#FFFFFF",backgroundColor:"#555555",padding:{x:5,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.toggleShopButton.on("pointerdown",()=>{this.shopOffersVisible=!this.shopOffersVisible,this.shopOffersContainer.setVisible(this.shopOffersVisible),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop")}),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop"),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createShopCardsDisplay(t,r,s){var Y;(Y=this.shopOffersContainer)==null||Y.destroy(),this.shopOffersContainer=this.add.container(0,0),this.shopOffersContainer.setVisible(this.shopOffersVisible),this.shopCardObjects.forEach(V=>V.destroy()),this.shopCardObjects=[];const i=E==null?void 0:E.state.players.get(E.sessionId),l=i==null?void 0:i.shopOfferIds;if(!l||l.length===0){console.log("Shop: No shop offers from server."),this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.setVisible(!1);return}const c=20,h=l.length>0?l.length:4,f=r,p=h*jn+(h-1)*c,d=t-p/2+jn/2,S=p+c*2,M=Jr+c*2;this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.destroy(),this.shopOffersBackground=this.add.rectangle(t,f,S,M,51,.6),this.shopOffersContainer.add(this.shopOffersBackground),l.forEach((V,H)=>{const ce=this.getCardDataFromServer(V);if(!ce){console.warn(`Shop: Card data not found for ID: ${V}`);return}const fe=d+H*(jn+c),te=this.add.container(fe,f),ye=this.add.image(0,0,"cardFullTier1").setOrigin(.5).setDisplaySize(jn,Jr);te.add(ye);const Xe=this.add.text(0,-20,ce.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:jn-20}}).setOrigin(.5,.5);te.add(Xe);const Je=this.add.text(-120/2+32,Jr*.03,`${ce.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(0,.5);te.add(Je);const He=this.add.text(jn/2-18,6,`${ce.health}/${ce.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,.5);te.add(He);const tt=this.add.text(0,Jr/2-50,`${ce.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);te.add(tt);const Ge=this.add.text(jn/2-8,-168/2+8,`${ce.brewCost}B`,{fontFamily:"Arial",fontSize:14,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"right"}).setOrigin(1,0);te.add(Ge),te.setSize(jn,Jr),te.setSize(jn,Jr),te.setInteractive({useHandCursor:!0}),te.setData("cardId",ce.id),te.setData("cardData",ce),this.input.setDraggable(te),te.off("pointerdown").on("pointerdown",Lt=>{var Qe;(Qe=te.input)!=null&&Qe.enabled&&te.setData("isBeingDragged",!1)}),te.off("pointerup").on("pointerup",Lt=>{var B;if(!((B=te.input)!=null&&B.enabled)||!E||!E.sessionId)return;if(te.getData("isBeingDragged")===!0){te.setData("isBeingDragged",!1);return}const Qe=E.state.players.get(E.sessionId);if(!Qe)return;let $e=-1;for(let J=0;J<5;J++)if(!Qe.hand.has(String(J))){$e=J;break}if($e!==-1){const J=te.getData("cardId"),W=te.getData("cardData");J&&W&&Qe.brews>=W.brewCost?(console.log(`Shop: Click-to-buy card ${J} (Cost: ${W.brewCost}) into hand slot ${$e}. Brews: ${Qe.brews}`),E.send("buyCard",{cardId:J,handSlotIndex:$e})):W&&Qe.brews<W.brewCost?console.log(`Shop: Not enough brews (${Qe.brews}) to click-buy card ${J} (Cost: ${W.brewCost}).`):console.log(`Shop: Click-to-buy failed for card ${J}. CardData: ${!!W}`)}else console.log("Shop: Hand is full, cannot click-buy.")}),this.shopCardObjects.push(te),this.shopOffersContainer.add(te)})}requestMissingCardData(){if(!E||!E.state||!E.sessionId)return;const t=E.state.players.get(E.sessionId);if(!t)return;const r=t.shopOfferIds;if(r&&r.length>0){const s=[];r.forEach(i=>{ar.has(i)||s.push(i)}),s.length>0&&(console.log("Requesting missing cards from server:",s),E.send("getCardsByIds",{cardIds:s}))}}getCardDataFromServer(t){if(ar.has(t))return ar.get(t);if(!E||!E.state)return;let r;return E.state.players.forEach(s=>{s.hand.forEach(i=>{i.cardId===t&&(r={id:i.cardId,name:i.name,attack:i.attack,speed:i.speed,health:i.health,brewCost:i.brewCost,description:i.description,isLegend:i.isLegend})}),s.battlefield.forEach(i=>{i.cardId===t&&(r={id:i.cardId,name:i.name,attack:i.attack,speed:i.speed,health:i.health,brewCost:i.brewCost,description:i.description,isLegend:i.isLegend})})}),r||(r={id:t,name:`Card ${t.split("_").pop()}`,attack:1,speed:1,health:1,brewCost:1,description:"Loading card details...",isLegend:!1},console.warn(`Shop: Card data not found for ID: ${t} in global cache or state`)),r}setupDragAndDrop(){this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),this.input.off("pointerdown"),this.input.off("pointerup"),this.shopCardObjects.forEach(t=>{t.off("pointerdown"),t.off("pointerup")}),this.input.on("dragstart",(t,r)=>{var s;!(r instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(r)||(s=r.input)!=null&&s.enabled&&(this.children.bringToTop(r),r.setAlpha(.7),r.setData("startX",r.x),r.setData("startY",r.y),r.setData("isBeingDragged",!0))}),this.input.on("drag",(t,r,s,i)=>{var l;!(r instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(r)||(l=r.input)!=null&&l.enabled&&r.getData("isBeingDragged")===!0&&(r.x=s,r.y=i)}),this.input.on("dragend",(t,r)=>{if(!E||!(r instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(r)){r instanceof Phaser.GameObjects.Container&&r.setData("isBeingDragged",!1);return}r.setAlpha(1);let s=!1;if(r.getData("isBeingDragged")===!0){const i=r.x,l=r.y,c=this.scene.get("BoardView");for(let h=0;h<5;h++){const f=c==null?void 0:c.getSlotPixelPosition(!0,"hand",h);if(f){const p=new Phaser.Geom.Rectangle(f.x-50,f.y-70,100,140);if(Phaser.Geom.Rectangle.Contains(p,i,l)){const d=E.state.players.get(E.sessionId);if(d&&!d.hand.has(String(h))){const S=r.getData("cardId"),M=r.getData("cardData");S&&M&&d.brews>=M.brewCost?(E.send("buyCard",{cardId:S,handSlotIndex:h}),s=!0):console.log("Shop: Drag-to-buy failed (not enough brews or card data missing).")}break}}}s||r.active&&(r.x=r.getData("startX"),r.y=r.getData("startY"))}r.setData("isBeingDragged",!1)})}updateRefreshButtonState(){if(!E||!this.refreshButton||!this.refreshButton.active)return;const t=E.state.players.get(E.sessionId);if(!t)return;this.refreshButton.setText(`Refresh: ${t.shopRefreshCost} 🍺`),t.brews>=t.shopRefreshCost&&E.state.currentPhase===Le.Shop?(this.refreshButton.setColor("#FFFFFF"),this.refreshButton.setBackgroundColor("#4444AA"),this.refreshButton.setInteractive({useHandCursor:!0})):(this.refreshButton.setColor("#AAAAAA"),this.refreshButton.setBackgroundColor("#555555"),this.refreshButton.disableInteractive())}setupColyseusListeners(){if(!E||!E.sessionId)return;const t=vn.getStateCallbacks(E),r=E.sessionId;this.phaseListenerUnsub=t(E.state).listen("currentPhase",i=>{this.scene.isActive()&&(i===Le.Preparation?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Preparation")):i!==Le.Shop&&this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby")),this.updateWaitingStatus())}),E.state.players.forEach((i,l)=>{const c=t(i).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(l,c)}),this.listeners.push(t(E.state.players).onAdd((i,l)=>{var h;this.playerStateListenersUnsub.has(l)&&((h=this.playerStateListenersUnsub.get(l))==null||h());const c=t(i).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(l,c),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(t(E.state.players).onRemove((i,l)=>{var c;(c=this.playerStateListenersUnsub.get(l))==null||c(),this.playerStateListenersUnsub.delete(l),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(E.onMessage("cardsByIds",i=>{if(this.scene.isActive()){Object.entries(i).forEach(([f,p])=>{ar.set(f,p)});const l=this.cameras.main.centerX,c=this.cameras.main.centerY,h=this.cameras.main.width;this.createShopCardsDisplay(l,c,h)}}));const s=E.state.players.get(r);if(s){const i=()=>{if(!this.scene.isActive())return;this.requestMissingCardData();const l=this.cameras.main.centerX,c=this.cameras.main.centerY,h=this.cameras.main.width;this.createShopCardsDisplay(l,c,h)};this.shopOfferListenersUnsub.push(t(s.shopOfferIds).onAdd(i)),this.shopOfferListenersUnsub.push(t(s.shopOfferIds).onRemove(i)),i(),this.listeners.push(t(s).listen("brews",()=>{this.scene.isActive()&&this.updateRefreshButtonState()})),this.listeners.push(t(s).listen("shopRefreshCost",()=>{this.scene.isActive()&&this.updateRefreshButtonState()}))}}cleanupListeners(){var t,r,s,i;console.log("Shop Scene: Cleaning up listeners."),(t=this.phaseListenerUnsub)==null||t.call(this),this.phaseListenerUnsub=null,this.playerStateListenersUnsub.forEach(l=>l()),this.playerStateListenersUnsub.clear(),this.shopOfferListenersUnsub.forEach(l=>l()),this.shopOfferListenersUnsub=[],this.listeners.forEach(l=>l()),this.listeners=[],this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(r=this.continueButton)==null||r.off("pointerdown"),(s=this.continueButton)==null||s.off("pointerover"),(i=this.continueButton)==null||i.off("pointerout")}updateWaitingStatus(){if(!E||!E.sessionId||!this.continueButton||!this.waitingText||!this.scene.isActive())return;const t=E.state.players.get(E.sessionId);if(!t)return;let r=!0;E.state.players.forEach(c=>{c.isReady||(r=!1)});const s=t.isReady,i=E.state.currentPhase===Le.Shop,l=!s&&i;this.continueButton.setInteractive(l),this.continueButton.setColor(l?"#00ff00":"#888888"),s&&!r&&i?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.continueButton.setText("Waiting...")):i?(this.waitingText.setVisible(!1),this.continueButton.setText("Continue")):(this.waitingText.setText(`Waiting for ${E.state.currentPhase} phase...`).setVisible(!0),this.continueButton.setText("Continue")),this.shopCardObjects.forEach(c=>{c.input&&(c.input.enabled=l)})}shutdown(){var t,r,s,i,l,c,h,f;console.log("Shop scene shutting down."),this.cleanupListeners(),this.shopCardObjects.forEach(p=>p.destroy()),this.shopCardObjects=[],(t=this.continueButton)==null||t.destroy(),(r=this.waitingText)==null||r.destroy(),(s=this.refreshButton)==null||s.off("pointerdown"),(i=this.refreshButton)==null||i.off("pointerover"),(l=this.refreshButton)==null||l.off("pointerout"),(c=this.refreshButton)==null||c.destroy(),(h=this.toggleShopButton)==null||h.destroy(),(f=this.shopOffersContainer)==null||f.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class Lp extends Cn.Scene{constructor(){super("Preparation");ae(this,"startBattleButton");ae(this,"waitingText");ae(this,"playerStateListener",null);ae(this,"handListener",null);ae(this,"battlefieldListener",null);ae(this,"phaseListener",null);ae(this,"playerStateListenerUnsub",null);ae(this,"handAddUnsub",null);ae(this,"handRemoveUnsub",null);ae(this,"handChangeUnsub",null);ae(this,"battlefieldAddUnsub",null);ae(this,"battlefieldRemoveUnsub",null);ae(this,"battlefieldChangeUnsub",null);ae(this,"phaseListenerUnsub",null);ae(this,"otherPlayerChangeListeners",new Map);ae(this,"otherPlayerAddUnsub",null);ae(this,"otherPlayerRemoveUnsub",null);ae(this,"clientSideCardLayout",new Map)}create(){var i;if(this.scene.launch("background"),(i=this.scene.get("BoardView"))!=null&&i.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!E||!E.state||!E.sessionId){console.error("Preparation Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>this.scene.start("MainMenu"));return}const t=this.cameras.main.centerX;this.cameras.main.centerY;const r=this.cameras.main.height;this.cameras.main.width;const s=E.state.players.get(E.sessionId);s?console.log("Preparation Create: Initial myPlayerState.hand contents:",JSON.stringify(Object.fromEntries(s.hand.entries()))):console.log("Preparation Create: myPlayerState not found initially."),this.add.text(t,80,"Preparation Phase",{fontFamily:"Arial Black",fontSize:48,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.startBattleButton=this.add.text(t,r-50,"Start Battle",{fontFamily:"Arial Black",fontSize:40,color:"#888888",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.startBattleButton.setColor("#888888").disableInteractive(),this.waitingText=this.add.text(t,r-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(100,this.updateStartButtonState,[],this),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!E||!E.sessionId)return;const t=E.sessionId,r=vn.getStateCallbacks(E),s=E.state.players.get(t);s?(this.playerStateListenerUnsub=r(s).onChange(()=>{this.scene.isActive()&&this.updateWaitingStatus()}),this.handAddUnsub=r(s.hand).onAdd((i,l)=>{console.log(`Preparation Scene: player.hand.onAdd triggered for key: ${l}, card: ${i==null?void 0:i.name}. Scene active: ${this.scene.isActive()}`),this.scene.isActive()&&this.updateStartButtonState()}),this.handRemoveUnsub=r(s.hand).onRemove((i,l)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldAddUnsub=r(s.battlefield).onAdd((i,l)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldRemoveUnsub=r(s.battlefield).onRemove((i,l)=>{this.scene.isActive()&&this.updateStartButtonState()})):console.error("Preparation Scene: My player state not found on init."),this.phaseListenerUnsub=r(E.state).listen("currentPhase",i=>{this.scene.isActive()&&(console.log(`Preparation Scene: Phase changed to ${i}`),i===Le.Battle?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Battle")):i!==Le.Preparation&&(console.warn(`Preparation Scene: Unexpected phase change to ${i}. Returning to Lobby.`),this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby"))),this.updateWaitingStatus())}),this.otherPlayerAddUnsub=r(E.state.players).onAdd((i,l)=>{if(this.scene.isActive()){if(l!==t){const c=r(i).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(l,c)}this.updateWaitingStatus()}}),this.otherPlayerRemoveUnsub=r(E.state.players).onRemove((i,l)=>{if(this.scene.isActive()){const c=this.otherPlayerChangeListeners.get(l);c==null||c(),this.otherPlayerChangeListeners.delete(l),this.updateWaitingStatus()}}),E.state.players.forEach((i,l)=>{if(l!==t){const c=r(i).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(l,c)}})}cleanupListeners(){var t,r,s,i,l,c,h,f,p,d,S,M,Y;console.log("Preparation Scene: Cleaning up listeners."),(t=this.playerStateListenerUnsub)==null||t.call(this),(r=this.handAddUnsub)==null||r.call(this),(s=this.handRemoveUnsub)==null||s.call(this),(i=this.handChangeUnsub)==null||i.call(this),(l=this.battlefieldAddUnsub)==null||l.call(this),(c=this.battlefieldRemoveUnsub)==null||c.call(this),(h=this.battlefieldChangeUnsub)==null||h.call(this),(f=this.phaseListenerUnsub)==null||f.call(this),(p=this.otherPlayerAddUnsub)==null||p.call(this),(d=this.otherPlayerRemoveUnsub)==null||d.call(this),this.otherPlayerChangeListeners.forEach(V=>V()),this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.otherPlayerChangeListeners.clear(),this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(S=this.startBattleButton)==null||S.off("pointerdown"),(M=this.startBattleButton)==null||M.off("pointerover"),(Y=this.startBattleButton)==null||Y.off("pointerout")}makeLocalPlayerCardsDraggable(){if(!E||!E.sessionId||!this.scene.isActive()){console.warn("Preparation: Cannot make cards draggable, room/session/scene inactive.");return}const t=E.sessionId,r=E.state.players.get(t),s=this.scene.get("BoardView");if(!r||!s){console.warn("Preparation: Player state or BoardView not found for making cards draggable.");return}this.clientSideCardLayout.forEach(l=>{l.gameObject&&l.gameObject.input&&this.input.disable(l.gameObject)}),this.clientSideCardLayout.clear();const i=(l,c)=>{l.forEach((h,f)=>{const p=s.getCardGameObjectByInstanceId(h.instanceId);p?(p.setInteractive({useHandCursor:!0}),this.input.setDraggable(p),this.clientSideCardLayout.set(h.instanceId,{area:c,slotKey:f,gameObject:p})):console.warn(`Preparation: Could not find GameObject in BoardView for card instance ${h.instanceId}`)})};i(r.hand,"hand"),i(r.battlefield,"battlefield"),console.log("Preparation: Made local player cards draggable and initialized clientSideCardLayout.",this.clientSideCardLayout),this.updateStartButtonState()}updateWaitingStatus(){if(!E||!E.sessionId||!this.startBattleButton||!this.waitingText)return;const t=E.state.players.get(E.sessionId);if(!t)return;let r=!0;E.state.players.forEach(i=>{i.isReady||(r=!1)});const s=t.isReady;!s&&(E.state.currentPhase,Le.Preparation),this.updateStartButtonState(),s&&!r?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.startBattleButton.setText("Waiting..."),this.startBattleButton.disableInteractive().setColor("#888888")):(this.waitingText.setVisible(!1),this.startBattleButton.setText("Start Battle"),this.updateStartButtonState())}updateStartButtonState(){if(!this.startBattleButton||!this.startBattleButton.active){console.warn("updateStartButtonState called but button is null or inactive.");return}let t=0;const r=this.scene.get("BoardView");r&&r.scene.isActive()&&r.getLocalPlayerLayoutData().forEach(p=>{p.area==="battlefield"&&t++});const s=t>0,i=E==null?void 0:E.state.players.get(E==null?void 0:E.sessionId),l=(i==null?void 0:i.isReady)??!1,c=(E==null?void 0:E.state.currentPhase)===Le.Preparation;s&&!l&&c?(this.startBattleButton.setColor("#00ff00"),this.startBattleButton.setInteractive({useHandCursor:!0}),this.startBattleButton.off("pointerdown"),this.startBattleButton.once("pointerdown",this.confirmPreparation,this),this.startBattleButton.on("pointerover",()=>this.startBattleButton.setColor("#55ff55")),this.startBattleButton.on("pointerout",()=>this.startBattleButton.setColor("#00ff00"))):(this.waitingText&&!this.waitingText.visible&&this.startBattleButton.setColor("#888888"),this.startBattleButton.disableInteractive(),this.startBattleButton.off("pointerdown"),this.startBattleButton.off("pointerover"),this.startBattleButton.off("pointerout"))}confirmPreparation(){if(!E)return;console.log("Confirming preparation layout...");const t=this.scene.get("BoardView");if(!t||!t.scene.isActive()){console.error("Preparation: BoardView not available to get layout data.");return}const{handLayout:r,battlefieldLayout:s}=t.getCardLayouts();console.log("Sending preparation layout to server:",{handLayout:r,battlefieldLayout:s}),E.send("setPreparation",{handLayout:r,battlefieldLayout:s}),this.updateWaitingStatus()}shutdown(){var t,r;console.log("Preparation scene shutting down explicitly."),this.cleanupListeners(),(t=this.startBattleButton)==null||t.destroy(),(r=this.waitingText)==null||r.destroy(),this.clientSideCardLayout.clear(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class Bp extends Cn.Scene{constructor(){super("Battle");ae(this,"handCardDisplayObjects",new Map);ae(this,"battleOver",!1);ae(this,"resultText");ae(this,"statusText");ae(this,"phaseListenerUnsubscribe",null)}create(){if(this.scene.launch("background"),this.battleOver=!1,!E||!E.state||!E.sessionId){console.error("Battle Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{E==null||E.leave()}catch{}this.scene.start("MainMenu")});return}const t=this.cameras.main.centerX,r=this.cameras.main.centerY,s=this.cameras.main.height;this.cameras.main.width,this.resultText=this.add.text(t,r,"",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setAlpha(0),this.statusText=this.add.text(t,s-50,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5).setAlpha(0),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!E||!E.state)return;const t=vn.getStateCallbacks(E);this.phaseListenerUnsubscribe=t(E.state).listen("currentPhase",r=>{if(this.scene.isActive()){if(console.log(`Battle Scene: Phase changed to ${r}`),r===Le.BattleEnd)this.handleBattleEnd();else if(r===Le.Shop)this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"));else if(r===Le.GameOver)this.handleGameOver();else if(r!==Le.Battle&&(console.warn(`Battle Scene: Unexpected phase change to ${r}. Returning to Lobby.`),this.scene.isActive())){try{E==null||E.leave()}catch{}this.scene.stop(),this.scene.start("Lobby")}}})}cleanupListeners(){var t;console.log("Battle Scene: Cleaning up listeners."),(t=this.phaseListenerUnsubscribe)==null||t.call(this),this.phaseListenerUnsubscribe=null}handleBattleEnd(){var l,c;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Battle ended (server signal received). Displaying results.");const t=E==null?void 0:E.state.players.get(E.sessionId);let r;E==null||E.state.players.forEach((h,f)=>{f!==(E==null?void 0:E.sessionId)&&(r=h)});let s="Battle Ended",i="#ffffff";t&&r?t.health>r.health?(s="Victory!",i="#88ff88"):r.health>t.health?(s="Defeat!",i="#ff8888"):(s="Draw!",i="#ffff88"):(s="Battle Ended (Opponent Left?)",i="#ffffff"),(l=this.resultText)!=null&&l.active&&this.resultText.setText(s).setColor(i).setAlpha(1),(c=this.statusText)!=null&&c.active&&this.statusText.setText("Waiting for next round...").setAlpha(1)}handleGameOver(){var l,c;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Game Over signal received.");const t=E==null?void 0:E.state.players.get(E.sessionId);let r;E==null||E.state.players.forEach((h,f)=>{f!==(E==null?void 0:E.sessionId)&&(r=h)});let s="Game Over!",i="#ffffff";t&&r?t.health>r.health?(s="You Win!",i="#00ff00"):r.health>t.health?(s="You Lose!",i="#ff0000"):(s="Draw!",i="#ffff00"):t?(s="You Win! (Opponent Left)",i="#00ff00"):(s="Game Over (Error?)",i="#ff0000"),(l=this.resultText)!=null&&l.active&&this.resultText.setText(s).setColor(i).setAlpha(1),(c=this.statusText)!=null&&c.active&&this.statusText.setText("Click to return to Main Menu").setAlpha(1),this.input.once("pointerdown",()=>{try{E==null||E.leave()}catch{}this.scene.stop("Background"),this.scene.start("MainMenu")})}shutdown(){var t,r;console.log("Battle scene shutting down explicitly."),this.cleanupListeners(),this.handCardDisplayObjects.forEach(s=>{s==null||s.forEach(i=>i==null?void 0:i.destroy())}),this.handCardDisplayObjects.clear(),(t=this.resultText)==null||t.destroy(),(r=this.statusText)==null||r.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const Lr=100,ua=140,pn=120,gn=168,Ho=15,fa=580,da=420,ha=100,pa=260;class Mp extends Cn.Scene{constructor(){super("BoardView");ae(this,"playerVisuals",new Map);ae(this,"currentPhase",Le.Lobby);ae(this,"sellZone");ae(this,"sellZoneRect");ae(this,"sellZoneText");ae(this,"brewGainText");ae(this,"playerHealthText");ae(this,"opponentHealthText");ae(this,"playerBrewsText");ae(this,"dayPhaseText");ae(this,"opponentUsernameText");ae(this,"listeners",[]);ae(this,"cardSchemaListeners",new Map)}updateCardHpVisuals(t,r,s){if(!t||!t.active)return;const i=t.getData("hpTextObject"),l=t.getData("mainCardImage");if(i&&i.active){i.setText(`${r}/${s}`);const h=s>0?r/s:0;r<=0?i.setColor("#ff0000"):h<.3?i.setColor("#ff8888"):h<.6?i.setColor("#ffff88"):i.setColor("#88ff88")}const c=t.alpha<1;r<=0?c||(t.setAlpha(.6),l&&l.active&&typeof l.setTint=="function"&&l.setTint(7829367)):c&&(t.setAlpha(1),l&&l.active&&typeof l.clearTint=="function"?l.clearTint():l&&l.active&&console.warn("BoardView: updateCardHpVisuals - clearTint method not found on mainCardImage for card.",t.getData("instanceId"),l))}preload(){if(!this.textures.exists("cardBack")){const t=this.make.graphics({x:0,y:0});t.fillStyle(5253758),t.fillRect(0,0,pn,gn),t.lineStyle(2,12428501),t.strokeRect(0,0,pn,gn),t.generateTexture("cardBack",pn,gn),t.destroy()}}create(){console.log("BoardView creating..."),this.createNavbar(),this.createSellZone(),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createNavbar(){const t=this.cameras.main.centerX,r=this.cameras.main.width,s=30;this.add.rectangle(t,s,r,50,0,.7).setDepth(1e3);const l={fontFamily:"Arial",fontSize:16,color:"#ffffff",align:"left"};this.playerHealthText=this.add.text(r*.05,s,"You: -- HP",{...l,color:"#00ff00"}).setOrigin(0,.5).setDepth(1001),this.playerBrewsText=this.add.text(r*.95,s,"Brews: --",{...l,color:"#ffff00",align:"right"}).setOrigin(1,.5).setDepth(1001),this.opponentUsernameText=this.add.text(r*.25,s-10,"Opponent: --",{...l,fontSize:14}).setOrigin(0,.5).setDepth(1001),this.opponentHealthText=this.add.text(r*.25,s+10,"-- HP",{...l,color:"#ff0000"}).setOrigin(0,.5).setDepth(1001),this.dayPhaseText=this.add.text(t,s,"Day -- - Phase --",{...l,fontSize:20,align:"center"}).setOrigin(.5).setDepth(1001)}showAttackAnimation(t){const r=this.getCardGameObjectByInstanceId(t);if(r&&r.active){const s=r.scaleX,i=r.scaleY;this.tweens.add({targets:r,scaleX:s*1.15,scaleY:i*1.15,duration:100,yoyo:!0,ease:"Sine.easeInOut"})}}showDamageNumber(t,r){const s=this.getCardGameObjectByInstanceId(t);if(s&&s.active&&r>0){const i=this.add.text(s.x+Phaser.Math.Between(-10,10),s.y-gn/2-10,`-${r}`,{fontFamily:"Arial Black",fontSize:24,color:"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(s.depth+1);this.tweens.add({targets:i,y:i.y-50,alpha:0,duration:1e3,ease:"Power1",onComplete:()=>{i.destroy()}})}}drawAttackLine(t,r){const s=this.getCardGameObjectByInstanceId(t),i=this.getCardGameObjectByInstanceId(r);if(s&&s.active&&i&&i.active){const l=this.add.line(0,0,s.x,s.y,i.x,i.y,16724787,.7).setOrigin(0,0).setLineWidth(2).setDepth(s.depth);this.time.delayedCall(250,()=>{l.destroy()})}}setupColyseusListeners(){if(!E||!E.state){console.error("BoardView: Colyseus room or state not available!"),this.time.delayedCall(100,this.setupColyseusListeners,[],this);return}const t=vn.getStateCallbacks(E);this.listeners.push(t(E.state).listen("currentDay",()=>this.updateNavbarText())),this.listeners.push(t(E.state).listen("currentPhase",(r,s)=>{this.currentPhase=r,this.updateNavbarText(),r===Le.Shop||r===Le.Preparation?this.sellZone.setVisible(!0):this.sellZone.setVisible(!1);const i=(l,c,h,f)=>{if(!l.active)return;const p=l.getData("cooldownBarBg"),d=l.getData("cooldownBarFill");if(r===Le.Battle){if(l.getData("area")==="battlefield")if(c)if(p&&d){p.setVisible(!0),d.setVisible(!0);const M=l.getData("cooldownBarBaseWidth"),Y=typeof M=="number"?M:Lr-10;d.setSize(Y,6);const V=(c.speed>0?c.speed:1.5)*1e3;l.setData("maxAttackCooldown",V),l.setData("attackCooldownTimer",V)}else console.warn(`BoardView: Battle Phase - Card ${c.instanceId} (Owner: ${h}, Slot: ${f}) missing cooldown bar elements in data. Bg: ${!!p}, Fill: ${!!d}`);else console.warn(`BoardView: Battle Phase - Battlefield card container (Owner: ${h}, Slot: ${f}) has no cardSchema. No cooldown bar shown.`)}else p&&p.setVisible(!1),d&&d.setVisible(!1);if((s===Le.Battle||s===Le.BattleEnd)&&r!==Le.Battle&&r!==Le.BattleEnd&&c&&c.currentHp>0){l.setAlpha(1);const S=l.getData("mainCardImage");S&&S.active&&typeof S.clearTint=="function"&&S.clearTint()}};this.playerVisuals.forEach((l,c)=>{l.battlefield.forEach((h,f)=>{var d;const p=(d=E==null?void 0:E.state.players.get(c))==null?void 0:d.battlefield.get(f);i(h,p,c,f)}),l.hand.forEach((h,f)=>{var d;const p=(d=E==null?void 0:E.state.players.get(c))==null?void 0:d.hand.get(f);if((s===Le.Battle||s===Le.BattleEnd)&&r!==Le.Battle&&r!==Le.BattleEnd&&p&&p.currentHp>0){h.setAlpha(1);const S=h.getData("mainCardImage");S&&S.active&&typeof S.clearTint=="function"&&S.clearTint()}})})})),this.listeners.push(t(E.state.players).onAdd((r,s)=>{console.log(`BoardView: Player added ${s}`),this.addPlayerVisuals(s),this.addPlayerListeners(r,s),this.updatePlayerSlots(r,s),this.updateNavbarText()})),this.listeners.push(t(E.state.players).onRemove((r,s)=>{console.log(`BoardView: Player removed ${s}`),this.removePlayerVisuals(s),this.updateNavbarText()})),this.listeners.push(E.onMessage("battleAttackEvent",r=>{if(this.currentPhase!==Le.Battle||!this.scene.isActive())return;console.log("BoardView: Received battleAttackEvent",r);const s=this.getCardGameObjectByInstanceId(r.attackerInstanceId),i=this.getCardGameObjectByInstanceId(r.targetInstanceId);if(s&&s.active&&i&&i.active){this.drawAttackLine(r.attackerInstanceId,r.targetInstanceId),this.showAttackAnimation(r.attackerInstanceId),this.showDamageNumber(r.targetInstanceId,r.damageDealt);const l=s.getData("maxAttackCooldown");if(l>0){s.setData("attackCooldownTimer",l);const p=s.getData("cooldownBarFill"),d=s.getData("cooldownBarBaseWidth")||Lr-10;p&&p.setSize(d,6)}const c=i.getData("ownerSessionId"),h=i.getData("slotKey"),f=i.getData("area");if(c===r.targetPlayerId&&f==="battlefield"&&h){const p=E.state.players.get(r.targetPlayerId),d=p==null?void 0:p.battlefield.get(h);if(d&&d.instanceId===r.targetInstanceId){const S=Math.max(0,d.currentHp-r.damageDealt);this.updateCardHpVisuals(i,S,d.health)}else console.warn(`BoardView: battleAttackEvent - Target card schema not found or instanceId mismatch for player ${r.targetPlayerId}, slot ${h}, instance ${r.targetInstanceId}.`)}else console.warn(`BoardView: battleAttackEvent - Target card container data inconsistent or not on battlefield. Owner: ${c}, Area: ${f}, Slot: ${h}`)}else console.warn("BoardView: Attacker or target not found/active for battleAttackEvent",r)})),E.state.players.forEach((r,s)=>{this.addPlayerVisuals(s),this.addPlayerListeners(r,s),this.updatePlayerSlots(r,s)}),this.updateNavbarText()}update(t,r){!this.scene.isActive()||this.currentPhase!==Le.Battle||!E||!E.state||this.playerVisuals.forEach(s=>{s.battlefield.forEach(i=>{if(!i.active)return;const l=i.getData("maxAttackCooldown");let c=i.getData("attackCooldownTimer");const h=i.getData("cooldownBarBaseWidth")||Lr-10;if(l>0){c-=r,c<0&&(c=0),i.setData("attackCooldownTimer",c);const f=i.getData("cooldownBarFill");if(f&&f.visible){const p=c/l;f.setSize(h*Math.max(0,p),6)}}})})}addPlayerListeners(t,r){const s=vn.getStateCallbacks(E),i=[];i.push(s(t).listen("health",()=>this.updateNavbarText())),i.push(s(t).listen("brews",()=>this.updateNavbarText())),i.push(s(t).listen("username",()=>this.updateNavbarText())),i.push(s(t.hand).onAdd((l,c)=>{this.updateCardVisual(r,"hand",c,l),this.addCardSchemaListeners(l)})),i.push(s(t.hand).onRemove((l,c)=>{this.removeCardVisual(r,"hand",c)})),t.hand.forEach((l,c)=>{this.addCardSchemaListeners(l)}),i.push(s(t.battlefield).onAdd((l,c)=>{this.updateCardVisual(r,"battlefield",c,l),this.addCardSchemaListeners(l)})),i.push(s(t.battlefield).onRemove((l,c)=>{this.removeCardVisual(r,"battlefield",c)})),t.battlefield.forEach((l,c)=>{this.addCardSchemaListeners(l)}),this.listeners.push(...i)}addCardSchemaListeners(t){if(!t||!t.instanceId)return;const r=vn.getStateCallbacks(E),s=this.cardSchemaListeners.get(t.instanceId);s&&(s.forEach(c=>c()),this.cardSchemaListeners.delete(t.instanceId));const i=[],l=r(t).listen("currentHp",(c,h)=>{const f=this.getCardGameObjectByInstanceId(t.instanceId);f&&this.updateCardHpVisuals(f,c,t.health)});i.push(l),i.length>0&&this.cardSchemaListeners.set(t.instanceId,i)}updatePlayerSlots(t,r){t.hand.forEach((s,i)=>this.updateCardVisual(r,"hand",i,s)),t.battlefield.forEach((s,i)=>this.updateCardVisual(r,"battlefield",i,s))}addPlayerVisuals(t){if(!this.playerVisuals.has(t)){const r=[],s=[],i=t===(E==null?void 0:E.sessionId);for(let l=0;l<5;l++){const c=this.calculateSlotX(l,"hand"),h=i?fa:ha,f=this.add.rectangle(c,h,pn,gn).setStrokeStyle(2,i?11184810:7829367,.8).setDepth(0);r.push(f);const p=this.calculateSlotX(l,"battlefield"),d=i?da:pa,S=this.add.rectangle(p,d,Lr,ua).setStrokeStyle(2,i?16777215:11184810,1).setDepth(0);s.push(S)}this.playerVisuals.set(t,{hand:new Map,battlefield:new Map,handSlotOutlines:r,battlefieldSlotOutlines:s})}}removePlayerVisuals(t){const r=this.playerVisuals.get(t);r&&(r.hand.forEach(s=>s.destroy()),r.battlefield.forEach(s=>s.destroy()),r.handSlotOutlines.forEach(s=>s.destroy()),r.battlefieldSlotOutlines.forEach(s=>s.destroy())),this.playerVisuals.delete(t)}updateCardVisual(t,r,s,i){if(!this.scene.isActive()||!E||!E.state)return;this.removeCardVisual(t,r,s);const l=this.playerVisuals.get(t);if(!l)return;const c=t===(E==null?void 0:E.sessionId),h=this.calculateSlotX(parseInt(s,10),r);let f,p=!1;r==="hand"?(f=c?fa:ha,c||(p=!0)):f=c?da:pa;const d=this.createCardGameObject(i,h,f,p,c,r);if(d.setData("instanceId",i.instanceId),d.setData("slotKey",s),d.setData("area",r),d.setData("ownerSessionId",t),d.setDepth(1),i.currentHp<=0){d.setAlpha(.6);const S=d.getData("mainCardImage");S&&S.active&&typeof S.setTint=="function"&&S.setTint(7829367);const M=d.getData("hpTextObject");M&&M.active&&M.setColor("#ff0000")}r==="hand"?l.hand.set(s,d):l.battlefield.set(s,d),this.addCardSchemaListeners(i),c&&this.makeCardInteractive(d)}removeCardVisual(t,r,s){const i=this.playerVisuals.get(t);if(i){const l=r==="hand"?i.hand:i.battlefield,c=l.get(s);if(c){const h=c.getData("instanceId");if(h){const f=this.cardSchemaListeners.get(h);f&&(console.log(`BoardView: Cleaning up ${f.length} listeners for card instance ${h} during removeCardVisual.`),f.forEach(p=>{if(typeof p=="function")try{p()}catch(d){console.warn(`BoardView: Error unsubscribing card listener for ${h}`,d)}}),this.cardSchemaListeners.delete(h))}c.input&&c.input.enabled&&this.input.disable(c),this.time.delayedCall(1,()=>{c.active&&c.destroy()}),l.delete(s)}}}calculateSlotX(t,r){const s=r==="hand"?pn:Lr,i=5*s+4*Ho;return(this.cameras.main.width-i)/2+s/2+t*(s+Ho)}createCardGameObject(t,r,s,i,l,c){const h=this.add.container(r,s),f=c==="hand"?pn:Lr,p=c==="hand"?gn:ua;if(h.setData("displayCardWidth",f),h.setData("displayCardHeight",p),i){const M=this.add.image(0,0,"cardBack").setOrigin(.5).setDisplaySize(pn,gn);return h.add(M),h}const d=c==="hand"?"cardFullTier1":"cardMinionTier1",S=this.add.image(0,0,d).setOrigin(.5);if(S.setDisplaySize(f,p),h.add(S),h.setData("mainCardImage",S),c==="hand"){const M=this.add.text(0,-20,t.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:f-20}}).setOrigin(.5,.5);h.add(M);const Y=this.add.text(-100/2+32,ua*.03,`${t.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);h.add(Y);const V=this.add.text(Lr/2-18,6,`${t.currentHp}  ${t.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(1,.5);h.add(V),h.setData("hpTextObject",V);const H=this.add.text(0,p/2-50,`${t.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);h.add(H)}else{const M=this.add.text(0,-p/2+5,t.name,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:f}}).setOrigin(.5,0);h.add(M);const Y=this.add.text(-f/2+32,32,`${t.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);h.add(Y);const V=this.add.text(0,43,`${t.speed}`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(1,0);h.add(V);const H=this.add.text(f/2-10,p/2-30,`${t.currentHp}/${t.health}`,{fontFamily:"Arial",fontSize:14,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,1);h.add(H),h.setData("hpTextObject",H);const ce=p/2-15,fe=f-10,te=this.add.rectangle(0,ce,fe,6,0,.5).setVisible(!1),ye=this.add.rectangle(-fe/2,ce,fe,6,4521796).setOrigin(0,.5).setVisible(!1);h.add(te),h.add(ye),h.setData("cooldownBarBg",te),h.setData("cooldownBarFill",ye),h.setData("attackCooldownTimer",0),h.setData("maxAttackCooldown",0),h.setData("cooldownBarBaseWidth",fe)}return h}getCardGameObjectByInstanceId(t){for(const[r,s]of this.playerVisuals){for(const[i,l]of s.hand)if(l.getData("instanceId")===t)return l;for(const[i,l]of s.battlefield)if(l.getData("instanceId")===t)return l}}getSlotPixelPosition(t,r,s){if(s<0||s>4)return;const i=this.calculateSlotX(s,r);let l;return r==="hand"?l=t?fa:ha:l=t?da:pa,{x:i,y:l}}makeCardInteractive(t){const r=t.getData("displayCardWidth"),s=t.getData("displayCardHeight");if(!r||!s){console.warn("BoardView: makeCardInteractive - displayCardWidth/Height not found on container.",t.getData("instanceId"));return}const i=new Phaser.Geom.Rectangle(-r/2,-s/2,r,s);t.setInteractive({hitArea:i,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}),this.input.setDraggable(t),t.input&&(t.input.enabled=!0),t.on("dragstart",l=>{this.currentPhase!==Le.Shop&&this.currentPhase!==Le.Preparation||!t.input||!t.input.enabled||(this.children.bringToTop(t),t.setAlpha(.7),t.setData("isDragging",!0),t.setData("originalX",t.x),t.setData("originalY",t.y),t.setData("originalAreaOnDragStart",t.getData("area")),t.setData("originalSlotKeyOnDragStart",t.getData("slotKey")))}),t.on("drag",(l,c,h)=>{if(t.getData("isDragging"))if(t.x=c,t.y=h,(this.currentPhase===Le.Shop||this.currentPhase===Le.Preparation)&&this.sellZone.visible)if(this.isDroppedOnSellZone(t)){const f=t.getData("instanceId"),p=t.getData("originalAreaOnDragStart"),d=t.getData("originalSlotKeyOnDragStart"),S=t.getData("ownerSessionId"),M=E==null?void 0:E.state.players.get(S);let Y;if(M&&(p==="hand"?Y=M.hand.get(d):Y=M.battlefield.get(d)),Y&&Y.instanceId===f){const V=Math.max(1,Math.floor(Y.brewCost/2));this.brewGainText.setText(`Sell: +${V} 🍺`),this.brewGainText.setAlpha(1)}else this.brewGainText.setAlpha(0)}else this.brewGainText.setAlpha(0);else this.brewGainText.setAlpha(0)}),t.on("dragend",l=>{if(!t.getData("isDragging"))return;t.setAlpha(1),t.setData("isDragging",!1),this.brewGainText.setAlpha(0);const c=t.getData("instanceId"),h=t.getData("originalAreaOnDragStart"),f=t.getData("originalSlotKeyOnDragStart"),p=t.getData("ownerSessionId");if((this.currentPhase===Le.Shop||this.currentPhase===Le.Preparation)&&this.sellZone.visible&&this.isDroppedOnSellZone(t)){const d=E==null?void 0:E.state.players.get(E==null?void 0:E.sessionId);let S;if(h==="hand"&&(d!=null&&d.hand.has(f))?S=d.hand.get(f):h==="battlefield"&&(d!=null&&d.battlefield.has(f))&&(S=d.battlefield.get(f)),S&&S.instanceId===c){const fe=Math.max(1,Math.floor(S.brewCost/2));E==null||E.send("sellCard",{instanceId:c,area:h,slotKey:f}),this.showBrewGain(fe);return}const M=t.getData("ownerSessionId"),Y=E==null?void 0:E.state.players.get(M);Y&&(h==="hand"?S=Y.hand.get(f):S=Y.battlefield.get(f));let V=!1,H,ce;for(let fe=0;fe<5;fe++){const te=String(fe),ye=this.getSlotPixelPosition(!0,"hand",fe);if(ye){const Xe=new Phaser.Geom.Rectangle(ye.x-pn/2,ye.y-gn/2,pn,gn);if(Phaser.Geom.Rectangle.Contains(Xe,t.x,t.y)){if(this.isSlotEmpty(p,"hand",te,c)){let Je=!1;if(this.currentPhase===Le.Shop?h==="hand"&&(Je=!0):this.currentPhase===Le.Preparation&&h==="hand"&&(Je=!0),Je){t.x=ye.x,t.y=ye.y;const He=h!=="hand";if(t.setData("area","hand"),t.setData("slotKey",te),this.updateVisualMaps(p,h,f,"hand",te,t),He){const tt=E==null?void 0:E.state.players.get(p);let Ge;tt&&(Ge=tt.hand.get(te),Ge||(h==="battlefield"?Ge=tt.battlefield.get(f):Ge=tt.hand.get(f))),Ge&&Ge.instanceId===c&&this.updateCardVisual(p,"hand",te,Ge)}V=!0,H="hand",ce=te,this.currentPhase===Le.Shop&&(h!=="hand"||f!==te)&&(E==null||E.send("moveCardInHand",{instanceId:c,fromSlotKey:f,toSlotKey:te}))}}if(V)break}}}if(!V&&this.currentPhase===Le.Preparation)for(let fe=0;fe<5;fe++){const te=String(fe),ye=this.getSlotPixelPosition(!0,"battlefield",fe);if(ye){const Xe=new Phaser.Geom.Rectangle(ye.x-pn/2,ye.y-gn/2,pn,gn);if(Phaser.Geom.Rectangle.Contains(Xe,t.x,t.y)){if(this.isSlotEmpty(p,"battlefield",te,c)){t.x=ye.x,t.y=ye.y;const Je=h!=="battlefield";if(t.setData("area","battlefield"),t.setData("slotKey",te),this.updateVisualMaps(p,h,f,"battlefield",te,t),Je){const He=E==null?void 0:E.state.players.get(p),tt=(He==null?void 0:He.battlefield.get(te))||(He==null?void 0:He.hand.get(f));tt&&tt.instanceId===c&&this.updateCardVisual(p,"battlefield",te,tt)}V=!0,H="battlefield",ce=te}break}}}if(V?this.currentPhase===Le.Preparation&&H&&ce&&(h!==H||f!==ce)&&(E==null||E.send("updatePrepLayout",{instanceId:c,newArea:H,newSlotKey:ce})):(t.x=t.getData("originalX"),t.y=t.getData("originalY"),t.setData("area",h),t.setData("slotKey",f)),this.currentPhase===Le.Preparation){const fe=this.scene.get("Preparation");fe&&fe.scene.isActive()&&fe.updateStartButtonState&&fe.updateStartButtonState()}}})}getCardLayouts(){const t={},r={};if(!E||!E.sessionId){for(let l=0;l<5;l++)t[String(l)]=null,r[String(l)]=null;return{handLayout:t,battlefieldLayout:r}}const s=E.sessionId,i=this.playerVisuals.get(s);for(let l=0;l<5;l++){const c=String(l);if(i&&i.hand.has(c)){const h=i.hand.get(c);t[c]=(h==null?void 0:h.getData("instanceId"))||null}else t[c]=null;if(i&&i.battlefield.has(c)){const h=i.battlefield.get(c);r[c]=(h==null?void 0:h.getData("instanceId"))||null}else r[c]=null}return{handLayout:t,battlefieldLayout:r}}isSlotEmpty(t,r,s,i){const l=this.playerVisuals.get(t);if(!l)return!1;const h=(r==="hand"?l.hand:l.battlefield).get(s);return h?h.getData("instanceId")===i:!0}isDroppedOnSellZone(t){return this.sellZone.visible?new Phaser.Geom.Rectangle(this.sellZone.x-this.sellZoneRect.width/2-20,this.sellZone.y-this.sellZoneRect.height/2-20,this.sellZoneRect.width+40,this.sellZoneRect.height+40).contains(t.x,t.y):!1}showBrewGain(t){this.brewGainText.setText(`+${t} 🍺`),this.brewGainText.setAlpha(1),this.brewGainText.y=-50,this.brewGainText.x=0,this.tweens.add({targets:this.brewGainText,scaleX:1.5,scaleY:1.5,duration:100,yoyo:!0,ease:"Cubic.easeOut",onComplete:()=>{this.tweens.add({targets:this.brewGainText,y:this.brewGainText.y-80,alpha:0,duration:1500,ease:"Power2"})}}),this.tweens.add({targets:this.sellZoneRect,fillAlpha:.7,duration:200,yoyo:!0,repeat:1,ease:"Cubic.easeOut"})}updateVisualMaps(t,r,s,i,l,c){const h=this.playerVisuals.get(t);if(!h)return;const f=r==="hand"?h.hand:h.battlefield;f.get(s)===c&&f.delete(s),(i==="hand"?h.hand:h.battlefield).set(l,c)}getPlayerCardGameObjects(t){const r=[],s=this.playerVisuals.get(t);return s&&(s.hand.forEach(i=>r.push(i)),s.battlefield.forEach(i=>r.push(i))),r}getLocalPlayerLayoutData(){const t=[];if(!E||!E.sessionId)return t;const r=E.sessionId,s=this.playerVisuals.get(r);return s&&(s.hand.forEach((i,l)=>{t.push({instanceId:i.getData("instanceId"),area:"hand",slotKey:i.getData("slotKey")})}),s.battlefield.forEach((i,l)=>{t.push({instanceId:i.getData("instanceId"),area:"battlefield",slotKey:i.getData("slotKey")})})),t}createSellZone(){this.sellZone=this.add.container(this.cameras.main.width-80,this.cameras.main.height/2),this.sellZone.setDepth(1e3),this.sellZoneRect=this.add.rectangle(0,0,120,160,16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1),this.sellZone.add(this.sellZoneRect),this.sellZoneText=this.add.text(0,0,"SELL",{fontFamily:"Arial Black",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.sellZone.add(this.sellZoneText),this.brewGainText=this.add.text(0,-50,"",{fontFamily:"Arial Black",fontSize:20,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setAlpha(0),this.sellZone.add(this.brewGainText);const t=this.add.text(0,50,`Drag cards here
to sell`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5);this.sellZone.add(t),this.input.on("dragenter",(r,s,i)=>{s instanceof Phaser.GameObjects.Container&&this.sellZone.visible&&this.isDroppedOnSellZone(s)&&(this.sellZoneRect.setFillStyle(16711680,.5),this.sellZoneRect.setStrokeStyle(3,16733525,1))}),this.input.on("dragleave",(r,s,i)=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.input.on("drop",()=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.sellZone.setVisible(!1)}updateNavbarText(){if(!E||!E.state||!this.playerHealthText||!this.playerHealthText.active)return;const t=E.sessionId,r=E.state.players.get(t);let s,i="Opponent: --";E.state.players.forEach((h,f)=>{f!==t&&(s=h,i=`Opponent: ${h.username||"Connecting..."}`)}),this.playerHealthText.setText(`You: ${(r==null?void 0:r.health)??"--"} HP`),this.playerBrewsText.setText(`Brews: ${(r==null?void 0:r.brews)??"--"}`),this.opponentUsernameText.setText(i),this.opponentHealthText.setText(`${(s==null?void 0:s.health)??"--"} HP`);const l=E.state.currentDay,c=E.state.currentPhase;this.dayPhaseText.setText(`Day ${l} - ${c}`)}cleanupListeners(){var t,r,s,i,l,c,h;console.log("BoardView: Cleaning up listeners."),this.listeners.forEach(f=>{if(typeof f=="function")try{f()}catch(p){console.warn("BoardView: Error cleaning up listener:",p)}}),this.listeners=[],this.cardSchemaListeners.forEach((f,p)=>{console.log(`BoardView cleanup: Cleaning up ${f.length} listeners for card instance ${p}`),f.forEach(d=>{if(typeof d=="function")try{d()}catch(S){console.warn(`BoardView: Error unsubscribing card listener for ${p}`,S)}})}),this.cardSchemaListeners.clear(),this.playerVisuals.forEach(f=>{f.hand.forEach(p=>p.destroy()),f.battlefield.forEach(p=>p.destroy())}),this.playerVisuals.clear(),(t=this.playerHealthText)==null||t.destroy(),(r=this.opponentHealthText)==null||r.destroy(),(s=this.playerBrewsText)==null||s.destroy(),(i=this.dayPhaseText)==null||i.destroy(),(l=this.opponentUsernameText)==null||l.destroy(),(c=this.sellZone)==null||c.destroy(),(h=this.brewGainText)==null||h.destroy(),this.input.off("dragenter"),this.input.off("dragleave"),this.input.off("drop")}shutdown(){console.log("BoardView shutting down..."),this.cleanupListeners(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}(async()=>(await Tp(),new ga({type:Phaser.AUTO,parent:"gameParent",width:1280,height:720,backgroundColor:"#000000",roundPixels:!1,pixelArt:!1,scene:[Op,Np,Dp,Pp,kp,Lp,Bp,Mp,xp,Rp]})))();
