var Jc=Object.defineProperty;var Qc=(s,t,e)=>t in s?Jc(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var fe=(s,t,e)=>Qc(s,typeof t!="symbol"?t+"":t,e);import{P as yi,c as $a,g as Ma,p as os}from"./phaser-CxRn4yEY.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function e(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(a){if(a.ep)return;a.ep=!0;const l=e(a);fetch(a.href,l)}})();const je=class je{constructor(t){fe(this,"game");fe(this,"canvas");fe(this,"parent");fe(this,"guide");const e=t.width,r=t.height;je.width=e,je.height=r,je.center=new yi.Math.Vector2(e/2,r/2),je.isLandscape=je.width>je.height,je.gameZone=new yi.Geom.Rectangle(0,0,e,r),je.uiZone=new yi.Geom.Rectangle(0,0,e,r),je.cameras=new Set,t.callbacks={postBoot:()=>this.gameBootHandler()},this.game=new yi.Game(t)}gameBootHandler(){je.scaleManager=this.game.scale,je.scaleManager.on("resize",()=>this.onResizeHandler()),this.canvas=this.game.canvas,this.parent=this.canvas.parentElement,this.guide=document.getElementById("guide"),window.setTimeout(()=>this.onResizeHandler(),16)}onResizeHandler(){const t=this.parent.getBoundingClientRect(),e=this.canvas.getBoundingClientRect(),r=this.guide.getBoundingClientRect(),a=t.width/je.width,l=t.height/je.height,u=Math.max(a,l),d=t.width-a,y=t.height-l,g=d*(1/u),E=y*(1/u),h=je.width/2-g/2,T=je.width/2+g/2,M=je.height/2-E/2,J=je.height/2+E/2;je.uiZone.left=h,je.uiZone.right=T,je.uiZone.top=M,je.uiZone.bottom=J;const F=r.width/e.width,z=r.height/e.height,ce=Math.min(F,z);je.scaleFactor=ce,je.cameras.forEach(ge=>{ge.zoom=ce}),this.game.events.emit(je.RESIZE)}static addCamera(t){this.cameras.add(t),t.zoom=je.scaleFactor}static removeCamera(t){this.cameras.delete(t)}static getX(t){if(typeof t=="number")return t;const e=this.scaleManager.width,r=parseInt(t,10);return e*(r/100)}static getY(t){if(typeof t=="number")return t;const e=this.scaleManager.height,r=parseInt(t,10);return e*(r/100)}static getUIX(t){if(typeof t=="number")return t;const e=je.uiZone.width,r=parseInt(t,10);return e*(r/100)}static getUIY(t){if(typeof t=="number")return t;const e=je.uiZone.height,r=parseInt(t,10);return e*(r/100)}};fe(je,"scaleManager"),fe(je,"cameras"),fe(je,"gameZone"),fe(je,"uiZone"),fe(je,"width"),fe(je,"height"),fe(je,"center"),fe(je,"isLandscape"),fe(je,"scaleFactor",1),fe(je,"scaleFactor2",1),fe(je,"RESIZE","scaleflowresize");let va=je;var Ei=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ua(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ia={exports:{}},go;function ef(){return go||(go=1,function(s){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function a(y,g,E){this.fn=y,this.context=g,this.once=E||!1}function l(y,g,E,h,T){if(typeof E!="function")throw new TypeError("The listener must be a function");var M=new a(E,h||y,T),J=e?e+g:g;return y._events[J]?y._events[J].fn?y._events[J]=[y._events[J],M]:y._events[J].push(M):(y._events[J]=M,y._eventsCount++),y}function u(y,g){--y._eventsCount===0?y._events=new r:delete y._events[g]}function d(){this._events=new r,this._eventsCount=0}d.prototype.eventNames=function(){var g=[],E,h;if(this._eventsCount===0)return g;for(h in E=this._events)t.call(E,h)&&g.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(E)):g},d.prototype.listeners=function(g){var E=e?e+g:g,h=this._events[E];if(!h)return[];if(h.fn)return[h.fn];for(var T=0,M=h.length,J=new Array(M);T<M;T++)J[T]=h[T].fn;return J},d.prototype.listenerCount=function(g){var E=e?e+g:g,h=this._events[E];return h?h.fn?1:h.length:0},d.prototype.emit=function(g,E,h,T,M,J){var F=e?e+g:g;if(!this._events[F])return!1;var z=this._events[F],ce=arguments.length,ge,ie;if(z.fn){switch(z.once&&this.removeListener(g,z.fn,void 0,!0),ce){case 1:return z.fn.call(z.context),!0;case 2:return z.fn.call(z.context,E),!0;case 3:return z.fn.call(z.context,E,h),!0;case 4:return z.fn.call(z.context,E,h,T),!0;case 5:return z.fn.call(z.context,E,h,T,M),!0;case 6:return z.fn.call(z.context,E,h,T,M,J),!0}for(ie=1,ge=new Array(ce-1);ie<ce;ie++)ge[ie-1]=arguments[ie];z.fn.apply(z.context,ge)}else{var be=z.length,Fe;for(ie=0;ie<be;ie++)switch(z[ie].once&&this.removeListener(g,z[ie].fn,void 0,!0),ce){case 1:z[ie].fn.call(z[ie].context);break;case 2:z[ie].fn.call(z[ie].context,E);break;case 3:z[ie].fn.call(z[ie].context,E,h);break;case 4:z[ie].fn.call(z[ie].context,E,h,T);break;default:if(!ge)for(Fe=1,ge=new Array(ce-1);Fe<ce;Fe++)ge[Fe-1]=arguments[Fe];z[ie].fn.apply(z[ie].context,ge)}}return!0},d.prototype.on=function(g,E,h){return l(this,g,E,h,!1)},d.prototype.once=function(g,E,h){return l(this,g,E,h,!0)},d.prototype.removeListener=function(g,E,h,T){var M=e?e+g:g;if(!this._events[M])return this;if(!E)return u(this,M),this;var J=this._events[M];if(J.fn)J.fn===E&&(!T||J.once)&&(!h||J.context===h)&&u(this,M);else{for(var F=0,z=[],ce=J.length;F<ce;F++)(J[F].fn!==E||T&&!J[F].once||h&&J[F].context!==h)&&z.push(J[F]);z.length?this._events[M]=z.length===1?z[0]:z:u(this,M)}return this},d.prototype.removeAllListeners=function(g){var E;return g?(E=e?e+g:g,this._events[E]&&u(this,E)):(this._events=new r,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=e,d.EventEmitter=d,s.exports=d}(ia)),ia.exports}var tf=ef(),Xo=Ua(tf),nt;(function(s){s.assertEqual=a=>a;function t(a){}s.assertIs=t;function e(a){throw new Error}s.assertNever=e,s.arrayToEnum=a=>{const l={};for(const u of a)l[u]=u;return l},s.getValidEnumValues=a=>{const l=s.objectKeys(a).filter(d=>typeof a[a[d]]!="number"),u={};for(const d of l)u[d]=a[d];return s.objectValues(u)},s.objectValues=a=>s.objectKeys(a).map(function(l){return a[l]}),s.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const l=[];for(const u in a)Object.prototype.hasOwnProperty.call(a,u)&&l.push(u);return l},s.find=(a,l)=>{for(const u of a)if(l(u))return u},s.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function r(a,l=" | "){return a.map(u=>typeof u=="string"?`'${u}'`:u).join(l)}s.joinValues=r,s.jsonStringifyReplacer=(a,l)=>typeof l=="bigint"?l.toString():l})(nt||(nt={}));var _a;(function(s){s.mergeShapes=(t,e)=>({...t,...e})})(_a||(_a={}));const pe=nt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ps=s=>{switch(typeof s){case"undefined":return pe.undefined;case"string":return pe.string;case"number":return isNaN(s)?pe.nan:pe.number;case"boolean":return pe.boolean;case"function":return pe.function;case"bigint":return pe.bigint;case"symbol":return pe.symbol;case"object":return Array.isArray(s)?pe.array:s===null?pe.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?pe.promise:typeof Map<"u"&&s instanceof Map?pe.map:typeof Set<"u"&&s instanceof Set?pe.set:typeof Date<"u"&&s instanceof Date?pe.date:pe.object;default:return pe.unknown}},re=nt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),nf=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:");class On extends Error{constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const e=t||function(l){return l.message},r={_errors:[]},a=l=>{for(const u of l.issues)if(u.code==="invalid_union")u.unionErrors.map(a);else if(u.code==="invalid_return_type")a(u.returnTypeError);else if(u.code==="invalid_arguments")a(u.argumentsError);else if(u.path.length===0)r._errors.push(e(u));else{let d=r,y=0;for(;y<u.path.length;){const g=u.path[y];y===u.path.length-1?(d[g]=d[g]||{_errors:[]},d[g]._errors.push(e(u))):d[g]=d[g]||{_errors:[]},d=d[g],y++}}};return a(this),r}static assert(t){if(!(t instanceof On))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,nt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){const e={},r=[];for(const a of this.issues)a.path.length>0?(e[a.path[0]]=e[a.path[0]]||[],e[a.path[0]].push(t(a))):r.push(t(a));return{formErrors:r,fieldErrors:e}}get formErrors(){return this.flatten()}}On.create=s=>new On(s);const Tr=(s,t)=>{let e;switch(s.code){case re.invalid_type:s.received===pe.undefined?e="Required":e=`Expected ${s.expected}, received ${s.received}`;break;case re.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(s.expected,nt.jsonStringifyReplacer)}`;break;case re.unrecognized_keys:e=`Unrecognized key(s) in object: ${nt.joinValues(s.keys,", ")}`;break;case re.invalid_union:e="Invalid input";break;case re.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${nt.joinValues(s.options)}`;break;case re.invalid_enum_value:e=`Invalid enum value. Expected ${nt.joinValues(s.options)}, received '${s.received}'`;break;case re.invalid_arguments:e="Invalid function arguments";break;case re.invalid_return_type:e="Invalid function return type";break;case re.invalid_date:e="Invalid date";break;case re.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(e=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?e=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?e=`Invalid input: must end with "${s.validation.endsWith}"`:nt.assertNever(s.validation):s.validation!=="regex"?e=`Invalid ${s.validation}`:e="Invalid";break;case re.too_small:s.type==="array"?e=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?e=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?e=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?e=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:e="Invalid input";break;case re.too_big:s.type==="array"?e=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?e=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?e=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?e=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?e=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:e="Invalid input";break;case re.custom:e="Invalid input";break;case re.invalid_intersection_types:e="Intersection results could not be merged";break;case re.not_multiple_of:e=`Number must be a multiple of ${s.multipleOf}`;break;case re.not_finite:e="Number must be finite";break;default:e=t.defaultError,nt.assertNever(s)}return{message:e}};let Jo=Tr;function sf(s){Jo=s}function Di(){return Jo}const Ri=s=>{const{data:t,path:e,errorMaps:r,issueData:a}=s,l=[...e,...a.path||[]],u={...a,path:l};if(a.message!==void 0)return{...a,path:l,message:a.message};let d="";const y=r.filter(g=>!!g).slice().reverse();for(const g of y)d=g(u,{data:t,defaultError:d}).message;return{...a,path:l,message:d}},rf=[];function de(s,t){const e=Di(),r=Ri({issueData:t,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,e,e===Tr?void 0:Tr].filter(a=>!!a)});s.common.issues.push(r)}class Jt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){const r=[];for(const a of e){if(a.status==="aborted")return Ce;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,e){const r=[];for(const a of e){const l=await a.key,u=await a.value;r.push({key:l,value:u})}return Jt.mergeObjectSync(t,r)}static mergeObjectSync(t,e){const r={};for(const a of e){const{key:l,value:u}=a;if(l.status==="aborted"||u.status==="aborted")return Ce;l.status==="dirty"&&t.dirty(),u.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof u.value<"u"||a.alwaysSet)&&(r[l.value]=u.value)}return{status:t.value,value:r}}}const Ce=Object.freeze({status:"aborted"}),wr=s=>({status:"dirty",value:s}),mn=s=>({status:"valid",value:s}),wa=s=>s.status==="aborted",Ia=s=>s.status==="dirty",zr=s=>s.status==="valid",Wr=s=>typeof Promise<"u"&&s instanceof Promise;function Ni(s,t,e,r){if(typeof t=="function"?s!==t||!0:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(s)}function Qo(s,t,e,r,a){if(typeof t=="function"?s!==t||!0:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(s,e),e}var _e;(function(s){s.errToObj=t=>typeof t=="string"?{message:t}:t||{},s.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(_e||(_e={}));var jr,Hr;class rs{constructor(t,e,r,a){this._cachedPath=[],this.parent=t,this.data=e,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const mo=(s,t)=>{if(zr(t))return{success:!0,data:t.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const e=new On(s.common.issues);return this._error=e,this._error}}};function Ue(s){if(!s)return{};const{errorMap:t,invalid_type_error:e,required_error:r,description:a}=s;if(t&&(e||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(u,d)=>{var y,g;const{message:E}=s;return u.code==="invalid_enum_value"?{message:E??d.defaultError}:typeof d.data>"u"?{message:(y=E??r)!==null&&y!==void 0?y:d.defaultError}:u.code!=="invalid_type"?{message:d.defaultError}:{message:(g=E??e)!==null&&g!==void 0?g:d.defaultError}},description:a}}class He{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return Ps(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:Ps(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Jt,ctx:{common:t.parent.common,data:t.data,parsedType:Ps(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(Wr(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const r=this.safeParse(t,e);if(r.success)return r.data;throw r.error}safeParse(t,e){var r;const a={common:{issues:[],async:(r=e==null?void 0:e.async)!==null&&r!==void 0?r:!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ps(t)},l=this._parseSync({data:t,path:a.path,parent:a});return mo(a,l)}async parseAsync(t,e){const r=await this.safeParseAsync(t,e);if(r.success)return r.data;throw r.error}async safeParseAsync(t,e){const r={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ps(t)},a=this._parse({data:t,path:r.path,parent:r}),l=await(Wr(a)?a:Promise.resolve(a));return mo(r,l)}refine(t,e){const r=a=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(a):e;return this._refinement((a,l)=>{const u=t(a),d=()=>l.addIssue({code:re.custom,...r(a)});return typeof Promise<"u"&&u instanceof Promise?u.then(y=>y?!0:(d(),!1)):u?!0:(d(),!1)})}refinement(t,e){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof e=="function"?e(r,a):e),!1))}_refinement(t){return new Gn({schema:this,typeName:Pe.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return ns.create(this,this._def)}nullable(){return Vs.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jn.create(this,this._def)}promise(){return Ar.create(this,this._def)}or(t){return Xr.create([this,t],this._def)}and(t){return Jr.create(this,t,this._def)}transform(t){return new Gn({...Ue(this._def),schema:this,typeName:Pe.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const e=typeof t=="function"?t:()=>t;return new si({...Ue(this._def),innerType:this,defaultValue:e,typeName:Pe.ZodDefault})}brand(){return new Fa({typeName:Pe.ZodBranded,type:this,...Ue(this._def)})}catch(t){const e=typeof t=="function"?t:()=>t;return new ri({...Ue(this._def),innerType:this,catchValue:e,typeName:Pe.ZodCatch})}describe(t){const e=this.constructor;return new e({...this._def,description:t})}pipe(t){return li.create(this,t)}readonly(){return ii.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const af=/^c[^\s-]{8,}$/i,of=/^[0-9a-z]+$/,lf=/^[0-9A-HJKMNP-TV-Z]{26}$/,cf=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ff=/^[a-z0-9_-]{21}$/i,uf=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,df=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,hf="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let aa;const pf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,gf=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,mf=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,el="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",yf=new RegExp(`^${el}$`);function tl(s){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return s.precision?t=`${t}\\.\\d{${s.precision}}`:s.precision==null&&(t=`${t}(\\.\\d+)?`),t}function Ef(s){return new RegExp(`^${tl(s)}$`)}function nl(s){let t=`${el}T${tl(s)}`;const e=[];return e.push(s.local?"Z?":"Z"),s.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function bf(s,t){return!!((t==="v4"||!t)&&pf.test(s)||(t==="v6"||!t)&&gf.test(s))}class Vn extends He{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==pe.string){const l=this._getOrReturnCtx(t);return de(l,{code:re.invalid_type,expected:pe.string,received:l.parsedType}),Ce}const r=new Jt;let a;for(const l of this._def.checks)if(l.kind==="min")t.data.length<l.value&&(a=this._getOrReturnCtx(t,a),de(a,{code:re.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="max")t.data.length>l.value&&(a=this._getOrReturnCtx(t,a),de(a,{code:re.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="length"){const u=t.data.length>l.value,d=t.data.length<l.value;(u||d)&&(a=this._getOrReturnCtx(t,a),u?de(a,{code:re.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):d&&de(a,{code:re.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),r.dirty())}else if(l.kind==="email")df.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"email",code:re.invalid_string,message:l.message}),r.dirty());else if(l.kind==="emoji")aa||(aa=new RegExp(hf,"u")),aa.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"emoji",code:re.invalid_string,message:l.message}),r.dirty());else if(l.kind==="uuid")cf.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"uuid",code:re.invalid_string,message:l.message}),r.dirty());else if(l.kind==="nanoid")ff.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"nanoid",code:re.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid")af.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"cuid",code:re.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid2")of.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"cuid2",code:re.invalid_string,message:l.message}),r.dirty());else if(l.kind==="ulid")lf.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"ulid",code:re.invalid_string,message:l.message}),r.dirty());else if(l.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),de(a,{validation:"url",code:re.invalid_string,message:l.message}),r.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"regex",code:re.invalid_string,message:l.message}),r.dirty())):l.kind==="trim"?t.data=t.data.trim():l.kind==="includes"?t.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(t,a),de(a,{code:re.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),r.dirty()):l.kind==="toLowerCase"?t.data=t.data.toLowerCase():l.kind==="toUpperCase"?t.data=t.data.toUpperCase():l.kind==="startsWith"?t.data.startsWith(l.value)||(a=this._getOrReturnCtx(t,a),de(a,{code:re.invalid_string,validation:{startsWith:l.value},message:l.message}),r.dirty()):l.kind==="endsWith"?t.data.endsWith(l.value)||(a=this._getOrReturnCtx(t,a),de(a,{code:re.invalid_string,validation:{endsWith:l.value},message:l.message}),r.dirty()):l.kind==="datetime"?nl(l).test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{code:re.invalid_string,validation:"datetime",message:l.message}),r.dirty()):l.kind==="date"?yf.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{code:re.invalid_string,validation:"date",message:l.message}),r.dirty()):l.kind==="time"?Ef(l).test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{code:re.invalid_string,validation:"time",message:l.message}),r.dirty()):l.kind==="duration"?uf.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"duration",code:re.invalid_string,message:l.message}),r.dirty()):l.kind==="ip"?bf(t.data,l.version)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"ip",code:re.invalid_string,message:l.message}),r.dirty()):l.kind==="base64"?mf.test(t.data)||(a=this._getOrReturnCtx(t,a),de(a,{validation:"base64",code:re.invalid_string,message:l.message}),r.dirty()):nt.assertNever(l);return{status:r.value,value:t.data}}_regex(t,e,r){return this.refinement(a=>t.test(a),{validation:e,code:re.invalid_string,..._e.errToObj(r)})}_addCheck(t){return new Vn({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",..._e.errToObj(t)})}url(t){return this._addCheck({kind:"url",..._e.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",..._e.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",..._e.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",..._e.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",..._e.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",..._e.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",..._e.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",..._e.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",..._e.errToObj(t)})}datetime(t){var e,r;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(e=t==null?void 0:t.offset)!==null&&e!==void 0?e:!1,local:(r=t==null?void 0:t.local)!==null&&r!==void 0?r:!1,..._e.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,..._e.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",..._e.errToObj(t)})}regex(t,e){return this._addCheck({kind:"regex",regex:t,..._e.errToObj(e)})}includes(t,e){return this._addCheck({kind:"includes",value:t,position:e==null?void 0:e.position,..._e.errToObj(e==null?void 0:e.message)})}startsWith(t,e){return this._addCheck({kind:"startsWith",value:t,..._e.errToObj(e)})}endsWith(t,e){return this._addCheck({kind:"endsWith",value:t,..._e.errToObj(e)})}min(t,e){return this._addCheck({kind:"min",value:t,..._e.errToObj(e)})}max(t,e){return this._addCheck({kind:"max",value:t,..._e.errToObj(e)})}length(t,e){return this._addCheck({kind:"length",value:t,..._e.errToObj(e)})}nonempty(t){return this.min(1,_e.errToObj(t))}trim(){return new Vn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Vn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Vn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}Vn.create=s=>{var t;return new Vn({checks:[],typeName:Pe.ZodString,coerce:(t=s==null?void 0:s.coerce)!==null&&t!==void 0?t:!1,...Ue(s)})};function vf(s,t){const e=(s.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=e>r?e:r,l=parseInt(s.toFixed(a).replace(".","")),u=parseInt(t.toFixed(a).replace(".",""));return l%u/Math.pow(10,a)}class Ms extends He{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==pe.number){const l=this._getOrReturnCtx(t);return de(l,{code:re.invalid_type,expected:pe.number,received:l.parsedType}),Ce}let r;const a=new Jt;for(const l of this._def.checks)l.kind==="int"?nt.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),de(r,{code:re.invalid_type,expected:"integer",received:"float",message:l.message}),a.dirty()):l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),de(r,{code:re.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),de(r,{code:re.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="multipleOf"?vf(t.data,l.value)!==0&&(r=this._getOrReturnCtx(t,r),de(r,{code:re.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):l.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),de(r,{code:re.not_finite,message:l.message}),a.dirty()):nt.assertNever(l);return{status:a.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,_e.toString(e))}gt(t,e){return this.setLimit("min",t,!1,_e.toString(e))}lte(t,e){return this.setLimit("max",t,!0,_e.toString(e))}lt(t,e){return this.setLimit("max",t,!1,_e.toString(e))}setLimit(t,e,r,a){return new Ms({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:r,message:_e.toString(a)}]})}_addCheck(t){return new Ms({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:_e.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_e.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_e.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_e.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_e.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:_e.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:_e.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_e.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_e.toString(t)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&nt.isInteger(t.value))}get isFinite(){let t=null,e=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(e===null||r.value>e)&&(e=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(e)&&Number.isFinite(t)}}Ms.create=s=>new Ms({checks:[],typeName:Pe.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...Ue(s)});class Us extends He{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==pe.bigint){const l=this._getOrReturnCtx(t);return de(l,{code:re.invalid_type,expected:pe.bigint,received:l.parsedType}),Ce}let r;const a=new Jt;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),de(r,{code:re.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),de(r,{code:re.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="multipleOf"?t.data%l.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),de(r,{code:re.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):nt.assertNever(l);return{status:a.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,_e.toString(e))}gt(t,e){return this.setLimit("min",t,!1,_e.toString(e))}lte(t,e){return this.setLimit("max",t,!0,_e.toString(e))}lt(t,e){return this.setLimit("max",t,!1,_e.toString(e))}setLimit(t,e,r,a){return new Us({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:r,message:_e.toString(a)}]})}_addCheck(t){return new Us({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_e.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_e.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_e.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_e.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:_e.toString(e)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}Us.create=s=>{var t;return new Us({checks:[],typeName:Pe.ZodBigInt,coerce:(t=s==null?void 0:s.coerce)!==null&&t!==void 0?t:!1,...Ue(s)})};class Kr extends He{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==pe.boolean){const r=this._getOrReturnCtx(t);return de(r,{code:re.invalid_type,expected:pe.boolean,received:r.parsedType}),Ce}return mn(t.data)}}Kr.create=s=>new Kr({typeName:Pe.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...Ue(s)});class hr extends He{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==pe.date){const l=this._getOrReturnCtx(t);return de(l,{code:re.invalid_type,expected:pe.date,received:l.parsedType}),Ce}if(isNaN(t.data.getTime())){const l=this._getOrReturnCtx(t);return de(l,{code:re.invalid_date}),Ce}const r=new Jt;let a;for(const l of this._def.checks)l.kind==="min"?t.data.getTime()<l.value&&(a=this._getOrReturnCtx(t,a),de(a,{code:re.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),r.dirty()):l.kind==="max"?t.data.getTime()>l.value&&(a=this._getOrReturnCtx(t,a),de(a,{code:re.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),r.dirty()):nt.assertNever(l);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new hr({...this._def,checks:[...this._def.checks,t]})}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:_e.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:_e.toString(e)})}get minDate(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}}hr.create=s=>new hr({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:Pe.ZodDate,...Ue(s)});class Pi extends He{_parse(t){if(this._getType(t)!==pe.symbol){const r=this._getOrReturnCtx(t);return de(r,{code:re.invalid_type,expected:pe.symbol,received:r.parsedType}),Ce}return mn(t.data)}}Pi.create=s=>new Pi({typeName:Pe.ZodSymbol,...Ue(s)});class qr extends He{_parse(t){if(this._getType(t)!==pe.undefined){const r=this._getOrReturnCtx(t);return de(r,{code:re.invalid_type,expected:pe.undefined,received:r.parsedType}),Ce}return mn(t.data)}}qr.create=s=>new qr({typeName:Pe.ZodUndefined,...Ue(s)});class Yr extends He{_parse(t){if(this._getType(t)!==pe.null){const r=this._getOrReturnCtx(t);return de(r,{code:re.invalid_type,expected:pe.null,received:r.parsedType}),Ce}return mn(t.data)}}Yr.create=s=>new Yr({typeName:Pe.ZodNull,...Ue(s)});class Sr extends He{constructor(){super(...arguments),this._any=!0}_parse(t){return mn(t.data)}}Sr.create=s=>new Sr({typeName:Pe.ZodAny,...Ue(s)});class ur extends He{constructor(){super(...arguments),this._unknown=!0}_parse(t){return mn(t.data)}}ur.create=s=>new ur({typeName:Pe.ZodUnknown,...Ue(s)});class Ss extends He{_parse(t){const e=this._getOrReturnCtx(t);return de(e,{code:re.invalid_type,expected:pe.never,received:e.parsedType}),Ce}}Ss.create=s=>new Ss({typeName:Pe.ZodNever,...Ue(s)});class Ci extends He{_parse(t){if(this._getType(t)!==pe.undefined){const r=this._getOrReturnCtx(t);return de(r,{code:re.invalid_type,expected:pe.void,received:r.parsedType}),Ce}return mn(t.data)}}Ci.create=s=>new Ci({typeName:Pe.ZodVoid,...Ue(s)});class jn extends He{_parse(t){const{ctx:e,status:r}=this._processInputParams(t),a=this._def;if(e.parsedType!==pe.array)return de(e,{code:re.invalid_type,expected:pe.array,received:e.parsedType}),Ce;if(a.exactLength!==null){const u=e.data.length>a.exactLength.value,d=e.data.length<a.exactLength.value;(u||d)&&(de(e,{code:u?re.too_big:re.too_small,minimum:d?a.exactLength.value:void 0,maximum:u?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&e.data.length<a.minLength.value&&(de(e,{code:re.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&e.data.length>a.maxLength.value&&(de(e,{code:re.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),e.common.async)return Promise.all([...e.data].map((u,d)=>a.type._parseAsync(new rs(e,u,e.path,d)))).then(u=>Jt.mergeArray(r,u));const l=[...e.data].map((u,d)=>a.type._parseSync(new rs(e,u,e.path,d)));return Jt.mergeArray(r,l)}get element(){return this._def.type}min(t,e){return new jn({...this._def,minLength:{value:t,message:_e.toString(e)}})}max(t,e){return new jn({...this._def,maxLength:{value:t,message:_e.toString(e)}})}length(t,e){return new jn({...this._def,exactLength:{value:t,message:_e.toString(e)}})}nonempty(t){return this.min(1,t)}}jn.create=(s,t)=>new jn({type:s,minLength:null,maxLength:null,exactLength:null,typeName:Pe.ZodArray,...Ue(t)});function _r(s){if(s instanceof Tt){const t={};for(const e in s.shape){const r=s.shape[e];t[e]=ns.create(_r(r))}return new Tt({...s._def,shape:()=>t})}else return s instanceof jn?new jn({...s._def,type:_r(s.element)}):s instanceof ns?ns.create(_r(s.unwrap())):s instanceof Vs?Vs.create(_r(s.unwrap())):s instanceof is?is.create(s.items.map(t=>_r(t))):s}class Tt extends He{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),e=nt.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==pe.object){const g=this._getOrReturnCtx(t);return de(g,{code:re.invalid_type,expected:pe.object,received:g.parsedType}),Ce}const{status:r,ctx:a}=this._processInputParams(t),{shape:l,keys:u}=this._getCached(),d=[];if(!(this._def.catchall instanceof Ss&&this._def.unknownKeys==="strip"))for(const g in a.data)u.includes(g)||d.push(g);const y=[];for(const g of u){const E=l[g],h=a.data[g];y.push({key:{status:"valid",value:g},value:E._parse(new rs(a,h,a.path,g)),alwaysSet:g in a.data})}if(this._def.catchall instanceof Ss){const g=this._def.unknownKeys;if(g==="passthrough")for(const E of d)y.push({key:{status:"valid",value:E},value:{status:"valid",value:a.data[E]}});else if(g==="strict")d.length>0&&(de(a,{code:re.unrecognized_keys,keys:d}),r.dirty());else if(g!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const g=this._def.catchall;for(const E of d){const h=a.data[E];y.push({key:{status:"valid",value:E},value:g._parse(new rs(a,h,a.path,E)),alwaysSet:E in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const g=[];for(const E of y){const h=await E.key,T=await E.value;g.push({key:h,value:T,alwaysSet:E.alwaysSet})}return g}).then(g=>Jt.mergeObjectSync(r,g)):Jt.mergeObjectSync(r,y)}get shape(){return this._def.shape()}strict(t){return _e.errToObj,new Tt({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(e,r)=>{var a,l,u,d;const y=(u=(l=(a=this._def).errorMap)===null||l===void 0?void 0:l.call(a,e,r).message)!==null&&u!==void 0?u:r.defaultError;return e.code==="unrecognized_keys"?{message:(d=_e.errToObj(t).message)!==null&&d!==void 0?d:y}:{message:y}}}:{}})}strip(){return new Tt({...this._def,unknownKeys:"strip"})}passthrough(){return new Tt({...this._def,unknownKeys:"passthrough"})}extend(t){return new Tt({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Tt({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Pe.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new Tt({...this._def,catchall:t})}pick(t){const e={};return nt.objectKeys(t).forEach(r=>{t[r]&&this.shape[r]&&(e[r]=this.shape[r])}),new Tt({...this._def,shape:()=>e})}omit(t){const e={};return nt.objectKeys(this.shape).forEach(r=>{t[r]||(e[r]=this.shape[r])}),new Tt({...this._def,shape:()=>e})}deepPartial(){return _r(this)}partial(t){const e={};return nt.objectKeys(this.shape).forEach(r=>{const a=this.shape[r];t&&!t[r]?e[r]=a:e[r]=a.optional()}),new Tt({...this._def,shape:()=>e})}required(t){const e={};return nt.objectKeys(this.shape).forEach(r=>{if(t&&!t[r])e[r]=this.shape[r];else{let l=this.shape[r];for(;l instanceof ns;)l=l._def.innerType;e[r]=l}}),new Tt({...this._def,shape:()=>e})}keyof(){return sl(nt.objectKeys(this.shape))}}Tt.create=(s,t)=>new Tt({shape:()=>s,unknownKeys:"strip",catchall:Ss.create(),typeName:Pe.ZodObject,...Ue(t)});Tt.strictCreate=(s,t)=>new Tt({shape:()=>s,unknownKeys:"strict",catchall:Ss.create(),typeName:Pe.ZodObject,...Ue(t)});Tt.lazycreate=(s,t)=>new Tt({shape:s,unknownKeys:"strip",catchall:Ss.create(),typeName:Pe.ZodObject,...Ue(t)});class Xr extends He{_parse(t){const{ctx:e}=this._processInputParams(t),r=this._def.options;function a(l){for(const d of l)if(d.result.status==="valid")return d.result;for(const d of l)if(d.result.status==="dirty")return e.common.issues.push(...d.ctx.common.issues),d.result;const u=l.map(d=>new On(d.ctx.common.issues));return de(e,{code:re.invalid_union,unionErrors:u}),Ce}if(e.common.async)return Promise.all(r.map(async l=>{const u={...e,common:{...e.common,issues:[]},parent:null};return{result:await l._parseAsync({data:e.data,path:e.path,parent:u}),ctx:u}})).then(a);{let l;const u=[];for(const y of r){const g={...e,common:{...e.common,issues:[]},parent:null},E=y._parseSync({data:e.data,path:e.path,parent:g});if(E.status==="valid")return E;E.status==="dirty"&&!l&&(l={result:E,ctx:g}),g.common.issues.length&&u.push(g.common.issues)}if(l)return e.common.issues.push(...l.ctx.common.issues),l.result;const d=u.map(y=>new On(y));return de(e,{code:re.invalid_union,unionErrors:d}),Ce}}get options(){return this._def.options}}Xr.create=(s,t)=>new Xr({options:s,typeName:Pe.ZodUnion,...Ue(t)});const _s=s=>s instanceof ei?_s(s.schema):s instanceof Gn?_s(s.innerType()):s instanceof ti?[s.value]:s instanceof Fs?s.options:s instanceof ni?nt.objectValues(s.enum):s instanceof si?_s(s._def.innerType):s instanceof qr?[void 0]:s instanceof Yr?[null]:s instanceof ns?[void 0,..._s(s.unwrap())]:s instanceof Vs?[null,..._s(s.unwrap())]:s instanceof Fa||s instanceof ii?_s(s.unwrap()):s instanceof ri?_s(s._def.innerType):[];class Vi extends He{_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==pe.object)return de(e,{code:re.invalid_type,expected:pe.object,received:e.parsedType}),Ce;const r=this.discriminator,a=e.data[r],l=this.optionsMap.get(a);return l?e.common.async?l._parseAsync({data:e.data,path:e.path,parent:e}):l._parseSync({data:e.data,path:e.path,parent:e}):(de(e,{code:re.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Ce)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,r){const a=new Map;for(const l of e){const u=_s(l.shape[t]);if(!u.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const d of u){if(a.has(d))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(d)}`);a.set(d,l)}}return new Vi({typeName:Pe.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:a,...Ue(r)})}}function Ta(s,t){const e=Ps(s),r=Ps(t);if(s===t)return{valid:!0,data:s};if(e===pe.object&&r===pe.object){const a=nt.objectKeys(t),l=nt.objectKeys(s).filter(d=>a.indexOf(d)!==-1),u={...s,...t};for(const d of l){const y=Ta(s[d],t[d]);if(!y.valid)return{valid:!1};u[d]=y.data}return{valid:!0,data:u}}else if(e===pe.array&&r===pe.array){if(s.length!==t.length)return{valid:!1};const a=[];for(let l=0;l<s.length;l++){const u=s[l],d=t[l],y=Ta(u,d);if(!y.valid)return{valid:!1};a.push(y.data)}return{valid:!0,data:a}}else return e===pe.date&&r===pe.date&&+s==+t?{valid:!0,data:s}:{valid:!1}}class Jr extends He{_parse(t){const{status:e,ctx:r}=this._processInputParams(t),a=(l,u)=>{if(wa(l)||wa(u))return Ce;const d=Ta(l.value,u.value);return d.valid?((Ia(l)||Ia(u))&&e.dirty(),{status:e.value,value:d.data}):(de(r,{code:re.invalid_intersection_types}),Ce)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([l,u])=>a(l,u)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Jr.create=(s,t,e)=>new Jr({left:s,right:t,typeName:Pe.ZodIntersection,...Ue(e)});class is extends He{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==pe.array)return de(r,{code:re.invalid_type,expected:pe.array,received:r.parsedType}),Ce;if(r.data.length<this._def.items.length)return de(r,{code:re.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ce;!this._def.rest&&r.data.length>this._def.items.length&&(de(r,{code:re.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());const l=[...r.data].map((u,d)=>{const y=this._def.items[d]||this._def.rest;return y?y._parse(new rs(r,u,r.path,d)):null}).filter(u=>!!u);return r.common.async?Promise.all(l).then(u=>Jt.mergeArray(e,u)):Jt.mergeArray(e,l)}get items(){return this._def.items}rest(t){return new is({...this._def,rest:t})}}is.create=(s,t)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new is({items:s,typeName:Pe.ZodTuple,rest:null,...Ue(t)})};class Qr extends He{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==pe.object)return de(r,{code:re.invalid_type,expected:pe.object,received:r.parsedType}),Ce;const a=[],l=this._def.keyType,u=this._def.valueType;for(const d in r.data)a.push({key:l._parse(new rs(r,d,r.path,d)),value:u._parse(new rs(r,r.data[d],r.path,d)),alwaysSet:d in r.data});return r.common.async?Jt.mergeObjectAsync(e,a):Jt.mergeObjectSync(e,a)}get element(){return this._def.valueType}static create(t,e,r){return e instanceof He?new Qr({keyType:t,valueType:e,typeName:Pe.ZodRecord,...Ue(r)}):new Qr({keyType:Vn.create(),valueType:t,typeName:Pe.ZodRecord,...Ue(e)})}}class Li extends He{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==pe.map)return de(r,{code:re.invalid_type,expected:pe.map,received:r.parsedType}),Ce;const a=this._def.keyType,l=this._def.valueType,u=[...r.data.entries()].map(([d,y],g)=>({key:a._parse(new rs(r,d,r.path,[g,"key"])),value:l._parse(new rs(r,y,r.path,[g,"value"]))}));if(r.common.async){const d=new Map;return Promise.resolve().then(async()=>{for(const y of u){const g=await y.key,E=await y.value;if(g.status==="aborted"||E.status==="aborted")return Ce;(g.status==="dirty"||E.status==="dirty")&&e.dirty(),d.set(g.value,E.value)}return{status:e.value,value:d}})}else{const d=new Map;for(const y of u){const g=y.key,E=y.value;if(g.status==="aborted"||E.status==="aborted")return Ce;(g.status==="dirty"||E.status==="dirty")&&e.dirty(),d.set(g.value,E.value)}return{status:e.value,value:d}}}}Li.create=(s,t,e)=>new Li({valueType:t,keyType:s,typeName:Pe.ZodMap,...Ue(e)});class pr extends He{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==pe.set)return de(r,{code:re.invalid_type,expected:pe.set,received:r.parsedType}),Ce;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(de(r,{code:re.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),e.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(de(r,{code:re.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),e.dirty());const l=this._def.valueType;function u(y){const g=new Set;for(const E of y){if(E.status==="aborted")return Ce;E.status==="dirty"&&e.dirty(),g.add(E.value)}return{status:e.value,value:g}}const d=[...r.data.values()].map((y,g)=>l._parse(new rs(r,y,r.path,g)));return r.common.async?Promise.all(d).then(y=>u(y)):u(d)}min(t,e){return new pr({...this._def,minSize:{value:t,message:_e.toString(e)}})}max(t,e){return new pr({...this._def,maxSize:{value:t,message:_e.toString(e)}})}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}}pr.create=(s,t)=>new pr({valueType:s,minSize:null,maxSize:null,typeName:Pe.ZodSet,...Ue(t)});class Ir extends He{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==pe.function)return de(e,{code:re.invalid_type,expected:pe.function,received:e.parsedType}),Ce;function r(d,y){return Ri({data:d,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Di(),Tr].filter(g=>!!g),issueData:{code:re.invalid_arguments,argumentsError:y}})}function a(d,y){return Ri({data:d,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Di(),Tr].filter(g=>!!g),issueData:{code:re.invalid_return_type,returnTypeError:y}})}const l={errorMap:e.common.contextualErrorMap},u=e.data;if(this._def.returns instanceof Ar){const d=this;return mn(async function(...y){const g=new On([]),E=await d._def.args.parseAsync(y,l).catch(M=>{throw g.addIssue(r(y,M)),g}),h=await Reflect.apply(u,this,E);return await d._def.returns._def.type.parseAsync(h,l).catch(M=>{throw g.addIssue(a(h,M)),g})})}else{const d=this;return mn(function(...y){const g=d._def.args.safeParse(y,l);if(!g.success)throw new On([r(y,g.error)]);const E=Reflect.apply(u,this,g.data),h=d._def.returns.safeParse(E,l);if(!h.success)throw new On([a(E,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new Ir({...this._def,args:is.create(t).rest(ur.create())})}returns(t){return new Ir({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,r){return new Ir({args:t||is.create([]).rest(ur.create()),returns:e||ur.create(),typeName:Pe.ZodFunction,...Ue(r)})}}class ei extends He{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}ei.create=(s,t)=>new ei({getter:s,typeName:Pe.ZodLazy,...Ue(t)});class ti extends He{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return de(e,{received:e.data,code:re.invalid_literal,expected:this._def.value}),Ce}return{status:"valid",value:t.data}}get value(){return this._def.value}}ti.create=(s,t)=>new ti({value:s,typeName:Pe.ZodLiteral,...Ue(t)});function sl(s,t){return new Fs({values:s,typeName:Pe.ZodEnum,...Ue(t)})}class Fs extends He{constructor(){super(...arguments),jr.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const e=this._getOrReturnCtx(t),r=this._def.values;return de(e,{expected:nt.joinValues(r),received:e.parsedType,code:re.invalid_type}),Ce}if(Ni(this,jr)||Qo(this,jr,new Set(this._def.values)),!Ni(this,jr).has(t.data)){const e=this._getOrReturnCtx(t),r=this._def.values;return de(e,{received:e.data,code:re.invalid_enum_value,options:r}),Ce}return mn(t.data)}get options(){return this._def.values}get enum(){const t={};for(const e of this._def.values)t[e]=e;return t}get Values(){const t={};for(const e of this._def.values)t[e]=e;return t}get Enum(){const t={};for(const e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return Fs.create(t,{...this._def,...e})}exclude(t,e=this._def){return Fs.create(this.options.filter(r=>!t.includes(r)),{...this._def,...e})}}jr=new WeakMap;Fs.create=sl;class ni extends He{constructor(){super(...arguments),Hr.set(this,void 0)}_parse(t){const e=nt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==pe.string&&r.parsedType!==pe.number){const a=nt.objectValues(e);return de(r,{expected:nt.joinValues(a),received:r.parsedType,code:re.invalid_type}),Ce}if(Ni(this,Hr)||Qo(this,Hr,new Set(nt.getValidEnumValues(this._def.values))),!Ni(this,Hr).has(t.data)){const a=nt.objectValues(e);return de(r,{received:r.data,code:re.invalid_enum_value,options:a}),Ce}return mn(t.data)}get enum(){return this._def.values}}Hr=new WeakMap;ni.create=(s,t)=>new ni({values:s,typeName:Pe.ZodNativeEnum,...Ue(t)});class Ar extends He{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==pe.promise&&e.common.async===!1)return de(e,{code:re.invalid_type,expected:pe.promise,received:e.parsedType}),Ce;const r=e.parsedType===pe.promise?e.data:Promise.resolve(e.data);return mn(r.then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}}Ar.create=(s,t)=>new Ar({type:s,typeName:Pe.ZodPromise,...Ue(t)});class Gn extends He{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Pe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:r}=this._processInputParams(t),a=this._def.effect||null,l={addIssue:u=>{de(r,u),u.fatal?e.abort():e.dirty()},get path(){return r.path}};if(l.addIssue=l.addIssue.bind(l),a.type==="preprocess"){const u=a.transform(r.data,l);if(r.common.async)return Promise.resolve(u).then(async d=>{if(e.value==="aborted")return Ce;const y=await this._def.schema._parseAsync({data:d,path:r.path,parent:r});return y.status==="aborted"?Ce:y.status==="dirty"||e.value==="dirty"?wr(y.value):y});{if(e.value==="aborted")return Ce;const d=this._def.schema._parseSync({data:u,path:r.path,parent:r});return d.status==="aborted"?Ce:d.status==="dirty"||e.value==="dirty"?wr(d.value):d}}if(a.type==="refinement"){const u=d=>{const y=a.refinement(d,l);if(r.common.async)return Promise.resolve(y);if(y instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return d};if(r.common.async===!1){const d=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return d.status==="aborted"?Ce:(d.status==="dirty"&&e.dirty(),u(d.value),{status:e.value,value:d.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(d=>d.status==="aborted"?Ce:(d.status==="dirty"&&e.dirty(),u(d.value).then(()=>({status:e.value,value:d.value}))))}if(a.type==="transform")if(r.common.async===!1){const u=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!zr(u))return u;const d=a.transform(u.value,l);if(d instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:d}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(u=>zr(u)?Promise.resolve(a.transform(u.value,l)).then(d=>({status:e.value,value:d})):u);nt.assertNever(a)}}Gn.create=(s,t,e)=>new Gn({schema:s,typeName:Pe.ZodEffects,effect:t,...Ue(e)});Gn.createWithPreprocess=(s,t,e)=>new Gn({schema:t,effect:{type:"preprocess",transform:s},typeName:Pe.ZodEffects,...Ue(e)});class ns extends He{_parse(t){return this._getType(t)===pe.undefined?mn(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ns.create=(s,t)=>new ns({innerType:s,typeName:Pe.ZodOptional,...Ue(t)});class Vs extends He{_parse(t){return this._getType(t)===pe.null?mn(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Vs.create=(s,t)=>new Vs({innerType:s,typeName:Pe.ZodNullable,...Ue(t)});class si extends He{_parse(t){const{ctx:e}=this._processInputParams(t);let r=e.data;return e.parsedType===pe.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}si.create=(s,t)=>new si({innerType:s,typeName:Pe.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Ue(t)});class ri extends He{_parse(t){const{ctx:e}=this._processInputParams(t),r={...e,common:{...e.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Wr(a)?a.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new On(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new On(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ri.create=(s,t)=>new ri({innerType:s,typeName:Pe.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Ue(t)});class ki extends He{_parse(t){if(this._getType(t)!==pe.nan){const r=this._getOrReturnCtx(t);return de(r,{code:re.invalid_type,expected:pe.nan,received:r.parsedType}),Ce}return{status:"valid",value:t.data}}}ki.create=s=>new ki({typeName:Pe.ZodNaN,...Ue(s)});const _f=Symbol("zod_brand");class Fa extends He{_parse(t){const{ctx:e}=this._processInputParams(t),r=e.data;return this._def.type._parse({data:r,path:e.path,parent:e})}unwrap(){return this._def.type}}class li extends He{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?Ce:l.status==="dirty"?(e.dirty(),wr(l.value)):this._def.out._parseAsync({data:l.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?Ce:a.status==="dirty"?(e.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,e){return new li({in:t,out:e,typeName:Pe.ZodPipeline})}}class ii extends He{_parse(t){const e=this._def.innerType._parse(t),r=a=>(zr(a)&&(a.value=Object.freeze(a.value)),a);return Wr(e)?e.then(a=>r(a)):r(e)}unwrap(){return this._def.innerType}}ii.create=(s,t)=>new ii({innerType:s,typeName:Pe.ZodReadonly,...Ue(t)});function Va(s,t={},e){return s?Sr.create().superRefine((r,a)=>{var l,u;if(!s(r)){const d=typeof t=="function"?t(r):typeof t=="string"?{message:t}:t,y=(u=(l=d.fatal)!==null&&l!==void 0?l:e)!==null&&u!==void 0?u:!0,g=typeof d=="string"?{message:d}:d;a.addIssue({code:"custom",...g,fatal:y})}}):Sr.create()}const wf={object:Tt.lazycreate};var Pe;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(Pe||(Pe={}));const If=(s,t={message:`Input not instance of ${s.name}`})=>Va(e=>e instanceof s,t),C=Vn.create,we=Ms.create,Tf=ki.create,rl=Us.create,ke=Kr.create,Sf=hr.create,Af=Pi.create,Of=qr.create,ji=Yr.create,xf=Sr.create,ai=ur.create,Df=Ss.create,Rf=Ci.create,tt=jn.create,oe=Tt.create,Nf=Tt.strictCreate,ja=Xr.create,Pf=Vi.create,Cf=Jr.create,Lf=is.create,kf=Qr.create,Bf=Li.create,$f=pr.create,Mf=Ir.create,Uf=ei.create,$t=ti.create,Ff=Fs.create,Dr=ni.create,Vf=Ar.create,yo=Gn.create,il=ns.create,jf=Vs.create,al=Gn.createWithPreprocess,Hf=li.create,Gf=()=>C().optional(),Zf=()=>we().optional(),zf=()=>ke().optional(),Wf={string:s=>Vn.create({...s,coerce:!0}),number:s=>Ms.create({...s,coerce:!0}),boolean:s=>Kr.create({...s,coerce:!0}),bigint:s=>Us.create({...s,coerce:!0}),date:s=>hr.create({...s,coerce:!0})},Kf=Ce;var le=Object.freeze({__proto__:null,defaultErrorMap:Tr,setErrorMap:sf,getErrorMap:Di,makeIssue:Ri,EMPTY_PATH:rf,addIssueToContext:de,ParseStatus:Jt,INVALID:Ce,DIRTY:wr,OK:mn,isAborted:wa,isDirty:Ia,isValid:zr,isAsync:Wr,get util(){return nt},get objectUtil(){return _a},ZodParsedType:pe,getParsedType:Ps,ZodType:He,datetimeRegex:nl,ZodString:Vn,ZodNumber:Ms,ZodBigInt:Us,ZodBoolean:Kr,ZodDate:hr,ZodSymbol:Pi,ZodUndefined:qr,ZodNull:Yr,ZodAny:Sr,ZodUnknown:ur,ZodNever:Ss,ZodVoid:Ci,ZodArray:jn,ZodObject:Tt,ZodUnion:Xr,ZodDiscriminatedUnion:Vi,ZodIntersection:Jr,ZodTuple:is,ZodRecord:Qr,ZodMap:Li,ZodSet:pr,ZodFunction:Ir,ZodLazy:ei,ZodLiteral:ti,ZodEnum:Fs,ZodNativeEnum:ni,ZodPromise:Ar,ZodEffects:Gn,ZodTransformer:Gn,ZodOptional:ns,ZodNullable:Vs,ZodDefault:si,ZodCatch:ri,ZodNaN:ki,BRAND:_f,ZodBranded:Fa,ZodPipeline:li,ZodReadonly:ii,custom:Va,Schema:He,ZodSchema:He,late:wf,get ZodFirstPartyTypeKind(){return Pe},coerce:Wf,any:xf,array:tt,bigint:rl,boolean:ke,date:Sf,discriminatedUnion:Pf,effect:yo,enum:Ff,function:Mf,instanceof:If,intersection:Cf,lazy:Uf,literal:$t,map:Bf,nan:Tf,nativeEnum:Dr,never:Df,null:ji,nullable:jf,number:we,object:oe,oboolean:zf,onumber:Zf,optional:il,ostring:Gf,pipeline:Hf,preprocess:al,promise:Vf,record:kf,set:$f,strictObject:Nf,string:C,symbol:Af,transformer:yo,tuple:Lf,undefined:Of,union:ja,unknown:ai,void:Rf,NEVER:Kf,ZodIssueCode:re,quotelessJson:nf,ZodError:On}),oa={exports:{}},Eo;function qf(){return Eo||(Eo=1,function(s){var t=function(e){var r=1e7,a=7,l=9007199254740992,u=J(l),d="0123456789abcdefghijklmnopqrstuvwxyz",y=typeof BigInt=="function";function g(b,I,D,P){return typeof b>"u"?g[0]:typeof I<"u"?+I==10&&!D?Se(b):nn(b,I,D,P):Se(b)}function E(b,I){this.value=b,this.sign=I,this.isSmall=!1}E.prototype=Object.create(g.prototype);function h(b){this.value=b,this.sign=b<0,this.isSmall=!0}h.prototype=Object.create(g.prototype);function T(b){this.value=b}T.prototype=Object.create(g.prototype);function M(b){return-9007199254740992<b&&b<l}function J(b){return b<1e7?[b]:b<1e14?[b%1e7,Math.floor(b/1e7)]:[b%1e7,Math.floor(b/1e7)%1e7,Math.floor(b/1e14)]}function F(b){z(b);var I=b.length;if(I<4&&Ie(b,u)<0)switch(I){case 0:return 0;case 1:return b[0];case 2:return b[0]+b[1]*r;default:return b[0]+(b[1]+b[2]*r)*r}return b}function z(b){for(var I=b.length;b[--I]===0;);b.length=I+1}function ce(b){for(var I=new Array(b),D=-1;++D<b;)I[D]=0;return I}function ge(b){return b>0?Math.floor(b):Math.ceil(b)}function ie(b,I){var D=b.length,P=I.length,Z=new Array(D),U=0,G=r,K,Q;for(Q=0;Q<P;Q++)K=b[Q]+I[Q]+U,U=K>=G?1:0,Z[Q]=K-U*G;for(;Q<D;)K=b[Q]+U,U=K===G?1:0,Z[Q++]=K-U*G;return U>0&&Z.push(U),Z}function be(b,I){return b.length>=I.length?ie(b,I):ie(I,b)}function Fe(b,I){var D=b.length,P=new Array(D),Z=r,U,G;for(G=0;G<D;G++)U=b[G]-Z+I,I=Math.floor(U/Z),P[G]=U-I*Z,I+=1;for(;I>0;)P[G++]=I%Z,I=Math.floor(I/Z);return P}E.prototype.add=function(b){var I=Se(b);if(this.sign!==I.sign)return this.subtract(I.negate());var D=this.value,P=I.value;return I.isSmall?new E(Fe(D,Math.abs(P)),this.sign):new E(be(D,P),this.sign)},E.prototype.plus=E.prototype.add,h.prototype.add=function(b){var I=Se(b),D=this.value;if(D<0!==I.sign)return this.subtract(I.negate());var P=I.value;if(I.isSmall){if(M(D+P))return new h(D+P);P=J(Math.abs(P))}return new E(Fe(P,Math.abs(D)),D<0)},h.prototype.plus=h.prototype.add,T.prototype.add=function(b){return new T(this.value+Se(b).value)},T.prototype.plus=T.prototype.add;function st(b,I){var D=b.length,P=I.length,Z=new Array(D),U=0,G=r,K,Q;for(K=0;K<P;K++)Q=b[K]-U-I[K],Q<0?(Q+=G,U=1):U=0,Z[K]=Q;for(K=P;K<D;K++){if(Q=b[K]-U,Q<0)Q+=G;else{Z[K++]=Q;break}Z[K]=Q}for(;K<D;K++)Z[K]=b[K];return z(Z),Z}function ot(b,I,D){var P;return Ie(b,I)>=0?P=st(b,I):(P=st(I,b),D=!D),P=F(P),typeof P=="number"?(D&&(P=-P),new h(P)):new E(P,D)}function vt(b,I,D){var P=b.length,Z=new Array(P),U=-I,G=r,K,Q;for(K=0;K<P;K++)Q=b[K]+U,U=Math.floor(Q/G),Q%=G,Z[K]=Q<0?Q+G:Q;return Z=F(Z),typeof Z=="number"?(D&&(Z=-Z),new h(Z)):new E(Z,D)}E.prototype.subtract=function(b){var I=Se(b);if(this.sign!==I.sign)return this.add(I.negate());var D=this.value,P=I.value;return I.isSmall?vt(D,Math.abs(P),this.sign):ot(D,P,this.sign)},E.prototype.minus=E.prototype.subtract,h.prototype.subtract=function(b){var I=Se(b),D=this.value;if(D<0!==I.sign)return this.add(I.negate());var P=I.value;return I.isSmall?new h(D-P):vt(P,Math.abs(D),D>=0)},h.prototype.minus=h.prototype.subtract,T.prototype.subtract=function(b){return new T(this.value-Se(b).value)},T.prototype.minus=T.prototype.subtract,E.prototype.negate=function(){return new E(this.value,!this.sign)},h.prototype.negate=function(){var b=this.sign,I=new h(-this.value);return I.sign=!b,I},T.prototype.negate=function(){return new T(-this.value)},E.prototype.abs=function(){return new E(this.value,!1)},h.prototype.abs=function(){return new h(Math.abs(this.value))},T.prototype.abs=function(){return new T(this.value>=0?this.value:-this.value)};function lt(b,I){var D=b.length,P=I.length,Z=D+P,U=ce(Z),G=r,K,Q,he,xe,Re;for(he=0;he<D;++he){xe=b[he];for(var Ae=0;Ae<P;++Ae)Re=I[Ae],K=xe*Re+U[he+Ae],Q=Math.floor(K/G),U[he+Ae]=K-Q*G,U[he+Ae+1]+=Q}return z(U),U}function Ht(b,I){var D=b.length,P=new Array(D),Z=r,U=0,G,K;for(K=0;K<D;K++)G=b[K]*I+U,U=Math.floor(G/Z),P[K]=G-U*Z;for(;U>0;)P[K++]=U%Z,U=Math.floor(U/Z);return P}function Qe(b,I){for(var D=[];I-- >0;)D.push(0);return D.concat(b)}function Ve(b,I){var D=Math.max(b.length,I.length);if(D<=30)return lt(b,I);D=Math.ceil(D/2);var P=b.slice(D),Z=b.slice(0,D),U=I.slice(D),G=I.slice(0,D),K=Ve(Z,G),Q=Ve(P,U),he=Ve(be(Z,P),be(G,U)),xe=be(be(K,Qe(st(st(he,K),Q),D)),Qe(Q,2*D));return z(xe),xe}function H(b,I){return-.012*b-.012*I+15e-6*b*I>0}E.prototype.multiply=function(b){var I=Se(b),D=this.value,P=I.value,Z=this.sign!==I.sign,U;if(I.isSmall){if(P===0)return g[0];if(P===1)return this;if(P===-1)return this.negate();if(U=Math.abs(P),U<r)return new E(Ht(D,U),Z);P=J(U)}return H(D.length,P.length)?new E(Ve(D,P),Z):new E(lt(D,P),Z)},E.prototype.times=E.prototype.multiply;function se(b,I,D){return b<r?new E(Ht(I,b),D):new E(lt(I,J(b)),D)}h.prototype._multiplyBySmall=function(b){return M(b.value*this.value)?new h(b.value*this.value):se(Math.abs(b.value),J(Math.abs(this.value)),this.sign!==b.sign)},E.prototype._multiplyBySmall=function(b){return b.value===0?g[0]:b.value===1?this:b.value===-1?this.negate():se(Math.abs(b.value),this.value,this.sign!==b.sign)},h.prototype.multiply=function(b){return Se(b)._multiplyBySmall(this)},h.prototype.times=h.prototype.multiply,T.prototype.multiply=function(b){return new T(this.value*Se(b).value)},T.prototype.times=T.prototype.multiply;function te(b){var I=b.length,D=ce(I+I),P=r,Z,U,G,K,Q;for(G=0;G<I;G++){K=b[G],U=0-K*K;for(var he=G;he<I;he++)Q=b[he],Z=2*(K*Q)+D[G+he]+U,U=Math.floor(Z/P),D[G+he]=Z-U*P;D[G+I]=U}return z(D),D}E.prototype.square=function(){return new E(te(this.value),!1)},h.prototype.square=function(){var b=this.value*this.value;return M(b)?new h(b):new E(te(J(Math.abs(this.value))),!1)},T.prototype.square=function(b){return new T(this.value*this.value)};function ee(b,I){var D=b.length,P=I.length,Z=r,U=ce(I.length),G=I[P-1],K=Math.ceil(Z/(2*G)),Q=Ht(b,K),he=Ht(I,K),xe,Re,Ae,xt,Oe,sn,rt;for(Q.length<=D&&Q.push(0),he.push(0),G=he[P-1],Re=D-P;Re>=0;Re--){for(xe=Z-1,Q[Re+P]!==G&&(xe=Math.floor((Q[Re+P]*Z+Q[Re+P-1])/G)),Ae=0,xt=0,sn=he.length,Oe=0;Oe<sn;Oe++)Ae+=xe*he[Oe],rt=Math.floor(Ae/Z),xt+=Q[Re+Oe]-(Ae-rt*Z),Ae=rt,xt<0?(Q[Re+Oe]=xt+Z,xt=-1):(Q[Re+Oe]=xt,xt=0);for(;xt!==0;){for(xe-=1,Ae=0,Oe=0;Oe<sn;Oe++)Ae+=Q[Re+Oe]-Z+he[Oe],Ae<0?(Q[Re+Oe]=Ae+Z,Ae=0):(Q[Re+Oe]=Ae,Ae=1);xt+=Ae}U[Re]=xe}return Q=me(Q,K)[0],[F(U),F(Q)]}function ne(b,I){for(var D=b.length,P=I.length,Z=[],U=[],G=r,K,Q,he,xe,Re;D;){if(U.unshift(b[--D]),z(U),Ie(U,I)<0){Z.push(0);continue}Q=U.length,he=U[Q-1]*G+U[Q-2],xe=I[P-1]*G+I[P-2],Q>P&&(he=(he+1)*G),K=Math.ceil(he/xe);do{if(Re=Ht(I,K),Ie(Re,U)<=0)break;K--}while(K);Z.push(K),U=st(U,Re)}return Z.reverse(),[F(Z),F(U)]}function me(b,I){var D=b.length,P=ce(D),Z=r,U,G,K,Q;for(K=0,U=D-1;U>=0;--U)Q=K*Z+b[U],G=ge(Q/I),K=Q-G*I,P[U]=G|0;return[P,K|0]}function De(b,I){var D,P=Se(I);if(y)return[new T(b.value/P.value),new T(b.value%P.value)];var Z=b.value,U=P.value,G;if(U===0)throw new Error("Cannot divide by zero");if(b.isSmall)return P.isSmall?[new h(ge(Z/U)),new h(Z%U)]:[g[0],b];if(P.isSmall){if(U===1)return[b,g[0]];if(U==-1)return[b.negate(),g[0]];var K=Math.abs(U);if(K<r){D=me(Z,K),G=F(D[0]);var Q=D[1];return b.sign&&(Q=-Q),typeof G=="number"?(b.sign!==P.sign&&(G=-G),[new h(G),new h(Q)]):[new E(G,b.sign!==P.sign),new h(Q)]}U=J(K)}var he=Ie(Z,U);if(he===-1)return[g[0],b];if(he===0)return[g[b.sign===P.sign?1:-1],g[0]];Z.length+U.length<=200?D=ee(Z,U):D=ne(Z,U),G=D[0];var xe=b.sign!==P.sign,Re=D[1],Ae=b.sign;return typeof G=="number"?(xe&&(G=-G),G=new h(G)):G=new E(G,xe),typeof Re=="number"?(Ae&&(Re=-Re),Re=new h(Re)):Re=new E(Re,Ae),[G,Re]}E.prototype.divmod=function(b){var I=De(this,b);return{quotient:I[0],remainder:I[1]}},T.prototype.divmod=h.prototype.divmod=E.prototype.divmod,E.prototype.divide=function(b){return De(this,b)[0]},T.prototype.over=T.prototype.divide=function(b){return new T(this.value/Se(b).value)},h.prototype.over=h.prototype.divide=E.prototype.over=E.prototype.divide,E.prototype.mod=function(b){return De(this,b)[1]},T.prototype.mod=T.prototype.remainder=function(b){return new T(this.value%Se(b).value)},h.prototype.remainder=h.prototype.mod=E.prototype.remainder=E.prototype.mod,E.prototype.pow=function(b){var I=Se(b),D=this.value,P=I.value,Z,U,G;if(P===0)return g[1];if(D===0)return g[0];if(D===1)return g[1];if(D===-1)return I.isEven()?g[1]:g[-1];if(I.sign)return g[0];if(!I.isSmall)throw new Error("The exponent "+I.toString()+" is too large.");if(this.isSmall&&M(Z=Math.pow(D,P)))return new h(ge(Z));for(U=this,G=g[1];P&!0&&(G=G.times(U),--P),P!==0;)P/=2,U=U.square();return G},h.prototype.pow=E.prototype.pow,T.prototype.pow=function(b){var I=Se(b),D=this.value,P=I.value,Z=BigInt(0),U=BigInt(1),G=BigInt(2);if(P===Z)return g[1];if(D===Z)return g[0];if(D===U)return g[1];if(D===BigInt(-1))return I.isEven()?g[1]:g[-1];if(I.isNegative())return new T(Z);for(var K=this,Q=g[1];(P&U)===U&&(Q=Q.times(K),--P),P!==Z;)P/=G,K=K.square();return Q},E.prototype.modPow=function(b,I){if(b=Se(b),I=Se(I),I.isZero())throw new Error("Cannot take modPow with modulus 0");var D=g[1],P=this.mod(I);for(b.isNegative()&&(b=b.multiply(g[-1]),P=P.modInv(I));b.isPositive();){if(P.isZero())return g[0];b.isOdd()&&(D=D.multiply(P).mod(I)),b=b.divide(2),P=P.square().mod(I)}return D},T.prototype.modPow=h.prototype.modPow=E.prototype.modPow;function Ie(b,I){if(b.length!==I.length)return b.length>I.length?1:-1;for(var D=b.length-1;D>=0;D--)if(b[D]!==I[D])return b[D]>I[D]?1:-1;return 0}E.prototype.compareAbs=function(b){var I=Se(b),D=this.value,P=I.value;return I.isSmall?1:Ie(D,P)},h.prototype.compareAbs=function(b){var I=Se(b),D=Math.abs(this.value),P=I.value;return I.isSmall?(P=Math.abs(P),D===P?0:D>P?1:-1):-1},T.prototype.compareAbs=function(b){var I=this.value,D=Se(b).value;return I=I>=0?I:-I,D=D>=0?D:-D,I===D?0:I>D?1:-1},E.prototype.compare=function(b){if(b===1/0)return-1;if(b===-1/0)return 1;var I=Se(b),D=this.value,P=I.value;return this.sign!==I.sign?I.sign?1:-1:I.isSmall?this.sign?-1:1:Ie(D,P)*(this.sign?-1:1)},E.prototype.compareTo=E.prototype.compare,h.prototype.compare=function(b){if(b===1/0)return-1;if(b===-1/0)return 1;var I=Se(b),D=this.value,P=I.value;return I.isSmall?D==P?0:D>P?1:-1:D<0!==I.sign?D<0?-1:1:D<0?1:-1},h.prototype.compareTo=h.prototype.compare,T.prototype.compare=function(b){if(b===1/0)return-1;if(b===-1/0)return 1;var I=this.value,D=Se(b).value;return I===D?0:I>D?1:-1},T.prototype.compareTo=T.prototype.compare,E.prototype.equals=function(b){return this.compare(b)===0},T.prototype.eq=T.prototype.equals=h.prototype.eq=h.prototype.equals=E.prototype.eq=E.prototype.equals,E.prototype.notEquals=function(b){return this.compare(b)!==0},T.prototype.neq=T.prototype.notEquals=h.prototype.neq=h.prototype.notEquals=E.prototype.neq=E.prototype.notEquals,E.prototype.greater=function(b){return this.compare(b)>0},T.prototype.gt=T.prototype.greater=h.prototype.gt=h.prototype.greater=E.prototype.gt=E.prototype.greater,E.prototype.lesser=function(b){return this.compare(b)<0},T.prototype.lt=T.prototype.lesser=h.prototype.lt=h.prototype.lesser=E.prototype.lt=E.prototype.lesser,E.prototype.greaterOrEquals=function(b){return this.compare(b)>=0},T.prototype.geq=T.prototype.greaterOrEquals=h.prototype.geq=h.prototype.greaterOrEquals=E.prototype.geq=E.prototype.greaterOrEquals,E.prototype.lesserOrEquals=function(b){return this.compare(b)<=0},T.prototype.leq=T.prototype.lesserOrEquals=h.prototype.leq=h.prototype.lesserOrEquals=E.prototype.leq=E.prototype.lesserOrEquals,E.prototype.isEven=function(){return(this.value[0]&1)===0},h.prototype.isEven=function(){return(this.value&1)===0},T.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},E.prototype.isOdd=function(){return(this.value[0]&1)===1},h.prototype.isOdd=function(){return(this.value&1)===1},T.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},E.prototype.isPositive=function(){return!this.sign},h.prototype.isPositive=function(){return this.value>0},T.prototype.isPositive=h.prototype.isPositive,E.prototype.isNegative=function(){return this.sign},h.prototype.isNegative=function(){return this.value<0},T.prototype.isNegative=h.prototype.isNegative,E.prototype.isUnit=function(){return!1},h.prototype.isUnit=function(){return Math.abs(this.value)===1},T.prototype.isUnit=function(){return this.abs().value===BigInt(1)},E.prototype.isZero=function(){return!1},h.prototype.isZero=function(){return this.value===0},T.prototype.isZero=function(){return this.value===BigInt(0)},E.prototype.isDivisibleBy=function(b){var I=Se(b);return I.isZero()?!1:I.isUnit()?!0:I.compareAbs(2)===0?this.isEven():this.mod(I).isZero()},T.prototype.isDivisibleBy=h.prototype.isDivisibleBy=E.prototype.isDivisibleBy;function We(b){var I=b.abs();if(I.isUnit())return!1;if(I.equals(2)||I.equals(3)||I.equals(5))return!0;if(I.isEven()||I.isDivisibleBy(3)||I.isDivisibleBy(5))return!1;if(I.lesser(49))return!0}function Ge(b,I){for(var D=b.prev(),P=D,Z=0,U,G,K;P.isEven();)P=P.divide(2),Z++;e:for(G=0;G<I.length;G++)if(!b.lesser(I[G])&&(K=t(I[G]).modPow(P,b),!(K.isUnit()||K.equals(D)))){for(U=Z-1;U!=0;U--){if(K=K.square().mod(b),K.isUnit())return!1;if(K.equals(D))continue e}return!1}return!0}E.prototype.isPrime=function(b){var I=We(this);if(I!==e)return I;var D=this.abs(),P=D.bitLength();if(P<=64)return Ge(D,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var Z=Math.log(2)*P.toJSNumber(),U=Math.ceil(b===!0?2*Math.pow(Z,2):Z),G=[],K=0;K<U;K++)G.push(t(K+2));return Ge(D,G)},T.prototype.isPrime=h.prototype.isPrime=E.prototype.isPrime,E.prototype.isProbablePrime=function(b,I){var D=We(this);if(D!==e)return D;for(var P=this.abs(),Z=b===e?5:b,U=[],G=0;G<Z;G++)U.push(t.randBetween(2,P.minus(2),I));return Ge(P,U)},T.prototype.isProbablePrime=h.prototype.isProbablePrime=E.prototype.isProbablePrime,E.prototype.modInv=function(b){for(var I=t.zero,D=t.one,P=Se(b),Z=this.abs(),U,G,K;!Z.isZero();)U=P.divide(Z),G=I,K=P,I=D,P=Z,D=G.subtract(U.multiply(D)),Z=K.subtract(U.multiply(Z));if(!P.isUnit())throw new Error(this.toString()+" and "+b.toString()+" are not co-prime");return I.compare(0)===-1&&(I=I.add(b)),this.isNegative()?I.negate():I},T.prototype.modInv=h.prototype.modInv=E.prototype.modInv,E.prototype.next=function(){var b=this.value;return this.sign?vt(b,1,this.sign):new E(Fe(b,1),this.sign)},h.prototype.next=function(){var b=this.value;return b+1<l?new h(b+1):new E(u,!1)},T.prototype.next=function(){return new T(this.value+BigInt(1))},E.prototype.prev=function(){var b=this.value;return this.sign?new E(Fe(b,1),!0):vt(b,1,this.sign)},h.prototype.prev=function(){var b=this.value;return b-1>-9007199254740992?new h(b-1):new E(u,!0)},T.prototype.prev=function(){return new T(this.value-BigInt(1))};for(var ut=[1];2*ut[ut.length-1]<=r;)ut.push(2*ut[ut.length-1]);var At=ut.length,Ct=ut[At-1];function As(b){return Math.abs(b)<=r}E.prototype.shiftLeft=function(b){var I=Se(b).toJSNumber();if(!As(I))throw new Error(String(I)+" is too large for shifting.");if(I<0)return this.shiftRight(-I);var D=this;if(D.isZero())return D;for(;I>=At;)D=D.multiply(Ct),I-=At-1;return D.multiply(ut[I])},T.prototype.shiftLeft=h.prototype.shiftLeft=E.prototype.shiftLeft,E.prototype.shiftRight=function(b){var I,D=Se(b).toJSNumber();if(!As(D))throw new Error(String(D)+" is too large for shifting.");if(D<0)return this.shiftLeft(-D);for(var P=this;D>=At;){if(P.isZero()||P.isNegative()&&P.isUnit())return P;I=De(P,Ct),P=I[1].isNegative()?I[0].prev():I[0],D-=At-1}return I=De(P,ut[D]),I[1].isNegative()?I[0].prev():I[0]},T.prototype.shiftRight=h.prototype.shiftRight=E.prototype.shiftRight;function Ke(b,I,D){I=Se(I);for(var P=b.isNegative(),Z=I.isNegative(),U=P?b.not():b,G=Z?I.not():I,K=0,Q=0,he=null,xe=null,Re=[];!U.isZero()||!G.isZero();)he=De(U,Ct),K=he[1].toJSNumber(),P&&(K=Ct-1-K),xe=De(G,Ct),Q=xe[1].toJSNumber(),Z&&(Q=Ct-1-Q),U=he[0],G=xe[0],Re.push(D(K,Q));for(var Ae=D(P?1:0,Z?1:0)!==0?t(-1):t(0),xt=Re.length-1;xt>=0;xt-=1)Ae=Ae.multiply(Ct).add(t(Re[xt]));return Ae}E.prototype.not=function(){return this.negate().prev()},T.prototype.not=h.prototype.not=E.prototype.not,E.prototype.and=function(b){return Ke(this,b,function(I,D){return I&D})},T.prototype.and=h.prototype.and=E.prototype.and,E.prototype.or=function(b){return Ke(this,b,function(I,D){return I|D})},T.prototype.or=h.prototype.or=E.prototype.or,E.prototype.xor=function(b){return Ke(this,b,function(I,D){return I^D})},T.prototype.xor=h.prototype.xor=E.prototype.xor;var et=1<<30,tn=(r&-1e7)*(r&-1e7)|et;function ft(b){var I=b.value,D=typeof I=="number"?I|et:typeof I=="bigint"?I|BigInt(et):I[0]+I[1]*r|tn;return D&-D}function cs(b,I){if(I.compareTo(b)<=0){var D=cs(b,I.square(I)),P=D.p,Z=D.e,U=P.multiply(I);return U.compareTo(b)<=0?{p:U,e:Z*2+1}:{p:P,e:Z*2}}return{p:t(1),e:0}}E.prototype.bitLength=function(){var b=this;return b.compareTo(t(0))<0&&(b=b.negate().subtract(t(1))),b.compareTo(t(0))===0?t(0):t(cs(b,t(2)).e).add(t(1))},T.prototype.bitLength=h.prototype.bitLength=E.prototype.bitLength;function fs(b,I){return b=Se(b),I=Se(I),b.greater(I)?b:I}function us(b,I){return b=Se(b),I=Se(I),b.lesser(I)?b:I}function ds(b,I){if(b=Se(b).abs(),I=Se(I).abs(),b.equals(I))return b;if(b.isZero())return I;if(I.isZero())return b;for(var D=g[1],P,Z;b.isEven()&&I.isEven();)P=us(ft(b),ft(I)),b=b.divide(P),I=I.divide(P),D=D.multiply(P);for(;b.isEven();)b=b.divide(ft(b));do{for(;I.isEven();)I=I.divide(ft(I));b.greater(I)&&(Z=I,I=b,b=Z),I=I.subtract(b)}while(!I.isZero());return D.isUnit()?b:b.multiply(D)}function Wn(b,I){return b=Se(b).abs(),I=Se(I).abs(),b.divide(ds(b,I)).multiply(I)}function Kn(b,I,D){b=Se(b),I=Se(I);var P=D||Math.random,Z=us(b,I),U=fs(b,I),G=U.subtract(Z).add(1);if(G.isSmall)return Z.add(Math.floor(P()*G));for(var K=it(G,r).value,Q=[],he=!0,xe=0;xe<K.length;xe++){var Re=he?K[xe]+(xe+1<K.length?K[xe+1]/r:0):r,Ae=ge(P()*Re);Q.push(Ae),Ae<K[xe]&&(he=!1)}return Z.add(g.fromArray(Q,r,!1))}var nn=function(b,I,D,P){D=D||d,b=String(b),P||(b=b.toLowerCase(),D=D.toLowerCase());var Z=b.length,U,G=Math.abs(I),K={};for(U=0;U<D.length;U++)K[D[U]]=U;for(U=0;U<Z;U++){var Q=b[U];if(Q!=="-"&&Q in K&&K[Q]>=G){if(Q==="1"&&G===1)continue;throw new Error(Q+" is not a valid digit in base "+I+".")}}I=Se(I);var he=[],xe=b[0]==="-";for(U=xe?1:0;U<b.length;U++){var Q=b[U];if(Q in K)he.push(Se(K[Q]));else if(Q==="<"){var Re=U;do U++;while(b[U]!==">"&&U<b.length);he.push(Se(b.slice(Re+1,U)))}else throw new Error(Q+" is not a valid character")}return qn(he,I,xe)};function qn(b,I,D){var P=g[0],Z=g[1],U;for(U=b.length-1;U>=0;U--)P=P.add(b[U].times(Z)),Z=Z.times(I);return D?P.negate():P}function vn(b,I){return I=I||d,b<I.length?I[b]:"<"+b+">"}function it(b,I){if(I=t(I),I.isZero()){if(b.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(I.equals(-1)){if(b.isZero())return{value:[0],isNegative:!1};if(b.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-b.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var D=Array.apply(null,Array(b.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return D.unshift([1]),{value:[].concat.apply([],D),isNegative:!1}}var P=!1;if(b.isNegative()&&I.isPositive()&&(P=!0,b=b.abs()),I.isUnit())return b.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(b.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:P};for(var Z=[],U=b,G;U.isNegative()||U.compareAbs(I)>=0;){G=U.divmod(I),U=G.quotient;var K=G.remainder;K.isNegative()&&(K=I.minus(K).abs(),U=U.next()),Z.push(K.toJSNumber())}return Z.push(U.toJSNumber()),{value:Z.reverse(),isNegative:P}}function Mt(b,I,D){var P=it(b,I);return(P.isNegative?"-":"")+P.value.map(function(Z){return vn(Z,D)}).join("")}E.prototype.toArray=function(b){return it(this,b)},h.prototype.toArray=function(b){return it(this,b)},T.prototype.toArray=function(b){return it(this,b)},E.prototype.toString=function(b,I){if(b===e&&(b=10),b!==10||I)return Mt(this,b,I);for(var D=this.value,P=D.length,Z=String(D[--P]),U="0000000",G;--P>=0;)G=String(D[P]),Z+=U.slice(G.length)+G;var K=this.sign?"-":"";return K+Z},h.prototype.toString=function(b,I){return b===e&&(b=10),b!=10||I?Mt(this,b,I):String(this.value)},T.prototype.toString=h.prototype.toString,T.prototype.toJSON=E.prototype.toJSON=h.prototype.toJSON=function(){return this.toString()},E.prototype.valueOf=function(){return parseInt(this.toString(),10)},E.prototype.toJSNumber=E.prototype.valueOf,h.prototype.valueOf=function(){return this.value},h.prototype.toJSNumber=h.prototype.valueOf,T.prototype.valueOf=T.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function Yn(b){if(M(+b)){var I=+b;if(I===ge(I))return y?new T(BigInt(I)):new h(I);throw new Error("Invalid integer: "+b)}var D=b[0]==="-";D&&(b=b.slice(1));var P=b.split(/e/i);if(P.length>2)throw new Error("Invalid integer: "+P.join("e"));if(P.length===2){var Z=P[1];if(Z[0]==="+"&&(Z=Z.slice(1)),Z=+Z,Z!==ge(Z)||!M(Z))throw new Error("Invalid integer: "+Z+" is not a valid exponent.");var U=P[0],G=U.indexOf(".");if(G>=0&&(Z-=U.length-G-1,U=U.slice(0,G)+U.slice(G+1)),Z<0)throw new Error("Cannot include negative exponent part for integers");U+=new Array(Z+1).join("0"),b=U}var K=/^([0-9][0-9]*)$/.test(b);if(!K)throw new Error("Invalid integer: "+b);if(y)return new T(BigInt(D?"-"+b:b));for(var Q=[],he=b.length,xe=a,Re=he-xe;he>0;)Q.push(+b.slice(Re,he)),Re-=xe,Re<0&&(Re=0),he-=xe;return z(Q),new E(Q,D)}function Ln(b){if(y)return new T(BigInt(b));if(M(b)){if(b!==ge(b))throw new Error(b+" is not an integer.");return new h(b)}return Yn(b.toString())}function Se(b){return typeof b=="number"?Ln(b):typeof b=="string"?Yn(b):typeof b=="bigint"?new T(b):b}for(var qt=0;qt<1e3;qt++)g[qt]=Se(qt),qt>0&&(g[-qt]=Se(-qt));return g.one=g[1],g.zero=g[0],g.minusOne=g[-1],g.max=fs,g.min=us,g.gcd=ds,g.lcm=Wn,g.isInstance=function(b){return b instanceof E||b instanceof h||b instanceof T},g.randBetween=Kn,g.fromArray=function(b,I,D){return qn(b.map(Se),Se(I||10),D)},g}();s.hasOwnProperty("exports")&&(s.exports=t)}(oa)),oa.exports}var Yf=qf(),ol=Ua(Yf);const ll=64,Sa=16,Cs=ll/Sa;function Xf(){try{return!0}catch{return!1}}function Jf(s,t,e){let r=0;for(let a=0;a<e;a++){const l=s[t+a];if(l===void 0)break;r+=l*16**a}return r}function cl(s){const t=[];for(let e=0;e<s.length;e++){let r=Number(s[e]);for(let a=0;r||a<t.length;a++)r+=(t[a]||0)*10,t[a]=r%16,r=(r-t[a])/16}return t}function Qf(s){const t=cl(s),e=Array(Cs);for(let r=0;r<Cs;r++)e[Cs-1-r]=Jf(t,r*Cs,Cs);return e}class Jn{static fromString(t){return new Jn(Qf(t),t)}static fromBit(t){const e=Array(Cs),r=Math.floor(t/Sa);for(let a=0;a<Cs;a++)e[Cs-1-a]=a===r?1<<t-r*Sa:0;return new Jn(e)}constructor(t,e){this.parts=t,this.str=e}and({parts:t}){return new Jn(this.parts.map((e,r)=>e&t[r]))}or({parts:t}){return new Jn(this.parts.map((e,r)=>e|t[r]))}xor({parts:t}){return new Jn(this.parts.map((e,r)=>e^t[r]))}not(){return new Jn(this.parts.map(t=>~t))}equals({parts:t}){return this.parts.every((e,r)=>e===t[r])}toString(){if(this.str!=null)return this.str;const t=new Array(ll/4);return this.parts.forEach((e,r)=>{const a=cl(e.toString());for(let l=0;l<4;l++)t[l+r*4]=a[3-l]||0}),this.str=ol.fromArray(t,16).toString()}toJSON(){return this.toString()}}const Gs=Xf();Gs&&BigInt.prototype.toJSON==null&&(BigInt.prototype.toJSON=function(){return this.toString()});const bi={},fl=Gs?function(t){return BigInt(t)}:function(t){return t instanceof Jn?t:(typeof t=="number"&&(t=t.toString()),bi[t]!=null||(bi[t]=Jn.fromString(t)),bi[t])},Kt=fl(0),Hi=Gs?function(t=Kt,e=Kt){return t&e}:function(t=Kt,e=Kt){return t.and(e)},ul=Gs?function(t=Kt,e=Kt){return t|e}:function(t=Kt,e=Kt){return t.or(e)},eu=Gs?function(t=Kt,e=Kt){return t^e}:function(t=Kt,e=Kt){return t.xor(e)},tu=Gs?function(t=Kt){return~t}:function(t=Kt){return t.not()},Ha=Gs?function(t,e){return t===e}:function(t,e){return t==null||e==null?t==e:t.equals(e)};function nu(...s){let t=s[0];for(let e=1;e<s.length;e++)t=ul(t,s[e]);return t}function su(s,t){return Ha(Hi(s,t),t)}function ru(s,t){return!Ha(Hi(s,t),Kt)}function iu(s,t){return t===Kt?s:ul(s,t)}function au(s,t){return t===Kt?s:eu(s,Hi(s,t))}const ou=Gs?function(t){return BigInt(1)<<BigInt(t)}:function(t){return Jn.fromBit(t)};var Ne={combine:nu,add:iu,remove:au,filter:Hi,invert:tu,has:su,hasAny:ru,equals:Ha,deserialize:fl,getFlag:ou},bo;(function(s){s[s.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",s[s.CLOSE_UNSUPPORTED=1003]="CLOSE_UNSUPPORTED",s[s.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",s[s.INVALID_CLIENTID=4e3]="INVALID_CLIENTID",s[s.INVALID_ORIGIN=4001]="INVALID_ORIGIN",s[s.RATELIMITED=4002]="RATELIMITED",s[s.TOKEN_REVOKED=4003]="TOKEN_REVOKED",s[s.INVALID_VERSION=4004]="INVALID_VERSION",s[s.INVALID_ENCODING=4005]="INVALID_ENCODING"})(bo||(bo={}));var Aa;(function(s){s[s.INVALID_PAYLOAD=4e3]="INVALID_PAYLOAD",s[s.INVALID_COMMAND=4002]="INVALID_COMMAND",s[s.INVALID_EVENT=4004]="INVALID_EVENT",s[s.INVALID_PERMISSIONS=4006]="INVALID_PERMISSIONS"})(Aa||(Aa={}));var Oa;(function(s){s.LANDSCAPE="landscape",s.PORTRAIT="portrait"})(Oa||(Oa={}));var Qn;(function(s){s.MOBILE="mobile",s.DESKTOP="desktop"})(Qn||(Qn={}));Object.freeze({CREATE_INSTANT_INVITE:Ne.getFlag(0),KICK_MEMBERS:Ne.getFlag(1),BAN_MEMBERS:Ne.getFlag(2),ADMINISTRATOR:Ne.getFlag(3),MANAGE_CHANNELS:Ne.getFlag(4),MANAGE_GUILD:Ne.getFlag(5),ADD_REACTIONS:Ne.getFlag(6),VIEW_AUDIT_LOG:Ne.getFlag(7),PRIORITY_SPEAKER:Ne.getFlag(8),STREAM:Ne.getFlag(9),VIEW_CHANNEL:Ne.getFlag(10),SEND_MESSAGES:Ne.getFlag(11),SEND_TTS_MESSAGES:Ne.getFlag(12),MANAGE_MESSAGES:Ne.getFlag(13),EMBED_LINKS:Ne.getFlag(14),ATTACH_FILES:Ne.getFlag(15),READ_MESSAGE_HISTORY:Ne.getFlag(16),MENTION_EVERYONE:Ne.getFlag(17),USE_EXTERNAL_EMOJIS:Ne.getFlag(18),VIEW_GUILD_INSIGHTS:Ne.getFlag(19),CONNECT:Ne.getFlag(20),SPEAK:Ne.getFlag(21),MUTE_MEMBERS:Ne.getFlag(22),DEAFEN_MEMBERS:Ne.getFlag(23),MOVE_MEMBERS:Ne.getFlag(24),USE_VAD:Ne.getFlag(25),CHANGE_NICKNAME:Ne.getFlag(26),MANAGE_NICKNAMES:Ne.getFlag(27),MANAGE_ROLES:Ne.getFlag(28),MANAGE_WEBHOOKS:Ne.getFlag(29),MANAGE_GUILD_EXPRESSIONS:Ne.getFlag(30),USE_APPLICATION_COMMANDS:Ne.getFlag(31),REQUEST_TO_SPEAK:Ne.getFlag(32),MANAGE_EVENTS:Ne.getFlag(33),MANAGE_THREADS:Ne.getFlag(34),CREATE_PUBLIC_THREADS:Ne.getFlag(35),CREATE_PRIVATE_THREADS:Ne.getFlag(36),USE_EXTERNAL_STICKERS:Ne.getFlag(37),SEND_MESSAGES_IN_THREADS:Ne.getFlag(38),USE_EMBEDDED_ACTIVITIES:Ne.getFlag(39),MODERATE_MEMBERS:Ne.getFlag(40),VIEW_CREATOR_MONETIZATION_ANALYTICS:Ne.getFlag(41),USE_SOUNDBOARD:Ne.getFlag(42),CREATE_GUILD_EXPRESSIONS:Ne.getFlag(43),CREATE_EVENTS:Ne.getFlag(44),USE_EXTERNAL_SOUNDS:Ne.getFlag(45),SEND_VOICE_MESSAGES:Ne.getFlag(46),SEND_POLLS:Ne.getFlag(49),USE_EXTERNAL_APPS:Ne.getFlag(50)});const vo=-1,lu=250;function Qt(s){return al(t=>{var e;const[r]=(e=Object.entries(s).find(([,a])=>a===t))!==null&&e!==void 0?e:[];return t!=null&&r===void 0?s.UNHANDLED:t},C().or(we()))}function dl(s){const t=Va().transform(e=>{const r=s.safeParse(e);return r.success?r.data:s._def.defaultValue()});return t.overlayType=s,t}const cu=le.object({image_url:le.string()}),fu=le.object({mediaUrl:le.string().max(1024)}),uu=le.object({access_token:le.union([le.string(),le.null()]).optional()}),hl=le.object({access_token:le.string(),user:le.object({username:le.string(),discriminator:le.string(),id:le.string(),avatar:le.union([le.string(),le.null()]).optional(),public_flags:le.number(),global_name:le.union([le.string(),le.null()]).optional()}),scopes:le.array(dl(le.enum(["identify","email","connections","guilds","guilds.join","guilds.members.read","guilds.channels.read","gdm.join","bot","rpc","rpc.notifications.read","rpc.voice.read","rpc.voice.write","rpc.video.read","rpc.video.write","rpc.screenshare.read","rpc.screenshare.write","rpc.activities.write","webhook.incoming","messages.read","applications.builds.upload","applications.builds.read","applications.commands","applications.commands.permissions.update","applications.commands.update","applications.store.update","applications.entitlements","activities.read","activities.write","relationships.read","relationships.write","voice","dm_channels.read","role_connections.write","presences.read","presences.write","openid","dm_channels.messages.read","dm_channels.messages.write","gateway.connect","account.global_name.update","payment_sources.country_code","sdk.social_layer"]).or(le.literal(-1)).default(-1))),expires:le.string(),application:le.object({description:le.string(),icon:le.union([le.string(),le.null()]).optional(),id:le.string(),rpc_origins:le.array(le.string()).optional(),name:le.string()})}),pl=le.object({participants:le.array(le.object({id:le.string(),username:le.string(),global_name:le.union([le.string(),le.null()]).optional(),discriminator:le.string(),avatar:le.union([le.string(),le.null()]).optional(),flags:le.number(),bot:le.boolean(),avatar_decoration_data:le.union([le.object({asset:le.string(),skuId:le.string().optional()}),le.null()]).optional(),premium_type:le.union([le.number(),le.null()]).optional(),nickname:le.string().optional()}))}),du=le.object({command:le.string(),content:le.string().max(2e3).optional(),preview_image:le.object({height:le.number(),url:le.string(),width:le.number()}).optional(),components:le.array(le.object({type:le.literal(1),components:le.array(le.object({type:le.literal(2),style:le.number().gte(1).lte(5),label:le.string().max(80).optional(),custom_id:le.string().max(100).describe("Developer-defined identifier for the button; max 100 characters").optional()})).max(5).optional()})).optional()}),hu=le.object({referrer_id:le.string().max(64).optional(),custom_id:le.string().max(64).optional(),message:le.string().max(1e3)}),pu=le.object({success:le.boolean()});var Sn;(function(s){s.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",s.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",s.AUTHENTICATE="AUTHENTICATE",s.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS",s.SHARE_INTERACTION="SHARE_INTERACTION",s.SHARE_LINK="SHARE_LINK"})(Sn||(Sn={}));const _o=le.object({}).optional().nullable(),wo=le.void(),gl={[Sn.INITIATE_IMAGE_UPLOAD]:{request:wo,response:cu},[Sn.OPEN_SHARE_MOMENT_DIALOG]:{request:fu,response:_o},[Sn.AUTHENTICATE]:{request:uu,response:hl},[Sn.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS]:{request:wo,response:pl},[Sn.SHARE_INTERACTION]:{request:du,response:_o},[Sn.SHARE_LINK]:{request:hu,response:pu}},gu="DISPATCH";var Te;(function(s){s.AUTHORIZE="AUTHORIZE",s.AUTHENTICATE="AUTHENTICATE",s.GET_GUILDS="GET_GUILDS",s.GET_GUILD="GET_GUILD",s.GET_CHANNEL="GET_CHANNEL",s.GET_CHANNELS="GET_CHANNELS",s.SELECT_VOICE_CHANNEL="SELECT_VOICE_CHANNEL",s.SELECT_TEXT_CHANNEL="SELECT_TEXT_CHANNEL",s.SUBSCRIBE="SUBSCRIBE",s.UNSUBSCRIBE="UNSUBSCRIBE",s.CAPTURE_SHORTCUT="CAPTURE_SHORTCUT",s.SET_CERTIFIED_DEVICES="SET_CERTIFIED_DEVICES",s.SET_ACTIVITY="SET_ACTIVITY",s.GET_SKUS="GET_SKUS",s.GET_ENTITLEMENTS="GET_ENTITLEMENTS",s.GET_SKUS_EMBEDDED="GET_SKUS_EMBEDDED",s.GET_ENTITLEMENTS_EMBEDDED="GET_ENTITLEMENTS_EMBEDDED",s.START_PURCHASE="START_PURCHASE",s.SET_CONFIG="SET_CONFIG",s.SEND_ANALYTICS_EVENT="SEND_ANALYTICS_EVENT",s.USER_SETTINGS_GET_LOCALE="USER_SETTINGS_GET_LOCALE",s.OPEN_EXTERNAL_LINK="OPEN_EXTERNAL_LINK",s.ENCOURAGE_HW_ACCELERATION="ENCOURAGE_HW_ACCELERATION",s.CAPTURE_LOG="CAPTURE_LOG",s.SET_ORIENTATION_LOCK_STATE="SET_ORIENTATION_LOCK_STATE",s.OPEN_INVITE_DIALOG="OPEN_INVITE_DIALOG",s.GET_PLATFORM_BEHAVIORS="GET_PLATFORM_BEHAVIORS",s.GET_CHANNEL_PERMISSIONS="GET_CHANNEL_PERMISSIONS",s.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",s.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",s.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS",s.SHARE_LINK="SHARE_LINK"})(Te||(Te={}));const Rr=oe({cmd:C(),data:ai(),evt:ji(),nonce:C()}).passthrough(),mu=Object.assign(Object.assign({},hl.shape.scopes.element.overlayType._def.innerType.options[0].Values),{UNHANDLED:-1});Qt(mu);const js=oe({id:C(),username:C(),discriminator:C(),global_name:C().optional().nullable(),avatar:C().optional().nullable(),avatar_decoration_data:oe({asset:C(),sku_id:C().optional()}).nullable(),bot:ke(),flags:we().optional().nullable(),premium_type:we().optional().nullable()}),Ga=oe({user:js,nick:C().optional().nullable(),roles:tt(C()),joined_at:C(),deaf:ke(),mute:ke()}),yu=oe({user_id:C(),nick:C().optional().nullable(),guild_id:C(),avatar:C().optional().nullable(),avatar_decoration_data:oe({asset:C(),sku_id:C().optional().nullable()}).optional().nullable(),color_string:C().optional().nullable()}),Za=oe({id:C(),name:C().optional().nullable(),roles:tt(C()).optional().nullable(),user:js.optional().nullable(),require_colons:ke().optional().nullable(),managed:ke().optional().nullable(),animated:ke().optional().nullable(),available:ke().optional().nullable()}),ml=oe({mute:ke(),deaf:ke(),self_mute:ke(),self_deaf:ke(),suppress:ke()}),yl=oe({mute:ke(),nick:C(),user:js,voice_state:ml,volume:we()}),Eu={UNHANDLED:-1,IDLE:"idle",DND:"dnd",ONLINE:"online",OFFLINE:"offline"},vi=Qt(Eu),Zr=oe({name:C(),type:we(),url:C().optional().nullable(),created_at:we().optional().nullable(),timestamps:oe({start:we(),end:we()}).partial().optional().nullable(),application_id:C().optional().nullable(),details:C().optional().nullable(),state:C().optional().nullable(),emoji:Za.optional().nullable(),party:oe({id:C().optional().nullable(),size:tt(we()).optional().nullable()}).optional().nullable(),assets:oe({large_image:C().nullable(),large_text:C().nullable(),small_image:C().nullable(),small_text:C().nullable()}).partial().optional().nullable(),secrets:oe({join:C(),match:C()}).partial().optional().nullable(),instance:ke().optional().nullable(),flags:we().optional().nullable()}),bu={UNHANDLED:-1,ROLE:0,MEMBER:1},vu=oe({id:C(),type:Qt(bu),allow:C(),deny:C()}),za={UNHANDLED:-1,DM:1,GROUP_DM:3,GUILD_TEXT:0,GUILD_VOICE:2,GUILD_CATEGORY:4,GUILD_ANNOUNCEMENT:5,GUILD_STORE:6,ANNOUNCEMENT_THREAD:10,PUBLIC_THREAD:11,PRIVATE_THREAD:12,GUILD_STAGE_VOICE:13,GUILD_DIRECTORY:14,GUILD_FORUM:15},El=oe({id:C(),type:Qt(za),guild_id:C().optional().nullable(),position:we().optional().nullable(),permission_overwrites:tt(vu).optional().nullable(),name:C().optional().nullable(),topic:C().optional().nullable(),nsfw:ke().optional().nullable(),last_message_id:C().optional().nullable(),bitrate:we().optional().nullable(),user_limit:we().optional().nullable(),rate_limit_per_user:we().optional().nullable(),recipients:tt(js).optional().nullable(),icon:C().optional().nullable(),owner_id:C().optional().nullable(),application_id:C().optional().nullable(),parent_id:C().optional().nullable(),last_pin_timestamp:C().optional().nullable()}),_u=oe({user:js,guild_id:C(),status:vi,activities:tt(Zr),client_status:oe({desktop:vi,mobile:vi,web:vi}).partial()}),wu=oe({id:C(),name:C(),color:we(),hoist:ke(),position:we(),permissions:C(),managed:ke(),mentionable:ke()});oe({id:C(),name:C(),owner_id:C(),icon:C().nullable(),icon_hash:C().optional().nullable(),splash:C().nullable(),discovery_splash:C().nullable(),owner:ke().optional().nullable(),permissions:C().optional().nullable(),region:C(),afk_channel_id:C().nullable(),afk_timeout:we(),widget_enabled:ke().optional().nullable(),widget_channel_id:C().optional().nullable(),verification_level:we(),default_message_notifications:we(),explicit_content_filter:we(),roles:tt(wu),emojis:tt(Za),features:tt(C()),mfa_level:we(),application_id:C().nullable(),system_channel_id:C().nullable(),system_channel_flags:we(),rules_channel_id:C().nullable(),joined_at:C().optional().nullable(),large:ke().optional().nullable(),unavailable:ke().optional().nullable(),member_count:we().optional().nullable(),voice_states:tt(ml).optional().nullable(),members:tt(Ga).optional().nullable(),channels:tt(El).optional().nullable(),presences:tt(_u).optional().nullable(),max_presences:we().optional().nullable(),max_members:we().optional().nullable(),vanity_url_code:C().nullable(),description:C().nullable(),banner:C().nullable(),premium_tier:we(),premium_subscription_count:we().optional().nullable(),preferred_locale:C(),public_updates_channel_id:C().nullable(),max_video_channel_users:we().optional().nullable(),approximate_member_count:we().optional().nullable(),approximate_presence_count:we().optional().nullable()});const Iu=oe({id:C(),guild_id:C(),type:we(),name:C()}),Tu=oe({id:C(),filename:C(),size:we(),url:C(),proxy_url:C(),height:we().optional().nullable(),width:we().optional().nullable()}),Su=oe({text:C(),icon_url:C().optional().nullable(),proxy_icon_url:C().optional().nullable()}),xa=oe({url:C().optional().nullable(),proxy_url:C().optional().nullable(),height:we().optional().nullable(),width:we().optional().nullable()}),Au=xa.omit({proxy_url:!0}),Ou=oe({name:C().optional().nullable(),url:C().optional().nullable()}),xu=oe({name:C().optional().nullable(),url:C().optional().nullable(),icon_url:C().optional().nullable(),proxy_icon_url:C().optional().nullable()}),Du=oe({name:C(),value:C(),inline:ke()}),Ru=oe({title:C().optional().nullable(),type:C().optional().nullable(),description:C().optional().nullable(),url:C().optional().nullable(),timestamp:C().optional().nullable(),color:we().optional().nullable(),footer:Su.optional().nullable(),image:xa.optional().nullable(),thumbnail:xa.optional().nullable(),video:Au.optional().nullable(),provider:Ou.optional().nullable(),author:xu.optional().nullable(),fields:tt(Du).optional().nullable()}),Nu=oe({count:we(),me:ke(),emoji:Za}),Pu=oe({type:we(),party_id:C().optional().nullable()}),Cu=oe({id:C(),cover_image:C().optional().nullable(),description:C(),icon:C().optional().nullable(),name:C()}),Lu=oe({message_id:C().optional().nullable(),channel_id:C().optional().nullable(),guild_id:C().optional().nullable()}),ku=oe({id:C(),channel_id:C(),guild_id:C().optional().nullable(),author:js.optional().nullable(),member:Ga.optional().nullable(),content:C(),timestamp:C(),edited_timestamp:C().optional().nullable(),tts:ke(),mention_everyone:ke(),mentions:tt(js),mention_roles:tt(C()),mention_channels:tt(Iu),attachments:tt(Tu),embeds:tt(Ru),reactions:tt(Nu).optional().nullable(),nonce:ja([C(),we()]).optional().nullable(),pinned:ke(),webhook_id:C().optional().nullable(),type:we(),activity:Pu.optional().nullable(),application:Cu.optional().nullable(),message_reference:Lu.optional().nullable(),flags:we().optional().nullable(),stickers:tt(ai()).optional().nullable(),referenced_message:ai().optional().nullable()}),Bu=oe({id:C(),name:C()}),$u={UNHANDLED:-1,KEYBOARD_KEY:0,MOUSE_BUTTON:1,KEYBOARD_MODIFIER_KEY:2,GAMEPAD_BUTTON:3},bl=oe({type:Qt($u),code:we(),name:C()}),Mu={UNHANDLED:-1,PUSH_TO_TALK:"PUSH_TO_TALK",VOICE_ACTIVITY:"VOICE_ACTIVITY"},Uu=oe({type:Qt(Mu),auto_threshold:ke(),threshold:we(),shortcut:tt(bl),delay:we()}),Io=oe({device_id:C(),volume:we(),available_devices:tt(Bu)}),Fu={UNHANDLED:-1,AUDIO_INPUT:"AUDIO_INPUT",AUDIO_OUTPUT:"AUDIO_OUTPUT",VIDEO_INPUT:"VIDEO_INPUT"};oe({type:Qt(Fu),id:C(),vendor:oe({name:C(),url:C()}),model:oe({name:C(),url:C()}),related:tt(C()),echo_cancellation:ke().optional().nullable(),noise_suppression:ke().optional().nullable(),automatic_gain_control:ke().optional().nullable(),hardware_mute:ke().optional().nullable()});const Vu={UNHANDLED:-1,APPLICATION:1,DLC:2,CONSUMABLE:3,BUNDLE:4,SUBSCRIPTION:5},ju=oe({id:C(),name:C(),type:Qt(Vu),price:oe({amount:we(),currency:C()}),application_id:C(),flags:we(),release_date:C().nullable()}),Hu={UNHANDLED:-1,PURCHASE:1,PREMIUM_SUBSCRIPTION:2,DEVELOPER_GIFT:3,TEST_MODE_PURCHASE:4,FREE_PURCHASE:5,USER_GIFT:6,PREMIUM_PURCHASE:7},Wa=oe({id:C(),sku_id:C(),application_id:C(),user_id:C(),gift_code_flags:we(),type:Qt(Hu),gifter_user_id:C().optional().nullable(),branches:tt(C()).optional().nullable(),starts_at:C().optional().nullable(),ends_at:C().optional().nullable(),parent_id:C().optional().nullable(),consumed:ke().optional().nullable(),deleted:ke().optional().nullable(),gift_code_batch_id:C().optional().nullable()}),Gu={UNHANDLED:-1,UNLOCKED:1,PORTRAIT:2,LANDSCAPE:3};Qt(Gu);const Zu={UNHANDLED:-1,NOMINAL:0,FAIR:1,SERIOUS:2,CRITICAL:3},zu=Qt(Zu),vl={UNHANDLED:-1,PORTRAIT:0,LANDSCAPE:1};Qt(vl);const _l={UNHANDLED:-1,FOCUSED:0,PIP:1,GRID:2};Qt(_l);const Ka="ERROR";var at;(function(s){s.READY="READY",s.VOICE_STATE_UPDATE="VOICE_STATE_UPDATE",s.SPEAKING_START="SPEAKING_START",s.SPEAKING_STOP="SPEAKING_STOP",s.ACTIVITY_LAYOUT_MODE_UPDATE="ACTIVITY_LAYOUT_MODE_UPDATE",s.ORIENTATION_UPDATE="ORIENTATION_UPDATE",s.CURRENT_USER_UPDATE="CURRENT_USER_UPDATE",s.CURRENT_GUILD_MEMBER_UPDATE="CURRENT_GUILD_MEMBER_UPDATE",s.ENTITLEMENT_CREATE="ENTITLEMENT_CREATE",s.THERMAL_STATE_UPDATE="THERMAL_STATE_UPDATE",s.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE="ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE"})(at||(at={}));const Tn=Rr.extend({evt:Dr(at),nonce:C().nullable(),cmd:$t(gu),data:oe({}).passthrough()}),wl=Rr.extend({evt:$t(Ka),data:oe({code:we(),message:C().optional()}).passthrough(),cmd:Dr(Te),nonce:C().nullable()}),Wu=Tn.extend({evt:C()}),Ku=ja([Tn,Wu,wl]);function qu(s){const t=s.evt;if(!(t in at))throw new Error(`Unrecognized event type ${s.evt}`);return Yu[t].payload.parse(s)}const Yu={[at.READY]:{payload:Tn.extend({evt:$t(at.READY),data:oe({v:we(),config:oe({cdn_host:C().optional(),api_endpoint:C(),environment:C()}),user:oe({id:C(),username:C(),discriminator:C(),avatar:C().optional()}).optional()})})},[at.VOICE_STATE_UPDATE]:{payload:Tn.extend({evt:$t(at.VOICE_STATE_UPDATE),data:yl}),subscribeArgs:oe({channel_id:C()})},[at.SPEAKING_START]:{payload:Tn.extend({evt:$t(at.SPEAKING_START),data:oe({lobby_id:C().optional(),channel_id:C().optional(),user_id:C()})}),subscribeArgs:oe({lobby_id:C().nullable().optional(),channel_id:C().nullable().optional()})},[at.SPEAKING_STOP]:{payload:Tn.extend({evt:$t(at.SPEAKING_STOP),data:oe({lobby_id:C().optional(),channel_id:C().optional(),user_id:C()})}),subscribeArgs:oe({lobby_id:C().nullable().optional(),channel_id:C().nullable().optional()})},[at.ACTIVITY_LAYOUT_MODE_UPDATE]:{payload:Tn.extend({evt:$t(at.ACTIVITY_LAYOUT_MODE_UPDATE),data:oe({layout_mode:Qt(_l)})})},[at.ORIENTATION_UPDATE]:{payload:Tn.extend({evt:$t(at.ORIENTATION_UPDATE),data:oe({screen_orientation:Qt(vl),orientation:Dr(Oa)})})},[at.CURRENT_USER_UPDATE]:{payload:Tn.extend({evt:$t(at.CURRENT_USER_UPDATE),data:js})},[at.CURRENT_GUILD_MEMBER_UPDATE]:{payload:Tn.extend({evt:$t(at.CURRENT_GUILD_MEMBER_UPDATE),data:yu}),subscribeArgs:oe({guild_id:C()})},[at.ENTITLEMENT_CREATE]:{payload:Tn.extend({evt:$t(at.ENTITLEMENT_CREATE),data:oe({entitlement:Wa})})},[at.THERMAL_STATE_UPDATE]:{payload:Tn.extend({evt:$t(at.THERMAL_STATE_UPDATE),data:oe({thermal_state:zu})})},[at.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE]:{payload:Tn.extend({evt:$t(at.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE),data:oe({participants:pl.shape.participants})})}};function Xu(s,t){throw t}const Gi=oe({}).nullable(),Il=oe({code:C()}),Ju=oe({guilds:tt(oe({id:C(),name:C()}))}),Qu=oe({id:C(),name:C(),icon_url:C().optional(),members:tt(Ga)}),Or=oe({id:C(),type:Qt(za),guild_id:C().optional().nullable(),name:C().optional().nullable(),topic:C().optional().nullable(),bitrate:we().optional().nullable(),user_limit:we().optional().nullable(),position:we().optional().nullable(),voice_states:tt(yl),messages:tt(ku)}),ed=oe({channels:tt(El)});Or.nullable();const td=Or.nullable(),nd=Or.nullable();oe({input:Io,output:Io,mode:Uu,automatic_gain_control:ke(),echo_cancellation:ke(),noise_suppression:ke(),qos:ke(),silence_warning:ke(),deaf:ke(),mute:ke()});const sd=oe({evt:C()}),rd=oe({shortcut:bl}),Tl=Zr,Sl=oe({skus:tt(ju)}),Al=oe({entitlements:tt(Wa)}),Ol=tt(Wa).nullable(),xl=oe({use_interactive_pip:ke()}),Dl=oe({locale:C()}),Rl=oe({enabled:ke()}),Nl=oe({permissions:rl().or(C())}),Pl=dl(oe({opened:ke().or(ji())}).default({opened:null})),Cl=oe({iosKeyboardResizesView:il(ke())}),id=Rr.extend({cmd:Dr(Te),evt:ji()});function ad({cmd:s,data:t}){switch(s){case Te.AUTHORIZE:return Il.parse(t);case Te.CAPTURE_SHORTCUT:return rd.parse(t);case Te.ENCOURAGE_HW_ACCELERATION:return Rl.parse(t);case Te.GET_CHANNEL:return Or.parse(t);case Te.GET_CHANNELS:return ed.parse(t);case Te.GET_CHANNEL_PERMISSIONS:return Nl.parse(t);case Te.GET_GUILD:return Qu.parse(t);case Te.GET_GUILDS:return Ju.parse(t);case Te.GET_PLATFORM_BEHAVIORS:return Cl.parse(t);case Te.GET_CHANNEL:return Or.parse(t);case Te.SELECT_TEXT_CHANNEL:return nd.parse(t);case Te.SELECT_VOICE_CHANNEL:return td.parse(t);case Te.SET_ACTIVITY:return Tl.parse(t);case Te.GET_SKUS_EMBEDDED:return Sl.parse(t);case Te.GET_ENTITLEMENTS_EMBEDDED:return Al.parse(t);case Te.SET_CONFIG:return xl.parse(t);case Te.START_PURCHASE:return Ol.parse(t);case Te.SUBSCRIBE:case Te.UNSUBSCRIBE:return sd.parse(t);case Te.USER_SETTINGS_GET_LOCALE:return Dl.parse(t);case Te.OPEN_EXTERNAL_LINK:return Pl.parse(t);case Te.SET_ORIENTATION_LOCK_STATE:case Te.SET_CERTIFIED_DEVICES:case Te.SEND_ANALYTICS_EVENT:case Te.OPEN_INVITE_DIALOG:case Te.CAPTURE_LOG:case Te.GET_SKUS:case Te.GET_ENTITLEMENTS:return Gi.parse(t);case Te.AUTHENTICATE:case Te.INITIATE_IMAGE_UPLOAD:case Te.OPEN_SHARE_MOMENT_DIALOG:case Te.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS:case Te.SHARE_LINK:const{response:e}=gl[s];return e.parse(t);default:Xu(s,new Error(`Unrecognized command ${s}`))}}function od(s){return Object.assign(Object.assign({},s),{data:ad(s)})}oe({frame_id:C(),platform:Dr(Qn).optional().nullable()});oe({v:$t(1),encoding:$t("json").optional(),client_id:C(),frame_id:C()});const ld=oe({code:we(),message:C().optional()}),cd=oe({evt:C().nullable(),nonce:C().nullable(),data:ai().nullable(),cmd:C()}).passthrough();function fd(s){const t=cd.parse(s);return t.evt!=null?t.evt===Ka?wl.parse(t):qu(Ku.parse(t)):od(id.passthrough().parse(t))}function bn(s,t,e,r=()=>{}){const a=Rr.extend({cmd:$t(t),data:e});return async l=>{const u=await s({cmd:t,args:l,transfer:r(l)});return a.parse(u).data}}function ci(s,t=()=>{}){const e=gl[s].response,r=Rr.extend({cmd:$t(s),data:e});return a=>async l=>{const u=await a({cmd:s,args:l,transfer:t(l)});return r.parse(u).data}}const ud=ci(Sn.AUTHENTICATE),dd=s=>bn(s,Te.AUTHORIZE,Il),hd=s=>bn(s,Te.CAPTURE_LOG,Gi),pd=s=>bn(s,Te.ENCOURAGE_HW_ACCELERATION,Rl),gd=s=>bn(s,Te.GET_ENTITLEMENTS_EMBEDDED,Al),md=s=>bn(s,Te.GET_SKUS_EMBEDDED,Sl),yd=s=>bn(s,Te.GET_CHANNEL_PERMISSIONS,Nl),Ed=s=>bn(s,Te.GET_PLATFORM_BEHAVIORS,Cl),bd=s=>bn(s,Te.OPEN_EXTERNAL_LINK,Pl),vd=s=>bn(s,Te.OPEN_INVITE_DIALOG,Gi),_d=ci(Sn.OPEN_SHARE_MOMENT_DIALOG);Zr.pick({state:!0,details:!0,timestamps:!0,assets:!0,party:!0,secrets:!0,instance:!0,type:!0}).extend({type:Zr.shape.type.optional(),instance:Zr.shape.instance.optional()}).nullable();const wd=s=>bn(s,Te.SET_ACTIVITY,Tl),Id=s=>bn(s,Te.SET_CONFIG,xl);function Td({sendCommand:s,cmd:t,response:e,fallbackTransform:r,transferTransform:a=()=>{}}){const l=Rr.extend({cmd:$t(t),data:e});return async u=>{try{const d=await s({cmd:t,args:u,transfer:a(u)});return l.parse(d).data}catch(d){if(d.code===Aa.INVALID_PAYLOAD){const y=r(u),g=await s({cmd:t,args:y,transfer:a(y)});return l.parse(g).data}else throw d}}}const Sd=s=>({lock_state:s.lock_state,picture_in_picture_lock_state:s.picture_in_picture_lock_state}),Ad=s=>Td({sendCommand:s,cmd:Te.SET_ORIENTATION_LOCK_STATE,response:Gi,fallbackTransform:Sd}),Od=ci(Sn.SHARE_LINK),xd=s=>bn(s,Te.START_PURCHASE,Ol),Dd=s=>bn(s,Te.USER_SETTINGS_GET_LOCALE,Dl),Rd=ci(Sn.INITIATE_IMAGE_UPLOAD),Nd=s=>bn(s,Te.GET_CHANNEL,Or),Pd=ci(Sn.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS);function Cd(s){return{authenticate:ud(s),authorize:dd(s),captureLog:hd(s),encourageHardwareAcceleration:pd(s),getChannel:Nd(s),getChannelPermissions:yd(s),getEntitlements:gd(s),getPlatformBehaviors:Ed(s),getSkus:md(s),openExternalLink:bd(s),openInviteDialog:vd(s),openShareMomentDialog:_d(s),setActivity:wd(s),setConfig:Id(s),setOrientationLockState:Ad(s),shareLink:Od(s),startPurchase:xd(s),userSettingsGetLocale:Dd(s),initiateImageUpload:Rd(s),getInstanceConnectedParticipants:Pd(s)}}class Ld extends Error{constructor(t,e=""){super(e),this.code=t,this.message=e,this.name="Discord SDK Error"}}function Ll(){return{disableConsoleLogOverride:!1}}const kd=["log","warn","debug","info","error"];function Bd(s,t,e){const r=s[t],a=s;r&&(s[t]=function(){const l=[].slice.call(arguments),u=""+l.join(" ");e(t,u),r.apply(a,l)})}var $d="1.9.0",Md=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),To={randomUUID:Md},_i,Ud=new Uint8Array(16);function Fd(){if(!_i&&(_i=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _i(Ud)}var Wt=[];for(var la=0;la<256;++la)Wt.push((la+256).toString(16).slice(1));function Vd(s,t=0){return(Wt[s[t+0]]+Wt[s[t+1]]+Wt[s[t+2]]+Wt[s[t+3]]+"-"+Wt[s[t+4]]+Wt[s[t+5]]+"-"+Wt[s[t+6]]+Wt[s[t+7]]+"-"+Wt[s[t+8]]+Wt[s[t+9]]+"-"+Wt[s[t+10]]+Wt[s[t+11]]+Wt[s[t+12]]+Wt[s[t+13]]+Wt[s[t+14]]+Wt[s[t+15]]).toLowerCase()}function So(s,t,e){if(To.randomUUID&&!s)return To.randomUUID();s=s||{};var r=s.random||(s.rng||Fd)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Vd(r)}var ws;(function(s){s[s.HANDSHAKE=0]="HANDSHAKE",s[s.FRAME=1]="FRAME",s[s.CLOSE=2]="CLOSE",s[s.HELLO=3]="HELLO"})(ws||(ws={}));const jd=new Set(Hd());function Hd(){return typeof window>"u"?[]:[window.location.origin,"https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]}function Gd(){var s;return[(s=window.parent.opener)!==null&&s!==void 0?s:window.parent,document.referrer?document.referrer:"*"]}class Zd{getTransfer(t){var e;switch(t.cmd){case Te.SUBSCRIBE:case Te.UNSUBSCRIBE:return;default:return(e=t.transfer)!==null&&e!==void 0?e:void 0}}constructor(t,e){if(this.sdkVersion=$d,this.mobileAppVersion=null,this.source=null,this.sourceOrigin="",this.eventBus=new Xo,this.pendingCommands=new Map,this.sendCommand=d=>{var y;if(this.source==null)throw new Error("Attempting to send message before initialization");const g=So();return(y=this.source)===null||y===void 0||y.postMessage([ws.FRAME,Object.assign(Object.assign({},d),{nonce:g})],this.sourceOrigin,this.getTransfer(d)),new Promise((h,T)=>{this.pendingCommands.set(g,{resolve:h,reject:T})})},this.commands=Cd(this.sendCommand),this.handleMessage=d=>{if(!jd.has(d.origin))return;const y=d.data;if(!Array.isArray(y))return;const[g,E]=y;switch(g){case ws.HELLO:return;case ws.CLOSE:return this.handleClose(E);case ws.HANDSHAKE:return this.handleHandshake();case ws.FRAME:return this.handleFrame(E);default:throw new Error("Invalid message format")}},this.isReady=!1,this.clientId=t,this.configuration=e??Ll(),typeof window<"u"&&window.addEventListener("message",this.handleMessage),typeof window>"u"){this.frameId="",this.instanceId="",this.customId=null,this.referrerId=null,this.platform=Qn.DESKTOP,this.guildId=null,this.channelId=null,this.locationId=null;return}const r=new URLSearchParams(this._getSearch()),a=r.get("frame_id");if(!a)throw new Error("frame_id query param is not defined");this.frameId=a;const l=r.get("instance_id");if(!l)throw new Error("instance_id query param is not defined");this.instanceId=l;const u=r.get("platform");if(u){if(u!==Qn.DESKTOP&&u!==Qn.MOBILE)throw new Error(`Invalid query param "platform" of "${u}". Valid values are "${Qn.DESKTOP}" or "${Qn.MOBILE}"`)}else throw new Error("platform query param is not defined");this.platform=u,this.customId=r.get("custom_id"),this.referrerId=r.get("referrer_id"),this.guildId=r.get("guild_id"),this.channelId=r.get("channel_id"),this.locationId=r.get("location_id"),this.mobileAppVersion=r.get("mobile_app_version"),[this.source,this.sourceOrigin]=Gd(),this.addOnReadyListener(),this.handshake()}close(t,e){var r;window.removeEventListener("message",this.handleMessage);const a=So();(r=this.source)===null||r===void 0||r.postMessage([ws.CLOSE,{code:t,message:e,nonce:a}],this.sourceOrigin)}async subscribe(t,e,...r){const[a]=r,l=this.eventBus.listenerCount(t),u=this.eventBus.on(t,e);return Object.values(at).includes(t)&&t!==at.READY&&l===0&&await this.sendCommand({cmd:Te.SUBSCRIBE,args:a,evt:t}),u}async unsubscribe(t,e,...r){const[a]=r;return t!==at.READY&&this.eventBus.listenerCount(t)===1&&await this.sendCommand({cmd:Te.UNSUBSCRIBE,evt:t,args:a}),this.eventBus.off(t,e)}async ready(){this.isReady||await new Promise(t=>{this.eventBus.once(at.READY,t)})}parseMajorMobileVersion(){if(this.mobileAppVersion&&this.mobileAppVersion.includes("."))try{return parseInt(this.mobileAppVersion.split(".")[0])}catch{return vo}return vo}handshake(){var t;const e={v:1,encoding:"json",client_id:this.clientId,frame_id:this.frameId},r=this.parseMajorMobileVersion();(this.platform===Qn.DESKTOP||r>=lu)&&(e.sdk_version=this.sdkVersion),(t=this.source)===null||t===void 0||t.postMessage([ws.HANDSHAKE,e],this.sourceOrigin)}addOnReadyListener(){this.eventBus.once(at.READY,()=>{this.overrideConsoleLogging(),this.isReady=!0})}overrideConsoleLogging(){if(this.configuration.disableConsoleLogOverride)return;const t=(e,r)=>{this.commands.captureLog({level:e,message:r})};kd.forEach(e=>{Bd(console,e,t)})}handleClose(t){ld.parse(t)}handleHandshake(){}handleFrame(t){var e,r;let a;try{a=fd(t)}catch(l){console.error("Failed to parse",t),console.error(l);return}if(a.cmd==="DISPATCH")this.eventBus.emit(a.evt,a.data);else{if(a.evt===Ka){if(a.nonce!=null){(e=this.pendingCommands.get(a.nonce))===null||e===void 0||e.reject(a.data),this.pendingCommands.delete(a.nonce);return}this.eventBus.emit("error",new Ld(a.data.code,a.data.message))}if(a.nonce==null){console.error("Missing nonce",t);return}(r=this.pendingCommands.get(a.nonce))===null||r===void 0||r.resolve(a),this.pendingCommands.delete(a.nonce)}}_getSearch(){return typeof window>"u"?"":window.location.search}}var Nr=1e9,zd={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Fl,bt=!0,Cn="[DecimalError] ",dr=Cn+"Invalid argument: ",qa=Cn+"Exponent out of range: ",Pr=Math.floor,fr=Math.pow,Wd=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,An,Vt=1e7,Et=7,kl=9007199254740991,Bi=Pr(kl/Et),Ee={};Ee.absoluteValue=Ee.abs=function(){var s=new this.constructor(this);return s.s&&(s.s=1),s};Ee.comparedTo=Ee.cmp=function(s){var t,e,r,a,l=this;if(s=new l.constructor(s),l.s!==s.s)return l.s||-s.s;if(l.e!==s.e)return l.e>s.e^l.s<0?1:-1;for(r=l.d.length,a=s.d.length,t=0,e=r<a?r:a;t<e;++t)if(l.d[t]!==s.d[t])return l.d[t]>s.d[t]^l.s<0?1:-1;return r===a?0:r>a^l.s<0?1:-1};Ee.decimalPlaces=Ee.dp=function(){var s=this,t=s.d.length-1,e=(t-s.e)*Et;if(t=s.d[t],t)for(;t%10==0;t/=10)e--;return e<0?0:e};Ee.dividedBy=Ee.div=function(s){return Is(this,new this.constructor(s))};Ee.dividedToIntegerBy=Ee.idiv=function(s){var t=this,e=t.constructor;return ht(Is(t,new e(s),0,1),e.precision)};Ee.equals=Ee.eq=function(s){return!this.cmp(s)};Ee.exponent=function(){return Pt(this)};Ee.greaterThan=Ee.gt=function(s){return this.cmp(s)>0};Ee.greaterThanOrEqualTo=Ee.gte=function(s){return this.cmp(s)>=0};Ee.isInteger=Ee.isint=function(){return this.e>this.d.length-2};Ee.isNegative=Ee.isneg=function(){return this.s<0};Ee.isPositive=Ee.ispos=function(){return this.s>0};Ee.isZero=function(){return this.s===0};Ee.lessThan=Ee.lt=function(s){return this.cmp(s)<0};Ee.lessThanOrEqualTo=Ee.lte=function(s){return this.cmp(s)<1};Ee.logarithm=Ee.log=function(s){var t,e=this,r=e.constructor,a=r.precision,l=a+5;if(s===void 0)s=new r(10);else if(s=new r(s),s.s<1||s.eq(An))throw Error(Cn+"NaN");if(e.s<1)throw Error(Cn+(e.s?"NaN":"-Infinity"));return e.eq(An)?new r(0):(bt=!1,t=Is(oi(e,l),oi(s,l),l),bt=!0,ht(t,a))};Ee.minus=Ee.sub=function(s){var t=this;return s=new t.constructor(s),t.s==s.s?Ml(t,s):Bl(t,(s.s=-s.s,s))};Ee.modulo=Ee.mod=function(s){var t,e=this,r=e.constructor,a=r.precision;if(s=new r(s),!s.s)throw Error(Cn+"NaN");return e.s?(bt=!1,t=Is(e,s,0,1).times(s),bt=!0,e.minus(t)):ht(new r(e),a)};Ee.naturalExponential=Ee.exp=function(){return $l(this)};Ee.naturalLogarithm=Ee.ln=function(){return oi(this)};Ee.negated=Ee.neg=function(){var s=new this.constructor(this);return s.s=-s.s||0,s};Ee.plus=Ee.add=function(s){var t=this;return s=new t.constructor(s),t.s==s.s?Bl(t,s):Ml(t,(s.s=-s.s,s))};Ee.precision=Ee.sd=function(s){var t,e,r,a=this;if(s!==void 0&&s!==!!s&&s!==1&&s!==0)throw Error(dr+s);if(t=Pt(a)+1,r=a.d.length-1,e=r*Et+1,r=a.d[r],r){for(;r%10==0;r/=10)e--;for(r=a.d[0];r>=10;r/=10)e++}return s&&t>e?t:e};Ee.squareRoot=Ee.sqrt=function(){var s,t,e,r,a,l,u,d=this,y=d.constructor;if(d.s<1){if(!d.s)return new y(0);throw Error(Cn+"NaN")}for(s=Pt(d),bt=!1,a=Math.sqrt(+d),a==0||a==1/0?(t=ts(d.d),(t.length+s)%2==0&&(t+="0"),a=Math.sqrt(t),s=Pr((s+1)/2)-(s<0||s%2),a==1/0?t="5e"+s:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+s),r=new y(t)):r=new y(a.toString()),e=y.precision,a=u=e+3;;)if(l=r,r=l.plus(Is(d,l,u+2)).times(.5),ts(l.d).slice(0,u)===(t=ts(r.d)).slice(0,u)){if(t=t.slice(u-3,u+1),a==u&&t=="4999"){if(ht(l,e+1,0),l.times(l).eq(d)){r=l;break}}else if(t!="9999")break;u+=4}return bt=!0,ht(r,e)};Ee.times=Ee.mul=function(s){var t,e,r,a,l,u,d,y,g,E=this,h=E.constructor,T=E.d,M=(s=new h(s)).d;if(!E.s||!s.s)return new h(0);for(s.s*=E.s,e=E.e+s.e,y=T.length,g=M.length,y<g&&(l=T,T=M,M=l,u=y,y=g,g=u),l=[],u=y+g,r=u;r--;)l.push(0);for(r=g;--r>=0;){for(t=0,a=y+r;a>r;)d=l[a]+M[r]*T[a-r-1]+t,l[a--]=d%Vt|0,t=d/Vt|0;l[a]=(l[a]+t)%Vt|0}for(;!l[--u];)l.pop();return t?++e:l.shift(),s.d=l,s.e=e,bt?ht(s,h.precision):s};Ee.toDecimalPlaces=Ee.todp=function(s,t){var e=this,r=e.constructor;return e=new r(e),s===void 0?e:(as(s,0,Nr),t===void 0?t=r.rounding:as(t,0,8),ht(e,s+Pt(e)+1,t))};Ee.toExponential=function(s,t){var e,r=this,a=r.constructor;return s===void 0?e=gr(r,!0):(as(s,0,Nr),t===void 0?t=a.rounding:as(t,0,8),r=ht(new a(r),s+1,t),e=gr(r,!0,s+1)),e};Ee.toFixed=function(s,t){var e,r,a=this,l=a.constructor;return s===void 0?gr(a):(as(s,0,Nr),t===void 0?t=l.rounding:as(t,0,8),r=ht(new l(a),s+Pt(a)+1,t),e=gr(r.abs(),!1,s+Pt(r)+1),a.isneg()&&!a.isZero()?"-"+e:e)};Ee.toInteger=Ee.toint=function(){var s=this,t=s.constructor;return ht(new t(s),Pt(s)+1,t.rounding)};Ee.toNumber=function(){return+this};Ee.toPower=Ee.pow=function(s){var t,e,r,a,l,u,d=this,y=d.constructor,g=12,E=+(s=new y(s));if(!s.s)return new y(An);if(d=new y(d),!d.s){if(s.s<1)throw Error(Cn+"Infinity");return d}if(d.eq(An))return d;if(r=y.precision,s.eq(An))return ht(d,r);if(t=s.e,e=s.d.length-1,u=t>=e,l=d.s,u){if((e=E<0?-E:E)<=kl){for(a=new y(An),t=Math.ceil(r/Et+4),bt=!1;e%2&&(a=a.times(d),Oo(a.d,t)),e=Pr(e/2),e!==0;)d=d.times(d),Oo(d.d,t);return bt=!0,s.s<0?new y(An).div(a):ht(a,r)}}else if(l<0)throw Error(Cn+"NaN");return l=l<0&&s.d[Math.max(t,e)]&1?-1:1,d.s=1,bt=!1,a=s.times(oi(d,r+g)),bt=!0,a=$l(a),a.s=l,a};Ee.toPrecision=function(s,t){var e,r,a=this,l=a.constructor;return s===void 0?(e=Pt(a),r=gr(a,e<=l.toExpNeg||e>=l.toExpPos)):(as(s,1,Nr),t===void 0?t=l.rounding:as(t,0,8),a=ht(new l(a),s,t),e=Pt(a),r=gr(a,s<=e||e<=l.toExpNeg,s)),r};Ee.toSignificantDigits=Ee.tosd=function(s,t){var e=this,r=e.constructor;return s===void 0?(s=r.precision,t=r.rounding):(as(s,1,Nr),t===void 0?t=r.rounding:as(t,0,8)),ht(new r(e),s,t)};Ee.toString=Ee.valueOf=Ee.val=Ee.toJSON=Ee[Symbol.for("nodejs.util.inspect.custom")]=function(){var s=this,t=Pt(s),e=s.constructor;return gr(s,t<=e.toExpNeg||t>=e.toExpPos)};function Bl(s,t){var e,r,a,l,u,d,y,g,E=s.constructor,h=E.precision;if(!s.s||!t.s)return t.s||(t=new E(s)),bt?ht(t,h):t;if(y=s.d,g=t.d,u=s.e,a=t.e,y=y.slice(),l=u-a,l){for(l<0?(r=y,l=-l,d=g.length):(r=g,a=u,d=y.length),u=Math.ceil(h/Et),d=u>d?u+1:d+1,l>d&&(l=d,r.length=1),r.reverse();l--;)r.push(0);r.reverse()}for(d=y.length,l=g.length,d-l<0&&(l=d,r=g,g=y,y=r),e=0;l;)e=(y[--l]=y[l]+g[l]+e)/Vt|0,y[l]%=Vt;for(e&&(y.unshift(e),++a),d=y.length;y[--d]==0;)y.pop();return t.d=y,t.e=a,bt?ht(t,h):t}function as(s,t,e){if(s!==~~s||s<t||s>e)throw Error(dr+s)}function ts(s){var t,e,r,a=s.length-1,l="",u=s[0];if(a>0){for(l+=u,t=1;t<a;t++)r=s[t]+"",e=Et-r.length,e&&(l+=Ns(e)),l+=r;u=s[t],r=u+"",e=Et-r.length,e&&(l+=Ns(e))}else if(u===0)return"0";for(;u%10===0;)u/=10;return l+u}var Is=function(){function s(r,a){var l,u=0,d=r.length;for(r=r.slice();d--;)l=r[d]*a+u,r[d]=l%Vt|0,u=l/Vt|0;return u&&r.unshift(u),r}function t(r,a,l,u){var d,y;if(l!=u)y=l>u?1:-1;else for(d=y=0;d<l;d++)if(r[d]!=a[d]){y=r[d]>a[d]?1:-1;break}return y}function e(r,a,l){for(var u=0;l--;)r[l]-=u,u=r[l]<a[l]?1:0,r[l]=u*Vt+r[l]-a[l];for(;!r[0]&&r.length>1;)r.shift()}return function(r,a,l,u){var d,y,g,E,h,T,M,J,F,z,ce,ge,ie,be,Fe,st,ot,vt,lt=r.constructor,Ht=r.s==a.s?1:-1,Qe=r.d,Ve=a.d;if(!r.s)return new lt(r);if(!a.s)throw Error(Cn+"Division by zero");for(y=r.e-a.e,ot=Ve.length,Fe=Qe.length,M=new lt(Ht),J=M.d=[],g=0;Ve[g]==(Qe[g]||0);)++g;if(Ve[g]>(Qe[g]||0)&&--y,l==null?ge=l=lt.precision:u?ge=l+(Pt(r)-Pt(a))+1:ge=l,ge<0)return new lt(0);if(ge=ge/Et+2|0,g=0,ot==1)for(E=0,Ve=Ve[0],ge++;(g<Fe||E)&&ge--;g++)ie=E*Vt+(Qe[g]||0),J[g]=ie/Ve|0,E=ie%Ve|0;else{for(E=Vt/(Ve[0]+1)|0,E>1&&(Ve=s(Ve,E),Qe=s(Qe,E),ot=Ve.length,Fe=Qe.length),be=ot,F=Qe.slice(0,ot),z=F.length;z<ot;)F[z++]=0;vt=Ve.slice(),vt.unshift(0),st=Ve[0],Ve[1]>=Vt/2&&++st;do E=0,d=t(Ve,F,ot,z),d<0?(ce=F[0],ot!=z&&(ce=ce*Vt+(F[1]||0)),E=ce/st|0,E>1?(E>=Vt&&(E=Vt-1),h=s(Ve,E),T=h.length,z=F.length,d=t(h,F,T,z),d==1&&(E--,e(h,ot<T?vt:Ve,T))):(E==0&&(d=E=1),h=Ve.slice()),T=h.length,T<z&&h.unshift(0),e(F,h,z),d==-1&&(z=F.length,d=t(Ve,F,ot,z),d<1&&(E++,e(F,ot<z?vt:Ve,z))),z=F.length):d===0&&(E++,F=[0]),J[g++]=E,d&&F[0]?F[z++]=Qe[be]||0:(F=[Qe[be]],z=1);while((be++<Fe||F[0]!==void 0)&&ge--)}return J[0]||J.shift(),M.e=y,ht(M,u?l+Pt(M)+1:l)}}();function $l(s,t){var e,r,a,l,u,d,y=0,g=0,E=s.constructor,h=E.precision;if(Pt(s)>16)throw Error(qa+Pt(s));if(!s.s)return new E(An);for(bt=!1,d=h,u=new E(.03125);s.abs().gte(.1);)s=s.times(u),g+=5;for(r=Math.log(fr(2,g))/Math.LN10*2+5|0,d+=r,e=a=l=new E(An),E.precision=d;;){if(a=ht(a.times(s),d),e=e.times(++y),u=l.plus(Is(a,e,d)),ts(u.d).slice(0,d)===ts(l.d).slice(0,d)){for(;g--;)l=ht(l.times(l),d);return E.precision=h,t==null?(bt=!0,ht(l,h)):l}l=u}}function Pt(s){for(var t=s.e*Et,e=s.d[0];e>=10;e/=10)t++;return t}function ca(s,t,e){if(t>s.LN10.sd())throw bt=!0,e&&(s.precision=e),Error(Cn+"LN10 precision limit exceeded");return ht(new s(s.LN10),t)}function Ns(s){for(var t="";s--;)t+="0";return t}function oi(s,t){var e,r,a,l,u,d,y,g,E,h=1,T=10,M=s,J=M.d,F=M.constructor,z=F.precision;if(M.s<1)throw Error(Cn+(M.s?"NaN":"-Infinity"));if(M.eq(An))return new F(0);if(t==null?(bt=!1,g=z):g=t,M.eq(10))return t==null&&(bt=!0),ca(F,g);if(g+=T,F.precision=g,e=ts(J),r=e.charAt(0),l=Pt(M),Math.abs(l)<15e14){for(;r<7&&r!=1||r==1&&e.charAt(1)>3;)M=M.times(s),e=ts(M.d),r=e.charAt(0),h++;l=Pt(M),r>1?(M=new F("0."+e),l++):M=new F(r+"."+e.slice(1))}else return y=ca(F,g+2,z).times(l+""),M=oi(new F(r+"."+e.slice(1)),g-T).plus(y),F.precision=z,t==null?(bt=!0,ht(M,z)):M;for(d=u=M=Is(M.minus(An),M.plus(An),g),E=ht(M.times(M),g),a=3;;){if(u=ht(u.times(E),g),y=d.plus(Is(u,new F(a),g)),ts(y.d).slice(0,g)===ts(d.d).slice(0,g))return d=d.times(2),l!==0&&(d=d.plus(ca(F,g+2,z).times(l+""))),d=Is(d,new F(h),g),F.precision=z,t==null?(bt=!0,ht(d,z)):d;d=y,a+=2}}function Ao(s,t){var e,r,a;for((e=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(e<0&&(e=r),e+=+t.slice(r+1),t=t.substring(0,r)):e<0&&(e=t.length),r=0;t.charCodeAt(r)===48;)++r;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(r,a),t){if(a-=r,e=e-r-1,s.e=Pr(e/Et),s.d=[],r=(e+1)%Et,e<0&&(r+=Et),r<a){for(r&&s.d.push(+t.slice(0,r)),a-=Et;r<a;)s.d.push(+t.slice(r,r+=Et));t=t.slice(r),r=Et-t.length}else r-=a;for(;r--;)t+="0";if(s.d.push(+t),bt&&(s.e>Bi||s.e<-Bi))throw Error(qa+e)}else s.s=0,s.e=0,s.d=[0];return s}function ht(s,t,e){var r,a,l,u,d,y,g,E,h=s.d;for(u=1,l=h[0];l>=10;l/=10)u++;if(r=t-u,r<0)r+=Et,a=t,g=h[E=0];else{if(E=Math.ceil((r+1)/Et),l=h.length,E>=l)return s;for(g=l=h[E],u=1;l>=10;l/=10)u++;r%=Et,a=r-Et+u}if(e!==void 0&&(l=fr(10,u-a-1),d=g/l%10|0,y=t<0||h[E+1]!==void 0||g%l,y=e<4?(d||y)&&(e==0||e==(s.s<0?3:2)):d>5||d==5&&(e==4||y||e==6&&(r>0?a>0?g/fr(10,u-a):0:h[E-1])%10&1||e==(s.s<0?8:7))),t<1||!h[0])return y?(l=Pt(s),h.length=1,t=t-l-1,h[0]=fr(10,(Et-t%Et)%Et),s.e=Pr(-t/Et)||0):(h.length=1,h[0]=s.e=s.s=0),s;if(r==0?(h.length=E,l=1,E--):(h.length=E+1,l=fr(10,Et-r),h[E]=a>0?(g/fr(10,u-a)%fr(10,a)|0)*l:0),y)for(;;)if(E==0){(h[0]+=l)==Vt&&(h[0]=1,++s.e);break}else{if(h[E]+=l,h[E]!=Vt)break;h[E--]=0,l=1}for(r=h.length;h[--r]===0;)h.pop();if(bt&&(s.e>Bi||s.e<-Bi))throw Error(qa+Pt(s));return s}function Ml(s,t){var e,r,a,l,u,d,y,g,E,h,T=s.constructor,M=T.precision;if(!s.s||!t.s)return t.s?t.s=-t.s:t=new T(s),bt?ht(t,M):t;if(y=s.d,h=t.d,r=t.e,g=s.e,y=y.slice(),u=g-r,u){for(E=u<0,E?(e=y,u=-u,d=h.length):(e=h,r=g,d=y.length),a=Math.max(Math.ceil(M/Et),d)+2,u>a&&(u=a,e.length=1),e.reverse(),a=u;a--;)e.push(0);e.reverse()}else{for(a=y.length,d=h.length,E=a<d,E&&(d=a),a=0;a<d;a++)if(y[a]!=h[a]){E=y[a]<h[a];break}u=0}for(E&&(e=y,y=h,h=e,t.s=-t.s),d=y.length,a=h.length-d;a>0;--a)y[d++]=0;for(a=h.length;a>u;){if(y[--a]<h[a]){for(l=a;l&&y[--l]===0;)y[l]=Vt-1;--y[l],y[a]+=Vt}y[a]-=h[a]}for(;y[--d]===0;)y.pop();for(;y[0]===0;y.shift())--r;return y[0]?(t.d=y,t.e=r,bt?ht(t,M):t):new T(0)}function gr(s,t,e){var r,a=Pt(s),l=ts(s.d),u=l.length;return t?(e&&(r=e-u)>0?l=l.charAt(0)+"."+l.slice(1)+Ns(r):u>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(a<0?"e":"e+")+a):a<0?(l="0."+Ns(-a-1)+l,e&&(r=e-u)>0&&(l+=Ns(r))):a>=u?(l+=Ns(a+1-u),e&&(r=e-a-1)>0&&(l=l+"."+Ns(r))):((r=a+1)<u&&(l=l.slice(0,r)+"."+l.slice(r)),e&&(r=e-u)>0&&(a+1===u&&(l+="."),l+=Ns(r))),s.s<0?"-"+l:l}function Oo(s,t){if(s.length>t)return s.length=t,!0}function Ul(s){var t,e,r;function a(l){var u=this;if(!(u instanceof a))return new a(l);if(u.constructor=a,l instanceof a){u.s=l.s,u.e=l.e,u.d=(l=l.d)?l.slice():l;return}if(typeof l=="number"){if(l*0!==0)throw Error(dr+l);if(l>0)u.s=1;else if(l<0)l=-l,u.s=-1;else{u.s=0,u.e=0,u.d=[0];return}if(l===~~l&&l<1e7){u.e=0,u.d=[l];return}return Ao(u,l.toString())}else if(typeof l!="string")throw Error(dr+l);if(l.charCodeAt(0)===45?(l=l.slice(1),u.s=-1):u.s=1,Wd.test(l))Ao(u,l);else throw Error(dr+l)}if(a.prototype=Ee,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=Ul,a.config=a.set=Kd,s===void 0&&(s={}),s)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<r.length;)s.hasOwnProperty(e=r[t++])||(s[e]=this[e]);return a.config(s),a}function Kd(s){if(!s||typeof s!="object")throw Error(Cn+"Object expected");var t,e,r,a=["precision",1,Nr,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((r=s[e=a[t]])!==void 0)if(Pr(r)===r&&r>=a[t+1]&&r<=a[t+2])this[e]=r;else throw Error(dr+e+": "+r);if((r=s[e="LN10"])!==void 0)if(r==Math.LN10)this[e]=new this(r);else throw Error(dr+e+": "+r);return this}var Fl=Ul(zd);An=new Fl(1);var L;(function(s){s.AED="aed",s.AFN="afn",s.ALL="all",s.AMD="amd",s.ANG="ang",s.AOA="aoa",s.ARS="ars",s.AUD="aud",s.AWG="awg",s.AZN="azn",s.BAM="bam",s.BBD="bbd",s.BDT="bdt",s.BGN="bgn",s.BHD="bhd",s.BIF="bif",s.BMD="bmd",s.BND="bnd",s.BOB="bob",s.BOV="bov",s.BRL="brl",s.BSD="bsd",s.BTN="btn",s.BWP="bwp",s.BYN="byn",s.BYR="byr",s.BZD="bzd",s.CAD="cad",s.CDF="cdf",s.CHE="che",s.CHF="chf",s.CHW="chw",s.CLF="clf",s.CLP="clp",s.CNY="cny",s.COP="cop",s.COU="cou",s.CRC="crc",s.CUC="cuc",s.CUP="cup",s.CVE="cve",s.CZK="czk",s.DJF="djf",s.DKK="dkk",s.DOP="dop",s.DZD="dzd",s.EGP="egp",s.ERN="ern",s.ETB="etb",s.EUR="eur",s.FJD="fjd",s.FKP="fkp",s.GBP="gbp",s.GEL="gel",s.GHS="ghs",s.GIP="gip",s.GMD="gmd",s.GNF="gnf",s.GTQ="gtq",s.GYD="gyd",s.HKD="hkd",s.HNL="hnl",s.HRK="hrk",s.HTG="htg",s.HUF="huf",s.IDR="idr",s.ILS="ils",s.INR="inr",s.IQD="iqd",s.IRR="irr",s.ISK="isk",s.JMD="jmd",s.JOD="jod",s.JPY="jpy",s.KES="kes",s.KGS="kgs",s.KHR="khr",s.KMF="kmf",s.KPW="kpw",s.KRW="krw",s.KWD="kwd",s.KYD="kyd",s.KZT="kzt",s.LAK="lak",s.LBP="lbp",s.LKR="lkr",s.LRD="lrd",s.LSL="lsl",s.LTL="ltl",s.LVL="lvl",s.LYD="lyd",s.MAD="mad",s.MDL="mdl",s.MGA="mga",s.MKD="mkd",s.MMK="mmk",s.MNT="mnt",s.MOP="mop",s.MRO="mro",s.MUR="mur",s.MVR="mvr",s.MWK="mwk",s.MXN="mxn",s.MXV="mxv",s.MYR="myr",s.MZN="mzn",s.NAD="nad",s.NGN="ngn",s.NIO="nio",s.NOK="nok",s.NPR="npr",s.NZD="nzd",s.OMR="omr",s.PAB="pab",s.PEN="pen",s.PGK="pgk",s.PHP="php",s.PKR="pkr",s.PLN="pln",s.PYG="pyg",s.QAR="qar",s.RON="ron",s.RSD="rsd",s.RUB="rub",s.RWF="rwf",s.SAR="sar",s.SBD="sbd",s.SCR="scr",s.SDG="sdg",s.SEK="sek",s.SGD="sgd",s.SHP="shp",s.SLL="sll",s.SOS="sos",s.SRD="srd",s.SSP="ssp",s.STD="std",s.SVC="svc",s.SYP="syp",s.SZL="szl",s.THB="thb",s.TJS="tjs",s.TMT="tmt",s.TND="tnd",s.TOP="top",s.TRY="try",s.TTD="ttd",s.TWD="twd",s.TZS="tzs",s.UAH="uah",s.UGX="ugx",s.USD="usd",s.USN="usn",s.USS="uss",s.UYI="uyi",s.UYU="uyu",s.UZS="uzs",s.VEF="vef",s.VND="vnd",s.VUV="vuv",s.WST="wst",s.XAF="xaf",s.XAG="xag",s.XAU="xau",s.XBA="xba",s.XBB="xbb",s.XBC="xbc",s.XBD="xbd",s.XCD="xcd",s.XDR="xdr",s.XFU="xfu",s.XOF="xof",s.XPD="xpd",s.XPF="xpf",s.XPT="xpt",s.XSU="xsu",s.XTS="xts",s.XUA="xua",s.YER="yer",s.ZAR="zar",s.ZMW="zmw",s.ZWL="zwl"})(L||(L={}));L.AED+"",L.AFN+"",L.ALL+"",L.AMD+"",L.ANG+"",L.AOA+"",L.ARS+"",L.AUD+"",L.AWG+"",L.AZN+"",L.BAM+"",L.BBD+"",L.BDT+"",L.BGN+"",L.BHD+"",L.BIF+"",L.BMD+"",L.BND+"",L.BOB+"",L.BOV+"",L.BRL+"",L.BSD+"",L.BTN+"",L.BWP+"",L.BYR+"",L.BYN+"",L.BZD+"",L.CAD+"",L.CDF+"",L.CHE+"",L.CHF+"",L.CHW+"",L.CLF+"",L.CLP+"",L.CNY+"",L.COP+"",L.COU+"",L.CRC+"",L.CUC+"",L.CUP+"",L.CVE+"",L.CZK+"",L.DJF+"",L.DKK+"",L.DOP+"",L.DZD+"",L.EGP+"",L.ERN+"",L.ETB+"",L.EUR+"",L.FJD+"",L.FKP+"",L.GBP+"",L.GEL+"",L.GHS+"",L.GIP+"",L.GMD+"",L.GNF+"",L.GTQ+"",L.GYD+"",L.HKD+"",L.HNL+"",L.HRK+"",L.HTG+"",L.HUF+"",L.IDR+"",L.ILS+"",L.INR+"",L.IQD+"",L.IRR+"",L.ISK+"",L.JMD+"",L.JOD+"",L.JPY+"",L.KES+"",L.KGS+"",L.KHR+"",L.KMF+"",L.KPW+"",L.KRW+"",L.KWD+"",L.KYD+"",L.KZT+"",L.LAK+"",L.LBP+"",L.LKR+"",L.LRD+"",L.LSL+"",L.LTL+"",L.LVL+"",L.LYD+"",L.MAD+"",L.MDL+"",L.MGA+"",L.MKD+"",L.MMK+"",L.MNT+"",L.MOP+"",L.MRO+"",L.MUR+"",L.MVR+"",L.MWK+"",L.MXN+"",L.MXV+"",L.MYR+"",L.MZN+"",L.NAD+"",L.NGN+"",L.NIO+"",L.NOK+"",L.NPR+"",L.NZD+"",L.OMR+"",L.PAB+"",L.PEN+"",L.PGK+"",L.PHP+"",L.PKR+"",L.PLN+"",L.PYG+"",L.QAR+"",L.RON+"",L.RSD+"",L.RUB+"",L.RWF+"",L.SAR+"",L.SBD+"",L.SCR+"",L.SDG+"",L.SEK+"",L.SGD+"",L.SHP+"",L.SLL+"",L.SOS+"",L.SRD+"",L.SSP+"",L.STD+"",L.SVC+"",L.SYP+"",L.SZL+"",L.THB+"",L.TJS+"",L.TMT+"",L.TND+"",L.TOP+"",L.TRY+"",L.TTD+"",L.TWD+"",L.TZS+"",L.UAH+"",L.UGX+"",L.USD+"",L.USN+"",L.USS+"",L.UYI+"",L.UYU+"",L.UZS+"",L.VEF+"",L.VND+"",L.VUV+"",L.WST+"",L.XAF+"",L.XAG+"",L.XAU+"",L.XBA+"",L.XBB+"",L.XBC+"",L.XBD+"",L.XCD+"",L.XDR+"",L.XFU+"",L.XOF+"",L.XPD+"",L.XPF+"",L.XPT+"",L.XSU+"",L.XTS+"",L.XUA+"",L.YER+"",L.ZAR+"",L.ZMW+"",L.ZWL+"";var Gr={exports:{}};Gr.exports;var xo;function qd(){return xo||(xo=1,function(s,t){var e=200,r="Expected a function",a="__lodash_hash_undefined__",l=1,u=2,d=9007199254740991,y="[object Arguments]",g="[object Array]",E="[object Boolean]",h="[object Date]",T="[object Error]",M="[object Function]",J="[object GeneratorFunction]",F="[object Map]",z="[object Number]",ce="[object Object]",ge="[object Promise]",ie="[object RegExp]",be="[object Set]",Fe="[object String]",st="[object Symbol]",ot="[object WeakMap]",vt="[object ArrayBuffer]",lt="[object DataView]",Ht="[object Float32Array]",Qe="[object Float64Array]",Ve="[object Int8Array]",H="[object Int16Array]",se="[object Int32Array]",te="[object Uint8Array]",ee="[object Uint8ClampedArray]",ne="[object Uint16Array]",me="[object Uint32Array]",De=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ie=/^\w*$/,We=/^\./,Ge=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ut=/[\\^$.*+?()[\]{}|]/g,At=/\\(\\)?/g,Ct=/^\[object .+?Constructor\]$/,As=/^(?:0|[1-9]\d*)$/,Ke={};Ke[Ht]=Ke[Qe]=Ke[Ve]=Ke[H]=Ke[se]=Ke[te]=Ke[ee]=Ke[ne]=Ke[me]=!0,Ke[y]=Ke[g]=Ke[vt]=Ke[E]=Ke[lt]=Ke[h]=Ke[T]=Ke[M]=Ke[F]=Ke[z]=Ke[ce]=Ke[ie]=Ke[be]=Ke[Fe]=Ke[ot]=!1;var et=typeof Ei=="object"&&Ei&&Ei.Object===Object&&Ei,tn=typeof self=="object"&&self&&self.Object===Object&&self,ft=et||tn||Function("return this")(),cs=t&&!t.nodeType&&t,fs=cs&&!0&&s&&!s.nodeType&&s,us=fs&&fs.exports===cs,ds=us&&et.process,Wn=function(){try{return ds&&ds.binding("util")}catch{}}(),Kn=Wn&&Wn.isTypedArray;function nn(v,O){for(var W=-1,ae=v?v.length:0;++W<ae&&O(v[W],W,v)!==!1;);return v}function qn(v,O){for(var W=-1,ae=v?v.length:0;++W<ae;)if(O(v[W],W,v))return!0;return!1}function vn(v){return function(O){return O==null?void 0:O[v]}}function it(v,O){for(var W=-1,ae=Array(v);++W<v;)ae[W]=O(W);return ae}function Mt(v){return function(O){return v(O)}}function Yn(v,O){return v==null?void 0:v[O]}function Ln(v){var O=!1;if(v!=null&&typeof v.toString!="function")try{O=!!(v+"")}catch{}return O}function Se(v){var O=-1,W=Array(v.size);return v.forEach(function(ae,Be){W[++O]=[Be,ae]}),W}function qt(v,O){return function(W){return v(O(W))}}function b(v){var O=-1,W=Array(v.size);return v.forEach(function(ae){W[++O]=ae}),W}var I=Array.prototype,D=Function.prototype,P=Object.prototype,Z=ft["__core-js_shared__"],U=function(){var v=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),G=D.toString,K=P.hasOwnProperty,Q=P.toString,he=RegExp("^"+G.call(K).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xe=ft.Symbol,Re=ft.Uint8Array,Ae=qt(Object.getPrototypeOf,Object),xt=Object.create,Oe=P.propertyIsEnumerable,sn=I.splice,rt=qt(Object.keys,Object),hs=m(ft,"DataView"),qe=m(ft,"Map"),Gt=m(ft,"Promise"),kn=m(ft,"Set"),ps=m(ft,"WeakMap"),rn=m(Object,"create"),Zs=ye(hs),zs=ye(qe),gs=ye(Gt),Ws=ye(kn),Bn=ye(ps),Os=xe?xe.prototype:void 0,ms=Os?Os.valueOf:void 0,mr=Os?Os.toString:void 0;function Zt(v){var O=-1,W=v?v.length:0;for(this.clear();++O<W;){var ae=v[O];this.set(ae[0],ae[1])}}function Ks(){this.__data__=rn?rn(null):{}}function qs(v){return this.has(v)&&delete this.__data__[v]}function Cr(v){var O=this.__data__;if(rn){var W=O[v];return W===a?void 0:W}return K.call(O,v)?O[v]:void 0}function _t(v){var O=this.__data__;return rn?O[v]!==void 0:K.call(O,v)}function Ys(v,O){var W=this.__data__;return W[v]=rn&&O===void 0?a:O,this}Zt.prototype.clear=Ks,Zt.prototype.delete=qs,Zt.prototype.get=Cr,Zt.prototype.has=_t,Zt.prototype.set=Ys;function an(v){var O=-1,W=v?v.length:0;for(this.clear();++O<W;){var ae=v[O];this.set(ae[0],ae[1])}}function Lt(){this.__data__=[]}function Dt(v){var O=this.__data__,W=xs(O,v);if(W<0)return!1;var ae=O.length-1;return W==ae?O.pop():sn.call(O,W,1),!0}function Lr(v){var O=this.__data__,W=xs(O,v);return W<0?void 0:O[W][1]}function Xs(v){return xs(this.__data__,v)>-1}function mt(v,O){var W=this.__data__,ae=xs(W,v);return ae<0?W.push([v,O]):W[ae][1]=O,this}an.prototype.clear=Lt,an.prototype.delete=Dt,an.prototype.get=Lr,an.prototype.has=Xs,an.prototype.set=mt;function on(v){var O=-1,W=v?v.length:0;for(this.clear();++O<W;){var ae=v[O];this.set(ae[0],ae[1])}}function kr(){this.__data__={hash:new Zt,map:new(qe||an),string:new Zt}}function Br(v){return c(this,v).delete(v)}function Js(v){return c(this,v).get(v)}function $n(v){return c(this,v).has(v)}function $r(v,O){return c(this,v).set(v,O),this}on.prototype.clear=kr,on.prototype.delete=Br,on.prototype.get=Js,on.prototype.has=$n,on.prototype.set=$r;function Xn(v){var O=-1,W=v?v.length:0;for(this.__data__=new on;++O<W;)this.add(v[O])}function Qs(v){return this.__data__.set(v,a),this}function $e(v){return this.__data__.has(v)}Xn.prototype.add=Xn.prototype.push=Qs,Xn.prototype.has=$e;function ln(v){this.__data__=new an(v)}function er(){this.__data__=new an}function _n(v){return this.__data__.delete(v)}function tr(v){return this.__data__.get(v)}function nr(v){return this.__data__.has(v)}function wn(v,O){var W=this.__data__;if(W instanceof an){var ae=W.__data__;if(!qe||ae.length<e-1)return ae.push([v,O]),this;W=this.__data__=new on(ae)}return W.set(v,O),this}ln.prototype.clear=er,ln.prototype.delete=_n,ln.prototype.get=tr,ln.prototype.has=nr,ln.prototype.set=wn;function kt(v,O){var W=dt(v)||Ze(v)?it(v.length,String):[],ae=W.length,Be=!!ae;for(var ve in v)K.call(v,ve)&&!(Be&&(ve=="length"||S(ve,ae)))&&W.push(ve);return W}function xs(v,O){for(var W=v.length;W--;)if(Ye(v[W][0],O))return W;return-1}function Mn(v){return Er(v)?xt(v):{}}var sr=f();function rr(v,O){return v&&sr(v,O,pi)}function yr(v,O){O=x(O,v)?[O]:xn(O);for(var W=0,ae=O.length;v!=null&&W<ae;)v=v[Y(O[W++])];return W&&W==ae?v:void 0}function ys(v){return Q.call(v)}function cn(v,O){return v!=null&&O in Object(v)}function zt(v,O,W,ae,Be){return v===O?!0:v==null||O==null||!Er(v)&&!hi(O)?v!==v&&O!==O:fn(v,O,zt,W,ae,Be)}function fn(v,O,W,ae,Be,ve){var ze=dt(v),Rt=dt(O),Ot=g,Yt=g;ze||(Ot=_(v),Ot=Ot==y?ce:Ot),Rt||(Yt=_(O),Yt=Yt==y?ce:Yt);var yn=Ot==ce&&!Ln(v),En=Yt==ce&&!Ln(O),hn=Ot==Yt;if(hn&&!yn)return ve||(ve=new ln),ze||ho(v)?n(v,O,W,ae,Be,ve):i(v,O,Ot,W,ae,Be,ve);if(!(Be&u)){var Dn=yn&&K.call(v,"__wrapped__"),Rn=En&&K.call(O,"__wrapped__");if(Dn||Rn){var Ds=Dn?v.value():v,Es=Rn?O.value():O;return ve||(ve=new ln),W(Ds,Es,ae,Be,ve)}}return hn?(ve||(ve=new ln),o(v,O,W,ae,Be,ve)):!1}function Mr(v,O,W,ae){var Be=W.length,ve=Be;if(v==null)return!ve;for(v=Object(v);Be--;){var ze=W[Be];if(ze[2]?ze[1]!==v[ze[0]]:!(ze[0]in v))return!1}for(;++Be<ve;){ze=W[Be];var Rt=ze[0],Ot=v[Rt],Yt=ze[1];if(ze[2]){if(Ot===void 0&&!(Rt in v))return!1}else{var yn=new ln,En;if(!(En===void 0?zt(Yt,Ot,ae,l|u,yn):En))return!1}}return!0}function Ur(v){if(!Er(v)||R(v))return!1;var O=na(v)||Ln(v)?he:Ct;return O.test(ye(v))}function Fr(v){return hi(v)&&sa(v.length)&&!!Ke[Q.call(v)]}function wt(v){return typeof v=="function"?v:v==null?Yc:typeof v=="object"?dt(v)?In(v[0],v[1]):Bt(v):Xc(v)}function yt(v){if(!X(v))return rt(v);var O=[];for(var W in Object(v))K.call(v,W)&&W!="constructor"&&O.push(W);return O}function Bt(v){var O=p(v);return O.length==1&&O[0][2]?V(O[0][0],O[0][1]):function(W){return W===v||Mr(W,v,O)}}function In(v,O){return x(v)&&q(O)?V(Y(v),O):function(W){var ae=Wc(W,v);return ae===void 0&&ae===O?Kc(W,v):zt(O,ae,void 0,l|u)}}function un(v){return function(O){return yr(O,v)}}function dn(v){if(typeof v=="string")return v;if(ra(v))return mr?mr.call(v):"";var O=v+"";return O=="0"&&1/v==-1/0?"-0":O}function xn(v){return dt(v)?v:N(v)}function f(v){return function(O,W,ae){for(var Be=-1,ve=Object(O),ze=ae(O),Rt=ze.length;Rt--;){var Ot=ze[++Be];if(W(ve[Ot],Ot,ve)===!1)break}return O}}function n(v,O,W,ae,Be,ve){var ze=Be&u,Rt=v.length,Ot=O.length;if(Rt!=Ot&&!(ze&&Ot>Rt))return!1;var Yt=ve.get(v);if(Yt&&ve.get(O))return Yt==O;var yn=-1,En=!0,hn=Be&l?new Xn:void 0;for(ve.set(v,O),ve.set(O,v);++yn<Rt;){var Dn=v[yn],Rn=O[yn];if(ae)var Ds=ze?ae(Rn,Dn,yn,O,v,ve):ae(Dn,Rn,yn,v,O,ve);if(Ds!==void 0){if(Ds)continue;En=!1;break}if(hn){if(!qn(O,function(Es,ir){if(!hn.has(ir)&&(Dn===Es||W(Dn,Es,ae,Be,ve)))return hn.add(ir)})){En=!1;break}}else if(!(Dn===Rn||W(Dn,Rn,ae,Be,ve))){En=!1;break}}return ve.delete(v),ve.delete(O),En}function i(v,O,W,ae,Be,ve,ze){switch(W){case lt:if(v.byteLength!=O.byteLength||v.byteOffset!=O.byteOffset)return!1;v=v.buffer,O=O.buffer;case vt:return!(v.byteLength!=O.byteLength||!ae(new Re(v),new Re(O)));case E:case h:case z:return Ye(+v,+O);case T:return v.name==O.name&&v.message==O.message;case ie:case Fe:return v==O+"";case F:var Rt=Se;case be:var Ot=ve&u;if(Rt||(Rt=b),v.size!=O.size&&!Ot)return!1;var Yt=ze.get(v);if(Yt)return Yt==O;ve|=l,ze.set(v,O);var yn=n(Rt(v),Rt(O),ae,Be,ve,ze);return ze.delete(v),yn;case st:if(ms)return ms.call(v)==ms.call(O)}return!1}function o(v,O,W,ae,Be,ve){var ze=Be&u,Rt=pi(v),Ot=Rt.length,Yt=pi(O),yn=Yt.length;if(Ot!=yn&&!ze)return!1;for(var En=Ot;En--;){var hn=Rt[En];if(!(ze?hn in O:K.call(O,hn)))return!1}var Dn=ve.get(v);if(Dn&&ve.get(O))return Dn==O;var Rn=!0;ve.set(v,O),ve.set(O,v);for(var Ds=ze;++En<Ot;){hn=Rt[En];var Es=v[hn],ir=O[hn];if(ae)var po=ze?ae(ir,Es,hn,O,v,ve):ae(Es,ir,hn,v,O,ve);if(!(po===void 0?Es===ir||W(Es,ir,ae,Be,ve):po)){Rn=!1;break}Ds||(Ds=hn=="constructor")}if(Rn&&!Ds){var gi=v.constructor,mi=O.constructor;gi!=mi&&"constructor"in v&&"constructor"in O&&!(typeof gi=="function"&&gi instanceof gi&&typeof mi=="function"&&mi instanceof mi)&&(Rn=!1)}return ve.delete(v),ve.delete(O),Rn}function c(v,O){var W=v.__data__;return $(O)?W[typeof O=="string"?"string":"hash"]:W.map}function p(v){for(var O=pi(v),W=O.length;W--;){var ae=O[W],Be=v[ae];O[W]=[ae,Be,q(Be)]}return O}function m(v,O){var W=Yn(v,O);return Ur(W)?W:void 0}var _=ys;(hs&&_(new hs(new ArrayBuffer(1)))!=lt||qe&&_(new qe)!=F||Gt&&_(Gt.resolve())!=ge||kn&&_(new kn)!=be||ps&&_(new ps)!=ot)&&(_=function(v){var O=Q.call(v),W=O==ce?v.constructor:void 0,ae=W?ye(W):void 0;if(ae)switch(ae){case Zs:return lt;case zs:return F;case gs:return ge;case Ws:return be;case Bn:return ot}return O});function w(v,O,W){O=x(O,v)?[O]:xn(O);for(var ae,Be=-1,ze=O.length;++Be<ze;){var ve=Y(O[Be]);if(!(ae=v!=null&&W(v,ve)))break;v=v[ve]}if(ae)return ae;var ze=v?v.length:0;return!!ze&&sa(ze)&&S(ve,ze)&&(dt(v)||Ze(v))}function S(v,O){return O=O??d,!!O&&(typeof v=="number"||As.test(v))&&v>-1&&v%1==0&&v<O}function x(v,O){if(dt(v))return!1;var W=typeof v;return W=="number"||W=="symbol"||W=="boolean"||v==null||ra(v)?!0:Ie.test(v)||!De.test(v)||O!=null&&v in Object(O)}function $(v){var O=typeof v;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?v!=="__proto__":v===null}function R(v){return!!U&&U in v}function X(v){var O=v&&v.constructor,W=typeof O=="function"&&O.prototype||P;return v===W}function q(v){return v===v&&!Er(v)}function V(v,O){return function(W){return W==null?!1:W[v]===O&&(O!==void 0||v in Object(W))}}var N=Le(function(v){v=zc(v);var O=[];return We.test(v)&&O.push(""),v.replace(Ge,function(W,ae,Be,ve){O.push(Be?ve.replace(At,"$1"):ae||W)}),O});function Y(v){if(typeof v=="string"||ra(v))return v;var O=v+"";return O=="0"&&1/v==-1/0?"-0":O}function ye(v){if(v!=null){try{return G.call(v)}catch{}try{return v+""}catch{}}return""}function Le(v,O){if(typeof v!="function"||O&&typeof O!="function")throw new TypeError(r);var W=function(){var ae=arguments,Be=O?O.apply(this,ae):ae[0],ve=W.cache;if(ve.has(Be))return ve.get(Be);var ze=v.apply(this,ae);return W.cache=ve.set(Be,ze),ze};return W.cache=new(Le.Cache||on),W}Le.Cache=on;function Ye(v,O){return v===O||v!==v&&O!==O}function Ze(v){return Zc(v)&&K.call(v,"callee")&&(!Oe.call(v,"callee")||Q.call(v)==y)}var dt=Array.isArray;function uo(v){return v!=null&&sa(v.length)&&!na(v)}function Zc(v){return hi(v)&&uo(v)}function na(v){var O=Er(v)?Q.call(v):"";return O==M||O==J}function sa(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=d}function Er(v){var O=typeof v;return!!v&&(O=="object"||O=="function")}function hi(v){return!!v&&typeof v=="object"}function ra(v){return typeof v=="symbol"||hi(v)&&Q.call(v)==st}var ho=Kn?Mt(Kn):Fr;function zc(v){return v==null?"":dn(v)}function Wc(v,O,W){var ae=v==null?void 0:yr(v,O);return ae===void 0?W:ae}function Kc(v,O){return v!=null&&w(v,O,cn)}function pi(v){return uo(v)?kt(v):yt(v)}function qc(v,O,W){var ae=dt(v)||ho(v);if(O=wt(O),W==null)if(ae||Er(v)){var Be=v.constructor;ae?W=dt(v)?new Be:[]:W=na(Be)?Mn(Ae(v)):{}}else W={};return(ae?nn:rr)(v,function(ve,ze,Rt){return O(W,ve,ze,Rt)}),W}function Yc(v){return v}function Xc(v){return x(v)?vn(Y(v)):un(v)}s.exports=qc}(Gr,Gr.exports)),Gr.exports}var Yd=qd(),Xd=Ua(Yd);class Vl{constructor(t,e,r,a){this.platform=Qn.DESKTOP,this.instanceId="123456789012345678",this.configuration=Ll(),this.source=null,this.sourceOrigin="",this.sdkVersion="mock",this.mobileAppVersion="unknown",this.frameId="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",this.eventBus=new Xo,this.clientId=t,this.commands=this._updateCommandMocks({}),this.guildId=e,this.channelId=r,this.locationId=a,this.customId=null,this.referrerId=null}_updateCommandMocks(t){return this.commands=Xd(Object.assign({},Jd,t),(e,r,a)=>{e[a]=async(...l)=>(console.info(`DiscordSDKMock: ${String(a)}(${JSON.stringify(l)})`),await r(...l))}),this.commands}emitReady(){this.emitEvent("READY",void 0)}close(...t){console.info(`DiscordSDKMock: close(${JSON.stringify(t)})`)}ready(){return Promise.resolve()}async subscribe(t,e,...r){return await this.eventBus.on(t,e)}async unsubscribe(t,e,...r){return await this.eventBus.off(t,e)}emitEvent(t,e){this.eventBus.emit(t,e)}}const Jd={authorize:()=>Promise.resolve({code:"mock_code"}),authenticate:()=>Promise.resolve({access_token:"mock_token",user:{username:"mock_user_username",discriminator:"mock_user_discriminator",id:"mock_user_id",avatar:null,public_flags:1},scopes:[],expires:new Date(2121,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}}),setActivity:()=>Promise.resolve({name:"mock_activity_name",type:0}),getChannel:()=>Promise.resolve({id:"mock_channel_id",name:"mock_channel_name",type:za.GUILD_TEXT,voice_states:[],messages:[]}),getSkus:()=>Promise.resolve({skus:[]}),getEntitlements:()=>Promise.resolve({entitlements:[]}),startPurchase:()=>Promise.resolve([]),setConfig:()=>Promise.resolve({use_interactive_pip:!1}),userSettingsGetLocale:()=>Promise.resolve({locale:""}),openExternalLink:()=>Promise.resolve({opened:!1}),encourageHardwareAcceleration:()=>Promise.resolve({enabled:!0}),captureLog:()=>Promise.resolve(null),setOrientationLockState:()=>Promise.resolve(null),openInviteDialog:()=>Promise.resolve(null),getPlatformBehaviors:()=>Promise.resolve({iosKeyboardResizesView:!0}),getChannelPermissions:()=>Promise.resolve({permissions:ol(1234567890)}),openShareMomentDialog:()=>Promise.resolve(null),shareLink:()=>Promise.resolve({success:!1}),initiateImageUpload:()=>Promise.resolve({image_url:"https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0b52aa9e99b832574a53_full_logo_blurple_RGB.png"}),getInstanceConnectedParticipants:()=>Promise.resolve({participants:[]})};var Hn={};ArrayBuffer.isView||(ArrayBuffer.isView=s=>s!==null&&typeof s=="object"&&s.buffer instanceof ArrayBuffer);typeof FormData>"u"&&($a.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var Ya={},Da=function(s,t){return Da=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])},Da(s,t)};function jl(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Da(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var $i=function(){return $i=Object.assign||function(t){for(var e,r=1,a=arguments.length;r<a;r++){e=arguments[r];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(t[l]=e[l])}return t},$i.apply(this,arguments)};function Hl(s,t){var e={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(e[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(s);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(s,r[a])&&(e[r[a]]=s[r[a]]);return e}function Gl(s,t,e,r){var a=arguments.length,l=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(s,t,e,r);else for(var d=s.length-1;d>=0;d--)(u=s[d])&&(l=(a<3?u(l):a>3?u(t,e,l):u(t,e))||l);return a>3&&l&&Object.defineProperty(t,e,l),l}function Zl(s,t){return function(e,r){t(e,r,s)}}function zl(s,t,e,r,a,l){function u(ce){if(ce!==void 0&&typeof ce!="function")throw new TypeError("Function expected");return ce}for(var d=r.kind,y=d==="getter"?"get":d==="setter"?"set":"value",g=!t&&s?r.static?s:s.prototype:null,E=t||(g?Object.getOwnPropertyDescriptor(g,r.name):{}),h,T=!1,M=e.length-1;M>=0;M--){var J={};for(var F in r)J[F]=F==="access"?{}:r[F];for(var F in r.access)J.access[F]=r.access[F];J.addInitializer=function(ce){if(T)throw new TypeError("Cannot add initializers after decoration has completed");l.push(u(ce||null))};var z=(0,e[M])(d==="accessor"?{get:E.get,set:E.set}:E[y],J);if(d==="accessor"){if(z===void 0)continue;if(z===null||typeof z!="object")throw new TypeError("Object expected");(h=u(z.get))&&(E.get=h),(h=u(z.set))&&(E.set=h),(h=u(z.init))&&a.unshift(h)}else(h=u(z))&&(d==="field"?a.unshift(h):E[y]=h)}g&&Object.defineProperty(g,r.name,E),T=!0}function Wl(s,t,e){for(var r=arguments.length>2,a=0;a<t.length;a++)e=r?t[a].call(s,e):t[a].call(s);return r?e:void 0}function Kl(s){return typeof s=="symbol"?s:"".concat(s)}function ql(s,t,e){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:e?"".concat(e," ",t):t})}function Yl(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)}function Xl(s,t,e,r){function a(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function d(E){try{g(r.next(E))}catch(h){u(h)}}function y(E){try{g(r.throw(E))}catch(h){u(h)}}function g(E){E.done?l(E.value):a(E.value).then(d,y)}g((r=r.apply(s,t||[])).next())})}function Jl(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,a,l,u=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return u.next=d(0),u.throw=d(1),u.return=d(2),typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function d(g){return function(E){return y([g,E])}}function y(g){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,g[0]&&(e=0)),e;)try{if(r=1,a&&(l=g[0]&2?a.return:g[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,g[1])).done)return l;switch(a=0,l&&(g=[g[0]&2,l.value]),g[0]){case 0:case 1:l=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!l||g[1]>l[0]&&g[1]<l[3])){e.label=g[1];break}if(g[0]===6&&e.label<l[1]){e.label=l[1],l=g;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(g);break}l[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(s,e)}catch(E){g=[6,E],a=0}finally{r=l=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}var Zi=Object.create?function(s,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(s,r,a)}:function(s,t,e,r){r===void 0&&(r=e),s[r]=t[e]};function Ql(s,t){for(var e in s)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&Zi(t,s,e)}function Mi(s){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&s[t],r=0;if(e)return e.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&r>=s.length&&(s=void 0),{value:s&&s[r++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xa(s,t){var e=typeof Symbol=="function"&&s[Symbol.iterator];if(!e)return s;var r=e.call(s),a,l=[],u;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)l.push(a.value)}catch(d){u={error:d}}finally{try{a&&!a.done&&(e=r.return)&&e.call(r)}finally{if(u)throw u.error}}return l}function ec(){for(var s=[],t=0;t<arguments.length;t++)s=s.concat(Xa(arguments[t]));return s}function tc(){for(var s=0,t=0,e=arguments.length;t<e;t++)s+=arguments[t].length;for(var r=Array(s),a=0,t=0;t<e;t++)for(var l=arguments[t],u=0,d=l.length;u<d;u++,a++)r[a]=l[u];return r}function nc(s,t,e){if(e||arguments.length===2)for(var r=0,a=t.length,l;r<a;r++)(l||!(r in t))&&(l||(l=Array.prototype.slice.call(t,0,r)),l[r]=t[r]);return s.concat(l||Array.prototype.slice.call(t))}function xr(s){return this instanceof xr?(this.v=s,this):new xr(s)}function sc(s,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(s,t||[]),a,l=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",u),a[Symbol.asyncIterator]=function(){return this},a;function u(M){return function(J){return Promise.resolve(J).then(M,h)}}function d(M,J){r[M]&&(a[M]=function(F){return new Promise(function(z,ce){l.push([M,F,z,ce])>1||y(M,F)})},J&&(a[M]=J(a[M])))}function y(M,J){try{g(r[M](J))}catch(F){T(l[0][3],F)}}function g(M){M.value instanceof xr?Promise.resolve(M.value.v).then(E,h):T(l[0][2],M)}function E(M){y("next",M)}function h(M){y("throw",M)}function T(M,J){M(J),l.shift(),l.length&&y(l[0][0],l[0][1])}}function rc(s){var t,e;return t={},r("next"),r("throw",function(a){throw a}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(a,l){t[a]=s[a]?function(u){return(e=!e)?{value:xr(s[a](u)),done:!1}:l?l(u):u}:l}}function ic(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],e;return t?t.call(s):(s=typeof Mi=="function"?Mi(s):s[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(l){e[l]=s[l]&&function(u){return new Promise(function(d,y){u=s[l](u),a(d,y,u.done,u.value)})}}function a(l,u,d,y){Promise.resolve(y).then(function(g){l({value:g,done:d})},u)}}function ac(s,t){return Object.defineProperty?Object.defineProperty(s,"raw",{value:t}):s.raw=t,s}var Qd=Object.create?function(s,t){Object.defineProperty(s,"default",{enumerable:!0,value:t})}:function(s,t){s.default=t},Ra=function(s){return Ra=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},Ra(s)};function oc(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var e=Ra(s),r=0;r<e.length;r++)e[r]!=="default"&&Zi(t,s,e[r]);return Qd(t,s),t}function lc(s){return s&&s.__esModule?s:{default:s}}function fc(s,t,e,r){if(e==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!r:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?r:e==="a"?r.call(s):r?r.value:t.get(s)}function uc(s,t,e,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!a:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(s,e):a?a.value=e:t.set(s,e),e}function dc(s,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof s=="function"?t===s:s.has(t)}function hc(s,t,e){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,a;if(e){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],e&&(a=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");a&&(r=function(){try{a.call(this)}catch(l){return Promise.reject(l)}}),s.stack.push({value:t,dispose:r,async:e})}else e&&s.stack.push({async:!0});return t}var eh=typeof SuppressedError=="function"?SuppressedError:function(s,t,e){var r=new Error(e);return r.name="SuppressedError",r.error=s,r.suppressed=t,r};function pc(s){function t(l){s.error=s.hasError?new eh(l,s.error,"An error was suppressed during disposal."):l,s.hasError=!0}var e,r=0;function a(){for(;e=s.stack.pop();)try{if(!e.async&&r===1)return r=0,s.stack.push(e),Promise.resolve().then(a);if(e.dispose){var l=e.dispose.call(e.value);if(e.async)return r|=2,Promise.resolve(l).then(a,function(u){return t(u),a()})}else r|=1}catch(u){t(u)}if(r===1)return s.hasError?Promise.reject(s.error):Promise.resolve();if(s.hasError)throw s.error}return a()}function gc(s,t){return typeof s=="string"&&/^\.\.?\//.test(s)?s.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,r,a,l,u){return r?t?".jsx":".js":a&&(!l||!u)?e:a+l+"."+u.toLowerCase()+"js"}):s}const th={__extends:jl,__assign:$i,__rest:Hl,__decorate:Gl,__param:Zl,__esDecorate:zl,__runInitializers:Wl,__propKey:Kl,__setFunctionName:ql,__metadata:Yl,__awaiter:Xl,__generator:Jl,__createBinding:Zi,__exportStar:Ql,__values:Mi,__read:Xa,__spread:ec,__spreadArrays:tc,__spreadArray:nc,__await:xr,__asyncGenerator:sc,__asyncDelegator:rc,__asyncValues:ic,__makeTemplateObject:ac,__importStar:oc,__importDefault:lc,__classPrivateFieldGet:fc,__classPrivateFieldSet:uc,__classPrivateFieldIn:dc,__addDisposableResource:hc,__disposeResources:pc,__rewriteRelativeImportExtension:gc},nh=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:hc,get __assign(){return $i},__asyncDelegator:rc,__asyncGenerator:sc,__asyncValues:ic,__await:xr,__awaiter:Xl,__classPrivateFieldGet:fc,__classPrivateFieldIn:dc,__classPrivateFieldSet:uc,__createBinding:Zi,__decorate:Gl,__disposeResources:pc,__esDecorate:zl,__exportStar:Ql,__extends:jl,__generator:Jl,__importDefault:lc,__importStar:oc,__makeTemplateObject:ac,__metadata:Yl,__param:Zl,__propKey:Kl,__read:Xa,__rest:Hl,__rewriteRelativeImportExtension:gc,__runInitializers:Wl,__setFunctionName:ql,__spread:ec,__spreadArray:nc,__spreadArrays:tc,__values:Mi,default:th},Symbol.toStringTag,{value:"Module"})),zi=Ma(nh);var fi={};(function(s){s.CloseCode=void 0,function(e){e[e.CONSENTED=4e3]="CONSENTED",e[e.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(s.CloseCode||(s.CloseCode={}));class t extends Error{constructor(r,a){super(a),this.name="ServerError",this.code=r}}s.ServerError=t})(fi);var Ja={},mc={},yc={},Na={exports:{}};(function(s,t){(function(e,r){r(t)})($a,function(e){e.OPERATION=void 0,function(f){f[f.ADD=128]="ADD",f[f.REPLACE=0]="REPLACE",f[f.DELETE=64]="DELETE",f[f.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",f[f.MOVE_AND_ADD=160]="MOVE_AND_ADD",f[f.DELETE_AND_ADD=192]="DELETE_AND_ADD",f[f.CLEAR=10]="CLEAR",f[f.REVERSE=15]="REVERSE",f[f.MOVE=32]="MOVE",f[f.DELETE_BY_REFID=33]="DELETE_BY_REFID",f[f.ADD_BY_REFID=129]="ADD_BY_REFID"}(e.OPERATION||(e.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const l=Symbol("$track"),u=Symbol("$encoder"),d=Symbol("$decoder"),y=Symbol("$filter"),g=Symbol("$getByIndex"),E=Symbol("$deleteByIndex"),h=Symbol("$changes"),T=Symbol("$childType"),M=Symbol("$onEncodeEnd"),J=Symbol("$onDecodeEnd"),F=Symbol("$descriptors"),z="$__numFields",ce="$__refTypeFieldIndexes",ge="$__viewFieldIndexes",ie="$__fieldIndexesByViewTag";let be;try{be=new TextEncoder}catch{}const Fe=new ArrayBuffer(8),st=new Int32Array(Fe),ot=new Float32Array(Fe),vt=new Float64Array(Fe),lt=new BigInt64Array(Fe),Qe=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(f,n){for(var i=0,o=0,c=0,p=f.length;c<p;c++)i=f.charCodeAt(c),i<128?o+=1:i<2048?o+=2:i<55296||i>=57344?o+=3:(c++,o+=4);return o};function Ve(f,n,i){for(var o=0,c=0,p=n.length;c<p;c++)o=n.charCodeAt(c),o<128?f[i.offset++]=o:o<2048?(f[i.offset]=192|o>>6,f[i.offset+1]=128|o&63,i.offset+=2):o<55296||o>=57344?(f[i.offset]=224|o>>12,f[i.offset+1]=128|o>>6&63,f[i.offset+2]=128|o&63,i.offset+=3):(c++,o=65536+((o&1023)<<10|n.charCodeAt(c)&1023),f[i.offset]=240|o>>18,f[i.offset+1]=128|o>>12&63,f[i.offset+2]=128|o>>6&63,f[i.offset+3]=128|o&63,i.offset+=4)}function H(f,n,i){f[i.offset++]=n&255}function se(f,n,i){f[i.offset++]=n&255}function te(f,n,i){f[i.offset++]=n&255,f[i.offset++]=n>>8&255}function ee(f,n,i){f[i.offset++]=n&255,f[i.offset++]=n>>8&255}function ne(f,n,i){f[i.offset++]=n&255,f[i.offset++]=n>>8&255,f[i.offset++]=n>>16&255,f[i.offset++]=n>>24&255}function me(f,n,i){const o=n>>24,c=n>>16,p=n>>8,m=n;f[i.offset++]=m&255,f[i.offset++]=p&255,f[i.offset++]=c&255,f[i.offset++]=o&255}function De(f,n,i){const o=Math.floor(n/Math.pow(2,32)),c=n>>>0;me(f,c,i),me(f,o,i)}function Ie(f,n,i){const o=n/Math.pow(2,32)>>0,c=n>>>0;me(f,c,i),me(f,o,i)}function We(f,n,i){lt[0]=BigInt.asIntN(64,n),ne(f,st[0],i),ne(f,st[1],i)}function Ge(f,n,i){lt[0]=BigInt.asIntN(64,n),ne(f,st[0],i),ne(f,st[1],i)}function ut(f,n,i){ot[0]=n,ne(f,st[0],i)}function At(f,n,i){vt[0]=n,ne(f,st[0],i),ne(f,st[1],i)}function Ct(f,n,i){f[i.offset++]=n?1:0}function As(f,n,i){n||(n="");let o=Qe(n,"utf8"),c=0;if(o<32)f[i.offset++]=o|160,c=1;else if(o<256)f[i.offset++]=217,f[i.offset++]=o%255,c=2;else if(o<65536)f[i.offset++]=218,ee(f,o,i),c=3;else if(o<4294967296)f[i.offset++]=219,me(f,o,i),c=5;else throw new Error("String too long");return Ve(f,n,i),c+o}function Ke(f,n,i){if(isNaN(n))return Ke(f,0,i);if(isFinite(n)){if(n!==(n|0))return Math.abs(n)<=34028235e31&&(ot[0]=n,Math.abs(Math.abs(ot[0])-Math.abs(n))<1e-4)?(f[i.offset++]=202,ut(f,n,i),5):(f[i.offset++]=203,At(f,n,i),9)}else return Ke(f,n>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,i);return n>=0?n<128?(f[i.offset++]=n&255,1):n<256?(f[i.offset++]=204,f[i.offset++]=n&255,2):n<65536?(f[i.offset++]=205,ee(f,n,i),3):n<4294967296?(f[i.offset++]=206,me(f,n,i),5):(f[i.offset++]=207,Ie(f,n,i),9):n>=-32?(f[i.offset++]=224|n+32,1):n>=-128?(f[i.offset++]=208,H(f,n,i),2):n>=-32768?(f[i.offset++]=209,te(f,n,i),3):n>=-2147483648?(f[i.offset++]=210,ne(f,n,i),5):(f[i.offset++]=211,De(f,n,i),9)}const et={int8:H,uint8:se,int16:te,uint16:ee,int32:ne,uint32:me,int64:De,uint64:Ie,bigint64:We,biguint64:Ge,float32:ut,float64:At,boolean:Ct,string:As,number:Ke,utf8Write:Ve,utf8Length:Qe},tn=new ArrayBuffer(8),ft=new Int32Array(tn),cs=new Float32Array(tn),fs=new Float64Array(tn),us=new BigUint64Array(tn),ds=new BigInt64Array(tn);function Wn(f,n,i){for(var o="",c=0,p=n.offset,m=n.offset+i;p<m;p++){var _=f[p];if(!(_&128)){o+=String.fromCharCode(_);continue}if((_&224)===192){o+=String.fromCharCode((_&31)<<6|f[++p]&63);continue}if((_&240)===224){o+=String.fromCharCode((_&15)<<12|(f[++p]&63)<<6|(f[++p]&63)<<0);continue}if((_&248)===240){c=(_&7)<<18|(f[++p]&63)<<12|(f[++p]&63)<<6|(f[++p]&63)<<0,c>=65536?(c-=65536,o+=String.fromCharCode((c>>>10)+55296,(c&1023)+56320)):o+=String.fromCharCode(c);continue}console.error("Invalid byte "+_.toString(16))}return n.offset+=i,o}function Kn(f,n){return nn(f,n)<<24>>24}function nn(f,n){return f[n.offset++]}function qn(f,n){return vn(f,n)<<16>>16}function vn(f,n){return f[n.offset++]|f[n.offset++]<<8}function it(f,n){return f[n.offset++]|f[n.offset++]<<8|f[n.offset++]<<16|f[n.offset++]<<24}function Mt(f,n){return it(f,n)>>>0}function Yn(f,n){return ft[0]=it(f,n),cs[0]}function Ln(f,n){return ft[0]=it(f,n),ft[1]=it(f,n),fs[0]}function Se(f,n){const i=Mt(f,n);return it(f,n)*Math.pow(2,32)+i}function qt(f,n){const i=Mt(f,n);return Mt(f,n)*Math.pow(2,32)+i}function b(f,n){return ft[0]=it(f,n),ft[1]=it(f,n),ds[0]}function I(f,n){return ft[0]=it(f,n),ft[1]=it(f,n),us[0]}function D(f,n){return nn(f,n)>0}function P(f,n){const i=f[n.offset++];let o;return i<192?o=i&31:i===217?o=nn(f,n):i===218?o=vn(f,n):i===219&&(o=Mt(f,n)),Wn(f,n,o)}function Z(f,n){const i=f[n.offset++];if(i<128)return i;if(i===202)return Yn(f,n);if(i===203)return Ln(f,n);if(i===204)return nn(f,n);if(i===205)return vn(f,n);if(i===206)return Mt(f,n);if(i===207)return qt(f,n);if(i===208)return Kn(f,n);if(i===209)return qn(f,n);if(i===210)return it(f,n);if(i===211)return Se(f,n);if(i>223)return(255-i+1)*-1}function U(f,n){const i=f[n.offset];return i<192&&i>160||i===217||i===218||i===219}const G={utf8Read:Wn,int8:Kn,uint8:nn,int16:qn,uint16:vn,int32:it,uint32:Mt,float32:Yn,float64:Ln,int64:Se,uint64:qt,bigint64:b,biguint64:I,boolean:D,string:P,number:Z,stringCheck:U},K={},Q=new Map;function he(f,n){n.constructor&&(Q.set(n.constructor,f),K[f]=n),n.encode&&(et[f]=n.encode),n.decode&&(G[f]=n.decode)}function xe(f){return K[f]}function Re(f){for(const n in f)he(n,f[n]);return n=>mt(n)}const wt=class wt{static register(n){const i=Object.getPrototypeOf(n);if(i!==$e){let o=wt.inheritedTypes.get(i);o||(o=new Set,wt.inheritedTypes.set(i,o)),o.add(n)}}static cache(n){let i=wt.cachedContexts.get(n);return i||(i=new wt(n),wt.cachedContexts.set(n,i)),i}constructor(n){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},n&&this.discoverTypes(n)}has(n){return this.schemas.has(n)}get(n){return this.types[n]}add(n,i=this.schemas.size){return this.schemas.has(n)?!1:(this.types[i]=n,n[Symbol.metadata]===void 0&&Oe.initialize(n),this.schemas.set(n,i),!0)}getTypeId(n){return this.schemas.get(n)}discoverTypes(n,i,o,c){var _,w;if(c&&this.registerFilteredByParent(n,i,o),!this.add(n))return;(_=wt.inheritedTypes.get(n))==null||_.forEach(S=>{this.discoverTypes(S,i,o,c)});let p=n;for(;(p=Object.getPrototypeOf(p))&&p!==$e&&p!==Function.prototype;)this.discoverTypes(p);const m=n[w=Symbol.metadata]??(n[w]={});m[ge]&&(this.hasFilters=!0);for(const S in m){const x=S,$=m[x].type,R=m[x].tag!==void 0;if(typeof $!="string")if(Array.isArray($)){const X=$[0];if(X==="string")continue;this.discoverTypes(X,n,x,c||R)}else if(typeof $=="function")this.discoverTypes($,n,x,c||R);else{const X=Object.values($)[0];if(typeof X=="string")continue;this.discoverTypes(X,n,x,c||R)}}}registerFilteredByParent(n,i,o){let p=`${this.schemas.get(n)??this.schemas.size}`;i&&(p+=`-${this.schemas.get(i)}`),p+=`-${o}`,this.parentFiltered[p]=!0}debug(){let n="";for(const i in this.parentFiltered){const o=i.split("-").map(Number),c=o.pop();n+=`
		`,n+=`${i}: ${o.reverse().map((p,m)=>{const _=this.types[p],w=_[Symbol.metadata];let S=_.name;return m===0&&(S+=`[${w[c].name}]`),`${S}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${n}`}};wt.inheritedTypes=new Map,wt.cachedContexts=new Map;let Ae=wt;function xt(f){return Array.isArray(f)?{array:f[0]}:typeof f.type<"u"?f.type:f}const Oe={addField(f,n,i,o,c){if(n>64)throw new Error(`Can't define field '${i}'.
Schema instances may only have up to 64 fields.`);f[n]=Object.assign(f[n]||{},{type:xt(o),index:n,name:i}),Object.defineProperty(f,F,{value:f[F]||{},enumerable:!1,configurable:!0}),c?(f[F][i]=c,f[F][`_${i}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):f[F][i]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(f,z,{value:n,enumerable:!1,configurable:!0}),Object.defineProperty(f,i,{value:n,enumerable:!1,configurable:!0}),typeof f[n].type!="string"&&(f[ce]===void 0&&Object.defineProperty(f,ce,{value:[],enumerable:!1,configurable:!0}),f[ce].push(n))},setTag(f,n,i){const o=f[n],c=f[o];c.tag=i,f[ge]||(Object.defineProperty(f,ge,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(f,ie,{value:{},enumerable:!1,configurable:!0})),f[ge].push(o),f[ie][i]||(f[ie][i]=[]),f[ie][i].push(o)},setFields(f,n){const i=f.prototype.constructor;Ae.register(i);const o=Object.getPrototypeOf(i),c=o&&o[Symbol.metadata],p=Oe.initialize(i);i[l]||(i[l]=$e[l]),i[u]||(i[u]=$e[u]),i[d]||(i[d]=$e[d]),i.prototype.toJSON||(i.prototype.toJSON=$e.prototype.toJSON);let m=p[z]??(c&&c[z])??-1;m++;for(const _ in n){const w=n[_],S=Array.isArray(w)?xe("array"):typeof Object.keys(w)[0]=="string"&&xe(Object.keys(w)[0]),x=S?Object.values(w)[0]:xt(w);Oe.addField(p,m,_,w,on(`_${_}`,m,x,S)),m++}return f},isDeprecated(f,n){return f[n].deprecated===!0},init(f){const n={};f[Symbol.metadata]=n,Object.defineProperty(n,z,{value:0,enumerable:!1,configurable:!0})},initialize(f){const n=Object.getPrototypeOf(f),i=n[Symbol.metadata];let o=f[Symbol.metadata]??Object.create(null);return n!==$e&&o===i&&(o=Object.create(null),i&&(Object.setPrototypeOf(o,i),Object.defineProperty(o,z,{value:i[z],enumerable:!1,configurable:!0,writable:!0}),i[ge]!==void 0&&(Object.defineProperty(o,ge,{value:[...i[ge]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,ie,{value:{...i[ie]},enumerable:!1,configurable:!0,writable:!0})),i[ce]!==void 0&&Object.defineProperty(o,ce,{value:[...i[ce]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,F,{value:{...i[F]},enumerable:!1,configurable:!0,writable:!0}))),f[Symbol.metadata]=o,o},isValidInstance(f){return f.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(f.constructor[Symbol.metadata],z)},getFields(f){const n=f[Symbol.metadata],i={};for(let o=0;o<=n[z];o++)i[n[o].name]=n[o].type;return i},hasViewTagAtIndex(f,n){var i;return(i=f==null?void 0:f[ge])==null?void 0:i.includes(n)}};function sn(){return{indexes:{},operations:[]}}function rt(f,n){const i=f.indexes[n];i===void 0?f.indexes[n]=f.operations.push(n)-1:f.operations[i]=n}function hs(f,n){var o;let i=f.indexes[n];i===void 0&&(i=Object.values(f.indexes).at(-1),n=(o=Object.entries(f.indexes).find(([c,p])=>p===i))==null?void 0:o[0]),f.operations[i]=void 0,delete f.indexes[n]}function qe(f,n,i,o=n[i].queueRootIndex){if(f)f[i][o]!==n&&(n[i].queueRootIndex=f[i].push(n)-1);else return}class Gt{constructor(n){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=n;const i=n.constructor[Symbol.metadata];i!=null&&i[ge]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(n){var o;this.root=n,this.checkIsFiltered(this.parent,this.parentIndex);const i=this.ref.constructor[Symbol.metadata];i?(o=i[ce])==null||o.forEach(c=>{var _;const p=i[c],m=(_=this.ref[p.name])==null?void 0:_[h];m&&(m.root!==n?m.setRoot(n):n.add(m))}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((c,p)=>{const m=c[h];m.root!==n?m.setRoot(n):n.add(m)})}setParent(n,i,o){var p;if(this.parent=n,this.parentIndex=o,!i)return;i!==this.root?(this.root=i,this.checkIsFiltered(n,o)):i.add(this);const c=this.ref.constructor[Symbol.metadata];c?(p=c[ce])==null||p.forEach(m=>{var S;const _=c[m],w=(S=this.ref[_.name])==null?void 0:S[h];w&&w.root!==i&&w.setParent(this.ref,i,m)}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((m,_)=>{const w=m[h];w.root!==i&&w.setParent(this.ref,i,this.indexes[_]??_)})}forEachChild(n){var o;const i=this.ref.constructor[Symbol.metadata];i?(o=i[ce])==null||o.forEach(c=>{const p=i[c],m=this.ref[p.name];m&&n(m[h],c)}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((c,p)=>{n(c[h],this.indexes[p]??p)})}operation(n){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-n),qe(this.root,this,"filteredChanges")):(this.changes.operations.push(-n),qe(this.root,this,"changes"))}change(n,i=e.OPERATION.ADD){var _;const o=this.ref.constructor[Symbol.metadata],c=this.isFiltered||((_=o==null?void 0:o[n])==null?void 0:_.tag)!==void 0,p=c?this.filteredChanges:this.changes,m=this.indexedOperations[n];if(!m||m===e.OPERATION.DELETE){const w=m&&m===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:i;this.indexedOperations[n]=w}rt(p,n),c?(rt(this.allFilteredChanges,n),this.root&&(qe(this.root,this,"filteredChanges"),qe(this.root,this,"allFilteredChanges"))):(rt(this.allChanges,n),qe(this.root,this,"changes"))}shiftChangeIndexes(n){const i=this.isFiltered?this.filteredChanges:this.changes,o={},c={};for(const p in this.indexedOperations)o[Number(p)+n]=this.indexedOperations[p],c[Number(p)+n]=i.indexes[p];this.indexedOperations=o,i.indexes=c,i.operations=i.operations.map(p=>p+n)}shiftAllChangeIndexes(n,i=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(n,i,this.allFilteredChanges),this._shiftAllChangeIndexes(n,i,this.allChanges)):this._shiftAllChangeIndexes(n,i,this.allChanges)}_shiftAllChangeIndexes(n,i=0,o){const c={};let p=0;for(const m in o.indexes)c[p++]=o.indexes[m];o.indexes=c;for(let m=0;m<o.operations.length;m++){const _=o.operations[m];_>i&&(o.operations[m]=_+n)}}indexedOperation(n,i,o=n){this.indexedOperations[n]=i,this.filteredChanges!==void 0?(rt(this.allFilteredChanges,o),rt(this.filteredChanges,n),qe(this.root,this,"filteredChanges")):(rt(this.allChanges,o),rt(this.changes,n),qe(this.root,this,"changes"))}getType(n){return Oe.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][n].type:this.ref[T]}getChange(n){return this.indexedOperations[n]}getValue(n,i=!1){return this.ref[g](n,i)}delete(n,i,o=n){var m;if(n===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${n}'`)}catch(_){console.warn(_)}return}const c=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[n]=i??e.OPERATION.DELETE,rt(c,n),hs(this.allChanges,o);const p=this.getValue(n);return p&&p[h]&&((m=this.root)==null||m.remove(p[h])),this.filteredChanges!==void 0?(hs(this.allFilteredChanges,o),qe(this.root,this,"filteredChanges")):qe(this.root,this,"changes"),p}endEncode(n){var i,o;this.indexedOperations={},this[n].indexes={},this[n].operations.length=0,this[n].queueRootIndex=void 0,(o=(i=this.ref)[M])==null||o.call(i),this.isNew=!1}discard(n=!1){var i,o;(o=(i=this.ref)[M])==null||o.call(i),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),n&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0))}discardAll(){const n=Object.keys(this.indexedOperations);for(let i=0,o=n.length;i<o;i++){const c=this.getValue(Number(n[i]));c&&c[h]&&c[h].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(n,i){const o=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(n,i),this.filteredChanges!==void 0&&(qe(this.root,this,"filteredChanges"),o&&this.root.allFilteredChanges.push(this))),this.isFiltered||(qe(this.root,this,"changes"),o&&this.root.allChanges.push(this))}_checkFilteredByParent(n,i){if(!n)return;const o=Oe.isValidInstance(this.ref)?this.ref.constructor:this.ref[T];let c,p=!Oe.isValidInstance(n);p?(c=n[h],n=c.parent,i=c.parentIndex):c=n[h];const m=n.constructor;let _=`${this.root.types.getTypeId(o)}`;m&&(_+=`-${this.root.types.schemas.get(m)}`),_+=`-${i}`;const w=Oe.hasViewTagAtIndex(m==null?void 0:m[Symbol.metadata],i);this.isFiltered=n[h].isFiltered||this.root.types.parentFiltered[_]||w,this.isFiltered&&(this.isVisibilitySharedWithParent=c.isFiltered&&typeof o!="string"&&!w&&p,this.filteredChanges||(this.filteredChanges=sn(),this.allFilteredChanges=sn()),this.changes.operations.length>0&&(this.changes.operations.forEach(S=>rt(this.filteredChanges,S)),this.allChanges.operations.forEach(S=>rt(this.allFilteredChanges,S)),this.changes=sn(),this.allChanges=sn()))}}function kn(f,n,i,o,c,p){var m;typeof i=="string"?(m=et[i])==null||m.call(et,n,o,p):i[Symbol.metadata]!==void 0?(et.number(n,o[h].refId,p),(c&e.OPERATION.ADD)===e.OPERATION.ADD&&f.tryEncodeTypeId(n,i,o.constructor,p)):et.number(n,o[h].refId,p)}const ps=function(f,n,i,o,c,p,m,_,w){if(n[p.offset++]=(o|c)&255,c===e.OPERATION.DELETE)return;const S=i.ref,x=w[o];kn(f,n,w[o].type,S[x.name],c,p)},rn=function(f,n,i,o,c,p){if(n[p.offset++]=c&255,c===e.OPERATION.CLEAR||(et.number(n,o,p),c===e.OPERATION.DELETE))return;const m=i.ref;if((c&e.OPERATION.ADD)===e.OPERATION.ADD&&typeof m.set=="function"){const S=i.ref.$indexes.get(o);et.string(n,S,p)}const _=m[T],w=m[g](o);kn(f,n,_,w,c,p)},Zs=function(f,n,i,o,c,p,m,_){const w=i.ref,S=_&&i.isFiltered&&typeof i.getType(o)!="string";let x;if(S?(x=w.tmpItems[o][h].refId,c===e.OPERATION.DELETE?c=e.OPERATION.DELETE_BY_REFID:c===e.OPERATION.ADD&&(c=e.OPERATION.ADD_BY_REFID)):x=o,n[p.offset++]=c&255,c===e.OPERATION.CLEAR||c===e.OPERATION.REVERSE||(et.number(n,x,p),c===e.OPERATION.DELETE||c===e.OPERATION.DELETE_BY_REFID))return;const $=i.getType(o),R=i.getValue(o,m);kn(f,n,$,R,c,p)},zs=-1;function gs(f,n,i,o,c,p,m,_){const w=f.root,S=i[g](o);let x;if((n&e.OPERATION.DELETE)===e.OPERATION.DELETE){const $=w.refIds.get(S);$!==void 0&&w.removeRef($),n!==e.OPERATION.DELETE_AND_ADD&&i[E](o),x=void 0}if(n!==e.OPERATION.DELETE)if($e.is(c)){const $=G.number(p,m);if(x=w.refs.get($),(n&e.OPERATION.ADD)===e.OPERATION.ADD){const R=f.getInstanceType(p,m,c);x||(x=f.createInstanceOfType(R)),w.addRef($,x,x!==S||n===e.OPERATION.DELETE_AND_ADD&&x===S)}}else if(typeof c=="string")x=G[c](p,m);else{const $=xe(Object.keys(c)[0]),R=G.number(p,m),X=w.refs.has(R)?S||w.refs.get(R):new $.constructor;if(x=X.clone(!0),x[T]=Object.values(c)[0],S){let q=w.refIds.get(S);if(q!==void 0&&R!==q){const V=S.entries();let N;for(;(N=V.next())&&!N.done;){const[Y,ye]=N.value;typeof ye=="object"&&(q=w.refIds.get(ye),w.removeRef(q)),_.push({ref:S,refId:q,op:e.OPERATION.DELETE,field:Y,value:void 0,previousValue:ye})}}}w.addRef(R,x,X!==S||n===e.OPERATION.DELETE_AND_ADD&&X===S)}return{value:x,previousValue:S}}const Ws=function(f,n,i,o,c){const p=n[i.offset++],m=o.constructor[Symbol.metadata],_=p>>6<<6,w=p%(_||255),S=m[w];if(S===void 0)return console.warn("@colyseus/schema: field not defined at",{index:w,ref:o.constructor.name,metadata:m}),zs;const{value:x,previousValue:$}=gs(f,_,o,w,S.type,n,i,c);x!=null&&(o[S.name]=x),$!==x&&c.push({ref:o,refId:f.currentRefId,op:_,field:S.name,value:x,previousValue:$})},Bn=function(f,n,i,o,c){const p=n[i.offset++];if(p===e.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}const m=G.number(n,i),_=o[T];let w;(p&e.OPERATION.ADD)===e.OPERATION.ADD?typeof o.set=="function"?(w=G.string(n,i),o.setIndex(m,w)):w=m:w=o.getIndex(m);const{value:S,previousValue:x}=gs(f,p,o,m,_,n,i,c);if(S!=null){if(typeof o.set=="function")o.$items.set(w,S);else if(typeof o.$setAt=="function")o.$setAt(m,S,p);else if(typeof o.add=="function"){const $=o.add(S);typeof $=="number"&&o.setIndex($,$)}}x!==S&&c.push({ref:o,refId:f.currentRefId,op:p,field:"",dynamicIndex:w,value:S,previousValue:x})},Os=function(f,n,i,o,c){let p=n[i.offset++],m;if(p===e.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}else if(p===e.OPERATION.REVERSE){o.reverse();return}else if(p===e.OPERATION.DELETE_BY_REFID){const $=G.number(n,i),R=f.root.refs.get($);m=o.findIndex(X=>X===R),o[E](m),c.push({ref:o,refId:f.currentRefId,op:e.OPERATION.DELETE,field:"",dynamicIndex:m,value:void 0,previousValue:R});return}else if(p===e.OPERATION.ADD_BY_REFID){const $=G.number(n,i),R=f.root.refs.get($);R&&(m=o.findIndex(X=>X===R)),(m===-1||m===void 0)&&(m=o.length)}else m=G.number(n,i);const _=o[T];let w=m;const{value:S,previousValue:x}=gs(f,p,o,m,_,n,i,c);S!=null&&S!==x&&o.$setAt(m,S,p),x!==S&&c.push({ref:o,refId:f.currentRefId,op:p,field:"",dynamicIndex:w,value:S,previousValue:x})};class ms extends Error{}function mr(f,n,i,o){let c,p=!1;switch(n){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(f)&&console.log(`trying to encode "NaN" in ${i.constructor.name}#${o}`);break;case"bigint64":case"biguint64":c="bigint";break;case"string":c="string",p=!0;break;case"boolean":return;default:return}if(typeof f!==c&&(!p||p&&f!==null)){let m=`'${JSON.stringify(f)}'${f&&f.constructor&&` (${f.constructor.name})`||""}`;throw new ms(`a '${c}' was expected, but ${m} was provided in ${i.constructor.name}#${o}`)}}function Zt(f,n,i,o){if(!(f instanceof n))throw new ms(`a '${n.name}' was expected, but '${f&&f.constructor.name}' was provided in ${i.constructor.name}#${o}`)}var Ks,qs;const Cr=(f,n)=>{const i=f.toString(),o=n.toString();return i<o?-1:i>o?1:0},yt=class yt{static[(Ks=u,qs=d,y)](n,i,o){var c;return!o||typeof n[T]=="string"||o.isChangeTreeVisible((c=n.tmpItems[i])==null?void 0:c[h])}static is(n){return Array.isArray(n)||n.array!==void 0}static from(n){return new yt(...Array.from(n))}constructor(...n){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const i=new Proxy(this,{get:(o,c)=>typeof c!="symbol"&&!isNaN(c)?this.items[c]:Reflect.get(o,c),set:(o,c,p)=>{var m;if(typeof c!="symbol"&&!isNaN(c)){if(p==null)o.$deleteAt(c);else{if(p[h]){Zt(p,o[T],o,c);const _=o.items[c];o.isMovingItems?(_!==void 0?p[h].isNew?o[h].indexedOperation(Number(c),e.OPERATION.MOVE_AND_ADD):(o[h].getChange(Number(c))&e.OPERATION.DELETE)===e.OPERATION.DELETE?o[h].indexedOperation(Number(c),e.OPERATION.DELETE_AND_MOVE):o[h].indexedOperation(Number(c),e.OPERATION.MOVE):p[h].isNew&&o[h].indexedOperation(Number(c),e.OPERATION.ADD),p[h].setParent(this,o[h].root,c)):o.$changeAt(Number(c),p),_!==void 0&&((m=_[h].root)==null||m.remove(_[h]))}else o.$changeAt(Number(c),p);o.items[c]=p,o.tmpItems[c]=p}return!0}else return Reflect.set(o,c,p)},deleteProperty:(o,c)=>(typeof c=="number"?o.$deleteAt(c):delete o[c],!0),has:(o,c)=>typeof c!="symbol"&&!isNaN(Number(c))?Reflect.has(this.items,c):Reflect.has(o,c)});return this[h]=new Gt(i),this[h].indexes={},n.length>0&&this.push(...n),i}set length(n){n===0?this.clear():n<this.items.length?this.splice(n,this.length-n):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...n){var c;let i=this.tmpItems.length;const o=this[h];for(let p=0,m=n.length;p<m;p++,i++){const _=n[p];if(_==null)return;typeof _=="object"&&this[T]&&Zt(_,this[T],this,p),o.indexedOperation(i,e.OPERATION.ADD,this.items.length),this.items.push(_),this.tmpItems.push(_),(c=_[h])==null||c.setParent(this,o.root,i)}return i}pop(){let n=-1;for(let i=this.tmpItems.length-1;i>=0;i--)if(this.deletedIndexes[i]!==!0){n=i;break}if(!(n<0))return this[h].delete(n,void 0,this.items.length-1),this.deletedIndexes[n]=!0,this.items.pop()}at(n){return n<0&&(n+=this.length),this.items[n]}$changeAt(n,i){var p;if(i==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[n]===i)return;const o=this.items[n]!==void 0?typeof i=="object"?e.OPERATION.DELETE_AND_ADD:e.OPERATION.REPLACE:e.OPERATION.ADD,c=this[h];c.change(n,o),(p=i[h])==null||p.setParent(this,c.root,n)}$deleteAt(n,i){this[h].delete(n,i)}$setAt(n,i,o){n===0&&o===e.OPERATION.ADD&&this.items[n]!==void 0?this.items.unshift(i):o===e.OPERATION.DELETE_AND_MOVE?(this.items.splice(n,1),this.items[n]=i):this.items[n]=i}clear(){if(this.items.length===0)return;const n=this[h];n.forEachChild((i,o)=>{var c;(c=n.root)==null||c.remove(i)}),n.discard(!0),n.operation(e.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...n){return new yt(...this.items.concat(...n))}join(n){return this.items.join(n)}reverse(){return this[h].operation(e.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const n=this[h],i=this.tmpItems.findIndex(c=>c===this.items[0]),o=this.items.findIndex(c=>c===this.items[0]);return n.delete(i,e.OPERATION.DELETE,o),n.shiftAllChangeIndexes(-1,o),this.items.shift()}slice(n,i){const o=new yt;return o.push(...this.items.slice(n,i)),o}sort(n=Cr){this.isMovingItems=!0;const i=this[h];return this.items.sort(n).forEach((c,p)=>i.change(p,e.OPERATION.REPLACE)),this.tmpItems.sort(n),this.isMovingItems=!1,this}splice(n,i,...o){var S;const c=this[h],p=this.items.length,m=this.tmpItems.length,_=o.length,w=[];for(let x=0;x<m;x++)this.deletedIndexes[x]!==!0&&w.push(x);if(p>n){i===void 0&&(i=p-n);for(let x=n;x<n+i;x++){const $=w[x];c.delete($,e.OPERATION.DELETE),this.deletedIndexes[$]=!0}}else i=0;if(_>0){if(_>i)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let x=0;x<_;x++){const $=(w[n]??p)+x;c.indexedOperation($,this.deletedIndexes[$]?e.OPERATION.DELETE_AND_ADD:e.OPERATION.ADD),(S=o[x][h])==null||S.setParent(this,c.root,$)}}return i>_&&c.shiftAllChangeIndexes(-(i-_),w[n+_]),c.filteredChanges!==void 0?qe(c.root,c,"filteredChanges"):qe(c.root,c,"changes"),this.items.splice(n,i,...o)}unshift(...n){const i=this[h];return i.shiftChangeIndexes(n.length),i.isFiltered?rt(i.filteredChanges,this.items.length):rt(i.allChanges,this.items.length),n.forEach((o,c)=>{i.change(c,e.OPERATION.ADD)}),this.tmpItems.unshift(...n),this.items.unshift(...n)}indexOf(n,i){return this.items.indexOf(n,i)}lastIndexOf(n,i=this.length-1){return this.items.lastIndexOf(n,i)}every(n,i){return this.items.every(n,i)}some(n,i){return this.items.some(n,i)}forEach(n,i){return this.items.forEach(n,i)}map(n,i){return this.items.map(n,i)}filter(n,i){return this.items.filter(n,i)}reduce(n,i){return this.items.reduce(n,i)}reduceRight(n,i){return this.items.reduceRight(n,i)}find(n,i){return this.items.find(n,i)}findIndex(n,i){return this.items.findIndex(n,i)}fill(n,i,o){throw new Error("ArraySchema#fill() not implemented")}copyWithin(n,i,o){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return yt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(n,i){return this.items.includes(n,i)}flatMap(n,i){throw new Error("ArraySchema#flatMap() is not supported.")}flat(n){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...n){return this.items.findLastIndex.apply(this.items,arguments)}with(n,i){const o=this.items.slice();return n<0&&(n+=this.length),o[n]=i,new yt(...o)}toReversed(){return this.items.slice().reverse()}toSorted(n){return this.items.slice().sort(n)}toSpliced(n,i,...o){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(n=>{let i=this.items.length;for(;i!=0;){let o=Math.floor(Math.random()*i);i--,[this[i],this[o]]=[this[o],this[i]]}})}move(n){return this.isMovingItems=!0,n(this),this.isMovingItems=!1,this}[g](n,i=!1){return i?this.items[n]:this.deletedIndexes[n]?this.items[n]:this.tmpItems[n]||this.items[n]}[E](n){this.items[n]=void 0,this.tmpItems[n]=void 0}[M](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[J](){this.items=this.items.filter(n=>n!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(n=>typeof n.toJSON=="function"?n.toJSON():n)}clone(n){let i;return n?(i=new yt,i.push(...this.items)):i=new yt(...this.map(o=>o[h]?o.clone():o)),i}};yt[Ks]=Zs,yt[qs]=Os;let _t=yt;he("array",{constructor:_t});var Ys,an;const Bt=class Bt{static[(Ys=u,an=d,y)](n,i,o){return!o||typeof n[T]=="string"||o.isChangeTreeVisible((n[g](i)??n.deletedItems[i])[h])}static is(n){return n.map!==void 0}constructor(n){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[h]=new Gt(this),this[h].indexes={},n)if(n instanceof Map||n instanceof Bt)n.forEach((i,o)=>this.set(o,i));else for(const i in n)this.set(i,n[i]);Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return Bt}set(n,i){var _;if(i==null)throw new Error(`MapSchema#set('${n}', ${i}): trying to set ${i} value on '${n}'.`);typeof i=="object"&&this[T]&&Zt(i,this[T],this,n),n=n.toString();const o=this[h],c=i[h]!==void 0;let p,m;if(typeof o.indexes[n]<"u"){p=o.indexes[n],m=e.OPERATION.REPLACE;const w=this.$items.get(n);if(w===i)return;c&&(m=e.OPERATION.DELETE_AND_ADD,w!==void 0&&((_=w[h].root)==null||_.remove(w[h])))}else p=o.indexes[z]??0,m=e.OPERATION.ADD,this.$indexes.set(p,n),o.indexes[n]=p,o.indexes[z]=p+1;return this.$items.set(n,i),o.change(p,m),c&&i[h].setParent(this,o.root,p),this}get(n){return this.$items.get(n)}delete(n){const i=this[h].indexes[n];return this.deletedItems[i]=this[h].delete(i),this.$items.delete(n)}clear(){const n=this[h];n.discard(!0),n.indexes={},n.forEachChild((i,o)=>{var c;(c=n.root)==null||c.remove(i)}),this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){return this.$items.has(n)}forEach(n){this.$items.forEach(n)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(n,i){this.$indexes.set(n,i)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[E](n){const i=this.$indexes.get(n);this.$items.delete(i),this.$indexes.delete(n)}[M](){this.deletedItems={}}toJSON(){const n={};return this.forEach((i,o)=>{n[o]=typeof i.toJSON=="function"?i.toJSON():i}),n}clone(n){let i;return n?i=Object.assign(new Bt,this):(i=new Bt,this.forEach((o,c)=>{o[h]?i.set(c,o.clone()):i.set(c,o)})),i}};Bt[Ys]=rn,Bt[an]=Bn;let Lt=Bt;he("map",{constructor:Lt});const Dt=-1;function Lr(f){return Ae.register(f),f}function Xs(f=Dt){return function(n,i){var _;const o=n.constructor,p=Object.getPrototypeOf(o)[Symbol.metadata],m=o[_=Symbol.metadata]??(o[_]=Object.assign({},o[Symbol.metadata],p??Object.create(null)));Oe.setTag(m,i,f)}}function mt(f,n){return function(i,o){const c=i.constructor;if(!f)throw new Error(`${c.name}: @type() reference provided for "${o}" is undefined. Make sure you don't have any circular dependencies.`);Ae.register(c);const m=Object.getPrototypeOf(c)[Symbol.metadata],_=Oe.initialize(c);let w=_[o];if(_[w]!==void 0){if(_[w].deprecated)return;if(_[w].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${o}' definition on '${c.name}'.
Check @type() annotation`)}catch(S){const x=S.stack.split(`
`)[4].trim();throw new Error(`${S.message} ${x}`)}}else w=_[z]??(m&&m[z])??-1,w++;if(n&&n.manual)Oe.addField(_,w,o,f,{enumerable:!0,configurable:!0,writable:!0});else{const S=Array.isArray(f)?xe("array"):typeof Object.keys(f)[0]=="string"&&xe(Object.keys(f)[0]),x=S?Object.values(f)[0]:f;Oe.addField(_,w,o,f,on(`_${o}`,w,x,S))}}}function on(f,n,i,o){return{get:function(){return this[f]},set:function(c){var m,_;const p=this[f]??void 0;if(c!==p){if(c!=null){o?(o.constructor===_t&&!(c instanceof _t)&&(c=new _t(...c)),o.constructor===Lt&&!(c instanceof Lt)&&(c=new Lt(c)),c[T]=i):typeof i!="string"?Zt(c,i,this,f.substring(1)):mr(c,i,this,f.substring(1));const w=this[h];p!==void 0&&p[h]?((m=w.root)==null||m.remove(p[h]),this.constructor[l](w,n,e.OPERATION.DELETE_AND_ADD)):this.constructor[l](w,n,e.OPERATION.ADD),(_=c[h])==null||_.setParent(this,w.root,n)}else p!==void 0&&this[h].delete(n);this[f]=c}},enumerable:!0,configurable:!0}}function kr(f=!0){return function(n,i){var w;const o=n.constructor,p=Object.getPrototypeOf(o)[Symbol.metadata],m=o[w=Symbol.metadata]??(o[w]=Object.assign({},o[Symbol.metadata],p??Object.create(null))),_=m[i];m[_].deprecated=!0,f&&(m[F]??(m[F]={}),m[F][i]={get:function(){throw new Error(`${i} is deprecated.`)},set:function(S){},enumerable:!1,configurable:!0}),Object.defineProperty(m,_,{value:m[_],enumerable:!1,configurable:!0})}}function Br(f,n,i){for(let o in n)mt(n[o],i)(f.prototype,o);return f}function Js(f,n,i=$e){const o={},c={};for(let m in f){const _=f[m];typeof _=="object"&&(_.default!==void 0&&(o[m]=_.default),_.view!==void 0&&(c[m]=typeof _.view=="boolean"?Dt:_.view))}const p=Oe.setFields(class extends i{constructor(...m){m[0]=Object.assign({},o,m[0]),super(...m)}},f);for(let m in c)Xs(c[m])(p.prototype,m);return n&&Object.defineProperty(p,"name",{value:n}),p.extends=(m,_)=>Js(m,_,p),p}function $n(f){return new Array(f).fill(0).map((n,i)=>i===f-1?" ":"   ").join("")}function $r(f){const n=f[h].root,i={ops:{},refs:[]};return n.changes.forEach(o=>{if(o===void 0)return;const c=o.indexedOperations;i.refs.push(`refId#${o.refId}`);for(const p in c){const m=c[p],_=e.OPERATION[m];i.ops[_]||(i.ops[_]=0),i.ops[e.OPERATION[m]]++}}),i}var Xn,Qs;const In=class In{static initialize(n){var i;Object.defineProperty(n,h,{value:new Gt(n),enumerable:!1,writable:!0}),Object.defineProperties(n,((i=n.constructor[Symbol.metadata])==null?void 0:i[F])||{})}static is(n){return typeof n[Symbol.metadata]=="object"}static[(Xn=u,Qs=d,l)](n,i,o=e.OPERATION.ADD){n.change(i,o)}static[y](n,i,o){var m,_;const p=(m=n.constructor[Symbol.metadata][i])==null?void 0:m.tag;if(o===void 0)return p===void 0;if(p===void 0)return!0;if(p===Dt)return o.isChangeTreeVisible(n[h]);{const w=(_=o.tags)==null?void 0:_.get(n[h]);return w&&w.has(p)}}constructor(...n){In.initialize(this),n[0]&&Object.assign(this,n[0])}assign(n){return Object.assign(this,n),this}setDirty(n,i){const o=this.constructor[Symbol.metadata];this[h].change(o[o[n]].index,i)}clone(){var o;const n=new this.constructor,i=this.constructor[Symbol.metadata];for(const c in i){const p=i[c].name;typeof this[p]=="object"&&typeof((o=this[p])==null?void 0:o.clone)=="function"?n[p]=this[p].clone():n[p]=this[p]}return n}toJSON(){const n={},i=this.constructor[Symbol.metadata];for(const o in i){const c=i[o],p=c.name;!c.deprecated&&this[p]!==null&&typeof this[p]<"u"&&(n[p]=typeof this[p].toJSON=="function"?this[p].toJSON():this[p])}return n}discardAllChanges(){this[h].discardAll()}[g](n){const i=this.constructor[Symbol.metadata];return this[i[n].name]}[E](n){const i=this.constructor[Symbol.metadata];this[i[n].name]=void 0}static debugRefIds(n,i=!1,o=0){var S,x;const c=i?` - ${JSON.stringify(n.toJSON())}`:"",p=n[h],m=p.refId,_=((x=(S=p.root)==null?void 0:S.refCount)==null?void 0:x[m])>1?` [${p.root.refCount[m]}]`:"";let w=`${$n(o)}${n.constructor.name} (refId: ${m})${_}${c}
`;return p.forEachChild($=>w+=this.debugRefIds($.ref,i,o+1)),w}static debugChanges(n,i=!1){const o=n[h],c=i?o.allChanges:o.changes,p=i?"allChanges":"changes";let m=`${n.constructor.name} (${o.refId}) -> .${p}:
`;function _(w){w.operations.filter(S=>S).forEach(S=>{const x=o.indexedOperations[S];console.log({index:S,operation:x}),m+=`- [${S}]: ${e.OPERATION[x]} (${JSON.stringify(o.getValue(Number(S),i))})
`})}return _(c),!i&&o.filteredChanges&&o.filteredChanges.operations.filter(w=>w).length>0&&(m+=`${n.constructor.name} (${o.refId}) -> .filteredChanges:
`,_(o.filteredChanges)),i&&o.allFilteredChanges&&o.allFilteredChanges.operations.filter(w=>w).length>0&&(m+=`${n.constructor.name} (${o.refId}) -> .allFilteredChanges:
`,_(o.allFilteredChanges)),m}static debugChangesDeep(n,i="changes"){var x,$;let o="";const c=n[h],p=c.root,m=new Map,_=[];let w=0;for(const[R,X]of Object.entries(p[i])){const q=p.changeTrees[R];let V=!1,N=[],Y=(x=q.parent)==null?void 0:x[h];if(q===c)V=!0;else for(;Y!==void 0;){if(N.push(Y),Y.ref===n){V=!0;break}Y=($=Y.parent)==null?void 0:$[h]}V&&(_.push(q.refId),w+=Object.keys(X).length,m.set(q,N.reverse()))}o+=`---
`,o+=`root refId: ${c.refId}
`,o+=`Total instances: ${_.length} (refIds: ${_.join(", ")})
`,o+=`Total changes: ${w}
`,o+=`---
`;const S=new WeakSet;for(const[R,X]of m.entries()){X.forEach((ye,Le)=>{S.has(ye)||(o+=`${$n(Le)}${ye.ref.constructor.name} (refId: ${ye.refId})
`,S.add(ye))});const q=R.indexedOperations,V=X.length,N=$n(V),Y=V>0?`(${R.parentIndex}) `:"";o+=`${N}${Y}${R.ref.constructor.name} (refId: ${R.refId}) - changes: ${Object.keys(q).length}
`;for(const ye in q){const Le=q[ye];o+=`${$n(V+1)}${e.OPERATION[Le]}: ${ye}
`}}return`${o}`}};In[Xn]=ps,In[Qs]=Ws;let $e=In;var ln,er;const un=class un{static[(ln=u,er=d,y)](n,i,o){return!o||typeof n[T]=="string"||o.isChangeTreeVisible((n[g](i)??n.deletedItems[i])[h])}static is(n){return n.collection!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Gt(this),this[h].indexes={},n&&n.forEach(i=>this.add(i)),Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){const i=this.$refId++;return n[h]!==void 0&&n[h].setParent(this,this[h].root,i),this[h].indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,n),this[h].change(i),i}at(n){const i=Array.from(this.$items.keys())[n];return this.$items.get(i)}entries(){return this.$items.entries()}delete(n){const i=this.$items.entries();let o,c;for(;(c=i.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[h].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[h];n.discard(!0),n.indexes={},n.forEachChild((i,o)=>{var c;(c=n.root)==null||c.remove(i)}),this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){return Array.from(this.$items.values()).some(i=>i===n)}forEach(n){this.$items.forEach((i,o,c)=>n(i,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,i){this.$indexes.set(n,i)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[E](n){const i=this.$indexes.get(n);this.$items.delete(i),this.$indexes.delete(n)}[M](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((i,o)=>{n.push(typeof i.toJSON=="function"?i.toJSON():i)}),n}clone(n){let i;return n?i=Object.assign(new un,this):(i=new un,this.forEach(o=>{o[h]?i.add(o.clone()):i.add(o)})),i}};un[ln]=rn,un[er]=Bn;let _n=un;he("collection",{constructor:_n});var tr,nr;const dn=class dn{static[(tr=u,nr=d,y)](n,i,o){return!o||typeof n[T]=="string"||o.visible.has((n[g](i)??n.deletedItems[i])[h])}static is(n){return n.set!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Gt(this),this[h].indexes={},n&&n.forEach(i=>this.add(i)),Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){var c;if(this.has(n))return!1;const i=this.$refId++;n[h]!==void 0&&n[h].setParent(this,this[h].root,i);const o=((c=this[h].indexes[i])==null?void 0:c.op)??e.OPERATION.ADD;return this[h].indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,n),this[h].change(i,o),i}entries(){return this.$items.entries()}delete(n){const i=this.$items.entries();let o,c;for(;(c=i.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[h].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){const i=this.$items.values();let o=!1,c;for(;(c=i.next())&&!c.done;)if(n===c.value){o=!0;break}return o}forEach(n){this.$items.forEach((i,o,c)=>n(i,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,i){this.$indexes.set(n,i)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[E](n){const i=this.$indexes.get(n);this.$items.delete(i),this.$indexes.delete(n)}[M](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((i,o)=>{n.push(typeof i.toJSON=="function"?i.toJSON():i)}),n}clone(n){let i;return n?i=Object.assign(new dn,this):(i=new dn,this.forEach(o=>{o[h]?i.add(o.clone()):i.add(o)})),i}};dn[tr]=rn,dn[nr]=Bn;let wn=dn;he("set",{constructor:wn});function kt(f,n,i,o){var c=arguments.length,p=c<3?n:o,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(f,n,i,o);else for(var _=f.length-1;_>=0;_--)(m=f[_])&&(p=(c<3?m(p):c>3?m(n,i,p):m(n,i))||p);return c>3&&p&&Object.defineProperty(n,i,p),p}typeof SuppressedError=="function"&&SuppressedError;class xs{constructor(n){this.types=n,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(n){n.ensureRefId();const i=this.changeTrees[n.refId]===void 0;i&&(this.changeTrees[n.refId]=n);const o=this.refCount[n.refId];if(o===0){const c=n.allChanges.operations;let p=c.length;for(;p--;)n.indexedOperations[c[p]]=e.OPERATION.ADD,rt(n.changes,p)}return this.refCount[n.refId]=(o||0)+1,i}remove(n){const i=this.refCount[n.refId]-1;return i<=0?(n.root=void 0,delete this.changeTrees[n.refId],this.removeChangeFromChangeSet("allChanges",n),this.removeChangeFromChangeSet("changes",n),n.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",n),this.removeChangeFromChangeSet("filteredChanges",n)),this.refCount[n.refId]=0,n.forEachChild((o,c)=>this.remove(o))):(this.refCount[n.refId]=i,n.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",n),qe(this,n,"filteredChanges")):(this.removeChangeFromChangeSet("changes",n),qe(this,n,"changes"))),i}removeChangeFromChangeSet(n,i){const o=this[n],c=o.indexOf(i);if(c!==-1)return i[n].queueRootIndex=-1,o[c]=void 0,!0}clear(){this.changes.length=0}}const xn=class xn{constructor(n){this.sharedBuffer=Buffer.allocUnsafe(xn.BUFFER_SIZE),this.context=Ae.cache(n.constructor),this.root=new xs(this.context),this.setState(n)}setState(n){this.state=n,this.state[h].setRoot(this.root)}encode(n={offset:0},i,o=this.sharedBuffer,c="changes",p=c==="allChanges",m=n.offset){const _=i!==void 0,w=this.state[h],S=this.root[c];for(let x=0,$=S.length;x<$;x++){const R=S[x];if(!R)continue;if(_){if(!i.isChangeTreeVisible(R)){i.invisible.add(R);continue}i.invisible.delete(R)}const X=R[c],q=R.ref,V=X.operations.length;if(V===0)continue;const N=q.constructor,Y=N[u],ye=N[y],Le=N[Symbol.metadata];(_||n.offset>m||R!==w)&&(o[n.offset++]=255,et.number(o,R.refId,n));for(let Ye=0;Ye<V;Ye++){const Ze=X.operations[Ye],dt=Ze<0?Math.abs(Ze):p?e.OPERATION.ADD:R.indexedOperations[Ze];Ze===void 0||dt===void 0||ye&&!ye(q,Ze,i)||Y(this,o,R,Ze,dt,n,p,_,Le)}}if(n.offset>o.byteLength){const x=Math.ceil(n.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(x/1024)} * 1024; // ${Math.round(x/1024)} KB
`),o=Buffer.alloc(x,o),o===this.sharedBuffer&&(this.sharedBuffer=o),this.encode({offset:m},i,o,c,p)}else return o.subarray(0,n.offset)}encodeAll(n={offset:0},i=this.sharedBuffer){return this.encode(n,void 0,i,"allChanges",!0)}encodeAllView(n,i,o,c=this.sharedBuffer){const p=o.offset;return this.encode(o,n,c,"allFilteredChanges",!0,p),Buffer.concat([c.subarray(0,i),c.subarray(p,o.offset)])}debugChanges(n){(typeof n=="string"?this.root[n]:n).forEach(o=>{const c=o[n],p=o.ref.constructor[Symbol.metadata];console.log("->",{ref:o.ref.constructor.name,refId:o.refId,changes:Object.keys(c).length});for(const m in c){const _=c[m];console.log("  ->",{index:m,field:p==null?void 0:p[m],op:e.OPERATION[_]})}})}encodeView(n,i,o,c=this.sharedBuffer){const p=o.offset;for(const[m,_]of n.changes){const w=this.root.changeTrees[m];if(w===void 0){n.changes.delete(m);continue}const S=Object.keys(_);if(S.length===0)continue;const $=w.ref.constructor,R=$[u],X=$[Symbol.metadata];c[o.offset++]=255,et.number(c,w.refId,o);for(let q=0,V=S.length;q<V;q++){const N=Number(S[q]),ye=w.ref[g](N)!==void 0&&_[N]||e.OPERATION.DELETE;R(this,c,w,N,ye,o,!1,!0,X)}}return n.changes.clear(),this.encode(o,n,c,"filteredChanges",!1,p),Buffer.concat([c.subarray(0,i),c.subarray(p,o.offset)])}discardChanges(){var i,o;let n=this.root.changes.length;if(n>0){for(;n--;)(i=this.root.changes[n])==null||i.endEncode("changes");this.root.changes.length=0}if(n=this.root.filteredChanges.length,n>0){for(;n--;)(o=this.root.filteredChanges[n])==null||o.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(n,i,o,c){const p=this.context.getTypeId(i),m=this.context.getTypeId(o);if(m===void 0){console.warn(`@colyseus/schema WARNING: Class "${o.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}p!==m&&(n[c.offset++]=213,et.number(n,m,c))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};xn.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let Mn=xn;function sr(f,n){if(n===-1||n>=f.length)return!1;const i=f.length-1;for(let o=n;o<i;o++)f[o]=f[o+1];return f.length=i,!0}class rr extends Error{constructor(n){super(n),this.name="DecodingWarning"}}class yr{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(n,i,o=!0){this.refs.set(n,i),this.refIds.set(i,n),o&&(this.refCounts[n]=(this.refCounts[n]||0)+1),this.deletedRefs.has(n)&&this.deletedRefs.delete(n)}removeRef(n){const i=this.refCounts[n];if(i===void 0){try{throw new rr("trying to remove refId that doesn't exist: "+n)}catch(o){console.warn(o)}return}if(i===0){try{const o=this.refs.get(n);throw new rr(`trying to remove refId '${n}' with 0 refCount (${o.constructor.name}: ${JSON.stringify(o)})`)}catch(o){console.warn(o)}return}(this.refCounts[n]=i-1)<=0&&this.deletedRefs.add(n)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(n=>{if(this.refCounts[n]>0)return;const i=this.refs.get(n);if(i.constructor[Symbol.metadata]!==void 0){const o=i.constructor[Symbol.metadata];for(const c in o){const p=o[c].name,m=typeof i[p]=="object"&&this.refIds.get(i[p]);m&&!this.deletedRefs.has(m)&&this.removeRef(m)}}else typeof i[T]=="function"&&Array.from(i.values()).forEach(o=>{const c=this.refIds.get(o);this.deletedRefs.has(c)||this.removeRef(c)});this.refs.delete(n),delete this.refCounts[n],delete this.callbacks[n]}),this.deletedRefs.clear()}addCallback(n,i,o){if(n===void 0){const c=typeof i=="number"?e.OPERATION[i]:i;throw new Error(`Can't addCallback on '${c}' (refId is undefined)`)}return this.callbacks[n]||(this.callbacks[n]={}),this.callbacks[n][i]||(this.callbacks[n][i]=[]),this.callbacks[n][i].push(o),()=>this.removeCallback(n,i,o)}removeCallback(n,i,o){var p,m,_;const c=(_=(m=(p=this.callbacks)==null?void 0:p[n])==null?void 0:m[i])==null?void 0:_.indexOf(o);c!==void 0&&c!==-1&&sr(this.callbacks[n][i],c)}}class ys{constructor(n,i){this.currentRefId=0,this.setState(n),this.context=i||new Ae(n.constructor)}setState(n){this.state=n,this.root=new yr,this.root.addRef(0,n)}decode(n,i={offset:0},o=this.state){var w,S,x;const c=[],p=this.root,m=n.byteLength;let _=o.constructor[d];for(this.currentRefId=0;i.offset<m;){if(n[i.offset]==255){i.offset++,this.currentRefId=G.number(n,i);const R=p.refs.get(this.currentRefId);if(!R)throw new Error(`"refId" not found: ${this.currentRefId}`);(w=o[J])==null||w.call(o),o=R,_=o.constructor[d];continue}if(_(this,n,i,o,c)===zs){console.warn("@colyseus/schema: definition mismatch");const R={offset:i.offset};for(;i.offset<m&&!(n[i.offset]===255&&(R.offset=i.offset+1,p.refs.has(G.number(n,R))));)i.offset++;continue}}return(S=o[J])==null||S.call(o),(x=this.triggerChanges)==null||x.call(this,c),p.garbageCollectDeletedRefs(),c}getInstanceType(n,i,o){let c;if(n[i.offset]===213){i.offset++;const p=G.number(n,i);c=this.context.get(p)}return c||o}createInstanceOfType(n){return new n}removeChildRefs(n,i){const o=typeof n[T]!="string",c=this.root.refIds.get(n);n.forEach((p,m)=>{i.push({ref:n,refId:c,op:e.OPERATION.DELETE,field:m,value:void 0,previousValue:p}),o&&this.root.removeRef(this.root.refIds.get(p))})}}class cn extends $e{}kt([mt("string")],cn.prototype,"name",void 0),kt([mt("string")],cn.prototype,"type",void 0),kt([mt("number")],cn.prototype,"referencedType",void 0);class zt extends $e{constructor(){super(...arguments),this.fields=new _t}}kt([mt("number")],zt.prototype,"id",void 0),kt([mt("number")],zt.prototype,"extendsId",void 0),kt([mt([cn])],zt.prototype,"fields",void 0);class fn extends $e{constructor(){super(...arguments),this.types=new _t}static encode(n,i={offset:0}){const o=n.context,c=new fn,p=new Mn(c),m=o.schemas.get(n.state.constructor);m>0&&(c.rootType=m);const _=new Set,w={},S=$=>{if($.extendsId===void 0||_.has($.extendsId)){_.add($.id),c.types.push($);const R=w[$.id];R!==void 0&&(delete w[$.id],R.forEach(X=>S(X)))}else w[$.extendsId]===void 0&&(w[$.extendsId]=[]),w[$.extendsId].push($)};o.schemas.forEach(($,R)=>{const X=new zt;X.id=Number($);const q=Object.getPrototypeOf(R);q!==$e&&(X.extendsId=o.schemas.get(q));const V=R[Symbol.metadata];if(V!==q[Symbol.metadata])for(const N in V){const Y=Number(N),ye=V[Y].name;if(!Object.prototype.hasOwnProperty.call(V,ye))continue;const Le=new cn;Le.name=ye;let Ye;const Ze=V[Y];if(typeof Ze.type=="string")Ye=Ze.type;else{let dt;$e.is(Ze.type)?(Ye="ref",dt=Ze.type):(Ye=Object.keys(Ze.type)[0],typeof Ze.type[Ye]=="string"?Ye+=":"+Ze.type[Ye]:dt=Ze.type[Ye]),Le.referencedType=dt?o.getTypeId(dt):-1}Le.type=Ye,X.fields.push(Le)}S(X)});for(const $ in w)w[$].forEach(R=>c.types.push(R));const x=p.encodeAll(i);return Buffer.from(x,0,i.offset)}static decode(n,i){const o=new fn;new ys(o).decode(n,i);const p=new Ae;o.types.forEach(w=>{const S=p.get(w.extendsId)??$e,x=class extends S{};Ae.register(x),p.add(x,w.id)},{});const m=(w,S,x)=>{S.fields.forEach(($,R)=>{const X=x+R;if($.referencedType!==void 0){let q=$.type,V=p.get($.referencedType);if(!V){const N=$.type.split(":");q=N[0],V=N[1]}q==="ref"?Oe.addField(w,X,$.name,V):Oe.addField(w,X,$.name,{[q]:V})}else Oe.addField(w,X,$.name,$.type)})};o.types.forEach(w=>{const S=p.get(w.id),x=Oe.initialize(S),$=[];let R=w;do $.push(R),R=o.types.find(q=>q.id===R.extendsId);while(R);let X=0;$.reverse().forEach(q=>{m(x,q,X),X+=q.fields.length})});const _=new(p.get(o.rootType||0));return new ys(_,p)}}kt([mt([zt])],fn.prototype,"types",void 0),kt([mt("number")],fn.prototype,"rootType",void 0);function Mr(f){const n=f.root,i=n.callbacks,o=new WeakMap;let c;f.triggerChanges=function(_){var S;const w=new Set;for(let x=0,$=_.length;x<$;x++){const R=_[x],X=R.refId,q=R.ref,V=i[X];if(V){if((R.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&R.previousValue instanceof $e){const N=(S=i[n.refIds.get(R.previousValue)])==null?void 0:S[e.OPERATION.DELETE];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y]()}if(q instanceof $e){if(!w.has(X)){const N=V==null?void 0:V[e.OPERATION.REPLACE];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y]()}if(V.hasOwnProperty(R.field)){const N=V[R.field];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.value,R.previousValue)}}else{if((R.op&e.OPERATION.DELETE)===e.OPERATION.DELETE){if(R.previousValue!==void 0){const N=V[e.OPERATION.DELETE];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.previousValue,R.dynamicIndex??R.field)}if((R.op&e.OPERATION.ADD)===e.OPERATION.ADD){const N=V[e.OPERATION.ADD];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.value,R.dynamicIndex??R.field)}}else if((R.op&e.OPERATION.ADD)===e.OPERATION.ADD&&R.previousValue!==R.value){const N=V[e.OPERATION.ADD];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.value,R.dynamicIndex??R.field)}if(R.value!==R.previousValue&&(R.value!==void 0||R.previousValue!==void 0)){const N=V[e.OPERATION.REPLACE];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.value,R.dynamicIndex??R.field)}}w.add(X)}}};function p(_,w){var $;let S=(($=w.instance)==null?void 0:$.constructor[Symbol.metadata])||_,x=w.instance&&typeof w.instance.forEach=="function"||_&&typeof _[Symbol.metadata]>"u";if(S&&!x){const R=function(X,q,V,N){return N&&w.instance[q]!==void 0&&!o.has(c)&&V(w.instance[q],void 0),n.addCallback(n.refIds.get(X),q,V)};return new Proxy({listen:function(q,V,N=!0){if(w.instance)return R(w.instance,q,V,N);{let Y=()=>{};return w.onInstanceAvailable((ye,Le)=>{Y=R(ye,q,V,N&&Le&&!o.has(c))}),()=>Y()}},onChange:function(q){return n.addCallback(n.refIds.get(w.instance),e.OPERATION.REPLACE,q)},bindTo:function(q,V){return V||(V=Object.keys(S).map(N=>S[N].name)),n.addCallback(n.refIds.get(w.instance),e.OPERATION.REPLACE,()=>{V.forEach(N=>q[N]=w.instance[N])})}},{get(X,q){var N;const V=S[S[q]];if(V){const Y=(N=w.instance)==null?void 0:N[q],ye=Le=>{const Ye=m(w.instance).listen(q,(Ze,dt)=>{Le(Ze,!1),Ye==null||Ye()},!1);n.refIds.get(Y)!==void 0&&Le(Y,!0)};return p(V.type,{instance:n.refIds.get(Y)&&Y,parentInstance:w.instance,onInstanceAvailable:ye})}else return X[q]},has(X,q){return S[q]!==void 0},set(X,q,V){throw new Error("not allowed")},deleteProperty(X,q){throw new Error("not allowed")}})}else{const R=function(V,N,Y){return Y&&V.forEach((ye,Le)=>N(ye,Le)),n.addCallback(n.refIds.get(V),e.OPERATION.ADD,(ye,Le)=>{o.set(N,!0),c=N,N(ye,Le),o.delete(N),c=void 0})},X=function(V,N){return n.addCallback(n.refIds.get(V),e.OPERATION.DELETE,N)},q=function(V,N){return n.addCallback(n.refIds.get(V),e.OPERATION.REPLACE,N)};return new Proxy({onAdd:function(V,N=!0){if(w.instance)return R(w.instance,V,N&&!o.has(c));if(w.onInstanceAvailable){let Y=()=>{};return w.onInstanceAvailable((ye,Le)=>{Y=R(ye,V,N&&Le&&!o.has(c))}),()=>Y()}},onRemove:function(V){if(w.instance)return X(w.instance,V);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(Y=>{N=X(Y,V)}),()=>N()}},onChange:function(V){if(w.instance)return q(w.instance,V);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(Y=>{N=q(Y,V)}),()=>N()}}},{get(V,N){if(!V[N])throw new Error(`Can't access '${N}' through callback proxy. access the instance directly.`);return V[N]},has(V,N){return V[N]!==void 0},set(V,N,Y){throw new Error("not allowed")},deleteProperty(V,N){throw new Error("not allowed")}})}}function m(_){return p(void 0,{instance:_})}return m}function Ur(f,n){f.triggerChanges=n}class Fr{constructor(n=!1){this.iterable=n,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,n&&(this.items=[])}add(n,i=Dt,o=!0){var _,w;const c=n==null?void 0:n[h];if(c){if(!c.parent&&c.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${c.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",n),this;const p=n.constructor[Symbol.metadata];this.visible.add(c),this.iterable&&o&&this.items.push(n),o&&c.parent&&this.addParentOf(c,i);let m=this.changes.get(c.refId);if(m===void 0&&(m={},this.changes.set(c.refId,m)),i!==Dt){this.tags||(this.tags=new WeakMap);let S;this.tags.has(c)?S=this.tags.get(c):(S=new Set,this.tags.set(c,S)),S.add(i),(w=(_=p==null?void 0:p[ie])==null?void 0:_[i])==null||w.forEach(x=>{c.getChange(x)!==e.OPERATION.DELETE&&(m[x]=e.OPERATION.ADD)})}else{const S=this.invisible.has(c),x=c.filteredChanges!==void 0?c.allFilteredChanges:c.allChanges;for(let $=0,R=x.operations.length;$<R;$++){const X=x.operations[$];if(X===void 0)continue;const q=c.indexedOperations[X]??e.OPERATION.ADD,V=p==null?void 0:p[X].tag;!c.isNew&&(S||V===void 0||V===i)&&q!==e.OPERATION.DELETE&&(m[X]=q)}}return c.forEachChild((S,x)=>{p&&p[x].tag!==void 0&&p[x].tag!==i||this.add(S.ref,i,!1)}),this}addParentOf(n,i){var p;const o=n.parent[h],c=n.parentIndex;if(!this.visible.has(o)){this.visible.add(o);const m=(p=o.parent)==null?void 0:p[h];m&&m.filteredChanges!==void 0&&this.addParentOf(o,i)}if(o.getChange(c)!==e.OPERATION.DELETE){let m=this.changes.get(o.refId);m===void 0&&(m={},this.changes.set(o.refId,m)),this.tags||(this.tags=new WeakMap);let _;this.tags.has(o)?_=this.tags.get(o):(_=new Set,this.tags.set(o,_)),_.add(i),m[c]=e.OPERATION.ADD}}remove(n,i=Dt,o=!1){var w;const c=n[h];if(!c)return console.warn("StateView#remove(), invalid object:",n),this;this.visible.delete(c),this.iterable&&!o&&sr(this.items,this.items.indexOf(n));const m=c.ref.constructor[Symbol.metadata];let _=this.changes.get(c.refId);if(_===void 0&&(_={},this.changes.set(c.refId,_)),i===Dt){const S=c.parent;if(!Oe.isValidInstance(S)&&c.isFiltered){const x=S[h];let $=this.changes.get(x.refId);$===void 0&&($={},this.changes.set(x.refId,$)),$[c.parentIndex]=e.OPERATION.DELETE}else(w=m==null?void 0:m[ge])==null||w.forEach(x=>_[x]=e.OPERATION.DELETE)}else m==null||m[ie][i].forEach(S=>_[S]=e.OPERATION.DELETE);if(this.tags&&this.tags.has(c)){const S=this.tags.get(c);i===void 0?this.tags.delete(c):(S.delete(i),S.size===0&&this.tags.delete(c))}return this}has(n){return this.visible.has(n[h])}hasTag(n,i=Dt){var c;const o=(c=this.tags)==null?void 0:c.get(n[h]);return(o==null?void 0:o.has(i))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let n=0,i=this.items.length;n<i;n++)this.remove(this.items[n],Dt,!0);this.items.length=0}isChangeTreeVisible(n){let i=this.visible.has(n);return!i&&n.isVisibilitySharedWithParent&&this.visible.has(n.parent[h])&&(this.visible.add(n),i=!0),i}}he("map",{constructor:Lt}),he("array",{constructor:_t}),he("set",{constructor:wn}),he("collection",{constructor:_n}),e.$changes=h,e.$childType=T,e.$decoder=d,e.$deleteByIndex=E,e.$encoder=u,e.$filter=y,e.$getByIndex=g,e.$track=l,e.ArraySchema=_t,e.ChangeTree=Gt,e.CollectionSchema=_n,e.Decoder=ys,e.Encoder=Mn,e.MapSchema=Lt,e.Metadata=Oe,e.Reflection=fn,e.ReflectionField=cn,e.ReflectionType=zt,e.Schema=$e,e.SetSchema=wn,e.StateView=Fr,e.TypeContext=Ae,e.decode=G,e.decodeKeyValueOperation=Bn,e.decodeSchemaOperation=Ws,e.defineCustomTypes=Re,e.defineTypes=Br,e.deprecated=kr,e.dumpChanges=$r,e.encode=et,e.encodeArray=Zs,e.encodeKeyValueOperation=rn,e.encodeSchemaOperation=ps,e.entity=Lr,e.getDecoderStateCallbacks=Mr,e.getRawChangesCallback=Ur,e.registerType=he,e.schema=Js,e.type=mt,e.view=Xs})})(Na,Na.exports);var Qa=Na.exports,Do=zi,ar=Qa;class sh{constructor(t){this.events=t,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(t,e={}){const r=e.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(e.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(t,r),this.wt.ready.then(a=>{console.log("WebTransport ready!",a),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(u=>{this.reader=u.value.readable.getReader(),this.writer=u.value.writable.getWriter(),this.sendSeatReservation(e.room.roomId,e.sessionId,e.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(u=>{console.error("failed to read incoming stream",u),console.error("TODO: close the connection")})}).catch(a=>{console.log("WebTransport not ready!",a),this._close()}),this.wt.closed.then(a=>{console.log("WebTransport closed w/ success",a),this.events.onclose({code:a.closeCode,reason:a.reason})}).catch(a=>{console.log("WebTransport closed w/ error",a),this.events.onerror(a),this.events.onclose({code:a.closeCode,reason:a.reason})}).finally(()=>{this._close()})}send(t){const e=ar.encode.number(this.lengthPrefixBuffer,t.length,{offset:0}),r=new Uint8Array(e+t.length);r.set(this.lengthPrefixBuffer.subarray(0,e),0),r.set(t,e),this.writer.write(r)}sendUnreliable(t){const e=ar.encode.number(this.lengthPrefixBuffer,t.length,{offset:0}),r=new Uint8Array(e+t.length);r.set(this.lengthPrefixBuffer.subarray(0,e),0),r.set(t,e),this.unreliableWriter.write(r)}close(t,e){try{this.wt.close({closeCode:t,reason:e})}catch(r){console.error(r)}}readIncomingData(){return Do.__awaiter(this,void 0,void 0,function*(){let t;for(;this.isOpen;){try{t=yield this.reader.read();const e=t.value,r={offset:0};do{const a=ar.decode.number(e,r);this.events.onmessage({data:e.subarray(r.offset,r.offset+a)}),r.offset+=a}while(r.offset<e.length)}catch(e){e.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",e);break}if(t.done)break}})}readIncomingUnreliableData(){return Do.__awaiter(this,void 0,void 0,function*(){let t;for(;this.isOpen;){try{t=yield this.unreliableReader.read();const e=t.value,r={offset:0};do{const a=ar.decode.number(e,r);this.events.onmessage({data:e.subarray(r.offset,r.offset+a)}),r.offset+=a}while(r.offset<e.length)}catch(e){e.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",e);break}if(t.done)break}})}sendSeatReservation(t,e,r){const a={offset:0},l=[];ar.encode.string(l,t,a),ar.encode.string(l,e,a),r&&ar.encode.string(l,r,a),this.writer.write(new Uint8Array(l).buffer)}_close(){this.isOpen=!1}}yc.H3TransportTransport=sh;var Ec={},rh=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},ih=rh;const fa=globalThis.WebSocket||ih;let ah=class{constructor(t){this.events=t}send(t){this.ws.send(t)}sendUnreliable(t){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(t,e){try{this.ws=new fa(t,{headers:e,protocols:this.protocols})}catch{this.ws=new fa(t,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(t,e){this.ws.close(t,e)}get isOpen(){return this.ws.readyState===fa.OPEN}};Ec.WebSocketTransport=ah;var oh=yc,lh=Ec;let ch=class{constructor(t){switch(this.events={},t){case"h3":this.transport=new oh.H3TransportTransport(this.events);break;default:this.transport=new lh.WebSocketTransport(this.events);break}}connect(t,e){this.transport.connect.call(this.transport,t,e)}send(t){this.transport.send(t)}sendUnreliable(t){this.transport.sendUnreliable(t)}close(t,e){this.transport.close(t,e)}get isOpen(){return this.transport.isOpen}};mc.Connection=ch;var eo={};(function(s){s.Protocol=void 0,function(t){t[t.HANDSHAKE=9]="HANDSHAKE",t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.ERROR=11]="ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",t[t.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",t[t.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(s.Protocol||(s.Protocol={})),s.ErrorCode=void 0,function(t){t[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(s.ErrorCode||(s.ErrorCode={}))})(eo);var Wi={};const bc={};function fh(s,t){bc[s]=t}function uh(s){const t=bc[s];if(!t)throw new Error("missing serializer: "+s);return t}Wi.getSerializer=uh;Wi.registerSerializer=fh;var to={};const dh=()=>({emit(s,...t){let e=this.events[s]||[];for(let r=0,a=e.length;r<a;r++)e[r](...t)},events:{},on(s,t){var e;return!((e=this.events[s])===null||e===void 0)&&e.push(t)||(this.events[s]=[t]),()=>{var r;this.events[s]=(r=this.events[s])===null||r===void 0?void 0:r.filter(a=>t!==a)}}});to.createNanoEvents=dh;var no={};class vc{constructor(){this.handlers=[]}register(t,e=!1){return this.handlers.push(t),this}invoke(...t){this.handlers.forEach(e=>e.apply(this,t))}invokeAsync(...t){return Promise.all(this.handlers.map(e=>e.apply(this,t)))}remove(t){const e=this.handlers.indexOf(t);this.handlers[e]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function hh(){const s=new vc;function t(e){return s.register(e,this===null)}return t.once=e=>{const r=function(...a){e.apply(this,a),s.remove(r)};s.register(r)},t.remove=e=>s.remove(e),t.invoke=(...e)=>s.invoke(...e),t.invokeAsync=(...e)=>s.invokeAsync(...e),t.clear=()=>s.clear(),t}no.EventEmitter=vc;no.createSignal=hh;var Ki={},Si=Qa;function ph(s){try{return Si.getDecoderStateCallbacks(s.serializer.decoder)}catch{return}}let gh=class{setState(t,e){this.decoder.decode(t,e)}getState(){return this.state}patch(t,e){return this.decoder.decode(t,e)}teardown(){this.decoder.root.clearRefs()}handshake(t,e){this.state?(Si.Reflection.decode(t,e),this.decoder=new Si.Decoder(this.state)):(this.decoder=Si.Reflection.decode(t,e),this.state=this.decoder.state)}};Ki.SchemaSerializer=gh;Ki.getStateCallbacks=ph;var Pa;try{Pa=new TextDecoder}catch{}var ue,ss,k=0,gt={},Je,Ls,Pn=0,es=0,jt,Ts,en=[],Xe,Ro={useRecords:!1,mapsAsObjects:!0};class _c{}const so=new _c;so.name="MessagePack 0xC1";var $s=!1,wc=2,mh;try{new Function("")}catch{wc=1/0}class Hs{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,e){if(ue)return xc(()=>(Ui(),this?this.unpack(t,e):Hs.prototype.unpack.call(Ro,t,e)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof e=="object"?(ss=e.end||t.length,k=e.start||0):(k=0,ss=e>-1?e:t.length),es=0,Ls=null,jt=null,ue=t;try{Xe=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw ue=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Hs){if(gt=this,this.structures)return Je=this.structures,wi(e);(!Je||Je.length>0)&&(Je=[])}else gt=Ro,(!Je||Je.length>0)&&(Je=[]);return wi(e)}unpackMultiple(t,e){let r,a=0;try{$s=!0;let l=t.length,u=this?this.unpack(t,l):Yi.unpack(t,l);if(e){if(e(u,a,k)===!1)return;for(;k<l;)if(a=k,e(wi(),a,k)===!1)return}else{for(r=[u];k<l;)a=k,r.push(wi());return r}}catch(l){throw l.lastPosition=a,l.values=r,l}finally{$s=!1,Ui()}}_mergeStructures(t,e){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,a=t.length;r<a;r++){let l=t[r];l&&(l.isShared=!0,r>=32&&(l.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in e||[])if(r>=0){let a=t[r],l=e[r];l&&(a&&((t.restoreStructures||(t.restoreStructures=[]))[r]=a),t[r]=l)}return this.structures=t}decode(t,e){return this.unpack(t,e)}}function wi(s){try{if(!gt.trusted&&!$s){let e=Je.sharedLength||0;e<Je.length&&(Je.length=e)}let t;if(gt.randomAccessStructure&&ue[k]<64&&ue[k]>=32&&mh||(t=Nt()),jt&&(k=jt.postBundlePosition,jt=null),$s&&(Je.restoreStructures=null),k==ss)Je&&Je.restoreStructures&&No(),Je=null,ue=null,Ts&&(Ts=null);else{if(k>ss)throw new Error("Unexpected end of MessagePack data");if(!$s){let e;try{e=JSON.stringify(t,(r,a)=>typeof a=="bigint"?`${a}n`:a).slice(0,100)}catch(r){e="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+e)}}return t}catch(t){throw Je&&Je.restoreStructures&&No(),Ui(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||k>ss)&&(t.incomplete=!0),t}}function No(){for(let s in Je.restoreStructures)Je[s]=Je.restoreStructures[s];Je.restoreStructures=null}function Nt(){let s=ue[k++];if(s<160)if(s<128){if(s<64)return s;{let t=Je[s&63]||gt.getStructures&&Ic()[s&63];return t?(t.read||(t.read=ro(t,s&63)),t.read()):s}}else if(s<144)if(s-=128,gt.mapsAsObjects){let t={};for(let e=0;e<s;e++){let r=Sc();r==="__proto__"&&(r="__proto_"),t[r]=Nt()}return t}else{let t=new Map;for(let e=0;e<s;e++)t.set(Nt(),Nt());return t}else{s-=144;let t=new Array(s);for(let e=0;e<s;e++)t[e]=Nt();return gt.freezeData?Object.freeze(t):t}else if(s<192){let t=s-160;if(es>=k)return Ls.slice(k-Pn,(k+=t)-Pn);if(es==0&&ss<140){let e=t<16?io(t):Tc(t);if(e!=null)return e}return Ca(t)}else{let t;switch(s){case 192:return null;case 193:return jt?(t=Nt(),t>0?jt[1].slice(jt.position1,jt.position1+=t):jt[0].slice(jt.position0,jt.position0-=t)):so;case 194:return!1;case 195:return!0;case 196:if(t=ue[k++],t===void 0)throw new Error("Unexpected end of buffer");return ua(t);case 197:return t=Xe.getUint16(k),k+=2,ua(t);case 198:return t=Xe.getUint32(k),k+=4,ua(t);case 199:return or(ue[k++]);case 200:return t=Xe.getUint16(k),k+=2,or(t);case 201:return t=Xe.getUint32(k),k+=4,or(t);case 202:if(t=Xe.getFloat32(k),gt.useFloat32>2){let e=qi[(ue[k]&127)<<1|ue[k+1]>>7];return k+=4,(e*t+(t>0?.5:-.5)>>0)/e}return k+=4,t;case 203:return t=Xe.getFloat64(k),k+=8,t;case 204:return ue[k++];case 205:return t=Xe.getUint16(k),k+=2,t;case 206:return t=Xe.getUint32(k),k+=4,t;case 207:return gt.int64AsType==="number"?(t=Xe.getUint32(k)*4294967296,t+=Xe.getUint32(k+4)):gt.int64AsType==="string"?t=Xe.getBigUint64(k).toString():gt.int64AsType==="auto"?(t=Xe.getBigUint64(k),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Xe.getBigUint64(k),k+=8,t;case 208:return Xe.getInt8(k++);case 209:return t=Xe.getInt16(k),k+=2,t;case 210:return t=Xe.getInt32(k),k+=4,t;case 211:return gt.int64AsType==="number"?(t=Xe.getInt32(k)*4294967296,t+=Xe.getUint32(k+4)):gt.int64AsType==="string"?t=Xe.getBigInt64(k).toString():gt.int64AsType==="auto"?(t=Xe.getBigInt64(k),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Xe.getBigInt64(k),k+=8,t;case 212:if(t=ue[k++],t==114)return $o(ue[k++]&63);{let e=en[t];if(e)return e.read?(k++,e.read(Nt())):e.noBuffer?(k++,e()):e(ue.subarray(k,++k));throw new Error("Unknown extension "+t)}case 213:return t=ue[k],t==114?(k++,$o(ue[k++]&63,ue[k++])):or(2);case 214:return or(4);case 215:return or(8);case 216:return or(16);case 217:return t=ue[k++],es>=k?Ls.slice(k-Pn,(k+=t)-Pn):Eh(t);case 218:return t=Xe.getUint16(k),k+=2,es>=k?Ls.slice(k-Pn,(k+=t)-Pn):bh(t);case 219:return t=Xe.getUint32(k),k+=4,es>=k?Ls.slice(k-Pn,(k+=t)-Pn):vh(t);case 220:return t=Xe.getUint16(k),k+=2,Co(t);case 221:return t=Xe.getUint32(k),k+=4,Co(t);case 222:return t=Xe.getUint16(k),k+=2,Lo(t);case 223:return t=Xe.getUint32(k),k+=4,Lo(t);default:if(s>=224)return s-256;if(s===void 0){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+s)}}}const yh=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function ro(s,t){function e(){if(e.count++>wc){let a=s.read=new Function("r","return function(){return "+(gt.freezeData?"Object.freeze":"")+"({"+s.map(l=>l==="__proto__"?"__proto_:r()":yh.test(l)?l+":r()":"["+JSON.stringify(l)+"]:r()").join(",")+"})}")(Nt);return s.highByte===0&&(s.read=Po(t,s.read)),a()}let r={};for(let a=0,l=s.length;a<l;a++){let u=s[a];u==="__proto__"&&(u="__proto_"),r[u]=Nt()}return gt.freezeData?Object.freeze(r):r}return e.count=0,s.highByte===0?Po(t,e):e}const Po=(s,t)=>function(){let e=ue[k++];if(e===0)return t();let r=s<32?-(s+(e<<5)):s+(e<<5),a=Je[r]||Ic()[r];if(!a)throw new Error("Record id is not defined for "+r);return a.read||(a.read=ro(a,s)),a.read()};function Ic(){let s=xc(()=>(ue=null,gt.getStructures()));return Je=gt._mergeStructures(s,Je)}var Ca=ui,Eh=ui,bh=ui,vh=ui;let _h=!1;function ui(s){let t;if(s<16&&(t=io(s)))return t;if(s>64&&Pa)return Pa.decode(ue.subarray(k,k+=s));const e=k+s,r=[];for(t="";k<e;){const a=ue[k++];if(!(a&128))r.push(a);else if((a&224)===192){const l=ue[k++]&63;r.push((a&31)<<6|l)}else if((a&240)===224){const l=ue[k++]&63,u=ue[k++]&63;r.push((a&31)<<12|l<<6|u)}else if((a&248)===240){const l=ue[k++]&63,u=ue[k++]&63,d=ue[k++]&63;let y=(a&7)<<18|l<<12|u<<6|d;y>65535&&(y-=65536,r.push(y>>>10&1023|55296),y=56320|y&1023),r.push(y)}else r.push(a);r.length>=4096&&(t+=Ft.apply(String,r),r.length=0)}return r.length>0&&(t+=Ft.apply(String,r)),t}function Co(s){let t=new Array(s);for(let e=0;e<s;e++)t[e]=Nt();return gt.freezeData?Object.freeze(t):t}function Lo(s){if(gt.mapsAsObjects){let t={};for(let e=0;e<s;e++){let r=Sc();r==="__proto__"&&(r="__proto_"),t[r]=Nt()}return t}else{let t=new Map;for(let e=0;e<s;e++)t.set(Nt(),Nt());return t}}var Ft=String.fromCharCode;function Tc(s){let t=k,e=new Array(s);for(let r=0;r<s;r++){const a=ue[k++];if((a&128)>0){k=t;return}e[r]=a}return Ft.apply(String,e)}function io(s){if(s<4)if(s<2){if(s===0)return"";{let t=ue[k++];if((t&128)>1){k-=1;return}return Ft(t)}}else{let t=ue[k++],e=ue[k++];if((t&128)>0||(e&128)>0){k-=2;return}if(s<3)return Ft(t,e);let r=ue[k++];if((r&128)>0){k-=3;return}return Ft(t,e,r)}else{let t=ue[k++],e=ue[k++],r=ue[k++],a=ue[k++];if((t&128)>0||(e&128)>0||(r&128)>0||(a&128)>0){k-=4;return}if(s<6){if(s===4)return Ft(t,e,r,a);{let l=ue[k++];if((l&128)>0){k-=5;return}return Ft(t,e,r,a,l)}}else if(s<8){let l=ue[k++],u=ue[k++];if((l&128)>0||(u&128)>0){k-=6;return}if(s<7)return Ft(t,e,r,a,l,u);let d=ue[k++];if((d&128)>0){k-=7;return}return Ft(t,e,r,a,l,u,d)}else{let l=ue[k++],u=ue[k++],d=ue[k++],y=ue[k++];if((l&128)>0||(u&128)>0||(d&128)>0||(y&128)>0){k-=8;return}if(s<10){if(s===8)return Ft(t,e,r,a,l,u,d,y);{let g=ue[k++];if((g&128)>0){k-=9;return}return Ft(t,e,r,a,l,u,d,y,g)}}else if(s<12){let g=ue[k++],E=ue[k++];if((g&128)>0||(E&128)>0){k-=10;return}if(s<11)return Ft(t,e,r,a,l,u,d,y,g,E);let h=ue[k++];if((h&128)>0){k-=11;return}return Ft(t,e,r,a,l,u,d,y,g,E,h)}else{let g=ue[k++],E=ue[k++],h=ue[k++],T=ue[k++];if((g&128)>0||(E&128)>0||(h&128)>0||(T&128)>0){k-=12;return}if(s<14){if(s===12)return Ft(t,e,r,a,l,u,d,y,g,E,h,T);{let M=ue[k++];if((M&128)>0){k-=13;return}return Ft(t,e,r,a,l,u,d,y,g,E,h,T,M)}}else{let M=ue[k++],J=ue[k++];if((M&128)>0||(J&128)>0){k-=14;return}if(s<15)return Ft(t,e,r,a,l,u,d,y,g,E,h,T,M,J);let F=ue[k++];if((F&128)>0){k-=15;return}return Ft(t,e,r,a,l,u,d,y,g,E,h,T,M,J,F)}}}}}function ko(){let s=ue[k++],t;if(s<192)t=s-160;else switch(s){case 217:t=ue[k++];break;case 218:t=Xe.getUint16(k),k+=2;break;case 219:t=Xe.getUint32(k),k+=4;break;default:throw new Error("Expected string")}return ui(t)}function ua(s){return gt.copyBuffers?Uint8Array.prototype.slice.call(ue,k,k+=s):ue.subarray(k,k+=s)}function or(s){let t=ue[k++];if(en[t]){let e;return en[t](ue.subarray(k,e=k+=s),r=>{k=r;try{return Nt()}finally{k=e}})}else throw new Error("Unknown extension type "+t)}var Bo=new Array(4096);function Sc(){let s=ue[k++];if(s>=160&&s<192){if(s=s-160,es>=k)return Ls.slice(k-Pn,(k+=s)-Pn);if(!(es==0&&ss<180))return Ca(s)}else return k--,Ac(Nt());let t=(s<<5^(s>1?Xe.getUint16(k):s>0?ue[k]:0))&4095,e=Bo[t],r=k,a=k+s-3,l,u=0;if(e&&e.bytes==s){for(;r<a;){if(l=Xe.getUint32(r),l!=e[u++]){r=1879048192;break}r+=4}for(a+=3;r<a;)if(l=ue[r++],l!=e[u++]){r=1879048192;break}if(r===a)return k=r,e.string;a-=3,r=k}for(e=[],Bo[t]=e,e.bytes=s;r<a;)l=Xe.getUint32(r),e.push(l),r+=4;for(a+=3;r<a;)l=ue[r++],e.push(l);let d=s<16?io(s):Tc(s);return d!=null?e.string=d:e.string=Ca(s)}function Ac(s){if(typeof s=="string")return s;if(typeof s=="number"||typeof s=="boolean"||typeof s=="bigint")return s.toString();if(s==null)return s+"";if(gt.allowArraysInMapKeys&&Array.isArray(s)&&s.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return s.flat().toString();throw new Error(`Invalid property type for record: ${typeof s}`)}const $o=(s,t)=>{let e=Nt().map(Ac),r=s;t!==void 0&&(s=s<32?-((t<<5)+s):(t<<5)+s,e.highByte=t);let a=Je[s];return a&&(a.isShared||$s)&&((Je.restoreStructures||(Je.restoreStructures=[]))[s]=a),Je[s]=e,e.read=ro(e,r),e.read()};en[0]=()=>{};en[0].noBuffer=!0;en[66]=s=>{let t=s.length,e=BigInt(s[0]&128?s[0]-256:s[0]);for(let r=1;r<t;r++)e<<=BigInt(8),e+=BigInt(s[r]);return e};let wh={Error,TypeError,ReferenceError};en[101]=()=>{let s=Nt();return(wh[s[0]]||Error)(s[1],{cause:s[2]})};en[105]=s=>{if(gt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Xe.getUint32(k-4);Ts||(Ts=new Map);let e=ue[k],r;e>=144&&e<160||e==220||e==221?r=[]:r={};let a={target:r};Ts.set(t,a);let l=Nt();return a.used?Object.assign(r,l):(a.target=l,l)};en[112]=s=>{if(gt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Xe.getUint32(k-4),e=Ts.get(t);return e.used=!0,e.target};en[115]=()=>new Set(Nt());const Oc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(s=>s+"Array");let Ih=typeof globalThis=="object"?globalThis:window;en[116]=s=>{let t=s[0],e=Oc[t];if(!e){if(t===16){let r=new ArrayBuffer(s.length-1);return new Uint8Array(r).set(s.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new Ih[e](Uint8Array.prototype.slice.call(s,1).buffer)};en[120]=()=>{let s=Nt();return new RegExp(s[0],s[1])};const Th=[];en[98]=s=>{let t=(s[0]<<24)+(s[1]<<16)+(s[2]<<8)+s[3],e=k;return k+=t-s.length,jt=Th,jt=[ko(),ko()],jt.position0=0,jt.position1=0,jt.postBundlePosition=k,k=e,Nt()};en[255]=s=>s.length==4?new Date((s[0]*16777216+(s[1]<<16)+(s[2]<<8)+s[3])*1e3):s.length==8?new Date(((s[0]<<22)+(s[1]<<14)+(s[2]<<6)+(s[3]>>2))/1e6+((s[3]&3)*4294967296+s[4]*16777216+(s[5]<<16)+(s[6]<<8)+s[7])*1e3):s.length==12?new Date(((s[0]<<24)+(s[1]<<16)+(s[2]<<8)+s[3])/1e6+((s[4]&128?-281474976710656:0)+s[6]*1099511627776+s[7]*4294967296+s[8]*16777216+(s[9]<<16)+(s[10]<<8)+s[11])*1e3):new Date("invalid");function xc(s){let t=ss,e=k,r=Pn,a=es,l=Ls,u=Ts,d=jt,y=new Uint8Array(ue.slice(0,ss)),g=Je,E=Je.slice(0,Je.length),h=gt,T=$s,M=s();return ss=t,k=e,Pn=r,es=a,Ls=l,Ts=u,jt=d,ue=y,$s=T,Je=g,Je.splice(0,Je.length,...E),gt=h,Xe=new DataView(ue.buffer,ue.byteOffset,ue.byteLength),M}function Ui(){ue=null,Ts=null,Je=null}function Sh(s){s.unpack?en[s.type]=s.unpack:en[s.type]=s}const qi=new Array(147);for(let s=0;s<256;s++)qi[s]=+("1e"+Math.floor(45.15-s*.30103));const Ah=Hs;var Yi=new Hs({useRecords:!1});const Oh=Yi.unpack,xh=Yi.unpackMultiple,Dh=Yi.unpack,Dc={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let Rc=new Float32Array(1),Mo=new Uint8Array(Rc.buffer,0,4);function Rh(s){Rc[0]=s;let t=qi[(Mo[3]&127)<<1|Mo[2]>>7];return(t*s+(s>0?.5:-.5)>>0)/t}let Ai;try{Ai=new TextEncoder}catch{}let Fi,ao;const Xi=typeof Buffer<"u",Ii=Xi?function(s){return Buffer.allocUnsafeSlow(s)}:Uint8Array,Nc=Xi?Buffer:Uint8Array,Uo=Xi?4294967296:2144337920;let j,Vr,pt,B=0,pn,It=null,Nh;const Ph=21760,Ch=/[\u0080-\uFFFF]/,br=Symbol("record-id");class di extends Hs{constructor(t){super(t),this.offset=0;let e,r,a,l,u=Nc.prototype.utf8Write?function(H,se){return j.utf8Write(H,se,j.byteLength-se)}:Ai&&Ai.encodeInto?function(H,se){return Ai.encodeInto(H,j.subarray(se)).written}:!1,d=this;t||(t={});let y=t&&t.sequential,g=t.structures||t.saveStructures,E=t.maxSharedStructures;if(E==null&&(E=g?32:0),E>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=g?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let T=E>32||h+E>64,M=E+64,J=E+h+64;if(J>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let F=[],z=0,ce=0;this.pack=this.encode=function(H,se){if(j||(j=new Ii(8192),pt=j.dataView||(j.dataView=new DataView(j.buffer,0,8192)),B=0),pn=j.length-10,pn-B<2048?(j=new Ii(j.length),pt=j.dataView||(j.dataView=new DataView(j.buffer,0,j.length)),pn=j.length-10,B=0):B=B+7&2147483640,e=B,se&kc&&(B+=se&255),l=d.structuredClone?new Map:null,d.bundleStrings&&typeof H!="string"?(It=[],It.size=1/0):It=null,a=d.structures,a){a.uninitialized&&(a=d._mergeStructures(d.getStructures()));let ee=a.sharedLength||0;if(ee>E)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+a.sharedLength);if(!a.transitions){a.transitions=Object.create(null);for(let ne=0;ne<ee;ne++){let me=a[ne];if(!me)continue;let De,Ie=a.transitions;for(let We=0,Ge=me.length;We<Ge;We++){let ut=me[We];De=Ie[ut],De||(De=Ie[ut]=Object.create(null)),Ie=De}Ie[br]=ne+64}this.lastNamedStructuresLength=ee}y||(a.nextId=ee+64)}r&&(r=!1);let te;try{d.randomAccessStructure&&H&&H.constructor&&H.constructor===Object?Ve(H):be(H);let ee=It;if(It&&jo(e,be,0),l&&l.idsToInsert){let ne=l.idsToInsert.sort((We,Ge)=>We.offset>Ge.offset?1:-1),me=ne.length,De=-1;for(;ee&&me>0;){let We=ne[--me].offset+e;We<ee.stringsPosition+e&&De===-1&&(De=0),We>ee.position+e?De>=0&&(De+=6):(De>=0&&(pt.setUint32(ee.position+e,pt.getUint32(ee.position+e)+De),De=-1),ee=ee.previous,me++)}De>=0&&ee&&pt.setUint32(ee.position+e,pt.getUint32(ee.position+e)+De),B+=ne.length*6,B>pn&&lt(B),d.offset=B;let Ie=kh(j.subarray(e,B),ne);return l=null,Ie}return d.offset=B,se&Cc?(j.start=e,j.end=B,j):j.subarray(e,B)}catch(ee){throw te=ee,ee}finally{if(a&&(ge(),r&&d.saveStructures)){let ee=a.sharedLength||0,ne=j.subarray(e,B),me=$h(a,d);if(!te)return d.saveStructures(me,me.isCompatible)===!1?d.pack(H,se):(d.lastNamedStructuresLength=ee,j.length>1073741824&&(j=null),ne)}j.length>1073741824&&(j=null),se&Lc&&(B=e)}};const ge=()=>{ce<10&&ce++;let H=a.sharedLength||0;if(a.length>H&&!y&&(a.length=H),z>1e4)a.transitions=null,ce=0,z=0,F.length>0&&(F=[]);else if(F.length>0&&!y){for(let se=0,te=F.length;se<te;se++)F[se][br]=0;F=[]}},ie=H=>{var se=H.length;se<16?j[B++]=144|se:se<65536?(j[B++]=220,j[B++]=se>>8,j[B++]=se&255):(j[B++]=221,pt.setUint32(B,se),B+=4);for(let te=0;te<se;te++)be(H[te])},be=H=>{B>pn&&(j=lt(B));var se=typeof H,te;if(se==="string"){let ee=H.length;if(It&&ee>=4&&ee<4096){if((It.size+=ee)>Ph){let Ie,We=(It[0]?It[0].length*3+It[1].length:0)+10;B+We>pn&&(j=lt(B+We));let Ge;It.position?(Ge=It,j[B]=200,B+=3,j[B++]=98,Ie=B-e,B+=4,jo(e,be,0),pt.setUint16(Ie+e-3,B-e-Ie)):(j[B++]=214,j[B++]=98,Ie=B-e,B+=4),It=["",""],It.previous=Ge,It.size=0,It.position=Ie}let De=Ch.test(H);It[De?0:1]+=H,j[B++]=193,be(De?-ee:ee);return}let ne;ee<32?ne=1:ee<256?ne=2:ee<65536?ne=3:ne=5;let me=ee*3;if(B+me>pn&&(j=lt(B+me)),ee<64||!u){let De,Ie,We,Ge=B+ne;for(De=0;De<ee;De++)Ie=H.charCodeAt(De),Ie<128?j[Ge++]=Ie:Ie<2048?(j[Ge++]=Ie>>6|192,j[Ge++]=Ie&63|128):(Ie&64512)===55296&&((We=H.charCodeAt(De+1))&64512)===56320?(Ie=65536+((Ie&1023)<<10)+(We&1023),De++,j[Ge++]=Ie>>18|240,j[Ge++]=Ie>>12&63|128,j[Ge++]=Ie>>6&63|128,j[Ge++]=Ie&63|128):(j[Ge++]=Ie>>12|224,j[Ge++]=Ie>>6&63|128,j[Ge++]=Ie&63|128);te=Ge-B-ne}else te=u(H,B+ne);te<32?j[B++]=160|te:te<256?(ne<2&&j.copyWithin(B+2,B+1,B+1+te),j[B++]=217,j[B++]=te):te<65536?(ne<3&&j.copyWithin(B+3,B+2,B+2+te),j[B++]=218,j[B++]=te>>8,j[B++]=te&255):(ne<5&&j.copyWithin(B+5,B+3,B+3+te),j[B++]=219,pt.setUint32(B,te),B+=4),B+=te}else if(se==="number")if(H>>>0===H)H<32||H<128&&this.useRecords===!1||H<64&&!this.randomAccessStructure?j[B++]=H:H<256?(j[B++]=204,j[B++]=H):H<65536?(j[B++]=205,j[B++]=H>>8,j[B++]=H&255):(j[B++]=206,pt.setUint32(B,H),B+=4);else if(H>>0===H)H>=-32?j[B++]=256+H:H>=-128?(j[B++]=208,j[B++]=H+256):H>=-32768?(j[B++]=209,pt.setInt16(B,H),B+=2):(j[B++]=210,pt.setInt32(B,H),B+=4);else{let ee;if((ee=this.useFloat32)>0&&H<4294967296&&H>=-2147483648){j[B++]=202,pt.setFloat32(B,H);let ne;if(ee<4||(ne=H*qi[(j[B]&127)<<1|j[B+1]>>7])>>0===ne){B+=4;return}else B--}j[B++]=203,pt.setFloat64(B,H),B+=8}else if(se==="object"||se==="function")if(!H)j[B++]=192;else{if(l){let ne=l.get(H);if(ne){if(!ne.id){let me=l.idsToInsert||(l.idsToInsert=[]);ne.id=me.push(ne)}j[B++]=214,j[B++]=112,pt.setUint32(B,ne.id),B+=4;return}else l.set(H,{offset:B-e})}let ee=H.constructor;if(ee===Object)vt(H);else if(ee===Array)ie(H);else if(ee===Map)if(this.mapAsEmptyObject)j[B++]=128;else{te=H.size,te<16?j[B++]=128|te:te<65536?(j[B++]=222,j[B++]=te>>8,j[B++]=te&255):(j[B++]=223,pt.setUint32(B,te),B+=4);for(let[ne,me]of H)be(ne),be(me)}else{for(let ne=0,me=Fi.length;ne<me;ne++){let De=ao[ne];if(H instanceof De){let Ie=Fi[ne];if(Ie.write){Ie.type&&(j[B++]=212,j[B++]=Ie.type,j[B++]=0);let Ct=Ie.write.call(this,H);Ct===H?Array.isArray(H)?ie(H):vt(H):be(Ct);return}let We=j,Ge=pt,ut=B;j=null;let At;try{At=Ie.pack.call(this,H,Ct=>(j=We,We=null,B+=Ct,B>pn&&lt(B),{target:j,targetView:pt,position:B-Ct}),be)}finally{We&&(j=We,pt=Ge,B=ut,pn=j.length-10)}At&&(At.length+B>pn&&lt(At.length+B),B=Lh(At,j,B,Ie.type));return}}if(Array.isArray(H))ie(H);else{if(H.toJSON){const ne=H.toJSON();if(ne!==H)return be(ne)}if(se==="function")return be(this.writeFunction&&this.writeFunction(H));vt(H)}}}else if(se==="boolean")j[B++]=H?195:194;else if(se==="bigint"){if(H<BigInt(1)<<BigInt(63)&&H>=-(BigInt(1)<<BigInt(63)))j[B++]=211,pt.setBigInt64(B,H);else if(H<BigInt(1)<<BigInt(64)&&H>0)j[B++]=207,pt.setBigUint64(B,H);else if(this.largeBigIntToFloat)j[B++]=203,pt.setFloat64(B,Number(H));else{if(this.largeBigIntToString)return be(H.toString());if(this.useBigIntExtension&&H<BigInt(2)**BigInt(1023)&&H>-(BigInt(2)**BigInt(1023))){j[B++]=199,B++,j[B++]=66;let ee=[],ne;do{let me=H&BigInt(255);ne=(me&BigInt(128))===(H<BigInt(0)?BigInt(128):BigInt(0)),ee.push(me),H>>=BigInt(8)}while(!((H===BigInt(0)||H===BigInt(-1))&&ne));j[B-2]=ee.length;for(let me=ee.length;me>0;)j[B++]=Number(ee[--me]);return}else throw new RangeError(H+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}B+=8}else if(se==="undefined")this.encodeUndefinedAsNil?j[B++]=192:(j[B++]=212,j[B++]=0,j[B++]=0);else throw new Error("Unknown type: "+se)},Fe=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?H=>{let se;if(this.skipValues){se=[];for(let ne in H)(typeof H.hasOwnProperty!="function"||H.hasOwnProperty(ne))&&!this.skipValues.includes(H[ne])&&se.push(ne)}else se=Object.keys(H);let te=se.length;te<16?j[B++]=128|te:te<65536?(j[B++]=222,j[B++]=te>>8,j[B++]=te&255):(j[B++]=223,pt.setUint32(B,te),B+=4);let ee;if(this.coercibleKeyAsNumber)for(let ne=0;ne<te;ne++){ee=se[ne];let me=Number(ee);be(isNaN(me)?ee:me),be(H[ee])}else for(let ne=0;ne<te;ne++)be(ee=se[ne]),be(H[ee])}:H=>{j[B++]=222;let se=B-e;B+=2;let te=0;for(let ee in H)(typeof H.hasOwnProperty!="function"||H.hasOwnProperty(ee))&&(be(ee),be(H[ee]),te++);if(te>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');j[se+++e]=te>>8,j[se+e]=te&255},st=this.useRecords===!1?Fe:t.progressiveRecords&&!T?H=>{let se,te=a.transitions||(a.transitions=Object.create(null)),ee=B++-e,ne;for(let me in H)if(typeof H.hasOwnProperty!="function"||H.hasOwnProperty(me)){if(se=te[me],se)te=se;else{let De=Object.keys(H),Ie=te;te=a.transitions;let We=0;for(let Ge=0,ut=De.length;Ge<ut;Ge++){let At=De[Ge];se=te[At],se||(se=te[At]=Object.create(null),We++),te=se}ee+e+1==B?(B--,Ht(te,De,We)):Qe(te,De,ee,We),ne=!0,te=Ie[me]}be(H[me])}if(!ne){let me=te[br];me?j[ee+e]=me:Qe(te,Object.keys(H),ee,0)}}:H=>{let se,te=a.transitions||(a.transitions=Object.create(null)),ee=0;for(let me in H)(typeof H.hasOwnProperty!="function"||H.hasOwnProperty(me))&&(se=te[me],se||(se=te[me]=Object.create(null),ee++),te=se);let ne=te[br];ne?ne>=96&&T?(j[B++]=((ne-=96)&31)+96,j[B++]=ne>>5):j[B++]=ne:Ht(te,te.__keys__||Object.keys(H),ee);for(let me in H)(typeof H.hasOwnProperty!="function"||H.hasOwnProperty(me))&&be(H[me])},ot=typeof this.useRecords=="function"&&this.useRecords,vt=ot?H=>{ot(H)?st(H):Fe(H)}:st,lt=H=>{let se;if(H>16777216){if(H-e>Uo)throw new Error("Packed buffer would be larger than maximum buffer size");se=Math.min(Uo,Math.round(Math.max((H-e)*(H>67108864?1.25:2),4194304)/4096)*4096)}else se=(Math.max(H-e<<2,j.length-1)>>12)+1<<12;let te=new Ii(se);return pt=te.dataView||(te.dataView=new DataView(te.buffer,0,se)),H=Math.min(H,j.length),j.copy?j.copy(te,0,e,H):te.set(j.slice(e,H)),B-=e,e=0,pn=te.length-10,j=te},Ht=(H,se,te)=>{let ee=a.nextId;ee||(ee=64),ee<M&&this.shouldShareStructure&&!this.shouldShareStructure(se)?(ee=a.nextOwnId,ee<J||(ee=M),a.nextOwnId=ee+1):(ee>=J&&(ee=M),a.nextId=ee+1);let ne=se.highByte=ee>=96&&T?ee-96>>5:-1;H[br]=ee,H.__keys__=se,a[ee-64]=se,ee<M?(se.isShared=!0,a.sharedLength=ee-63,r=!0,ne>=0?(j[B++]=(ee&31)+96,j[B++]=ne):j[B++]=ee):(ne>=0?(j[B++]=213,j[B++]=114,j[B++]=(ee&31)+96,j[B++]=ne):(j[B++]=212,j[B++]=114,j[B++]=ee),te&&(z+=ce*te),F.length>=h&&(F.shift()[br]=0),F.push(H),be(se))},Qe=(H,se,te,ee)=>{let ne=j,me=B,De=pn,Ie=e;j=Vr,B=0,e=0,j||(Vr=j=new Ii(8192)),pn=j.length-10,Ht(H,se,ee),Vr=j;let We=B;if(j=ne,B=me,pn=De,e=Ie,We>1){let Ge=B+We-1;Ge>pn&&lt(Ge);let ut=te+e;j.copyWithin(ut+We,ut+1,B),j.set(Vr.slice(0,We),ut),B=Ge}else j[te+e]=Vr[0]},Ve=H=>{let se=Nh(H,j,e,B,a,lt,(te,ee,ne)=>{if(ne)return r=!0;B=ee;let me=j;return be(te),ge(),me!==j?{position:B,targetView:pt,target:j}:B},this);if(se===0)return vt(H);B=se}}useBuffer(t){j=t,j.dataView||(j.dataView=new DataView(j.buffer,j.byteOffset,j.byteLength)),B=0}set position(t){B=t}get position(){return B}set buffer(t){j=t}get buffer(){return j}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ao=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,_c];Fi=[{pack(s,t,e){let r=s.getTime()/1e3;if((this.useTimestamp32||s.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:a,targetView:l,position:u}=t(6);a[u++]=214,a[u++]=255,l.setUint32(u,r)}else if(r>0&&r<4294967296){let{target:a,targetView:l,position:u}=t(10);a[u++]=215,a[u++]=255,l.setUint32(u,s.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),l.setUint32(u+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),e(this.onInvalidDate());let{target:a,targetView:l,position:u}=t(3);a[u++]=212,a[u++]=255,a[u++]=255}else{let{target:a,targetView:l,position:u}=t(15);a[u++]=199,a[u++]=12,a[u++]=255,l.setUint32(u,s.getMilliseconds()*1e6),l.setBigInt64(u+4,BigInt(Math.floor(r)))}}},{pack(s,t,e){if(this.setAsEmptyObject)return t(0),e({});let r=Array.from(s),{target:a,position:l}=t(this.moreTypes?3:0);this.moreTypes&&(a[l++]=212,a[l++]=115,a[l++]=0),e(r)}},{pack(s,t,e){let{target:r,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(r[a++]=212,r[a++]=101,r[a++]=0),e([s.name,s.message,s.cause])}},{pack(s,t,e){let{target:r,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(r[a++]=212,r[a++]=120,r[a++]=0),e([s.source,s.flags])}},{pack(s,t){this.moreTypes?Fo(s,16,t):Vo(Xi?Buffer.from(s):new Uint8Array(s),t)}},{pack(s,t){let e=s.constructor;e!==Nc&&this.moreTypes?Fo(s,Oc.indexOf(e.name),t):Vo(s,t)}},{pack(s,t){let{target:e,position:r}=t(1);e[r]=193}}];function Fo(s,t,e,r){let a=s.byteLength;if(a+1<256){var{target:l,position:u}=e(4+a);l[u++]=199,l[u++]=a+1}else if(a+1<65536){var{target:l,position:u}=e(5+a);l[u++]=200,l[u++]=a+1>>8,l[u++]=a+1&255}else{var{target:l,position:u,targetView:d}=e(7+a);l[u++]=201,d.setUint32(u,a+1),u+=4}l[u++]=116,l[u++]=t,s.buffer||(s=new Uint8Array(s)),l.set(new Uint8Array(s.buffer,s.byteOffset,s.byteLength),u)}function Vo(s,t){let e=s.byteLength;var r,a;if(e<256){var{target:r,position:a}=t(e+2);r[a++]=196,r[a++]=e}else if(e<65536){var{target:r,position:a}=t(e+3);r[a++]=197,r[a++]=e>>8,r[a++]=e&255}else{var{target:r,position:a,targetView:l}=t(e+5);r[a++]=198,l.setUint32(a,e),a+=4}r.set(s,a)}function Lh(s,t,e,r){let a=s.length;switch(a){case 1:t[e++]=212;break;case 2:t[e++]=213;break;case 4:t[e++]=214;break;case 8:t[e++]=215;break;case 16:t[e++]=216;break;default:a<256?(t[e++]=199,t[e++]=a):a<65536?(t[e++]=200,t[e++]=a>>8,t[e++]=a&255):(t[e++]=201,t[e++]=a>>24,t[e++]=a>>16&255,t[e++]=a>>8&255,t[e++]=a&255)}return t[e++]=r,t.set(s,e),e+=a,e}function kh(s,t){let e,r=t.length*6,a=s.length-r;for(;e=t.pop();){let l=e.offset,u=e.id;s.copyWithin(l+r,l,a),r-=6;let d=l+r;s[d++]=214,s[d++]=105,s[d++]=u>>24,s[d++]=u>>16&255,s[d++]=u>>8&255,s[d++]=u&255,a=l}return s}function jo(s,t,e){if(It.length>0){pt.setUint32(It.position+s,B+e-It.position-s),It.stringsPosition=B-s;let r=It;It=null,t(r[0]),t(r[1])}}function Bh(s){if(s.Class){if(!s.pack&&!s.write)throw new Error("Extension has no pack or write function");if(s.pack&&!s.type)throw new Error("Extension has no type (numeric code to identify the extension)");ao.unshift(s.Class),Fi.unshift(s)}Sh(s)}function $h(s,t){return s.isCompatible=e=>{let r=!e||(t.lastNamedStructuresLength||0)===e.length;return r||t._mergeStructures(e),r},s}let Pc=new di({useRecords:!1});const Mh=Pc.pack,Uh=Pc.pack,Fh=di,{NEVER:Vh,ALWAYS:jh,DECIMAL_ROUND:Hh,DECIMAL_FIT:Gh}=Dc,Cc=512,Lc=1024,kc=2048;function Zh(s,t={}){if(!s||typeof s!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof s[Symbol.iterator]=="function")return zh(s,t);if(typeof s.then=="function"||typeof s[Symbol.asyncIterator]=="function")return Wh(s,t);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*zh(s,t){const e=new di(t);for(const r of s)yield e.pack(r)}async function*Wh(s,t){const e=new di(t);for await(const r of s)yield e.pack(r)}function Kh(s,t={}){if(!s||typeof s!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const e=new Hs(t);let r;const a=l=>{let u;r&&(l=Buffer.concat([r,l]),r=void 0);try{u=e.unpackMultiple(l)}catch(d){if(d.incomplete)r=l.slice(d.lastPosition),u=d.values;else throw d}return u};if(typeof s[Symbol.iterator]=="function")return function*(){for(const u of s)yield*a(u)}();if(typeof s[Symbol.asyncIterator]=="function")return async function*(){for await(const u of s)yield*a(u)}()}const qh=Kh,Yh=Zh,Xh=!1,Jh=!0,Qh=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:jh,C1:so,DECIMAL_FIT:Gh,DECIMAL_ROUND:Hh,Decoder:Ah,Encoder:Fh,FLOAT32_OPTIONS:Dc,NEVER:Vh,Packr:di,RESERVE_START_SPACE:kc,RESET_BUFFER_MODE:Lc,REUSE_BUFFER_MODE:Cc,Unpackr:Hs,addExtension:Bh,clearSource:Ui,decode:Dh,decodeIter:qh,encode:Uh,encodeIter:Yh,isNativeAccelerationEnabled:_h,mapsAsObjects:Jh,pack:Mh,roundFloat32:Rh,unpack:Oh,unpackMultiple:xh,useRecords:Xh},Symbol.toStringTag,{value:"Module"})),ep=Ma(Qh);var tp=mc,Nn=eo,Ho=Wi,np=to,Ti=no,Xt=Qa,sp=Ki,Go=fi,Zo=ep;let rp=class Bc{constructor(t,e){this.onStateChange=Ti.createSignal(),this.onError=Ti.createSignal(),this.onLeave=Ti.createSignal(),this.onJoin=Ti.createSignal(),this.hasJoined=!1,this.onMessageHandlers=np.createNanoEvents(),this.roomId=null,this.name=t,this.packr=new Zo.Packr,this.packr.encode(void 0),e&&(this.serializer=new(Ho.getSerializer("schema")),this.rootSchema=e,this.serializer.state=new e),this.onError((r,a)=>{var l;return(l=console.warn)===null||l===void 0?void 0:l.call(console,`colyseus.js - onError => (${r}) ${a}`)}),this.onLeave(()=>this.removeAllListeners())}connect(t,e,r=this,a,l){const u=new tp.Connection(a.protocol);if(r.connection=u,u.events.onmessage=Bc.prototype.onMessageCallback.bind(r),u.events.onclose=function(d){var y;if(!r.hasJoined){(y=console.warn)===null||y===void 0||y.call(console,`Room connection was closed unexpectedly (${d.code}): ${d.reason}`),r.onError.invoke(d.code,d.reason);return}d.code===Go.CloseCode.DEVMODE_RESTART&&e?e():(r.onLeave.invoke(d.code,d.reason),r.destroy())},u.events.onerror=function(d){var y;(y=console.warn)===null||y===void 0||y.call(console,`Room, onError (${d.code}): ${d.reason}`),r.onError.invoke(d.code,d.reason)},a.protocol==="h3"){const d=new URL(t);u.connect(d.origin,a)}else u.connect(t,l)}leave(t=!0){return new Promise(e=>{this.onLeave(r=>e(r)),this.connection?t?(this.packr.buffer[0]=Nn.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(Go.CloseCode.CONSENTED)})}onMessage(t,e){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),e)}send(t,e){const r={offset:1};this.packr.buffer[0]=Nn.Protocol.ROOM_DATA,typeof t=="string"?Xt.encode.string(this.packr.buffer,t,r):Xt.encode.number(this.packr.buffer,t,r),this.packr.position=0;const a=e!==void 0?this.packr.pack(e,2048+r.offset):this.packr.buffer.subarray(0,r.offset);this.connection.send(a)}sendUnreliable(t,e){const r={offset:1};this.packr.buffer[0]=Nn.Protocol.ROOM_DATA,typeof t=="string"?Xt.encode.string(this.packr.buffer,t,r):Xt.encode.number(this.packr.buffer,t,r),this.packr.position=0;const a=e!==void 0?this.packr.pack(e,2048+r.offset):this.packr.buffer.subarray(0,r.offset);this.connection.sendUnreliable(a)}sendBytes(t,e){const r={offset:1};if(this.packr.buffer[0]=Nn.Protocol.ROOM_DATA_BYTES,typeof t=="string"?Xt.encode.string(this.packr.buffer,t,r):Xt.encode.number(this.packr.buffer,t,r),e.byteLength+r.offset>this.packr.buffer.byteLength){const a=new Uint8Array(r.offset+e.byteLength);a.set(this.packr.buffer),this.packr.useBuffer(a)}this.packr.buffer.set(e,r.offset),this.connection.send(this.packr.buffer.subarray(0,r.offset+e.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof sp.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(t){const e=new Uint8Array(t.data),r={offset:1},a=e[0];if(a===Nn.Protocol.JOIN_ROOM){const l=Xt.decode.utf8Read(e,r,e[r.offset++]);if(this.serializerId=Xt.decode.utf8Read(e,r,e[r.offset++]),!this.serializer){const u=Ho.getSerializer(this.serializerId);this.serializer=new u}e.byteLength>r.offset&&this.serializer.handshake&&this.serializer.handshake(e,r),this.reconnectionToken=`${this.roomId}:${l}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=Nn.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(a===Nn.Protocol.ERROR){const l=Xt.decode.number(e,r),u=Xt.decode.string(e,r);this.onError.invoke(l,u)}else if(a===Nn.Protocol.LEAVE_ROOM)this.leave();else if(a===Nn.Protocol.ROOM_STATE)this.serializer.setState(e,r),this.onStateChange.invoke(this.serializer.getState());else if(a===Nn.Protocol.ROOM_STATE_PATCH)this.serializer.patch(e,r),this.onStateChange.invoke(this.serializer.getState());else if(a===Nn.Protocol.ROOM_DATA){const l=Xt.decode.stringCheck(e,r)?Xt.decode.string(e,r):Xt.decode.number(e,r),u=e.byteLength>r.offset?Zo.unpack(e,{start:r.offset}):void 0;this.dispatchMessage(l,u)}else if(a===Nn.Protocol.ROOM_DATA_BYTES){const l=Xt.decode.stringCheck(e,r)?Xt.decode.string(e,r):Xt.decode.number(e,r);this.dispatchMessage(l,e.subarray(r.offset))}}dispatchMessage(t,e){var r;const a=this.getMessageHandlerKey(t);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,e):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,e):(r=console.warn)===null||r===void 0||r.call(console,`colyseus.js: onMessage() not registered for type '${t}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(t){switch(typeof t){case"string":return t;case"number":return`i${t}`;default:throw new Error("invalid message type.")}}};Ja.Room=rp;var $c={};function zo(s,t){t.headers=s.headers||{},t.statusMessage=s.statusText,t.statusCode=s.status,t.data=s.response}function Zn(s,t,e){return new Promise(function(r,a){e=e||{};var l=new XMLHttpRequest,u,d,y,g=e.body,E=e.headers||{};e.timeout&&(l.timeout=e.timeout),l.ontimeout=l.onerror=function(h){h.timeout=h.type=="timeout",a(h)},l.open(s,t.href||t),l.onload=function(){for(y=l.getAllResponseHeaders().trim().split(/[\r\n]+/),zo(l,l);d=y.shift();)d=d.split(": "),l.headers[d.shift().toLowerCase()]=d.join(": ");if(d=l.headers["content-type"],d&&~d.indexOf("application/json"))try{l.data=JSON.parse(l.data,e.reviver)}catch(h){return zo(l,h),a(h)}(l.status>=400?a:r)(l)},typeof FormData<"u"&&g instanceof FormData||g&&typeof g=="object"&&(E["content-type"]="application/json",g=JSON.stringify(g)),l.withCredentials=!!e.withCredentials;for(u in E)l.setRequestHeader(u,E[u]);l.send(g)})}var ip=Zn.bind(Zn,"GET"),ap=Zn.bind(Zn,"POST"),op=Zn.bind(Zn,"PATCH"),lp=Zn.bind(Zn,"DELETE"),cp=Zn.bind(Zn,"PUT");const fp=Object.freeze(Object.defineProperty({__proto__:null,del:lp,get:ip,patch:op,post:ap,put:cp,send:Zn},Symbol.toStringTag,{value:"Module"})),up=Ma(fp);var dp=fi,hp=up;function pp(s){var t=Object.create(null);return s&&Object.keys(s).forEach(function(e){if(e!=="default"){var r=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(t,e,r.get?r:{enumerable:!0,get:function(){return s[e]}})}}),t.default=s,Object.freeze(t)}var gp=pp(hp);let mp=class{constructor(t,e={}){this.client=t,this.headers=e}get(t,e={}){return this.request("get",t,e)}post(t,e={}){return this.request("post",t,e)}del(t,e={}){return this.request("del",t,e)}put(t,e={}){return this.request("put",t,e)}request(t,e,r={}){return gp[t](this.client.getHttpEndpoint(e),this.getOptions(r)).catch(a=>{var l;const u=a.statusCode,d=((l=a.data)===null||l===void 0?void 0:l.error)||a.statusMessage||a.message;throw!u&&!d?a:new dp.ServerError(u,d)})}getOptions(t){return t.headers=Object.assign({},this.headers,t.headers),this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(t.withCredentials=!0),t}};$c.HTTP=mp;var oo={},Ji={},Wo=zi;let lr;function lo(){if(!lr)try{lr=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!lr&&typeof globalThis.indexedDB<"u"&&(lr=new vp),lr||(lr={cache:{},setItem:function(s,t){this.cache[s]=t},getItem:function(s){this.cache[s]},removeItem:function(s){delete this.cache[s]}}),lr}function yp(s,t){lo().setItem(s,t)}function Ep(s){lo().removeItem(s)}function bp(s,t){const e=lo().getItem(s);typeof Promise>"u"||!(e instanceof Promise)?t(e):e.then(r=>t(r))}class vp{constructor(){this.dbPromise=new Promise(t=>{const e=indexedDB.open("_colyseus_storage",1);e.onupgradeneeded=()=>e.result.createObjectStore("store"),e.onsuccess=()=>t(e.result)})}tx(t,e){return Wo.__awaiter(this,void 0,void 0,function*(){const a=(yield this.dbPromise).transaction("store",t).objectStore("store");return e(a)})}setItem(t,e){return this.tx("readwrite",r=>r.put(e,t)).then()}getItem(t){return Wo.__awaiter(this,void 0,void 0,function*(){const e=yield this.tx("readonly",r=>r.get(t));return new Promise(r=>{e.onsuccess=()=>r(e.result)})})}removeItem(t){return this.tx("readwrite",e=>e.delete(t)).then()}}Ji.getItem=bp;Ji.removeItem=Ep;Ji.setItem=yp;var Ut=zi,da=Ji,_p=to,Oi,La,Rs,xi;let wp=class{constructor(t){this.http=t,this.settings={path:"/auth",key:"colyseus-auth-token"},Oi.set(this,!1),La.set(this,void 0),Rs.set(this,void 0),xi.set(this,_p.createNanoEvents()),da.getItem(this.settings.key,e=>this.token=e)}set token(t){this.http.authToken=t}get token(){return this.http.authToken}onChange(t){const e=Ut.__classPrivateFieldGet(this,xi,"f").on("change",t);return Ut.__classPrivateFieldGet(this,Oi,"f")||Ut.__classPrivateFieldSet(this,La,new Promise((r,a)=>{this.getUserData().then(l=>{this.emitChange(Object.assign(Object.assign({},l),{token:this.token}))}).catch(l=>{this.emitChange({user:null,token:void 0})}).finally(()=>{r()})}),"f"),Ut.__classPrivateFieldSet(this,Oi,!0,"f"),e}getUserData(){return Ut.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(t,e,r){return Ut.__awaiter(this,void 0,void 0,function*(){const a=(yield this.http.post(`${this.settings.path}/register`,{body:{email:t,password:e,options:r}})).data;return this.emitChange(a),a})}signInWithEmailAndPassword(t,e){return Ut.__awaiter(this,void 0,void 0,function*(){const r=(yield this.http.post(`${this.settings.path}/login`,{body:{email:t,password:e}})).data;return this.emitChange(r),r})}signInAnonymously(t){return Ut.__awaiter(this,void 0,void 0,function*(){const e=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:t}})).data;return this.emitChange(e),e})}sendPasswordResetEmail(t){return Ut.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:t}})).data})}signInWithProvider(t){return Ut.__awaiter(this,arguments,void 0,function*(e,r={}){return new Promise((a,l)=>{const u=r.width||480,d=r.height||768,y=this.token?`?token=${this.token}`:"",g=`Login with ${e[0].toUpperCase()+e.substring(1)}`,E=this.http.client.getHttpEndpoint(`${r.prefix||`${this.settings.path}/provider`}/${e}${y}`),h=screen.width/2-u/2,T=screen.height/2-d/2;Ut.__classPrivateFieldSet(this,Rs,window.open(E,g,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+u+", height="+d+", top="+T+", left="+h),"f");const M=F=>{F.data.user===void 0&&F.data.token===void 0||(clearInterval(J),Ut.__classPrivateFieldGet(this,Rs,"f").close(),Ut.__classPrivateFieldSet(this,Rs,void 0,"f"),window.removeEventListener("message",M),F.data.error!==void 0?l(F.data.error):(a(F.data),this.emitChange(F.data)))},J=setInterval(()=>{(!Ut.__classPrivateFieldGet(this,Rs,"f")||Ut.__classPrivateFieldGet(this,Rs,"f").closed)&&(Ut.__classPrivateFieldSet(this,Rs,void 0,"f"),l("cancelled"),window.removeEventListener("message",M))},200);window.addEventListener("message",M)})})}signOut(){return Ut.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(t){t.token!==void 0&&(this.token=t.token,t.token===null?da.removeItem(this.settings.key):da.setItem(this.settings.key,t.token)),Ut.__classPrivateFieldGet(this,xi,"f").emit("change",t)}};Oi=new WeakMap,La=new WeakMap,Rs=new WeakMap,xi=new WeakMap;oo.Auth=wp;var Mc={};function Ip(s){var t;const e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.hostname)||"localhost",r=s.hostname.split("."),a=!s.hostname.includes("trycloudflare.com")&&!s.hostname.includes("discordsays.com")&&r.length>2?`/${r[0]}`:"";return s.pathname.startsWith("/.proxy")?`${s.protocol}//${e}${a}${s.pathname}${s.search}`:`${s.protocol}//${e}/.proxy/colyseus${a}${s.pathname}${s.search}`}Mc.discordURLBuilder=Ip;var bs=zi,Tp=fi,Sp=Ja,Ap=$c,Op=oo,xp=Mc,ha;class Qi extends Error{constructor(t,e){super(t),this.code=e,this.name="MatchMakeError",Object.setPrototypeOf(this,Qi.prototype)}}const Ko=typeof window<"u"&&typeof((ha=window==null?void 0:window.location)===null||ha===void 0?void 0:ha.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class Uc{constructor(t=Ko,e){var r,a;if(typeof t=="string"){const l=t.startsWith("/")?new URL(t,Ko):new URL(t),u=l.protocol==="https:"||l.protocol==="wss:",d=Number(l.port||(u?443:80));this.settings={hostname:l.hostname,pathname:l.pathname,port:d,secure:u}}else t.port===void 0&&(t.port=t.secure?443:80),t.pathname===void 0&&(t.pathname=""),this.settings=t;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new Ap.HTTP(this,(e==null?void 0:e.headers)||{}),this.auth=new Op.Auth(this.http),this.urlBuilder=e==null?void 0:e.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((a=(r=window==null?void 0:window.location)===null||r===void 0?void 0:r.hostname)===null||a===void 0)&&a.includes("discordsays.com"))&&(this.urlBuilder=xp.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(t){return bs.__awaiter(this,arguments,void 0,function*(e,r={},a){return yield this.createMatchMakeRequest("joinOrCreate",e,r,a)})}create(t){return bs.__awaiter(this,arguments,void 0,function*(e,r={},a){return yield this.createMatchMakeRequest("create",e,r,a)})}join(t){return bs.__awaiter(this,arguments,void 0,function*(e,r={},a){return yield this.createMatchMakeRequest("join",e,r,a)})}joinById(t){return bs.__awaiter(this,arguments,void 0,function*(e,r={},a){return yield this.createMatchMakeRequest("joinById",e,r,a)})}reconnect(t,e){return bs.__awaiter(this,void 0,void 0,function*(){if(typeof t=="string"&&typeof e=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[r,a]=t.split(":");if(!r||!a)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",r,{reconnectionToken:a},e)})}consumeSeatReservation(t,e,r){return bs.__awaiter(this,void 0,void 0,function*(){const a=this.createRoom(t.room.name,e);a.roomId=t.room.roomId,a.sessionId=t.sessionId;const l={sessionId:a.sessionId};t.reconnectionToken&&(l.reconnectionToken=t.reconnectionToken);const u=r||a;return a.connect(this.buildEndpoint(t.room,l,t.protocol),t.devMode&&(()=>bs.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${a.roomId}'...`);let d=0,y=8;const g=()=>bs.__awaiter(this,void 0,void 0,function*(){d++;try{yield this.consumeSeatReservation(t,e,u),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${a.roomId}'`)}catch{d<y?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${d} out of ${y})`),setTimeout(g,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(g,2e3)})),u,t,this.http.headers),new Promise((d,y)=>{const g=(E,h)=>y(new Tp.ServerError(E,h));u.onError.once(g),u.onJoin.once(()=>{u.onError.remove(g),d(u)})})})}createMatchMakeRequest(t,e){return bs.__awaiter(this,arguments,void 0,function*(r,a,l={},u,d){const y=(yield this.http.post(`matchmake/${r}/${a}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)})).data;if(y.error)throw new Qi(y.error,y.code);return r==="reconnect"&&(y.reconnectionToken=l.reconnectionToken),yield this.consumeSeatReservation(y,u,d)})}createRoom(t,e){return new Sp.Room(t,e)}buildEndpoint(t,e={},r="ws"){const a=[];this.http.authToken&&(e._authToken=this.http.authToken);for(const d in e)e.hasOwnProperty(d)&&a.push(`${d}=${e[d]}`);r==="h3"&&(r="http");let l=this.settings.secure?`${r}s://`:`${r}://`;t.publicAddress?l+=`${t.publicAddress}`:l+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const u=`${l}/${t.processId}/${t.roomId}?${a.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(u)):u}getHttpEndpoint(t=""){const e=t.startsWith("/")?t:`/${t}`,r=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${e}`;return this.urlBuilder?this.urlBuilder(new URL(r)):r}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}Uc.VERSION="0.16.17";Ya.Client=Uc;Ya.MatchMakeError=Qi;var Fc={};class Dp{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}}Fc.NoneSerializer=Dp;(function(s){var t=Ya,e=eo,r=Ja,a=oo,l=fi,u=Ki,d=Fc,y=Wi;y.registerSerializer("schema",u.SchemaSerializer),y.registerSerializer("none",d.NoneSerializer),s.Client=t.Client,s.MatchMakeError=t.MatchMakeError,Object.defineProperty(s,"ErrorCode",{enumerable:!0,get:function(){return e.ErrorCode}}),Object.defineProperty(s,"Protocol",{enumerable:!0,get:function(){return e.Protocol}}),s.Room=r.Room,s.Auth=a.Auth,s.ServerError=l.ServerError,s.SchemaSerializer=u.SchemaSerializer,s.getStateCallbacks=u.getStateCallbacks,s.registerSerializer=y.registerSerializer})(Hn);let A=null,qo=null,ks=new Map;async function co(){return A?new Promise(s=>{const t=setTimeout(()=>{console.error("loadAllCardData: Timeout while waiting for card data"),s(!1)},5e3);A.send("getAllCards"),A.onMessage("allCards",e=>{clearTimeout(t),console.log(`Received ${e.length} cards from server`),ks.clear(),e.forEach(r=>{ks.set(r.id,r)}),s(!0)})}):!1}async function Vc(s,t){const e=location.host.includes("localhost")?"ws://localhost:4001":`wss://${location.host}/.proxy/api`;qo=new Hn.Client(e);try{console.log("Attempting to join or create Colyseus room..."),A=await qo.joinOrCreate("game",{accessToken:s,username:t}),console.log("Successfully joined room:",A.roomId),console.log("Session ID:",A.sessionId),console.log("Initial room state:",A.state.toJSON()),console.log("Loading all card data..."),await co(),console.log("Card data loaded, cache size:",ks.size),A.onStateChange(r=>{}),A.onError((r,a)=>{console.error("Colyseus room error:",r,a),A=null}),A.onLeave(r=>{console.log("Left Colyseus room, code:",r),A=null})}catch(r){throw console.error("Failed to connect to Colyseus:",r),r instanceof ProgressEvent?(console.error("Connection failed: Network error (ProgressEvent). Potential causes:"),console.error("- Colyseus server might not be running or accessible at the target URL:",e),console.error("- WebSocket connection blocked by firewall or proxy."),console.error("- Incorrect WebSocket proxy configuration on the deployment server (if applicable)."),alert("Failed to connect to game server: Network Error. Please ensure the server is running and accessible.")):r instanceof Error?(console.error("Connection failed due to error:",r.message),alert(`Failed to connect to game server: ${r.message}`)):(console.error("Connection failed due to unknown error:",r),alert("Failed to connect to game server: An unknown error occurred.")),A=null,r}}let gn;const jc=new URLSearchParams(window.location.search),fo=jc.get("frame_id")!=null;let Bs;const ka="1363939642289946886",pa=ea("user_id"),Rp=ea("guild_id"),Np=ea("channel_id"),Pp=async()=>{if(fo){const s=ka;console.log("Discord SDK: Using embedded client ID:",s),Bs=new Zd(s),await Bs.ready()}else{Bs=new Vl(ka,Rp,Np);const s=String(pa.charCodeAt(0)%5),t={access_token:"mock_token",user:{username:pa,discriminator:s,id:pa,avatar:null,public_flags:1},scopes:[],expires:new Date(2112,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}};Bs._updateCommandMocks({authenticate:async()=>(gn=t,console.log("Mock Authentication successful:",gn),await Vc(gn.access_token,gn.user.username),t),authorize:async()=>(console.log("Mock Authorize called"),{code:"mock_code"})})}},Cp=async()=>{if(!fo){console.log("Running locally, attempting mock authentication...");try{return await Bs.commands.authenticate({}),!0}catch(t){return console.error("Mock authentication failed:",t),!1}}let s="authorize";try{console.log("Requesting Discord authorization...");const{code:t}=await Bs.commands.authorize({client_id:ka,response_type:"code",state:"",prompt:"none",scope:["identify","guilds"]});console.log("Authorization code received:",t),s="fetchToken",console.log("Fetching access token from /.proxy/api/token...");const e=await fetch("/.proxy/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})});if(console.log("Token fetch response received. Status:",e.status),!e.ok){const a=await e.text();throw console.error("Token fetch failed:",e.status,e.statusText,a),new Error(`Token fetch failed: ${e.status} ${e.statusText} - ${a}`)}const{access_token:r}=await e.json();if(console.log("Access token received successfully."),s="discordAuthenticate",console.log("Authenticating with Discord SDK..."),gn=await Bs.commands.authenticate({access_token:r}),!(gn!=null&&gn.user))throw console.error("Discord SDK Authentication failed: No user data received.",gn),new Error("Discord SDK Authentication failed to return user data.");console.log("Discord SDK Authentication successful:",gn.user.username),s="connectColyseus",console.log("Connecting to Colyseus...");try{await Vc(gn.access_token,gn.user.username),console.log("Colyseus connection successful.")}catch(a){throw console.error("Colyseus connection failed:",a),a}return!0}catch(t){return console.error(`Error during step: ${s}`),console.error("Discord authorization or Colyseus connection failed:",t),t instanceof ProgressEvent?console.error("Network error (ProgressEvent) occurred, likely during fetch."):t.message&&t.message.includes("Token fetch failed")?console.error("Error specifically during token fetch step."):s==="connectColyseus"&&console.error("Error specifically during Colyseus connection step."),gn=null,!1}},Lp=()=>gn?gn.user.username:!fo&&Bs instanceof Vl?ea("user_id")||"MockUser":"User";function ea(s){const t=jc.get(s);if(t!=null)return t;const e=sessionStorage.getItem(s);if(e!=null)return e;const r=Math.random().toString(36).slice(2,10);return sessionStorage.setItem(s,r),r}class kp extends os.Scene{constructor(){super("Boot")}preload(){this.load.setPath("/assets"),this.load.image("background","bg.png"),this.load.image("fridge_bg","fridge_bg.png")}create(){this.scene.start("Preloader")}}class Bp extends os.Scene{constructor(){super("Game");fe(this,"room")}async create(){this.scene.launch("background"),this.add.image(this.cameras.main.width*.5,this.cameras.main.height*.4,"grid").setScale(.6),await this.connect(),this.room.state.draggables.onAdd((r,a)=>{const l=this.add.image(r.x,r.y,a).setInteractive();l.name=a,l.setScale(.8),this.input.setDraggable(l),l.on("drag",(u,d,y)=>{this.room&&(l.x=Phaser.Math.Clamp(d,l.displayWidth/2,Number(this.game.config.width)-l.displayWidth/2),l.y=Phaser.Math.Clamp(y,l.displayHeight/2,Number(this.game.config.height)-l.displayHeight/2),this.room.send("move",{imageId:a,x:l.x,y:l.y}))})}),this.add.text(this.cameras.main.width*.5,this.cameras.main.height*.95,`Connected as: ${Lp()}`,{font:"14px Arial",color:"#000000"}).setOrigin(.5)}async connect(){const e=location.host==="localhost:3000"?"ws://localhost:3001":`wss://${location.host}/.proxy/api/colyseus`,r=new Hn.Client(`${e}`);try{this.room=await r.joinOrCreate("some_other_room",{screenWidth:this.game.config.width,screenHeight:this.game.config.height}),this.room.onMessage("move",a=>{}),console.log("Successfully connected!")}catch(a){console.log(`Could not connect with the server: ${a}`)}}}class $p extends os.Scene{constructor(){super("MainMenu");fe(this,"statusText")}create(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let r=this.cameras.main.width/e.width+.2,a=this.cameras.main.height/e.height+.2,l=Math.max(r,a);e.setScale(l).setScrollFactor(0),this.add.text(Number(this.game.config.width)*.5,300,"Legends of the Friend",{fontFamily:"Arial Black",fontSize:58,color:"#ffff00",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(Number(this.game.config.width)*.5,460,"Click to Start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,520,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.input.once("pointerdown",async()=>{this.statusText.setText("Authorizing with Discord..."),await Cp()?(this.statusText.setText("Connecting to server..."),await new Promise(d=>setTimeout(d,1e3)),A?(this.statusText.setText("Loading game data..."),await co()?(this.statusText.setText("Connected! Entering Lobby..."),this.scene.start("Lobby")):this.statusText.setText("Failed to load game data. Please try again.")):this.statusText.setText("Failed to connect to server. Please try again.")):this.statusText.setText("Discord authorization failed. Please try again.")})}}class Mp extends os.Scene{constructor(){super("Preloader")}init(){const t=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let e=this.cameras.main.width/t.width+.2,r=this.cameras.main.height/t.height+.2,a=Math.max(e,r);t.setScale(a).setScrollFactor(0),this.add.rectangle(Number(this.game.config.width)*.5,Number(this.game.config.height)*.5,468,32).setStrokeStyle(1,16777215);const l=this.add.rectangle(Number(this.game.config.width)*.5-230,Number(this.game.config.height)*.5,4,28,16777215);this.load.on("progress",u=>{l.width=4+460*u})}preload(){this.load.setPath("/assets"),this.load.image("logo","logo.png"),this.load.image("cardFullTier1","CardFullTier1.png"),this.load.image("cardMinionTier1","CardMinionTier1.png")}create(){this.scene.start("MainMenu")}}class Up extends os.Scene{constructor(){super("background")}create(){this.cameras.main.setBackgroundColor(11393254),this.scene.sendToBack()}}var Ba={exports:{}};(function(s,t){(function(e,r){r(t)})($a,function(e){e.OPERATION=void 0,function(f){f[f.ADD=128]="ADD",f[f.REPLACE=0]="REPLACE",f[f.DELETE=64]="DELETE",f[f.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",f[f.MOVE_AND_ADD=160]="MOVE_AND_ADD",f[f.DELETE_AND_ADD=192]="DELETE_AND_ADD",f[f.CLEAR=10]="CLEAR",f[f.REVERSE=15]="REVERSE",f[f.MOVE=32]="MOVE",f[f.DELETE_BY_REFID=33]="DELETE_BY_REFID",f[f.ADD_BY_REFID=129]="ADD_BY_REFID"}(e.OPERATION||(e.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const l=Symbol("$track"),u=Symbol("$encoder"),d=Symbol("$decoder"),y=Symbol("$filter"),g=Symbol("$getByIndex"),E=Symbol("$deleteByIndex"),h=Symbol("$changes"),T=Symbol("$childType"),M=Symbol("$onEncodeEnd"),J=Symbol("$onDecodeEnd"),F=Symbol("$descriptors"),z="$__numFields",ce="$__refTypeFieldIndexes",ge="$__viewFieldIndexes",ie="$__fieldIndexesByViewTag";let be;try{be=new TextEncoder}catch{}const Fe=new ArrayBuffer(8),st=new Int32Array(Fe),ot=new Float32Array(Fe),vt=new Float64Array(Fe),lt=new BigInt64Array(Fe),Qe=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(f,n){for(var i=0,o=0,c=0,p=f.length;c<p;c++)i=f.charCodeAt(c),i<128?o+=1:i<2048?o+=2:i<55296||i>=57344?o+=3:(c++,o+=4);return o};function Ve(f,n,i){for(var o=0,c=0,p=n.length;c<p;c++)o=n.charCodeAt(c),o<128?f[i.offset++]=o:o<2048?(f[i.offset]=192|o>>6,f[i.offset+1]=128|o&63,i.offset+=2):o<55296||o>=57344?(f[i.offset]=224|o>>12,f[i.offset+1]=128|o>>6&63,f[i.offset+2]=128|o&63,i.offset+=3):(c++,o=65536+((o&1023)<<10|n.charCodeAt(c)&1023),f[i.offset]=240|o>>18,f[i.offset+1]=128|o>>12&63,f[i.offset+2]=128|o>>6&63,f[i.offset+3]=128|o&63,i.offset+=4)}function H(f,n,i){f[i.offset++]=n&255}function se(f,n,i){f[i.offset++]=n&255}function te(f,n,i){f[i.offset++]=n&255,f[i.offset++]=n>>8&255}function ee(f,n,i){f[i.offset++]=n&255,f[i.offset++]=n>>8&255}function ne(f,n,i){f[i.offset++]=n&255,f[i.offset++]=n>>8&255,f[i.offset++]=n>>16&255,f[i.offset++]=n>>24&255}function me(f,n,i){const o=n>>24,c=n>>16,p=n>>8,m=n;f[i.offset++]=m&255,f[i.offset++]=p&255,f[i.offset++]=c&255,f[i.offset++]=o&255}function De(f,n,i){const o=Math.floor(n/Math.pow(2,32)),c=n>>>0;me(f,c,i),me(f,o,i)}function Ie(f,n,i){const o=n/Math.pow(2,32)>>0,c=n>>>0;me(f,c,i),me(f,o,i)}function We(f,n,i){lt[0]=BigInt.asIntN(64,n),ne(f,st[0],i),ne(f,st[1],i)}function Ge(f,n,i){lt[0]=BigInt.asIntN(64,n),ne(f,st[0],i),ne(f,st[1],i)}function ut(f,n,i){ot[0]=n,ne(f,st[0],i)}function At(f,n,i){vt[0]=n,ne(f,st[0],i),ne(f,st[1],i)}function Ct(f,n,i){f[i.offset++]=n?1:0}function As(f,n,i){n||(n="");let o=Qe(n,"utf8"),c=0;if(o<32)f[i.offset++]=o|160,c=1;else if(o<256)f[i.offset++]=217,f[i.offset++]=o%255,c=2;else if(o<65536)f[i.offset++]=218,ee(f,o,i),c=3;else if(o<4294967296)f[i.offset++]=219,me(f,o,i),c=5;else throw new Error("String too long");return Ve(f,n,i),c+o}function Ke(f,n,i){if(isNaN(n))return Ke(f,0,i);if(isFinite(n)){if(n!==(n|0))return Math.abs(n)<=34028235e31&&(ot[0]=n,Math.abs(Math.abs(ot[0])-Math.abs(n))<1e-4)?(f[i.offset++]=202,ut(f,n,i),5):(f[i.offset++]=203,At(f,n,i),9)}else return Ke(f,n>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,i);return n>=0?n<128?(f[i.offset++]=n&255,1):n<256?(f[i.offset++]=204,f[i.offset++]=n&255,2):n<65536?(f[i.offset++]=205,ee(f,n,i),3):n<4294967296?(f[i.offset++]=206,me(f,n,i),5):(f[i.offset++]=207,Ie(f,n,i),9):n>=-32?(f[i.offset++]=224|n+32,1):n>=-128?(f[i.offset++]=208,H(f,n,i),2):n>=-32768?(f[i.offset++]=209,te(f,n,i),3):n>=-2147483648?(f[i.offset++]=210,ne(f,n,i),5):(f[i.offset++]=211,De(f,n,i),9)}const et={int8:H,uint8:se,int16:te,uint16:ee,int32:ne,uint32:me,int64:De,uint64:Ie,bigint64:We,biguint64:Ge,float32:ut,float64:At,boolean:Ct,string:As,number:Ke,utf8Write:Ve,utf8Length:Qe},tn=new ArrayBuffer(8),ft=new Int32Array(tn),cs=new Float32Array(tn),fs=new Float64Array(tn),us=new BigUint64Array(tn),ds=new BigInt64Array(tn);function Wn(f,n,i){for(var o="",c=0,p=n.offset,m=n.offset+i;p<m;p++){var _=f[p];if(!(_&128)){o+=String.fromCharCode(_);continue}if((_&224)===192){o+=String.fromCharCode((_&31)<<6|f[++p]&63);continue}if((_&240)===224){o+=String.fromCharCode((_&15)<<12|(f[++p]&63)<<6|(f[++p]&63)<<0);continue}if((_&248)===240){c=(_&7)<<18|(f[++p]&63)<<12|(f[++p]&63)<<6|(f[++p]&63)<<0,c>=65536?(c-=65536,o+=String.fromCharCode((c>>>10)+55296,(c&1023)+56320)):o+=String.fromCharCode(c);continue}console.error("Invalid byte "+_.toString(16))}return n.offset+=i,o}function Kn(f,n){return nn(f,n)<<24>>24}function nn(f,n){return f[n.offset++]}function qn(f,n){return vn(f,n)<<16>>16}function vn(f,n){return f[n.offset++]|f[n.offset++]<<8}function it(f,n){return f[n.offset++]|f[n.offset++]<<8|f[n.offset++]<<16|f[n.offset++]<<24}function Mt(f,n){return it(f,n)>>>0}function Yn(f,n){return ft[0]=it(f,n),cs[0]}function Ln(f,n){return ft[0]=it(f,n),ft[1]=it(f,n),fs[0]}function Se(f,n){const i=Mt(f,n);return it(f,n)*Math.pow(2,32)+i}function qt(f,n){const i=Mt(f,n);return Mt(f,n)*Math.pow(2,32)+i}function b(f,n){return ft[0]=it(f,n),ft[1]=it(f,n),ds[0]}function I(f,n){return ft[0]=it(f,n),ft[1]=it(f,n),us[0]}function D(f,n){return nn(f,n)>0}function P(f,n){const i=f[n.offset++];let o;return i<192?o=i&31:i===217?o=nn(f,n):i===218?o=vn(f,n):i===219&&(o=Mt(f,n)),Wn(f,n,o)}function Z(f,n){const i=f[n.offset++];if(i<128)return i;if(i===202)return Yn(f,n);if(i===203)return Ln(f,n);if(i===204)return nn(f,n);if(i===205)return vn(f,n);if(i===206)return Mt(f,n);if(i===207)return qt(f,n);if(i===208)return Kn(f,n);if(i===209)return qn(f,n);if(i===210)return it(f,n);if(i===211)return Se(f,n);if(i>223)return(255-i+1)*-1}function U(f,n){const i=f[n.offset];return i<192&&i>160||i===217||i===218||i===219}const G={utf8Read:Wn,int8:Kn,uint8:nn,int16:qn,uint16:vn,int32:it,uint32:Mt,float32:Yn,float64:Ln,int64:Se,uint64:qt,bigint64:b,biguint64:I,boolean:D,string:P,number:Z,stringCheck:U},K={},Q=new Map;function he(f,n){n.constructor&&(Q.set(n.constructor,f),K[f]=n),n.encode&&(et[f]=n.encode),n.decode&&(G[f]=n.decode)}function xe(f){return K[f]}function Re(f){for(const n in f)he(n,f[n]);return n=>mt(n)}const wt=class wt{static register(n){const i=Object.getPrototypeOf(n);if(i!==$e){let o=wt.inheritedTypes.get(i);o||(o=new Set,wt.inheritedTypes.set(i,o)),o.add(n)}}static cache(n){let i=wt.cachedContexts.get(n);return i||(i=new wt(n),wt.cachedContexts.set(n,i)),i}constructor(n){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},n&&this.discoverTypes(n)}has(n){return this.schemas.has(n)}get(n){return this.types[n]}add(n,i=this.schemas.size){return this.schemas.has(n)?!1:(this.types[i]=n,n[Symbol.metadata]===void 0&&Oe.initialize(n),this.schemas.set(n,i),!0)}getTypeId(n){return this.schemas.get(n)}discoverTypes(n,i,o,c){var _,w;if(c&&this.registerFilteredByParent(n,i,o),!this.add(n))return;(_=wt.inheritedTypes.get(n))==null||_.forEach(S=>{this.discoverTypes(S,i,o,c)});let p=n;for(;(p=Object.getPrototypeOf(p))&&p!==$e&&p!==Function.prototype;)this.discoverTypes(p);const m=n[w=Symbol.metadata]??(n[w]={});m[ge]&&(this.hasFilters=!0);for(const S in m){const x=S,$=m[x].type,R=m[x].tag!==void 0;if(typeof $!="string")if(Array.isArray($)){const X=$[0];if(X==="string")continue;this.discoverTypes(X,n,x,c||R)}else if(typeof $=="function")this.discoverTypes($,n,x,c||R);else{const X=Object.values($)[0];if(typeof X=="string")continue;this.discoverTypes(X,n,x,c||R)}}}registerFilteredByParent(n,i,o){let p=`${this.schemas.get(n)??this.schemas.size}`;i&&(p+=`-${this.schemas.get(i)}`),p+=`-${o}`,this.parentFiltered[p]=!0}debug(){let n="";for(const i in this.parentFiltered){const o=i.split("-").map(Number),c=o.pop();n+=`
		`,n+=`${i}: ${o.reverse().map((p,m)=>{const _=this.types[p],w=_[Symbol.metadata];let S=_.name;return m===0&&(S+=`[${w[c].name}]`),`${S}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${n}`}};wt.inheritedTypes=new Map,wt.cachedContexts=new Map;let Ae=wt;function xt(f){return Array.isArray(f)?{array:f[0]}:typeof f.type<"u"?f.type:f}const Oe={addField(f,n,i,o,c){if(n>64)throw new Error(`Can't define field '${i}'.
Schema instances may only have up to 64 fields.`);f[n]=Object.assign(f[n]||{},{type:xt(o),index:n,name:i}),Object.defineProperty(f,F,{value:f[F]||{},enumerable:!1,configurable:!0}),c?(f[F][i]=c,f[F][`_${i}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):f[F][i]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(f,z,{value:n,enumerable:!1,configurable:!0}),Object.defineProperty(f,i,{value:n,enumerable:!1,configurable:!0}),typeof f[n].type!="string"&&(f[ce]===void 0&&Object.defineProperty(f,ce,{value:[],enumerable:!1,configurable:!0}),f[ce].push(n))},setTag(f,n,i){const o=f[n],c=f[o];c.tag=i,f[ge]||(Object.defineProperty(f,ge,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(f,ie,{value:{},enumerable:!1,configurable:!0})),f[ge].push(o),f[ie][i]||(f[ie][i]=[]),f[ie][i].push(o)},setFields(f,n){const i=f.prototype.constructor;Ae.register(i);const o=Object.getPrototypeOf(i),c=o&&o[Symbol.metadata],p=Oe.initialize(i);i[l]||(i[l]=$e[l]),i[u]||(i[u]=$e[u]),i[d]||(i[d]=$e[d]),i.prototype.toJSON||(i.prototype.toJSON=$e.prototype.toJSON);let m=p[z]??(c&&c[z])??-1;m++;for(const _ in n){const w=n[_],S=Array.isArray(w)?xe("array"):typeof Object.keys(w)[0]=="string"&&xe(Object.keys(w)[0]),x=S?Object.values(w)[0]:xt(w);Oe.addField(p,m,_,w,on(`_${_}`,m,x,S)),m++}return f},isDeprecated(f,n){return f[n].deprecated===!0},init(f){const n={};f[Symbol.metadata]=n,Object.defineProperty(n,z,{value:0,enumerable:!1,configurable:!0})},initialize(f){const n=Object.getPrototypeOf(f),i=n[Symbol.metadata];let o=f[Symbol.metadata]??Object.create(null);return n!==$e&&o===i&&(o=Object.create(null),i&&(Object.setPrototypeOf(o,i),Object.defineProperty(o,z,{value:i[z],enumerable:!1,configurable:!0,writable:!0}),i[ge]!==void 0&&(Object.defineProperty(o,ge,{value:[...i[ge]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,ie,{value:{...i[ie]},enumerable:!1,configurable:!0,writable:!0})),i[ce]!==void 0&&Object.defineProperty(o,ce,{value:[...i[ce]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,F,{value:{...i[F]},enumerable:!1,configurable:!0,writable:!0}))),f[Symbol.metadata]=o,o},isValidInstance(f){return f.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(f.constructor[Symbol.metadata],z)},getFields(f){const n=f[Symbol.metadata],i={};for(let o=0;o<=n[z];o++)i[n[o].name]=n[o].type;return i},hasViewTagAtIndex(f,n){var i;return(i=f==null?void 0:f[ge])==null?void 0:i.includes(n)}};function sn(){return{indexes:{},operations:[]}}function rt(f,n){const i=f.indexes[n];i===void 0?f.indexes[n]=f.operations.push(n)-1:f.operations[i]=n}function hs(f,n){var o;let i=f.indexes[n];i===void 0&&(i=Object.values(f.indexes).at(-1),n=(o=Object.entries(f.indexes).find(([c,p])=>p===i))==null?void 0:o[0]),f.operations[i]=void 0,delete f.indexes[n]}function qe(f,n,i,o=n[i].queueRootIndex){if(f)f[i][o]!==n&&(n[i].queueRootIndex=f[i].push(n)-1);else return}class Gt{constructor(n){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=n;const i=n.constructor[Symbol.metadata];i!=null&&i[ge]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(n){var o;this.root=n,this.checkIsFiltered(this.parent,this.parentIndex);const i=this.ref.constructor[Symbol.metadata];i?(o=i[ce])==null||o.forEach(c=>{const p=i[c],m=this.ref[p.name];m==null||m[h].setRoot(n)}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((c,p)=>{c[h].setRoot(n)})}setParent(n,i,o){var p;if(this.parent=n,this.parentIndex=o,!i)return;i!==this.root?(this.root=i,this.checkIsFiltered(n,o)):i.add(this);const c=this.ref.constructor[Symbol.metadata];c?(p=c[ce])==null||p.forEach(m=>{const _=c[m],w=this.ref[_.name];w==null||w[h].setParent(this.ref,i,m)}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((m,_)=>{m[h].setParent(this.ref,i,this.indexes[_]??_)})}forEachChild(n){var o;const i=this.ref.constructor[Symbol.metadata];i?(o=i[ce])==null||o.forEach(c=>{const p=i[c],m=this.ref[p.name];m&&n(m[h],c)}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((c,p)=>{n(c[h],this.indexes[p]??p)})}operation(n){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-n),qe(this.root,this,"filteredChanges")):(this.changes.operations.push(-n),qe(this.root,this,"changes"))}change(n,i=e.OPERATION.ADD){var _;const o=this.ref.constructor[Symbol.metadata],c=this.isFiltered||((_=o==null?void 0:o[n])==null?void 0:_.tag)!==void 0,p=c?this.filteredChanges:this.changes,m=this.indexedOperations[n];if(!m||m===e.OPERATION.DELETE){const w=m&&m===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:i;this.indexedOperations[n]=w}rt(p,n),c?(rt(this.allFilteredChanges,n),this.root&&(qe(this.root,this,"filteredChanges"),qe(this.root,this,"allFilteredChanges"))):(rt(this.allChanges,n),qe(this.root,this,"changes"))}shiftChangeIndexes(n){const i=this.isFiltered?this.filteredChanges:this.changes,o={},c={};for(const p in this.indexedOperations)o[Number(p)+n]=this.indexedOperations[p],c[Number(p)+n]=i.indexes[p];this.indexedOperations=o,i.indexes=c,i.operations=i.operations.map(p=>p+n)}shiftAllChangeIndexes(n,i=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(n,i,this.allFilteredChanges),this._shiftAllChangeIndexes(n,i,this.allChanges)):this._shiftAllChangeIndexes(n,i,this.allChanges)}_shiftAllChangeIndexes(n,i=0,o){const c={};let p=0;for(const m in o.indexes)c[p++]=o.indexes[m];o.indexes=c;for(let m=0;m<o.operations.length;m++){const _=o.operations[m];_>i&&(o.operations[m]=_+n)}}indexedOperation(n,i,o=n){this.indexedOperations[n]=i,this.filteredChanges!==void 0?(rt(this.allFilteredChanges,o),rt(this.filteredChanges,n),qe(this.root,this,"filteredChanges")):(rt(this.allChanges,o),rt(this.changes,n),qe(this.root,this,"changes"))}getType(n){return Oe.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][n].type:this.ref[T]}getChange(n){return this.indexedOperations[n]}getValue(n,i=!1){return this.ref[g](n,i)}delete(n,i,o=n){var m;if(n===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${n}'`)}catch(_){console.warn(_)}return}const c=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[n]=i??e.OPERATION.DELETE,rt(c,n),hs(this.allChanges,o);const p=this.getValue(n);return p&&p[h]&&((m=this.root)==null||m.remove(p[h])),this.filteredChanges!==void 0?(hs(this.allFilteredChanges,o),qe(this.root,this,"filteredChanges")):qe(this.root,this,"changes"),p}endEncode(n){var i,o;this.indexedOperations={},this[n].indexes={},this[n].operations.length=0,this[n].queueRootIndex=void 0,(o=(i=this.ref)[M])==null||o.call(i),this.isNew=!1}discard(n=!1){var i,o;(o=(i=this.ref)[M])==null||o.call(i),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),n&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((c,p)=>{var m;return(m=this.root)==null?void 0:m.remove(c)}))}discardAll(){const n=Object.keys(this.indexedOperations);for(let i=0,o=n.length;i<o;i++){const c=this.getValue(Number(n[i]));c&&c[h]&&c[h].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(n,i){const o=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(n,i),this.filteredChanges!==void 0&&(qe(this.root,this,"filteredChanges"),o&&this.root.allFilteredChanges.push(this))),this.isFiltered||(qe(this.root,this,"changes"),o&&this.root.allChanges.push(this))}_checkFilteredByParent(n,i){if(!n)return;const o=Oe.isValidInstance(this.ref)?this.ref.constructor:this.ref[T];let c,p=!Oe.isValidInstance(n);p?(c=n[h],n=c.parent,i=c.parentIndex):c=n[h];const m=n.constructor;let _=`${this.root.types.getTypeId(o)}`;m&&(_+=`-${this.root.types.schemas.get(m)}`),_+=`-${i}`;const w=Oe.hasViewTagAtIndex(m==null?void 0:m[Symbol.metadata],i);this.isFiltered=n[h].isFiltered||this.root.types.parentFiltered[_]||w,this.isFiltered&&(this.isVisibilitySharedWithParent=c.isFiltered&&typeof o!="string"&&!w&&p,this.filteredChanges||(this.filteredChanges=sn(),this.allFilteredChanges=sn()),this.changes.operations.length>0&&(this.changes.operations.forEach(S=>rt(this.filteredChanges,S)),this.allChanges.operations.forEach(S=>rt(this.allFilteredChanges,S)),this.changes=sn(),this.allChanges=sn()))}}function kn(f,n,i,o,c,p){var m;typeof i=="string"?(m=et[i])==null||m.call(et,n,o,p):i[Symbol.metadata]!==void 0?(et.number(n,o[h].refId,p),(c&e.OPERATION.ADD)===e.OPERATION.ADD&&f.tryEncodeTypeId(n,i,o.constructor,p)):et.number(n,o[h].refId,p)}const ps=function(f,n,i,o,c,p,m,_,w){if(n[p.offset++]=(o|c)&255,c===e.OPERATION.DELETE)return;const S=i.ref,x=w[o];kn(f,n,w[o].type,S[x.name],c,p)},rn=function(f,n,i,o,c,p){if(n[p.offset++]=c&255,c===e.OPERATION.CLEAR||(et.number(n,o,p),c===e.OPERATION.DELETE))return;const m=i.ref;if((c&e.OPERATION.ADD)===e.OPERATION.ADD&&typeof m.set=="function"){const S=i.ref.$indexes.get(o);et.string(n,S,p)}const _=m[T],w=m[g](o);kn(f,n,_,w,c,p)},Zs=function(f,n,i,o,c,p,m,_){const w=i.ref,S=_&&i.isFiltered&&typeof i.getType(o)!="string";let x;if(S?(x=w.tmpItems[o][h].refId,c===e.OPERATION.DELETE?c=e.OPERATION.DELETE_BY_REFID:c===e.OPERATION.ADD&&(c=e.OPERATION.ADD_BY_REFID)):x=o,n[p.offset++]=c&255,c===e.OPERATION.CLEAR||c===e.OPERATION.REVERSE||(et.number(n,x,p),c===e.OPERATION.DELETE||c===e.OPERATION.DELETE_BY_REFID))return;const $=i.getType(o),R=i.getValue(o,m);kn(f,n,$,R,c,p)},zs=-1;function gs(f,n,i,o,c,p,m,_){const w=f.root,S=i[g](o);let x;if((n&e.OPERATION.DELETE)===e.OPERATION.DELETE){const $=w.refIds.get(S);$!==void 0&&w.removeRef($),n!==e.OPERATION.DELETE_AND_ADD&&i[E](o),x=void 0}if(n!==e.OPERATION.DELETE)if($e.is(c)){const $=G.number(p,m);if(x=w.refs.get($),(n&e.OPERATION.ADD)===e.OPERATION.ADD){const R=f.getInstanceType(p,m,c);x||(x=f.createInstanceOfType(R)),w.addRef($,x,x!==S||n===e.OPERATION.DELETE_AND_ADD&&x===S)}}else if(typeof c=="string")x=G[c](p,m);else{const $=xe(Object.keys(c)[0]),R=G.number(p,m),X=w.refs.has(R)?S||w.refs.get(R):new $.constructor;if(x=X.clone(!0),x[T]=Object.values(c)[0],S){let q=w.refIds.get(S);if(q!==void 0&&R!==q){const V=S.entries();let N;for(;(N=V.next())&&!N.done;){const[Y,ye]=N.value;typeof ye=="object"&&(q=w.refIds.get(ye),w.removeRef(q)),_.push({ref:S,refId:q,op:e.OPERATION.DELETE,field:Y,value:void 0,previousValue:ye})}}}w.addRef(R,x,X!==S||n===e.OPERATION.DELETE_AND_ADD&&X===S)}return{value:x,previousValue:S}}const Ws=function(f,n,i,o,c){const p=n[i.offset++],m=o.constructor[Symbol.metadata],_=p>>6<<6,w=p%(_||255),S=m[w];if(S===void 0)return console.warn("@colyseus/schema: field not defined at",{index:w,ref:o.constructor.name,metadata:m}),zs;const{value:x,previousValue:$}=gs(f,_,o,w,S.type,n,i,c);x!=null&&(o[S.name]=x),$!==x&&c.push({ref:o,refId:f.currentRefId,op:_,field:S.name,value:x,previousValue:$})},Bn=function(f,n,i,o,c){const p=n[i.offset++];if(p===e.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}const m=G.number(n,i),_=o[T];let w;(p&e.OPERATION.ADD)===e.OPERATION.ADD?typeof o.set=="function"?(w=G.string(n,i),o.setIndex(m,w)):w=m:w=o.getIndex(m);const{value:S,previousValue:x}=gs(f,p,o,m,_,n,i,c);if(S!=null){if(typeof o.set=="function")o.$items.set(w,S);else if(typeof o.$setAt=="function")o.$setAt(m,S,p);else if(typeof o.add=="function"){const $=o.add(S);typeof $=="number"&&o.setIndex($,$)}}x!==S&&c.push({ref:o,refId:f.currentRefId,op:p,field:"",dynamicIndex:w,value:S,previousValue:x})},Os=function(f,n,i,o,c){let p=n[i.offset++],m;if(p===e.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}else if(p===e.OPERATION.REVERSE){o.reverse();return}else if(p===e.OPERATION.DELETE_BY_REFID){const $=G.number(n,i),R=f.root.refs.get($);m=o.findIndex(X=>X===R),o[E](m),c.push({ref:o,refId:f.currentRefId,op:e.OPERATION.DELETE,field:"",dynamicIndex:m,value:void 0,previousValue:R});return}else if(p===e.OPERATION.ADD_BY_REFID){const $=G.number(n,i),R=f.root.refs.get($);R&&(m=o.findIndex(X=>X===R)),(m===-1||m===void 0)&&(m=o.length)}else m=G.number(n,i);const _=o[T];let w=m;const{value:S,previousValue:x}=gs(f,p,o,m,_,n,i,c);S!=null&&S!==x&&o.$setAt(m,S,p),x!==S&&c.push({ref:o,refId:f.currentRefId,op:p,field:"",dynamicIndex:w,value:S,previousValue:x})};class ms extends Error{}function mr(f,n,i,o){let c,p=!1;switch(n){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(f)&&console.log(`trying to encode "NaN" in ${i.constructor.name}#${o}`);break;case"bigint64":case"biguint64":c="bigint";break;case"string":c="string",p=!0;break;case"boolean":return;default:return}if(typeof f!==c&&(!p||p&&f!==null)){let m=`'${JSON.stringify(f)}'${f&&f.constructor&&` (${f.constructor.name})`||""}`;throw new ms(`a '${c}' was expected, but ${m} was provided in ${i.constructor.name}#${o}`)}}function Zt(f,n,i,o){if(!(f instanceof n))throw new ms(`a '${n.name}' was expected, but '${f&&f.constructor.name}' was provided in ${i.constructor.name}#${o}`)}var Ks,qs;const Cr=(f,n)=>{const i=f.toString(),o=n.toString();return i<o?-1:i>o?1:0},yt=class yt{static[(Ks=u,qs=d,y)](n,i,o){var c;return!o||typeof n[T]=="string"||o.isChangeTreeVisible((c=n.tmpItems[i])==null?void 0:c[h])}static is(n){return Array.isArray(n)||n.array!==void 0}static from(n){return new yt(...Array.from(n))}constructor(...n){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const i=new Proxy(this,{get:(o,c)=>typeof c!="symbol"&&!isNaN(c)?this.items[c]:Reflect.get(o,c),set:(o,c,p)=>{var m;if(typeof c!="symbol"&&!isNaN(c)){if(p==null)o.$deleteAt(c);else{if(p[h]){Zt(p,o[T],o,c);const _=o.items[c];o.isMovingItems?(_!==void 0?p[h].isNew?o[h].indexedOperation(Number(c),e.OPERATION.MOVE_AND_ADD):(o[h].getChange(Number(c))&e.OPERATION.DELETE)===e.OPERATION.DELETE?o[h].indexedOperation(Number(c),e.OPERATION.DELETE_AND_MOVE):o[h].indexedOperation(Number(c),e.OPERATION.MOVE):p[h].isNew&&o[h].indexedOperation(Number(c),e.OPERATION.ADD),p[h].setParent(this,o[h].root,c)):o.$changeAt(Number(c),p),_!==void 0&&((m=_[h].root)==null||m.remove(_[h]))}else o.$changeAt(Number(c),p);o.items[c]=p,o.tmpItems[c]=p}return!0}else return Reflect.set(o,c,p)},deleteProperty:(o,c)=>(typeof c=="number"?o.$deleteAt(c):delete o[c],!0),has:(o,c)=>typeof c!="symbol"&&!isNaN(Number(c))?Reflect.has(this.items,c):Reflect.has(o,c)});return this[h]=new Gt(i),this[h].indexes={},n.length>0&&this.push(...n),i}set length(n){n===0?this.clear():n<this.items.length?this.splice(n,this.length-n):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...n){var c;let i=this.tmpItems.length;const o=this[h];for(let p=0,m=n.length;p<n.length;p++,i++){const _=n[p];if(_==null)return;typeof _=="object"&&this[T]&&Zt(_,this[T],this,p),o.indexedOperation(i,e.OPERATION.ADD,this.items.length),this.items.push(_),this.tmpItems.push(_),(c=_[h])==null||c.setParent(this,o.root,i)}return i}pop(){let n=-1;for(let i=this.tmpItems.length-1;i>=0;i--)if(this.deletedIndexes[i]!==!0){n=i;break}if(!(n<0))return this[h].delete(n,void 0,this.items.length-1),this.deletedIndexes[n]=!0,this.items.pop()}at(n){return n<0&&(n+=this.length),this.items[n]}$changeAt(n,i){var p;if(i==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[n]===i)return;const o=this.items[n]!==void 0?typeof i=="object"?e.OPERATION.DELETE_AND_ADD:e.OPERATION.REPLACE:e.OPERATION.ADD,c=this[h];c.change(n,o),(p=i[h])==null||p.setParent(this,c.root,n)}$deleteAt(n,i){this[h].delete(n,i)}$setAt(n,i,o){n===0&&o===e.OPERATION.ADD&&this.items[n]!==void 0?this.items.unshift(i):o===e.OPERATION.DELETE_AND_MOVE?(this.items.splice(n,1),this.items[n]=i):this.items[n]=i}clear(){if(this.items.length===0)return;const n=this[h];n.forEachChild((i,o)=>{i.discard(!0);const c=i.root;c!==void 0&&(c.removeChangeFromChangeSet("changes",i),c.removeChangeFromChangeSet("allChanges",i),c.removeChangeFromChangeSet("allFilteredChanges",i))}),n.discard(!0),n.operation(e.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...n){return new yt(...this.items.concat(...n))}join(n){return this.items.join(n)}reverse(){return this[h].operation(e.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const n=this[h],i=this.tmpItems.findIndex(c=>c===this.items[0]),o=this.items.findIndex(c=>c===this.items[0]);return n.delete(i,e.OPERATION.DELETE,o),n.shiftAllChangeIndexes(-1,o),this.items.shift()}slice(n,i){const o=new yt;return o.push(...this.items.slice(n,i)),o}sort(n=Cr){this.isMovingItems=!0;const i=this[h];return this.items.sort(n).forEach((c,p)=>i.change(p,e.OPERATION.REPLACE)),this.tmpItems.sort(n),this.isMovingItems=!1,this}splice(n,i,...o){var S;const c=this[h],p=this.items.length,m=this.tmpItems.length,_=o.length,w=[];for(let x=0;x<m;x++)this.deletedIndexes[x]!==!0&&w.push(x);if(p>n){i===void 0&&(i=p-n);for(let x=n;x<n+i;x++){const $=w[x];c.delete($,e.OPERATION.DELETE),this.deletedIndexes[$]=!0}}else i=0;if(_>0){if(_>i)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let x=0;x<_;x++){const $=(w[n]??p)+x;c.indexedOperation($,this.deletedIndexes[$]?e.OPERATION.DELETE_AND_ADD:e.OPERATION.ADD),(S=o[x][h])==null||S.setParent(this,c.root,$)}}return i>_&&c.shiftAllChangeIndexes(-(i-_),w[n+_]),c.filteredChanges!==void 0?qe(c.root,c,"filteredChanges"):qe(c.root,c,"changes"),this.items.splice(n,i,...o)}unshift(...n){const i=this[h];return i.shiftChangeIndexes(n.length),i.isFiltered?rt(i.filteredChanges,this.items.length):rt(i.allChanges,this.items.length),n.forEach((o,c)=>{i.change(c,e.OPERATION.ADD)}),this.tmpItems.unshift(...n),this.items.unshift(...n)}indexOf(n,i){return this.items.indexOf(n,i)}lastIndexOf(n,i=this.length-1){return this.items.lastIndexOf(n,i)}every(n,i){return this.items.every(n,i)}some(n,i){return this.items.some(n,i)}forEach(n,i){return this.items.forEach(n,i)}map(n,i){return this.items.map(n,i)}filter(n,i){return this.items.filter(n,i)}reduce(n,i){return this.items.reduce(n,i)}reduceRight(n,i){return this.items.reduceRight(n,i)}find(n,i){return this.items.find(n,i)}findIndex(n,i){return this.items.findIndex(n,i)}fill(n,i,o){throw new Error("ArraySchema#fill() not implemented")}copyWithin(n,i,o){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return yt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(n,i){return this.items.includes(n,i)}flatMap(n,i){throw new Error("ArraySchema#flatMap() is not supported.")}flat(n){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...n){return this.items.findLastIndex.apply(this.items,arguments)}with(n,i){const o=this.items.slice();return n<0&&(n+=this.length),o[n]=i,new yt(...o)}toReversed(){return this.items.slice().reverse()}toSorted(n){return this.items.slice().sort(n)}toSpliced(n,i,...o){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(n=>{let i=this.items.length;for(;i!=0;){let o=Math.floor(Math.random()*i);i--,[this[i],this[o]]=[this[o],this[i]]}})}move(n){return this.isMovingItems=!0,n(this),this.isMovingItems=!1,this}[g](n,i=!1){return i?this.items[n]:this.deletedIndexes[n]?this.items[n]:this.tmpItems[n]||this.items[n]}[E](n){this.items[n]=void 0,this.tmpItems[n]=void 0}[M](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[J](){this.items=this.items.filter(n=>n!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(n=>typeof n.toJSON=="function"?n.toJSON():n)}clone(n){let i;return n?(i=new yt,i.push(...this.items)):i=new yt(...this.map(o=>o[h]?o.clone():o)),i}};yt[Ks]=Zs,yt[qs]=Os;let _t=yt;he("array",{constructor:_t});var Ys,an;const Bt=class Bt{static[(Ys=u,an=d,y)](n,i,o){return!o||typeof n[T]=="string"||o.isChangeTreeVisible((n[g](i)??n.deletedItems[i])[h])}static is(n){return n.map!==void 0}constructor(n){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[h]=new Gt(this),this[h].indexes={},n)if(n instanceof Map||n instanceof Bt)n.forEach((i,o)=>this.set(o,i));else for(const i in n)this.set(i,n[i]);Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return Bt}set(n,i){var _;if(i==null)throw new Error(`MapSchema#set('${n}', ${i}): trying to set ${i} value on '${n}'.`);typeof i=="object"&&this[T]&&Zt(i,this[T],this,n),n=n.toString();const o=this[h],c=i[h]!==void 0;let p,m;if(typeof o.indexes[n]<"u"){p=o.indexes[n],m=e.OPERATION.REPLACE;const w=this.$items.get(n);if(w===i)return;c&&(m=e.OPERATION.DELETE_AND_ADD,w!==void 0&&((_=w[h].root)==null||_.remove(w[h])))}else p=o.indexes[z]??0,m=e.OPERATION.ADD,this.$indexes.set(p,n),o.indexes[n]=p,o.indexes[z]=p+1;return this.$items.set(n,i),o.change(p,m),c&&i[h].setParent(this,o.root,p),this}get(n){return this.$items.get(n)}delete(n){const i=this[h].indexes[n];return this.deletedItems[i]=this[h].delete(i),this.$items.delete(n)}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){return this.$items.has(n)}forEach(n){this.$items.forEach(n)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(n,i){this.$indexes.set(n,i)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[E](n){const i=this.$indexes.get(n);this.$items.delete(i),this.$indexes.delete(n)}[M](){this.deletedItems={}}toJSON(){const n={};return this.forEach((i,o)=>{n[o]=typeof i.toJSON=="function"?i.toJSON():i}),n}clone(n){let i;return n?i=Object.assign(new Bt,this):(i=new Bt,this.forEach((o,c)=>{o[h]?i.set(c,o.clone()):i.set(c,o)})),i}};Bt[Ys]=rn,Bt[an]=Bn;let Lt=Bt;he("map",{constructor:Lt});const Dt=-1;function Lr(f){return Ae.register(f),f}function Xs(f=Dt){return function(n,i){var _;const o=n.constructor,p=Object.getPrototypeOf(o)[Symbol.metadata],m=o[_=Symbol.metadata]??(o[_]=Object.assign({},o[Symbol.metadata],p??Object.create(null)));Oe.setTag(m,i,f)}}function mt(f,n){return function(i,o){const c=i.constructor;if(!f)throw new Error(`${c.name}: @type() reference provided for "${o}" is undefined. Make sure you don't have any circular dependencies.`);Ae.register(c);const m=Object.getPrototypeOf(c)[Symbol.metadata],_=Oe.initialize(c);let w=_[o];if(_[w]!==void 0){if(_[w].deprecated)return;if(_[w].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${o}' definition on '${c.name}'.
Check @type() annotation`)}catch(S){const x=S.stack.split(`
`)[4].trim();throw new Error(`${S.message} ${x}`)}}else w=_[z]??(m&&m[z])??-1,w++;if(n&&n.manual)Oe.addField(_,w,o,f,{enumerable:!0,configurable:!0,writable:!0});else{const S=Array.isArray(f)?xe("array"):typeof Object.keys(f)[0]=="string"&&xe(Object.keys(f)[0]),x=S?Object.values(f)[0]:f;Oe.addField(_,w,o,f,on(`_${o}`,w,x,S))}}}function on(f,n,i,o){return{get:function(){return this[f]},set:function(c){var m,_;const p=this[f]??void 0;if(c!==p){if(c!=null){o?(o.constructor===_t&&!(c instanceof _t)&&(c=new _t(...c)),o.constructor===Lt&&!(c instanceof Lt)&&(c=new Lt(c)),c[T]=i):typeof i!="string"?Zt(c,i,this,f.substring(1)):mr(c,i,this,f.substring(1));const w=this[h];p!==void 0&&p[h]?((m=w.root)==null||m.remove(p[h]),this.constructor[l](w,n,e.OPERATION.DELETE_AND_ADD)):this.constructor[l](w,n,e.OPERATION.ADD),(_=c[h])==null||_.setParent(this,w.root,n)}else p!==void 0&&this[h].delete(n);this[f]=c}},enumerable:!0,configurable:!0}}function kr(f=!0){return function(n,i){var w;const o=n.constructor,p=Object.getPrototypeOf(o)[Symbol.metadata],m=o[w=Symbol.metadata]??(o[w]=Object.assign({},o[Symbol.metadata],p??Object.create(null))),_=m[i];m[_].deprecated=!0,f&&(m[F]??(m[F]={}),m[F][i]={get:function(){throw new Error(`${i} is deprecated.`)},set:function(S){},enumerable:!1,configurable:!0}),Object.defineProperty(m,_,{value:m[_],enumerable:!1,configurable:!0})}}function Br(f,n,i){for(let o in n)mt(n[o],i)(f.prototype,o);return f}function Js(f,n,i=$e){const o={},c={};for(let m in f){const _=f[m];typeof _=="object"&&(_.default!==void 0&&(o[m]=_.default),_.view!==void 0&&(c[m]=typeof _.view=="boolean"?Dt:_.view))}const p=Oe.setFields(class extends i{constructor(...m){m[0]=Object.assign({},o,m[0]),super(...m)}},f);for(let m in c)Xs(c[m])(p.prototype,m);return n&&Object.defineProperty(p,"name",{value:n}),p.extends=(m,_)=>Js(m,_,p),p}function $n(f){return new Array(f).fill(0).map((n,i)=>i===f-1?" ":"   ").join("")}function $r(f){const n=f[h].root,i={ops:{},refs:[]};return n.changes.forEach(o=>{if(o===void 0)return;const c=o.indexedOperations;i.refs.push(`refId#${o.refId}`);for(const p in c){const m=c[p],_=e.OPERATION[m];i.ops[_]||(i.ops[_]=0),i.ops[e.OPERATION[m]]++}}),i}var Xn,Qs;const In=class In{static initialize(n){var i;Object.defineProperty(n,h,{value:new Gt(n),enumerable:!1,writable:!0}),Object.defineProperties(n,((i=n.constructor[Symbol.metadata])==null?void 0:i[F])||{})}static is(n){return typeof n[Symbol.metadata]=="object"}static[(Xn=u,Qs=d,l)](n,i,o=e.OPERATION.ADD){n.change(i,o)}static[y](n,i,o){var m,_;const p=(m=n.constructor[Symbol.metadata][i])==null?void 0:m.tag;if(o===void 0)return p===void 0;if(p===void 0)return!0;if(p===Dt)return o.isChangeTreeVisible(n[h]);{const w=(_=o.tags)==null?void 0:_.get(n[h]);return w&&w.has(p)}}constructor(...n){In.initialize(this),n[0]&&Object.assign(this,n[0])}assign(n){return Object.assign(this,n),this}setDirty(n,i){const o=this.constructor[Symbol.metadata];this[h].change(o[o[n]].index,i)}clone(){var o;const n=new this.constructor,i=this.constructor[Symbol.metadata];for(const c in i){const p=i[c].name;typeof this[p]=="object"&&typeof((o=this[p])==null?void 0:o.clone)=="function"?n[p]=this[p].clone():n[p]=this[p]}return n}toJSON(){const n={},i=this.constructor[Symbol.metadata];for(const o in i){const c=i[o],p=c.name;!c.deprecated&&this[p]!==null&&typeof this[p]<"u"&&(n[p]=typeof this[p].toJSON=="function"?this[p].toJSON():this[p])}return n}discardAllChanges(){this[h].discardAll()}[g](n){const i=this.constructor[Symbol.metadata];return this[i[n].name]}[E](n){const i=this.constructor[Symbol.metadata];this[i[n].name]=void 0}static debugRefIds(n,i=!1,o=0){const c=i?` - ${JSON.stringify(n.toJSON())}`:"",p=n[h],m=p.refId;let _="";return _+=`${$n(o)}${n.constructor.name} (refId: ${m})${c}
`,p.forEachChild(w=>_+=this.debugRefIds(w.ref,i,o+1)),_}static debugChanges(n,i=!1){const o=n[h],c=i?o.allChanges:o.changes,p=i?"allChanges":"changes";let m=`${n.constructor.name} (${o.refId}) -> .${p}:
`;function _(w){w.operations.filter(S=>S).forEach(S=>{const x=o.indexedOperations[S];console.log({index:S,operation:x}),m+=`- [${S}]: ${e.OPERATION[x]} (${JSON.stringify(o.getValue(Number(S),i))})
`})}return _(c),!i&&o.filteredChanges&&o.filteredChanges.operations.filter(w=>w).length>0&&(m+=`${n.constructor.name} (${o.refId}) -> .filteredChanges:
`,_(o.filteredChanges)),i&&o.allFilteredChanges&&o.allFilteredChanges.operations.filter(w=>w).length>0&&(m+=`${n.constructor.name} (${o.refId}) -> .allFilteredChanges:
`,_(o.allFilteredChanges)),m}static debugChangesDeep(n,i="changes"){var x,$;let o="";const c=n[h],p=c.root,m=new Map,_=[];let w=0;for(const[R,X]of Object.entries(p[i])){const q=p.changeTrees[R];let V=!1,N=[],Y=(x=q.parent)==null?void 0:x[h];if(q===c)V=!0;else for(;Y!==void 0;){if(N.push(Y),Y.ref===n){V=!0;break}Y=($=Y.parent)==null?void 0:$[h]}V&&(_.push(q.refId),w+=Object.keys(X).length,m.set(q,N.reverse()))}o+=`---
`,o+=`root refId: ${c.refId}
`,o+=`Total instances: ${_.length} (refIds: ${_.join(", ")})
`,o+=`Total changes: ${w}
`,o+=`---
`;const S=new WeakSet;for(const[R,X]of m.entries()){X.forEach((ye,Le)=>{S.has(ye)||(o+=`${$n(Le)}${ye.ref.constructor.name} (refId: ${ye.refId})
`,S.add(ye))});const q=R.indexedOperations,V=X.length,N=$n(V),Y=V>0?`(${R.parentIndex}) `:"";o+=`${N}${Y}${R.ref.constructor.name} (refId: ${R.refId}) - changes: ${Object.keys(q).length}
`;for(const ye in q){const Le=q[ye];o+=`${$n(V+1)}${e.OPERATION[Le]}: ${ye}
`}}return`${o}`}};In[Xn]=ps,In[Qs]=Ws;let $e=In;var ln,er;const un=class un{static[(ln=u,er=d,y)](n,i,o){return!o||typeof n[T]=="string"||o.isChangeTreeVisible((n[g](i)??n.deletedItems[i])[h])}static is(n){return n.collection!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Gt(this),this[h].indexes={},n&&n.forEach(i=>this.add(i)),Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){const i=this.$refId++;return n[h]!==void 0&&n[h].setParent(this,this[h].root,i),this[h].indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,n),this[h].change(i),i}at(n){const i=Array.from(this.$items.keys())[n];return this.$items.get(i)}entries(){return this.$items.entries()}delete(n){const i=this.$items.entries();let o,c;for(;(c=i.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[h].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){return Array.from(this.$items.values()).some(i=>i===n)}forEach(n){this.$items.forEach((i,o,c)=>n(i,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,i){this.$indexes.set(n,i)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[E](n){const i=this.$indexes.get(n);this.$items.delete(i),this.$indexes.delete(n)}[M](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((i,o)=>{n.push(typeof i.toJSON=="function"?i.toJSON():i)}),n}clone(n){let i;return n?i=Object.assign(new un,this):(i=new un,this.forEach(o=>{o[h]?i.add(o.clone()):i.add(o)})),i}};un[ln]=rn,un[er]=Bn;let _n=un;he("collection",{constructor:_n});var tr,nr;const dn=class dn{static[(tr=u,nr=d,y)](n,i,o){return!o||typeof n[T]=="string"||o.visible.has((n[g](i)??n.deletedItems[i])[h])}static is(n){return n.set!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Gt(this),this[h].indexes={},n&&n.forEach(i=>this.add(i)),Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){var c;if(this.has(n))return!1;const i=this.$refId++;n[h]!==void 0&&n[h].setParent(this,this[h].root,i);const o=((c=this[h].indexes[i])==null?void 0:c.op)??e.OPERATION.ADD;return this[h].indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,n),this[h].change(i,o),i}entries(){return this.$items.entries()}delete(n){const i=this.$items.entries();let o,c;for(;(c=i.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[h].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){const i=this.$items.values();let o=!1,c;for(;(c=i.next())&&!c.done;)if(n===c.value){o=!0;break}return o}forEach(n){this.$items.forEach((i,o,c)=>n(i,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,i){this.$indexes.set(n,i)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[E](n){const i=this.$indexes.get(n);this.$items.delete(i),this.$indexes.delete(n)}[M](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((i,o)=>{n.push(typeof i.toJSON=="function"?i.toJSON():i)}),n}clone(n){let i;return n?i=Object.assign(new dn,this):(i=new dn,this.forEach(o=>{o[h]?i.add(o.clone()):i.add(o)})),i}};dn[tr]=rn,dn[nr]=Bn;let wn=dn;he("set",{constructor:wn});function kt(f,n,i,o){var c=arguments.length,p=c<3?n:o,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(f,n,i,o);else for(var _=f.length-1;_>=0;_--)(m=f[_])&&(p=(c<3?m(p):c>3?m(n,i,p):m(n,i))||p);return c>3&&p&&Object.defineProperty(n,i,p),p}typeof SuppressedError=="function"&&SuppressedError;class xs{constructor(n){this.types=n,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(n){n.ensureRefId();const i=this.changeTrees[n.refId]===void 0;i&&(this.changeTrees[n.refId]=n);const o=this.refCount[n.refId];if(o===0){const c=n.allChanges.operations;let p=c.length;for(;p--;)n.indexedOperations[c[p]]=e.OPERATION.ADD,rt(n.changes,p)}return this.refCount[n.refId]=(o||0)+1,i}remove(n){const i=this.refCount[n.refId]-1;return i<=0?(n.root=void 0,delete this.changeTrees[n.refId],this.removeChangeFromChangeSet("allChanges",n),this.removeChangeFromChangeSet("changes",n),n.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",n),this.removeChangeFromChangeSet("filteredChanges",n)),this.refCount[n.refId]=0):(this.refCount[n.refId]=i,n.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",n),qe(this,n,"filteredChanges")):(this.removeChangeFromChangeSet("changes",n),qe(this,n,"changes"))),n.forEachChild((o,c)=>this.remove(o)),i}removeChangeFromChangeSet(n,i){const o=this[n],c=o.indexOf(i);if(c!==-1)return i[n].queueRootIndex=-1,o[c]=void 0,!0}clear(){this.changes.length=0}}const xn=class xn{constructor(n){this.sharedBuffer=Buffer.allocUnsafe(xn.BUFFER_SIZE),this.context=Ae.cache(n.constructor),this.root=new xs(this.context),this.setState(n)}setState(n){this.state=n,this.state[h].setRoot(this.root)}encode(n={offset:0},i,o=this.sharedBuffer,c="changes",p=c==="allChanges",m=n.offset){const _=i!==void 0,w=this.state[h],S=this.root[c];for(let x=0,$=S.length;x<$;x++){const R=S[x];if(!R)continue;if(_){if(!i.isChangeTreeVisible(R)){i.invisible.add(R);continue}i.invisible.delete(R)}const X=R[c],q=R.ref,V=X.operations.length;if(V===0)continue;const N=q.constructor,Y=N[u],ye=N[y],Le=N[Symbol.metadata];(_||n.offset>m||R!==w)&&(o[n.offset++]=255,et.number(o,R.refId,n));for(let Ye=0;Ye<V;Ye++){const Ze=X.operations[Ye],dt=Ze<0?Math.abs(Ze):p?e.OPERATION.ADD:R.indexedOperations[Ze];Ze===void 0||dt===void 0||ye&&!ye(q,Ze,i)||Y(this,o,R,Ze,dt,n,p,_,Le)}}if(n.offset>o.byteLength){const x=Math.ceil(n.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(x/1024)} * 1024; // ${Math.round(x/1024)} KB
`),o=Buffer.alloc(x,o),o===this.sharedBuffer&&(this.sharedBuffer=o),this.encode({offset:m},i,o,c,p)}else return o.subarray(0,n.offset)}encodeAll(n={offset:0},i=this.sharedBuffer){return this.encode(n,void 0,i,"allChanges",!0)}encodeAllView(n,i,o,c=this.sharedBuffer){const p=o.offset;return this.encode(o,n,c,"allFilteredChanges",!0,p),Buffer.concat([c.subarray(0,i),c.subarray(p,o.offset)])}debugChanges(n){(typeof n=="string"?this.root[n]:n).forEach(o=>{const c=o[n],p=o.ref.constructor[Symbol.metadata];console.log("->",{ref:o.ref.constructor.name,refId:o.refId,changes:Object.keys(c).length});for(const m in c){const _=c[m];console.log("  ->",{index:m,field:p==null?void 0:p[m],op:e.OPERATION[_]})}})}encodeView(n,i,o,c=this.sharedBuffer){const p=o.offset;for(const[m,_]of n.changes){const w=this.root.changeTrees[m];if(w===void 0){n.changes.delete(m);continue}const S=Object.keys(_);if(S.length===0)continue;const $=w.ref.constructor,R=$[u],X=$[Symbol.metadata];c[o.offset++]=255,et.number(c,w.refId,o);for(let q=0,V=S.length;q<V;q++){const N=Number(S[q]),ye=w.ref[g](N)!==void 0&&_[N]||e.OPERATION.DELETE;R(this,c,w,N,ye,o,!1,!0,X)}}return n.changes.clear(),this.encode(o,n,c,"filteredChanges",!1,p),Buffer.concat([c.subarray(0,i),c.subarray(p,o.offset)])}discardChanges(){var i,o;let n=this.root.changes.length;if(n>0){for(;n--;)(i=this.root.changes[n])==null||i.endEncode("changes");this.root.changes.length=0}if(n=this.root.filteredChanges.length,n>0){for(;n--;)(o=this.root.filteredChanges[n])==null||o.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(n,i,o,c){const p=this.context.getTypeId(i),m=this.context.getTypeId(o);if(m===void 0){console.warn(`@colyseus/schema WARNING: Class "${o.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}p!==m&&(n[c.offset++]=213,et.number(n,m,c))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};xn.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let Mn=xn;function sr(f,n){if(n===-1||n>=f.length)return!1;const i=f.length-1;for(let o=n;o<i;o++)f[o]=f[o+1];return f.length=i,!0}class rr extends Error{constructor(n){super(n),this.name="DecodingWarning"}}class yr{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(n,i,o=!0){this.refs.set(n,i),this.refIds.set(i,n),o&&(this.refCounts[n]=(this.refCounts[n]||0)+1),this.deletedRefs.has(n)&&this.deletedRefs.delete(n)}removeRef(n){const i=this.refCounts[n];if(i===void 0){try{throw new rr("trying to remove refId that doesn't exist: "+n)}catch(o){console.warn(o)}return}if(i===0){try{const o=this.refs.get(n);throw new rr(`trying to remove refId '${n}' with 0 refCount (${o.constructor.name}: ${JSON.stringify(o)})`)}catch(o){console.warn(o)}return}(this.refCounts[n]=i-1)<=0&&this.deletedRefs.add(n)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(n=>{if(this.refCounts[n]>0)return;const i=this.refs.get(n);if(i.constructor[Symbol.metadata]!==void 0){const o=i.constructor[Symbol.metadata];for(const c in o){const p=o[c].name,m=typeof i[p]=="object"&&this.refIds.get(i[p]);m&&!this.deletedRefs.has(m)&&this.removeRef(m)}}else typeof i[T]=="function"&&Array.from(i.values()).forEach(o=>{const c=this.refIds.get(o);this.deletedRefs.has(c)||this.removeRef(c)});this.refs.delete(n),delete this.refCounts[n],delete this.callbacks[n]}),this.deletedRefs.clear()}addCallback(n,i,o){if(n===void 0){const c=typeof i=="number"?e.OPERATION[i]:i;throw new Error(`Can't addCallback on '${c}' (refId is undefined)`)}return this.callbacks[n]||(this.callbacks[n]={}),this.callbacks[n][i]||(this.callbacks[n][i]=[]),this.callbacks[n][i].push(o),()=>this.removeCallback(n,i,o)}removeCallback(n,i,o){var p,m,_;const c=(_=(m=(p=this.callbacks)==null?void 0:p[n])==null?void 0:m[i])==null?void 0:_.indexOf(o);c!==-1&&sr(this.callbacks[n][i],c)}}class ys{constructor(n,i){this.currentRefId=0,this.setState(n),this.context=i||new Ae(n.constructor)}setState(n){this.state=n,this.root=new yr,this.root.addRef(0,n)}decode(n,i={offset:0},o=this.state){var w,S,x;const c=[],p=this.root,m=n.byteLength;let _=o.constructor[d];for(this.currentRefId=0;i.offset<m;){if(n[i.offset]==255){i.offset++,this.currentRefId=G.number(n,i);const R=p.refs.get(this.currentRefId);if(!R)throw new Error(`"refId" not found: ${this.currentRefId}`);(w=o[J])==null||w.call(o),o=R,_=o.constructor[d];continue}if(_(this,n,i,o,c)===zs){console.warn("@colyseus/schema: definition mismatch");const R={offset:i.offset};for(;i.offset<m&&!(n[i.offset]===255&&(R.offset=i.offset+1,p.refs.has(G.number(n,R))));)i.offset++;continue}}return(S=o[J])==null||S.call(o),(x=this.triggerChanges)==null||x.call(this,c),p.garbageCollectDeletedRefs(),c}getInstanceType(n,i,o){let c;if(n[i.offset]===213){i.offset++;const p=G.number(n,i);c=this.context.get(p)}return c||o}createInstanceOfType(n){return new n}removeChildRefs(n,i){const o=typeof n[T]!="string",c=this.root.refIds.get(n);n.forEach((p,m)=>{i.push({ref:n,refId:c,op:e.OPERATION.DELETE,field:m,value:void 0,previousValue:p}),o&&this.root.removeRef(this.root.refIds.get(p))})}}class cn extends $e{}kt([mt("string")],cn.prototype,"name",void 0),kt([mt("string")],cn.prototype,"type",void 0),kt([mt("number")],cn.prototype,"referencedType",void 0);class zt extends $e{constructor(){super(...arguments),this.fields=new _t}}kt([mt("number")],zt.prototype,"id",void 0),kt([mt("number")],zt.prototype,"extendsId",void 0),kt([mt([cn])],zt.prototype,"fields",void 0);class fn extends $e{constructor(){super(...arguments),this.types=new _t}static encode(n,i={offset:0}){const o=n.context,c=new fn,p=new Mn(c),m=o.schemas.get(n.state.constructor);m>0&&(c.rootType=m);const _=new Set,w={},S=$=>{if($.extendsId===void 0||_.has($.extendsId)){_.add($.id),c.types.push($);const R=w[$.id];R!==void 0&&(delete w[$.id],R.forEach(X=>S(X)))}else w[$.extendsId]===void 0&&(w[$.extendsId]=[]),w[$.extendsId].push($)};o.schemas.forEach(($,R)=>{const X=new zt;X.id=Number($);const q=Object.getPrototypeOf(R);q!==$e&&(X.extendsId=o.schemas.get(q));const V=R[Symbol.metadata];if(V!==q[Symbol.metadata])for(const N in V){const Y=Number(N),ye=V[Y].name;if(!Object.prototype.hasOwnProperty.call(V,ye))continue;const Le=new cn;Le.name=ye;let Ye;const Ze=V[Y];if(typeof Ze.type=="string")Ye=Ze.type;else{let dt;$e.is(Ze.type)?(Ye="ref",dt=Ze.type):(Ye=Object.keys(Ze.type)[0],typeof Ze.type[Ye]=="string"?Ye+=":"+Ze.type[Ye]:dt=Ze.type[Ye]),Le.referencedType=dt?o.getTypeId(dt):-1}Le.type=Ye,X.fields.push(Le)}S(X)});for(const $ in w)w[$].forEach(R=>c.types.push(R));const x=p.encodeAll(i);return Buffer.from(x,0,i.offset)}static decode(n,i){const o=new fn;new ys(o).decode(n,i);const p=new Ae;o.types.forEach(w=>{const S=p.get(w.extendsId)??$e,x=class extends S{};Ae.register(x),p.add(x,w.id)},{});const m=(w,S,x)=>{S.fields.forEach(($,R)=>{const X=x+R;if($.referencedType!==void 0){let q=$.type,V=p.get($.referencedType);if(!V){const N=$.type.split(":");q=N[0],V=N[1]}q==="ref"?Oe.addField(w,X,$.name,V):Oe.addField(w,X,$.name,{[q]:V})}else Oe.addField(w,X,$.name,$.type)})};o.types.forEach(w=>{const S=p.get(w.id),x=Oe.initialize(S),$=[];let R=w;do $.push(R),R=o.types.find(q=>q.id===R.extendsId);while(R);let X=0;$.reverse().forEach(q=>{m(x,q,X),X+=q.fields.length})});const _=new(p.get(o.rootType||0));return new ys(_,p)}}kt([mt([zt])],fn.prototype,"types",void 0),kt([mt("number")],fn.prototype,"rootType",void 0);function Mr(f){const n=f.root,i=n.callbacks,o=new WeakMap;let c;f.triggerChanges=function(_){var S;const w=new Set;for(let x=0,$=_.length;x<$;x++){const R=_[x],X=R.refId,q=R.ref,V=i[X];if(V){if((R.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&R.previousValue instanceof $e){const N=(S=i[n.refIds.get(R.previousValue)])==null?void 0:S[e.OPERATION.DELETE];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y]()}if(q instanceof $e){if(!w.has(X)){const N=V==null?void 0:V[e.OPERATION.REPLACE];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y]()}if(V.hasOwnProperty(R.field)){const N=V[R.field];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.value,R.previousValue)}}else{if((R.op&e.OPERATION.DELETE)===e.OPERATION.DELETE){if(R.previousValue!==void 0){const N=V[e.OPERATION.DELETE];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.previousValue,R.dynamicIndex??R.field)}if((R.op&e.OPERATION.ADD)===e.OPERATION.ADD){const N=V[e.OPERATION.ADD];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.value,R.dynamicIndex??R.field)}}else if((R.op&e.OPERATION.ADD)===e.OPERATION.ADD&&R.previousValue!==R.value){const N=V[e.OPERATION.ADD];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.value,R.dynamicIndex??R.field)}if(R.value!==R.previousValue&&(R.value!==void 0||R.previousValue!==void 0)){const N=V[e.OPERATION.REPLACE];for(let Y=(N==null?void 0:N.length)-1;Y>=0;Y--)N[Y](R.value,R.dynamicIndex??R.field)}}w.add(X)}}};function p(_,w){var $;let S=(($=w.instance)==null?void 0:$.constructor[Symbol.metadata])||_,x=w.instance&&typeof w.instance.forEach=="function"||_&&typeof _[Symbol.metadata]>"u";if(S&&!x){const R=function(X,q,V,N){return N&&w.instance[q]!==void 0&&!o.has(c)&&V(w.instance[q],void 0),n.addCallback(n.refIds.get(X),q,V)};return new Proxy({listen:function(q,V,N=!0){if(w.instance)return R(w.instance,q,V,N);{let Y=()=>{};return w.onInstanceAvailable((ye,Le)=>{Y=R(ye,q,V,N&&Le&&!o.has(c))}),()=>Y()}},onChange:function(q){return n.addCallback(n.refIds.get(w.instance),e.OPERATION.REPLACE,q)},bindTo:function(q,V){return V||(V=Object.keys(S).map(N=>S[N].name)),n.addCallback(n.refIds.get(w.instance),e.OPERATION.REPLACE,()=>{V.forEach(N=>q[N]=w.instance[N])})}},{get(X,q){var N;const V=S[S[q]];if(V){const Y=(N=w.instance)==null?void 0:N[q],ye=Le=>{const Ye=m(w.instance).listen(q,(Ze,dt)=>{Le(Ze,!1),Ye==null||Ye()},!1);n.refIds.get(Y)!==void 0&&Le(Y,!0)};return p(V.type,{instance:n.refIds.get(Y)&&Y,parentInstance:w.instance,onInstanceAvailable:ye})}else return X[q]},has(X,q){return S[q]!==void 0},set(X,q,V){throw new Error("not allowed")},deleteProperty(X,q){throw new Error("not allowed")}})}else{const R=function(V,N,Y){return Y&&V.forEach((ye,Le)=>N(ye,Le)),n.addCallback(n.refIds.get(V),e.OPERATION.ADD,(ye,Le)=>{o.set(N,!0),c=N,N(ye,Le),o.delete(N),c=void 0})},X=function(V,N){return n.addCallback(n.refIds.get(V),e.OPERATION.DELETE,N)},q=function(V,N){return n.addCallback(n.refIds.get(V),e.OPERATION.REPLACE,N)};return new Proxy({onAdd:function(V,N=!0){if(w.instance)return R(w.instance,V,N&&!o.has(c));if(w.onInstanceAvailable){let Y=()=>{};return w.onInstanceAvailable((ye,Le)=>{Y=R(ye,V,N&&Le&&!o.has(c))}),()=>Y()}},onRemove:function(V){if(w.instance)return X(w.instance,V);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(Y=>{N=X(Y,V)}),()=>N()}},onChange:function(V){if(w.instance)return q(w.instance,V);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(Y=>{N=q(Y,V)}),()=>N()}}},{get(V,N){if(!V[N])throw new Error(`Can't access '${N}' through callback proxy. access the instance directly.`);return V[N]},has(V,N){return V[N]!==void 0},set(V,N,Y){throw new Error("not allowed")},deleteProperty(V,N){throw new Error("not allowed")}})}}function m(_){return p(void 0,{instance:_})}return m}function Ur(f,n){f.triggerChanges=n}class Fr{constructor(n=!1){this.iterable=n,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,n&&(this.items=[])}add(n,i=Dt,o=!0){var _,w;const c=n==null?void 0:n[h];if(c){if(!c.parent&&c.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${c.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",n),this;const p=n.constructor[Symbol.metadata];this.visible.add(c),this.iterable&&o&&this.items.push(n),o&&c.parent&&this.addParentOf(c,i);let m=this.changes.get(c.refId);if(m===void 0&&(m={},this.changes.set(c.refId,m)),i!==Dt){this.tags||(this.tags=new WeakMap);let S;this.tags.has(c)?S=this.tags.get(c):(S=new Set,this.tags.set(c,S)),S.add(i),(w=(_=p==null?void 0:p[ie])==null?void 0:_[i])==null||w.forEach(x=>{c.getChange(x)!==e.OPERATION.DELETE&&(m[x]=e.OPERATION.ADD)})}else{const S=this.invisible.has(c),x=c.filteredChanges!==void 0?c.allFilteredChanges:c.allChanges;for(let $=0,R=x.operations.length;$<R;$++){const X=x.operations[$];if(X===void 0)continue;const q=c.indexedOperations[X]??e.OPERATION.ADD,V=p==null?void 0:p[X].tag;!c.isNew&&(S||V===void 0||V===i)&&q!==e.OPERATION.DELETE&&(m[X]=q)}}return c.forEachChild((S,x)=>{p&&p[x].tag!==void 0&&p[x].tag!==i||this.add(S.ref,i,!1)}),this}addParentOf(n,i){var p;const o=n.parent[h],c=n.parentIndex;if(!this.visible.has(o)){this.visible.add(o);const m=(p=o.parent)==null?void 0:p[h];m&&m.filteredChanges!==void 0&&this.addParentOf(o,i)}if(o.getChange(c)!==e.OPERATION.DELETE){let m=this.changes.get(o.refId);m===void 0&&(m={},this.changes.set(o.refId,m)),this.tags||(this.tags=new WeakMap);let _;this.tags.has(o)?_=this.tags.get(o):(_=new Set,this.tags.set(o,_)),_.add(i),m[c]=e.OPERATION.ADD}}remove(n,i=Dt,o=!1){var w;const c=n[h];if(!c)return console.warn("StateView#remove(), invalid object:",n),this;this.visible.delete(c),this.iterable&&!o&&sr(this.items,this.items.indexOf(n));const m=c.ref.constructor[Symbol.metadata];let _=this.changes.get(c.refId);if(_===void 0&&(_={},this.changes.set(c.refId,_)),i===Dt){const S=c.parent;if(!Oe.isValidInstance(S)&&c.isFiltered){const x=S[h];let $=this.changes.get(x.refId);$===void 0&&($={},this.changes.set(x.refId,$)),$[c.parentIndex]=e.OPERATION.DELETE}else(w=m==null?void 0:m[ge])==null||w.forEach(x=>_[x]=e.OPERATION.DELETE)}else m==null||m[ie][i].forEach(S=>_[S]=e.OPERATION.DELETE);if(this.tags&&this.tags.has(c)){const S=this.tags.get(c);i===void 0?this.tags.delete(c):(S.delete(i),S.size===0&&this.tags.delete(c))}return this}has(n){return this.visible.has(n[h])}hasTag(n,i=Dt){var c;const o=(c=this.tags)==null?void 0:c.get(n[h]);return(o==null?void 0:o.has(i))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let n=0,i=this.items.length;n<i;n++)this.remove(this.items[n],Dt,!0);this.items.length=0}isChangeTreeVisible(n){let i=this.visible.has(n);return!i&&n.isVisibilitySharedWithParent&&this.visible.has(n.parent[h])&&(this.visible.add(n),i=!0),i}}he("map",{constructor:Lt}),he("array",{constructor:_t}),he("set",{constructor:wn}),he("collection",{constructor:_n}),e.$changes=h,e.$childType=T,e.$decoder=d,e.$deleteByIndex=E,e.$encoder=u,e.$filter=y,e.$getByIndex=g,e.$track=l,e.ArraySchema=_t,e.ChangeTree=Gt,e.CollectionSchema=_n,e.Decoder=ys,e.Encoder=Mn,e.MapSchema=Lt,e.Metadata=Oe,e.Reflection=fn,e.ReflectionField=cn,e.ReflectionType=zt,e.Schema=$e,e.SetSchema=wn,e.StateView=Fr,e.TypeContext=Ae,e.decode=G,e.decodeKeyValueOperation=Bn,e.decodeSchemaOperation=Ws,e.defineCustomTypes=Re,e.defineTypes=Br,e.deprecated=kr,e.dumpChanges=$r,e.encode=et,e.encodeArray=Zs,e.encodeKeyValueOperation=rn,e.encodeSchemaOperation=ps,e.entity=Lr,e.getDecoderStateCallbacks=Mr,e.getRawChangesCallback=Ur,e.registerType=he,e.schema=Js,e.type=mt,e.view=Xs})})(Ba,Ba.exports);var ct=Ba.exports,Fp=Object.defineProperty,St=(s,t,e,r)=>{for(var a=void 0,l=s.length-1,u;l>=0;l--)(u=s[l])&&(a=u(t,e,a)||a);return a&&Fp(t,e,a),a},Me=(s=>(s.Lobby="Lobby",s.Shop="Shop",s.Preparation="Preparation",s.Battle="Battle",s.BattleEnd="BattleEnd",s.GameOver="GameOver",s))(Me||{});const zn=class Hc extends ct.Schema{constructor(){super(...arguments),this.instanceId="",this.cardId="",this.name="",this.attack=0,this.speed=0,this.health=0,this.currentHp=0,this.brewCost=0,this.description="",this.isLegend=!1}static fromCardData(t,e){const r=new Hc;return r.instanceId=e,r.cardId=t.id,r.name=t.name,r.attack=t.attack,r.speed=t.speed,r.health=t.health,r.currentHp=t.health,r.brewCost=t.brewCost,r.description=t.description,r.isLegend=t.isLegend,r}};St([ct.type("string")],zn.prototype,"instanceId");St([ct.type("string")],zn.prototype,"cardId");St([ct.type("string")],zn.prototype,"name");St([ct.type("number")],zn.prototype,"attack");St([ct.type("number")],zn.prototype,"speed");St([ct.type("number")],zn.prototype,"health");St([ct.type("number")],zn.prototype,"currentHp");St([ct.type("number")],zn.prototype,"brewCost");St([ct.type("string")],zn.prototype,"description");St([ct.type("boolean")],zn.prototype,"isLegend");let Gc=zn;class ls extends ct.Schema{constructor(){super(...arguments),this.sessionId="",this.username="Player",this.health=100,this.brews=5,this.shopRefreshCost=1,this.hand=new ct.MapSchema,this.battlefield=new ct.MapSchema,this.isReady=!1,this.shopOfferIds=new ct.ArraySchema}}St([ct.type("string")],ls.prototype,"sessionId");St([ct.type("string")],ls.prototype,"username");St([ct.type("number")],ls.prototype,"health");St([ct.type("number")],ls.prototype,"brews");St([ct.type("number")],ls.prototype,"shopRefreshCost");St([ct.type({map:Gc})],ls.prototype,"hand");St([ct.type({map:Gc})],ls.prototype,"battlefield");St([ct.type("boolean")],ls.prototype,"isReady");St([ct.type(["string"])],ls.prototype,"shopOfferIds");class ta extends ct.Schema{constructor(){super(...arguments),this.players=new ct.MapSchema,this.currentDay=0,this.currentPhase="Lobby",this.battleTimer=0}}St([ct.type({map:ls})],ta.prototype,"players");St([ct.type("number")],ta.prototype,"currentDay");St([ct.type("string")],ta.prototype,"currentPhase");St([ct.type("number")],ta.prototype,"battleTimer");class Vp extends os.Scene{constructor(){super("Lobby");fe(this,"playerTextObjects",new Map);fe(this,"statusText");fe(this,"readyButton");fe(this,"waitingText");fe(this,"phaseListenerUnsub",null);fe(this,"playerAddListenerUnsub",null);fe(this,"playerRemoveListenerUnsub",null);fe(this,"playerStateListeners",new Map);fe(this,"listenersAttached",!1)}create(){if(this.scene.launch("background"),this.listenersAttached=!1,!A||!A.sessionId){console.error("Lobby Scene: Not connected to Colyseus room or no session ID!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Not connected to server.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{A==null||A.leave()}catch{}this.scene.start("MainMenu")});return}this.add.text(this.cameras.main.centerX,100,"Lobby",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,200,"Players in Lobby:",{fontFamily:"Arial",fontSize:32,color:"#dddddd",align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-100,"Connecting to lobby...",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.readyButton=this.add.text(this.cameras.main.centerX,this.cameras.main.height-150,"Ready Up",{fontFamily:"Arial Black",fontSize:40,color:"#888888",backgroundColor:"#333333",padding:{x:20,y:10},stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setVisible(!1).disableInteractive(),this.waitingText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-110,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.readyButton.on("pointerdown",()=>{var e;A&&((e=this.readyButton.input)!=null&&e.enabled)&&(console.log("Lobby: Sending playerReady message."),A.send("playerReady"))}),this.readyButton.on("pointerover",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled&&this.readyButton.setColor("#55ff55")}),this.readyButton.on("pointerout",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled?this.readyButton.setColor("#00ff00"):this.readyButton.setColor("#888888")}),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}attachMainListenersAndUI(){if(this.listenersAttached){console.log("Lobby: Main listeners and UI setup already performed, skipping.");return}if(!this.scene.isActive()){console.warn("Lobby: attachMainListenersAndUI called but scene is not active. Aborting.");return}if(!A||!A.state){console.warn("Lobby: attachMainListenersAndUI called but Colyseus room or state is not ready. Aborting.");return}console.log("Lobby: Attaching main Colyseus listeners and performing initial UI update."),this.attachMainListeners(),this.updateLobbyUI(),this.listenersAttached=!0}setupColyseusListeners(){if(!A){console.error("Lobby: setupColyseusListeners called but colyseusRoom is null.");return}console.log("Lobby: Setting up Colyseus general listeners."),A.state&&!this.listenersAttached&&(console.log("Lobby: State already available on setup. Scheduling attachMainListenersAndUI."),this.time.delayedCall(1,this.attachMainListenersAndUI,[],this)),A.onStateChange.once(e=>{if(console.log("Lobby: Initial state received via onStateChange.once."),!this.scene.isActive()){console.log("Lobby: Scene became inactive before onStateChange.once processing could complete.");return}this.attachMainListenersAndUI()})}attachMainListeners(){if(!A||!A.state){console.error("Lobby: attachMainListeners - colyseusRoom or state is null.");return}const e=Hn.getStateCallbacks(A);this.phaseListenerUnsub&&this.phaseListenerUnsub(),this.phaseListenerUnsub=e(A.state).listen("currentPhase",(r,a)=>{this.scene.isActive()&&(console.log(`Lobby: Phase changed from ${a} to: ${r}`),r===Me.Shop?(this.statusText.setText("Starting Game!"),this.time.delayedCall(500,()=>{this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"))})):r===Me.Lobby?this.updateLobbyUI():r===Me.GameOver&&(this.statusText.setText("Game Over. Returning to Main Menu."),this.time.delayedCall(1500,()=>{if(this.scene.isActive()){try{A==null||A.leave()}catch{}this.scene.stop(),this.scene.start("MainMenu")}})))}),this.playerAddListenerUnsub&&this.playerAddListenerUnsub(),this.playerAddListenerUnsub=e(A.state.players).onAdd((r,a)=>{this.scene.isActive()&&(console.log(`Lobby: Player joined: ${r.username} (${a})`),this.addPlayerStateListener(r,a),this.updateLobbyUI())}),this.playerRemoveListenerUnsub&&this.playerRemoveListenerUnsub(),this.playerRemoveListenerUnsub=e(A.state.players).onRemove((r,a)=>{this.scene.isActive()&&(console.log(`Lobby: Player left: ${r.username} (${a})`),this.removePlayerStateListener(a),this.updateLobbyUI())}),A.state.players.forEach((r,a)=>{this.addPlayerStateListener(r,a)})}addPlayerStateListener(e,r){var u;if(!A)return;const a=Hn.getStateCallbacks(A);(u=this.playerStateListeners.get(r))==null||u(),console.log(`Lobby: Adding 'isReady' listener for player ${r}`);const l=a(e).listen("isReady",(d,y)=>{console.log(`Lobby: isReady changed for player ${r}: ${y} -> ${d}`),this.scene.isActive()&&this.updateLobbyUI()});this.playerStateListeners.set(r,l)}removePlayerStateListener(e){const r=this.playerStateListeners.get(e);r&&(console.log(`Lobby: Removing 'isReady' listener for player ${e}`),r(),this.playerStateListeners.delete(e))}updateLobbyUI(){if(!this.scene.isActive()){console.warn("Lobby: updateLobbyUI called but scene is NOT ACTIVE. Aborting UI update.");return}if(!A){console.warn("Lobby: updateLobbyUI called but colyseusRoom is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Connection lost.");return}if(!A.state){console.warn("Lobby: updateLobbyUI called but colyseusRoom.state is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Game state unavailable.");return}ks.size===0&&(console.log("Lobby: Card data not loaded yet. Loading..."),co().then(h=>{h?console.log("Lobby: Card data loaded successfully"):console.warn("Lobby: Failed to load card data")}));const e=A.state.players,r=A.sessionId,a=e.size,l=250,u=40;this.playerTextObjects.forEach(h=>h.destroy()),this.playerTextObjects.clear();let d=0,y=a>0,g=!1;const E=e.get(r);E&&(g=E.isReady),e.forEach((h,T)=>{const M=T===r,J=h.isReady?" [Ready]":" [Not Ready]",F=`${h.username||"Joining..."}${M?" (You)":""}${J}`,z=this.add.text(this.cameras.main.centerX,l+d*u,F,{fontFamily:"Arial",fontSize:24,color:h.isReady?"#00ff00":"#ffffff",align:"center"}).setOrigin(.5);this.playerTextObjects.set(T,z),d++,h.isReady||(y=!1)}),a<2?(this.statusText.setText("Waiting for opponent..."),this.readyButton.setVisible(!1).disableInteractive(),this.waitingText.setVisible(!1)):(this.readyButton.setVisible(!0),g?(this.statusText.setText("Waiting for opponent to ready up..."),this.readyButton.setText("Waiting...").setColor("#888888").disableInteractive(),this.waitingText.setText(y?"Starting game...":"Waiting for opponent...").setVisible(!0)):(this.statusText.setText("Lobby full. Ready up!"),this.readyButton.setText("Ready Up").setColor("#00ff00").setInteractive({useHandCursor:!0}),this.waitingText.setVisible(!1)),y&&(this.statusText.setText("Starting game..."),this.readyButton.setVisible(!1),this.waitingText.setVisible(!1)))}shutdown(){var e,r,a,l,u,d,y,g,E;console.log("Lobby scene shutting down."),this.listenersAttached=!1,(e=this.phaseListenerUnsub)==null||e.call(this),(r=this.playerAddListenerUnsub)==null||r.call(this),(a=this.playerRemoveListenerUnsub)==null||a.call(this),this.playerStateListeners.forEach(h=>h()),this.playerStateListeners.clear(),this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerTextObjects.forEach(h=>h.destroy()),this.playerTextObjects.clear(),(l=this.statusText)==null||l.destroy(),(u=this.readyButton)==null||u.destroy(),(d=this.waitingText)==null||d.destroy(),(y=this.readyButton)==null||y.off("pointerdown"),(g=this.readyButton)==null||g.off("pointerover"),(E=this.readyButton)==null||E.off("pointerout"),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const vs=120,vr=168;class jp extends os.Scene{constructor(){super("Shop");fe(this,"continueButton");fe(this,"shopCardObjects",[]);fe(this,"waitingText");fe(this,"refreshButton");fe(this,"cardDataCache",new Map);fe(this,"shopOffersContainer");fe(this,"shopOffersBackground");fe(this,"toggleShopButton");fe(this,"shopOffersVisible",!0);fe(this,"phaseListenerUnsub",null);fe(this,"playerStateListenersUnsub",new Map);fe(this,"shopOfferListenersUnsub",[]);fe(this,"listeners",[])}create(){var y;if(this.scene.launch("background"),(y=this.scene.get("BoardView"))!=null&&y.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!A||!A.state||!A.sessionId){console.error("Shop Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{A==null||A.leave(!0)}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,r=this.cameras.main.centerY,a=this.cameras.main.width,l=this.cameras.main.height;this.createShopCardsDisplay(e,r,a),this.setupDragAndDrop(),this.requestMissingCardData();const u=A.state.players.get(A.sessionId),d=(u==null?void 0:u.shopRefreshCost)||2;this.refreshButton=this.add.text(a-150,180,`Refresh: ${d} `,{fontFamily:"Arial",fontSize:18,color:"#FFFFFF",backgroundColor:"#4444AA",padding:{x:10,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.refreshButton.on("pointerdown",()=>{const g=A==null?void 0:A.state.players.get(A.sessionId);A&&g&&g.brews>=g.shopRefreshCost&&A.send("refreshShop")}),this.refreshButton.on("pointerover",()=>{var g;(g=this.refreshButton.input)!=null&&g.enabled&&this.refreshButton.setBackgroundColor("#6666CC")}),this.refreshButton.on("pointerout",()=>{var g;(g=this.refreshButton.input)!=null&&g.enabled&&this.refreshButton.setBackgroundColor("#4444AA")}),this.updateRefreshButtonState(),this.continueButton=this.add.text(e,l-50,"Continue",{fontFamily:"Arial Black",fontSize:40,color:"#00ff00",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.continueButton.on("pointerdown",()=>{const g=A==null?void 0:A.state.players.get(A.sessionId);A&&g&&!g.isReady&&A.state.currentPhase===Me.Shop&&A.send("playerReady")}),this.continueButton.on("pointerover",()=>{var g;(g=this.continueButton.input)!=null&&g.enabled&&this.continueButton.setColor("#55ff55")}),this.continueButton.on("pointerout",()=>{var g;(g=this.continueButton.input)!=null&&g.enabled?this.continueButton.setColor("#00ff00"):this.continueButton.setColor("#888888")}),this.waitingText=this.add.text(e,l-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(50,()=>this.createShopCardsDisplay(e,r,a)),this.toggleShopButton=this.add.text(a-100,r-250,"Toggle Shop",{fontFamily:"Arial",fontSize:16,color:"#FFFFFF",backgroundColor:"#555555",padding:{x:5,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.toggleShopButton.on("pointerdown",()=>{this.shopOffersVisible=!this.shopOffersVisible,this.shopOffersContainer.setVisible(this.shopOffersVisible),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop")}),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop"),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createShopCardsDisplay(e,r,a){var J;(J=this.shopOffersContainer)==null||J.destroy(),this.shopOffersContainer=this.add.container(0,0),this.shopOffersContainer.setVisible(this.shopOffersVisible),this.shopCardObjects.forEach(F=>F.destroy()),this.shopCardObjects=[];const l=A==null?void 0:A.state.players.get(A.sessionId),u=l==null?void 0:l.shopOfferIds;if(!u||u.length===0){console.log("Shop: No shop offers from server."),this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.setVisible(!1);return}const d=20,y=u.length>0?u.length:4,g=r,E=y*vs+(y-1)*d,h=e-E/2+vs/2,T=E+d*2,M=vr+d*2;this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.destroy(),this.shopOffersBackground=this.add.rectangle(e,g,T,M,51,.6),this.shopOffersContainer.add(this.shopOffersBackground),u.forEach((F,z)=>{const ce=this.getCardDataFromServer(F);if(!ce){console.warn(`Shop: Card data not found for ID: ${F}`);return}const ge=h+z*(vs+d),ie=this.add.container(ge,g),be=this.add.image(0,0,"cardFullTier1").setOrigin(.5).setDisplaySize(vs,vr);ie.add(be);const Fe=this.add.text(0,-20,ce.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:vs-20}}).setOrigin(.5,.5);ie.add(Fe);const st=this.add.text(-120/2+32,vr*.03,`${ce.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(0,.5);ie.add(st);const ot=this.add.text(vs/2-18,6,`${ce.health}/${ce.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,.5);ie.add(ot);const vt=this.add.text(0,vr/2-50,`${ce.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);ie.add(vt);const lt=this.add.text(vs/2-8,-168/2+8,`${ce.brewCost}B`,{fontFamily:"Arial",fontSize:14,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"right"}).setOrigin(1,0);ie.add(lt),ie.setSize(vs,vr),ie.setSize(vs,vr),ie.setInteractive({useHandCursor:!0}),ie.setData("cardId",ce.id),ie.setData("cardData",ce),this.input.setDraggable(ie),ie.off("pointerdown").on("pointerdown",Ht=>{var Qe;(Qe=ie.input)!=null&&Qe.enabled&&ie.setData("isBeingDragged",!1)}),ie.off("pointerup").on("pointerup",Ht=>{var H;if(!((H=ie.input)!=null&&H.enabled)||!A||!A.sessionId)return;if(ie.getData("isBeingDragged")===!0){ie.setData("isBeingDragged",!1);return}const Qe=A.state.players.get(A.sessionId);if(!Qe)return;let Ve=-1;for(let se=0;se<5;se++)if(!Qe.hand.has(String(se))){Ve=se;break}if(Ve!==-1){const se=ie.getData("cardId"),te=ie.getData("cardData");se&&te&&Qe.brews>=te.brewCost?(console.log(`Shop: Click-to-buy card ${se} (Cost: ${te.brewCost}) into hand slot ${Ve}. Brews: ${Qe.brews}`),A.send("buyCard",{cardId:se,handSlotIndex:Ve})):te&&Qe.brews<te.brewCost?console.log(`Shop: Not enough brews (${Qe.brews}) to click-buy card ${se} (Cost: ${te.brewCost}).`):console.log(`Shop: Click-to-buy failed for card ${se}. CardData: ${!!te}`)}else console.log("Shop: Hand is full, cannot click-buy.")}),this.shopCardObjects.push(ie),this.shopOffersContainer.add(ie)})}requestMissingCardData(){if(!A||!A.state||!A.sessionId)return;const e=A.state.players.get(A.sessionId);if(!e)return;const r=e.shopOfferIds;if(r&&r.length>0){const a=[];r.forEach(l=>{ks.has(l)||a.push(l)}),a.length>0&&(console.log("Requesting missing cards from server:",a),A.send("getCardsByIds",{cardIds:a}))}}getCardDataFromServer(e){if(ks.has(e))return ks.get(e);if(!A||!A.state)return;let r;return A.state.players.forEach(a=>{a.hand.forEach(l=>{l.cardId===e&&(r={id:l.cardId,name:l.name,attack:l.attack,speed:l.speed,health:l.health,brewCost:l.brewCost,description:l.description,isLegend:l.isLegend})}),a.battlefield.forEach(l=>{l.cardId===e&&(r={id:l.cardId,name:l.name,attack:l.attack,speed:l.speed,health:l.health,brewCost:l.brewCost,description:l.description,isLegend:l.isLegend})})}),r||(r={id:e,name:`Card ${e.split("_").pop()}`,attack:1,speed:1,health:1,brewCost:1,description:"Loading card details...",isLegend:!1},console.warn(`Shop: Card data not found for ID: ${e} in global cache or state`)),r}setupDragAndDrop(){this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),this.input.off("pointerdown"),this.input.off("pointerup"),this.shopCardObjects.forEach(e=>{e.off("pointerdown"),e.off("pointerup")}),this.input.on("dragstart",(e,r)=>{var a;!(r instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(r)||(a=r.input)!=null&&a.enabled&&(this.children.bringToTop(r),r.setAlpha(.7),r.setData("startX",r.x),r.setData("startY",r.y),r.setData("isBeingDragged",!0))}),this.input.on("drag",(e,r,a,l)=>{var u;!(r instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(r)||(u=r.input)!=null&&u.enabled&&r.getData("isBeingDragged")===!0&&(r.x=a,r.y=l)}),this.input.on("dragend",(e,r)=>{if(!A||!(r instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(r)){r instanceof Phaser.GameObjects.Container&&r.setData("isBeingDragged",!1);return}r.setAlpha(1);let a=!1;if(r.getData("isBeingDragged")===!0){const l=r.x,u=r.y,d=this.scene.get("BoardView");for(let y=0;y<5;y++){const g=d==null?void 0:d.getSlotPixelPosition(!0,"hand",y);if(g){const E=new Phaser.Geom.Rectangle(g.x-50,g.y-70,100,140);if(Phaser.Geom.Rectangle.Contains(E,l,u)){const h=A.state.players.get(A.sessionId);if(h&&!h.hand.has(String(y))){const T=r.getData("cardId"),M=r.getData("cardData");T&&M&&h.brews>=M.brewCost?(A.send("buyCard",{cardId:T,handSlotIndex:y}),a=!0):console.log("Shop: Drag-to-buy failed (not enough brews or card data missing).")}break}}}a||r.active&&(r.x=r.getData("startX"),r.y=r.getData("startY"))}r.setData("isBeingDragged",!1)})}updateRefreshButtonState(){if(!A||!this.refreshButton||!this.refreshButton.active)return;const e=A.state.players.get(A.sessionId);if(!e)return;this.refreshButton.setText(`Refresh: ${e.shopRefreshCost} `),e.brews>=e.shopRefreshCost&&A.state.currentPhase===Me.Shop?(this.refreshButton.setColor("#FFFFFF"),this.refreshButton.setBackgroundColor("#4444AA"),this.refreshButton.setInteractive({useHandCursor:!0})):(this.refreshButton.setColor("#AAAAAA"),this.refreshButton.setBackgroundColor("#555555"),this.refreshButton.disableInteractive())}setupColyseusListeners(){if(!A||!A.sessionId)return;const e=Hn.getStateCallbacks(A),r=A.sessionId;this.phaseListenerUnsub=e(A.state).listen("currentPhase",l=>{this.scene.isActive()&&(l===Me.Preparation?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Preparation")):l!==Me.Shop&&this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby")),this.updateWaitingStatus())}),A.state.players.forEach((l,u)=>{const d=e(l).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(u,d)}),this.listeners.push(e(A.state.players).onAdd((l,u)=>{var y;this.playerStateListenersUnsub.has(u)&&((y=this.playerStateListenersUnsub.get(u))==null||y());const d=e(l).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(u,d),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(e(A.state.players).onRemove((l,u)=>{var d;(d=this.playerStateListenersUnsub.get(u))==null||d(),this.playerStateListenersUnsub.delete(u),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(A.onMessage("cardsByIds",l=>{if(this.scene.isActive()){Object.entries(l).forEach(([g,E])=>{ks.set(g,E)});const u=this.cameras.main.centerX,d=this.cameras.main.centerY,y=this.cameras.main.width;this.createShopCardsDisplay(u,d,y)}}));const a=A.state.players.get(r);if(a){const l=()=>{if(!this.scene.isActive())return;this.requestMissingCardData();const u=this.cameras.main.centerX,d=this.cameras.main.centerY,y=this.cameras.main.width;this.createShopCardsDisplay(u,d,y)};this.shopOfferListenersUnsub.push(e(a.shopOfferIds).onAdd(l)),this.shopOfferListenersUnsub.push(e(a.shopOfferIds).onRemove(l)),l(),this.listeners.push(e(a).listen("brews",()=>{this.scene.isActive()&&this.updateRefreshButtonState()})),this.listeners.push(e(a).listen("shopRefreshCost",()=>{this.scene.isActive()&&this.updateRefreshButtonState()}))}}cleanupListeners(){var e,r,a,l;console.log("Shop Scene: Cleaning up listeners."),(e=this.phaseListenerUnsub)==null||e.call(this),this.phaseListenerUnsub=null,this.playerStateListenersUnsub.forEach(u=>u()),this.playerStateListenersUnsub.clear(),this.shopOfferListenersUnsub.forEach(u=>u()),this.shopOfferListenersUnsub=[],this.listeners.forEach(u=>u()),this.listeners=[],this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(r=this.continueButton)==null||r.off("pointerdown"),(a=this.continueButton)==null||a.off("pointerover"),(l=this.continueButton)==null||l.off("pointerout")}updateWaitingStatus(){if(!A||!A.sessionId||!this.continueButton||!this.waitingText||!this.scene.isActive())return;const e=A.state.players.get(A.sessionId);if(!e)return;let r=!0;A.state.players.forEach(d=>{d.isReady||(r=!1)});const a=e.isReady,l=A.state.currentPhase===Me.Shop,u=!a&&l;this.continueButton.setInteractive(u),this.continueButton.setColor(u?"#00ff00":"#888888"),a&&!r&&l?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.continueButton.setText("Waiting...")):l?(this.waitingText.setVisible(!1),this.continueButton.setText("Continue")):(this.waitingText.setText(`Waiting for ${A.state.currentPhase} phase...`).setVisible(!0),this.continueButton.setText("Continue")),this.shopCardObjects.forEach(d=>{d.input&&(d.input.enabled=u)})}shutdown(){var e,r,a,l,u,d,y,g;console.log("Shop scene shutting down."),this.cleanupListeners(),this.shopCardObjects.forEach(E=>E.destroy()),this.shopCardObjects=[],(e=this.continueButton)==null||e.destroy(),(r=this.waitingText)==null||r.destroy(),(a=this.refreshButton)==null||a.off("pointerdown"),(l=this.refreshButton)==null||l.off("pointerover"),(u=this.refreshButton)==null||u.off("pointerout"),(d=this.refreshButton)==null||d.destroy(),(y=this.toggleShopButton)==null||y.destroy(),(g=this.shopOffersContainer)==null||g.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class Hp extends os.Scene{constructor(){super("Preparation");fe(this,"startBattleButton");fe(this,"waitingText");fe(this,"playerStateListener",null);fe(this,"handListener",null);fe(this,"battlefieldListener",null);fe(this,"phaseListener",null);fe(this,"playerStateListenerUnsub",null);fe(this,"handAddUnsub",null);fe(this,"handRemoveUnsub",null);fe(this,"handChangeUnsub",null);fe(this,"battlefieldAddUnsub",null);fe(this,"battlefieldRemoveUnsub",null);fe(this,"battlefieldChangeUnsub",null);fe(this,"phaseListenerUnsub",null);fe(this,"otherPlayerChangeListeners",new Map);fe(this,"otherPlayerAddUnsub",null);fe(this,"otherPlayerRemoveUnsub",null);fe(this,"clientSideCardLayout",new Map)}create(){var l;if(this.scene.launch("background"),(l=this.scene.get("BoardView"))!=null&&l.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!A||!A.state||!A.sessionId){console.error("Preparation Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>this.scene.start("MainMenu"));return}const e=this.cameras.main.centerX;this.cameras.main.centerY;const r=this.cameras.main.height;this.cameras.main.width;const a=A.state.players.get(A.sessionId);a?console.log("Preparation Create: Initial myPlayerState.hand contents:",JSON.stringify(Object.fromEntries(a.hand.entries()))):console.log("Preparation Create: myPlayerState not found initially."),this.add.text(e,80,"Preparation Phase",{fontFamily:"Arial Black",fontSize:48,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.startBattleButton=this.add.text(e,r-50,"Start Battle",{fontFamily:"Arial Black",fontSize:40,color:"#888888",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.startBattleButton.setColor("#888888").disableInteractive(),this.waitingText=this.add.text(e,r-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(100,this.updateStartButtonState,[],this),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!A||!A.sessionId)return;const e=A.sessionId,r=Hn.getStateCallbacks(A),a=A.state.players.get(e);a?(this.playerStateListenerUnsub=r(a).onChange(()=>{this.scene.isActive()&&this.updateWaitingStatus()}),this.handAddUnsub=r(a.hand).onAdd((l,u)=>{console.log(`Preparation Scene: player.hand.onAdd triggered for key: ${u}, card: ${l==null?void 0:l.name}. Scene active: ${this.scene.isActive()}`),this.scene.isActive()&&this.updateStartButtonState()}),this.handRemoveUnsub=r(a.hand).onRemove((l,u)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldAddUnsub=r(a.battlefield).onAdd((l,u)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldRemoveUnsub=r(a.battlefield).onRemove((l,u)=>{this.scene.isActive()&&this.updateStartButtonState()})):console.error("Preparation Scene: My player state not found on init."),this.phaseListenerUnsub=r(A.state).listen("currentPhase",l=>{this.scene.isActive()&&(console.log(`Preparation Scene: Phase changed to ${l}`),l===Me.Battle?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Battle")):l!==Me.Preparation&&(console.warn(`Preparation Scene: Unexpected phase change to ${l}. Returning to Lobby.`),this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby"))),this.updateWaitingStatus())}),this.otherPlayerAddUnsub=r(A.state.players).onAdd((l,u)=>{if(this.scene.isActive()){if(u!==e){const d=r(l).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(u,d)}this.updateWaitingStatus()}}),this.otherPlayerRemoveUnsub=r(A.state.players).onRemove((l,u)=>{if(this.scene.isActive()){const d=this.otherPlayerChangeListeners.get(u);d==null||d(),this.otherPlayerChangeListeners.delete(u),this.updateWaitingStatus()}}),A.state.players.forEach((l,u)=>{if(u!==e){const d=r(l).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(u,d)}})}cleanupListeners(){var e,r,a,l,u,d,y,g,E,h,T,M,J;console.log("Preparation Scene: Cleaning up listeners."),(e=this.playerStateListenerUnsub)==null||e.call(this),(r=this.handAddUnsub)==null||r.call(this),(a=this.handRemoveUnsub)==null||a.call(this),(l=this.handChangeUnsub)==null||l.call(this),(u=this.battlefieldAddUnsub)==null||u.call(this),(d=this.battlefieldRemoveUnsub)==null||d.call(this),(y=this.battlefieldChangeUnsub)==null||y.call(this),(g=this.phaseListenerUnsub)==null||g.call(this),(E=this.otherPlayerAddUnsub)==null||E.call(this),(h=this.otherPlayerRemoveUnsub)==null||h.call(this),this.otherPlayerChangeListeners.forEach(F=>F()),this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.otherPlayerChangeListeners.clear(),this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(T=this.startBattleButton)==null||T.off("pointerdown"),(M=this.startBattleButton)==null||M.off("pointerover"),(J=this.startBattleButton)==null||J.off("pointerout")}makeLocalPlayerCardsDraggable(){if(!A||!A.sessionId||!this.scene.isActive()){console.warn("Preparation: Cannot make cards draggable, room/session/scene inactive.");return}const e=A.sessionId,r=A.state.players.get(e),a=this.scene.get("BoardView");if(!r||!a){console.warn("Preparation: Player state or BoardView not found for making cards draggable.");return}this.clientSideCardLayout.forEach(u=>{u.gameObject&&u.gameObject.input&&this.input.disable(u.gameObject)}),this.clientSideCardLayout.clear();const l=(u,d)=>{u.forEach((y,g)=>{const E=a.getCardGameObjectByInstanceId(y.instanceId);E?(E.setInteractive({useHandCursor:!0}),this.input.setDraggable(E),this.clientSideCardLayout.set(y.instanceId,{area:d,slotKey:g,gameObject:E})):console.warn(`Preparation: Could not find GameObject in BoardView for card instance ${y.instanceId}`)})};l(r.hand,"hand"),l(r.battlefield,"battlefield"),console.log("Preparation: Made local player cards draggable and initialized clientSideCardLayout.",this.clientSideCardLayout),this.updateStartButtonState()}updateWaitingStatus(){if(!A||!A.sessionId||!this.startBattleButton||!this.waitingText)return;const e=A.state.players.get(A.sessionId);if(!e)return;let r=!0;A.state.players.forEach(l=>{l.isReady||(r=!1)});const a=e.isReady;!a&&(A.state.currentPhase,Me.Preparation),this.updateStartButtonState(),a&&!r?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.startBattleButton.setText("Waiting..."),this.startBattleButton.disableInteractive().setColor("#888888")):(this.waitingText.setVisible(!1),this.startBattleButton.setText("Start Battle"),this.updateStartButtonState())}updateStartButtonState(){if(!this.startBattleButton||!this.startBattleButton.active){console.warn("updateStartButtonState called but button is null or inactive.");return}let e=0;const r=this.scene.get("BoardView");r&&r.scene.isActive()&&r.getLocalPlayerLayoutData().forEach(E=>{E.area==="battlefield"&&e++});const a=e>0,l=A==null?void 0:A.state.players.get(A==null?void 0:A.sessionId),u=(l==null?void 0:l.isReady)??!1,d=(A==null?void 0:A.state.currentPhase)===Me.Preparation;a&&!u&&d?(this.startBattleButton.setColor("#00ff00"),this.startBattleButton.setInteractive({useHandCursor:!0}),this.startBattleButton.off("pointerdown"),this.startBattleButton.once("pointerdown",this.confirmPreparation,this),this.startBattleButton.on("pointerover",()=>this.startBattleButton.setColor("#55ff55")),this.startBattleButton.on("pointerout",()=>this.startBattleButton.setColor("#00ff00"))):(this.waitingText&&!this.waitingText.visible&&this.startBattleButton.setColor("#888888"),this.startBattleButton.disableInteractive(),this.startBattleButton.off("pointerdown"),this.startBattleButton.off("pointerover"),this.startBattleButton.off("pointerout"))}confirmPreparation(){if(!A)return;console.log("Confirming preparation layout...");const e=this.scene.get("BoardView");if(!e||!e.scene.isActive()){console.error("Preparation: BoardView not available to get layout data.");return}const{handLayout:r,battlefieldLayout:a}=e.getCardLayouts();console.log("Sending preparation layout to server:",{handLayout:r,battlefieldLayout:a}),A.send("setPreparation",{handLayout:r,battlefieldLayout:a}),this.updateWaitingStatus()}shutdown(){var e,r;console.log("Preparation scene shutting down explicitly."),this.cleanupListeners(),(e=this.startBattleButton)==null||e.destroy(),(r=this.waitingText)==null||r.destroy(),this.clientSideCardLayout.clear(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class Gp extends os.Scene{constructor(){super("Battle");fe(this,"handCardDisplayObjects",new Map);fe(this,"battleOver",!1);fe(this,"resultText");fe(this,"statusText");fe(this,"phaseListenerUnsubscribe",null)}create(){if(this.scene.launch("background"),this.battleOver=!1,!A||!A.state||!A.sessionId){console.error("Battle Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{A==null||A.leave()}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,r=this.cameras.main.centerY,a=this.cameras.main.height;this.cameras.main.width,this.resultText=this.add.text(e,r,"",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setAlpha(0),this.statusText=this.add.text(e,a-50,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5).setAlpha(0),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!A||!A.state)return;const e=Hn.getStateCallbacks(A);this.phaseListenerUnsubscribe=e(A.state).listen("currentPhase",r=>{if(this.scene.isActive()){if(console.log(`Battle Scene: Phase changed to ${r}`),r===Me.BattleEnd)this.handleBattleEnd();else if(r===Me.Shop)this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"));else if(r===Me.GameOver)this.handleGameOver();else if(r!==Me.Battle&&(console.warn(`Battle Scene: Unexpected phase change to ${r}. Returning to Lobby.`),this.scene.isActive())){try{A==null||A.leave()}catch{}this.scene.stop(),this.scene.start("Lobby")}}})}cleanupListeners(){var e;console.log("Battle Scene: Cleaning up listeners."),(e=this.phaseListenerUnsubscribe)==null||e.call(this),this.phaseListenerUnsubscribe=null}handleBattleEnd(){var u,d;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Battle ended (server signal received). Displaying results.");const e=A==null?void 0:A.state.players.get(A.sessionId);let r;A==null||A.state.players.forEach((y,g)=>{g!==(A==null?void 0:A.sessionId)&&(r=y)});let a="Battle Ended",l="#ffffff";e&&r?e.health>r.health?(a="Victory!",l="#88ff88"):r.health>e.health?(a="Defeat!",l="#ff8888"):(a="Draw!",l="#ffff88"):(a="Battle Ended (Opponent Left?)",l="#ffffff"),(u=this.resultText)!=null&&u.active&&this.resultText.setText(a).setColor(l).setAlpha(1),(d=this.statusText)!=null&&d.active&&this.statusText.setText("Waiting for next round...").setAlpha(1)}handleGameOver(){var u,d;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Game Over signal received.");const e=A==null?void 0:A.state.players.get(A.sessionId);let r;A==null||A.state.players.forEach((y,g)=>{g!==(A==null?void 0:A.sessionId)&&(r=y)});let a="Game Over!",l="#ffffff";e&&r?e.health>r.health?(a="You Win!",l="#00ff00"):r.health>e.health?(a="You Lose!",l="#ff0000"):(a="Draw!",l="#ffff00"):e?(a="You Win! (Opponent Left)",l="#00ff00"):(a="Game Over (Error?)",l="#ff0000"),(u=this.resultText)!=null&&u.active&&this.resultText.setText(a).setColor(l).setAlpha(1),(d=this.statusText)!=null&&d.active&&this.statusText.setText("Click to return to Main Menu").setAlpha(1),this.input.once("pointerdown",()=>{try{A==null||A.leave()}catch{}this.scene.stop("Background"),this.scene.start("MainMenu")})}shutdown(){var e,r;console.log("Battle scene shutting down explicitly."),this.cleanupListeners(),this.handCardDisplayObjects.forEach(a=>{a==null||a.forEach(l=>l==null?void 0:l.destroy())}),this.handCardDisplayObjects.clear(),(e=this.resultText)==null||e.destroy(),(r=this.statusText)==null||r.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const cr=100,ga=140,Un=120,Fn=168,Yo=15,ma=580,ya=420,Ea=100,ba=260;class Zp extends os.Scene{constructor(){super("BoardView");fe(this,"playerVisuals",new Map);fe(this,"currentPhase",Me.Lobby);fe(this,"sellZone");fe(this,"sellZoneRect");fe(this,"sellZoneText");fe(this,"brewGainText");fe(this,"playerHealthText");fe(this,"opponentHealthText");fe(this,"playerBrewsText");fe(this,"dayPhaseText");fe(this,"opponentUsernameText");fe(this,"listeners",[]);fe(this,"cardSchemaListeners",new Map)}updateCardHpVisuals(e,r,a){if(!e||!e.active)return;const l=e.getData("hpTextObject"),u=e.getData("mainCardImage");if(l&&l.active){l.setText(`${r}/${a}`);const y=a>0?r/a:0;r<=0?l.setColor("#ff0000"):y<.3?l.setColor("#ff8888"):y<.6?l.setColor("#ffff88"):l.setColor("#88ff88")}const d=e.alpha<1;r<=0?d||(e.setAlpha(.6),u&&u.active&&typeof u.setTint=="function"&&u.setTint(7829367)):d&&(e.setAlpha(1),u&&u.active&&typeof u.clearTint=="function"?u.clearTint():u&&u.active&&console.warn("BoardView: updateCardHpVisuals - clearTint method not found on mainCardImage for card.",e.getData("instanceId"),u))}preload(){if(!this.textures.exists("cardBack")){const e=this.make.graphics({x:0,y:0});e.fillStyle(5253758),e.fillRect(0,0,Un,Fn),e.lineStyle(2,12428501),e.strokeRect(0,0,Un,Fn),e.generateTexture("cardBack",Un,Fn),e.destroy()}}create(){console.log("BoardView creating..."),this.createNavbar(),this.createSellZone(),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createNavbar(){const e=this.cameras.main.centerX,r=this.cameras.main.width,a=30;this.add.rectangle(e,a,r,50,0,.7).setDepth(1e3);const u={fontFamily:"Arial",fontSize:16,color:"#ffffff",align:"left"};this.playerHealthText=this.add.text(r*.05,a,"You: -- HP",{...u,color:"#00ff00"}).setOrigin(0,.5).setDepth(1001),this.playerBrewsText=this.add.text(r*.95,a,"Brews: --",{...u,color:"#ffff00",align:"right"}).setOrigin(1,.5).setDepth(1001),this.opponentUsernameText=this.add.text(r*.25,a-10,"Opponent: --",{...u,fontSize:14}).setOrigin(0,.5).setDepth(1001),this.opponentHealthText=this.add.text(r*.25,a+10,"-- HP",{...u,color:"#ff0000"}).setOrigin(0,.5).setDepth(1001),this.dayPhaseText=this.add.text(e,a,"Day -- - Phase --",{...u,fontSize:20,align:"center"}).setOrigin(.5).setDepth(1001)}showAttackAnimation(e){const r=this.getCardGameObjectByInstanceId(e);if(r&&r.active){const a=r.scaleX,l=r.scaleY;this.tweens.add({targets:r,scaleX:a*1.15,scaleY:l*1.15,duration:100,yoyo:!0,ease:"Sine.easeInOut"})}}showDamageNumber(e,r){const a=this.getCardGameObjectByInstanceId(e);if(a&&a.active&&r>0){const l=this.add.text(a.x+Phaser.Math.Between(-10,10),a.y-Fn/2-10,`-${r}`,{fontFamily:"Arial Black",fontSize:24,color:"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(a.depth+1);this.tweens.add({targets:l,y:l.y-50,alpha:0,duration:1e3,ease:"Power1",onComplete:()=>{l.destroy()}})}}drawAttackLine(e,r){const a=this.getCardGameObjectByInstanceId(e),l=this.getCardGameObjectByInstanceId(r);if(a&&a.active&&l&&l.active){const u=this.add.line(0,0,a.x,a.y,l.x,l.y,16724787,.7).setOrigin(0,0).setLineWidth(2).setDepth(a.depth);this.time.delayedCall(250,()=>{u.destroy()})}}setupColyseusListeners(){if(!A||!A.state){console.error("BoardView: Colyseus room or state not available!"),this.time.delayedCall(100,this.setupColyseusListeners,[],this);return}const e=Hn.getStateCallbacks(A);this.listeners.push(e(A.state).listen("currentDay",()=>this.updateNavbarText())),this.listeners.push(e(A.state).listen("currentPhase",(r,a)=>{this.currentPhase=r,this.updateNavbarText(),r===Me.Shop||r===Me.Preparation?this.sellZone.setVisible(!0):this.sellZone.setVisible(!1);const l=(u,d,y,g)=>{if(!u.active)return;const E=u.getData("cooldownBarBg"),h=u.getData("cooldownBarFill");if(r===Me.Battle){if(u.getData("area")==="battlefield")if(d)if(E&&h){E.setVisible(!0),h.setVisible(!0);const M=u.getData("cooldownBarBaseWidth"),J=typeof M=="number"?M:cr-10;h.setSize(J,6);const F=(d.speed>0?d.speed:1.5)*1e3;u.setData("maxAttackCooldown",F),u.setData("attackCooldownTimer",F)}else console.warn(`BoardView: Battle Phase - Card ${d.instanceId} (Owner: ${y}, Slot: ${g}) missing cooldown bar elements in data. Bg: ${!!E}, Fill: ${!!h}`);else console.warn(`BoardView: Battle Phase - Battlefield card container (Owner: ${y}, Slot: ${g}) has no cardSchema. No cooldown bar shown.`)}else E&&E.setVisible(!1),h&&h.setVisible(!1);if((a===Me.Battle||a===Me.BattleEnd)&&r!==Me.Battle&&r!==Me.BattleEnd&&d&&d.currentHp>0){u.setAlpha(1);const T=u.getData("mainCardImage");T&&T.active&&typeof T.clearTint=="function"&&T.clearTint()}};this.playerVisuals.forEach((u,d)=>{u.battlefield.forEach((y,g)=>{var h;const E=(h=A==null?void 0:A.state.players.get(d))==null?void 0:h.battlefield.get(g);l(y,E,d,g)}),u.hand.forEach((y,g)=>{var h;const E=(h=A==null?void 0:A.state.players.get(d))==null?void 0:h.hand.get(g);if((a===Me.Battle||a===Me.BattleEnd)&&r!==Me.Battle&&r!==Me.BattleEnd&&E&&E.currentHp>0){y.setAlpha(1);const T=y.getData("mainCardImage");T&&T.active&&typeof T.clearTint=="function"&&T.clearTint()}})})})),this.listeners.push(e(A.state.players).onAdd((r,a)=>{console.log(`BoardView: Player added ${a}`),this.addPlayerVisuals(a),this.addPlayerListeners(r,a),this.updatePlayerSlots(r,a),this.updateNavbarText()})),this.listeners.push(e(A.state.players).onRemove((r,a)=>{console.log(`BoardView: Player removed ${a}`),this.removePlayerVisuals(a),this.updateNavbarText()})),this.listeners.push(A.onMessage("battleAttackEvent",r=>{if(this.currentPhase!==Me.Battle||!this.scene.isActive())return;console.log("BoardView: Received battleAttackEvent",r);const a=this.getCardGameObjectByInstanceId(r.attackerInstanceId),l=this.getCardGameObjectByInstanceId(r.targetInstanceId);if(a&&a.active&&l&&l.active){this.drawAttackLine(r.attackerInstanceId,r.targetInstanceId),this.showAttackAnimation(r.attackerInstanceId),this.showDamageNumber(r.targetInstanceId,r.damageDealt);const u=a.getData("maxAttackCooldown");if(u>0){a.setData("attackCooldownTimer",u);const E=a.getData("cooldownBarFill"),h=a.getData("cooldownBarBaseWidth")||cr-10;E&&E.setSize(h,6)}const d=l.getData("ownerSessionId"),y=l.getData("slotKey"),g=l.getData("area");if(d===r.targetPlayerId&&g==="battlefield"&&y){const E=A.state.players.get(r.targetPlayerId),h=E==null?void 0:E.battlefield.get(y);if(h&&h.instanceId===r.targetInstanceId){const T=Math.max(0,h.currentHp-r.damageDealt);this.updateCardHpVisuals(l,T,h.health)}else console.warn(`BoardView: battleAttackEvent - Target card schema not found or instanceId mismatch for player ${r.targetPlayerId}, slot ${y}, instance ${r.targetInstanceId}.`)}else console.warn(`BoardView: battleAttackEvent - Target card container data inconsistent or not on battlefield. Owner: ${d}, Area: ${g}, Slot: ${y}`)}else console.warn("BoardView: Attacker or target not found/active for battleAttackEvent",r)})),A.state.players.forEach((r,a)=>{this.addPlayerVisuals(a),this.addPlayerListeners(r,a),this.updatePlayerSlots(r,a)}),this.updateNavbarText()}update(e,r){!this.scene.isActive()||this.currentPhase!==Me.Battle||!A||!A.state||this.playerVisuals.forEach(a=>{a.battlefield.forEach(l=>{if(!l.active)return;const u=l.getData("maxAttackCooldown");let d=l.getData("attackCooldownTimer");const y=l.getData("cooldownBarBaseWidth")||cr-10;if(u>0){d-=r,d<0&&(d=0),l.setData("attackCooldownTimer",d);const g=l.getData("cooldownBarFill");if(g&&g.visible){const E=d/u;g.setSize(y*Math.max(0,E),6)}}})})}addPlayerListeners(e,r){const a=Hn.getStateCallbacks(A),l=[];l.push(a(e).listen("health",()=>this.updateNavbarText())),l.push(a(e).listen("brews",()=>this.updateNavbarText())),l.push(a(e).listen("username",()=>this.updateNavbarText())),l.push(a(e.hand).onAdd((u,d)=>{this.updateCardVisual(r,"hand",d,u),this.addCardSchemaListeners(u)})),l.push(a(e.hand).onRemove((u,d)=>{this.removeCardVisual(r,"hand",d)})),e.hand.forEach((u,d)=>{this.addCardSchemaListeners(u)}),l.push(a(e.battlefield).onAdd((u,d)=>{this.updateCardVisual(r,"battlefield",d,u),this.addCardSchemaListeners(u)})),l.push(a(e.battlefield).onRemove((u,d)=>{this.removeCardVisual(r,"battlefield",d)})),e.battlefield.forEach((u,d)=>{this.addCardSchemaListeners(u)}),this.listeners.push(...l)}addCardSchemaListeners(e){if(!e||!e.instanceId)return;const r=Hn.getStateCallbacks(A),a=this.cardSchemaListeners.get(e.instanceId);a&&(a.forEach(d=>d()),this.cardSchemaListeners.delete(e.instanceId));const l=[],u=r(e).listen("currentHp",(d,y)=>{const g=this.getCardGameObjectByInstanceId(e.instanceId);g&&this.updateCardHpVisuals(g,d,e.health)});l.push(u),l.length>0&&this.cardSchemaListeners.set(e.instanceId,l)}updatePlayerSlots(e,r){e.hand.forEach((a,l)=>this.updateCardVisual(r,"hand",l,a)),e.battlefield.forEach((a,l)=>this.updateCardVisual(r,"battlefield",l,a))}addPlayerVisuals(e){if(!this.playerVisuals.has(e)){const r=[],a=[],l=e===(A==null?void 0:A.sessionId);for(let u=0;u<5;u++){const d=this.calculateSlotX(u,"hand"),y=l?ma:Ea,g=this.add.rectangle(d,y,Un,Fn).setStrokeStyle(2,l?11184810:7829367,.8).setDepth(0);r.push(g);const E=this.calculateSlotX(u,"battlefield"),h=l?ya:ba,T=this.add.rectangle(E,h,cr,ga).setStrokeStyle(2,l?16777215:11184810,1).setDepth(0);a.push(T)}this.playerVisuals.set(e,{hand:new Map,battlefield:new Map,handSlotOutlines:r,battlefieldSlotOutlines:a})}}removePlayerVisuals(e){const r=this.playerVisuals.get(e);r&&(r.hand.forEach(a=>a.destroy()),r.battlefield.forEach(a=>a.destroy()),r.handSlotOutlines.forEach(a=>a.destroy()),r.battlefieldSlotOutlines.forEach(a=>a.destroy())),this.playerVisuals.delete(e)}updateCardVisual(e,r,a,l){if(!this.scene.isActive()||!A||!A.state)return;this.removeCardVisual(e,r,a);const u=this.playerVisuals.get(e);if(!u)return;const d=e===(A==null?void 0:A.sessionId),y=this.calculateSlotX(parseInt(a,10),r);let g,E=!1;r==="hand"?(g=d?ma:Ea,d||(E=!0)):g=d?ya:ba;const h=this.createCardGameObject(l,y,g,E,d,r);if(h.setData("instanceId",l.instanceId),h.setData("slotKey",a),h.setData("area",r),h.setData("ownerSessionId",e),h.setDepth(1),l.currentHp<=0){h.setAlpha(.6);const T=h.getData("mainCardImage");T&&T.active&&typeof T.setTint=="function"&&T.setTint(7829367);const M=h.getData("hpTextObject");M&&M.active&&M.setColor("#ff0000")}r==="hand"?u.hand.set(a,h):u.battlefield.set(a,h),this.addCardSchemaListeners(l),d&&this.makeCardInteractive(h)}removeCardVisual(e,r,a){const l=this.playerVisuals.get(e);if(l){const u=r==="hand"?l.hand:l.battlefield,d=u.get(a);if(d){const y=d.getData("instanceId");if(y){const g=this.cardSchemaListeners.get(y);g&&(console.log(`BoardView: Cleaning up ${g.length} listeners for card instance ${y} during removeCardVisual.`),g.forEach(E=>{if(typeof E=="function")try{E()}catch(h){console.warn(`BoardView: Error unsubscribing card listener for ${y}`,h)}}),this.cardSchemaListeners.delete(y))}d.input&&d.input.enabled&&this.input.disable(d),this.time.delayedCall(1,()=>{d.active&&d.destroy()}),u.delete(a)}}}calculateSlotX(e,r){const a=r==="hand"?Un:cr,l=5*a+4*Yo;return(this.cameras.main.width-l)/2+a/2+e*(a+Yo)}createCardGameObject(e,r,a,l,u,d){const y=this.add.container(r,a),g=d==="hand"?Un:cr,E=d==="hand"?Fn:ga;if(y.setData("displayCardWidth",g),y.setData("displayCardHeight",E),l){const M=this.add.image(0,0,"cardBack").setOrigin(.5).setDisplaySize(Un,Fn);return y.add(M),y}const h=d==="hand"?"cardFullTier1":"cardMinionTier1",T=this.add.image(0,0,h).setOrigin(.5);if(T.setDisplaySize(g,E),y.add(T),y.setData("mainCardImage",T),d==="hand"){const M=this.add.text(0,-20,e.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:g-20}}).setOrigin(.5,.5);y.add(M);const J=this.add.text(-100/2+32,ga*.03,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);y.add(J);const F=this.add.text(cr/2-18,6,`${e.currentHp}  ${e.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(1,.5);y.add(F),y.setData("hpTextObject",F);const z=this.add.text(0,E/2-50,`${e.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);y.add(z)}else{const M=this.add.text(0,-E/2+5,e.name,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:g}}).setOrigin(.5,0);y.add(M);const J=this.add.text(-g/2+32,32,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);y.add(J);const F=this.add.text(0,43,`${e.speed}`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(1,0);y.add(F);const z=this.add.text(g/2-10,E/2-30,`${e.currentHp}/${e.health}`,{fontFamily:"Arial",fontSize:14,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,1);y.add(z),y.setData("hpTextObject",z);const ce=E/2-15,ge=g-10,ie=this.add.rectangle(0,ce,ge,6,0,.5).setVisible(!1),be=this.add.rectangle(-ge/2,ce,ge,6,4521796).setOrigin(0,.5).setVisible(!1);y.add(ie),y.add(be),y.setData("cooldownBarBg",ie),y.setData("cooldownBarFill",be),y.setData("attackCooldownTimer",0),y.setData("maxAttackCooldown",0),y.setData("cooldownBarBaseWidth",ge)}return y}getCardGameObjectByInstanceId(e){for(const[r,a]of this.playerVisuals){for(const[l,u]of a.hand)if(u.getData("instanceId")===e)return u;for(const[l,u]of a.battlefield)if(u.getData("instanceId")===e)return u}}getSlotPixelPosition(e,r,a){if(a<0||a>4)return;const l=this.calculateSlotX(a,r);let u;return r==="hand"?u=e?ma:Ea:u=e?ya:ba,{x:l,y:u}}makeCardInteractive(e){const r=e.getData("displayCardWidth"),a=e.getData("displayCardHeight");if(!r||!a){console.warn("BoardView: makeCardInteractive - displayCardWidth/Height not found on container.",e.getData("instanceId"));return}const l=new Phaser.Geom.Rectangle(-r/2,-a/2,r,a);e.setInteractive({hitArea:l,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}),this.input.setDraggable(e),e.input&&(e.input.enabled=!0),e.on("dragstart",u=>{this.currentPhase!==Me.Shop&&this.currentPhase!==Me.Preparation||!e.input||!e.input.enabled||(this.children.bringToTop(e),e.setAlpha(.7),e.setData("isDragging",!0),e.setData("originalX",e.x),e.setData("originalY",e.y),e.setData("originalAreaOnDragStart",e.getData("area")),e.setData("originalSlotKeyOnDragStart",e.getData("slotKey")))}),e.on("drag",(u,d,y)=>{if(e.getData("isDragging"))if(e.x=d,e.y=y,(this.currentPhase===Me.Shop||this.currentPhase===Me.Preparation)&&this.sellZone.visible)if(this.isDroppedOnSellZone(e)){const g=e.getData("instanceId"),E=e.getData("originalAreaOnDragStart"),h=e.getData("originalSlotKeyOnDragStart"),T=e.getData("ownerSessionId"),M=A==null?void 0:A.state.players.get(T);let J;if(M&&(E==="hand"?J=M.hand.get(h):J=M.battlefield.get(h)),J&&J.instanceId===g){const F=Math.max(1,Math.floor(J.brewCost/2));this.brewGainText.setText(`Sell: +${F} `),this.brewGainText.setAlpha(1)}else this.brewGainText.setAlpha(0)}else this.brewGainText.setAlpha(0);else this.brewGainText.setAlpha(0)}),e.on("dragend",u=>{if(!e.getData("isDragging"))return;e.setAlpha(1),e.setData("isDragging",!1),this.brewGainText.setAlpha(0);const d=e.getData("instanceId"),y=e.getData("originalAreaOnDragStart"),g=e.getData("originalSlotKeyOnDragStart"),E=e.getData("ownerSessionId");if((this.currentPhase===Me.Shop||this.currentPhase===Me.Preparation)&&this.sellZone.visible&&this.isDroppedOnSellZone(e)){const J=A==null?void 0:A.state.players.get(A==null?void 0:A.sessionId);let F;if(y==="hand"&&(J!=null&&J.hand.has(g))?F=J.hand.get(g):y==="battlefield"&&(J!=null&&J.battlefield.has(g))&&(F=J.battlefield.get(g)),F&&F.instanceId===d){const z=Math.max(1,Math.floor(F.brewCost/2));A==null||A.send("sellCard",{instanceId:d,area:y,slotKey:g}),this.showBrewGain(z);return}}let h=!1,T,M;for(let J=0;J<5;J++){const F=String(J),z=this.getSlotPixelPosition(!0,"hand",J);if(z){const ce=new Phaser.Geom.Rectangle(z.x-Un/2,z.y-Fn/2,Un,Fn);if(Phaser.Geom.Rectangle.Contains(ce,e.x,e.y)){if(this.isSlotEmpty(E,"hand",F,d)){let ge=!1;if(this.currentPhase===Me.Shop?y==="hand"&&(ge=!0):this.currentPhase===Me.Preparation&&y==="hand"&&(ge=!0),ge){e.x=z.x,e.y=z.y;const ie=y!=="hand";if(e.setData("area","hand"),e.setData("slotKey",F),this.updateVisualMaps(E,y,g,"hand",F,e),ie){const be=A==null?void 0:A.state.players.get(E);let Fe;be&&(Fe=be.hand.get(F),Fe||(y==="battlefield"?Fe=be.battlefield.get(g):Fe=be.hand.get(g))),Fe&&Fe.instanceId===d&&this.updateCardVisual(E,"hand",F,Fe)}h=!0,T="hand",M=F,this.currentPhase===Me.Shop&&(y!=="hand"||g!==F)&&(A==null||A.send("moveCardInHand",{instanceId:d,fromSlotKey:g,toSlotKey:F}))}}if(h)break}}}if(!h&&this.currentPhase===Me.Preparation)for(let J=0;J<5;J++){const F=String(J),z=this.getSlotPixelPosition(!0,"battlefield",J);if(z){const ce=new Phaser.Geom.Rectangle(z.x-Un/2,z.y-Fn/2,Un,Fn);if(Phaser.Geom.Rectangle.Contains(ce,e.x,e.y)){if(this.isSlotEmpty(E,"battlefield",F,d)){e.x=z.x,e.y=z.y;const ge=y!=="battlefield";if(e.setData("area","battlefield"),e.setData("slotKey",F),this.updateVisualMaps(E,y,g,"battlefield",F,e),ge){const ie=A==null?void 0:A.state.players.get(E),be=(ie==null?void 0:ie.battlefield.get(F))||(ie==null?void 0:ie.hand.get(g));be&&be.instanceId===d&&this.updateCardVisual(E,"battlefield",F,be)}h=!0,T="battlefield",M=F}break}}}if(h?this.currentPhase===Me.Preparation&&T&&M&&(y!==T||g!==M)&&(A==null||A.send("updatePrepLayout",{instanceId:d,newArea:T,newSlotKey:M})):(e.x=e.getData("originalX"),e.y=e.getData("originalY"),e.setData("area",y),e.setData("slotKey",g)),this.currentPhase===Me.Preparation){const J=this.scene.get("Preparation");J&&J.scene.isActive()&&J.updateStartButtonState&&J.updateStartButtonState()}})}getCardLayouts(){const e={},r={};if(!A||!A.sessionId){for(let u=0;u<5;u++)e[String(u)]=null,r[String(u)]=null;return{handLayout:e,battlefieldLayout:r}}const a=A.sessionId,l=this.playerVisuals.get(a);for(let u=0;u<5;u++){const d=String(u);if(l&&l.hand.has(d)){const y=l.hand.get(d);e[d]=(y==null?void 0:y.getData("instanceId"))||null}else e[d]=null;if(l&&l.battlefield.has(d)){const y=l.battlefield.get(d);r[d]=(y==null?void 0:y.getData("instanceId"))||null}else r[d]=null}return{handLayout:e,battlefieldLayout:r}}isSlotEmpty(e,r,a,l){const u=this.playerVisuals.get(e);if(!u)return!1;const y=(r==="hand"?u.hand:u.battlefield).get(a);return y?y.getData("instanceId")===l:!0}isDroppedOnSellZone(e){return this.sellZone.visible?new Phaser.Geom.Rectangle(this.sellZone.x-this.sellZoneRect.width/2-20,this.sellZone.y-this.sellZoneRect.height/2-20,this.sellZoneRect.width+40,this.sellZoneRect.height+40).contains(e.x,e.y):!1}showBrewGain(e){this.brewGainText.setText(`+${e} `),this.brewGainText.setAlpha(1),this.brewGainText.y=-50,this.brewGainText.x=0,this.tweens.add({targets:this.brewGainText,scaleX:1.5,scaleY:1.5,duration:100,yoyo:!0,ease:"Cubic.easeOut",onComplete:()=>{this.tweens.add({targets:this.brewGainText,y:this.brewGainText.y-80,alpha:0,duration:1500,ease:"Power2"})}}),this.tweens.add({targets:this.sellZoneRect,fillAlpha:.7,duration:200,yoyo:!0,repeat:1,ease:"Cubic.easeOut"})}updateVisualMaps(e,r,a,l,u,d){const y=this.playerVisuals.get(e);if(!y)return;const g=r==="hand"?y.hand:y.battlefield;g.get(a)===d&&g.delete(a),(l==="hand"?y.hand:y.battlefield).set(u,d)}getPlayerCardGameObjects(e){const r=[],a=this.playerVisuals.get(e);return a&&(a.hand.forEach(l=>r.push(l)),a.battlefield.forEach(l=>r.push(l))),r}getLocalPlayerLayoutData(){const e=[];if(!A||!A.sessionId)return e;const r=A.sessionId,a=this.playerVisuals.get(r);return a&&(a.hand.forEach((l,u)=>{e.push({instanceId:l.getData("instanceId"),area:"hand",slotKey:l.getData("slotKey")})}),a.battlefield.forEach((l,u)=>{e.push({instanceId:l.getData("instanceId"),area:"battlefield",slotKey:l.getData("slotKey")})})),e}createSellZone(){this.sellZone=this.add.container(this.cameras.main.width-80,this.cameras.main.height/2),this.sellZone.setDepth(1e3),this.sellZoneRect=this.add.rectangle(0,0,120,160,16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1),this.sellZone.add(this.sellZoneRect),this.sellZoneText=this.add.text(0,0,"SELL",{fontFamily:"Arial Black",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.sellZone.add(this.sellZoneText),this.brewGainText=this.add.text(0,-50,"",{fontFamily:"Arial Black",fontSize:20,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setAlpha(0),this.sellZone.add(this.brewGainText);const e=this.add.text(0,50,`Drag cards here
to sell`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5);this.sellZone.add(e),this.input.on("dragenter",(r,a,l)=>{a instanceof Phaser.GameObjects.Container&&this.sellZone.visible&&this.isDroppedOnSellZone(a)&&(this.sellZoneRect.setFillStyle(16711680,.5),this.sellZoneRect.setStrokeStyle(3,16733525,1))}),this.input.on("dragleave",(r,a,l)=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.input.on("drop",()=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.sellZone.setVisible(!1)}updateNavbarText(){if(!A||!A.state||!this.playerHealthText||!this.playerHealthText.active)return;const e=A.sessionId,r=A.state.players.get(e);let a,l="Opponent: --";A.state.players.forEach((y,g)=>{g!==e&&(a=y,l=`Opponent: ${y.username||"Connecting..."}`)}),this.playerHealthText.setText(`You: ${(r==null?void 0:r.health)??"--"} HP`),this.playerBrewsText.setText(`Brews: ${(r==null?void 0:r.brews)??"--"}`),this.opponentUsernameText.setText(l),this.opponentHealthText.setText(`${(a==null?void 0:a.health)??"--"} HP`);const u=A.state.currentDay,d=A.state.currentPhase;this.dayPhaseText.setText(`Day ${u} - ${d}`)}cleanupListeners(){var e,r,a,l,u,d,y;console.log("BoardView: Cleaning up listeners."),this.listeners.forEach(g=>{if(typeof g=="function")try{g()}catch(E){console.warn("BoardView: Error cleaning up listener:",E)}}),this.listeners=[],this.cardSchemaListeners.forEach((g,E)=>{console.log(`BoardView cleanup: Cleaning up ${g.length} listeners for card instance ${E}`),g.forEach(h=>{if(typeof h=="function")try{h()}catch(T){console.warn(`BoardView: Error unsubscribing card listener for ${E}`,T)}})}),this.cardSchemaListeners.clear(),this.playerVisuals.forEach(g=>{g.hand.forEach(E=>E.destroy()),g.battlefield.forEach(E=>E.destroy())}),this.playerVisuals.clear(),(e=this.playerHealthText)==null||e.destroy(),(r=this.opponentHealthText)==null||r.destroy(),(a=this.playerBrewsText)==null||a.destroy(),(l=this.dayPhaseText)==null||l.destroy(),(u=this.opponentUsernameText)==null||u.destroy(),(d=this.sellZone)==null||d.destroy(),(y=this.brewGainText)==null||y.destroy(),this.input.off("dragenter"),this.input.off("dragleave"),this.input.off("drop")}shutdown(){console.log("BoardView shutting down..."),this.cleanupListeners(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}(async()=>(await Pp(),new va({type:Phaser.AUTO,parent:"gameParent",width:1280,height:720,backgroundColor:"#000000",roundPixels:!1,pixelArt:!1,scene:[kp,Mp,$p,Vp,jp,Hp,Gp,Zp,Bp,Up]})))();
