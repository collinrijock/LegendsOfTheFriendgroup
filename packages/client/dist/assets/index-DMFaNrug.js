var jc=Object.defineProperty;var Hc=(s,t,e)=>t in s?jc(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var ce=(s,t,e)=>(Hc(s,typeof t!="symbol"?t+"":t,e),e);import{P as mr,c as La,g as ka,p as fs}from"./phaser-B90dPXin.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function e(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=e(a);fetch(a.href,l)}})();const je=class je{constructor(t){ce(this,"game");ce(this,"canvas");ce(this,"parent");ce(this,"guide");const e=t.width,i=t.height;je.width=e,je.height=i,je.center=new mr.Math.Vector2(e/2,i/2),je.isLandscape=je.width>je.height,je.gameZone=new mr.Geom.Rectangle(0,0,e,i),je.uiZone=new mr.Geom.Rectangle(0,0,e,i),je.cameras=new Set,t.callbacks={postBoot:()=>this.gameBootHandler()},this.game=new mr.Game(t)}gameBootHandler(){je.scaleManager=this.game.scale,je.scaleManager.on("resize",()=>this.onResizeHandler()),this.canvas=this.game.canvas,this.parent=this.canvas.parentElement,this.guide=document.getElementById("guide"),window.setTimeout(()=>this.onResizeHandler(),16)}onResizeHandler(){const t=this.parent.getBoundingClientRect(),e=this.canvas.getBoundingClientRect(),i=this.guide.getBoundingClientRect(),a=t.width/je.width,l=t.height/je.height,u=Math.max(a,l),d=t.width-a,m=t.height-l,g=d*(1/u),y=m*(1/u),h=je.width/2-g/2,I=je.width/2+g/2,j=je.height/2-y/2,J=je.height/2+y/2;je.uiZone.left=h,je.uiZone.right=I,je.uiZone.top=j,je.uiZone.bottom=J;const H=i.width/e.width,z=i.height/e.height,ue=Math.min(H,z);je.scaleFactor=ue,je.cameras.forEach(de=>{de.zoom=ue}),this.game.events.emit(je.RESIZE)}static addCamera(t){this.cameras.add(t),t.zoom=je.scaleFactor}static removeCamera(t){this.cameras.delete(t)}static getX(t){if(typeof t=="number")return t;const e=this.scaleManager.width,i=parseInt(t,10);return e*(i/100)}static getY(t){if(typeof t=="number")return t;const e=this.scaleManager.height,i=parseInt(t,10);return e*(i/100)}static getUIX(t){if(typeof t=="number")return t;const e=je.uiZone.width,i=parseInt(t,10);return e*(i/100)}static getUIY(t){if(typeof t=="number")return t;const e=je.uiZone.height,i=parseInt(t,10);return e*(i/100)}};ce(je,"scaleManager"),ce(je,"cameras"),ce(je,"gameZone"),ce(je,"uiZone"),ce(je,"width"),ce(je,"height"),ce(je,"center"),ce(je,"isLandscape"),ce(je,"scaleFactor",1),ce(je,"scaleFactor2",1),ce(je,"RESIZE","scaleflowresize");let ya=je;var yr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ba(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Wo={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function a(m,g,y){this.fn=m,this.context=g,this.once=y||!1}function l(m,g,y,h,I){if(typeof y!="function")throw new TypeError("The listener must be a function");var j=new a(y,h||m,I),J=e?e+g:g;return m._events[J]?m._events[J].fn?m._events[J]=[m._events[J],j]:m._events[J].push(j):(m._events[J]=j,m._eventsCount++),m}function u(m,g){--m._eventsCount===0?m._events=new i:delete m._events[g]}function d(){this._events=new i,this._eventsCount=0}d.prototype.eventNames=function(){var g=[],y,h;if(this._eventsCount===0)return g;for(h in y=this._events)t.call(y,h)&&g.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(y)):g},d.prototype.listeners=function(g){var y=e?e+g:g,h=this._events[y];if(!h)return[];if(h.fn)return[h.fn];for(var I=0,j=h.length,J=new Array(j);I<j;I++)J[I]=h[I].fn;return J},d.prototype.listenerCount=function(g){var y=e?e+g:g,h=this._events[y];return h?h.fn?1:h.length:0},d.prototype.emit=function(g,y,h,I,j,J){var H=e?e+g:g;if(!this._events[H])return!1;var z=this._events[H],ue=arguments.length,de,re;if(z.fn){switch(z.once&&this.removeListener(g,z.fn,void 0,!0),ue){case 1:return z.fn.call(z.context),!0;case 2:return z.fn.call(z.context,y),!0;case 3:return z.fn.call(z.context,y,h),!0;case 4:return z.fn.call(z.context,y,h,I),!0;case 5:return z.fn.call(z.context,y,h,I,j),!0;case 6:return z.fn.call(z.context,y,h,I,j,J),!0}for(re=1,de=new Array(ue-1);re<ue;re++)de[re-1]=arguments[re];z.fn.apply(z.context,de)}else{var Te=z.length,$e;for(re=0;re<Te;re++)switch(z[re].once&&this.removeListener(g,z[re].fn,void 0,!0),ue){case 1:z[re].fn.call(z[re].context);break;case 2:z[re].fn.call(z[re].context,y);break;case 3:z[re].fn.call(z[re].context,y,h);break;case 4:z[re].fn.call(z[re].context,y,h,I);break;default:if(!de)for($e=1,de=new Array(ue-1);$e<ue;$e++)de[$e-1]=arguments[$e];z[re].fn.apply(z[re].context,de)}}return!0},d.prototype.on=function(g,y,h){return l(this,g,y,h,!1)},d.prototype.once=function(g,y,h){return l(this,g,y,h,!0)},d.prototype.removeListener=function(g,y,h,I){var j=e?e+g:g;if(!this._events[j])return this;if(!y)return u(this,j),this;var J=this._events[j];if(J.fn)J.fn===y&&(!I||J.once)&&(!h||J.context===h)&&u(this,j);else{for(var H=0,z=[],ue=J.length;H<ue;H++)(J[H].fn!==y||I&&!J[H].once||h&&J[H].context!==h)&&z.push(J[H]);z.length?this._events[j]=z.length===1?z[0]:z:u(this,j)}return this},d.prototype.removeAllListeners=function(g){var y;return g?(y=e?e+g:g,this._events[y]&&u(this,y)):(this._events=new i,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=e,d.EventEmitter=d,s.exports=d})(Wo);var Gc=Wo.exports,Ko=Ba(Gc),et;(function(s){s.assertEqual=a=>a;function t(a){}s.assertIs=t;function e(a){throw new Error}s.assertNever=e,s.arrayToEnum=a=>{const l={};for(const u of a)l[u]=u;return l},s.getValidEnumValues=a=>{const l=s.objectKeys(a).filter(d=>typeof a[a[d]]!="number"),u={};for(const d of l)u[d]=a[d];return s.objectValues(u)},s.objectValues=a=>s.objectKeys(a).map(function(l){return a[l]}),s.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const l=[];for(const u in a)Object.prototype.hasOwnProperty.call(a,u)&&l.push(u);return l},s.find=(a,l)=>{for(const u of a)if(l(u))return u},s.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function i(a,l=" | "){return a.map(u=>typeof u=="string"?`'${u}'`:u).join(l)}s.joinValues=i,s.jsonStringifyReplacer=(a,l)=>typeof l=="bigint"?l.toString():l})(et||(et={}));var ba;(function(s){s.mergeShapes=(t,e)=>({...t,...e})})(ba||(ba={}));const pe=et.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ps=s=>{switch(typeof s){case"undefined":return pe.undefined;case"string":return pe.string;case"number":return isNaN(s)?pe.nan:pe.number;case"boolean":return pe.boolean;case"function":return pe.function;case"bigint":return pe.bigint;case"symbol":return pe.symbol;case"object":return Array.isArray(s)?pe.array:s===null?pe.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?pe.promise:typeof Map<"u"&&s instanceof Map?pe.map:typeof Set<"u"&&s instanceof Set?pe.set:typeof Date<"u"&&s instanceof Date?pe.date:pe.object;default:return pe.unknown}},ie=et.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Zc=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:");class An extends Error{constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const e=t||function(l){return l.message},i={_errors:[]},a=l=>{for(const u of l.issues)if(u.code==="invalid_union")u.unionErrors.map(a);else if(u.code==="invalid_return_type")a(u.returnTypeError);else if(u.code==="invalid_arguments")a(u.argumentsError);else if(u.path.length===0)i._errors.push(e(u));else{let d=i,m=0;for(;m<u.path.length;){const g=u.path[m];m===u.path.length-1?(d[g]=d[g]||{_errors:[]},d[g]._errors.push(e(u))):d[g]=d[g]||{_errors:[]},d=d[g],m++}}};return a(this),i}static assert(t){if(!(t instanceof An))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,et.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){const e={},i=[];for(const a of this.issues)a.path.length>0?(e[a.path[0]]=e[a.path[0]]||[],e[a.path[0]].push(t(a))):i.push(t(a));return{formErrors:i,fieldErrors:e}}get formErrors(){return this.flatten()}}An.create=s=>new An(s);const wi=(s,t)=>{let e;switch(s.code){case ie.invalid_type:s.received===pe.undefined?e="Required":e=`Expected ${s.expected}, received ${s.received}`;break;case ie.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(s.expected,et.jsonStringifyReplacer)}`;break;case ie.unrecognized_keys:e=`Unrecognized key(s) in object: ${et.joinValues(s.keys,", ")}`;break;case ie.invalid_union:e="Invalid input";break;case ie.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${et.joinValues(s.options)}`;break;case ie.invalid_enum_value:e=`Invalid enum value. Expected ${et.joinValues(s.options)}, received '${s.received}'`;break;case ie.invalid_arguments:e="Invalid function arguments";break;case ie.invalid_return_type:e="Invalid function return type";break;case ie.invalid_date:e="Invalid date";break;case ie.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(e=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?e=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?e=`Invalid input: must end with "${s.validation.endsWith}"`:et.assertNever(s.validation):s.validation!=="regex"?e=`Invalid ${s.validation}`:e="Invalid";break;case ie.too_small:s.type==="array"?e=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?e=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?e=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?e=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:e="Invalid input";break;case ie.too_big:s.type==="array"?e=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?e=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?e=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?e=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?e=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:e="Invalid input";break;case ie.custom:e="Invalid input";break;case ie.invalid_intersection_types:e="Intersection results could not be merged";break;case ie.not_multiple_of:e=`Number must be a multiple of ${s.multipleOf}`;break;case ie.not_finite:e="Number must be finite";break;default:e=t.defaultError,et.assertNever(s)}return{message:e}};let qo=wi;function zc(s){qo=s}function xr(){return qo}const Dr=s=>{const{data:t,path:e,errorMaps:i,issueData:a}=s,l=[...e,...a.path||[]],u={...a,path:l};if(a.message!==void 0)return{...a,path:l,message:a.message};let d="";const m=i.filter(g=>!!g).slice().reverse();for(const g of m)d=g(u,{data:t,defaultError:d}).message;return{...a,path:l,message:d}},Wc=[];function he(s,t){const e=xr(),i=Dr({issueData:t,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,e,e===wi?void 0:wi].filter(a=>!!a)});s.common.issues.push(i)}class Yt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){const i=[];for(const a of e){if(a.status==="aborted")return Le;a.status==="dirty"&&t.dirty(),i.push(a.value)}return{status:t.value,value:i}}static async mergeObjectAsync(t,e){const i=[];for(const a of e){const l=await a.key,u=await a.value;i.push({key:l,value:u})}return Yt.mergeObjectSync(t,i)}static mergeObjectSync(t,e){const i={};for(const a of e){const{key:l,value:u}=a;if(l.status==="aborted"||u.status==="aborted")return Le;l.status==="dirty"&&t.dirty(),u.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof u.value<"u"||a.alwaysSet)&&(i[l.value]=u.value)}return{status:t.value,value:i}}}const Le=Object.freeze({status:"aborted"}),vi=s=>({status:"dirty",value:s}),un=s=>({status:"valid",value:s}),Ea=s=>s.status==="aborted",va=s=>s.status==="dirty",Zi=s=>s.status==="valid",zi=s=>typeof Promise<"u"&&s instanceof Promise;function Rr(s,t,e,i){if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(s)}function Yo(s,t,e,i,a){if(typeof t=="function"?s!==t||!a:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(s,e),e}var _e;(function(s){s.errToObj=t=>typeof t=="string"?{message:t}:t||{},s.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(_e||(_e={}));var ji,Hi;class os{constructor(t,e,i,a){this._cachedPath=[],this.parent=t,this.data=e,this._path=i,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const po=(s,t)=>{if(Zi(t))return{success:!0,data:t.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const e=new An(s.common.issues);return this._error=e,this._error}}};function Fe(s){if(!s)return{};const{errorMap:t,invalid_type_error:e,required_error:i,description:a}=s;if(t&&(e||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(u,d)=>{var m,g;const{message:y}=s;return u.code==="invalid_enum_value"?{message:y??d.defaultError}:typeof d.data>"u"?{message:(m=y??i)!==null&&m!==void 0?m:d.defaultError}:u.code!=="invalid_type"?{message:d.defaultError}:{message:(g=y??e)!==null&&g!==void 0?g:d.defaultError}},description:a}}class He{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return Ps(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:Ps(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Yt,ctx:{common:t.parent.common,data:t.data,parsedType:Ps(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(zi(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const i=this.safeParse(t,e);if(i.success)return i.data;throw i.error}safeParse(t,e){var i;const a={common:{issues:[],async:(i=e==null?void 0:e.async)!==null&&i!==void 0?i:!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ps(t)},l=this._parseSync({data:t,path:a.path,parent:a});return po(a,l)}async parseAsync(t,e){const i=await this.safeParseAsync(t,e);if(i.success)return i.data;throw i.error}async safeParseAsync(t,e){const i={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ps(t)},a=this._parse({data:t,path:i.path,parent:i}),l=await(zi(a)?a:Promise.resolve(a));return po(i,l)}refine(t,e){const i=a=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(a):e;return this._refinement((a,l)=>{const u=t(a),d=()=>l.addIssue({code:ie.custom,...i(a)});return typeof Promise<"u"&&u instanceof Promise?u.then(m=>m?!0:(d(),!1)):u?!0:(d(),!1)})}refinement(t,e){return this._refinement((i,a)=>t(i)?!0:(a.addIssue(typeof e=="function"?e(i,a):e),!1))}_refinement(t){return new Gn({schema:this,typeName:Ce.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return as.create(this,this._def)}nullable(){return Fs.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jn.create(this,this._def)}promise(){return Ii.create(this,this._def)}or(t){return Yi.create([this,t],this._def)}and(t){return Xi.create(this,t,this._def)}transform(t){return new Gn({...Fe(this._def),schema:this,typeName:Ce.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const e=typeof t=="function"?t:()=>t;return new nr({...Fe(this._def),innerType:this,defaultValue:e,typeName:Ce.ZodDefault})}brand(){return new $a({typeName:Ce.ZodBranded,type:this,...Fe(this._def)})}catch(t){const e=typeof t=="function"?t:()=>t;return new sr({...Fe(this._def),innerType:this,catchValue:e,typeName:Ce.ZodCatch})}describe(t){const e=this.constructor;return new e({...this._def,description:t})}pipe(t){return or.create(this,t)}readonly(){return ir.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Kc=/^c[^\s-]{8,}$/i,qc=/^[0-9a-z]+$/,Yc=/^[0-9A-HJKMNP-TV-Z]{26}$/,Xc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Jc=/^[a-z0-9_-]{21}$/i,Qc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ef=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tf="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ia;const nf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,sf=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,rf=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Xo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",af=new RegExp(`^${Xo}$`);function Jo(s){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return s.precision?t=`${t}\\.\\d{${s.precision}}`:s.precision==null&&(t=`${t}(\\.\\d+)?`),t}function of(s){return new RegExp(`^${Jo(s)}$`)}function Qo(s){let t=`${Xo}T${Jo(s)}`;const e=[];return e.push(s.local?"Z?":"Z"),s.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function lf(s,t){return!!((t==="v4"||!t)&&nf.test(s)||(t==="v6"||!t)&&sf.test(s))}class Vn extends He{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==pe.string){const l=this._getOrReturnCtx(t);return he(l,{code:ie.invalid_type,expected:pe.string,received:l.parsedType}),Le}const i=new Yt;let a;for(const l of this._def.checks)if(l.kind==="min")t.data.length<l.value&&(a=this._getOrReturnCtx(t,a),he(a,{code:ie.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),i.dirty());else if(l.kind==="max")t.data.length>l.value&&(a=this._getOrReturnCtx(t,a),he(a,{code:ie.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),i.dirty());else if(l.kind==="length"){const u=t.data.length>l.value,d=t.data.length<l.value;(u||d)&&(a=this._getOrReturnCtx(t,a),u?he(a,{code:ie.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):d&&he(a,{code:ie.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),i.dirty())}else if(l.kind==="email")ef.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"email",code:ie.invalid_string,message:l.message}),i.dirty());else if(l.kind==="emoji")ia||(ia=new RegExp(tf,"u")),ia.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"emoji",code:ie.invalid_string,message:l.message}),i.dirty());else if(l.kind==="uuid")Xc.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"uuid",code:ie.invalid_string,message:l.message}),i.dirty());else if(l.kind==="nanoid")Jc.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"nanoid",code:ie.invalid_string,message:l.message}),i.dirty());else if(l.kind==="cuid")Kc.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"cuid",code:ie.invalid_string,message:l.message}),i.dirty());else if(l.kind==="cuid2")qc.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"cuid2",code:ie.invalid_string,message:l.message}),i.dirty());else if(l.kind==="ulid")Yc.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"ulid",code:ie.invalid_string,message:l.message}),i.dirty());else if(l.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),he(a,{validation:"url",code:ie.invalid_string,message:l.message}),i.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"regex",code:ie.invalid_string,message:l.message}),i.dirty())):l.kind==="trim"?t.data=t.data.trim():l.kind==="includes"?t.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(t,a),he(a,{code:ie.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),i.dirty()):l.kind==="toLowerCase"?t.data=t.data.toLowerCase():l.kind==="toUpperCase"?t.data=t.data.toUpperCase():l.kind==="startsWith"?t.data.startsWith(l.value)||(a=this._getOrReturnCtx(t,a),he(a,{code:ie.invalid_string,validation:{startsWith:l.value},message:l.message}),i.dirty()):l.kind==="endsWith"?t.data.endsWith(l.value)||(a=this._getOrReturnCtx(t,a),he(a,{code:ie.invalid_string,validation:{endsWith:l.value},message:l.message}),i.dirty()):l.kind==="datetime"?Qo(l).test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{code:ie.invalid_string,validation:"datetime",message:l.message}),i.dirty()):l.kind==="date"?af.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{code:ie.invalid_string,validation:"date",message:l.message}),i.dirty()):l.kind==="time"?of(l).test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{code:ie.invalid_string,validation:"time",message:l.message}),i.dirty()):l.kind==="duration"?Qc.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"duration",code:ie.invalid_string,message:l.message}),i.dirty()):l.kind==="ip"?lf(t.data,l.version)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"ip",code:ie.invalid_string,message:l.message}),i.dirty()):l.kind==="base64"?rf.test(t.data)||(a=this._getOrReturnCtx(t,a),he(a,{validation:"base64",code:ie.invalid_string,message:l.message}),i.dirty()):et.assertNever(l);return{status:i.value,value:t.data}}_regex(t,e,i){return this.refinement(a=>t.test(a),{validation:e,code:ie.invalid_string,..._e.errToObj(i)})}_addCheck(t){return new Vn({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",..._e.errToObj(t)})}url(t){return this._addCheck({kind:"url",..._e.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",..._e.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",..._e.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",..._e.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",..._e.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",..._e.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",..._e.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",..._e.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",..._e.errToObj(t)})}datetime(t){var e,i;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(e=t==null?void 0:t.offset)!==null&&e!==void 0?e:!1,local:(i=t==null?void 0:t.local)!==null&&i!==void 0?i:!1,..._e.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,..._e.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",..._e.errToObj(t)})}regex(t,e){return this._addCheck({kind:"regex",regex:t,..._e.errToObj(e)})}includes(t,e){return this._addCheck({kind:"includes",value:t,position:e==null?void 0:e.position,..._e.errToObj(e==null?void 0:e.message)})}startsWith(t,e){return this._addCheck({kind:"startsWith",value:t,..._e.errToObj(e)})}endsWith(t,e){return this._addCheck({kind:"endsWith",value:t,..._e.errToObj(e)})}min(t,e){return this._addCheck({kind:"min",value:t,..._e.errToObj(e)})}max(t,e){return this._addCheck({kind:"max",value:t,..._e.errToObj(e)})}length(t,e){return this._addCheck({kind:"length",value:t,..._e.errToObj(e)})}nonempty(t){return this.min(1,_e.errToObj(t))}trim(){return new Vn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Vn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Vn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}Vn.create=s=>{var t;return new Vn({checks:[],typeName:Ce.ZodString,coerce:(t=s==null?void 0:s.coerce)!==null&&t!==void 0?t:!1,...Fe(s)})};function cf(s,t){const e=(s.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,a=e>i?e:i,l=parseInt(s.toFixed(a).replace(".","")),u=parseInt(t.toFixed(a).replace(".",""));return l%u/Math.pow(10,a)}class $s extends He{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==pe.number){const l=this._getOrReturnCtx(t);return he(l,{code:ie.invalid_type,expected:pe.number,received:l.parsedType}),Le}let i;const a=new Yt;for(const l of this._def.checks)l.kind==="int"?et.isInteger(t.data)||(i=this._getOrReturnCtx(t,i),he(i,{code:ie.invalid_type,expected:"integer",received:"float",message:l.message}),a.dirty()):l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(i=this._getOrReturnCtx(t,i),he(i,{code:ie.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(i=this._getOrReturnCtx(t,i),he(i,{code:ie.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="multipleOf"?cf(t.data,l.value)!==0&&(i=this._getOrReturnCtx(t,i),he(i,{code:ie.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):l.kind==="finite"?Number.isFinite(t.data)||(i=this._getOrReturnCtx(t,i),he(i,{code:ie.not_finite,message:l.message}),a.dirty()):et.assertNever(l);return{status:a.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,_e.toString(e))}gt(t,e){return this.setLimit("min",t,!1,_e.toString(e))}lte(t,e){return this.setLimit("max",t,!0,_e.toString(e))}lt(t,e){return this.setLimit("max",t,!1,_e.toString(e))}setLimit(t,e,i,a){return new $s({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:_e.toString(a)}]})}_addCheck(t){return new $s({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:_e.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_e.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_e.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_e.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_e.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:_e.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:_e.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_e.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_e.toString(t)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&et.isInteger(t.value))}get isFinite(){let t=null,e=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(e===null||i.value>e)&&(e=i.value):i.kind==="max"&&(t===null||i.value<t)&&(t=i.value)}return Number.isFinite(e)&&Number.isFinite(t)}}$s.create=s=>new $s({checks:[],typeName:Ce.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...Fe(s)});class Ms extends He{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==pe.bigint){const l=this._getOrReturnCtx(t);return he(l,{code:ie.invalid_type,expected:pe.bigint,received:l.parsedType}),Le}let i;const a=new Yt;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(i=this._getOrReturnCtx(t,i),he(i,{code:ie.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(i=this._getOrReturnCtx(t,i),he(i,{code:ie.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="multipleOf"?t.data%l.value!==BigInt(0)&&(i=this._getOrReturnCtx(t,i),he(i,{code:ie.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):et.assertNever(l);return{status:a.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,_e.toString(e))}gt(t,e){return this.setLimit("min",t,!1,_e.toString(e))}lte(t,e){return this.setLimit("max",t,!0,_e.toString(e))}lt(t,e){return this.setLimit("max",t,!1,_e.toString(e))}setLimit(t,e,i,a){return new Ms({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:_e.toString(a)}]})}_addCheck(t){return new Ms({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_e.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_e.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_e.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_e.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:_e.toString(e)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}Ms.create=s=>{var t;return new Ms({checks:[],typeName:Ce.ZodBigInt,coerce:(t=s==null?void 0:s.coerce)!==null&&t!==void 0?t:!1,...Fe(s)})};class Wi extends He{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==pe.boolean){const i=this._getOrReturnCtx(t);return he(i,{code:ie.invalid_type,expected:pe.boolean,received:i.parsedType}),Le}return un(t.data)}}Wi.create=s=>new Wi({typeName:Ce.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...Fe(s)});class pi extends He{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==pe.date){const l=this._getOrReturnCtx(t);return he(l,{code:ie.invalid_type,expected:pe.date,received:l.parsedType}),Le}if(isNaN(t.data.getTime())){const l=this._getOrReturnCtx(t);return he(l,{code:ie.invalid_date}),Le}const i=new Yt;let a;for(const l of this._def.checks)l.kind==="min"?t.data.getTime()<l.value&&(a=this._getOrReturnCtx(t,a),he(a,{code:ie.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),i.dirty()):l.kind==="max"?t.data.getTime()>l.value&&(a=this._getOrReturnCtx(t,a),he(a,{code:ie.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),i.dirty()):et.assertNever(l);return{status:i.value,value:new Date(t.data.getTime())}}_addCheck(t){return new pi({...this._def,checks:[...this._def.checks,t]})}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:_e.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:_e.toString(e)})}get minDate(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}}pi.create=s=>new pi({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:Ce.ZodDate,...Fe(s)});class Nr extends He{_parse(t){if(this._getType(t)!==pe.symbol){const i=this._getOrReturnCtx(t);return he(i,{code:ie.invalid_type,expected:pe.symbol,received:i.parsedType}),Le}return un(t.data)}}Nr.create=s=>new Nr({typeName:Ce.ZodSymbol,...Fe(s)});class Ki extends He{_parse(t){if(this._getType(t)!==pe.undefined){const i=this._getOrReturnCtx(t);return he(i,{code:ie.invalid_type,expected:pe.undefined,received:i.parsedType}),Le}return un(t.data)}}Ki.create=s=>new Ki({typeName:Ce.ZodUndefined,...Fe(s)});class qi extends He{_parse(t){if(this._getType(t)!==pe.null){const i=this._getOrReturnCtx(t);return he(i,{code:ie.invalid_type,expected:pe.null,received:i.parsedType}),Le}return un(t.data)}}qi.create=s=>new qi({typeName:Ce.ZodNull,...Fe(s)});class Ti extends He{constructor(){super(...arguments),this._any=!0}_parse(t){return un(t.data)}}Ti.create=s=>new Ti({typeName:Ce.ZodAny,...Fe(s)});class di extends He{constructor(){super(...arguments),this._unknown=!0}_parse(t){return un(t.data)}}di.create=s=>new di({typeName:Ce.ZodUnknown,...Fe(s)});class Ss extends He{_parse(t){const e=this._getOrReturnCtx(t);return he(e,{code:ie.invalid_type,expected:pe.never,received:e.parsedType}),Le}}Ss.create=s=>new Ss({typeName:Ce.ZodNever,...Fe(s)});class Pr extends He{_parse(t){if(this._getType(t)!==pe.undefined){const i=this._getOrReturnCtx(t);return he(i,{code:ie.invalid_type,expected:pe.void,received:i.parsedType}),Le}return un(t.data)}}Pr.create=s=>new Pr({typeName:Ce.ZodVoid,...Fe(s)});class jn extends He{_parse(t){const{ctx:e,status:i}=this._processInputParams(t),a=this._def;if(e.parsedType!==pe.array)return he(e,{code:ie.invalid_type,expected:pe.array,received:e.parsedType}),Le;if(a.exactLength!==null){const u=e.data.length>a.exactLength.value,d=e.data.length<a.exactLength.value;(u||d)&&(he(e,{code:u?ie.too_big:ie.too_small,minimum:d?a.exactLength.value:void 0,maximum:u?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),i.dirty())}if(a.minLength!==null&&e.data.length<a.minLength.value&&(he(e,{code:ie.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),i.dirty()),a.maxLength!==null&&e.data.length>a.maxLength.value&&(he(e,{code:ie.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),i.dirty()),e.common.async)return Promise.all([...e.data].map((u,d)=>a.type._parseAsync(new os(e,u,e.path,d)))).then(u=>Yt.mergeArray(i,u));const l=[...e.data].map((u,d)=>a.type._parseSync(new os(e,u,e.path,d)));return Yt.mergeArray(i,l)}get element(){return this._def.type}min(t,e){return new jn({...this._def,minLength:{value:t,message:_e.toString(e)}})}max(t,e){return new jn({...this._def,maxLength:{value:t,message:_e.toString(e)}})}length(t,e){return new jn({...this._def,exactLength:{value:t,message:_e.toString(e)}})}nonempty(t){return this.min(1,t)}}jn.create=(s,t)=>new jn({type:s,minLength:null,maxLength:null,exactLength:null,typeName:Ce.ZodArray,...Fe(t)});function Ei(s){if(s instanceof _t){const t={};for(const e in s.shape){const i=s.shape[e];t[e]=as.create(Ei(i))}return new _t({...s._def,shape:()=>t})}else return s instanceof jn?new jn({...s._def,type:Ei(s.element)}):s instanceof as?as.create(Ei(s.unwrap())):s instanceof Fs?Fs.create(Ei(s.unwrap())):s instanceof ls?ls.create(s.items.map(t=>Ei(t))):s}class _t extends He{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),e=et.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==pe.object){const g=this._getOrReturnCtx(t);return he(g,{code:ie.invalid_type,expected:pe.object,received:g.parsedType}),Le}const{status:i,ctx:a}=this._processInputParams(t),{shape:l,keys:u}=this._getCached(),d=[];if(!(this._def.catchall instanceof Ss&&this._def.unknownKeys==="strip"))for(const g in a.data)u.includes(g)||d.push(g);const m=[];for(const g of u){const y=l[g],h=a.data[g];m.push({key:{status:"valid",value:g},value:y._parse(new os(a,h,a.path,g)),alwaysSet:g in a.data})}if(this._def.catchall instanceof Ss){const g=this._def.unknownKeys;if(g==="passthrough")for(const y of d)m.push({key:{status:"valid",value:y},value:{status:"valid",value:a.data[y]}});else if(g==="strict")d.length>0&&(he(a,{code:ie.unrecognized_keys,keys:d}),i.dirty());else if(g!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const g=this._def.catchall;for(const y of d){const h=a.data[y];m.push({key:{status:"valid",value:y},value:g._parse(new os(a,h,a.path,y)),alwaysSet:y in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const g=[];for(const y of m){const h=await y.key,I=await y.value;g.push({key:h,value:I,alwaysSet:y.alwaysSet})}return g}).then(g=>Yt.mergeObjectSync(i,g)):Yt.mergeObjectSync(i,m)}get shape(){return this._def.shape()}strict(t){return _e.errToObj,new _t({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(e,i)=>{var a,l,u,d;const m=(u=(l=(a=this._def).errorMap)===null||l===void 0?void 0:l.call(a,e,i).message)!==null&&u!==void 0?u:i.defaultError;return e.code==="unrecognized_keys"?{message:(d=_e.errToObj(t).message)!==null&&d!==void 0?d:m}:{message:m}}}:{}})}strip(){return new _t({...this._def,unknownKeys:"strip"})}passthrough(){return new _t({...this._def,unknownKeys:"passthrough"})}extend(t){return new _t({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new _t({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Ce.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new _t({...this._def,catchall:t})}pick(t){const e={};return et.objectKeys(t).forEach(i=>{t[i]&&this.shape[i]&&(e[i]=this.shape[i])}),new _t({...this._def,shape:()=>e})}omit(t){const e={};return et.objectKeys(this.shape).forEach(i=>{t[i]||(e[i]=this.shape[i])}),new _t({...this._def,shape:()=>e})}deepPartial(){return Ei(this)}partial(t){const e={};return et.objectKeys(this.shape).forEach(i=>{const a=this.shape[i];t&&!t[i]?e[i]=a:e[i]=a.optional()}),new _t({...this._def,shape:()=>e})}required(t){const e={};return et.objectKeys(this.shape).forEach(i=>{if(t&&!t[i])e[i]=this.shape[i];else{let l=this.shape[i];for(;l instanceof as;)l=l._def.innerType;e[i]=l}}),new _t({...this._def,shape:()=>e})}keyof(){return el(et.objectKeys(this.shape))}}_t.create=(s,t)=>new _t({shape:()=>s,unknownKeys:"strip",catchall:Ss.create(),typeName:Ce.ZodObject,...Fe(t)});_t.strictCreate=(s,t)=>new _t({shape:()=>s,unknownKeys:"strict",catchall:Ss.create(),typeName:Ce.ZodObject,...Fe(t)});_t.lazycreate=(s,t)=>new _t({shape:s,unknownKeys:"strip",catchall:Ss.create(),typeName:Ce.ZodObject,...Fe(t)});class Yi extends He{_parse(t){const{ctx:e}=this._processInputParams(t),i=this._def.options;function a(l){for(const d of l)if(d.result.status==="valid")return d.result;for(const d of l)if(d.result.status==="dirty")return e.common.issues.push(...d.ctx.common.issues),d.result;const u=l.map(d=>new An(d.ctx.common.issues));return he(e,{code:ie.invalid_union,unionErrors:u}),Le}if(e.common.async)return Promise.all(i.map(async l=>{const u={...e,common:{...e.common,issues:[]},parent:null};return{result:await l._parseAsync({data:e.data,path:e.path,parent:u}),ctx:u}})).then(a);{let l;const u=[];for(const m of i){const g={...e,common:{...e.common,issues:[]},parent:null},y=m._parseSync({data:e.data,path:e.path,parent:g});if(y.status==="valid")return y;y.status==="dirty"&&!l&&(l={result:y,ctx:g}),g.common.issues.length&&u.push(g.common.issues)}if(l)return e.common.issues.push(...l.ctx.common.issues),l.result;const d=u.map(m=>new An(m));return he(e,{code:ie.invalid_union,unionErrors:d}),Le}}get options(){return this._def.options}}Yi.create=(s,t)=>new Yi({options:s,typeName:Ce.ZodUnion,...Fe(t)});const Es=s=>s instanceof Qi?Es(s.schema):s instanceof Gn?Es(s.innerType()):s instanceof er?[s.value]:s instanceof Us?s.options:s instanceof tr?et.objectValues(s.enum):s instanceof nr?Es(s._def.innerType):s instanceof Ki?[void 0]:s instanceof qi?[null]:s instanceof as?[void 0,...Es(s.unwrap())]:s instanceof Fs?[null,...Es(s.unwrap())]:s instanceof $a||s instanceof ir?Es(s.unwrap()):s instanceof sr?Es(s._def.innerType):[];class Vr extends He{_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==pe.object)return he(e,{code:ie.invalid_type,expected:pe.object,received:e.parsedType}),Le;const i=this.discriminator,a=e.data[i],l=this.optionsMap.get(a);return l?e.common.async?l._parseAsync({data:e.data,path:e.path,parent:e}):l._parseSync({data:e.data,path:e.path,parent:e}):(he(e,{code:ie.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),Le)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,i){const a=new Map;for(const l of e){const u=Es(l.shape[t]);if(!u.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const d of u){if(a.has(d))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(d)}`);a.set(d,l)}}return new Vr({typeName:Ce.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:a,...Fe(i)})}}function _a(s,t){const e=Ps(s),i=Ps(t);if(s===t)return{valid:!0,data:s};if(e===pe.object&&i===pe.object){const a=et.objectKeys(t),l=et.objectKeys(s).filter(d=>a.indexOf(d)!==-1),u={...s,...t};for(const d of l){const m=_a(s[d],t[d]);if(!m.valid)return{valid:!1};u[d]=m.data}return{valid:!0,data:u}}else if(e===pe.array&&i===pe.array){if(s.length!==t.length)return{valid:!1};const a=[];for(let l=0;l<s.length;l++){const u=s[l],d=t[l],m=_a(u,d);if(!m.valid)return{valid:!1};a.push(m.data)}return{valid:!0,data:a}}else return e===pe.date&&i===pe.date&&+s==+t?{valid:!0,data:s}:{valid:!1}}class Xi extends He{_parse(t){const{status:e,ctx:i}=this._processInputParams(t),a=(l,u)=>{if(Ea(l)||Ea(u))return Le;const d=_a(l.value,u.value);return d.valid?((va(l)||va(u))&&e.dirty(),{status:e.value,value:d.data}):(he(i,{code:ie.invalid_intersection_types}),Le)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([l,u])=>a(l,u)):a(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}Xi.create=(s,t,e)=>new Xi({left:s,right:t,typeName:Ce.ZodIntersection,...Fe(e)});class ls extends He{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==pe.array)return he(i,{code:ie.invalid_type,expected:pe.array,received:i.parsedType}),Le;if(i.data.length<this._def.items.length)return he(i,{code:ie.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Le;!this._def.rest&&i.data.length>this._def.items.length&&(he(i,{code:ie.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());const l=[...i.data].map((u,d)=>{const m=this._def.items[d]||this._def.rest;return m?m._parse(new os(i,u,i.path,d)):null}).filter(u=>!!u);return i.common.async?Promise.all(l).then(u=>Yt.mergeArray(e,u)):Yt.mergeArray(e,l)}get items(){return this._def.items}rest(t){return new ls({...this._def,rest:t})}}ls.create=(s,t)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ls({items:s,typeName:Ce.ZodTuple,rest:null,...Fe(t)})};class Ji extends He{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==pe.object)return he(i,{code:ie.invalid_type,expected:pe.object,received:i.parsedType}),Le;const a=[],l=this._def.keyType,u=this._def.valueType;for(const d in i.data)a.push({key:l._parse(new os(i,d,i.path,d)),value:u._parse(new os(i,i.data[d],i.path,d)),alwaysSet:d in i.data});return i.common.async?Yt.mergeObjectAsync(e,a):Yt.mergeObjectSync(e,a)}get element(){return this._def.valueType}static create(t,e,i){return e instanceof He?new Ji({keyType:t,valueType:e,typeName:Ce.ZodRecord,...Fe(i)}):new Ji({keyType:Vn.create(),valueType:t,typeName:Ce.ZodRecord,...Fe(e)})}}class Cr extends He{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==pe.map)return he(i,{code:ie.invalid_type,expected:pe.map,received:i.parsedType}),Le;const a=this._def.keyType,l=this._def.valueType,u=[...i.data.entries()].map(([d,m],g)=>({key:a._parse(new os(i,d,i.path,[g,"key"])),value:l._parse(new os(i,m,i.path,[g,"value"]))}));if(i.common.async){const d=new Map;return Promise.resolve().then(async()=>{for(const m of u){const g=await m.key,y=await m.value;if(g.status==="aborted"||y.status==="aborted")return Le;(g.status==="dirty"||y.status==="dirty")&&e.dirty(),d.set(g.value,y.value)}return{status:e.value,value:d}})}else{const d=new Map;for(const m of u){const g=m.key,y=m.value;if(g.status==="aborted"||y.status==="aborted")return Le;(g.status==="dirty"||y.status==="dirty")&&e.dirty(),d.set(g.value,y.value)}return{status:e.value,value:d}}}}Cr.create=(s,t,e)=>new Cr({valueType:t,keyType:s,typeName:Ce.ZodMap,...Fe(e)});class gi extends He{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==pe.set)return he(i,{code:ie.invalid_type,expected:pe.set,received:i.parsedType}),Le;const a=this._def;a.minSize!==null&&i.data.size<a.minSize.value&&(he(i,{code:ie.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),e.dirty()),a.maxSize!==null&&i.data.size>a.maxSize.value&&(he(i,{code:ie.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),e.dirty());const l=this._def.valueType;function u(m){const g=new Set;for(const y of m){if(y.status==="aborted")return Le;y.status==="dirty"&&e.dirty(),g.add(y.value)}return{status:e.value,value:g}}const d=[...i.data.values()].map((m,g)=>l._parse(new os(i,m,i.path,g)));return i.common.async?Promise.all(d).then(m=>u(m)):u(d)}min(t,e){return new gi({...this._def,minSize:{value:t,message:_e.toString(e)}})}max(t,e){return new gi({...this._def,maxSize:{value:t,message:_e.toString(e)}})}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}}gi.create=(s,t)=>new gi({valueType:s,minSize:null,maxSize:null,typeName:Ce.ZodSet,...Fe(t)});class _i extends He{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==pe.function)return he(e,{code:ie.invalid_type,expected:pe.function,received:e.parsedType}),Le;function i(d,m){return Dr({data:d,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,xr(),wi].filter(g=>!!g),issueData:{code:ie.invalid_arguments,argumentsError:m}})}function a(d,m){return Dr({data:d,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,xr(),wi].filter(g=>!!g),issueData:{code:ie.invalid_return_type,returnTypeError:m}})}const l={errorMap:e.common.contextualErrorMap},u=e.data;if(this._def.returns instanceof Ii){const d=this;return un(async function(...m){const g=new An([]),y=await d._def.args.parseAsync(m,l).catch(j=>{throw g.addIssue(i(m,j)),g}),h=await Reflect.apply(u,this,y);return await d._def.returns._def.type.parseAsync(h,l).catch(j=>{throw g.addIssue(a(h,j)),g})})}else{const d=this;return un(function(...m){const g=d._def.args.safeParse(m,l);if(!g.success)throw new An([i(m,g.error)]);const y=Reflect.apply(u,this,g.data),h=d._def.returns.safeParse(y,l);if(!h.success)throw new An([a(y,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new _i({...this._def,args:ls.create(t).rest(di.create())})}returns(t){return new _i({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,i){return new _i({args:t||ls.create([]).rest(di.create()),returns:e||di.create(),typeName:Ce.ZodFunction,...Fe(i)})}}class Qi extends He{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}Qi.create=(s,t)=>new Qi({getter:s,typeName:Ce.ZodLazy,...Fe(t)});class er extends He{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return he(e,{received:e.data,code:ie.invalid_literal,expected:this._def.value}),Le}return{status:"valid",value:t.data}}get value(){return this._def.value}}er.create=(s,t)=>new er({value:s,typeName:Ce.ZodLiteral,...Fe(t)});function el(s,t){return new Us({values:s,typeName:Ce.ZodEnum,...Fe(t)})}class Us extends He{constructor(){super(...arguments),ji.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const e=this._getOrReturnCtx(t),i=this._def.values;return he(e,{expected:et.joinValues(i),received:e.parsedType,code:ie.invalid_type}),Le}if(Rr(this,ji)||Yo(this,ji,new Set(this._def.values)),!Rr(this,ji).has(t.data)){const e=this._getOrReturnCtx(t),i=this._def.values;return he(e,{received:e.data,code:ie.invalid_enum_value,options:i}),Le}return un(t.data)}get options(){return this._def.values}get enum(){const t={};for(const e of this._def.values)t[e]=e;return t}get Values(){const t={};for(const e of this._def.values)t[e]=e;return t}get Enum(){const t={};for(const e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return Us.create(t,{...this._def,...e})}exclude(t,e=this._def){return Us.create(this.options.filter(i=>!t.includes(i)),{...this._def,...e})}}ji=new WeakMap;Us.create=el;class tr extends He{constructor(){super(...arguments),Hi.set(this,void 0)}_parse(t){const e=et.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==pe.string&&i.parsedType!==pe.number){const a=et.objectValues(e);return he(i,{expected:et.joinValues(a),received:i.parsedType,code:ie.invalid_type}),Le}if(Rr(this,Hi)||Yo(this,Hi,new Set(et.getValidEnumValues(this._def.values))),!Rr(this,Hi).has(t.data)){const a=et.objectValues(e);return he(i,{received:i.data,code:ie.invalid_enum_value,options:a}),Le}return un(t.data)}get enum(){return this._def.values}}Hi=new WeakMap;tr.create=(s,t)=>new tr({values:s,typeName:Ce.ZodNativeEnum,...Fe(t)});class Ii extends He{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==pe.promise&&e.common.async===!1)return he(e,{code:ie.invalid_type,expected:pe.promise,received:e.parsedType}),Le;const i=e.parsedType===pe.promise?e.data:Promise.resolve(e.data);return un(i.then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}}Ii.create=(s,t)=>new Ii({type:s,typeName:Ce.ZodPromise,...Fe(t)});class Gn extends He{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ce.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:i}=this._processInputParams(t),a=this._def.effect||null,l={addIssue:u=>{he(i,u),u.fatal?e.abort():e.dirty()},get path(){return i.path}};if(l.addIssue=l.addIssue.bind(l),a.type==="preprocess"){const u=a.transform(i.data,l);if(i.common.async)return Promise.resolve(u).then(async d=>{if(e.value==="aborted")return Le;const m=await this._def.schema._parseAsync({data:d,path:i.path,parent:i});return m.status==="aborted"?Le:m.status==="dirty"||e.value==="dirty"?vi(m.value):m});{if(e.value==="aborted")return Le;const d=this._def.schema._parseSync({data:u,path:i.path,parent:i});return d.status==="aborted"?Le:d.status==="dirty"||e.value==="dirty"?vi(d.value):d}}if(a.type==="refinement"){const u=d=>{const m=a.refinement(d,l);if(i.common.async)return Promise.resolve(m);if(m instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return d};if(i.common.async===!1){const d=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return d.status==="aborted"?Le:(d.status==="dirty"&&e.dirty(),u(d.value),{status:e.value,value:d.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(d=>d.status==="aborted"?Le:(d.status==="dirty"&&e.dirty(),u(d.value).then(()=>({status:e.value,value:d.value}))))}if(a.type==="transform")if(i.common.async===!1){const u=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Zi(u))return u;const d=a.transform(u.value,l);if(d instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:d}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(u=>Zi(u)?Promise.resolve(a.transform(u.value,l)).then(d=>({status:e.value,value:d})):u);et.assertNever(a)}}Gn.create=(s,t,e)=>new Gn({schema:s,typeName:Ce.ZodEffects,effect:t,...Fe(e)});Gn.createWithPreprocess=(s,t,e)=>new Gn({schema:t,effect:{type:"preprocess",transform:s},typeName:Ce.ZodEffects,...Fe(e)});class as extends He{_parse(t){return this._getType(t)===pe.undefined?un(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}as.create=(s,t)=>new as({innerType:s,typeName:Ce.ZodOptional,...Fe(t)});class Fs extends He{_parse(t){return this._getType(t)===pe.null?un(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Fs.create=(s,t)=>new Fs({innerType:s,typeName:Ce.ZodNullable,...Fe(t)});class nr extends He{_parse(t){const{ctx:e}=this._processInputParams(t);let i=e.data;return e.parsedType===pe.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}nr.create=(s,t)=>new nr({innerType:s,typeName:Ce.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Fe(t)});class sr extends He{_parse(t){const{ctx:e}=this._processInputParams(t),i={...e,common:{...e.common,issues:[]}},a=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return zi(a)?a.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new An(i.common.issues)},input:i.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new An(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}sr.create=(s,t)=>new sr({innerType:s,typeName:Ce.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Fe(t)});class Lr extends He{_parse(t){if(this._getType(t)!==pe.nan){const i=this._getOrReturnCtx(t);return he(i,{code:ie.invalid_type,expected:pe.nan,received:i.parsedType}),Le}return{status:"valid",value:t.data}}}Lr.create=s=>new Lr({typeName:Ce.ZodNaN,...Fe(s)});const ff=Symbol("zod_brand");class $a extends He{_parse(t){const{ctx:e}=this._processInputParams(t),i=e.data;return this._def.type._parse({data:i,path:e.path,parent:e})}unwrap(){return this._def.type}}class or extends He{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return l.status==="aborted"?Le:l.status==="dirty"?(e.dirty(),vi(l.value)):this._def.out._parseAsync({data:l.value,path:i.path,parent:i})})();{const a=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return a.status==="aborted"?Le:a.status==="dirty"?(e.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:i.path,parent:i})}}static create(t,e){return new or({in:t,out:e,typeName:Ce.ZodPipeline})}}class ir extends He{_parse(t){const e=this._def.innerType._parse(t),i=a=>(Zi(a)&&(a.value=Object.freeze(a.value)),a);return zi(e)?e.then(a=>i(a)):i(e)}unwrap(){return this._def.innerType}}ir.create=(s,t)=>new ir({innerType:s,typeName:Ce.ZodReadonly,...Fe(t)});function Ma(s,t={},e){return s?Ti.create().superRefine((i,a)=>{var l,u;if(!s(i)){const d=typeof t=="function"?t(i):typeof t=="string"?{message:t}:t,m=(u=(l=d.fatal)!==null&&l!==void 0?l:e)!==null&&u!==void 0?u:!0,g=typeof d=="string"?{message:d}:d;a.addIssue({code:"custom",...g,fatal:m})}}):Ti.create()}const uf={object:_t.lazycreate};var Ce;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(Ce||(Ce={}));const df=(s,t={message:`Input not instance of ${s.name}`})=>Ma(e=>e instanceof s,t),P=Vn.create,we=$s.create,hf=Lr.create,tl=Ms.create,ke=Wi.create,pf=pi.create,gf=Nr.create,mf=Ki.create,Ua=qi.create,yf=Ti.create,rr=di.create,bf=Ss.create,Ef=Pr.create,Qe=jn.create,oe=_t.create,vf=_t.strictCreate,Fa=Yi.create,_f=Vr.create,wf=Xi.create,Tf=ls.create,If=Ji.create,Sf=Cr.create,Af=gi.create,Of=_i.create,xf=Qi.create,$t=er.create,Df=Us.create,Oi=tr.create,Rf=Ii.create,go=Gn.create,nl=as.create,Nf=Fs.create,sl=Gn.createWithPreprocess,Pf=or.create,Cf=()=>P().optional(),Lf=()=>we().optional(),kf=()=>ke().optional(),Bf={string:s=>Vn.create({...s,coerce:!0}),number:s=>$s.create({...s,coerce:!0}),boolean:s=>Wi.create({...s,coerce:!0}),bigint:s=>Ms.create({...s,coerce:!0}),date:s=>pi.create({...s,coerce:!0})},$f=Le;var be=Object.freeze({__proto__:null,defaultErrorMap:wi,setErrorMap:zc,getErrorMap:xr,makeIssue:Dr,EMPTY_PATH:Wc,addIssueToContext:he,ParseStatus:Yt,INVALID:Le,DIRTY:vi,OK:un,isAborted:Ea,isDirty:va,isValid:Zi,isAsync:zi,get util(){return et},get objectUtil(){return ba},ZodParsedType:pe,getParsedType:Ps,ZodType:He,datetimeRegex:Qo,ZodString:Vn,ZodNumber:$s,ZodBigInt:Ms,ZodBoolean:Wi,ZodDate:pi,ZodSymbol:Nr,ZodUndefined:Ki,ZodNull:qi,ZodAny:Ti,ZodUnknown:di,ZodNever:Ss,ZodVoid:Pr,ZodArray:jn,ZodObject:_t,ZodUnion:Yi,ZodDiscriminatedUnion:Vr,ZodIntersection:Xi,ZodTuple:ls,ZodRecord:Ji,ZodMap:Cr,ZodSet:gi,ZodFunction:_i,ZodLazy:Qi,ZodLiteral:er,ZodEnum:Us,ZodNativeEnum:tr,ZodPromise:Ii,ZodEffects:Gn,ZodTransformer:Gn,ZodOptional:as,ZodNullable:Fs,ZodDefault:nr,ZodCatch:sr,ZodNaN:Lr,BRAND:ff,ZodBranded:$a,ZodPipeline:or,ZodReadonly:ir,custom:Ma,Schema:He,ZodSchema:He,late:uf,get ZodFirstPartyTypeKind(){return Ce},coerce:Bf,any:yf,array:Qe,bigint:tl,boolean:ke,date:pf,discriminatedUnion:_f,effect:go,enum:Df,function:Of,instanceof:df,intersection:wf,lazy:xf,literal:$t,map:Sf,nan:hf,nativeEnum:Oi,never:bf,null:Ua,nullable:Nf,number:we,object:oe,oboolean:kf,onumber:Lf,optional:nl,ostring:Cf,pipeline:Pf,preprocess:sl,promise:Rf,record:If,set:Af,strictObject:vf,string:P,symbol:gf,transformer:go,tuple:Tf,undefined:mf,union:Fa,unknown:rr,void:Ef,NEVER:$f,ZodIssueCode:ie,quotelessJson:Zc,ZodError:An}),il={exports:{}};(function(s){var t=function(e){var i=1e7,a=7,l=9007199254740992,u=J(l),d="0123456789abcdefghijklmnopqrstuvwxyz",m=typeof BigInt=="function";function g(E,T,x,C){return typeof E>"u"?g[0]:typeof T<"u"?+T==10&&!x?Se(E):Wt(E,T,x,C):Se(E)}function y(E,T){this.value=E,this.sign=T,this.isSmall=!1}y.prototype=Object.create(g.prototype);function h(E){this.value=E,this.sign=E<0,this.isSmall=!0}h.prototype=Object.create(g.prototype);function I(E){this.value=E}I.prototype=Object.create(g.prototype);function j(E){return-l<E&&E<l}function J(E){return E<1e7?[E]:E<1e14?[E%1e7,Math.floor(E/1e7)]:[E%1e7,Math.floor(E/1e7)%1e7,Math.floor(E/1e14)]}function H(E){z(E);var T=E.length;if(T<4&&Ie(E,u)<0)switch(T){case 0:return 0;case 1:return E[0];case 2:return E[0]+E[1]*i;default:return E[0]+(E[1]+E[2]*i)*i}return E}function z(E){for(var T=E.length;E[--T]===0;);E.length=T+1}function ue(E){for(var T=new Array(E),x=-1;++x<E;)T[x]=0;return T}function de(E){return E>0?Math.floor(E):Math.ceil(E)}function re(E,T){var x=E.length,C=T.length,Z=new Array(x),M=0,G=i,Y,Q;for(Q=0;Q<C;Q++)Y=E[Q]+T[Q]+M,M=Y>=G?1:0,Z[Q]=Y-M*G;for(;Q<x;)Y=E[Q]+M,M=Y===G?1:0,Z[Q++]=Y-M*G;return M>0&&Z.push(M),Z}function Te(E,T){return E.length>=T.length?re(E,T):re(T,E)}function $e(E,T){var x=E.length,C=new Array(x),Z=i,M,G;for(G=0;G<x;G++)M=E[G]-Z+T,T=Math.floor(M/Z),C[G]=M-T*Z,T+=1;for(;T>0;)C[G++]=T%Z,T=Math.floor(T/Z);return C}y.prototype.add=function(E){var T=Se(E);if(this.sign!==T.sign)return this.subtract(T.negate());var x=this.value,C=T.value;return T.isSmall?new y($e(x,Math.abs(C)),this.sign):new y(Te(x,C),this.sign)},y.prototype.plus=y.prototype.add,h.prototype.add=function(E){var T=Se(E),x=this.value;if(x<0!==T.sign)return this.subtract(T.negate());var C=T.value;if(T.isSmall){if(j(x+C))return new h(x+C);C=J(Math.abs(C))}return new y($e(C,Math.abs(x)),x<0)},h.prototype.plus=h.prototype.add,I.prototype.add=function(E){return new I(this.value+Se(E).value)},I.prototype.plus=I.prototype.add;function tt(E,T){var x=E.length,C=T.length,Z=new Array(x),M=0,G=i,Y,Q;for(Y=0;Y<C;Y++)Q=E[Y]-M-T[Y],Q<0?(Q+=G,M=1):M=0,Z[Y]=Q;for(Y=C;Y<x;Y++){if(Q=E[Y]-M,Q<0)Q+=G;else{Z[Y++]=Q;break}Z[Y]=Q}for(;Y<x;Y++)Z[Y]=E[Y];return z(Z),Z}function at(E,T,x){var C;return Ie(E,T)>=0?C=tt(E,T):(C=tt(T,E),x=!x),C=H(C),typeof C=="number"?(x&&(C=-C),new h(C)):new y(C,x)}function mt(E,T,x){var C=E.length,Z=new Array(C),M=-T,G=i,Y,Q;for(Y=0;Y<C;Y++)Q=E[Y]+M,M=Math.floor(Q/G),Q%=G,Z[Y]=Q<0?Q+G:Q;return Z=H(Z),typeof Z=="number"?(x&&(Z=-Z),new h(Z)):new y(Z,x)}y.prototype.subtract=function(E){var T=Se(E);if(this.sign!==T.sign)return this.add(T.negate());var x=this.value,C=T.value;return T.isSmall?mt(x,Math.abs(C),this.sign):at(x,C,this.sign)},y.prototype.minus=y.prototype.subtract,h.prototype.subtract=function(E){var T=Se(E),x=this.value;if(x<0!==T.sign)return this.add(T.negate());var C=T.value;return T.isSmall?new h(x-C):mt(C,Math.abs(x),x>=0)},h.prototype.minus=h.prototype.subtract,I.prototype.subtract=function(E){return new I(this.value-Se(E).value)},I.prototype.minus=I.prototype.subtract,y.prototype.negate=function(){return new y(this.value,!this.sign)},h.prototype.negate=function(){var E=this.sign,T=new h(-this.value);return T.sign=!E,T},I.prototype.negate=function(){return new I(-this.value)},y.prototype.abs=function(){return new y(this.value,!1)},h.prototype.abs=function(){return new h(Math.abs(this.value))},I.prototype.abs=function(){return new I(this.value>=0?this.value:-this.value)};function ot(E,T){var x=E.length,C=T.length,Z=x+C,M=ue(Z),G=i,Y,Q,fe,Ne,Pe;for(fe=0;fe<x;++fe){Ne=E[fe];for(var Ae=0;Ae<C;++Ae)Pe=T[Ae],Y=Ne*Pe+M[fe+Ae],Q=Math.floor(Y/G),M[fe+Ae]=Y-Q*G,M[fe+Ae+1]+=Q}return z(M),M}function Rt(E,T){var x=E.length,C=new Array(x),Z=i,M=0,G,Y;for(Y=0;Y<x;Y++)G=E[Y]*T+M,M=Math.floor(G/Z),C[Y]=G-M*Z;for(;M>0;)C[Y++]=M%Z,M=Math.floor(M/Z);return C}function Je(E,T){for(var x=[];T-- >0;)x.push(0);return x.concat(E)}function Ve(E,T){var x=Math.max(E.length,T.length);if(x<=30)return ot(E,T);x=Math.ceil(x/2);var C=E.slice(x),Z=E.slice(0,x),M=T.slice(x),G=T.slice(0,x),Y=Ve(Z,G),Q=Ve(C,M),fe=Ve(Te(Z,C),Te(G,M)),Ne=Te(Te(Y,Je(tt(tt(fe,Y),Q),x)),Je(Q,2*x));return z(Ne),Ne}function V(E,T){return-.012*E-.012*T+15e-6*E*T>0}y.prototype.multiply=function(E){var T=Se(E),x=this.value,C=T.value,Z=this.sign!==T.sign,M;if(T.isSmall){if(C===0)return g[0];if(C===1)return this;if(C===-1)return this.negate();if(M=Math.abs(C),M<i)return new y(Rt(x,M),Z);C=J(M)}return V(x.length,C.length)?new y(Ve(x,C),Z):new y(ot(x,C),Z)},y.prototype.times=y.prototype.multiply;function se(E,T,x){return E<i?new y(Rt(T,E),x):new y(ot(T,J(E)),x)}h.prototype._multiplyBySmall=function(E){return j(E.value*this.value)?new h(E.value*this.value):se(Math.abs(E.value),J(Math.abs(this.value)),this.sign!==E.sign)},y.prototype._multiplyBySmall=function(E){return E.value===0?g[0]:E.value===1?this:E.value===-1?this.negate():se(Math.abs(E.value),this.value,this.sign!==E.sign)},h.prototype.multiply=function(E){return Se(E)._multiplyBySmall(this)},h.prototype.times=h.prototype.multiply,I.prototype.multiply=function(E){return new I(this.value*Se(E).value)},I.prototype.times=I.prototype.multiply;function te(E){var T=E.length,x=ue(T+T),C=i,Z,M,G,Y,Q;for(G=0;G<T;G++){Y=E[G],M=0-Y*Y;for(var fe=G;fe<T;fe++)Q=E[fe],Z=2*(Y*Q)+x[G+fe]+M,M=Math.floor(Z/C),x[G+fe]=Z-M*C;x[G+T]=M}return z(x),x}y.prototype.square=function(){return new y(te(this.value),!1)},h.prototype.square=function(){var E=this.value*this.value;return j(E)?new h(E):new y(te(J(Math.abs(this.value))),!1)},I.prototype.square=function(E){return new I(this.value*this.value)};function ee(E,T){var x=E.length,C=T.length,Z=i,M=ue(T.length),G=T[C-1],Y=Math.ceil(Z/(2*G)),Q=Rt(E,Y),fe=Rt(T,Y),Ne,Pe,Ae,At,xe,tn,nt;for(Q.length<=x&&Q.push(0),fe.push(0),G=fe[C-1],Pe=x-C;Pe>=0;Pe--){for(Ne=Z-1,Q[Pe+C]!==G&&(Ne=Math.floor((Q[Pe+C]*Z+Q[Pe+C-1])/G)),Ae=0,At=0,tn=fe.length,xe=0;xe<tn;xe++)Ae+=Ne*fe[xe],nt=Math.floor(Ae/Z),At+=Q[Pe+xe]-(Ae-nt*Z),Ae=nt,At<0?(Q[Pe+xe]=At+Z,At=-1):(Q[Pe+xe]=At,At=0);for(;At!==0;){for(Ne-=1,Ae=0,xe=0;xe<tn;xe++)Ae+=Q[Pe+xe]-Z+fe[xe],Ae<0?(Q[Pe+xe]=Ae+Z,Ae=0):(Q[Pe+xe]=Ae,Ae=1);At+=Ae}M[Pe]=Ne}return Q=ge(Q,Y)[0],[H(M),H(Q)]}function ne(E,T){for(var x=E.length,C=T.length,Z=[],M=[],G=i,Y,Q,fe,Ne,Pe;x;){if(M.unshift(E[--x]),z(M),Ie(M,T)<0){Z.push(0);continue}Q=M.length,fe=M[Q-1]*G+M[Q-2],Ne=T[C-1]*G+T[C-2],Q>C&&(fe=(fe+1)*G),Y=Math.ceil(fe/Ne);do{if(Pe=Rt(T,Y),Ie(Pe,M)<=0)break;Y--}while(Y);Z.push(Y),M=tt(M,Pe)}return Z.reverse(),[H(Z),H(M)]}function ge(E,T){var x=E.length,C=ue(x),Z=i,M,G,Y,Q;for(Y=0,M=x-1;M>=0;--M)Q=Y*Z+E[M],G=de(Q/T),Y=Q-G*T,C[M]=G|0;return[C,Y|0]}function Re(E,T){var x,C=Se(T);if(m)return[new I(E.value/C.value),new I(E.value%C.value)];var Z=E.value,M=C.value,G;if(M===0)throw new Error("Cannot divide by zero");if(E.isSmall)return C.isSmall?[new h(de(Z/M)),new h(Z%M)]:[g[0],E];if(C.isSmall){if(M===1)return[E,g[0]];if(M==-1)return[E.negate(),g[0]];var Y=Math.abs(M);if(Y<i){x=ge(Z,Y),G=H(x[0]);var Q=x[1];return E.sign&&(Q=-Q),typeof G=="number"?(E.sign!==C.sign&&(G=-G),[new h(G),new h(Q)]):[new y(G,E.sign!==C.sign),new h(Q)]}M=J(Y)}var fe=Ie(Z,M);if(fe===-1)return[g[0],E];if(fe===0)return[g[E.sign===C.sign?1:-1],g[0]];Z.length+M.length<=200?x=ee(Z,M):x=ne(Z,M),G=x[0];var Ne=E.sign!==C.sign,Pe=x[1],Ae=E.sign;return typeof G=="number"?(Ne&&(G=-G),G=new h(G)):G=new y(G,Ne),typeof Pe=="number"?(Ae&&(Pe=-Pe),Pe=new h(Pe)):Pe=new y(Pe,Ae),[G,Pe]}y.prototype.divmod=function(E){var T=Re(this,E);return{quotient:T[0],remainder:T[1]}},I.prototype.divmod=h.prototype.divmod=y.prototype.divmod,y.prototype.divide=function(E){return Re(this,E)[0]},I.prototype.over=I.prototype.divide=function(E){return new I(this.value/Se(E).value)},h.prototype.over=h.prototype.divide=y.prototype.over=y.prototype.divide,y.prototype.mod=function(E){return Re(this,E)[1]},I.prototype.mod=I.prototype.remainder=function(E){return new I(this.value%Se(E).value)},h.prototype.remainder=h.prototype.mod=y.prototype.remainder=y.prototype.mod,y.prototype.pow=function(E){var T=Se(E),x=this.value,C=T.value,Z,M,G;if(C===0)return g[1];if(x===0)return g[0];if(x===1)return g[1];if(x===-1)return T.isEven()?g[1]:g[-1];if(T.sign)return g[0];if(!T.isSmall)throw new Error("The exponent "+T.toString()+" is too large.");if(this.isSmall&&j(Z=Math.pow(x,C)))return new h(de(Z));for(M=this,G=g[1];C&!0&&(G=G.times(M),--C),C!==0;)C/=2,M=M.square();return G},h.prototype.pow=y.prototype.pow,I.prototype.pow=function(E){var T=Se(E),x=this.value,C=T.value,Z=BigInt(0),M=BigInt(1),G=BigInt(2);if(C===Z)return g[1];if(x===Z)return g[0];if(x===M)return g[1];if(x===BigInt(-1))return T.isEven()?g[1]:g[-1];if(T.isNegative())return new I(Z);for(var Y=this,Q=g[1];(C&M)===M&&(Q=Q.times(Y),--C),C!==Z;)C/=G,Y=Y.square();return Q},y.prototype.modPow=function(E,T){if(E=Se(E),T=Se(T),T.isZero())throw new Error("Cannot take modPow with modulus 0");var x=g[1],C=this.mod(T);for(E.isNegative()&&(E=E.multiply(g[-1]),C=C.modInv(T));E.isPositive();){if(C.isZero())return g[0];E.isOdd()&&(x=x.multiply(C).mod(T)),E=E.divide(2),C=C.square().mod(T)}return x},I.prototype.modPow=h.prototype.modPow=y.prototype.modPow;function Ie(E,T){if(E.length!==T.length)return E.length>T.length?1:-1;for(var x=E.length-1;x>=0;x--)if(E[x]!==T[x])return E[x]>T[x]?1:-1;return 0}y.prototype.compareAbs=function(E){var T=Se(E),x=this.value,C=T.value;return T.isSmall?1:Ie(x,C)},h.prototype.compareAbs=function(E){var T=Se(E),x=Math.abs(this.value),C=T.value;return T.isSmall?(C=Math.abs(C),x===C?0:x>C?1:-1):-1},I.prototype.compareAbs=function(E){var T=this.value,x=Se(E).value;return T=T>=0?T:-T,x=x>=0?x:-x,T===x?0:T>x?1:-1},y.prototype.compare=function(E){if(E===1/0)return-1;if(E===-1/0)return 1;var T=Se(E),x=this.value,C=T.value;return this.sign!==T.sign?T.sign?1:-1:T.isSmall?this.sign?-1:1:Ie(x,C)*(this.sign?-1:1)},y.prototype.compareTo=y.prototype.compare,h.prototype.compare=function(E){if(E===1/0)return-1;if(E===-1/0)return 1;var T=Se(E),x=this.value,C=T.value;return T.isSmall?x==C?0:x>C?1:-1:x<0!==T.sign?x<0?-1:1:x<0?1:-1},h.prototype.compareTo=h.prototype.compare,I.prototype.compare=function(E){if(E===1/0)return-1;if(E===-1/0)return 1;var T=this.value,x=Se(E).value;return T===x?0:T>x?1:-1},I.prototype.compareTo=I.prototype.compare,y.prototype.equals=function(E){return this.compare(E)===0},I.prototype.eq=I.prototype.equals=h.prototype.eq=h.prototype.equals=y.prototype.eq=y.prototype.equals,y.prototype.notEquals=function(E){return this.compare(E)!==0},I.prototype.neq=I.prototype.notEquals=h.prototype.neq=h.prototype.notEquals=y.prototype.neq=y.prototype.notEquals,y.prototype.greater=function(E){return this.compare(E)>0},I.prototype.gt=I.prototype.greater=h.prototype.gt=h.prototype.greater=y.prototype.gt=y.prototype.greater,y.prototype.lesser=function(E){return this.compare(E)<0},I.prototype.lt=I.prototype.lesser=h.prototype.lt=h.prototype.lesser=y.prototype.lt=y.prototype.lesser,y.prototype.greaterOrEquals=function(E){return this.compare(E)>=0},I.prototype.geq=I.prototype.greaterOrEquals=h.prototype.geq=h.prototype.greaterOrEquals=y.prototype.geq=y.prototype.greaterOrEquals,y.prototype.lesserOrEquals=function(E){return this.compare(E)<=0},I.prototype.leq=I.prototype.lesserOrEquals=h.prototype.leq=h.prototype.lesserOrEquals=y.prototype.leq=y.prototype.lesserOrEquals,y.prototype.isEven=function(){return(this.value[0]&1)===0},h.prototype.isEven=function(){return(this.value&1)===0},I.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},y.prototype.isOdd=function(){return(this.value[0]&1)===1},h.prototype.isOdd=function(){return(this.value&1)===1},I.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},y.prototype.isPositive=function(){return!this.sign},h.prototype.isPositive=function(){return this.value>0},I.prototype.isPositive=h.prototype.isPositive,y.prototype.isNegative=function(){return this.sign},h.prototype.isNegative=function(){return this.value<0},I.prototype.isNegative=h.prototype.isNegative,y.prototype.isUnit=function(){return!1},h.prototype.isUnit=function(){return Math.abs(this.value)===1},I.prototype.isUnit=function(){return this.abs().value===BigInt(1)},y.prototype.isZero=function(){return!1},h.prototype.isZero=function(){return this.value===0},I.prototype.isZero=function(){return this.value===BigInt(0)},y.prototype.isDivisibleBy=function(E){var T=Se(E);return T.isZero()?!1:T.isUnit()?!0:T.compareAbs(2)===0?this.isEven():this.mod(T).isZero()},I.prototype.isDivisibleBy=h.prototype.isDivisibleBy=y.prototype.isDivisibleBy;function We(E){var T=E.abs();if(T.isUnit())return!1;if(T.equals(2)||T.equals(3)||T.equals(5))return!0;if(T.isEven()||T.isDivisibleBy(3)||T.isDivisibleBy(5))return!1;if(T.lesser(49))return!0}function Ge(E,T){for(var x=E.prev(),C=x,Z=0,M,G,Y;C.isEven();)C=C.divide(2),Z++;e:for(G=0;G<T.length;G++)if(!E.lesser(T[G])&&(Y=t(T[G]).modPow(C,E),!(Y.isUnit()||Y.equals(x)))){for(M=Z-1;M!=0;M--){if(Y=Y.square().mod(E),Y.isUnit())return!1;if(Y.equals(x))continue e}return!1}return!0}y.prototype.isPrime=function(E){var T=We(this);if(T!==e)return T;var x=this.abs(),C=x.bitLength();if(C<=64)return Ge(x,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var Z=Math.log(2)*C.toJSNumber(),M=Math.ceil(E===!0?2*Math.pow(Z,2):Z),G=[],Y=0;Y<M;Y++)G.push(t(Y+2));return Ge(x,G)},I.prototype.isPrime=h.prototype.isPrime=y.prototype.isPrime,y.prototype.isProbablePrime=function(E,T){var x=We(this);if(x!==e)return x;for(var C=this.abs(),Z=E===e?5:E,M=[],G=0;G<Z;G++)M.push(t.randBetween(2,C.minus(2),T));return Ge(C,M)},I.prototype.isProbablePrime=h.prototype.isProbablePrime=y.prototype.isProbablePrime,y.prototype.modInv=function(E){for(var T=t.zero,x=t.one,C=Se(E),Z=this.abs(),M,G,Y;!Z.isZero();)M=C.divide(Z),G=T,Y=C,T=x,C=Z,x=G.subtract(M.multiply(x)),Z=Y.subtract(M.multiply(Z));if(!C.isUnit())throw new Error(this.toString()+" and "+E.toString()+" are not co-prime");return T.compare(0)===-1&&(T=T.add(E)),this.isNegative()?T.negate():T},I.prototype.modInv=h.prototype.modInv=y.prototype.modInv,y.prototype.next=function(){var E=this.value;return this.sign?mt(E,1,this.sign):new y($e(E,1),this.sign)},h.prototype.next=function(){var E=this.value;return E+1<l?new h(E+1):new y(u,!1)},I.prototype.next=function(){return new I(this.value+BigInt(1))},y.prototype.prev=function(){var E=this.value;return this.sign?new y($e(E,1),!0):mt(E,1,this.sign)},h.prototype.prev=function(){var E=this.value;return E-1>-l?new h(E-1):new y(u,!0)},I.prototype.prev=function(){return new I(this.value-BigInt(1))};for(var lt=[1];2*lt[lt.length-1]<=i;)lt.push(2*lt[lt.length-1]);var Tt=lt.length,Ct=lt[Tt-1];function As(E){return Math.abs(E)<=i}y.prototype.shiftLeft=function(E){var T=Se(E).toJSNumber();if(!As(T))throw new Error(String(T)+" is too large for shifting.");if(T<0)return this.shiftRight(-T);var x=this;if(x.isZero())return x;for(;T>=Tt;)x=x.multiply(Ct),T-=Tt-1;return x.multiply(lt[T])},I.prototype.shiftLeft=h.prototype.shiftLeft=y.prototype.shiftLeft,y.prototype.shiftRight=function(E){var T,x=Se(E).toJSNumber();if(!As(x))throw new Error(String(x)+" is too large for shifting.");if(x<0)return this.shiftLeft(-x);for(var C=this;x>=Tt;){if(C.isZero()||C.isNegative()&&C.isUnit())return C;T=Re(C,Ct),C=T[1].isNegative()?T[0].prev():T[0],x-=Tt-1}return T=Re(C,lt[x]),T[1].isNegative()?T[0].prev():T[0]},I.prototype.shiftRight=h.prototype.shiftRight=y.prototype.shiftRight;function mn(E,T,x){T=Se(T);for(var C=E.isNegative(),Z=T.isNegative(),M=C?E.not():E,G=Z?T.not():T,Y=0,Q=0,fe=null,Ne=null,Pe=[];!M.isZero()||!G.isZero();)fe=Re(M,Ct),Y=fe[1].toJSNumber(),C&&(Y=Ct-1-Y),Ne=Re(G,Ct),Q=Ne[1].toJSNumber(),Z&&(Q=Ct-1-Q),M=fe[0],G=Ne[0],Pe.push(x(Y,Q));for(var Ae=x(C?1:0,Z?1:0)!==0?t(-1):t(0),At=Pe.length-1;At>=0;At-=1)Ae=Ae.multiply(Ct).add(t(Pe[At]));return Ae}y.prototype.not=function(){return this.negate().prev()},I.prototype.not=h.prototype.not=y.prototype.not,y.prototype.and=function(E){return mn(this,E,function(T,x){return T&x})},I.prototype.and=h.prototype.and=y.prototype.and,y.prototype.or=function(E){return mn(this,E,function(T,x){return T|x})},I.prototype.or=h.prototype.or=y.prototype.or,y.prototype.xor=function(E){return mn(this,E,function(T,x){return T^x})},I.prototype.xor=h.prototype.xor=y.prototype.xor;var ve=1<<30,zt=(i&-i)*(i&-i)|ve;function It(E){var T=E.value,x=typeof T=="number"?T|ve:typeof T=="bigint"?T|BigInt(ve):T[0]+T[1]*i|zt;return x&-x}function Qt(E,T){if(T.compareTo(E)<=0){var x=Qt(E,T.square(T)),C=x.p,Z=x.e,M=C.multiply(T);return M.compareTo(E)<=0?{p:M,e:Z*2+1}:{p:C,e:Z*2}}return{p:t(1),e:0}}y.prototype.bitLength=function(){var E=this;return E.compareTo(t(0))<0&&(E=E.negate().subtract(t(1))),E.compareTo(t(0))===0?t(0):t(Qt(E,t(2)).e).add(t(1))},I.prototype.bitLength=h.prototype.bitLength=y.prototype.bitLength;function ds(E,T){return E=Se(E),T=Se(T),E.greater(T)?E:T}function Wn(E,T){return E=Se(E),T=Se(T),E.lesser(T)?E:T}function Os(E,T){if(E=Se(E).abs(),T=Se(T).abs(),E.equals(T))return E;if(E.isZero())return T;if(T.isZero())return E;for(var x=g[1],C,Z;E.isEven()&&T.isEven();)C=Wn(It(E),It(T)),E=E.divide(C),T=T.divide(C),x=x.multiply(C);for(;E.isEven();)E=E.divide(It(E));do{for(;T.isEven();)T=T.divide(It(T));E.greater(T)&&(Z=T,T=E,E=Z),T=T.subtract(E)}while(!T.isZero());return x.isUnit()?E:E.multiply(x)}function Kn(E,T){return E=Se(E).abs(),T=Se(T).abs(),E.divide(Os(E,T)).multiply(T)}function qn(E,T,x){E=Se(E),T=Se(T);var C=x||Math.random,Z=Wn(E,T),M=ds(E,T),G=M.subtract(Z).add(1);if(G.isSmall)return Z.add(Math.floor(C()*G));for(var Y=st(G,i).value,Q=[],fe=!0,Ne=0;Ne<Y.length;Ne++){var Pe=fe?Y[Ne]+(Ne+1<Y.length?Y[Ne+1]/i:0):i,Ae=de(C()*Pe);Q.push(Ae),Ae<Y[Ne]&&(fe=!1)}return Z.add(g.fromArray(Q,i,!1))}var Wt=function(E,T,x,C){x=x||d,E=String(E),C||(E=E.toLowerCase(),x=x.toLowerCase());var Z=E.length,M,G=Math.abs(T),Y={};for(M=0;M<x.length;M++)Y[x[M]]=M;for(M=0;M<Z;M++){var Q=E[M];if(Q!=="-"&&Q in Y&&Y[Q]>=G){if(Q==="1"&&G===1)continue;throw new Error(Q+" is not a valid digit in base "+T+".")}}T=Se(T);var fe=[],Ne=E[0]==="-";for(M=Ne?1:0;M<E.length;M++){var Q=E[M];if(Q in Y)fe.push(Se(Y[Q]));else if(Q==="<"){var Pe=M;do M++;while(E[M]!==">"&&M<E.length);fe.push(Se(E.slice(Pe+1,M)))}else throw new Error(Q+" is not a valid character")}return Yn(fe,T,Ne)};function Yn(E,T,x){var C=g[0],Z=g[1],M;for(M=E.length-1;M>=0;M--)C=C.add(E[M].times(Z)),Z=Z.times(T);return x?C.negate():C}function yn(E,T){return T=T||d,E<T.length?T[E]:"<"+E+">"}function st(E,T){if(T=t(T),T.isZero()){if(E.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(T.equals(-1)){if(E.isZero())return{value:[0],isNegative:!1};if(E.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-E.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var x=Array.apply(null,Array(E.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return x.unshift([1]),{value:[].concat.apply([],x),isNegative:!1}}var C=!1;if(E.isNegative()&&T.isPositive()&&(C=!0,E=E.abs()),T.isUnit())return E.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(E.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:C};for(var Z=[],M=E,G;M.isNegative()||M.compareAbs(T)>=0;){G=M.divmod(T),M=G.quotient;var Y=G.remainder;Y.isNegative()&&(Y=T.minus(Y).abs(),M=M.next()),Z.push(Y.toJSNumber())}return Z.push(M.toJSNumber()),{value:Z.reverse(),isNegative:C}}function Mt(E,T,x){var C=st(E,T);return(C.isNegative?"-":"")+C.value.map(function(Z){return yn(Z,x)}).join("")}y.prototype.toArray=function(E){return st(this,E)},h.prototype.toArray=function(E){return st(this,E)},I.prototype.toArray=function(E){return st(this,E)},y.prototype.toString=function(E,T){if(E===e&&(E=10),E!==10||T)return Mt(this,E,T);for(var x=this.value,C=x.length,Z=String(x[--C]),M="0000000",G;--C>=0;)G=String(x[C]),Z+=M.slice(G.length)+G;var Y=this.sign?"-":"";return Y+Z},h.prototype.toString=function(E,T){return E===e&&(E=10),E!=10||T?Mt(this,E,T):String(this.value)},I.prototype.toString=h.prototype.toString,I.prototype.toJSON=y.prototype.toJSON=h.prototype.toJSON=function(){return this.toString()},y.prototype.valueOf=function(){return parseInt(this.toString(),10)},y.prototype.toJSNumber=y.prototype.valueOf,h.prototype.valueOf=function(){return this.value},h.prototype.toJSNumber=h.prototype.valueOf,I.prototype.valueOf=I.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function Xn(E){if(j(+E)){var T=+E;if(T===de(T))return m?new I(BigInt(T)):new h(T);throw new Error("Invalid integer: "+E)}var x=E[0]==="-";x&&(E=E.slice(1));var C=E.split(/e/i);if(C.length>2)throw new Error("Invalid integer: "+C.join("e"));if(C.length===2){var Z=C[1];if(Z[0]==="+"&&(Z=Z.slice(1)),Z=+Z,Z!==de(Z)||!j(Z))throw new Error("Invalid integer: "+Z+" is not a valid exponent.");var M=C[0],G=M.indexOf(".");if(G>=0&&(Z-=M.length-G-1,M=M.slice(0,G)+M.slice(G+1)),Z<0)throw new Error("Cannot include negative exponent part for integers");M+=new Array(Z+1).join("0"),E=M}var Y=/^([0-9][0-9]*)$/.test(E);if(!Y)throw new Error("Invalid integer: "+E);if(m)return new I(BigInt(x?"-"+E:E));for(var Q=[],fe=E.length,Ne=a,Pe=fe-Ne;fe>0;)Q.push(+E.slice(Pe,fe)),Pe-=Ne,Pe<0&&(Pe=0),fe-=Ne;return z(Q),new y(Q,x)}function hs(E){if(m)return new I(BigInt(E));if(j(E)){if(E!==de(E))throw new Error(E+" is not an integer.");return new h(E)}return Xn(E.toString())}function Se(E){return typeof E=="number"?hs(E):typeof E=="string"?Xn(E):typeof E=="bigint"?new I(E):E}for(var en=0;en<1e3;en++)g[en]=Se(en),en>0&&(g[-en]=Se(-en));return g.one=g[1],g.zero=g[0],g.minusOne=g[-1],g.max=ds,g.min=Wn,g.gcd=Os,g.lcm=Kn,g.isInstance=function(E){return E instanceof y||E instanceof h||E instanceof I},g.randBetween=qn,g.fromArray=function(E,T,x){return Yn(E.map(Se),Se(T||10),x)},g}();s.hasOwnProperty("exports")&&(s.exports=t)})(il);var Mf=il.exports,rl=Ba(Mf);const al=64,wa=16,Cs=al/wa;function Uf(){try{return!0}catch{return!1}}function Ff(s,t,e){let i=0;for(let a=0;a<e;a++){const l=s[t+a];if(l===void 0)break;i+=l*16**a}return i}function ol(s){const t=[];for(let e=0;e<s.length;e++){let i=Number(s[e]);for(let a=0;i||a<t.length;a++)i+=(t[a]||0)*10,t[a]=i%16,i=(i-t[a])/16}return t}function Vf(s){const t=ol(s),e=Array(Cs);for(let i=0;i<Cs;i++)e[Cs-1-i]=Ff(t,i*Cs,Cs);return e}class ns{static fromString(t){return new ns(Vf(t),t)}static fromBit(t){const e=Array(Cs),i=Math.floor(t/wa);for(let a=0;a<Cs;a++)e[Cs-1-a]=a===i?1<<t-i*wa:0;return new ns(e)}constructor(t,e){this.parts=t,this.str=e}and({parts:t}){return new ns(this.parts.map((e,i)=>e&t[i]))}or({parts:t}){return new ns(this.parts.map((e,i)=>e|t[i]))}xor({parts:t}){return new ns(this.parts.map((e,i)=>e^t[i]))}not(){return new ns(this.parts.map(t=>~t))}equals({parts:t}){return this.parts.every((e,i)=>e===t[i])}toString(){if(this.str!=null)return this.str;const t=new Array(al/4);return this.parts.forEach((e,i)=>{const a=ol(e.toString());for(let l=0;l<4;l++)t[l+i*4]=a[3-l]||0}),this.str=rl.fromArray(t,16).toString()}toJSON(){return this.toString()}}const Hs=Uf();Hs&&BigInt.prototype.toJSON==null&&(BigInt.prototype.toJSON=function(){return this.toString()});const br={},ll=Hs?function(t){return BigInt(t)}:function(t){return t instanceof ns?t:(typeof t=="number"&&(t=t.toString()),br[t]!=null||(br[t]=ns.fromString(t)),br[t])},Zt=ll(0),jr=Hs?function(t=Zt,e=Zt){return t&e}:function(t=Zt,e=Zt){return t.and(e)},cl=Hs?function(t=Zt,e=Zt){return t|e}:function(t=Zt,e=Zt){return t.or(e)},jf=Hs?function(t=Zt,e=Zt){return t^e}:function(t=Zt,e=Zt){return t.xor(e)},Hf=Hs?function(t=Zt){return~t}:function(t=Zt){return t.not()},Va=Hs?function(t,e){return t===e}:function(t,e){return t==null||e==null?t==e:t.equals(e)};function Gf(...s){let t=s[0];for(let e=1;e<s.length;e++)t=cl(t,s[e]);return t}function Zf(s,t){return Va(jr(s,t),t)}function zf(s,t){return!Va(jr(s,t),Zt)}function Wf(s,t){return t===Zt?s:cl(s,t)}function Kf(s,t){return t===Zt?s:jf(s,jr(s,t))}const qf=Hs?function(t){return BigInt(1)<<BigInt(t)}:function(t){return ns.fromBit(t)};var mo={combine:Gf,add:Wf,remove:Kf,filter:jr,invert:Hf,has:Zf,hasAny:zf,equals:Va,deserialize:ll,getFlag:qf},yo;(function(s){s[s.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",s[s.CLOSE_UNSUPPORTED=1003]="CLOSE_UNSUPPORTED",s[s.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",s[s.INVALID_CLIENTID=4e3]="INVALID_CLIENTID",s[s.INVALID_ORIGIN=4001]="INVALID_ORIGIN",s[s.RATELIMITED=4002]="RATELIMITED",s[s.TOKEN_REVOKED=4003]="TOKEN_REVOKED",s[s.INVALID_VERSION=4004]="INVALID_VERSION",s[s.INVALID_ENCODING=4005]="INVALID_ENCODING"})(yo||(yo={}));var Ta;(function(s){s[s.INVALID_PAYLOAD=4e3]="INVALID_PAYLOAD",s[s.INVALID_COMMAND=4002]="INVALID_COMMAND",s[s.INVALID_EVENT=4004]="INVALID_EVENT",s[s.INVALID_PERMISSIONS=4006]="INVALID_PERMISSIONS"})(Ta||(Ta={}));var Ia;(function(s){s.LANDSCAPE="landscape",s.PORTRAIT="portrait"})(Ia||(Ia={}));var _s;(function(s){s.MOBILE="mobile",s.DESKTOP="desktop"})(_s||(_s={}));Object.freeze({CREATE_INSTANT_INVITE:mo.getFlag(0),ADMINISTRATOR:mo.getFlag(3)});function Xt(s){return sl(t=>{var e;const[i]=(e=Object.entries(s).find(([,a])=>a===t))!==null&&e!==void 0?e:[];return t!=null&&i===void 0?s.UNHANDLED:t},P().or(we()))}function Yf(s){const t=Ma().transform(e=>{const i=s.safeParse(e);return i.success?i.data:s._def.defaultValue()});return t.overlayType=s,t}const Xf=be.object({image_url:be.string()}),Jf=be.object({mediaUrl:be.string().max(1024)}),Qf=be.object({access_token:be.union([be.string(),be.null()]).optional()}),fl=be.object({access_token:be.string(),user:be.object({username:be.string(),discriminator:be.string(),id:be.string(),avatar:be.union([be.string(),be.null()]).optional(),public_flags:be.number(),global_name:be.union([be.string(),be.null()]).optional()}),scopes:be.array(Yf(be.enum(["identify","email","connections","guilds","guilds.join","guilds.members.read","guilds.channels.read","gdm.join","bot","rpc","rpc.notifications.read","rpc.voice.read","rpc.voice.write","rpc.video.read","rpc.video.write","rpc.screenshare.read","rpc.screenshare.write","rpc.activities.write","webhook.incoming","messages.read","applications.builds.upload","applications.builds.read","applications.commands","applications.commands.permissions.update","applications.commands.update","applications.store.update","applications.entitlements","activities.read","activities.write","relationships.read","relationships.write","voice","dm_channels.read","role_connections.write","presences.read","presences.write","openid","dm_channels.messages.read","dm_channels.messages.write","gateway.connect","account.global_name.update","payment_sources.country_code","sdk.social_layer"]).or(be.literal(-1)).default(-1))),expires:be.string(),application:be.object({description:be.string(),icon:be.union([be.string(),be.null()]).optional(),id:be.string(),rpc_origins:be.array(be.string()).optional(),name:be.string()})}),ul=be.object({participants:be.array(be.object({id:be.string(),username:be.string(),global_name:be.union([be.string(),be.null()]).optional(),discriminator:be.string(),avatar:be.union([be.string(),be.null()]).optional(),flags:be.number(),bot:be.boolean(),avatar_decoration_data:be.union([be.object({asset:be.string(),skuId:be.string().optional()}),be.null()]).optional(),premium_type:be.union([be.number(),be.null()]).optional(),nickname:be.string().optional()}))});var is;(function(s){s.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",s.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",s.AUTHENTICATE="AUTHENTICATE",s.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(is||(is={}));const eu=be.object({}).optional().nullable(),bo=be.void(),dl={[is.INITIATE_IMAGE_UPLOAD]:{request:bo,response:Xf},[is.OPEN_SHARE_MOMENT_DIALOG]:{request:Jf,response:eu},[is.AUTHENTICATE]:{request:Qf,response:fl},[is.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS]:{request:bo,response:ul}},tu="DISPATCH";var Oe;(function(s){s.AUTHORIZE="AUTHORIZE",s.AUTHENTICATE="AUTHENTICATE",s.GET_GUILDS="GET_GUILDS",s.GET_GUILD="GET_GUILD",s.GET_CHANNEL="GET_CHANNEL",s.GET_CHANNELS="GET_CHANNELS",s.SELECT_VOICE_CHANNEL="SELECT_VOICE_CHANNEL",s.SELECT_TEXT_CHANNEL="SELECT_TEXT_CHANNEL",s.SUBSCRIBE="SUBSCRIBE",s.UNSUBSCRIBE="UNSUBSCRIBE",s.CAPTURE_SHORTCUT="CAPTURE_SHORTCUT",s.SET_CERTIFIED_DEVICES="SET_CERTIFIED_DEVICES",s.SET_ACTIVITY="SET_ACTIVITY",s.GET_SKUS="GET_SKUS",s.GET_ENTITLEMENTS="GET_ENTITLEMENTS",s.GET_SKUS_EMBEDDED="GET_SKUS_EMBEDDED",s.GET_ENTITLEMENTS_EMBEDDED="GET_ENTITLEMENTS_EMBEDDED",s.START_PURCHASE="START_PURCHASE",s.SET_CONFIG="SET_CONFIG",s.SEND_ANALYTICS_EVENT="SEND_ANALYTICS_EVENT",s.USER_SETTINGS_GET_LOCALE="USER_SETTINGS_GET_LOCALE",s.OPEN_EXTERNAL_LINK="OPEN_EXTERNAL_LINK",s.ENCOURAGE_HW_ACCELERATION="ENCOURAGE_HW_ACCELERATION",s.CAPTURE_LOG="CAPTURE_LOG",s.SET_ORIENTATION_LOCK_STATE="SET_ORIENTATION_LOCK_STATE",s.OPEN_INVITE_DIALOG="OPEN_INVITE_DIALOG",s.GET_PLATFORM_BEHAVIORS="GET_PLATFORM_BEHAVIORS",s.GET_CHANNEL_PERMISSIONS="GET_CHANNEL_PERMISSIONS",s.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",s.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",s.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(Oe||(Oe={}));const xi=oe({cmd:P(),data:rr(),evt:Ua(),nonce:P()}).passthrough(),nu=Object.assign(Object.assign({},fl.shape.scopes.element.overlayType._def.innerType.options[0].Values),{UNHANDLED:-1});Xt(nu);const Vs=oe({id:P(),username:P(),discriminator:P(),global_name:P().optional().nullable(),avatar:P().optional().nullable(),avatar_decoration_data:oe({asset:P(),sku_id:P().optional()}).nullable(),bot:ke(),flags:we().optional().nullable(),premium_type:we().optional().nullable()}),ja=oe({user:Vs,nick:P().optional().nullable(),roles:Qe(P()),joined_at:P(),deaf:ke(),mute:ke()}),su=oe({user_id:P(),nick:P().optional().nullable(),guild_id:P(),avatar:P().optional().nullable(),avatar_decoration_data:oe({asset:P(),sku_id:P().optional().nullable()}).optional().nullable(),color_string:P().optional().nullable()}),Ha=oe({id:P(),name:P().optional().nullable(),roles:Qe(P()).optional().nullable(),user:Vs.optional().nullable(),require_colons:ke().optional().nullable(),managed:ke().optional().nullable(),animated:ke().optional().nullable(),available:ke().optional().nullable()}),hl=oe({mute:ke(),deaf:ke(),self_mute:ke(),self_deaf:ke(),suppress:ke()}),pl=oe({mute:ke(),nick:P(),user:Vs,voice_state:hl,volume:we()}),iu={UNHANDLED:-1,IDLE:"idle",DND:"dnd",ONLINE:"online",OFFLINE:"offline"},Er=Xt(iu),Gi=oe({name:P(),type:we(),url:P().optional().nullable(),created_at:we().optional().nullable(),timestamps:oe({start:we(),end:we()}).partial().optional().nullable(),application_id:P().optional().nullable(),details:P().optional().nullable(),state:P().optional().nullable(),emoji:Ha.optional().nullable(),party:oe({id:P().optional().nullable(),size:Qe(we()).optional().nullable()}).optional().nullable(),assets:oe({large_image:P().nullable(),large_text:P().nullable(),small_image:P().nullable(),small_text:P().nullable()}).partial().optional().nullable(),secrets:oe({join:P(),match:P()}).partial().optional().nullable(),instance:ke().optional().nullable(),flags:we().optional().nullable()}),ru={UNHANDLED:-1,ROLE:0,MEMBER:1},au=oe({id:P(),type:Xt(ru),allow:P(),deny:P()}),Ga={UNHANDLED:-1,DM:1,GROUP_DM:3,GUILD_TEXT:0,GUILD_VOICE:2,GUILD_CATEGORY:4,GUILD_ANNOUNCEMENT:5,GUILD_STORE:6,ANNOUNCEMENT_THREAD:10,PUBLIC_THREAD:11,PRIVATE_THREAD:12,GUILD_STAGE_VOICE:13,GUILD_DIRECTORY:14,GUILD_FORUM:15},gl=oe({id:P(),type:Xt(Ga),guild_id:P().optional().nullable(),position:we().optional().nullable(),permission_overwrites:Qe(au).optional().nullable(),name:P().optional().nullable(),topic:P().optional().nullable(),nsfw:ke().optional().nullable(),last_message_id:P().optional().nullable(),bitrate:we().optional().nullable(),user_limit:we().optional().nullable(),rate_limit_per_user:we().optional().nullable(),recipients:Qe(Vs).optional().nullable(),icon:P().optional().nullable(),owner_id:P().optional().nullable(),application_id:P().optional().nullable(),parent_id:P().optional().nullable(),last_pin_timestamp:P().optional().nullable()}),ou=oe({user:Vs,guild_id:P(),status:Er,activities:Qe(Gi),client_status:oe({desktop:Er,mobile:Er,web:Er}).partial()}),lu=oe({id:P(),name:P(),color:we(),hoist:ke(),position:we(),permissions:P(),managed:ke(),mentionable:ke()});oe({id:P(),name:P(),owner_id:P(),icon:P().nullable(),icon_hash:P().optional().nullable(),splash:P().nullable(),discovery_splash:P().nullable(),owner:ke().optional().nullable(),permissions:P().optional().nullable(),region:P(),afk_channel_id:P().nullable(),afk_timeout:we(),widget_enabled:ke().optional().nullable(),widget_channel_id:P().optional().nullable(),verification_level:we(),default_message_notifications:we(),explicit_content_filter:we(),roles:Qe(lu),emojis:Qe(Ha),features:Qe(P()),mfa_level:we(),application_id:P().nullable(),system_channel_id:P().nullable(),system_channel_flags:we(),rules_channel_id:P().nullable(),joined_at:P().optional().nullable(),large:ke().optional().nullable(),unavailable:ke().optional().nullable(),member_count:we().optional().nullable(),voice_states:Qe(hl).optional().nullable(),members:Qe(ja).optional().nullable(),channels:Qe(gl).optional().nullable(),presences:Qe(ou).optional().nullable(),max_presences:we().optional().nullable(),max_members:we().optional().nullable(),vanity_url_code:P().nullable(),description:P().nullable(),banner:P().nullable(),premium_tier:we(),premium_subscription_count:we().optional().nullable(),preferred_locale:P(),public_updates_channel_id:P().nullable(),max_video_channel_users:we().optional().nullable(),approximate_member_count:we().optional().nullable(),approximate_presence_count:we().optional().nullable()});const cu=oe({id:P(),guild_id:P(),type:we(),name:P()}),fu=oe({id:P(),filename:P(),size:we(),url:P(),proxy_url:P(),height:we().optional().nullable(),width:we().optional().nullable()}),uu=oe({text:P(),icon_url:P().optional().nullable(),proxy_icon_url:P().optional().nullable()}),Sa=oe({url:P().optional().nullable(),proxy_url:P().optional().nullable(),height:we().optional().nullable(),width:we().optional().nullable()}),du=Sa.omit({proxy_url:!0}),hu=oe({name:P().optional().nullable(),url:P().optional().nullable()}),pu=oe({name:P().optional().nullable(),url:P().optional().nullable(),icon_url:P().optional().nullable(),proxy_icon_url:P().optional().nullable()}),gu=oe({name:P(),value:P(),inline:ke()}),mu=oe({title:P().optional().nullable(),type:P().optional().nullable(),description:P().optional().nullable(),url:P().optional().nullable(),timestamp:P().optional().nullable(),color:we().optional().nullable(),footer:uu.optional().nullable(),image:Sa.optional().nullable(),thumbnail:Sa.optional().nullable(),video:du.optional().nullable(),provider:hu.optional().nullable(),author:pu.optional().nullable(),fields:Qe(gu).optional().nullable()}),yu=oe({count:we(),me:ke(),emoji:Ha}),bu=oe({type:we(),party_id:P().optional().nullable()}),Eu=oe({id:P(),cover_image:P().optional().nullable(),description:P(),icon:P().optional().nullable(),name:P()}),vu=oe({message_id:P().optional().nullable(),channel_id:P().optional().nullable(),guild_id:P().optional().nullable()}),_u=oe({id:P(),channel_id:P(),guild_id:P().optional().nullable(),author:Vs.optional().nullable(),member:ja.optional().nullable(),content:P(),timestamp:P(),edited_timestamp:P().optional().nullable(),tts:ke(),mention_everyone:ke(),mentions:Qe(Vs),mention_roles:Qe(P()),mention_channels:Qe(cu),attachments:Qe(fu),embeds:Qe(mu),reactions:Qe(yu).optional().nullable(),nonce:Fa([P(),we()]).optional().nullable(),pinned:ke(),webhook_id:P().optional().nullable(),type:we(),activity:bu.optional().nullable(),application:Eu.optional().nullable(),message_reference:vu.optional().nullable(),flags:we().optional().nullable(),stickers:Qe(rr()).optional().nullable(),referenced_message:rr().optional().nullable()}),wu=oe({id:P(),name:P()}),Tu={UNHANDLED:-1,KEYBOARD_KEY:0,MOUSE_BUTTON:1,KEYBOARD_MODIFIER_KEY:2,GAMEPAD_BUTTON:3},ml=oe({type:Xt(Tu),code:we(),name:P()}),Iu={UNHANDLED:-1,PUSH_TO_TALK:"PUSH_TO_TALK",VOICE_ACTIVITY:"VOICE_ACTIVITY"},Su=oe({type:Xt(Iu),auto_threshold:ke(),threshold:we(),shortcut:Qe(ml),delay:we()}),Eo=oe({device_id:P(),volume:we(),available_devices:Qe(wu)}),Au={UNHANDLED:-1,AUDIO_INPUT:"AUDIO_INPUT",AUDIO_OUTPUT:"AUDIO_OUTPUT",VIDEO_INPUT:"VIDEO_INPUT"};oe({type:Xt(Au),id:P(),vendor:oe({name:P(),url:P()}),model:oe({name:P(),url:P()}),related:Qe(P()),echo_cancellation:ke().optional().nullable(),noise_suppression:ke().optional().nullable(),automatic_gain_control:ke().optional().nullable(),hardware_mute:ke().optional().nullable()});const Ou={UNHANDLED:-1,APPLICATION:1,DLC:2,CONSUMABLE:3,BUNDLE:4,SUBSCRIPTION:5},xu=oe({id:P(),name:P(),type:Xt(Ou),price:oe({amount:we(),currency:P()}),application_id:P(),flags:we(),release_date:P().nullable()}),Du={UNHANDLED:-1,PURCHASE:1,PREMIUM_SUBSCRIPTION:2,DEVELOPER_GIFT:3,TEST_MODE_PURCHASE:4,FREE_PURCHASE:5,USER_GIFT:6,PREMIUM_PURCHASE:7},Za=oe({id:P(),sku_id:P(),application_id:P(),user_id:P(),gift_code_flags:we(),type:Xt(Du),gifter_user_id:P().optional().nullable(),branches:Qe(P()).optional().nullable(),starts_at:P().optional().nullable(),ends_at:P().optional().nullable(),parent_id:P().optional().nullable(),consumed:ke().optional().nullable(),deleted:ke().optional().nullable(),gift_code_batch_id:P().optional().nullable()}),Ru={UNHANDLED:-1,UNLOCKED:1,PORTRAIT:2,LANDSCAPE:3};Xt(Ru);const Nu={UNHANDLED:-1,NOMINAL:0,FAIR:1,SERIOUS:2,CRITICAL:3},Pu=Xt(Nu),yl={UNHANDLED:-1,PORTRAIT:0,LANDSCAPE:1};Xt(yl);const bl={UNHANDLED:-1,FOCUSED:0,PIP:1,GRID:2};Xt(bl);const za="ERROR";var it;(function(s){s.READY="READY",s.VOICE_STATE_UPDATE="VOICE_STATE_UPDATE",s.SPEAKING_START="SPEAKING_START",s.SPEAKING_STOP="SPEAKING_STOP",s.ACTIVITY_LAYOUT_MODE_UPDATE="ACTIVITY_LAYOUT_MODE_UPDATE",s.ORIENTATION_UPDATE="ORIENTATION_UPDATE",s.CURRENT_USER_UPDATE="CURRENT_USER_UPDATE",s.CURRENT_GUILD_MEMBER_UPDATE="CURRENT_GUILD_MEMBER_UPDATE",s.ENTITLEMENT_CREATE="ENTITLEMENT_CREATE",s.THERMAL_STATE_UPDATE="THERMAL_STATE_UPDATE",s.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE="ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE"})(it||(it={}));const In=xi.extend({evt:Oi(it),nonce:P().nullable(),cmd:$t(tu),data:oe({}).passthrough()}),El=xi.extend({evt:$t(za),data:oe({code:we(),message:P().optional()}).passthrough(),cmd:Oi(Oe),nonce:P().nullable()}),Cu=In.extend({evt:P()}),Lu=Fa([In,Cu,El]);function ku(s){const t=s.evt;if(!(t in it))throw new Error(`Unrecognized event type ${s.evt}`);return Bu[t].payload.parse(s)}const Bu={[it.READY]:{payload:In.extend({evt:$t(it.READY),data:oe({v:we(),config:oe({cdn_host:P().optional(),api_endpoint:P(),environment:P()}),user:oe({id:P(),username:P(),discriminator:P(),avatar:P().optional()}).optional()})})},[it.VOICE_STATE_UPDATE]:{payload:In.extend({evt:$t(it.VOICE_STATE_UPDATE),data:pl}),subscribeArgs:oe({channel_id:P()})},[it.SPEAKING_START]:{payload:In.extend({evt:$t(it.SPEAKING_START),data:oe({lobby_id:P().optional(),channel_id:P().optional(),user_id:P()})}),subscribeArgs:oe({lobby_id:P().nullable().optional(),channel_id:P().nullable().optional()})},[it.SPEAKING_STOP]:{payload:In.extend({evt:$t(it.SPEAKING_STOP),data:oe({lobby_id:P().optional(),channel_id:P().optional(),user_id:P()})}),subscribeArgs:oe({lobby_id:P().nullable().optional(),channel_id:P().nullable().optional()})},[it.ACTIVITY_LAYOUT_MODE_UPDATE]:{payload:In.extend({evt:$t(it.ACTIVITY_LAYOUT_MODE_UPDATE),data:oe({layout_mode:Xt(bl)})})},[it.ORIENTATION_UPDATE]:{payload:In.extend({evt:$t(it.ORIENTATION_UPDATE),data:oe({screen_orientation:Xt(yl),orientation:Oi(Ia)})})},[it.CURRENT_USER_UPDATE]:{payload:In.extend({evt:$t(it.CURRENT_USER_UPDATE),data:Vs})},[it.CURRENT_GUILD_MEMBER_UPDATE]:{payload:In.extend({evt:$t(it.CURRENT_GUILD_MEMBER_UPDATE),data:su}),subscribeArgs:oe({guild_id:P()})},[it.ENTITLEMENT_CREATE]:{payload:In.extend({evt:$t(it.ENTITLEMENT_CREATE),data:oe({entitlement:Za})})},[it.THERMAL_STATE_UPDATE]:{payload:In.extend({evt:$t(it.THERMAL_STATE_UPDATE),data:oe({thermal_state:Pu})})},[it.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE]:{payload:In.extend({evt:$t(it.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE),data:oe({participants:ul.shape.participants})})}};function $u(s,t){throw t}const lr=oe({}).nullable(),vl=oe({code:P()}),Mu=oe({guilds:Qe(oe({id:P(),name:P()}))}),Uu=oe({id:P(),name:P(),icon_url:P().optional(),members:Qe(ja)}),Si=oe({id:P(),type:Xt(Ga),guild_id:P().optional().nullable(),name:P().optional().nullable(),topic:P().optional().nullable(),bitrate:we().optional().nullable(),user_limit:we().optional().nullable(),position:we().optional().nullable(),voice_states:Qe(pl),messages:Qe(_u)}),Fu=oe({channels:Qe(gl)});Si.nullable();const Vu=Si.nullable(),ju=Si.nullable();oe({input:Eo,output:Eo,mode:Su,automatic_gain_control:ke(),echo_cancellation:ke(),noise_suppression:ke(),qos:ke(),silence_warning:ke(),deaf:ke(),mute:ke()});const Hu=oe({evt:P()}),Gu=oe({shortcut:ml}),_l=Gi,wl=oe({skus:Qe(xu)}),Tl=oe({entitlements:Qe(Za)}),Il=Qe(Za).nullable(),Sl=oe({use_interactive_pip:ke()}),Al=oe({locale:P()}),Ol=oe({enabled:ke()}),xl=oe({permissions:tl().or(P())}),Dl=oe({iosKeyboardResizesView:nl(ke())}),Zu=xi.extend({cmd:Oi(Oe),evt:Ua()});function zu({cmd:s,data:t}){switch(s){case Oe.AUTHORIZE:return vl.parse(t);case Oe.CAPTURE_SHORTCUT:return Gu.parse(t);case Oe.ENCOURAGE_HW_ACCELERATION:return Ol.parse(t);case Oe.GET_CHANNEL:return Si.parse(t);case Oe.GET_CHANNELS:return Fu.parse(t);case Oe.GET_CHANNEL_PERMISSIONS:return xl.parse(t);case Oe.GET_GUILD:return Uu.parse(t);case Oe.GET_GUILDS:return Mu.parse(t);case Oe.GET_PLATFORM_BEHAVIORS:return Dl.parse(t);case Oe.GET_CHANNEL:return Si.parse(t);case Oe.SELECT_TEXT_CHANNEL:return ju.parse(t);case Oe.SELECT_VOICE_CHANNEL:return Vu.parse(t);case Oe.SET_ACTIVITY:return _l.parse(t);case Oe.GET_SKUS_EMBEDDED:return wl.parse(t);case Oe.GET_ENTITLEMENTS_EMBEDDED:return Tl.parse(t);case Oe.SET_CONFIG:return Sl.parse(t);case Oe.START_PURCHASE:return Il.parse(t);case Oe.SUBSCRIBE:case Oe.UNSUBSCRIBE:return Hu.parse(t);case Oe.USER_SETTINGS_GET_LOCALE:return Al.parse(t);case Oe.OPEN_EXTERNAL_LINK:case Oe.SET_ORIENTATION_LOCK_STATE:case Oe.SET_CERTIFIED_DEVICES:case Oe.SEND_ANALYTICS_EVENT:case Oe.OPEN_INVITE_DIALOG:case Oe.CAPTURE_LOG:case Oe.GET_SKUS:case Oe.GET_ENTITLEMENTS:return lr.parse(t);case Oe.AUTHENTICATE:case Oe.INITIATE_IMAGE_UPLOAD:case Oe.OPEN_SHARE_MOMENT_DIALOG:case Oe.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS:const{response:e}=dl[s];return e.parse(t);default:$u(s,new Error(`Unrecognized command ${s}`))}}function Wu(s){return Object.assign(Object.assign({},s),{data:zu(s)})}oe({frame_id:P(),platform:Oi(_s).optional().nullable()});oe({v:$t(1),encoding:$t("json").optional(),client_id:P(),frame_id:P()});const Ku=oe({code:we(),message:P().optional()}),qu=oe({evt:P().nullable(),nonce:P().nullable(),data:rr().nullable(),cmd:P()}).passthrough();function Yu(s){const t=qu.parse(s);return t.evt!=null?t.evt===za?El.parse(t):ku(Lu.parse(t)):Wu(Zu.passthrough().parse(t))}function gn(s,t,e,i=()=>{}){const a=xi.extend({cmd:$t(t),data:e});return async l=>{const u=await s({cmd:t,args:l,transfer:i(l)});return a.parse(u).data}}function Hr(s,t=()=>{}){const e=dl[s].response,i=xi.extend({cmd:$t(s),data:e});return a=>async l=>{const u=await a({cmd:s,args:l,transfer:t(l)});return i.parse(u).data}}const Xu=Hr(is.AUTHENTICATE),Ju=s=>gn(s,Oe.AUTHORIZE,vl),Qu=s=>gn(s,Oe.CAPTURE_LOG,lr),ed=s=>gn(s,Oe.ENCOURAGE_HW_ACCELERATION,Ol),td=s=>gn(s,Oe.GET_ENTITLEMENTS_EMBEDDED,Tl),nd=s=>gn(s,Oe.GET_SKUS_EMBEDDED,wl),sd=s=>gn(s,Oe.GET_CHANNEL_PERMISSIONS,xl),id=s=>gn(s,Oe.GET_PLATFORM_BEHAVIORS,Dl),rd=s=>gn(s,Oe.OPEN_EXTERNAL_LINK,lr),ad=s=>gn(s,Oe.OPEN_INVITE_DIALOG,lr),od=Hr(is.OPEN_SHARE_MOMENT_DIALOG);Gi.pick({state:!0,details:!0,timestamps:!0,assets:!0,party:!0,secrets:!0,instance:!0,type:!0}).extend({type:Gi.shape.type.optional(),instance:Gi.shape.instance.optional()}).nullable();const ld=s=>gn(s,Oe.SET_ACTIVITY,_l),cd=s=>gn(s,Oe.SET_CONFIG,Sl);function fd({sendCommand:s,cmd:t,response:e,fallbackTransform:i,transferTransform:a=()=>{}}){const l=xi.extend({cmd:$t(t),data:e});return async u=>{try{const d=await s({cmd:t,args:u,transfer:a(u)});return l.parse(d).data}catch(d){if(d.code===Ta.INVALID_PAYLOAD){const m=i(u),g=await s({cmd:t,args:m,transfer:a(m)});return l.parse(g).data}else throw d}}}const ud=s=>({lock_state:s.lock_state,picture_in_picture_lock_state:s.picture_in_picture_lock_state}),dd=s=>fd({sendCommand:s,cmd:Oe.SET_ORIENTATION_LOCK_STATE,response:lr,fallbackTransform:ud}),hd=s=>gn(s,Oe.START_PURCHASE,Il),pd=s=>gn(s,Oe.USER_SETTINGS_GET_LOCALE,Al),gd=Hr(is.INITIATE_IMAGE_UPLOAD),md=s=>gn(s,Oe.GET_CHANNEL,Si),yd=Hr(is.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS);function bd(s){return{authenticate:Xu(s),authorize:Ju(s),captureLog:Qu(s),encourageHardwareAcceleration:ed(s),getChannel:md(s),getChannelPermissions:sd(s),getEntitlements:td(s),getPlatformBehaviors:id(s),getSkus:nd(s),openExternalLink:rd(s),openInviteDialog:ad(s),openShareMomentDialog:od(s),setActivity:ld(s),setConfig:cd(s),setOrientationLockState:dd(s),startPurchase:hd(s),userSettingsGetLocale:pd(s),initiateImageUpload:gd(s),getInstanceConnectedParticipants:yd(s)}}class Ed extends Error{constructor(t,e=""){super(e),this.code=t,this.message=e,this.name="Discord SDK Error"}}function Rl(){return{disableConsoleLogOverride:!1}}const vd=["log","warn","debug","info","error"];function _d(s,t,e){const i=s[t],a=s;i&&(s[t]=function(){const l=[].slice.call(arguments),u=""+l.join(" ");e(t,u),i.apply(a,l)})}var wd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),vo={randomUUID:wd},vr,Td=new Uint8Array(16);function Id(){if(!vr&&(vr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vr(Td)}var Gt=[];for(var ra=0;ra<256;++ra)Gt.push((ra+256).toString(16).slice(1));function Sd(s,t=0){return(Gt[s[t+0]]+Gt[s[t+1]]+Gt[s[t+2]]+Gt[s[t+3]]+"-"+Gt[s[t+4]]+Gt[s[t+5]]+"-"+Gt[s[t+6]]+Gt[s[t+7]]+"-"+Gt[s[t+8]]+Gt[s[t+9]]+"-"+Gt[s[t+10]]+Gt[s[t+11]]+Gt[s[t+12]]+Gt[s[t+13]]+Gt[s[t+14]]+Gt[s[t+15]]).toLowerCase()}function _o(s,t,e){if(vo.randomUUID&&!t&&!s)return vo.randomUUID();s=s||{};var i=s.random||(s.rng||Id)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Sd(i)}var vs;(function(s){s[s.HANDSHAKE=0]="HANDSHAKE",s[s.FRAME=1]="FRAME",s[s.CLOSE=2]="CLOSE",s[s.HELLO=3]="HELLO"})(vs||(vs={}));const Ad=new Set(Od());function Od(){return typeof window>"u"?[]:[window.location.origin,"https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]}function xd(){var s;return[(s=window.parent.opener)!==null&&s!==void 0?s:window.parent,document.referrer?document.referrer:"*"]}class Dd{getTransfer(t){var e;switch(t.cmd){case Oe.SUBSCRIBE:case Oe.UNSUBSCRIBE:return;default:return(e=t.transfer)!==null&&e!==void 0?e:void 0}}constructor(t,e){if(this.source=null,this.sourceOrigin="",this.eventBus=new Ko,this.pendingCommands=new Map,this.sendCommand=d=>{var m;if(this.source==null)throw new Error("Attempting to send message before initialization");const g=_o();return(m=this.source)===null||m===void 0||m.postMessage([vs.FRAME,Object.assign(Object.assign({},d),{nonce:g})],this.sourceOrigin,this.getTransfer(d)),new Promise((h,I)=>{this.pendingCommands.set(g,{resolve:h,reject:I})})},this.commands=bd(this.sendCommand),this.handleMessage=d=>{if(!Ad.has(d.origin))return;const m=d.data;if(!Array.isArray(m))return;const[g,y]=m;switch(g){case vs.HELLO:return;case vs.CLOSE:return this.handleClose(y);case vs.HANDSHAKE:return this.handleHandshake();case vs.FRAME:return this.handleFrame(y);default:throw new Error("Invalid message format")}},this.isReady=!1,this.clientId=t,this.configuration=e??Rl(),typeof window<"u"&&window.addEventListener("message",this.handleMessage),typeof window>"u"){this.frameId="",this.instanceId="",this.platform=_s.DESKTOP,this.guildId=null,this.channelId=null;return}const i=new URLSearchParams(this._getSearch()),a=i.get("frame_id");if(!a)throw new Error("frame_id query param is not defined");this.frameId=a;const l=i.get("instance_id");if(!l)throw new Error("instance_id query param is not defined");this.instanceId=l;const u=i.get("platform");if(u){if(u!==_s.DESKTOP&&u!==_s.MOBILE)throw new Error(`Invalid query param "platform" of "${u}". Valid values are "${_s.DESKTOP}" or "${_s.MOBILE}"`)}else throw new Error("platform query param is not defined");this.platform=u,this.guildId=i.get("guild_id"),this.channelId=i.get("channel_id"),[this.source,this.sourceOrigin]=xd(),this.addOnReadyListener(),this.handshake()}close(t,e){var i;window.removeEventListener("message",this.handleMessage);const a=_o();(i=this.source)===null||i===void 0||i.postMessage([vs.CLOSE,{code:t,message:e,nonce:a}],this.sourceOrigin)}async subscribe(t,e,...i){const[a]=i,l=this.eventBus.listenerCount(t),u=this.eventBus.on(t,e);return Object.values(it).includes(t)&&t!==it.READY&&l===0&&await this.sendCommand({cmd:Oe.SUBSCRIBE,args:a,evt:t}),u}async unsubscribe(t,e,...i){const[a]=i;return t!==it.READY&&this.eventBus.listenerCount(t)===1&&await this.sendCommand({cmd:Oe.UNSUBSCRIBE,evt:t,args:a}),this.eventBus.off(t,e)}async ready(){this.isReady||await new Promise(t=>{this.eventBus.once(it.READY,t)})}handshake(){var t;(t=this.source)===null||t===void 0||t.postMessage([vs.HANDSHAKE,{v:1,encoding:"json",client_id:this.clientId,frame_id:this.frameId}],this.sourceOrigin)}addOnReadyListener(){this.eventBus.once(it.READY,()=>{this.overrideConsoleLogging(),this.isReady=!0})}overrideConsoleLogging(){if(this.configuration.disableConsoleLogOverride)return;const t=(e,i)=>{this.commands.captureLog({level:e,message:i})};vd.forEach(e=>{_d(console,e,t)})}handleClose(t){Ku.parse(t)}handleHandshake(){}handleFrame(t){var e,i;let a;try{a=Yu(t)}catch(l){console.error("Failed to parse",t),console.error(l);return}if(a.cmd==="DISPATCH")this.eventBus.emit(a.evt,a.data);else{if(a.evt===za){if(a.nonce!=null){(e=this.pendingCommands.get(a.nonce))===null||e===void 0||e.reject(a.data),this.pendingCommands.delete(a.nonce);return}this.eventBus.emit("error",new Ed(a.data.code,a.data.message))}if(a.nonce==null){console.error("Missing nonce",t);return}(i=this.pendingCommands.get(a.nonce))===null||i===void 0||i.resolve(a),this.pendingCommands.delete(a.nonce)}}_getSearch(){return typeof window>"u"?"":window.location.search}}var Di=1e9,Rd={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Bl,yt=!0,Cn="[DecimalError] ",hi=Cn+"Invalid argument: ",Wa=Cn+"Exponent out of range: ",Ri=Math.floor,ui=Math.pow,Nd=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Sn,Vt=1e7,gt=7,Nl=9007199254740991,kr=Ri(Nl/gt),me={};me.absoluteValue=me.abs=function(){var s=new this.constructor(this);return s.s&&(s.s=1),s};me.comparedTo=me.cmp=function(s){var t,e,i,a,l=this;if(s=new l.constructor(s),l.s!==s.s)return l.s||-s.s;if(l.e!==s.e)return l.e>s.e^l.s<0?1:-1;for(i=l.d.length,a=s.d.length,t=0,e=i<a?i:a;t<e;++t)if(l.d[t]!==s.d[t])return l.d[t]>s.d[t]^l.s<0?1:-1;return i===a?0:i>a^l.s<0?1:-1};me.decimalPlaces=me.dp=function(){var s=this,t=s.d.length-1,e=(t-s.e)*gt;if(t=s.d[t],t)for(;t%10==0;t/=10)e--;return e<0?0:e};me.dividedBy=me.div=function(s){return Ts(this,new this.constructor(s))};me.dividedToIntegerBy=me.idiv=function(s){var t=this,e=t.constructor;return ut(Ts(t,new e(s),0,1),e.precision)};me.equals=me.eq=function(s){return!this.cmp(s)};me.exponent=function(){return Pt(this)};me.greaterThan=me.gt=function(s){return this.cmp(s)>0};me.greaterThanOrEqualTo=me.gte=function(s){return this.cmp(s)>=0};me.isInteger=me.isint=function(){return this.e>this.d.length-2};me.isNegative=me.isneg=function(){return this.s<0};me.isPositive=me.ispos=function(){return this.s>0};me.isZero=function(){return this.s===0};me.lessThan=me.lt=function(s){return this.cmp(s)<0};me.lessThanOrEqualTo=me.lte=function(s){return this.cmp(s)<1};me.logarithm=me.log=function(s){var t,e=this,i=e.constructor,a=i.precision,l=a+5;if(s===void 0)s=new i(10);else if(s=new i(s),s.s<1||s.eq(Sn))throw Error(Cn+"NaN");if(e.s<1)throw Error(Cn+(e.s?"NaN":"-Infinity"));return e.eq(Sn)?new i(0):(yt=!1,t=Ts(ar(e,l),ar(s,l),l),yt=!0,ut(t,a))};me.minus=me.sub=function(s){var t=this;return s=new t.constructor(s),t.s==s.s?Ll(t,s):Pl(t,(s.s=-s.s,s))};me.modulo=me.mod=function(s){var t,e=this,i=e.constructor,a=i.precision;if(s=new i(s),!s.s)throw Error(Cn+"NaN");return e.s?(yt=!1,t=Ts(e,s,0,1).times(s),yt=!0,e.minus(t)):ut(new i(e),a)};me.naturalExponential=me.exp=function(){return Cl(this)};me.naturalLogarithm=me.ln=function(){return ar(this)};me.negated=me.neg=function(){var s=new this.constructor(this);return s.s=-s.s||0,s};me.plus=me.add=function(s){var t=this;return s=new t.constructor(s),t.s==s.s?Pl(t,s):Ll(t,(s.s=-s.s,s))};me.precision=me.sd=function(s){var t,e,i,a=this;if(s!==void 0&&s!==!!s&&s!==1&&s!==0)throw Error(hi+s);if(t=Pt(a)+1,i=a.d.length-1,e=i*gt+1,i=a.d[i],i){for(;i%10==0;i/=10)e--;for(i=a.d[0];i>=10;i/=10)e++}return s&&t>e?t:e};me.squareRoot=me.sqrt=function(){var s,t,e,i,a,l,u,d=this,m=d.constructor;if(d.s<1){if(!d.s)return new m(0);throw Error(Cn+"NaN")}for(s=Pt(d),yt=!1,a=Math.sqrt(+d),a==0||a==1/0?(t=rs(d.d),(t.length+s)%2==0&&(t+="0"),a=Math.sqrt(t),s=Ri((s+1)/2)-(s<0||s%2),a==1/0?t="5e"+s:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+s),i=new m(t)):i=new m(a.toString()),e=m.precision,a=u=e+3;;)if(l=i,i=l.plus(Ts(d,l,u+2)).times(.5),rs(l.d).slice(0,u)===(t=rs(i.d)).slice(0,u)){if(t=t.slice(u-3,u+1),a==u&&t=="4999"){if(ut(l,e+1,0),l.times(l).eq(d)){i=l;break}}else if(t!="9999")break;u+=4}return yt=!0,ut(i,e)};me.times=me.mul=function(s){var t,e,i,a,l,u,d,m,g,y=this,h=y.constructor,I=y.d,j=(s=new h(s)).d;if(!y.s||!s.s)return new h(0);for(s.s*=y.s,e=y.e+s.e,m=I.length,g=j.length,m<g&&(l=I,I=j,j=l,u=m,m=g,g=u),l=[],u=m+g,i=u;i--;)l.push(0);for(i=g;--i>=0;){for(t=0,a=m+i;a>i;)d=l[a]+j[i]*I[a-i-1]+t,l[a--]=d%Vt|0,t=d/Vt|0;l[a]=(l[a]+t)%Vt|0}for(;!l[--u];)l.pop();return t?++e:l.shift(),s.d=l,s.e=e,yt?ut(s,h.precision):s};me.toDecimalPlaces=me.todp=function(s,t){var e=this,i=e.constructor;return e=new i(e),s===void 0?e:(cs(s,0,Di),t===void 0?t=i.rounding:cs(t,0,8),ut(e,s+Pt(e)+1,t))};me.toExponential=function(s,t){var e,i=this,a=i.constructor;return s===void 0?e=mi(i,!0):(cs(s,0,Di),t===void 0?t=a.rounding:cs(t,0,8),i=ut(new a(i),s+1,t),e=mi(i,!0,s+1)),e};me.toFixed=function(s,t){var e,i,a=this,l=a.constructor;return s===void 0?mi(a):(cs(s,0,Di),t===void 0?t=l.rounding:cs(t,0,8),i=ut(new l(a),s+Pt(a)+1,t),e=mi(i.abs(),!1,s+Pt(i)+1),a.isneg()&&!a.isZero()?"-"+e:e)};me.toInteger=me.toint=function(){var s=this,t=s.constructor;return ut(new t(s),Pt(s)+1,t.rounding)};me.toNumber=function(){return+this};me.toPower=me.pow=function(s){var t,e,i,a,l,u,d=this,m=d.constructor,g=12,y=+(s=new m(s));if(!s.s)return new m(Sn);if(d=new m(d),!d.s){if(s.s<1)throw Error(Cn+"Infinity");return d}if(d.eq(Sn))return d;if(i=m.precision,s.eq(Sn))return ut(d,i);if(t=s.e,e=s.d.length-1,u=t>=e,l=d.s,u){if((e=y<0?-y:y)<=Nl){for(a=new m(Sn),t=Math.ceil(i/gt+4),yt=!1;e%2&&(a=a.times(d),To(a.d,t)),e=Ri(e/2),e!==0;)d=d.times(d),To(d.d,t);return yt=!0,s.s<0?new m(Sn).div(a):ut(a,i)}}else if(l<0)throw Error(Cn+"NaN");return l=l<0&&s.d[Math.max(t,e)]&1?-1:1,d.s=1,yt=!1,a=s.times(ar(d,i+g)),yt=!0,a=Cl(a),a.s=l,a};me.toPrecision=function(s,t){var e,i,a=this,l=a.constructor;return s===void 0?(e=Pt(a),i=mi(a,e<=l.toExpNeg||e>=l.toExpPos)):(cs(s,1,Di),t===void 0?t=l.rounding:cs(t,0,8),a=ut(new l(a),s,t),e=Pt(a),i=mi(a,s<=e||e<=l.toExpNeg,s)),i};me.toSignificantDigits=me.tosd=function(s,t){var e=this,i=e.constructor;return s===void 0?(s=i.precision,t=i.rounding):(cs(s,1,Di),t===void 0?t=i.rounding:cs(t,0,8)),ut(new i(e),s,t)};me.toString=me.valueOf=me.val=me.toJSON=me[Symbol.for("nodejs.util.inspect.custom")]=function(){var s=this,t=Pt(s),e=s.constructor;return mi(s,t<=e.toExpNeg||t>=e.toExpPos)};function Pl(s,t){var e,i,a,l,u,d,m,g,y=s.constructor,h=y.precision;if(!s.s||!t.s)return t.s||(t=new y(s)),yt?ut(t,h):t;if(m=s.d,g=t.d,u=s.e,a=t.e,m=m.slice(),l=u-a,l){for(l<0?(i=m,l=-l,d=g.length):(i=g,a=u,d=m.length),u=Math.ceil(h/gt),d=u>d?u+1:d+1,l>d&&(l=d,i.length=1),i.reverse();l--;)i.push(0);i.reverse()}for(d=m.length,l=g.length,d-l<0&&(l=d,i=g,g=m,m=i),e=0;l;)e=(m[--l]=m[l]+g[l]+e)/Vt|0,m[l]%=Vt;for(e&&(m.unshift(e),++a),d=m.length;m[--d]==0;)m.pop();return t.d=m,t.e=a,yt?ut(t,h):t}function cs(s,t,e){if(s!==~~s||s<t||s>e)throw Error(hi+s)}function rs(s){var t,e,i,a=s.length-1,l="",u=s[0];if(a>0){for(l+=u,t=1;t<a;t++)i=s[t]+"",e=gt-i.length,e&&(l+=Ns(e)),l+=i;u=s[t],i=u+"",e=gt-i.length,e&&(l+=Ns(e))}else if(u===0)return"0";for(;u%10===0;)u/=10;return l+u}var Ts=function(){function s(i,a){var l,u=0,d=i.length;for(i=i.slice();d--;)l=i[d]*a+u,i[d]=l%Vt|0,u=l/Vt|0;return u&&i.unshift(u),i}function t(i,a,l,u){var d,m;if(l!=u)m=l>u?1:-1;else for(d=m=0;d<l;d++)if(i[d]!=a[d]){m=i[d]>a[d]?1:-1;break}return m}function e(i,a,l){for(var u=0;l--;)i[l]-=u,u=i[l]<a[l]?1:0,i[l]=u*Vt+i[l]-a[l];for(;!i[0]&&i.length>1;)i.shift()}return function(i,a,l,u){var d,m,g,y,h,I,j,J,H,z,ue,de,re,Te,$e,tt,at,mt,ot=i.constructor,Rt=i.s==a.s?1:-1,Je=i.d,Ve=a.d;if(!i.s)return new ot(i);if(!a.s)throw Error(Cn+"Division by zero");for(m=i.e-a.e,at=Ve.length,$e=Je.length,j=new ot(Rt),J=j.d=[],g=0;Ve[g]==(Je[g]||0);)++g;if(Ve[g]>(Je[g]||0)&&--m,l==null?de=l=ot.precision:u?de=l+(Pt(i)-Pt(a))+1:de=l,de<0)return new ot(0);if(de=de/gt+2|0,g=0,at==1)for(y=0,Ve=Ve[0],de++;(g<$e||y)&&de--;g++)re=y*Vt+(Je[g]||0),J[g]=re/Ve|0,y=re%Ve|0;else{for(y=Vt/(Ve[0]+1)|0,y>1&&(Ve=s(Ve,y),Je=s(Je,y),at=Ve.length,$e=Je.length),Te=at,H=Je.slice(0,at),z=H.length;z<at;)H[z++]=0;mt=Ve.slice(),mt.unshift(0),tt=Ve[0],Ve[1]>=Vt/2&&++tt;do y=0,d=t(Ve,H,at,z),d<0?(ue=H[0],at!=z&&(ue=ue*Vt+(H[1]||0)),y=ue/tt|0,y>1?(y>=Vt&&(y=Vt-1),h=s(Ve,y),I=h.length,z=H.length,d=t(h,H,I,z),d==1&&(y--,e(h,at<I?mt:Ve,I))):(y==0&&(d=y=1),h=Ve.slice()),I=h.length,I<z&&h.unshift(0),e(H,h,z),d==-1&&(z=H.length,d=t(Ve,H,at,z),d<1&&(y++,e(H,at<z?mt:Ve,z))),z=H.length):d===0&&(y++,H=[0]),J[g++]=y,d&&H[0]?H[z++]=Je[Te]||0:(H=[Je[Te]],z=1);while((Te++<$e||H[0]!==void 0)&&de--)}return J[0]||J.shift(),j.e=m,ut(j,u?l+Pt(j)+1:l)}}();function Cl(s,t){var e,i,a,l,u,d,m=0,g=0,y=s.constructor,h=y.precision;if(Pt(s)>16)throw Error(Wa+Pt(s));if(!s.s)return new y(Sn);for(t==null?(yt=!1,d=h):d=t,u=new y(.03125);s.abs().gte(.1);)s=s.times(u),g+=5;for(i=Math.log(ui(2,g))/Math.LN10*2+5|0,d+=i,e=a=l=new y(Sn),y.precision=d;;){if(a=ut(a.times(s),d),e=e.times(++m),u=l.plus(Ts(a,e,d)),rs(u.d).slice(0,d)===rs(l.d).slice(0,d)){for(;g--;)l=ut(l.times(l),d);return y.precision=h,t==null?(yt=!0,ut(l,h)):l}l=u}}function Pt(s){for(var t=s.e*gt,e=s.d[0];e>=10;e/=10)t++;return t}function aa(s,t,e){if(t>s.LN10.sd())throw yt=!0,e&&(s.precision=e),Error(Cn+"LN10 precision limit exceeded");return ut(new s(s.LN10),t)}function Ns(s){for(var t="";s--;)t+="0";return t}function ar(s,t){var e,i,a,l,u,d,m,g,y,h=1,I=10,j=s,J=j.d,H=j.constructor,z=H.precision;if(j.s<1)throw Error(Cn+(j.s?"NaN":"-Infinity"));if(j.eq(Sn))return new H(0);if(t==null?(yt=!1,g=z):g=t,j.eq(10))return t==null&&(yt=!0),aa(H,g);if(g+=I,H.precision=g,e=rs(J),i=e.charAt(0),l=Pt(j),Math.abs(l)<15e14){for(;i<7&&i!=1||i==1&&e.charAt(1)>3;)j=j.times(s),e=rs(j.d),i=e.charAt(0),h++;l=Pt(j),i>1?(j=new H("0."+e),l++):j=new H(i+"."+e.slice(1))}else return m=aa(H,g+2,z).times(l+""),j=ar(new H(i+"."+e.slice(1)),g-I).plus(m),H.precision=z,t==null?(yt=!0,ut(j,z)):j;for(d=u=j=Ts(j.minus(Sn),j.plus(Sn),g),y=ut(j.times(j),g),a=3;;){if(u=ut(u.times(y),g),m=d.plus(Ts(u,new H(a),g)),rs(m.d).slice(0,g)===rs(d.d).slice(0,g))return d=d.times(2),l!==0&&(d=d.plus(aa(H,g+2,z).times(l+""))),d=Ts(d,new H(h),g),H.precision=z,t==null?(yt=!0,ut(d,z)):d;d=m,a+=2}}function wo(s,t){var e,i,a;for((e=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(e<0&&(e=i),e+=+t.slice(i+1),t=t.substring(0,i)):e<0&&(e=t.length),i=0;t.charCodeAt(i)===48;)++i;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(i,a),t){if(a-=i,e=e-i-1,s.e=Ri(e/gt),s.d=[],i=(e+1)%gt,e<0&&(i+=gt),i<a){for(i&&s.d.push(+t.slice(0,i)),a-=gt;i<a;)s.d.push(+t.slice(i,i+=gt));t=t.slice(i),i=gt-t.length}else i-=a;for(;i--;)t+="0";if(s.d.push(+t),yt&&(s.e>kr||s.e<-kr))throw Error(Wa+e)}else s.s=0,s.e=0,s.d=[0];return s}function ut(s,t,e){var i,a,l,u,d,m,g,y,h=s.d;for(u=1,l=h[0];l>=10;l/=10)u++;if(i=t-u,i<0)i+=gt,a=t,g=h[y=0];else{if(y=Math.ceil((i+1)/gt),l=h.length,y>=l)return s;for(g=l=h[y],u=1;l>=10;l/=10)u++;i%=gt,a=i-gt+u}if(e!==void 0&&(l=ui(10,u-a-1),d=g/l%10|0,m=t<0||h[y+1]!==void 0||g%l,m=e<4?(d||m)&&(e==0||e==(s.s<0?3:2)):d>5||d==5&&(e==4||m||e==6&&(i>0?a>0?g/ui(10,u-a):0:h[y-1])%10&1||e==(s.s<0?8:7))),t<1||!h[0])return m?(l=Pt(s),h.length=1,t=t-l-1,h[0]=ui(10,(gt-t%gt)%gt),s.e=Ri(-t/gt)||0):(h.length=1,h[0]=s.e=s.s=0),s;if(i==0?(h.length=y,l=1,y--):(h.length=y+1,l=ui(10,gt-i),h[y]=a>0?(g/ui(10,u-a)%ui(10,a)|0)*l:0),m)for(;;)if(y==0){(h[0]+=l)==Vt&&(h[0]=1,++s.e);break}else{if(h[y]+=l,h[y]!=Vt)break;h[y--]=0,l=1}for(i=h.length;h[--i]===0;)h.pop();if(yt&&(s.e>kr||s.e<-kr))throw Error(Wa+Pt(s));return s}function Ll(s,t){var e,i,a,l,u,d,m,g,y,h,I=s.constructor,j=I.precision;if(!s.s||!t.s)return t.s?t.s=-t.s:t=new I(s),yt?ut(t,j):t;if(m=s.d,h=t.d,i=t.e,g=s.e,m=m.slice(),u=g-i,u){for(y=u<0,y?(e=m,u=-u,d=h.length):(e=h,i=g,d=m.length),a=Math.max(Math.ceil(j/gt),d)+2,u>a&&(u=a,e.length=1),e.reverse(),a=u;a--;)e.push(0);e.reverse()}else{for(a=m.length,d=h.length,y=a<d,y&&(d=a),a=0;a<d;a++)if(m[a]!=h[a]){y=m[a]<h[a];break}u=0}for(y&&(e=m,m=h,h=e,t.s=-t.s),d=m.length,a=h.length-d;a>0;--a)m[d++]=0;for(a=h.length;a>u;){if(m[--a]<h[a]){for(l=a;l&&m[--l]===0;)m[l]=Vt-1;--m[l],m[a]+=Vt}m[a]-=h[a]}for(;m[--d]===0;)m.pop();for(;m[0]===0;m.shift())--i;return m[0]?(t.d=m,t.e=i,yt?ut(t,j):t):new I(0)}function mi(s,t,e){var i,a=Pt(s),l=rs(s.d),u=l.length;return t?(e&&(i=e-u)>0?l=l.charAt(0)+"."+l.slice(1)+Ns(i):u>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(a<0?"e":"e+")+a):a<0?(l="0."+Ns(-a-1)+l,e&&(i=e-u)>0&&(l+=Ns(i))):a>=u?(l+=Ns(a+1-u),e&&(i=e-a-1)>0&&(l=l+"."+Ns(i))):((i=a+1)<u&&(l=l.slice(0,i)+"."+l.slice(i)),e&&(i=e-u)>0&&(a+1===u&&(l+="."),l+=Ns(i))),s.s<0?"-"+l:l}function To(s,t){if(s.length>t)return s.length=t,!0}function kl(s){var t,e,i;function a(l){var u=this;if(!(u instanceof a))return new a(l);if(u.constructor=a,l instanceof a){u.s=l.s,u.e=l.e,u.d=(l=l.d)?l.slice():l;return}if(typeof l=="number"){if(l*0!==0)throw Error(hi+l);if(l>0)u.s=1;else if(l<0)l=-l,u.s=-1;else{u.s=0,u.e=0,u.d=[0];return}if(l===~~l&&l<1e7){u.e=0,u.d=[l];return}return wo(u,l.toString())}else if(typeof l!="string")throw Error(hi+l);if(l.charCodeAt(0)===45?(l=l.slice(1),u.s=-1):u.s=1,Nd.test(l))wo(u,l);else throw Error(hi+l)}if(a.prototype=me,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=kl,a.config=a.set=Pd,s===void 0&&(s={}),s)for(i=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<i.length;)s.hasOwnProperty(e=i[t++])||(s[e]=this[e]);return a.config(s),a}function Pd(s){if(!s||typeof s!="object")throw Error(Cn+"Object expected");var t,e,i,a=["precision",1,Di,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((i=s[e=a[t]])!==void 0)if(Ri(i)===i&&i>=a[t+1]&&i<=a[t+2])this[e]=i;else throw Error(hi+e+": "+i);if((i=s[e="LN10"])!==void 0)if(i==Math.LN10)this[e]=new this(i);else throw Error(hi+e+": "+i);return this}var Bl=kl(Rd);Sn=new Bl(1);var L;(function(s){s.AED="aed",s.AFN="afn",s.ALL="all",s.AMD="amd",s.ANG="ang",s.AOA="aoa",s.ARS="ars",s.AUD="aud",s.AWG="awg",s.AZN="azn",s.BAM="bam",s.BBD="bbd",s.BDT="bdt",s.BGN="bgn",s.BHD="bhd",s.BIF="bif",s.BMD="bmd",s.BND="bnd",s.BOB="bob",s.BOV="bov",s.BRL="brl",s.BSD="bsd",s.BTN="btn",s.BWP="bwp",s.BYN="byn",s.BYR="byr",s.BZD="bzd",s.CAD="cad",s.CDF="cdf",s.CHE="che",s.CHF="chf",s.CHW="chw",s.CLF="clf",s.CLP="clp",s.CNY="cny",s.COP="cop",s.COU="cou",s.CRC="crc",s.CUC="cuc",s.CUP="cup",s.CVE="cve",s.CZK="czk",s.DJF="djf",s.DKK="dkk",s.DOP="dop",s.DZD="dzd",s.EGP="egp",s.ERN="ern",s.ETB="etb",s.EUR="eur",s.FJD="fjd",s.FKP="fkp",s.GBP="gbp",s.GEL="gel",s.GHS="ghs",s.GIP="gip",s.GMD="gmd",s.GNF="gnf",s.GTQ="gtq",s.GYD="gyd",s.HKD="hkd",s.HNL="hnl",s.HRK="hrk",s.HTG="htg",s.HUF="huf",s.IDR="idr",s.ILS="ils",s.INR="inr",s.IQD="iqd",s.IRR="irr",s.ISK="isk",s.JMD="jmd",s.JOD="jod",s.JPY="jpy",s.KES="kes",s.KGS="kgs",s.KHR="khr",s.KMF="kmf",s.KPW="kpw",s.KRW="krw",s.KWD="kwd",s.KYD="kyd",s.KZT="kzt",s.LAK="lak",s.LBP="lbp",s.LKR="lkr",s.LRD="lrd",s.LSL="lsl",s.LTL="ltl",s.LVL="lvl",s.LYD="lyd",s.MAD="mad",s.MDL="mdl",s.MGA="mga",s.MKD="mkd",s.MMK="mmk",s.MNT="mnt",s.MOP="mop",s.MRO="mro",s.MUR="mur",s.MVR="mvr",s.MWK="mwk",s.MXN="mxn",s.MXV="mxv",s.MYR="myr",s.MZN="mzn",s.NAD="nad",s.NGN="ngn",s.NIO="nio",s.NOK="nok",s.NPR="npr",s.NZD="nzd",s.OMR="omr",s.PAB="pab",s.PEN="pen",s.PGK="pgk",s.PHP="php",s.PKR="pkr",s.PLN="pln",s.PYG="pyg",s.QAR="qar",s.RON="ron",s.RSD="rsd",s.RUB="rub",s.RWF="rwf",s.SAR="sar",s.SBD="sbd",s.SCR="scr",s.SDG="sdg",s.SEK="sek",s.SGD="sgd",s.SHP="shp",s.SLL="sll",s.SOS="sos",s.SRD="srd",s.SSP="ssp",s.STD="std",s.SVC="svc",s.SYP="syp",s.SZL="szl",s.THB="thb",s.TJS="tjs",s.TMT="tmt",s.TND="tnd",s.TOP="top",s.TRY="try",s.TTD="ttd",s.TWD="twd",s.TZS="tzs",s.UAH="uah",s.UGX="ugx",s.USD="usd",s.USN="usn",s.USS="uss",s.UYI="uyi",s.UYU="uyu",s.UZS="uzs",s.VEF="vef",s.VND="vnd",s.VUV="vuv",s.WST="wst",s.XAF="xaf",s.XAG="xag",s.XAU="xau",s.XBA="xba",s.XBB="xbb",s.XBC="xbc",s.XBD="xbd",s.XCD="xcd",s.XDR="xdr",s.XFU="xfu",s.XOF="xof",s.XPD="xpd",s.XPF="xpf",s.XPT="xpt",s.XSU="xsu",s.XTS="xts",s.XUA="xua",s.YER="yer",s.ZAR="zar",s.ZMW="zmw",s.ZWL="zwl"})(L||(L={}));L.AED+"",L.AFN+"",L.ALL+"",L.AMD+"",L.ANG+"",L.AOA+"",L.ARS+"",L.AUD+"",L.AWG+"",L.AZN+"",L.BAM+"",L.BBD+"",L.BDT+"",L.BGN+"",L.BHD+"",L.BIF+"",L.BMD+"",L.BND+"",L.BOB+"",L.BOV+"",L.BRL+"",L.BSD+"",L.BTN+"",L.BWP+"",L.BYR+"",L.BYN+"",L.BZD+"",L.CAD+"",L.CDF+"",L.CHE+"",L.CHF+"",L.CHW+"",L.CLF+"",L.CLP+"",L.CNY+"",L.COP+"",L.COU+"",L.CRC+"",L.CUC+"",L.CUP+"",L.CVE+"",L.CZK+"",L.DJF+"",L.DKK+"",L.DOP+"",L.DZD+"",L.EGP+"",L.ERN+"",L.ETB+"",L.EUR+"",L.FJD+"",L.FKP+"",L.GBP+"",L.GEL+"",L.GHS+"",L.GIP+"",L.GMD+"",L.GNF+"",L.GTQ+"",L.GYD+"",L.HKD+"",L.HNL+"",L.HRK+"",L.HTG+"",L.HUF+"",L.IDR+"",L.ILS+"",L.INR+"",L.IQD+"",L.IRR+"",L.ISK+"",L.JMD+"",L.JOD+"",L.JPY+"",L.KES+"",L.KGS+"",L.KHR+"",L.KMF+"",L.KPW+"",L.KRW+"",L.KWD+"",L.KYD+"",L.KZT+"",L.LAK+"",L.LBP+"",L.LKR+"",L.LRD+"",L.LSL+"",L.LTL+"",L.LVL+"",L.LYD+"",L.MAD+"",L.MDL+"",L.MGA+"",L.MKD+"",L.MMK+"",L.MNT+"",L.MOP+"",L.MRO+"",L.MUR+"",L.MVR+"",L.MWK+"",L.MXN+"",L.MXV+"",L.MYR+"",L.MZN+"",L.NAD+"",L.NGN+"",L.NIO+"",L.NOK+"",L.NPR+"",L.NZD+"",L.OMR+"",L.PAB+"",L.PEN+"",L.PGK+"",L.PHP+"",L.PKR+"",L.PLN+"",L.PYG+"",L.QAR+"",L.RON+"",L.RSD+"",L.RUB+"",L.RWF+"",L.SAR+"",L.SBD+"",L.SCR+"",L.SDG+"",L.SEK+"",L.SGD+"",L.SHP+"",L.SLL+"",L.SOS+"",L.SRD+"",L.SSP+"",L.STD+"",L.SVC+"",L.SYP+"",L.SZL+"",L.THB+"",L.TJS+"",L.TMT+"",L.TND+"",L.TOP+"",L.TRY+"",L.TTD+"",L.TWD+"",L.TZS+"",L.UAH+"",L.UGX+"",L.USD+"",L.USN+"",L.USS+"",L.UYI+"",L.UYU+"",L.UZS+"",L.VEF+"",L.VND+"",L.VUV+"",L.WST+"",L.XAF+"",L.XAG+"",L.XAU+"",L.XBA+"",L.XBB+"",L.XBC+"",L.XBD+"",L.XCD+"",L.XDR+"",L.XFU+"",L.XOF+"",L.XPD+"",L.XPF+"",L.XPT+"",L.XSU+"",L.XTS+"",L.XUA+"",L.YER+"",L.ZAR+"",L.ZMW+"",L.ZWL+"";var Br={exports:{}};Br.exports;(function(s,t){var e=200,i="Expected a function",a="__lodash_hash_undefined__",l=1,u=2,d=1/0,m=9007199254740991,g="[object Arguments]",y="[object Array]",h="[object Boolean]",I="[object Date]",j="[object Error]",J="[object Function]",H="[object GeneratorFunction]",z="[object Map]",ue="[object Number]",de="[object Object]",re="[object Promise]",Te="[object RegExp]",$e="[object Set]",tt="[object String]",at="[object Symbol]",mt="[object WeakMap]",ot="[object ArrayBuffer]",Rt="[object DataView]",Je="[object Float32Array]",Ve="[object Float64Array]",V="[object Int8Array]",se="[object Int16Array]",te="[object Int32Array]",ee="[object Uint8Array]",ne="[object Uint8ClampedArray]",ge="[object Uint16Array]",Re="[object Uint32Array]",Ie=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,We=/^\w*$/,Ge=/^\./,lt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Tt=/[\\^$.*+?()[\]{}|]/g,Ct=/\\(\\)?/g,As=/^\[object .+?Constructor\]$/,mn=/^(?:0|[1-9]\d*)$/,ve={};ve[Je]=ve[Ve]=ve[V]=ve[se]=ve[te]=ve[ee]=ve[ne]=ve[ge]=ve[Re]=!0,ve[g]=ve[y]=ve[ot]=ve[h]=ve[Rt]=ve[I]=ve[j]=ve[J]=ve[z]=ve[ue]=ve[de]=ve[Te]=ve[$e]=ve[tt]=ve[mt]=!1;var zt=typeof yr=="object"&&yr&&yr.Object===Object&&yr,It=typeof self=="object"&&self&&self.Object===Object&&self,Qt=zt||It||Function("return this")(),ds=t&&!t.nodeType&&t,Wn=ds&&!0&&s&&!s.nodeType&&s,Os=Wn&&Wn.exports===ds,Kn=Os&&zt.process,qn=function(){try{return Kn&&Kn.binding("util")}catch{}}(),Wt=qn&&qn.isTypedArray;function Yn(v,O){for(var W=-1,ae=v?v.length:0;++W<ae&&O(v[W],W,v)!==!1;);return v}function yn(v,O){for(var W=-1,ae=v?v.length:0;++W<ae;)if(O(v[W],W,v))return!0;return!1}function st(v){return function(O){return O==null?void 0:O[v]}}function Mt(v,O){for(var W=-1,ae=Array(v);++W<v;)ae[W]=O(W);return ae}function Xn(v){return function(O){return v(O)}}function hs(v,O){return v==null?void 0:v[O]}function Se(v){var O=!1;if(v!=null&&typeof v.toString!="function")try{O=!!(v+"")}catch{}return O}function en(v){var O=-1,W=Array(v.size);return v.forEach(function(ae,Be){W[++O]=[Be,ae]}),W}function E(v,O){return function(W){return v(O(W))}}function T(v){var O=-1,W=Array(v.size);return v.forEach(function(ae){W[++O]=ae}),W}var x=Array.prototype,C=Function.prototype,Z=Object.prototype,M=Qt["__core-js_shared__"],G=function(){var v=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Y=C.toString,Q=Z.hasOwnProperty,fe=Z.toString,Ne=RegExp("^"+Y.call(Q).replace(Tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pe=Qt.Symbol,Ae=Qt.Uint8Array,At=E(Object.getPrototypeOf,Object),xe=Object.create,tn=Z.propertyIsEnumerable,nt=x.splice,Gs=E(Object.keys,Object),Ye=_(Qt,"DataView"),Lt=_(Qt,"Map"),Ln=_(Qt,"Promise"),ps=_(Qt,"Set"),bn=_(Qt,"WeakMap"),kn=_(Object,"create"),Zs=De(Ye),gs=De(Lt),zs=De(Ln),Bn=De(ps),Ni=De(bn),Jn=Pe?Pe.prototype:void 0,Ws=Jn?Jn.valueOf:void 0,On=Jn?Jn.toString:void 0;function En(v){var O=-1,W=v?v.length:0;for(this.clear();++O<W;){var ae=v[O];this.set(ae[0],ae[1])}}function Ks(){this.__data__=kn?kn(null):{}}function Pi(v){return this.has(v)&&delete this.__data__[v]}function bt(v){var O=this.__data__;if(kn){var W=O[v];return W===a?void 0:W}return Q.call(O,v)?O[v]:void 0}function qs(v){var O=this.__data__;return kn?O[v]!==void 0:Q.call(O,v)}function Ys(v,O){var W=this.__data__;return W[v]=kn&&O===void 0?a:O,this}En.prototype.clear=Ks,En.prototype.delete=Pi,En.prototype.get=bt,En.prototype.has=qs,En.prototype.set=Ys;function ct(v){var O=-1,W=v?v.length:0;for(this.clear();++O<W;){var ae=v[O];this.set(ae[0],ae[1])}}function Ot(){this.__data__=[]}function Ci(v){var O=this.__data__,W=dn(O,v);if(W<0)return!1;var ae=O.length-1;return W==ae?O.pop():nt.call(O,W,1),!0}function Xs(v){var O=this.__data__,W=dn(O,v);return W<0?void 0:O[W][1]}function ht(v){return dn(this.__data__,v)>-1}function Js(v,O){var W=this.__data__,ae=dn(W,v);return ae<0?W.push([v,O]):W[ae][1]=O,this}ct.prototype.clear=Ot,ct.prototype.delete=Ci,ct.prototype.get=Xs,ct.prototype.has=ht,ct.prototype.set=Js;function vn(v){var O=-1,W=v?v.length:0;for(this.clear();++O<W;){var ae=v[O];this.set(ae[0],ae[1])}}function Li(){this.__data__={hash:new En,map:new(Lt||ct),string:new En}}function Qs(v){return p(this,v).delete(v)}function $n(v){return p(this,v).get(v)}function ki(v){return p(this,v).has(v)}function ei(v,O){return p(this,v).set(v,O),this}vn.prototype.clear=Li,vn.prototype.delete=Qs,vn.prototype.get=$n,vn.prototype.has=ki,vn.prototype.set=ei;function Qn(v){var O=-1,W=v?v.length:0;for(this.__data__=new vn;++O<W;)this.add(v[O])}function Me(v){return this.__data__.set(v,a),this}function ti(v){return this.__data__.has(v)}Qn.prototype.add=Qn.prototype.push=Me,Qn.prototype.has=ti;function nn(v){this.__data__=new ct(v)}function _n(){this.__data__=new ct}function ni(v){return this.__data__.delete(v)}function si(v){return this.__data__.get(v)}function wn(v){return this.__data__.has(v)}function kt(v,O){var W=this.__data__;if(W instanceof ct){var ae=W.__data__;if(!Lt||ae.length<e-1)return ae.push([v,O]),this;W=this.__data__=new vn(ae)}return W.set(v,O),this}nn.prototype.clear=_n,nn.prototype.delete=ni,nn.prototype.get=si,nn.prototype.has=wn,nn.prototype.set=kt;function Bi(v,O){var W=ms(v)||Nt(v)?Mt(v.length,String):[],ae=W.length,Be=!!ae;for(var Ee in v)Q.call(v,Ee)&&!(Be&&(Ee=="length"||D(Ee,ae)))&&W.push(Ee);return W}function dn(v,O){for(var W=v.length;W--;)if(Ze(v[W][0],O))return W;return-1}function ii(v){return yi(v)?xe(v):{}}var ri=n();function $i(v,O){return v&&ri(v,O,hr)}function es(v,O){O=$(O,v)?[O]:f(O);for(var W=0,ae=O.length;v!=null&&W<ae;)v=v[ye(O[W++])];return W&&W==ae?v:void 0}function sn(v){return fe.call(v)}function rn(v,O){return v!=null&&O in Object(v)}function Ht(v,O,W,ae,Be){return v===O?!0:v==null||O==null||!yi(v)&&!dr(O)?v!==v&&O!==O:Mi(v,O,Ht,W,ae,Be)}function Mi(v,O,W,ae,Be,Ee){var ze=ms(v),xt=ms(O),St=y,Kt=y;ze||(St=w(v),St=St==g?de:St),xt||(Kt=w(O),Kt=Kt==g?de:Kt);var hn=St==de&&!Se(v),pn=Kt==de&&!Se(O),ln=St==Kt;if(ln&&!hn)return Ee||(Ee=new nn),ze||uo(v)?r(v,O,W,ae,Be,Ee):o(v,O,St,W,ae,Be,Ee);if(!(Be&u)){var xn=hn&&Q.call(v,"__wrapped__"),Dn=pn&&Q.call(O,"__wrapped__");if(xn||Dn){var xs=xn?v.value():v,ys=Dn?O.value():O;return Ee||(Ee=new nn),W(xs,ys,ae,Be,Ee)}}return ln?(Ee||(Ee=new nn),c(v,O,W,ae,Be,Ee)):!1}function Ui(v,O,W,ae){var Be=W.length,Ee=Be;if(v==null)return!Ee;for(v=Object(v);Be--;){var ze=W[Be];if(ze[2]?ze[1]!==v[ze[0]]:!(ze[0]in v))return!1}for(;++Be<Ee;){ze=W[Be];var xt=ze[0],St=v[xt],Kt=ze[1];if(ze[2]){if(St===void 0&&!(xt in v))return!1}else{var hn=new nn,pn;if(!(pn===void 0?Ht(Kt,St,ae,l|u,hn):pn))return!1}}return!0}function Fi(v){if(!yi(v)||X(v))return!1;var O=ta(v)||Se(v)?Ne:As;return O.test(De(v))}function Et(v){return dr(v)&&na(v.length)&&!!ve[fe.call(v)]}function pt(v){return typeof v=="function"?v:v==null?Fc:typeof v=="object"?ms(v)?an(v[0],v[1]):Tn(v):Vc(v)}function Bt(v){if(!K(v))return Gs(v);var O=[];for(var W in Object(v))Q.call(v,W)&&W!="constructor"&&O.push(W);return O}function Tn(v){var O=b(v);return O.length==1&&O[0][2]?N(O[0][0],O[0][1]):function(W){return W===v||Ui(W,v,O)}}function an(v,O){return $(v)&&U(O)?N(ye(v),O):function(W){var ae=$c(W,v);return ae===void 0&&ae===O?Mc(W,v):Ht(O,ae,void 0,l|u)}}function on(v){return function(O){return es(O,v)}}function Mn(v){if(typeof v=="string")return v;if(sa(v))return On?On.call(v):"";var O=v+"";return O=="0"&&1/v==-d?"-0":O}function f(v){return ms(v)?v:q(v)}function n(v){return function(O,W,ae){for(var Be=-1,Ee=Object(O),ze=ae(O),xt=ze.length;xt--;){var St=ze[++Be];if(W(Ee[St],St,Ee)===!1)break}return O}}function r(v,O,W,ae,Be,Ee){var ze=Be&u,xt=v.length,St=O.length;if(xt!=St&&!(ze&&St>xt))return!1;var Kt=Ee.get(v);if(Kt&&Ee.get(O))return Kt==O;var hn=-1,pn=!0,ln=Be&l?new Qn:void 0;for(Ee.set(v,O),Ee.set(O,v);++hn<xt;){var xn=v[hn],Dn=O[hn];if(ae)var xs=ze?ae(Dn,xn,hn,O,v,Ee):ae(xn,Dn,hn,v,O,Ee);if(xs!==void 0){if(xs)continue;pn=!1;break}if(ln){if(!yn(O,function(ys,ai){if(!ln.has(ai)&&(xn===ys||W(xn,ys,ae,Be,Ee)))return ln.add(ai)})){pn=!1;break}}else if(!(xn===Dn||W(xn,Dn,ae,Be,Ee))){pn=!1;break}}return Ee.delete(v),Ee.delete(O),pn}function o(v,O,W,ae,Be,Ee,ze){switch(W){case Rt:if(v.byteLength!=O.byteLength||v.byteOffset!=O.byteOffset)return!1;v=v.buffer,O=O.buffer;case ot:return!(v.byteLength!=O.byteLength||!ae(new Ae(v),new Ae(O)));case h:case I:case ue:return Ze(+v,+O);case j:return v.name==O.name&&v.message==O.message;case Te:case tt:return v==O+"";case z:var xt=en;case $e:var St=Ee&u;if(xt||(xt=T),v.size!=O.size&&!St)return!1;var Kt=ze.get(v);if(Kt)return Kt==O;Ee|=l,ze.set(v,O);var hn=r(xt(v),xt(O),ae,Be,Ee,ze);return ze.delete(v),hn;case at:if(Ws)return Ws.call(v)==Ws.call(O)}return!1}function c(v,O,W,ae,Be,Ee){var ze=Be&u,xt=hr(v),St=xt.length,Kt=hr(O),hn=Kt.length;if(St!=hn&&!ze)return!1;for(var pn=St;pn--;){var ln=xt[pn];if(!(ze?ln in O:Q.call(O,ln)))return!1}var xn=Ee.get(v);if(xn&&Ee.get(O))return xn==O;var Dn=!0;Ee.set(v,O),Ee.set(O,v);for(var xs=ze;++pn<St;){ln=xt[pn];var ys=v[ln],ai=O[ln];if(ae)var ho=ze?ae(ai,ys,ln,O,v,Ee):ae(ys,ai,ln,v,O,Ee);if(!(ho===void 0?ys===ai||W(ys,ai,ae,Be,Ee):ho)){Dn=!1;break}xs||(xs=ln=="constructor")}if(Dn&&!xs){var pr=v.constructor,gr=O.constructor;pr!=gr&&"constructor"in v&&"constructor"in O&&!(typeof pr=="function"&&pr instanceof pr&&typeof gr=="function"&&gr instanceof gr)&&(Dn=!1)}return Ee.delete(v),Ee.delete(O),Dn}function p(v,O){var W=v.__data__;return R(O)?W[typeof O=="string"?"string":"hash"]:W.map}function b(v){for(var O=hr(v),W=O.length;W--;){var ae=O[W],Be=v[ae];O[W]=[ae,Be,U(Be)]}return O}function _(v,O){var W=hs(v,O);return Fi(W)?W:void 0}var w=sn;(Ye&&w(new Ye(new ArrayBuffer(1)))!=Rt||Lt&&w(new Lt)!=z||Ln&&w(Ln.resolve())!=re||ps&&w(new ps)!=$e||bn&&w(new bn)!=mt)&&(w=function(v){var O=fe.call(v),W=O==de?v.constructor:void 0,ae=W?De(W):void 0;if(ae)switch(ae){case Zs:return Rt;case gs:return z;case zs:return re;case Bn:return $e;case Ni:return mt}return O});function A(v,O,W){O=$(O,v)?[O]:f(O);for(var ae,Be=-1,ze=O.length;++Be<ze;){var Ee=ye(O[Be]);if(!(ae=v!=null&&W(v,Ee)))break;v=v[Ee]}if(ae)return ae;var ze=v?v.length:0;return!!ze&&na(ze)&&D(Ee,ze)&&(ms(v)||Nt(v))}function D(v,O){return O=O??m,!!O&&(typeof v=="number"||mn.test(v))&&v>-1&&v%1==0&&v<O}function $(v,O){if(ms(v))return!1;var W=typeof v;return W=="number"||W=="symbol"||W=="boolean"||v==null||sa(v)?!0:We.test(v)||!Ie.test(v)||O!=null&&v in Object(O)}function R(v){var O=typeof v;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?v!=="__proto__":v===null}function X(v){return!!G&&G in v}function K(v){var O=v&&v.constructor,W=typeof O=="function"&&O.prototype||Z;return v===W}function U(v){return v===v&&!yi(v)}function N(v,O){return function(W){return W==null?!1:W[v]===O&&(O!==void 0||v in Object(W))}}var q=Ke(function(v){v=Bc(v);var O=[];return Ge.test(v)&&O.push(""),v.replace(lt,function(W,ae,Be,Ee){O.push(Be?Ee.replace(Ct,"$1"):ae||W)}),O});function ye(v){if(typeof v=="string"||sa(v))return v;var O=v+"";return O=="0"&&1/v==-d?"-0":O}function De(v){if(v!=null){try{return Y.call(v)}catch{}try{return v+""}catch{}}return""}function Ke(v,O){if(typeof v!="function"||O&&typeof O!="function")throw new TypeError(i);var W=function(){var ae=arguments,Be=O?O.apply(this,ae):ae[0],Ee=W.cache;if(Ee.has(Be))return Ee.get(Be);var ze=v.apply(this,ae);return W.cache=Ee.set(Be,ze),ze};return W.cache=new(Ke.Cache||vn),W}Ke.Cache=vn;function Ze(v,O){return v===O||v!==v&&O!==O}function Nt(v){return kc(v)&&Q.call(v,"callee")&&(!tn.call(v,"callee")||fe.call(v)==g)}var ms=Array.isArray;function fo(v){return v!=null&&na(v.length)&&!ta(v)}function kc(v){return dr(v)&&fo(v)}function ta(v){var O=yi(v)?fe.call(v):"";return O==J||O==H}function na(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=m}function yi(v){var O=typeof v;return!!v&&(O=="object"||O=="function")}function dr(v){return!!v&&typeof v=="object"}function sa(v){return typeof v=="symbol"||dr(v)&&fe.call(v)==at}var uo=Wt?Xn(Wt):Et;function Bc(v){return v==null?"":Mn(v)}function $c(v,O,W){var ae=v==null?void 0:es(v,O);return ae===void 0?W:ae}function Mc(v,O){return v!=null&&A(v,O,rn)}function hr(v){return fo(v)?Bi(v):Bt(v)}function Uc(v,O,W){var ae=ms(v)||uo(v);if(O=pt(O),W==null)if(ae||yi(v)){var Be=v.constructor;ae?W=ms(v)?new Be:[]:W=ta(Be)?ii(At(v)):{}}else W={};return(ae?Yn:$i)(v,function(Ee,ze,xt){return O(W,Ee,ze,xt)}),W}function Fc(v){return v}function Vc(v){return $(v)?st(ye(v)):on(v)}s.exports=Uc})(Br,Br.exports);var Cd=Br.exports,Ld=Ba(Cd);class $l{constructor(t,e,i){this.platform=_s.DESKTOP,this.instanceId="123456789012345678",this.configuration=Rl(),this.source=null,this.sourceOrigin="",this.frameId="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",this.eventBus=new Ko,this.clientId=t,this.commands=this._updateCommandMocks({}),this.guildId=e,this.channelId=i}_updateCommandMocks(t){return this.commands=Ld(Object.assign({},kd,t),(e,i,a)=>{e[a]=async(...l)=>(console.info(`DiscordSDKMock: ${String(a)}(${JSON.stringify(l)})`),await i(...l))}),this.commands}emitReady(){this.emitEvent("READY",void 0)}close(...t){console.info(`DiscordSDKMock: close(${JSON.stringify(t)})`)}ready(){return Promise.resolve()}async subscribe(t,e,...i){return await this.eventBus.on(t,e)}async unsubscribe(t,e,...i){return await this.eventBus.off(t,e)}emitEvent(t,e){this.eventBus.emit(t,e)}}const kd={authorize:()=>Promise.resolve({code:"mock_code"}),authenticate:()=>Promise.resolve({access_token:"mock_token",user:{username:"mock_user_username",discriminator:"mock_user_discriminator",id:"mock_user_id",avatar:null,public_flags:1},scopes:[],expires:new Date(2121,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}}),setActivity:()=>Promise.resolve({name:"mock_activity_name",type:0}),getChannel:()=>Promise.resolve({id:"mock_channel_id",name:"mock_channel_name",type:Ga.GUILD_TEXT,voice_states:[],messages:[]}),getSkus:()=>Promise.resolve({skus:[]}),getEntitlements:()=>Promise.resolve({entitlements:[]}),startPurchase:()=>Promise.resolve([]),setConfig:()=>Promise.resolve({use_interactive_pip:!1}),userSettingsGetLocale:()=>Promise.resolve({locale:""}),openExternalLink:()=>Promise.resolve(null),encourageHardwareAcceleration:()=>Promise.resolve({enabled:!0}),captureLog:()=>Promise.resolve(null),setOrientationLockState:()=>Promise.resolve(null),openInviteDialog:()=>Promise.resolve(null),getPlatformBehaviors:()=>Promise.resolve({iosKeyboardResizesView:!0}),getChannelPermissions:()=>Promise.resolve({permissions:rl(1234567890)}),openShareMomentDialog:()=>Promise.resolve(null),initiateImageUpload:()=>Promise.resolve({image_url:"https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0b52aa9e99b832574a53_full_logo_blurple_RGB.png"}),getInstanceConnectedParticipants:()=>Promise.resolve({participants:[]})};var Hn={};ArrayBuffer.isView||(ArrayBuffer.isView=s=>s!==null&&typeof s=="object"&&s.buffer instanceof ArrayBuffer);typeof FormData>"u"&&(La.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var Ka={},Aa=function(s,t){return Aa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},Aa(s,t)};function Ml(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Aa(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var $r=function(){return $r=Object.assign||function(t){for(var e,i=1,a=arguments.length;i<a;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(t[l]=e[l])}return t},$r.apply(this,arguments)};function Ul(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(s);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(s,i[a])&&(e[i[a]]=s[i[a]]);return e}function Fl(s,t,e,i){var a=arguments.length,l=a<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(s,t,e,i);else for(var d=s.length-1;d>=0;d--)(u=s[d])&&(l=(a<3?u(l):a>3?u(t,e,l):u(t,e))||l);return a>3&&l&&Object.defineProperty(t,e,l),l}function Vl(s,t){return function(e,i){t(e,i,s)}}function Bd(s,t,e,i,a,l){function u(ue){if(ue!==void 0&&typeof ue!="function")throw new TypeError("Function expected");return ue}for(var d=i.kind,m=d==="getter"?"get":d==="setter"?"set":"value",g=!t&&s?i.static?s:s.prototype:null,y=t||(g?Object.getOwnPropertyDescriptor(g,i.name):{}),h,I=!1,j=e.length-1;j>=0;j--){var J={};for(var H in i)J[H]=H==="access"?{}:i[H];for(var H in i.access)J.access[H]=i.access[H];J.addInitializer=function(ue){if(I)throw new TypeError("Cannot add initializers after decoration has completed");l.push(u(ue||null))};var z=(0,e[j])(d==="accessor"?{get:y.get,set:y.set}:y[m],J);if(d==="accessor"){if(z===void 0)continue;if(z===null||typeof z!="object")throw new TypeError("Object expected");(h=u(z.get))&&(y.get=h),(h=u(z.set))&&(y.set=h),(h=u(z.init))&&a.unshift(h)}else(h=u(z))&&(d==="field"?a.unshift(h):y[m]=h)}g&&Object.defineProperty(g,i.name,y),I=!0}function $d(s,t,e){for(var i=arguments.length>2,a=0;a<t.length;a++)e=i?t[a].call(s,e):t[a].call(s);return i?e:void 0}function Md(s){return typeof s=="symbol"?s:"".concat(s)}function Ud(s,t,e){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:e?"".concat(e," ",t):t})}function jl(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)}function Hl(s,t,e,i){function a(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function d(y){try{g(i.next(y))}catch(h){u(h)}}function m(y){try{g(i.throw(y))}catch(h){u(h)}}function g(y){y.done?l(y.value):a(y.value).then(d,m)}g((i=i.apply(s,t||[])).next())})}function Gl(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},i,a,l,u;return u={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function d(g){return function(y){return m([g,y])}}function m(g){if(i)throw new TypeError("Generator is already executing.");for(;u&&(u=0,g[0]&&(e=0)),e;)try{if(i=1,a&&(l=g[0]&2?a.return:g[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,g[1])).done)return l;switch(a=0,l&&(g=[g[0]&2,l.value]),g[0]){case 0:case 1:l=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!l||g[1]>l[0]&&g[1]<l[3])){e.label=g[1];break}if(g[0]===6&&e.label<l[1]){e.label=l[1],l=g;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(g);break}l[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(s,e)}catch(y){g=[6,y],a=0}finally{i=l=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}var Gr=Object.create?function(s,t,e,i){i===void 0&&(i=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(s,i,a)}:function(s,t,e,i){i===void 0&&(i=e),s[i]=t[e]};function Zl(s,t){for(var e in s)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&Gr(t,s,e)}function Mr(s){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&s[t],i=0;if(e)return e.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function qa(s,t){var e=typeof Symbol=="function"&&s[Symbol.iterator];if(!e)return s;var i=e.call(s),a,l=[],u;try{for(;(t===void 0||t-- >0)&&!(a=i.next()).done;)l.push(a.value)}catch(d){u={error:d}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(u)throw u.error}}return l}function zl(){for(var s=[],t=0;t<arguments.length;t++)s=s.concat(qa(arguments[t]));return s}function Wl(){for(var s=0,t=0,e=arguments.length;t<e;t++)s+=arguments[t].length;for(var i=Array(s),a=0,t=0;t<e;t++)for(var l=arguments[t],u=0,d=l.length;u<d;u++,a++)i[a]=l[u];return i}function Kl(s,t,e){if(e||arguments.length===2)for(var i=0,a=t.length,l;i<a;i++)(l||!(i in t))&&(l||(l=Array.prototype.slice.call(t,0,i)),l[i]=t[i]);return s.concat(l||Array.prototype.slice.call(t))}function Ai(s){return this instanceof Ai?(this.v=s,this):new Ai(s)}function ql(s,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(s,t||[]),a,l=[];return a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a;function u(I){i[I]&&(a[I]=function(j){return new Promise(function(J,H){l.push([I,j,J,H])>1||d(I,j)})})}function d(I,j){try{m(i[I](j))}catch(J){h(l[0][3],J)}}function m(I){I.value instanceof Ai?Promise.resolve(I.value.v).then(g,y):h(l[0][2],I)}function g(I){d("next",I)}function y(I){d("throw",I)}function h(I,j){I(j),l.shift(),l.length&&d(l[0][0],l[0][1])}}function Yl(s){var t,e;return t={},i("next"),i("throw",function(a){throw a}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(a,l){t[a]=s[a]?function(u){return(e=!e)?{value:Ai(s[a](u)),done:!1}:l?l(u):u}:l}}function Xl(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],e;return t?t.call(s):(s=typeof Mr=="function"?Mr(s):s[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(l){e[l]=s[l]&&function(u){return new Promise(function(d,m){u=s[l](u),a(d,m,u.done,u.value)})}}function a(l,u,d,m){Promise.resolve(m).then(function(g){l({value:g,done:d})},u)}}function Jl(s,t){return Object.defineProperty?Object.defineProperty(s,"raw",{value:t}):s.raw=t,s}var Fd=Object.create?function(s,t){Object.defineProperty(s,"default",{enumerable:!0,value:t})}:function(s,t){s.default=t};function Ql(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var e in s)e!=="default"&&Object.prototype.hasOwnProperty.call(s,e)&&Gr(t,s,e);return Fd(t,s),t}function ec(s){return s&&s.__esModule?s:{default:s}}function tc(s,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(s):i?i.value:t.get(s)}function nc(s,t,e,i,a){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!a:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?a.call(s,e):a?a.value=e:t.set(s,e),e}function sc(s,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof s=="function"?t===s:s.has(t)}function ic(s,t,e){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var i;if(e){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose]}if(typeof i!="function")throw new TypeError("Object not disposable.");s.stack.push({value:t,dispose:i,async:e})}else e&&s.stack.push({async:!0});return t}var Vd=typeof SuppressedError=="function"?SuppressedError:function(s,t,e){var i=new Error(e);return i.name="SuppressedError",i.error=s,i.suppressed=t,i};function rc(s){function t(i){s.error=s.hasError?new Vd(i,s.error,"An error was suppressed during disposal."):i,s.hasError=!0}function e(){for(;s.stack.length;){var i=s.stack.pop();try{var a=i.dispose&&i.dispose.call(i.value);if(i.async)return Promise.resolve(a).then(e,function(l){return t(l),e()})}catch(l){t(l)}}if(s.hasError)throw s.error}return e()}const jd={__extends:Ml,__assign:$r,__rest:Ul,__decorate:Fl,__param:Vl,__metadata:jl,__awaiter:Hl,__generator:Gl,__createBinding:Gr,__exportStar:Zl,__values:Mr,__read:qa,__spread:zl,__spreadArrays:Wl,__spreadArray:Kl,__await:Ai,__asyncGenerator:ql,__asyncDelegator:Yl,__asyncValues:Xl,__makeTemplateObject:Jl,__importStar:Ql,__importDefault:ec,__classPrivateFieldGet:tc,__classPrivateFieldSet:nc,__classPrivateFieldIn:sc,__addDisposableResource:ic,__disposeResources:rc},Hd=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:ic,get __assign(){return $r},__asyncDelegator:Yl,__asyncGenerator:ql,__asyncValues:Xl,__await:Ai,__awaiter:Hl,__classPrivateFieldGet:tc,__classPrivateFieldIn:sc,__classPrivateFieldSet:nc,__createBinding:Gr,__decorate:Fl,__disposeResources:rc,__esDecorate:Bd,__exportStar:Zl,__extends:Ml,__generator:Gl,__importDefault:ec,__importStar:Ql,__makeTemplateObject:Jl,__metadata:jl,__param:Vl,__propKey:Md,__read:qa,__rest:Ul,__runInitializers:$d,__setFunctionName:Ud,__spread:zl,__spreadArray:Kl,__spreadArrays:Wl,__values:Mr,default:jd},Symbol.toStringTag,{value:"Module"})),Zr=ka(Hd);var cr={};(function(s){s.CloseCode=void 0,function(e){e[e.CONSENTED=4e3]="CONSENTED",e[e.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(s.CloseCode||(s.CloseCode={}));class t extends Error{constructor(i,a){super(a),this.name="ServerError",this.code=i}}s.ServerError=t})(cr);var Ya={},ac={},oc={},Oa={exports:{}};(function(s,t){(function(e,i){i(t)})(La,function(e){e.OPERATION=void 0,function(f){f[f.ADD=128]="ADD",f[f.REPLACE=0]="REPLACE",f[f.DELETE=64]="DELETE",f[f.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",f[f.MOVE_AND_ADD=160]="MOVE_AND_ADD",f[f.DELETE_AND_ADD=192]="DELETE_AND_ADD",f[f.CLEAR=10]="CLEAR",f[f.REVERSE=15]="REVERSE",f[f.MOVE=32]="MOVE",f[f.DELETE_BY_REFID=33]="DELETE_BY_REFID",f[f.ADD_BY_REFID=129]="ADD_BY_REFID"}(e.OPERATION||(e.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const l=Symbol("$track"),u=Symbol("$encoder"),d=Symbol("$decoder"),m=Symbol("$filter"),g=Symbol("$getByIndex"),y=Symbol("$deleteByIndex"),h=Symbol("$changes"),I=Symbol("$childType"),j=Symbol("$onEncodeEnd"),J=Symbol("$onDecodeEnd"),H=Symbol("$descriptors"),z="$__numFields",ue="$__refTypeFieldIndexes",de="$__viewFieldIndexes",re="$__fieldIndexesByViewTag";let Te;try{Te=new TextEncoder}catch{}const $e=new ArrayBuffer(8),tt=new Int32Array($e),at=new Float32Array($e),mt=new Float64Array($e),ot=new BigInt64Array($e),Je=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(f,n){for(var r=0,o=0,c=0,p=f.length;c<p;c++)r=f.charCodeAt(c),r<128?o+=1:r<2048?o+=2:r<55296||r>=57344?o+=3:(c++,o+=4);return o};function Ve(f,n,r){for(var o=0,c=0,p=n.length;c<p;c++)o=n.charCodeAt(c),o<128?f[r.offset++]=o:o<2048?(f[r.offset]=192|o>>6,f[r.offset+1]=128|o&63,r.offset+=2):o<55296||o>=57344?(f[r.offset]=224|o>>12,f[r.offset+1]=128|o>>6&63,f[r.offset+2]=128|o&63,r.offset+=3):(c++,o=65536+((o&1023)<<10|n.charCodeAt(c)&1023),f[r.offset]=240|o>>18,f[r.offset+1]=128|o>>12&63,f[r.offset+2]=128|o>>6&63,f[r.offset+3]=128|o&63,r.offset+=4)}function V(f,n,r){f[r.offset++]=n&255}function se(f,n,r){f[r.offset++]=n&255}function te(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255}function ee(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255}function ne(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255,f[r.offset++]=n>>16&255,f[r.offset++]=n>>24&255}function ge(f,n,r){const o=n>>24,c=n>>16,p=n>>8,b=n;f[r.offset++]=b&255,f[r.offset++]=p&255,f[r.offset++]=c&255,f[r.offset++]=o&255}function Re(f,n,r){const o=Math.floor(n/Math.pow(2,32)),c=n>>>0;ge(f,c,r),ge(f,o,r)}function Ie(f,n,r){const o=n/Math.pow(2,32)>>0,c=n>>>0;ge(f,c,r),ge(f,o,r)}function We(f,n,r){ot[0]=BigInt.asIntN(64,n),ne(f,tt[0],r),ne(f,tt[1],r)}function Ge(f,n,r){ot[0]=BigInt.asIntN(64,n),ne(f,tt[0],r),ne(f,tt[1],r)}function lt(f,n,r){at[0]=n,ne(f,tt[0],r)}function Tt(f,n,r){mt[0]=n,ne(f,tt[0],r),ne(f,tt[1],r)}function Ct(f,n,r){f[r.offset++]=n?1:0}function As(f,n,r){n||(n="");let o=Je(n,"utf8"),c=0;if(o<32)f[r.offset++]=o|160,c=1;else if(o<256)f[r.offset++]=217,f[r.offset++]=o%255,c=2;else if(o<65536)f[r.offset++]=218,ee(f,o,r),c=3;else if(o<4294967296)f[r.offset++]=219,ge(f,o,r),c=5;else throw new Error("String too long");return Ve(f,n,r),c+o}function mn(f,n,r){if(isNaN(n))return mn(f,0,r);if(isFinite(n)){if(n!==(n|0))return Math.abs(n)<=34028235e31&&(at[0]=n,Math.abs(Math.abs(at[0])-Math.abs(n))<1e-4)?(f[r.offset++]=202,lt(f,n,r),5):(f[r.offset++]=203,Tt(f,n,r),9)}else return mn(f,n>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,r);return n>=0?n<128?(f[r.offset++]=n&255,1):n<256?(f[r.offset++]=204,f[r.offset++]=n&255,2):n<65536?(f[r.offset++]=205,ee(f,n,r),3):n<4294967296?(f[r.offset++]=206,ge(f,n,r),5):(f[r.offset++]=207,Ie(f,n,r),9):n>=-32?(f[r.offset++]=224|n+32,1):n>=-128?(f[r.offset++]=208,V(f,n,r),2):n>=-32768?(f[r.offset++]=209,te(f,n,r),3):n>=-2147483648?(f[r.offset++]=210,ne(f,n,r),5):(f[r.offset++]=211,Re(f,n,r),9)}const ve={int8:V,uint8:se,int16:te,uint16:ee,int32:ne,uint32:ge,int64:Re,uint64:Ie,bigint64:We,biguint64:Ge,float32:lt,float64:Tt,boolean:Ct,string:As,number:mn,utf8Write:Ve,utf8Length:Je},zt=new ArrayBuffer(8),It=new Int32Array(zt),Qt=new Float32Array(zt),ds=new Float64Array(zt),Wn=new BigUint64Array(zt),Os=new BigInt64Array(zt);function Kn(f,n,r){for(var o="",c=0,p=n.offset,b=n.offset+r;p<b;p++){var _=f[p];if(!(_&128)){o+=String.fromCharCode(_);continue}if((_&224)===192){o+=String.fromCharCode((_&31)<<6|f[++p]&63);continue}if((_&240)===224){o+=String.fromCharCode((_&15)<<12|(f[++p]&63)<<6|(f[++p]&63)<<0);continue}if((_&248)===240){c=(_&7)<<18|(f[++p]&63)<<12|(f[++p]&63)<<6|(f[++p]&63)<<0,c>=65536?(c-=65536,o+=String.fromCharCode((c>>>10)+55296,(c&1023)+56320)):o+=String.fromCharCode(c);continue}console.error("Invalid byte "+_.toString(16))}return n.offset+=r,o}function qn(f,n){return Wt(f,n)<<24>>24}function Wt(f,n){return f[n.offset++]}function Yn(f,n){return yn(f,n)<<16>>16}function yn(f,n){return f[n.offset++]|f[n.offset++]<<8}function st(f,n){return f[n.offset++]|f[n.offset++]<<8|f[n.offset++]<<16|f[n.offset++]<<24}function Mt(f,n){return st(f,n)>>>0}function Xn(f,n){return It[0]=st(f,n),Qt[0]}function hs(f,n){return It[0]=st(f,n),It[1]=st(f,n),ds[0]}function Se(f,n){const r=Mt(f,n);return st(f,n)*Math.pow(2,32)+r}function en(f,n){const r=Mt(f,n);return Mt(f,n)*Math.pow(2,32)+r}function E(f,n){return It[0]=st(f,n),It[1]=st(f,n),Os[0]}function T(f,n){return It[0]=st(f,n),It[1]=st(f,n),Wn[0]}function x(f,n){return Wt(f,n)>0}function C(f,n){const r=f[n.offset++];let o;return r<192?o=r&31:r===217?o=Wt(f,n):r===218?o=yn(f,n):r===219&&(o=Mt(f,n)),Kn(f,n,o)}function Z(f,n){const r=f[n.offset++];if(r<128)return r;if(r===202)return Xn(f,n);if(r===203)return hs(f,n);if(r===204)return Wt(f,n);if(r===205)return yn(f,n);if(r===206)return Mt(f,n);if(r===207)return en(f,n);if(r===208)return qn(f,n);if(r===209)return Yn(f,n);if(r===210)return st(f,n);if(r===211)return Se(f,n);if(r>223)return(255-r+1)*-1}function M(f,n){const r=f[n.offset];return r<192&&r>160||r===217||r===218||r===219}const G={utf8Read:Kn,int8:qn,uint8:Wt,int16:Yn,uint16:yn,int32:st,uint32:Mt,float32:Xn,float64:hs,int64:Se,uint64:en,bigint64:E,biguint64:T,boolean:x,string:C,number:Z,stringCheck:M},Y={},Q=new Map;function fe(f,n){n.constructor&&(Q.set(n.constructor,f),Y[f]=n),n.encode&&(ve[f]=n.encode),n.decode&&(G[f]=n.decode)}function Ne(f){return Y[f]}function Pe(f){for(const n in f)fe(n,f[n]);return n=>ht(n)}const Et=class Et{static register(n){const r=Object.getPrototypeOf(n);if(r!==Me){let o=Et.inheritedTypes.get(r);o||(o=new Set,Et.inheritedTypes.set(r,o)),o.add(n)}}static cache(n){let r=Et.cachedContexts.get(n);return r||(r=new Et(n),Et.cachedContexts.set(n,r)),r}constructor(n){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},n&&this.discoverTypes(n)}has(n){return this.schemas.has(n)}get(n){return this.types[n]}add(n,r=this.schemas.size){return this.schemas.has(n)?!1:(this.types[r]=n,n[Symbol.metadata]===void 0&&xe.initialize(n),this.schemas.set(n,r),!0)}getTypeId(n){return this.schemas.get(n)}discoverTypes(n,r,o,c){var _,w;if(c&&this.registerFilteredByParent(n,r,o),!this.add(n))return;(_=Et.inheritedTypes.get(n))==null||_.forEach(A=>{this.discoverTypes(A,r,o,c)});let p=n;for(;(p=Object.getPrototypeOf(p))&&p!==Me&&p!==Function.prototype;)this.discoverTypes(p);const b=n[w=Symbol.metadata]??(n[w]={});b[de]&&(this.hasFilters=!0);for(const A in b){const D=A,$=b[D].type,R=b[D].tag!==void 0;if(typeof $!="string")if(Array.isArray($)){const X=$[0];if(X==="string")continue;this.discoverTypes(X,n,D,c||R)}else if(typeof $=="function")this.discoverTypes($,n,D,c||R);else{const X=Object.values($)[0];if(typeof X=="string")continue;this.discoverTypes(X,n,D,c||R)}}}registerFilteredByParent(n,r,o){let p=`${this.schemas.get(n)??this.schemas.size}`;r&&(p+=`-${this.schemas.get(r)}`),p+=`-${o}`,this.parentFiltered[p]=!0}debug(){let n="";for(const r in this.parentFiltered){const o=r.split("-").map(Number),c=o.pop();n+=`
		`,n+=`${r}: ${o.reverse().map((p,b)=>{const _=this.types[p],w=_[Symbol.metadata];let A=_.name;return b===0&&(A+=`[${w[c].name}]`),`${A}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${n}`}};Et.inheritedTypes=new Map,Et.cachedContexts=new Map;let Ae=Et;function At(f){return Array.isArray(f)?{array:f[0]}:typeof f.type<"u"?f.type:f}const xe={addField(f,n,r,o,c){if(n>64)throw new Error(`Can't define field '${r}'.
Schema instances may only have up to 64 fields.`);f[n]=Object.assign(f[n]||{},{type:At(o),index:n,name:r}),Object.defineProperty(f,H,{value:f[H]||{},enumerable:!1,configurable:!0}),c?(f[H][r]=c,f[H][`_${r}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):f[H][r]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(f,z,{value:n,enumerable:!1,configurable:!0}),Object.defineProperty(f,r,{value:n,enumerable:!1,configurable:!0}),typeof f[n].type!="string"&&(f[ue]===void 0&&Object.defineProperty(f,ue,{value:[],enumerable:!1,configurable:!0}),f[ue].push(n))},setTag(f,n,r){const o=f[n],c=f[o];c.tag=r,f[de]||(Object.defineProperty(f,de,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(f,re,{value:{},enumerable:!1,configurable:!0})),f[de].push(o),f[re][r]||(f[re][r]=[]),f[re][r].push(o)},setFields(f,n){const r=f.prototype.constructor;Ae.register(r);const o=Object.getPrototypeOf(r),c=o&&o[Symbol.metadata],p=xe.initialize(r);r[l]||(r[l]=Me[l]),r[u]||(r[u]=Me[u]),r[d]||(r[d]=Me[d]),r.prototype.toJSON||(r.prototype.toJSON=Me.prototype.toJSON);let b=p[z]??(c&&c[z])??-1;b++;for(const _ in n){const w=n[_],A=Array.isArray(w)?Ne("array"):typeof Object.keys(w)[0]=="string"&&Ne(Object.keys(w)[0]),D=A?Object.values(w)[0]:At(w);xe.addField(p,b,_,w,Js(`_${_}`,b,D,A)),b++}return f},isDeprecated(f,n){return f[n].deprecated===!0},init(f){const n={};f[Symbol.metadata]=n,Object.defineProperty(n,z,{value:0,enumerable:!1,configurable:!0})},initialize(f){const n=Object.getPrototypeOf(f),r=n[Symbol.metadata];let o=f[Symbol.metadata]??Object.create(null);return n!==Me&&o===r&&(o=Object.create(null),r&&(Object.setPrototypeOf(o,r),Object.defineProperty(o,z,{value:r[z],enumerable:!1,configurable:!0,writable:!0}),r[de]!==void 0&&(Object.defineProperty(o,de,{value:[...r[de]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,re,{value:{...r[re]},enumerable:!1,configurable:!0,writable:!0})),r[ue]!==void 0&&Object.defineProperty(o,ue,{value:[...r[ue]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,H,{value:{...r[H]},enumerable:!1,configurable:!0,writable:!0}))),f[Symbol.metadata]=o,o},isValidInstance(f){return f.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(f.constructor[Symbol.metadata],z)},getFields(f){const n=f[Symbol.metadata],r={};for(let o=0;o<=n[z];o++)r[n[o].name]=n[o].type;return r},hasViewTagAtIndex(f,n){var r;return(r=f==null?void 0:f[de])==null?void 0:r.includes(n)}};function tn(){return{indexes:{},operations:[]}}function nt(f,n){const r=f.indexes[n];r===void 0?f.indexes[n]=f.operations.push(n)-1:f.operations[r]=n}function Gs(f,n){var o;let r=f.indexes[n];r===void 0&&(r=Object.values(f.indexes).at(-1),n=(o=Object.entries(f.indexes).find(([c,p])=>p===r))==null?void 0:o[0]),f.operations[r]=void 0,delete f.indexes[n]}function Ye(f,n,r,o=n[r].queueRootIndex){if(f)f[r][o]!==n&&(n[r].queueRootIndex=f[r].push(n)-1);else return}class Lt{constructor(n){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=n;const r=n.constructor[Symbol.metadata];r!=null&&r[de]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(n){var o;this.root=n,this.checkIsFiltered(this.parent,this.parentIndex);const r=this.ref.constructor[Symbol.metadata];r?(o=r[ue])==null||o.forEach(c=>{const p=r[c],b=this.ref[p.name];b==null||b[h].setRoot(n)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((c,p)=>{c[h].setRoot(n)})}setParent(n,r,o){var p;if(this.parent=n,this.parentIndex=o,!r)return;r!==this.root?(this.root=r,this.checkIsFiltered(n,o)):r.add(this);const c=this.ref.constructor[Symbol.metadata];c?(p=c[ue])==null||p.forEach(b=>{const _=c[b],w=this.ref[_.name];w==null||w[h].setParent(this.ref,r,b)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((b,_)=>{b[h].setParent(this.ref,r,this.indexes[_]??_)})}forEachChild(n){var o;const r=this.ref.constructor[Symbol.metadata];r?(o=r[ue])==null||o.forEach(c=>{const p=r[c],b=this.ref[p.name];b&&n(b[h],c)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((c,p)=>{n(c[h],this.indexes[p]??p)})}operation(n){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-n),Ye(this.root,this,"filteredChanges")):(this.changes.operations.push(-n),Ye(this.root,this,"changes"))}change(n,r=e.OPERATION.ADD){var _;const o=this.ref.constructor[Symbol.metadata],c=this.isFiltered||((_=o==null?void 0:o[n])==null?void 0:_.tag)!==void 0,p=c?this.filteredChanges:this.changes,b=this.indexedOperations[n];if(!b||b===e.OPERATION.DELETE){const w=b&&b===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:r;this.indexedOperations[n]=w}nt(p,n),c?(nt(this.allFilteredChanges,n),this.root&&(Ye(this.root,this,"filteredChanges"),Ye(this.root,this,"allFilteredChanges"))):(nt(this.allChanges,n),Ye(this.root,this,"changes"))}shiftChangeIndexes(n){const r=this.isFiltered?this.filteredChanges:this.changes,o={},c={};for(const p in this.indexedOperations)o[Number(p)+n]=this.indexedOperations[p],c[Number(p)+n]=r.indexes[p];this.indexedOperations=o,r.indexes=c,r.operations=r.operations.map(p=>p+n)}shiftAllChangeIndexes(n,r=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(n,r,this.allFilteredChanges),this._shiftAllChangeIndexes(n,r,this.allChanges)):this._shiftAllChangeIndexes(n,r,this.allChanges)}_shiftAllChangeIndexes(n,r=0,o){const c={};let p=0;for(const b in o.indexes)c[p++]=o.indexes[b];o.indexes=c;for(let b=0;b<o.operations.length;b++){const _=o.operations[b];_>r&&(o.operations[b]=_+n)}}indexedOperation(n,r,o=n){this.indexedOperations[n]=r,this.filteredChanges!==void 0?(nt(this.allFilteredChanges,o),nt(this.filteredChanges,n),Ye(this.root,this,"filteredChanges")):(nt(this.allChanges,o),nt(this.changes,n),Ye(this.root,this,"changes"))}getType(n){return xe.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][n].type:this.ref[I]}getChange(n){return this.indexedOperations[n]}getValue(n,r=!1){return this.ref[g](n,r)}delete(n,r,o=n){var b;if(n===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${n}'`)}catch(_){console.warn(_)}return}const c=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[n]=r??e.OPERATION.DELETE,nt(c,n),Gs(this.allChanges,o);const p=this.getValue(n);return p&&p[h]&&((b=this.root)==null||b.remove(p[h])),this.filteredChanges!==void 0?(Gs(this.allFilteredChanges,o),Ye(this.root,this,"filteredChanges")):Ye(this.root,this,"changes"),p}endEncode(n){var r,o;this.indexedOperations={},this[n].indexes={},this[n].operations.length=0,this[n].queueRootIndex=void 0,(o=(r=this.ref)[j])==null||o.call(r),this.isNew=!1}discard(n=!1){var r,o;(o=(r=this.ref)[j])==null||o.call(r),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),n&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((c,p)=>{var b;return(b=this.root)==null?void 0:b.remove(c)}))}discardAll(){const n=Object.keys(this.indexedOperations);for(let r=0,o=n.length;r<o;r++){const c=this.getValue(Number(n[r]));c&&c[h]&&c[h].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(n,r){const o=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(n,r),this.filteredChanges!==void 0&&(Ye(this.root,this,"filteredChanges"),o&&this.root.allFilteredChanges.push(this))),this.isFiltered||(Ye(this.root,this,"changes"),o&&this.root.allChanges.push(this))}_checkFilteredByParent(n,r){if(!n)return;const o=xe.isValidInstance(this.ref)?this.ref.constructor:this.ref[I];let c,p=!xe.isValidInstance(n);p?(c=n[h],n=c.parent,r=c.parentIndex):c=n[h];const b=n.constructor;let _=`${this.root.types.getTypeId(o)}`;b&&(_+=`-${this.root.types.schemas.get(b)}`),_+=`-${r}`;const w=xe.hasViewTagAtIndex(b==null?void 0:b[Symbol.metadata],r);this.isFiltered=n[h].isFiltered||this.root.types.parentFiltered[_]||w,this.isFiltered&&(this.isVisibilitySharedWithParent=c.isFiltered&&typeof o!="string"&&!w&&p,this.filteredChanges||(this.filteredChanges=tn(),this.allFilteredChanges=tn()),this.changes.operations.length>0&&(this.changes.operations.forEach(A=>nt(this.filteredChanges,A)),this.allChanges.operations.forEach(A=>nt(this.allFilteredChanges,A)),this.changes=tn(),this.allChanges=tn()))}}function Ln(f,n,r,o,c,p){var b;typeof r=="string"?(b=ve[r])==null||b.call(ve,n,o,p):r[Symbol.metadata]!==void 0?(ve.number(n,o[h].refId,p),(c&e.OPERATION.ADD)===e.OPERATION.ADD&&f.tryEncodeTypeId(n,r,o.constructor,p)):ve.number(n,o[h].refId,p)}const ps=function(f,n,r,o,c,p,b,_,w){if(n[p.offset++]=(o|c)&255,c===e.OPERATION.DELETE)return;const A=r.ref,D=w[o];Ln(f,n,w[o].type,A[D.name],c,p)},bn=function(f,n,r,o,c,p){if(n[p.offset++]=c&255,c===e.OPERATION.CLEAR||(ve.number(n,o,p),c===e.OPERATION.DELETE))return;const b=r.ref;if((c&e.OPERATION.ADD)===e.OPERATION.ADD&&typeof b.set=="function"){const A=r.ref.$indexes.get(o);ve.string(n,A,p)}const _=b[I],w=b[g](o);Ln(f,n,_,w,c,p)},kn=function(f,n,r,o,c,p,b,_){const w=r.ref,A=_&&r.isFiltered&&typeof r.getType(o)!="string";let D;if(A?(D=w.tmpItems[o][h].refId,c===e.OPERATION.DELETE?c=e.OPERATION.DELETE_BY_REFID:c===e.OPERATION.ADD&&(c=e.OPERATION.ADD_BY_REFID)):D=o,n[p.offset++]=c&255,c===e.OPERATION.CLEAR||c===e.OPERATION.REVERSE||(ve.number(n,D,p),c===e.OPERATION.DELETE||c===e.OPERATION.DELETE_BY_REFID))return;const $=r.getType(o),R=r.getValue(o,b);Ln(f,n,$,R,c,p)},Zs=-1;function gs(f,n,r,o,c,p,b,_){const w=f.root,A=r[g](o);let D;if((n&e.OPERATION.DELETE)===e.OPERATION.DELETE){const $=w.refIds.get(A);$!==void 0&&w.removeRef($),n!==e.OPERATION.DELETE_AND_ADD&&r[y](o),D=void 0}if(n!==e.OPERATION.DELETE)if(Me.is(c)){const $=G.number(p,b);if(D=w.refs.get($),(n&e.OPERATION.ADD)===e.OPERATION.ADD){const R=f.getInstanceType(p,b,c);D||(D=f.createInstanceOfType(R)),w.addRef($,D,D!==A||n===e.OPERATION.DELETE_AND_ADD&&D===A)}}else if(typeof c=="string")D=G[c](p,b);else{const $=Ne(Object.keys(c)[0]),R=G.number(p,b),X=w.refs.has(R)?A||w.refs.get(R):new $.constructor;if(D=X.clone(!0),D[I]=Object.values(c)[0],A){let K=w.refIds.get(A);if(K!==void 0&&R!==K){const U=A.entries();let N;for(;(N=U.next())&&!N.done;){const[q,ye]=N.value;typeof ye=="object"&&(K=w.refIds.get(ye),w.removeRef(K)),_.push({ref:A,refId:K,op:e.OPERATION.DELETE,field:q,value:void 0,previousValue:ye})}}}w.addRef(R,D,X!==A||n===e.OPERATION.DELETE_AND_ADD&&X===A)}return{value:D,previousValue:A}}const zs=function(f,n,r,o,c){const p=n[r.offset++],b=o.constructor[Symbol.metadata],_=p>>6<<6,w=p%(_||255),A=b[w];if(A===void 0)return console.warn("@colyseus/schema: field not defined at",{index:w,ref:o.constructor.name,metadata:b}),Zs;const{value:D,previousValue:$}=gs(f,_,o,w,A.type,n,r,c);D!=null&&(o[A.name]=D),$!==D&&c.push({ref:o,refId:f.currentRefId,op:_,field:A.name,value:D,previousValue:$})},Bn=function(f,n,r,o,c){const p=n[r.offset++];if(p===e.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}const b=G.number(n,r),_=o[I];let w;(p&e.OPERATION.ADD)===e.OPERATION.ADD?typeof o.set=="function"?(w=G.string(n,r),o.setIndex(b,w)):w=b:w=o.getIndex(b);const{value:A,previousValue:D}=gs(f,p,o,b,_,n,r,c);if(A!=null){if(typeof o.set=="function")o.$items.set(w,A);else if(typeof o.$setAt=="function")o.$setAt(b,A,p);else if(typeof o.add=="function"){const $=o.add(A);typeof $=="number"&&o.setIndex($,$)}}D!==A&&c.push({ref:o,refId:f.currentRefId,op:p,field:"",dynamicIndex:w,value:A,previousValue:D})},Ni=function(f,n,r,o,c){let p=n[r.offset++],b;if(p===e.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}else if(p===e.OPERATION.REVERSE){o.reverse();return}else if(p===e.OPERATION.DELETE_BY_REFID){const $=G.number(n,r),R=f.root.refs.get($);b=o.findIndex(X=>X===R),o[y](b),c.push({ref:o,refId:f.currentRefId,op:e.OPERATION.DELETE,field:"",dynamicIndex:b,value:void 0,previousValue:R});return}else if(p===e.OPERATION.ADD_BY_REFID){const $=G.number(n,r),R=f.root.refs.get($);R&&(b=o.findIndex(X=>X===R)),(b===-1||b===void 0)&&(b=o.length)}else b=G.number(n,r);const _=o[I];let w=b;const{value:A,previousValue:D}=gs(f,p,o,b,_,n,r,c);A!=null&&A!==D&&o.$setAt(b,A,p),D!==A&&c.push({ref:o,refId:f.currentRefId,op:p,field:"",dynamicIndex:w,value:A,previousValue:D})};class Jn extends Error{}function Ws(f,n,r,o){let c,p=!1;switch(n){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(f)&&console.log(`trying to encode "NaN" in ${r.constructor.name}#${o}`);break;case"bigint64":case"biguint64":c="bigint";break;case"string":c="string",p=!0;break;case"boolean":return;default:return}if(typeof f!==c&&(!p||p&&f!==null)){let b=`'${JSON.stringify(f)}'${f&&f.constructor&&` (${f.constructor.name})`||""}`;throw new Jn(`a '${c}' was expected, but ${b} was provided in ${r.constructor.name}#${o}`)}}function On(f,n,r,o){if(!(f instanceof n))throw new Jn(`a '${n.name}' was expected, but '${f&&f.constructor.name}' was provided in ${r.constructor.name}#${o}`)}var En,Ks;const Pi=(f,n)=>{const r=f.toString(),o=n.toString();return r<o?-1:r>o?1:0},pt=class pt{static[(En=u,Ks=d,m)](n,r,o){var c;return!o||typeof n[I]=="string"||o.isChangeTreeVisible((c=n.tmpItems[r])==null?void 0:c[h])}static is(n){return Array.isArray(n)||n.array!==void 0}static from(n){return new pt(...Array.from(n))}constructor(...n){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const r=new Proxy(this,{get:(o,c)=>typeof c!="symbol"&&!isNaN(c)?this.items[c]:Reflect.get(o,c),set:(o,c,p)=>{var b;if(typeof c!="symbol"&&!isNaN(c)){if(p==null)o.$deleteAt(c);else{if(p[h]){On(p,o[I],o,c);const _=o.items[c];o.isMovingItems?(_!==void 0?p[h].isNew?o[h].indexedOperation(Number(c),e.OPERATION.MOVE_AND_ADD):(o[h].getChange(Number(c))&e.OPERATION.DELETE)===e.OPERATION.DELETE?o[h].indexedOperation(Number(c),e.OPERATION.DELETE_AND_MOVE):o[h].indexedOperation(Number(c),e.OPERATION.MOVE):p[h].isNew&&o[h].indexedOperation(Number(c),e.OPERATION.ADD),p[h].setParent(this,o[h].root,c)):o.$changeAt(Number(c),p),_!==void 0&&((b=_[h].root)==null||b.remove(_[h]))}else o.$changeAt(Number(c),p);o.items[c]=p,o.tmpItems[c]=p}return!0}else return Reflect.set(o,c,p)},deleteProperty:(o,c)=>(typeof c=="number"?o.$deleteAt(c):delete o[c],!0),has:(o,c)=>typeof c!="symbol"&&!isNaN(Number(c))?Reflect.has(this.items,c):Reflect.has(o,c)});return this[h]=new Lt(r),this[h].indexes={},n.length>0&&this.push(...n),r}set length(n){n===0?this.clear():n<this.items.length?this.splice(n,this.length-n):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...n){var c;let r=this.tmpItems.length;const o=this[h];for(let p=0,b=n.length;p<n.length;p++,r++){const _=n[p];if(_==null)return;typeof _=="object"&&this[I]&&On(_,this[I],this,p),o.indexedOperation(r,e.OPERATION.ADD,this.items.length),this.items.push(_),this.tmpItems.push(_),(c=_[h])==null||c.setParent(this,o.root,r)}return r}pop(){let n=-1;for(let r=this.tmpItems.length-1;r>=0;r--)if(this.deletedIndexes[r]!==!0){n=r;break}if(!(n<0))return this[h].delete(n,void 0,this.items.length-1),this.deletedIndexes[n]=!0,this.items.pop()}at(n){return n<0&&(n+=this.length),this.items[n]}$changeAt(n,r){var p;if(r==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[n]===r)return;const o=this.items[n]!==void 0?typeof r=="object"?e.OPERATION.DELETE_AND_ADD:e.OPERATION.REPLACE:e.OPERATION.ADD,c=this[h];c.change(n,o),(p=r[h])==null||p.setParent(this,c.root,n)}$deleteAt(n,r){this[h].delete(n,r)}$setAt(n,r,o){n===0&&o===e.OPERATION.ADD&&this.items[n]!==void 0?this.items.unshift(r):o===e.OPERATION.DELETE_AND_MOVE?(this.items.splice(n,1),this.items[n]=r):this.items[n]=r}clear(){if(this.items.length===0)return;const n=this[h];n.forEachChild((r,o)=>{r.discard(!0);const c=r.root;c!==void 0&&(c.removeChangeFromChangeSet("changes",r),c.removeChangeFromChangeSet("allChanges",r),c.removeChangeFromChangeSet("allFilteredChanges",r))}),n.discard(!0),n.operation(e.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...n){return new pt(...this.items.concat(...n))}join(n){return this.items.join(n)}reverse(){return this[h].operation(e.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const n=this[h],r=this.tmpItems.findIndex(c=>c===this.items[0]),o=this.items.findIndex(c=>c===this.items[0]);return n.delete(r,e.OPERATION.DELETE,o),n.shiftAllChangeIndexes(-1,o),this.items.shift()}slice(n,r){const o=new pt;return o.push(...this.items.slice(n,r)),o}sort(n=Pi){this.isMovingItems=!0;const r=this[h];return this.items.sort(n).forEach((c,p)=>r.change(p,e.OPERATION.REPLACE)),this.tmpItems.sort(n),this.isMovingItems=!1,this}splice(n,r,...o){var A;const c=this[h],p=this.items.length,b=this.tmpItems.length,_=o.length,w=[];for(let D=0;D<b;D++)this.deletedIndexes[D]!==!0&&w.push(D);if(p>n){r===void 0&&(r=p-n);for(let D=n;D<n+r;D++){const $=w[D];c.delete($,e.OPERATION.DELETE),this.deletedIndexes[$]=!0}}else r=0;if(_>0){if(_>r)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let D=0;D<_;D++){const $=(w[n]??p)+D;c.indexedOperation($,this.deletedIndexes[$]?e.OPERATION.DELETE_AND_ADD:e.OPERATION.ADD),(A=o[D][h])==null||A.setParent(this,c.root,$)}}return r>_&&c.shiftAllChangeIndexes(-(r-_),w[n+_]),c.filteredChanges!==void 0?Ye(c.root,c,"filteredChanges"):Ye(c.root,c,"changes"),this.items.splice(n,r,...o)}unshift(...n){const r=this[h];return r.shiftChangeIndexes(n.length),r.isFiltered?nt(r.filteredChanges,this.items.length):nt(r.allChanges,this.items.length),n.forEach((o,c)=>{r.change(c,e.OPERATION.ADD)}),this.tmpItems.unshift(...n),this.items.unshift(...n)}indexOf(n,r){return this.items.indexOf(n,r)}lastIndexOf(n,r=this.length-1){return this.items.lastIndexOf(n,r)}every(n,r){return this.items.every(n,r)}some(n,r){return this.items.some(n,r)}forEach(n,r){return this.items.forEach(n,r)}map(n,r){return this.items.map(n,r)}filter(n,r){return this.items.filter(n,r)}reduce(n,r){return this.items.reduce(n,r)}reduceRight(n,r){return this.items.reduceRight(n,r)}find(n,r){return this.items.find(n,r)}findIndex(n,r){return this.items.findIndex(n,r)}fill(n,r,o){throw new Error("ArraySchema#fill() not implemented")}copyWithin(n,r,o){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return pt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(n,r){return this.items.includes(n,r)}flatMap(n,r){throw new Error("ArraySchema#flatMap() is not supported.")}flat(n){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...n){return this.items.findLastIndex.apply(this.items,arguments)}with(n,r){const o=this.items.slice();return n<0&&(n+=this.length),o[n]=r,new pt(...o)}toReversed(){return this.items.slice().reverse()}toSorted(n){return this.items.slice().sort(n)}toSpliced(n,r,...o){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(n=>{let r=this.items.length;for(;r!=0;){let o=Math.floor(Math.random()*r);r--,[this[r],this[o]]=[this[o],this[r]]}})}move(n){return this.isMovingItems=!0,n(this),this.isMovingItems=!1,this}[g](n,r=!1){return r?this.items[n]:this.deletedIndexes[n]?this.items[n]:this.tmpItems[n]||this.items[n]}[y](n){this.items[n]=void 0,this.tmpItems[n]=void 0}[j](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[J](){this.items=this.items.filter(n=>n!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(n=>typeof n.toJSON=="function"?n.toJSON():n)}clone(n){let r;return n?(r=new pt,r.push(...this.items)):r=new pt(...this.map(o=>o[h]?o.clone():o)),r}};pt[En]=kn,pt[Ks]=Ni;let bt=pt;fe("array",{constructor:bt});var qs,Ys;const Bt=class Bt{static[(qs=u,Ys=d,m)](n,r,o){return!o||typeof n[I]=="string"||o.isChangeTreeVisible((n[g](r)??n.deletedItems[r])[h])}static is(n){return n.map!==void 0}constructor(n){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[h]=new Lt(this),this[h].indexes={},n)if(n instanceof Map||n instanceof Bt)n.forEach((r,o)=>this.set(o,r));else for(const r in n)this.set(r,n[r]);Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return Bt}set(n,r){var _;if(r==null)throw new Error(`MapSchema#set('${n}', ${r}): trying to set ${r} value on '${n}'.`);typeof r=="object"&&this[I]&&On(r,this[I],this,n),n=n.toString();const o=this[h],c=r[h]!==void 0;let p,b;if(typeof o.indexes[n]<"u"){p=o.indexes[n],b=e.OPERATION.REPLACE;const w=this.$items.get(n);if(w===r)return;c&&(b=e.OPERATION.DELETE_AND_ADD,w!==void 0&&((_=w[h].root)==null||_.remove(w[h])))}else p=o.indexes[z]??0,b=e.OPERATION.ADD,this.$indexes.set(p,n),o.indexes[n]=p,o.indexes[z]=p+1;return this.$items.set(n,r),o.change(p,b),c&&r[h].setParent(this,o.root,p),this}get(n){return this.$items.get(n)}delete(n){const r=this[h].indexes[n];return this.deletedItems[r]=this[h].delete(r),this.$items.delete(n)}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){return this.$items.has(n)}forEach(n){this.$items.forEach(n)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[j](){this.deletedItems={}}toJSON(){const n={};return this.forEach((r,o)=>{n[o]=typeof r.toJSON=="function"?r.toJSON():r}),n}clone(n){let r;return n?r=Object.assign(new Bt,this):(r=new Bt,this.forEach((o,c)=>{o[h]?r.set(c,o.clone()):r.set(c,o)})),r}};Bt[qs]=bn,Bt[Ys]=Bn;let ct=Bt;fe("map",{constructor:ct});const Ot=-1;function Ci(f){return Ae.register(f),f}function Xs(f=Ot){return function(n,r){var _;const o=n.constructor,p=Object.getPrototypeOf(o)[Symbol.metadata],b=o[_=Symbol.metadata]??(o[_]=Object.assign({},o[Symbol.metadata],p??Object.create(null)));xe.setTag(b,r,f)}}function ht(f,n){return function(r,o){const c=r.constructor;if(!f)throw new Error(`${c.name}: @type() reference provided for "${o}" is undefined. Make sure you don't have any circular dependencies.`);Ae.register(c);const b=Object.getPrototypeOf(c)[Symbol.metadata],_=xe.initialize(c);let w=_[o];if(_[w]!==void 0){if(_[w].deprecated)return;if(_[w].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${o}' definition on '${c.name}'.
Check @type() annotation`)}catch(A){const D=A.stack.split(`
`)[4].trim();throw new Error(`${A.message} ${D}`)}}else w=_[z]??(b&&b[z])??-1,w++;if(n&&n.manual)xe.addField(_,w,o,f,{enumerable:!0,configurable:!0,writable:!0});else{const A=Array.isArray(f)?Ne("array"):typeof Object.keys(f)[0]=="string"&&Ne(Object.keys(f)[0]),D=A?Object.values(f)[0]:f;xe.addField(_,w,o,f,Js(`_${o}`,w,D,A))}}}function Js(f,n,r,o){return{get:function(){return this[f]},set:function(c){var b,_;const p=this[f]??void 0;if(c!==p){if(c!=null){o?(o.constructor===bt&&!(c instanceof bt)&&(c=new bt(...c)),o.constructor===ct&&!(c instanceof ct)&&(c=new ct(c)),c[I]=r):typeof r!="string"?On(c,r,this,f.substring(1)):Ws(c,r,this,f.substring(1));const w=this[h];p!==void 0&&p[h]?((b=w.root)==null||b.remove(p[h]),this.constructor[l](w,n,e.OPERATION.DELETE_AND_ADD)):this.constructor[l](w,n,e.OPERATION.ADD),(_=c[h])==null||_.setParent(this,w.root,n)}else p!==void 0&&this[h].delete(n);this[f]=c}},enumerable:!0,configurable:!0}}function vn(f=!0){return function(n,r){var w;const o=n.constructor,p=Object.getPrototypeOf(o)[Symbol.metadata],b=o[w=Symbol.metadata]??(o[w]=Object.assign({},o[Symbol.metadata],p??Object.create(null))),_=b[r];b[_].deprecated=!0,f&&(b[H]??(b[H]={}),b[H][r]={get:function(){throw new Error(`${r} is deprecated.`)},set:function(A){},enumerable:!1,configurable:!0}),Object.defineProperty(b,_,{value:b[_],enumerable:!1,configurable:!0})}}function Li(f,n,r){for(let o in n)ht(n[o],r)(f.prototype,o);return f}function Qs(f,n,r=Me){const o={},c={};for(let b in f){const _=f[b];typeof _=="object"&&(_.default!==void 0&&(o[b]=_.default),_.view!==void 0&&(c[b]=typeof _.view=="boolean"?Ot:_.view))}const p=xe.setFields(class extends r{constructor(...b){b[0]=Object.assign({},o,b[0]),super(...b)}},f);for(let b in c)Xs(c[b])(p.prototype,b);return n&&Object.defineProperty(p,"name",{value:n}),p.extends=(b,_)=>Qs(b,_,p),p}function $n(f){return new Array(f).fill(0).map((n,r)=>r===f-1?" ":"   ").join("")}function ki(f){const n=f[h].root,r={ops:{},refs:[]};return n.changes.forEach(o=>{if(o===void 0)return;const c=o.indexedOperations;r.refs.push(`refId#${o.refId}`);for(const p in c){const b=c[p],_=e.OPERATION[b];r.ops[_]||(r.ops[_]=0),r.ops[e.OPERATION[b]]++}}),r}var ei,Qn;const Tn=class Tn{static initialize(n){var r;Object.defineProperty(n,h,{value:new Lt(n),enumerable:!1,writable:!0}),Object.defineProperties(n,((r=n.constructor[Symbol.metadata])==null?void 0:r[H])||{})}static is(n){return typeof n[Symbol.metadata]=="object"}static[(ei=u,Qn=d,l)](n,r,o=e.OPERATION.ADD){n.change(r,o)}static[m](n,r,o){var b,_;const p=(b=n.constructor[Symbol.metadata][r])==null?void 0:b.tag;if(o===void 0)return p===void 0;if(p===void 0)return!0;if(p===Ot)return o.isChangeTreeVisible(n[h]);{const w=(_=o.tags)==null?void 0:_.get(n[h]);return w&&w.has(p)}}constructor(...n){Tn.initialize(this),n[0]&&Object.assign(this,n[0])}assign(n){return Object.assign(this,n),this}setDirty(n,r){const o=this.constructor[Symbol.metadata];this[h].change(o[o[n]].index,r)}clone(){var o;const n=new this.constructor,r=this.constructor[Symbol.metadata];for(const c in r){const p=r[c].name;typeof this[p]=="object"&&typeof((o=this[p])==null?void 0:o.clone)=="function"?n[p]=this[p].clone():n[p]=this[p]}return n}toJSON(){const n={},r=this.constructor[Symbol.metadata];for(const o in r){const c=r[o],p=c.name;!c.deprecated&&this[p]!==null&&typeof this[p]<"u"&&(n[p]=typeof this[p].toJSON=="function"?this[p].toJSON():this[p])}return n}discardAllChanges(){this[h].discardAll()}[g](n){const r=this.constructor[Symbol.metadata];return this[r[n].name]}[y](n){const r=this.constructor[Symbol.metadata];this[r[n].name]=void 0}static debugRefIds(n,r=!1,o=0){const c=r?` - ${JSON.stringify(n.toJSON())}`:"",p=n[h],b=p.refId;let _="";return _+=`${$n(o)}${n.constructor.name} (refId: ${b})${c}
`,p.forEachChild(w=>_+=this.debugRefIds(w.ref,r,o+1)),_}static debugChanges(n,r=!1){const o=n[h],c=r?o.allChanges:o.changes,p=r?"allChanges":"changes";let b=`${n.constructor.name} (${o.refId}) -> .${p}:
`;function _(w){w.operations.filter(A=>A).forEach(A=>{const D=o.indexedOperations[A];console.log({index:A,operation:D}),b+=`- [${A}]: ${e.OPERATION[D]} (${JSON.stringify(o.getValue(Number(A),r))})
`})}return _(c),!r&&o.filteredChanges&&o.filteredChanges.operations.filter(w=>w).length>0&&(b+=`${n.constructor.name} (${o.refId}) -> .filteredChanges:
`,_(o.filteredChanges)),r&&o.allFilteredChanges&&o.allFilteredChanges.operations.filter(w=>w).length>0&&(b+=`${n.constructor.name} (${o.refId}) -> .allFilteredChanges:
`,_(o.allFilteredChanges)),b}static debugChangesDeep(n,r="changes"){var D,$;let o="";const c=n[h],p=c.root,b=new Map,_=[];let w=0;for(const[R,X]of Object.entries(p[r])){const K=p.changeTrees[R];let U=!1,N=[],q=(D=K.parent)==null?void 0:D[h];if(K===c)U=!0;else for(;q!==void 0;){if(N.push(q),q.ref===n){U=!0;break}q=($=q.parent)==null?void 0:$[h]}U&&(_.push(K.refId),w+=Object.keys(X).length,b.set(K,N.reverse()))}o+=`---
`,o+=`root refId: ${c.refId}
`,o+=`Total instances: ${_.length} (refIds: ${_.join(", ")})
`,o+=`Total changes: ${w}
`,o+=`---
`;const A=new WeakSet;for(const[R,X]of b.entries()){X.forEach((ye,De)=>{A.has(ye)||(o+=`${$n(De)}${ye.ref.constructor.name} (refId: ${ye.refId})
`,A.add(ye))});const K=R.indexedOperations,U=X.length,N=$n(U),q=U>0?`(${R.parentIndex}) `:"";o+=`${N}${q}${R.ref.constructor.name} (refId: ${R.refId}) - changes: ${Object.keys(K).length}
`;for(const ye in K){const De=K[ye];o+=`${$n(U+1)}${e.OPERATION[De]}: ${ye}
`}}return`${o}`}};Tn[ei]=ps,Tn[Qn]=zs;let Me=Tn;var ti,nn;const an=class an{static[(ti=u,nn=d,m)](n,r,o){return!o||typeof n[I]=="string"||o.isChangeTreeVisible((n[g](r)??n.deletedItems[r])[h])}static is(n){return n.collection!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Lt(this),this[h].indexes={},n&&n.forEach(r=>this.add(r)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){const r=this.$refId++;return n[h]!==void 0&&n[h].setParent(this,this[h].root,r),this[h].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,n),this[h].change(r),r}at(n){const r=Array.from(this.$items.keys())[n];return this.$items.get(r)}entries(){return this.$items.entries()}delete(n){const r=this.$items.entries();let o,c;for(;(c=r.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[h].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){return Array.from(this.$items.values()).some(r=>r===n)}forEach(n){this.$items.forEach((r,o,c)=>n(r,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[j](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((r,o)=>{n.push(typeof r.toJSON=="function"?r.toJSON():r)}),n}clone(n){let r;return n?r=Object.assign(new an,this):(r=new an,this.forEach(o=>{o[h]?r.add(o.clone()):r.add(o)})),r}};an[ti]=bn,an[nn]=Bn;let _n=an;fe("collection",{constructor:_n});var ni,si;const on=class on{static[(ni=u,si=d,m)](n,r,o){return!o||typeof n[I]=="string"||o.visible.has((n[g](r)??n.deletedItems[r])[h])}static is(n){return n.set!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Lt(this),this[h].indexes={},n&&n.forEach(r=>this.add(r)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){var c;if(this.has(n))return!1;const r=this.$refId++;n[h]!==void 0&&n[h].setParent(this,this[h].root,r);const o=((c=this[h].indexes[r])==null?void 0:c.op)??e.OPERATION.ADD;return this[h].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,n),this[h].change(r,o),r}entries(){return this.$items.entries()}delete(n){const r=this.$items.entries();let o,c;for(;(c=r.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[h].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){const r=this.$items.values();let o=!1,c;for(;(c=r.next())&&!c.done;)if(n===c.value){o=!0;break}return o}forEach(n){this.$items.forEach((r,o,c)=>n(r,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[j](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((r,o)=>{n.push(typeof r.toJSON=="function"?r.toJSON():r)}),n}clone(n){let r;return n?r=Object.assign(new on,this):(r=new on,this.forEach(o=>{o[h]?r.add(o.clone()):r.add(o)})),r}};on[ni]=bn,on[si]=Bn;let wn=on;fe("set",{constructor:wn});function kt(f,n,r,o){var c=arguments.length,p=c<3?n:o===null?o=Object.getOwnPropertyDescriptor(n,r):o,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(f,n,r,o);else for(var _=f.length-1;_>=0;_--)(b=f[_])&&(p=(c<3?b(p):c>3?b(n,r,p):b(n,r))||p);return c>3&&p&&Object.defineProperty(n,r,p),p}typeof SuppressedError=="function"&&SuppressedError;class Bi{constructor(n){this.types=n,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(n){n.ensureRefId();const r=this.changeTrees[n.refId]===void 0;r&&(this.changeTrees[n.refId]=n);const o=this.refCount[n.refId];if(o===0){const c=n.allChanges.operations;let p=c.length;for(;p--;)n.indexedOperations[c[p]]=e.OPERATION.ADD,nt(n.changes,p)}return this.refCount[n.refId]=(o||0)+1,r}remove(n){const r=this.refCount[n.refId]-1;return r<=0?(n.root=void 0,delete this.changeTrees[n.refId],this.removeChangeFromChangeSet("allChanges",n),this.removeChangeFromChangeSet("changes",n),n.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",n),this.removeChangeFromChangeSet("filteredChanges",n)),this.refCount[n.refId]=0):(this.refCount[n.refId]=r,n.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",n),Ye(this,n,"filteredChanges")):(this.removeChangeFromChangeSet("changes",n),Ye(this,n,"changes"))),n.forEachChild((o,c)=>this.remove(o)),r}removeChangeFromChangeSet(n,r){const o=this[n],c=o.indexOf(r);if(c!==-1)return r[n].queueRootIndex=-1,o[c]=void 0,!0}clear(){this.changes.length=0}}const Mn=class Mn{constructor(n){this.sharedBuffer=Buffer.allocUnsafe(Mn.BUFFER_SIZE),this.context=Ae.cache(n.constructor),this.root=new Bi(this.context),this.setState(n)}setState(n){this.state=n,this.state[h].setRoot(this.root)}encode(n={offset:0},r,o=this.sharedBuffer,c="changes",p=c==="allChanges",b=n.offset){const _=r!==void 0,w=this.state[h],A=this.root[c];for(let D=0,$=A.length;D<$;D++){const R=A[D];if(!R)continue;if(_){if(!r.isChangeTreeVisible(R)){r.invisible.add(R);continue}r.invisible.delete(R)}const X=R[c],K=R.ref,U=X.operations.length;if(U===0)continue;const N=K.constructor,q=N[u],ye=N[m],De=N[Symbol.metadata];(_||n.offset>b||R!==w)&&(o[n.offset++]=255,ve.number(o,R.refId,n));for(let Ke=0;Ke<U;Ke++){const Ze=X.operations[Ke],Nt=Ze<0?Math.abs(Ze):p?e.OPERATION.ADD:R.indexedOperations[Ze];Ze===void 0||Nt===void 0||ye&&!ye(K,Ze,r)||q(this,o,R,Ze,Nt,n,p,_,De)}}if(n.offset>o.byteLength){const D=Math.ceil(n.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(D/1024)} * 1024; // ${Math.round(D/1024)} KB
`),o=Buffer.alloc(D,o),o===this.sharedBuffer&&(this.sharedBuffer=o),this.encode({offset:b},r,o,c,p)}else return o.subarray(0,n.offset)}encodeAll(n={offset:0},r=this.sharedBuffer){return this.encode(n,void 0,r,"allChanges",!0)}encodeAllView(n,r,o,c=this.sharedBuffer){const p=o.offset;return this.encode(o,n,c,"allFilteredChanges",!0,p),Buffer.concat([c.subarray(0,r),c.subarray(p,o.offset)])}debugChanges(n){(typeof n=="string"?this.root[n]:n).forEach(o=>{const c=o[n],p=o.ref.constructor[Symbol.metadata];console.log("->",{ref:o.ref.constructor.name,refId:o.refId,changes:Object.keys(c).length});for(const b in c){const _=c[b];console.log("  ->",{index:b,field:p==null?void 0:p[b],op:e.OPERATION[_]})}})}encodeView(n,r,o,c=this.sharedBuffer){const p=o.offset;for(const[b,_]of n.changes){const w=this.root.changeTrees[b];if(w===void 0){n.changes.delete(b);continue}const A=Object.keys(_);if(A.length===0)continue;const $=w.ref.constructor,R=$[u],X=$[Symbol.metadata];c[o.offset++]=255,ve.number(c,w.refId,o);for(let K=0,U=A.length;K<U;K++){const N=Number(A[K]),ye=w.ref[g](N)!==void 0&&_[N]||e.OPERATION.DELETE;R(this,c,w,N,ye,o,!1,!0,X)}}return n.changes.clear(),this.encode(o,n,c,"filteredChanges",!1,p),Buffer.concat([c.subarray(0,r),c.subarray(p,o.offset)])}discardChanges(){var r,o;let n=this.root.changes.length;if(n>0){for(;n--;)(r=this.root.changes[n])==null||r.endEncode("changes");this.root.changes.length=0}if(n=this.root.filteredChanges.length,n>0){for(;n--;)(o=this.root.filteredChanges[n])==null||o.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(n,r,o,c){const p=this.context.getTypeId(r),b=this.context.getTypeId(o);if(b===void 0){console.warn(`@colyseus/schema WARNING: Class "${o.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}p!==b&&(n[c.offset++]=213,ve.number(n,b,c))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};Mn.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let dn=Mn;function ii(f,n){if(n===-1||n>=f.length)return!1;const r=f.length-1;for(let o=n;o<r;o++)f[o]=f[o+1];return f.length=r,!0}class ri extends Error{constructor(n){super(n),this.name="DecodingWarning"}}class $i{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(n,r,o=!0){this.refs.set(n,r),this.refIds.set(r,n),o&&(this.refCounts[n]=(this.refCounts[n]||0)+1),this.deletedRefs.has(n)&&this.deletedRefs.delete(n)}removeRef(n){const r=this.refCounts[n];if(r===void 0){try{throw new ri("trying to remove refId that doesn't exist: "+n)}catch(o){console.warn(o)}return}if(r===0){try{const o=this.refs.get(n);throw new ri(`trying to remove refId '${n}' with 0 refCount (${o.constructor.name}: ${JSON.stringify(o)})`)}catch(o){console.warn(o)}return}(this.refCounts[n]=r-1)<=0&&this.deletedRefs.add(n)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(n=>{if(this.refCounts[n]>0)return;const r=this.refs.get(n);if(r.constructor[Symbol.metadata]!==void 0){const o=r.constructor[Symbol.metadata];for(const c in o){const p=o[c].name,b=typeof r[p]=="object"&&this.refIds.get(r[p]);b&&!this.deletedRefs.has(b)&&this.removeRef(b)}}else typeof r[I]=="function"&&Array.from(r.values()).forEach(o=>{const c=this.refIds.get(o);this.deletedRefs.has(c)||this.removeRef(c)});this.refs.delete(n),delete this.refCounts[n],delete this.callbacks[n]}),this.deletedRefs.clear()}addCallback(n,r,o){if(n===void 0){const c=typeof r=="number"?e.OPERATION[r]:r;throw new Error(`Can't addCallback on '${c}' (refId is undefined)`)}return this.callbacks[n]||(this.callbacks[n]={}),this.callbacks[n][r]||(this.callbacks[n][r]=[]),this.callbacks[n][r].push(o),()=>this.removeCallback(n,r,o)}removeCallback(n,r,o){var p,b,_;const c=(_=(b=(p=this.callbacks)==null?void 0:p[n])==null?void 0:b[r])==null?void 0:_.indexOf(o);c!==-1&&ii(this.callbacks[n][r],c)}}class es{constructor(n,r){this.currentRefId=0,this.setState(n),this.context=r||new Ae(n.constructor)}setState(n){this.state=n,this.root=new $i,this.root.addRef(0,n)}decode(n,r={offset:0},o=this.state){var w,A,D;const c=[],p=this.root,b=n.byteLength;let _=o.constructor[d];for(this.currentRefId=0;r.offset<b;){if(n[r.offset]==255){r.offset++,this.currentRefId=G.number(n,r);const R=p.refs.get(this.currentRefId);if(!R)throw new Error(`"refId" not found: ${this.currentRefId}`);(w=o[J])==null||w.call(o),o=R,_=o.constructor[d];continue}if(_(this,n,r,o,c)===Zs){console.warn("@colyseus/schema: definition mismatch");const R={offset:r.offset};for(;r.offset<b&&!(n[r.offset]===255&&(R.offset=r.offset+1,p.refs.has(G.number(n,R))));)r.offset++;continue}}return(A=o[J])==null||A.call(o),(D=this.triggerChanges)==null||D.call(this,c),p.garbageCollectDeletedRefs(),c}getInstanceType(n,r,o){let c;if(n[r.offset]===213){r.offset++;const p=G.number(n,r);c=this.context.get(p)}return c||o}createInstanceOfType(n){return new n}removeChildRefs(n,r){const o=typeof n[I]!="string",c=this.root.refIds.get(n);n.forEach((p,b)=>{r.push({ref:n,refId:c,op:e.OPERATION.DELETE,field:b,value:void 0,previousValue:p}),o&&this.root.removeRef(this.root.refIds.get(p))})}}class sn extends Me{}kt([ht("string")],sn.prototype,"name",void 0),kt([ht("string")],sn.prototype,"type",void 0),kt([ht("number")],sn.prototype,"referencedType",void 0);class rn extends Me{constructor(){super(...arguments),this.fields=new bt}}kt([ht("number")],rn.prototype,"id",void 0),kt([ht("number")],rn.prototype,"extendsId",void 0),kt([ht([sn])],rn.prototype,"fields",void 0);class Ht extends Me{constructor(){super(...arguments),this.types=new bt}static encode(n,r={offset:0}){const o=n.context,c=new Ht,p=new dn(c),b=o.schemas.get(n.state.constructor);b>0&&(c.rootType=b);const _=new Set,w={},A=$=>{if($.extendsId===void 0||_.has($.extendsId)){_.add($.id),c.types.push($);const R=w[$.id];R!==void 0&&(delete w[$.id],R.forEach(X=>A(X)))}else w[$.extendsId]===void 0&&(w[$.extendsId]=[]),w[$.extendsId].push($)};o.schemas.forEach(($,R)=>{const X=new rn;X.id=Number($);const K=Object.getPrototypeOf(R);K!==Me&&(X.extendsId=o.schemas.get(K));const U=R[Symbol.metadata];if(U!==K[Symbol.metadata])for(const N in U){const q=Number(N),ye=U[q].name;if(!Object.prototype.hasOwnProperty.call(U,ye))continue;const De=new sn;De.name=ye;let Ke;const Ze=U[q];if(typeof Ze.type=="string")Ke=Ze.type;else{let Nt;Me.is(Ze.type)?(Ke="ref",Nt=Ze.type):(Ke=Object.keys(Ze.type)[0],typeof Ze.type[Ke]=="string"?Ke+=":"+Ze.type[Ke]:Nt=Ze.type[Ke]),De.referencedType=Nt?o.getTypeId(Nt):-1}De.type=Ke,X.fields.push(De)}A(X)});for(const $ in w)w[$].forEach(R=>c.types.push(R));const D=p.encodeAll(r);return Buffer.from(D,0,r.offset)}static decode(n,r){const o=new Ht;new es(o).decode(n,r);const p=new Ae;o.types.forEach(w=>{const A=p.get(w.extendsId)??Me,D=class extends A{};Ae.register(D),p.add(D,w.id)},{});const b=(w,A,D)=>{A.fields.forEach(($,R)=>{const X=D+R;if($.referencedType!==void 0){let K=$.type,U=p.get($.referencedType);if(!U){const N=$.type.split(":");K=N[0],U=N[1]}K==="ref"?xe.addField(w,X,$.name,U):xe.addField(w,X,$.name,{[K]:U})}else xe.addField(w,X,$.name,$.type)})};o.types.forEach(w=>{const A=p.get(w.id),D=xe.initialize(A),$=[];let R=w;do $.push(R),R=o.types.find(K=>K.id===R.extendsId);while(R);let X=0;$.reverse().forEach(K=>{b(D,K,X),X+=K.fields.length})});const _=new(p.get(o.rootType||0));return new es(_,p)}}kt([ht([rn])],Ht.prototype,"types",void 0),kt([ht("number")],Ht.prototype,"rootType",void 0);function Mi(f){const n=f.root,r=n.callbacks,o=new WeakMap;let c;f.triggerChanges=function(_){var A;const w=new Set;for(let D=0,$=_.length;D<$;D++){const R=_[D],X=R.refId,K=R.ref,U=r[X];if(U){if((R.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&R.previousValue instanceof Me){const N=(A=r[n.refIds.get(R.previousValue)])==null?void 0:A[e.OPERATION.DELETE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q]()}if(K instanceof Me){if(!w.has(X)){const N=U==null?void 0:U[e.OPERATION.REPLACE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q]()}if(U.hasOwnProperty(R.field)){const N=U[R.field];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.previousValue)}}else{if((R.op&e.OPERATION.DELETE)===e.OPERATION.DELETE){if(R.previousValue!==void 0){const N=U[e.OPERATION.DELETE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.previousValue,R.dynamicIndex??R.field)}if((R.op&e.OPERATION.ADD)===e.OPERATION.ADD){const N=U[e.OPERATION.ADD];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}}else if((R.op&e.OPERATION.ADD)===e.OPERATION.ADD&&R.previousValue!==R.value){const N=U[e.OPERATION.ADD];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}if(R.value!==R.previousValue&&(R.value!==void 0||R.previousValue!==void 0)){const N=U[e.OPERATION.REPLACE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}}w.add(X)}}};function p(_,w){var $;let A=(($=w.instance)==null?void 0:$.constructor[Symbol.metadata])||_,D=w.instance&&typeof w.instance.forEach=="function"||_&&typeof _[Symbol.metadata]>"u";if(A&&!D){const R=function(X,K,U,N){return N&&w.instance[K]!==void 0&&!o.has(c)&&U(w.instance[K],void 0),n.addCallback(n.refIds.get(X),K,U)};return new Proxy({listen:function(K,U,N=!0){if(w.instance)return R(w.instance,K,U,N);{let q=()=>{};return w.onInstanceAvailable((ye,De)=>{q=R(ye,K,U,N&&De&&!o.has(c))}),()=>q()}},onChange:function(K){return n.addCallback(n.refIds.get(w.instance),e.OPERATION.REPLACE,K)},bindTo:function(K,U){return U||(U=Object.keys(A).map(N=>A[N].name)),n.addCallback(n.refIds.get(w.instance),e.OPERATION.REPLACE,()=>{U.forEach(N=>K[N]=w.instance[N])})}},{get(X,K){var N;const U=A[A[K]];if(U){const q=(N=w.instance)==null?void 0:N[K],ye=De=>{const Ke=b(w.instance).listen(K,(Ze,Nt)=>{De(Ze,!1),Ke==null||Ke()},!1);n.refIds.get(q)!==void 0&&De(q,!0)};return p(U.type,{instance:n.refIds.get(q)&&q,parentInstance:w.instance,onInstanceAvailable:ye})}else return X[K]},has(X,K){return A[K]!==void 0},set(X,K,U){throw new Error("not allowed")},deleteProperty(X,K){throw new Error("not allowed")}})}else{const R=function(U,N,q){return q&&U.forEach((ye,De)=>N(ye,De)),n.addCallback(n.refIds.get(U),e.OPERATION.ADD,(ye,De)=>{o.set(N,!0),c=N,N(ye,De),o.delete(N),c=void 0})},X=function(U,N){return n.addCallback(n.refIds.get(U),e.OPERATION.DELETE,N)},K=function(U,N){return n.addCallback(n.refIds.get(U),e.OPERATION.REPLACE,N)};return new Proxy({onAdd:function(U,N=!0){if(w.instance)return R(w.instance,U,N&&!o.has(c));if(w.onInstanceAvailable){let q=()=>{};return w.onInstanceAvailable((ye,De)=>{q=R(ye,U,N&&De&&!o.has(c))}),()=>q()}},onRemove:function(U){if(w.instance)return X(w.instance,U);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(q=>{N=X(q,U)}),()=>N()}},onChange:function(U){if(w.instance)return K(w.instance,U);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(q=>{N=K(q,U)}),()=>N()}}},{get(U,N){if(!U[N])throw new Error(`Can't access '${N}' through callback proxy. access the instance directly.`);return U[N]},has(U,N){return U[N]!==void 0},set(U,N,q){throw new Error("not allowed")},deleteProperty(U,N){throw new Error("not allowed")}})}}function b(_){return p(void 0,{instance:_})}return b}function Ui(f,n){f.triggerChanges=n}class Fi{constructor(n=!1){this.iterable=n,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,n&&(this.items=[])}add(n,r=Ot,o=!0){var _,w;const c=n==null?void 0:n[h];if(c){if(!c.parent&&c.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${c.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",n),this;const p=n.constructor[Symbol.metadata];this.visible.add(c),this.iterable&&o&&this.items.push(n),o&&c.parent&&this.addParentOf(c,r);let b=this.changes.get(c.refId);if(b===void 0&&(b={},this.changes.set(c.refId,b)),r!==Ot){this.tags||(this.tags=new WeakMap);let A;this.tags.has(c)?A=this.tags.get(c):(A=new Set,this.tags.set(c,A)),A.add(r),(w=(_=p==null?void 0:p[re])==null?void 0:_[r])==null||w.forEach(D=>{c.getChange(D)!==e.OPERATION.DELETE&&(b[D]=e.OPERATION.ADD)})}else{const A=this.invisible.has(c),D=c.filteredChanges!==void 0?c.allFilteredChanges:c.allChanges;for(let $=0,R=D.operations.length;$<R;$++){const X=D.operations[$];if(X===void 0)continue;const K=c.indexedOperations[X]??e.OPERATION.ADD,U=p==null?void 0:p[X].tag;!c.isNew&&(A||U===void 0||U===r)&&K!==e.OPERATION.DELETE&&(b[X]=K)}}return c.forEachChild((A,D)=>{p&&p[D].tag!==void 0&&p[D].tag!==r||this.add(A.ref,r,!1)}),this}addParentOf(n,r){var p;const o=n.parent[h],c=n.parentIndex;if(!this.visible.has(o)){this.visible.add(o);const b=(p=o.parent)==null?void 0:p[h];b&&b.filteredChanges!==void 0&&this.addParentOf(o,r)}if(o.getChange(c)!==e.OPERATION.DELETE){let b=this.changes.get(o.refId);b===void 0&&(b={},this.changes.set(o.refId,b)),this.tags||(this.tags=new WeakMap);let _;this.tags.has(o)?_=this.tags.get(o):(_=new Set,this.tags.set(o,_)),_.add(r),b[c]=e.OPERATION.ADD}}remove(n,r=Ot,o=!1){var w;const c=n[h];if(!c)return console.warn("StateView#remove(), invalid object:",n),this;this.visible.delete(c),this.iterable&&!o&&ii(this.items,this.items.indexOf(n));const b=c.ref.constructor[Symbol.metadata];let _=this.changes.get(c.refId);if(_===void 0&&(_={},this.changes.set(c.refId,_)),r===Ot){const A=c.parent;if(!xe.isValidInstance(A)&&c.isFiltered){const D=A[h];let $=this.changes.get(D.refId);$===void 0&&($={},this.changes.set(D.refId,$)),$[c.parentIndex]=e.OPERATION.DELETE}else(w=b==null?void 0:b[de])==null||w.forEach(D=>_[D]=e.OPERATION.DELETE)}else b==null||b[re][r].forEach(A=>_[A]=e.OPERATION.DELETE);if(this.tags&&this.tags.has(c)){const A=this.tags.get(c);r===void 0?this.tags.delete(c):(A.delete(r),A.size===0&&this.tags.delete(c))}return this}has(n){return this.visible.has(n[h])}hasTag(n,r=Ot){var c;const o=(c=this.tags)==null?void 0:c.get(n[h]);return(o==null?void 0:o.has(r))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let n=0,r=this.items.length;n<r;n++)this.remove(this.items[n],Ot,!0);this.items.length=0}isChangeTreeVisible(n){let r=this.visible.has(n);return!r&&n.isVisibilitySharedWithParent&&this.visible.has(n.parent[h])&&(this.visible.add(n),r=!0),r}}fe("map",{constructor:ct}),fe("array",{constructor:bt}),fe("set",{constructor:wn}),fe("collection",{constructor:_n}),e.$changes=h,e.$childType=I,e.$decoder=d,e.$deleteByIndex=y,e.$encoder=u,e.$filter=m,e.$getByIndex=g,e.$track=l,e.ArraySchema=bt,e.ChangeTree=Lt,e.CollectionSchema=_n,e.Decoder=es,e.Encoder=dn,e.MapSchema=ct,e.Metadata=xe,e.Reflection=Ht,e.ReflectionField=sn,e.ReflectionType=rn,e.Schema=Me,e.SetSchema=wn,e.StateView=Fi,e.TypeContext=Ae,e.decode=G,e.decodeKeyValueOperation=Bn,e.decodeSchemaOperation=zs,e.defineCustomTypes=Pe,e.defineTypes=Li,e.deprecated=vn,e.dumpChanges=ki,e.encode=ve,e.encodeArray=kn,e.encodeKeyValueOperation=bn,e.encodeSchemaOperation=ps,e.entity=Ci,e.getDecoderStateCallbacks=Mi,e.getRawChangesCallback=Ui,e.registerType=fe,e.schema=Qs,e.type=ht,e.view=Xs})})(Oa,Oa.exports);var Xa=Oa.exports,Io=Zr,oi=Xa;class Gd{constructor(t){this.events=t,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(t,e={}){const i=e.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(e.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(t,i),this.wt.ready.then(a=>{console.log("WebTransport ready!",a),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(u=>{this.reader=u.value.readable.getReader(),this.writer=u.value.writable.getWriter(),this.sendSeatReservation(e.room.roomId,e.sessionId,e.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(u=>{console.error("failed to read incoming stream",u),console.error("TODO: close the connection")})}).catch(a=>{console.log("WebTransport not ready!",a),this._close()}),this.wt.closed.then(a=>{console.log("WebTransport closed w/ success",a),this.events.onclose({code:a.closeCode,reason:a.reason})}).catch(a=>{console.log("WebTransport closed w/ error",a),this.events.onerror(a),this.events.onclose({code:a.closeCode,reason:a.reason})}).finally(()=>{this._close()})}send(t){const e=oi.encode.number(this.lengthPrefixBuffer,t.length,{offset:0}),i=new Uint8Array(e+t.length);i.set(this.lengthPrefixBuffer.subarray(0,e),0),i.set(t,e),this.writer.write(i)}sendUnreliable(t){const e=oi.encode.number(this.lengthPrefixBuffer,t.length,{offset:0}),i=new Uint8Array(e+t.length);i.set(this.lengthPrefixBuffer.subarray(0,e),0),i.set(t,e),this.unreliableWriter.write(i)}close(t,e){try{this.wt.close({closeCode:t,reason:e})}catch(i){console.error(i)}}readIncomingData(){return Io.__awaiter(this,void 0,void 0,function*(){let t;for(;this.isOpen;){try{t=yield this.reader.read();const e=t.value,i={offset:0};do{const a=oi.decode.number(e,i);this.events.onmessage({data:e.subarray(i.offset,i.offset+a)}),i.offset+=a}while(i.offset<e.length)}catch(e){e.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",e);break}if(t.done)break}})}readIncomingUnreliableData(){return Io.__awaiter(this,void 0,void 0,function*(){let t;for(;this.isOpen;){try{t=yield this.unreliableReader.read();const e=t.value,i={offset:0};do{const a=oi.decode.number(e,i);this.events.onmessage({data:e.subarray(i.offset,i.offset+a)}),i.offset+=a}while(i.offset<e.length)}catch(e){e.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",e);break}if(t.done)break}})}sendSeatReservation(t,e,i){const a={offset:0},l=[];oi.encode.string(l,t,a),oi.encode.string(l,e,a),i&&oi.encode.string(l,i,a),this.writer.write(new Uint8Array(l).buffer)}_close(){this.isOpen=!1}}oc.H3TransportTransport=Gd;var lc={},Zd=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},zd=Zd;const oa=globalThis.WebSocket||zd;let Wd=class{constructor(t){this.events=t}send(t){this.ws.send(t)}sendUnreliable(t){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(t,e){try{this.ws=new oa(t,{headers:e,protocols:this.protocols})}catch{this.ws=new oa(t,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(t,e){this.ws.close(t,e)}get isOpen(){return this.ws.readyState===oa.OPEN}};lc.WebSocketTransport=Wd;var Kd=oc,qd=lc;let Yd=class{constructor(t){switch(this.events={},t){case"h3":this.transport=new Kd.H3TransportTransport(this.events);break;default:this.transport=new qd.WebSocketTransport(this.events);break}}connect(t,e){this.transport.connect.call(this.transport,t,e)}send(t){this.transport.send(t)}sendUnreliable(t){this.transport.sendUnreliable(t)}close(t,e){this.transport.close(t,e)}get isOpen(){return this.transport.isOpen}};ac.Connection=Yd;var Ja={};(function(s){s.Protocol=void 0,function(t){t[t.HANDSHAKE=9]="HANDSHAKE",t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.ERROR=11]="ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",t[t.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",t[t.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(s.Protocol||(s.Protocol={})),s.ErrorCode=void 0,function(t){t[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(s.ErrorCode||(s.ErrorCode={}))})(Ja);var zr={};const fc={};function Xd(s,t){fc[s]=t}function Jd(s){const t=fc[s];if(!t)throw new Error("missing serializer: "+s);return t}zr.getSerializer=Jd;zr.registerSerializer=Xd;var Qa={};const Qd=()=>({emit(s,...t){let e=this.events[s]||[];for(let i=0,a=e.length;i<a;i++)e[i](...t)},events:{},on(s,t){var e;return!((e=this.events[s])===null||e===void 0)&&e.push(t)||(this.events[s]=[t]),()=>{var i;this.events[s]=(i=this.events[s])===null||i===void 0?void 0:i.filter(a=>t!==a)}}});Qa.createNanoEvents=Qd;var eo={};class uc{constructor(){this.handlers=[]}register(t,e=!1){return this.handlers.push(t),this}invoke(...t){this.handlers.forEach(e=>e.apply(this,t))}invokeAsync(...t){return Promise.all(this.handlers.map(e=>e.apply(this,t)))}remove(t){const e=this.handlers.indexOf(t);this.handlers[e]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function eh(){const s=new uc;function t(e){return s.register(e,this===null)}return t.once=e=>{const i=function(...a){e.apply(this,a),s.remove(i)};s.register(i)},t.remove=e=>s.remove(e),t.invoke=(...e)=>s.invoke(...e),t.invokeAsync=(...e)=>s.invokeAsync(...e),t.clear=()=>s.clear(),t}eo.EventEmitter=uc;eo.createSignal=eh;var Wr={},Ir=Xa;function th(s){try{return Ir.getDecoderStateCallbacks(s.serializer.decoder)}catch{return}}let nh=class{setState(t,e){this.decoder.decode(t,e)}getState(){return this.state}patch(t,e){return this.decoder.decode(t,e)}teardown(){this.decoder.root.clearRefs()}handshake(t,e){this.state?(Ir.Reflection.decode(t,e),this.decoder=new Ir.Decoder(this.state)):(this.decoder=Ir.Reflection.decode(t,e),this.state=this.decoder.state)}};Wr.SchemaSerializer=nh;Wr.getStateCallbacks=th;var xa;try{xa=new TextDecoder}catch{}var le,Pn,k=0,ft={},Xe,Ls,Nn=0,ss=0,jt,Is,Jt=[],qe,So={useRecords:!1,mapsAsObjects:!0};class dc{}const to=new dc;to.name="MessagePack 0xC1";var Bs=!1,hc=2,Ao;try{new Function("")}catch{hc=1/0}class js{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,e){if(le)return Ec(()=>(Ur(),this?this.unpack(t,e):js.prototype.unpack.call(So,t,e)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof e=="object"?(Pn=e.end||t.length,k=e.start||0):(k=0,Pn=e>-1?e:t.length),ss=0,Ls=null,jt=null,le=t;try{qe=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(i){throw le=null,t instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof js){if(ft=this,this.structures)return Xe=this.structures,_r(e);(!Xe||Xe.length>0)&&(Xe=[])}else ft=So,(!Xe||Xe.length>0)&&(Xe=[]);return _r(e)}unpackMultiple(t,e){let i,a=0;try{Bs=!0;let l=t.length,u=this?this.unpack(t,l):qr.unpack(t,l);if(e){if(e(u,a,k)===!1)return;for(;k<l;)if(a=k,e(_r(),a,k)===!1)return}else{for(i=[u];k<l;)a=k,i.push(_r());return i}}catch(l){throw l.lastPosition=a,l.values=i,l}finally{Bs=!1,Ur()}}_mergeStructures(t,e){t=t||[],Object.isFrozen(t)&&(t=t.map(i=>i.slice(0)));for(let i=0,a=t.length;i<a;i++){let l=t[i];l&&(l.isShared=!0,i>=32&&(l.highByte=i-32>>5))}t.sharedLength=t.length;for(let i in e||[])if(i>=0){let a=t[i],l=e[i];l&&(a&&((t.restoreStructures||(t.restoreStructures=[]))[i]=a),t[i]=l)}return this.structures=t}decode(t,e){return this.unpack(t,e)}}function _r(s){try{if(!ft.trusted&&!Bs){let e=Xe.sharedLength||0;e<Xe.length&&(Xe.length=e)}let t;if(ft.randomAccessStructure&&le[k]<64&&le[k]>=32&&Ao?(t=Ao(le,k,Pn,ft),le=null,!(s&&s.lazy)&&t&&(t=t.toJSON()),k=Pn):t=Dt(),jt&&(k=jt.postBundlePosition,jt=null),Bs&&(Xe.restoreStructures=null),k==Pn)Xe&&Xe.restoreStructures&&Oo(),Xe=null,le=null,Is&&(Is=null);else{if(k>Pn)throw new Error("Unexpected end of MessagePack data");if(!Bs){let e;try{e=JSON.stringify(t,(i,a)=>typeof a=="bigint"?`${a}n`:a).slice(0,100)}catch(i){e="(JSON view not available "+i+")"}throw new Error("Data read, but end of buffer not reached "+e)}}return t}catch(t){throw Xe&&Xe.restoreStructures&&Oo(),Ur(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||k>Pn)&&(t.incomplete=!0),t}}function Oo(){for(let s in Xe.restoreStructures)Xe[s]=Xe.restoreStructures[s];Xe.restoreStructures=null}function Dt(){let s=le[k++];if(s<160)if(s<128){if(s<64)return s;{let t=Xe[s&63]||ft.getStructures&&pc()[s&63];return t?(t.read||(t.read=no(t,s&63)),t.read()):s}}else if(s<144)if(s-=128,ft.mapsAsObjects){let t={};for(let e=0;e<s;e++){let i=mc();i==="__proto__"&&(i="__proto_"),t[i]=Dt()}return t}else{let t=new Map;for(let e=0;e<s;e++)t.set(Dt(),Dt());return t}else{s-=144;let t=new Array(s);for(let e=0;e<s;e++)t[e]=Dt();return ft.freezeData?Object.freeze(t):t}else if(s<192){let t=s-160;if(ss>=k)return Ls.slice(k-Nn,(k+=t)-Nn);if(ss==0&&Pn<140){let e=t<16?so(t):gc(t);if(e!=null)return e}return Da(t)}else{let t;switch(s){case 192:return null;case 193:return jt?(t=Dt(),t>0?jt[1].slice(jt.position1,jt.position1+=t):jt[0].slice(jt.position0,jt.position0-=t)):to;case 194:return!1;case 195:return!0;case 196:if(t=le[k++],t===void 0)throw new Error("Unexpected end of buffer");return la(t);case 197:return t=qe.getUint16(k),k+=2,la(t);case 198:return t=qe.getUint32(k),k+=4,la(t);case 199:return li(le[k++]);case 200:return t=qe.getUint16(k),k+=2,li(t);case 201:return t=qe.getUint32(k),k+=4,li(t);case 202:if(t=qe.getFloat32(k),ft.useFloat32>2){let e=Kr[(le[k]&127)<<1|le[k+1]>>7];return k+=4,(e*t+(t>0?.5:-.5)>>0)/e}return k+=4,t;case 203:return t=qe.getFloat64(k),k+=8,t;case 204:return le[k++];case 205:return t=qe.getUint16(k),k+=2,t;case 206:return t=qe.getUint32(k),k+=4,t;case 207:return ft.int64AsType==="number"?(t=qe.getUint32(k)*4294967296,t+=qe.getUint32(k+4)):ft.int64AsType==="string"?t=qe.getBigUint64(k).toString():ft.int64AsType==="auto"?(t=qe.getBigUint64(k),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=qe.getBigUint64(k),k+=8,t;case 208:return qe.getInt8(k++);case 209:return t=qe.getInt16(k),k+=2,t;case 210:return t=qe.getInt32(k),k+=4,t;case 211:return ft.int64AsType==="number"?(t=qe.getInt32(k)*4294967296,t+=qe.getUint32(k+4)):ft.int64AsType==="string"?t=qe.getBigInt64(k).toString():ft.int64AsType==="auto"?(t=qe.getBigInt64(k),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=qe.getBigInt64(k),k+=8,t;case 212:if(t=le[k++],t==114)return Co(le[k++]&63);{let e=Jt[t];if(e)return e.read?(k++,e.read(Dt())):e.noBuffer?(k++,e()):e(le.subarray(k,++k));throw new Error("Unknown extension "+t)}case 213:return t=le[k],t==114?(k++,Co(le[k++]&63,le[k++])):li(2);case 214:return li(4);case 215:return li(8);case 216:return li(16);case 217:return t=le[k++],ss>=k?Ls.slice(k-Nn,(k+=t)-Nn):ih(t);case 218:return t=qe.getUint16(k),k+=2,ss>=k?Ls.slice(k-Nn,(k+=t)-Nn):rh(t);case 219:return t=qe.getUint32(k),k+=4,ss>=k?Ls.slice(k-Nn,(k+=t)-Nn):ah(t);case 220:return t=qe.getUint16(k),k+=2,Do(t);case 221:return t=qe.getUint32(k),k+=4,Do(t);case 222:return t=qe.getUint16(k),k+=2,Ro(t);case 223:return t=qe.getUint32(k),k+=4,Ro(t);default:if(s>=224)return s-256;if(s===void 0){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+s)}}}const sh=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function no(s,t){function e(){if(e.count++>hc){let a=s.read=new Function("r","return function(){return "+(ft.freezeData?"Object.freeze":"")+"({"+s.map(l=>l==="__proto__"?"__proto_:r()":sh.test(l)?l+":r()":"["+JSON.stringify(l)+"]:r()").join(",")+"})}")(Dt);return s.highByte===0&&(s.read=xo(t,s.read)),a()}let i={};for(let a=0,l=s.length;a<l;a++){let u=s[a];u==="__proto__"&&(u="__proto_"),i[u]=Dt()}return ft.freezeData?Object.freeze(i):i}return e.count=0,s.highByte===0?xo(t,e):e}const xo=(s,t)=>function(){let e=le[k++];if(e===0)return t();let i=s<32?-(s+(e<<5)):s+(e<<5),a=Xe[i]||pc()[i];if(!a)throw new Error("Record id is not defined for "+i);return a.read||(a.read=no(a,s)),a.read()};function pc(){let s=Ec(()=>(le=null,ft.getStructures()));return Xe=ft._mergeStructures(s,Xe)}var Da=fr,ih=fr,rh=fr,ah=fr;let oh=!1;function fr(s){let t;if(s<16&&(t=so(s)))return t;if(s>64&&xa)return xa.decode(le.subarray(k,k+=s));const e=k+s,i=[];for(t="";k<e;){const a=le[k++];if(!(a&128))i.push(a);else if((a&224)===192){const l=le[k++]&63;i.push((a&31)<<6|l)}else if((a&240)===224){const l=le[k++]&63,u=le[k++]&63;i.push((a&31)<<12|l<<6|u)}else if((a&248)===240){const l=le[k++]&63,u=le[k++]&63,d=le[k++]&63;let m=(a&7)<<18|l<<12|u<<6|d;m>65535&&(m-=65536,i.push(m>>>10&1023|55296),m=56320|m&1023),i.push(m)}else i.push(a);i.length>=4096&&(t+=Ft.apply(String,i),i.length=0)}return i.length>0&&(t+=Ft.apply(String,i)),t}function Do(s){let t=new Array(s);for(let e=0;e<s;e++)t[e]=Dt();return ft.freezeData?Object.freeze(t):t}function Ro(s){if(ft.mapsAsObjects){let t={};for(let e=0;e<s;e++){let i=mc();i==="__proto__"&&(i="__proto_"),t[i]=Dt()}return t}else{let t=new Map;for(let e=0;e<s;e++)t.set(Dt(),Dt());return t}}var Ft=String.fromCharCode;function gc(s){let t=k,e=new Array(s);for(let i=0;i<s;i++){const a=le[k++];if((a&128)>0){k=t;return}e[i]=a}return Ft.apply(String,e)}function so(s){if(s<4)if(s<2){if(s===0)return"";{let t=le[k++];if((t&128)>1){k-=1;return}return Ft(t)}}else{let t=le[k++],e=le[k++];if((t&128)>0||(e&128)>0){k-=2;return}if(s<3)return Ft(t,e);let i=le[k++];if((i&128)>0){k-=3;return}return Ft(t,e,i)}else{let t=le[k++],e=le[k++],i=le[k++],a=le[k++];if((t&128)>0||(e&128)>0||(i&128)>0||(a&128)>0){k-=4;return}if(s<6){if(s===4)return Ft(t,e,i,a);{let l=le[k++];if((l&128)>0){k-=5;return}return Ft(t,e,i,a,l)}}else if(s<8){let l=le[k++],u=le[k++];if((l&128)>0||(u&128)>0){k-=6;return}if(s<7)return Ft(t,e,i,a,l,u);let d=le[k++];if((d&128)>0){k-=7;return}return Ft(t,e,i,a,l,u,d)}else{let l=le[k++],u=le[k++],d=le[k++],m=le[k++];if((l&128)>0||(u&128)>0||(d&128)>0||(m&128)>0){k-=8;return}if(s<10){if(s===8)return Ft(t,e,i,a,l,u,d,m);{let g=le[k++];if((g&128)>0){k-=9;return}return Ft(t,e,i,a,l,u,d,m,g)}}else if(s<12){let g=le[k++],y=le[k++];if((g&128)>0||(y&128)>0){k-=10;return}if(s<11)return Ft(t,e,i,a,l,u,d,m,g,y);let h=le[k++];if((h&128)>0){k-=11;return}return Ft(t,e,i,a,l,u,d,m,g,y,h)}else{let g=le[k++],y=le[k++],h=le[k++],I=le[k++];if((g&128)>0||(y&128)>0||(h&128)>0||(I&128)>0){k-=12;return}if(s<14){if(s===12)return Ft(t,e,i,a,l,u,d,m,g,y,h,I);{let j=le[k++];if((j&128)>0){k-=13;return}return Ft(t,e,i,a,l,u,d,m,g,y,h,I,j)}}else{let j=le[k++],J=le[k++];if((j&128)>0||(J&128)>0){k-=14;return}if(s<15)return Ft(t,e,i,a,l,u,d,m,g,y,h,I,j,J);let H=le[k++];if((H&128)>0){k-=15;return}return Ft(t,e,i,a,l,u,d,m,g,y,h,I,j,J,H)}}}}}function No(){let s=le[k++],t;if(s<192)t=s-160;else switch(s){case 217:t=le[k++];break;case 218:t=qe.getUint16(k),k+=2;break;case 219:t=qe.getUint32(k),k+=4;break;default:throw new Error("Expected string")}return fr(t)}function la(s){return ft.copyBuffers?Uint8Array.prototype.slice.call(le,k,k+=s):le.subarray(k,k+=s)}function li(s){let t=le[k++];if(Jt[t]){let e;return Jt[t](le.subarray(k,e=k+=s),i=>{k=i;try{return Dt()}finally{k=e}})}else throw new Error("Unknown extension type "+t)}var Po=new Array(4096);function mc(){let s=le[k++];if(s>=160&&s<192){if(s=s-160,ss>=k)return Ls.slice(k-Nn,(k+=s)-Nn);if(!(ss==0&&Pn<180))return Da(s)}else return k--,yc(Dt());let t=(s<<5^(s>1?qe.getUint16(k):s>0?le[k]:0))&4095,e=Po[t],i=k,a=k+s-3,l,u=0;if(e&&e.bytes==s){for(;i<a;){if(l=qe.getUint32(i),l!=e[u++]){i=1879048192;break}i+=4}for(a+=3;i<a;)if(l=le[i++],l!=e[u++]){i=1879048192;break}if(i===a)return k=i,e.string;a-=3,i=k}for(e=[],Po[t]=e,e.bytes=s;i<a;)l=qe.getUint32(i),e.push(l),i+=4;for(a+=3;i<a;)l=le[i++],e.push(l);let d=s<16?so(s):gc(s);return d!=null?e.string=d:e.string=Da(s)}function yc(s){if(typeof s=="string")return s;if(typeof s=="number"||typeof s=="boolean"||typeof s=="bigint")return s.toString();if(s==null)return s+"";if(ft.allowArraysInMapKeys&&Array.isArray(s)&&s.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return s.flat().toString();throw new Error(`Invalid property type for record: ${typeof s}`)}const Co=(s,t)=>{let e=Dt().map(yc),i=s;t!==void 0&&(s=s<32?-((t<<5)+s):(t<<5)+s,e.highByte=t);let a=Xe[s];return a&&(a.isShared||Bs)&&((Xe.restoreStructures||(Xe.restoreStructures=[]))[s]=a),Xe[s]=e,e.read=no(e,i),e.read()};Jt[0]=()=>{};Jt[0].noBuffer=!0;Jt[66]=s=>{let t=s.length,e=BigInt(s[0]&128?s[0]-256:s[0]);for(let i=1;i<t;i++)e<<=BigInt(8),e+=BigInt(s[i]);return e};let lh={Error,TypeError,ReferenceError};Jt[101]=()=>{let s=Dt();return(lh[s[0]]||Error)(s[1],{cause:s[2]})};Jt[105]=s=>{if(ft.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=qe.getUint32(k-4);Is||(Is=new Map);let e=le[k],i;e>=144&&e<160||e==220||e==221?i=[]:i={};let a={target:i};Is.set(t,a);let l=Dt();return a.used?Object.assign(i,l):(a.target=l,l)};Jt[112]=s=>{if(ft.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=qe.getUint32(k-4),e=Is.get(t);return e.used=!0,e.target};Jt[115]=()=>new Set(Dt());const bc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(s=>s+"Array");let ch=typeof globalThis=="object"?globalThis:window;Jt[116]=s=>{let t=s[0],e=bc[t];if(!e){if(t===16){let i=new ArrayBuffer(s.length-1);return new Uint8Array(i).set(s.subarray(1)),i}throw new Error("Could not find typed array for code "+t)}return new ch[e](Uint8Array.prototype.slice.call(s,1).buffer)};Jt[120]=()=>{let s=Dt();return new RegExp(s[0],s[1])};const fh=[];Jt[98]=s=>{let t=(s[0]<<24)+(s[1]<<16)+(s[2]<<8)+s[3],e=k;return k+=t-s.length,jt=fh,jt=[No(),No()],jt.position0=0,jt.position1=0,jt.postBundlePosition=k,k=e,Dt()};Jt[255]=s=>s.length==4?new Date((s[0]*16777216+(s[1]<<16)+(s[2]<<8)+s[3])*1e3):s.length==8?new Date(((s[0]<<22)+(s[1]<<14)+(s[2]<<6)+(s[3]>>2))/1e6+((s[3]&3)*4294967296+s[4]*16777216+(s[5]<<16)+(s[6]<<8)+s[7])*1e3):s.length==12?new Date(((s[0]<<24)+(s[1]<<16)+(s[2]<<8)+s[3])/1e6+((s[4]&128?-281474976710656:0)+s[6]*1099511627776+s[7]*4294967296+s[8]*16777216+(s[9]<<16)+(s[10]<<8)+s[11])*1e3):new Date("invalid");function Ec(s){let t=Pn,e=k,i=Nn,a=ss,l=Ls,u=Is,d=jt,m=new Uint8Array(le.slice(0,Pn)),g=Xe,y=Xe.slice(0,Xe.length),h=ft,I=Bs,j=s();return Pn=t,k=e,Nn=i,ss=a,Ls=l,Is=u,jt=d,le=m,Bs=I,Xe=g,Xe.splice(0,Xe.length,...y),ft=h,qe=new DataView(le.buffer,le.byteOffset,le.byteLength),j}function Ur(){le=null,Is=null,Xe=null}function uh(s){s.unpack?Jt[s.type]=s.unpack:Jt[s.type]=s}const Kr=new Array(147);for(let s=0;s<256;s++)Kr[s]=+("1e"+Math.floor(45.15-s*.30103));const dh=js;var qr=new js({useRecords:!1});const hh=qr.unpack,ph=qr.unpackMultiple,gh=qr.unpack,vc={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let _c=new Float32Array(1),Lo=new Uint8Array(_c.buffer,0,4);function mh(s){_c[0]=s;let t=Kr[(Lo[3]&127)<<1|Lo[2]>>7];return(t*s+(s>0?.5:-.5)>>0)/t}let Sr;try{Sr=new TextEncoder}catch{}let Fr,io;const Yr=typeof Buffer<"u",wr=Yr?function(s){return Buffer.allocUnsafeSlow(s)}:Uint8Array,wc=Yr?Buffer:Uint8Array,ko=Yr?4294967296:2144337920;let F,Vi,dt,B=0,cn,vt=null,yh;const bh=21760,Eh=/[\u0080-\uFFFF]/,bi=Symbol("record-id");class ur extends js{constructor(t){super(t),this.offset=0;let e,i,a,l,u=wc.prototype.utf8Write?function(V,se){return F.utf8Write(V,se,F.byteLength-se)}:Sr&&Sr.encodeInto?function(V,se){return Sr.encodeInto(V,F.subarray(se)).written}:!1,d=this;t||(t={});let m=t&&t.sequential,g=t.structures||t.saveStructures,y=t.maxSharedStructures;if(y==null&&(y=g?32:0),y>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=g?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let I=y>32||h+y>64,j=y+64,J=y+h+64;if(J>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let H=[],z=0,ue=0;this.pack=this.encode=function(V,se){if(F||(F=new wr(8192),dt=F.dataView||(F.dataView=new DataView(F.buffer,0,8192)),B=0),cn=F.length-10,cn-B<2048?(F=new wr(F.length),dt=F.dataView||(F.dataView=new DataView(F.buffer,0,F.length)),cn=F.length-10,B=0):B=B+7&2147483640,e=B,se&Ac&&(B+=se&255),l=d.structuredClone?new Map:null,d.bundleStrings&&typeof V!="string"?(vt=[],vt.size=1/0):vt=null,a=d.structures,a){a.uninitialized&&(a=d._mergeStructures(d.getStructures()));let ee=a.sharedLength||0;if(ee>y)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+a.sharedLength);if(!a.transitions){a.transitions=Object.create(null);for(let ne=0;ne<ee;ne++){let ge=a[ne];if(!ge)continue;let Re,Ie=a.transitions;for(let We=0,Ge=ge.length;We<Ge;We++){let lt=ge[We];Re=Ie[lt],Re||(Re=Ie[lt]=Object.create(null)),Ie=Re}Ie[bi]=ne+64}this.lastNamedStructuresLength=ee}m||(a.nextId=ee+64)}i&&(i=!1);let te;try{d.randomAccessStructure&&V&&V.constructor&&V.constructor===Object?Ve(V):Te(V);let ee=vt;if(vt&&Mo(e,Te,0),l&&l.idsToInsert){let ne=l.idsToInsert.sort((We,Ge)=>We.offset>Ge.offset?1:-1),ge=ne.length,Re=-1;for(;ee&&ge>0;){let We=ne[--ge].offset+e;We<ee.stringsPosition+e&&Re===-1&&(Re=0),We>ee.position+e?Re>=0&&(Re+=6):(Re>=0&&(dt.setUint32(ee.position+e,dt.getUint32(ee.position+e)+Re),Re=-1),ee=ee.previous,ge++)}Re>=0&&ee&&dt.setUint32(ee.position+e,dt.getUint32(ee.position+e)+Re),B+=ne.length*6,B>cn&&ot(B),d.offset=B;let Ie=_h(F.subarray(e,B),ne);return l=null,Ie}return d.offset=B,se&Ic?(F.start=e,F.end=B,F):F.subarray(e,B)}catch(ee){throw te=ee,ee}finally{if(a&&(de(),i&&d.saveStructures)){let ee=a.sharedLength||0,ne=F.subarray(e,B),ge=Th(a,d);if(!te)return d.saveStructures(ge,ge.isCompatible)===!1?d.pack(V,se):(d.lastNamedStructuresLength=ee,F.length>1073741824&&(F=null),ne)}F.length>1073741824&&(F=null),se&Sc&&(B=e)}};const de=()=>{ue<10&&ue++;let V=a.sharedLength||0;if(a.length>V&&!m&&(a.length=V),z>1e4)a.transitions=null,ue=0,z=0,H.length>0&&(H=[]);else if(H.length>0&&!m){for(let se=0,te=H.length;se<te;se++)H[se][bi]=0;H=[]}},re=V=>{var se=V.length;se<16?F[B++]=144|se:se<65536?(F[B++]=220,F[B++]=se>>8,F[B++]=se&255):(F[B++]=221,dt.setUint32(B,se),B+=4);for(let te=0;te<se;te++)Te(V[te])},Te=V=>{B>cn&&(F=ot(B));var se=typeof V,te;if(se==="string"){let ee=V.length;if(vt&&ee>=4&&ee<4096){if((vt.size+=ee)>bh){let Ie,We=(vt[0]?vt[0].length*3+vt[1].length:0)+10;B+We>cn&&(F=ot(B+We));let Ge;vt.position?(Ge=vt,F[B]=200,B+=3,F[B++]=98,Ie=B-e,B+=4,Mo(e,Te,0),dt.setUint16(Ie+e-3,B-e-Ie)):(F[B++]=214,F[B++]=98,Ie=B-e,B+=4),vt=["",""],vt.previous=Ge,vt.size=0,vt.position=Ie}let Re=Eh.test(V);vt[Re?0:1]+=V,F[B++]=193,Te(Re?-ee:ee);return}let ne;ee<32?ne=1:ee<256?ne=2:ee<65536?ne=3:ne=5;let ge=ee*3;if(B+ge>cn&&(F=ot(B+ge)),ee<64||!u){let Re,Ie,We,Ge=B+ne;for(Re=0;Re<ee;Re++)Ie=V.charCodeAt(Re),Ie<128?F[Ge++]=Ie:Ie<2048?(F[Ge++]=Ie>>6|192,F[Ge++]=Ie&63|128):(Ie&64512)===55296&&((We=V.charCodeAt(Re+1))&64512)===56320?(Ie=65536+((Ie&1023)<<10)+(We&1023),Re++,F[Ge++]=Ie>>18|240,F[Ge++]=Ie>>12&63|128,F[Ge++]=Ie>>6&63|128,F[Ge++]=Ie&63|128):(F[Ge++]=Ie>>12|224,F[Ge++]=Ie>>6&63|128,F[Ge++]=Ie&63|128);te=Ge-B-ne}else te=u(V,B+ne);te<32?F[B++]=160|te:te<256?(ne<2&&F.copyWithin(B+2,B+1,B+1+te),F[B++]=217,F[B++]=te):te<65536?(ne<3&&F.copyWithin(B+3,B+2,B+2+te),F[B++]=218,F[B++]=te>>8,F[B++]=te&255):(ne<5&&F.copyWithin(B+5,B+3,B+3+te),F[B++]=219,dt.setUint32(B,te),B+=4),B+=te}else if(se==="number")if(V>>>0===V)V<32||V<128&&this.useRecords===!1||V<64&&!this.randomAccessStructure?F[B++]=V:V<256?(F[B++]=204,F[B++]=V):V<65536?(F[B++]=205,F[B++]=V>>8,F[B++]=V&255):(F[B++]=206,dt.setUint32(B,V),B+=4);else if(V>>0===V)V>=-32?F[B++]=256+V:V>=-128?(F[B++]=208,F[B++]=V+256):V>=-32768?(F[B++]=209,dt.setInt16(B,V),B+=2):(F[B++]=210,dt.setInt32(B,V),B+=4);else{let ee;if((ee=this.useFloat32)>0&&V<4294967296&&V>=-2147483648){F[B++]=202,dt.setFloat32(B,V);let ne;if(ee<4||(ne=V*Kr[(F[B]&127)<<1|F[B+1]>>7])>>0===ne){B+=4;return}else B--}F[B++]=203,dt.setFloat64(B,V),B+=8}else if(se==="object"||se==="function")if(!V)F[B++]=192;else{if(l){let ne=l.get(V);if(ne){if(!ne.id){let ge=l.idsToInsert||(l.idsToInsert=[]);ne.id=ge.push(ne)}F[B++]=214,F[B++]=112,dt.setUint32(B,ne.id),B+=4;return}else l.set(V,{offset:B-e})}let ee=V.constructor;if(ee===Object)mt(V);else if(ee===Array)re(V);else if(ee===Map)if(this.mapAsEmptyObject)F[B++]=128;else{te=V.size,te<16?F[B++]=128|te:te<65536?(F[B++]=222,F[B++]=te>>8,F[B++]=te&255):(F[B++]=223,dt.setUint32(B,te),B+=4);for(let[ne,ge]of V)Te(ne),Te(ge)}else{for(let ne=0,ge=Fr.length;ne<ge;ne++){let Re=io[ne];if(V instanceof Re){let Ie=Fr[ne];if(Ie.write){Ie.type&&(F[B++]=212,F[B++]=Ie.type,F[B++]=0);let Ct=Ie.write.call(this,V);Ct===V?Array.isArray(V)?re(V):mt(V):Te(Ct);return}let We=F,Ge=dt,lt=B;F=null;let Tt;try{Tt=Ie.pack.call(this,V,Ct=>(F=We,We=null,B+=Ct,B>cn&&ot(B),{target:F,targetView:dt,position:B-Ct}),Te)}finally{We&&(F=We,dt=Ge,B=lt,cn=F.length-10)}Tt&&(Tt.length+B>cn&&ot(Tt.length+B),B=vh(Tt,F,B,Ie.type));return}}if(Array.isArray(V))re(V);else{if(V.toJSON){const ne=V.toJSON();if(ne!==V)return Te(ne)}if(se==="function")return Te(this.writeFunction&&this.writeFunction(V));mt(V)}}}else if(se==="boolean")F[B++]=V?195:194;else if(se==="bigint"){if(V<BigInt(1)<<BigInt(63)&&V>=-(BigInt(1)<<BigInt(63)))F[B++]=211,dt.setBigInt64(B,V);else if(V<BigInt(1)<<BigInt(64)&&V>0)F[B++]=207,dt.setBigUint64(B,V);else if(this.largeBigIntToFloat)F[B++]=203,dt.setFloat64(B,Number(V));else{if(this.largeBigIntToString)return Te(V.toString());if(this.useBigIntExtension&&V<BigInt(2)**BigInt(1023)&&V>-(BigInt(2)**BigInt(1023))){F[B++]=199,B++,F[B++]=66;let ee=[],ne;do{let ge=V&BigInt(255);ne=(ge&BigInt(128))===(V<BigInt(0)?BigInt(128):BigInt(0)),ee.push(ge),V>>=BigInt(8)}while(!((V===BigInt(0)||V===BigInt(-1))&&ne));F[B-2]=ee.length;for(let ge=ee.length;ge>0;)F[B++]=Number(ee[--ge]);return}else throw new RangeError(V+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}B+=8}else if(se==="undefined")this.encodeUndefinedAsNil?F[B++]=192:(F[B++]=212,F[B++]=0,F[B++]=0);else throw new Error("Unknown type: "+se)},$e=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?V=>{let se;if(this.skipValues){se=[];for(let ne in V)(typeof V.hasOwnProperty!="function"||V.hasOwnProperty(ne))&&!this.skipValues.includes(V[ne])&&se.push(ne)}else se=Object.keys(V);let te=se.length;te<16?F[B++]=128|te:te<65536?(F[B++]=222,F[B++]=te>>8,F[B++]=te&255):(F[B++]=223,dt.setUint32(B,te),B+=4);let ee;if(this.coercibleKeyAsNumber)for(let ne=0;ne<te;ne++){ee=se[ne];let ge=Number(ee);Te(isNaN(ge)?ee:ge),Te(V[ee])}else for(let ne=0;ne<te;ne++)Te(ee=se[ne]),Te(V[ee])}:V=>{F[B++]=222;let se=B-e;B+=2;let te=0;for(let ee in V)(typeof V.hasOwnProperty!="function"||V.hasOwnProperty(ee))&&(Te(ee),Te(V[ee]),te++);if(te>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');F[se+++e]=te>>8,F[se+e]=te&255},tt=this.useRecords===!1?$e:t.progressiveRecords&&!I?V=>{let se,te=a.transitions||(a.transitions=Object.create(null)),ee=B++-e,ne;for(let ge in V)if(typeof V.hasOwnProperty!="function"||V.hasOwnProperty(ge)){if(se=te[ge],se)te=se;else{let Re=Object.keys(V),Ie=te;te=a.transitions;let We=0;for(let Ge=0,lt=Re.length;Ge<lt;Ge++){let Tt=Re[Ge];se=te[Tt],se||(se=te[Tt]=Object.create(null),We++),te=se}ee+e+1==B?(B--,Rt(te,Re,We)):Je(te,Re,ee,We),ne=!0,te=Ie[ge]}Te(V[ge])}if(!ne){let ge=te[bi];ge?F[ee+e]=ge:Je(te,Object.keys(V),ee,0)}}:V=>{let se,te=a.transitions||(a.transitions=Object.create(null)),ee=0;for(let ge in V)(typeof V.hasOwnProperty!="function"||V.hasOwnProperty(ge))&&(se=te[ge],se||(se=te[ge]=Object.create(null),ee++),te=se);let ne=te[bi];ne?ne>=96&&I?(F[B++]=((ne-=96)&31)+96,F[B++]=ne>>5):F[B++]=ne:Rt(te,te.__keys__||Object.keys(V),ee);for(let ge in V)(typeof V.hasOwnProperty!="function"||V.hasOwnProperty(ge))&&Te(V[ge])},at=typeof this.useRecords=="function"&&this.useRecords,mt=at?V=>{at(V)?tt(V):$e(V)}:tt,ot=V=>{let se;if(V>16777216){if(V-e>ko)throw new Error("Packed buffer would be larger than maximum buffer size");se=Math.min(ko,Math.round(Math.max((V-e)*(V>67108864?1.25:2),4194304)/4096)*4096)}else se=(Math.max(V-e<<2,F.length-1)>>12)+1<<12;let te=new wr(se);return dt=te.dataView||(te.dataView=new DataView(te.buffer,0,se)),V=Math.min(V,F.length),F.copy?F.copy(te,0,e,V):te.set(F.slice(e,V)),B-=e,e=0,cn=te.length-10,F=te},Rt=(V,se,te)=>{let ee=a.nextId;ee||(ee=64),ee<j&&this.shouldShareStructure&&!this.shouldShareStructure(se)?(ee=a.nextOwnId,ee<J||(ee=j),a.nextOwnId=ee+1):(ee>=J&&(ee=j),a.nextId=ee+1);let ne=se.highByte=ee>=96&&I?ee-96>>5:-1;V[bi]=ee,V.__keys__=se,a[ee-64]=se,ee<j?(se.isShared=!0,a.sharedLength=ee-63,i=!0,ne>=0?(F[B++]=(ee&31)+96,F[B++]=ne):F[B++]=ee):(ne>=0?(F[B++]=213,F[B++]=114,F[B++]=(ee&31)+96,F[B++]=ne):(F[B++]=212,F[B++]=114,F[B++]=ee),te&&(z+=ue*te),H.length>=h&&(H.shift()[bi]=0),H.push(V),Te(se))},Je=(V,se,te,ee)=>{let ne=F,ge=B,Re=cn,Ie=e;F=Vi,B=0,e=0,F||(Vi=F=new wr(8192)),cn=F.length-10,Rt(V,se,ee),Vi=F;let We=B;if(F=ne,B=ge,cn=Re,e=Ie,We>1){let Ge=B+We-1;Ge>cn&&ot(Ge);let lt=te+e;F.copyWithin(lt+We,lt+1,B),F.set(Vi.slice(0,We),lt),B=Ge}else F[te+e]=Vi[0]},Ve=V=>{let se=yh(V,F,e,B,a,ot,(te,ee,ne)=>{if(ne)return i=!0;B=ee;let ge=F;return Te(te),de(),ge!==F?{position:B,targetView:dt,target:F}:B},this);if(se===0)return mt(V);B=se}}useBuffer(t){F=t,F.dataView||(F.dataView=new DataView(F.buffer,F.byteOffset,F.byteLength)),B=0}set position(t){B=t}get position(){return B}set buffer(t){F=t}get buffer(){return F}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}io=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,dc];Fr=[{pack(s,t,e){let i=s.getTime()/1e3;if((this.useTimestamp32||s.getMilliseconds()===0)&&i>=0&&i<4294967296){let{target:a,targetView:l,position:u}=t(6);a[u++]=214,a[u++]=255,l.setUint32(u,i)}else if(i>0&&i<4294967296){let{target:a,targetView:l,position:u}=t(10);a[u++]=215,a[u++]=255,l.setUint32(u,s.getMilliseconds()*4e6+(i/1e3/4294967296>>0)),l.setUint32(u+4,i)}else if(isNaN(i)){if(this.onInvalidDate)return t(0),e(this.onInvalidDate());let{target:a,targetView:l,position:u}=t(3);a[u++]=212,a[u++]=255,a[u++]=255}else{let{target:a,targetView:l,position:u}=t(15);a[u++]=199,a[u++]=12,a[u++]=255,l.setUint32(u,s.getMilliseconds()*1e6),l.setBigInt64(u+4,BigInt(Math.floor(i)))}}},{pack(s,t,e){if(this.setAsEmptyObject)return t(0),e({});let i=Array.from(s),{target:a,position:l}=t(this.moreTypes?3:0);this.moreTypes&&(a[l++]=212,a[l++]=115,a[l++]=0),e(i)}},{pack(s,t,e){let{target:i,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(i[a++]=212,i[a++]=101,i[a++]=0),e([s.name,s.message,s.cause])}},{pack(s,t,e){let{target:i,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(i[a++]=212,i[a++]=120,i[a++]=0),e([s.source,s.flags])}},{pack(s,t){this.moreTypes?Bo(s,16,t):$o(Yr?Buffer.from(s):new Uint8Array(s),t)}},{pack(s,t){let e=s.constructor;e!==wc&&this.moreTypes?Bo(s,bc.indexOf(e.name),t):$o(s,t)}},{pack(s,t){let{target:e,position:i}=t(1);e[i]=193}}];function Bo(s,t,e,i){let a=s.byteLength;if(a+1<256){var{target:l,position:u}=e(4+a);l[u++]=199,l[u++]=a+1}else if(a+1<65536){var{target:l,position:u}=e(5+a);l[u++]=200,l[u++]=a+1>>8,l[u++]=a+1&255}else{var{target:l,position:u,targetView:d}=e(7+a);l[u++]=201,d.setUint32(u,a+1),u+=4}l[u++]=116,l[u++]=t,s.buffer||(s=new Uint8Array(s)),l.set(new Uint8Array(s.buffer,s.byteOffset,s.byteLength),u)}function $o(s,t){let e=s.byteLength;var i,a;if(e<256){var{target:i,position:a}=t(e+2);i[a++]=196,i[a++]=e}else if(e<65536){var{target:i,position:a}=t(e+3);i[a++]=197,i[a++]=e>>8,i[a++]=e&255}else{var{target:i,position:a,targetView:l}=t(e+5);i[a++]=198,l.setUint32(a,e),a+=4}i.set(s,a)}function vh(s,t,e,i){let a=s.length;switch(a){case 1:t[e++]=212;break;case 2:t[e++]=213;break;case 4:t[e++]=214;break;case 8:t[e++]=215;break;case 16:t[e++]=216;break;default:a<256?(t[e++]=199,t[e++]=a):a<65536?(t[e++]=200,t[e++]=a>>8,t[e++]=a&255):(t[e++]=201,t[e++]=a>>24,t[e++]=a>>16&255,t[e++]=a>>8&255,t[e++]=a&255)}return t[e++]=i,t.set(s,e),e+=a,e}function _h(s,t){let e,i=t.length*6,a=s.length-i;for(;e=t.pop();){let l=e.offset,u=e.id;s.copyWithin(l+i,l,a),i-=6;let d=l+i;s[d++]=214,s[d++]=105,s[d++]=u>>24,s[d++]=u>>16&255,s[d++]=u>>8&255,s[d++]=u&255,a=l}return s}function Mo(s,t,e){if(vt.length>0){dt.setUint32(vt.position+s,B+e-vt.position-s),vt.stringsPosition=B-s;let i=vt;vt=null,t(i[0]),t(i[1])}}function wh(s){if(s.Class){if(!s.pack&&!s.write)throw new Error("Extension has no pack or write function");if(s.pack&&!s.type)throw new Error("Extension has no type (numeric code to identify the extension)");io.unshift(s.Class),Fr.unshift(s)}uh(s)}function Th(s,t){return s.isCompatible=e=>{let i=!e||(t.lastNamedStructuresLength||0)===e.length;return i||t._mergeStructures(e),i},s}let Tc=new ur({useRecords:!1});const Ih=Tc.pack,Sh=Tc.pack,Ah=ur,{NEVER:Oh,ALWAYS:xh,DECIMAL_ROUND:Dh,DECIMAL_FIT:Rh}=vc,Ic=512,Sc=1024,Ac=2048;function Nh(s,t={}){if(!s||typeof s!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof s[Symbol.iterator]=="function")return Ph(s,t);if(typeof s.then=="function"||typeof s[Symbol.asyncIterator]=="function")return Ch(s,t);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Ph(s,t){const e=new ur(t);for(const i of s)yield e.pack(i)}async function*Ch(s,t){const e=new ur(t);for await(const i of s)yield e.pack(i)}function Lh(s,t={}){if(!s||typeof s!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const e=new js(t);let i;const a=l=>{let u;i&&(l=Buffer.concat([i,l]),i=void 0);try{u=e.unpackMultiple(l)}catch(d){if(d.incomplete)i=l.slice(d.lastPosition),u=d.values;else throw d}return u};if(typeof s[Symbol.iterator]=="function")return function*(){for(const u of s)yield*a(u)}();if(typeof s[Symbol.asyncIterator]=="function")return async function*(){for await(const u of s)yield*a(u)}()}const kh=Lh,Bh=Nh,$h=!1,Mh=!0,Uh=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:xh,C1:to,DECIMAL_FIT:Rh,DECIMAL_ROUND:Dh,Decoder:dh,Encoder:Ah,FLOAT32_OPTIONS:vc,NEVER:Oh,Packr:ur,RESERVE_START_SPACE:Ac,RESET_BUFFER_MODE:Sc,REUSE_BUFFER_MODE:Ic,Unpackr:js,addExtension:wh,clearSource:Ur,decode:gh,decodeIter:kh,encode:Sh,encodeIter:Bh,isNativeAccelerationEnabled:oh,mapsAsObjects:Mh,pack:Ih,roundFloat32:mh,unpack:hh,unpackMultiple:ph,useRecords:$h},Symbol.toStringTag,{value:"Module"})),Fh=ka(Uh);var Vh=ac,Rn=Ja,Uo=zr,jh=Qa,Tr=eo,qt=Xa,Hh=Wr,Fo=cr,Vo=Fh;let Gh=class Oc{constructor(t,e){this.onStateChange=Tr.createSignal(),this.onError=Tr.createSignal(),this.onLeave=Tr.createSignal(),this.onJoin=Tr.createSignal(),this.hasJoined=!1,this.onMessageHandlers=jh.createNanoEvents(),this.roomId=null,this.name=t,this.packr=new Vo.Packr,this.packr.encode(void 0),e&&(this.serializer=new(Uo.getSerializer("schema")),this.rootSchema=e,this.serializer.state=new e),this.onError((i,a)=>{var l;return(l=console.warn)===null||l===void 0?void 0:l.call(console,`colyseus.js - onError => (${i}) ${a}`)}),this.onLeave(()=>this.removeAllListeners())}connect(t,e,i=this,a,l){const u=new Vh.Connection(a.protocol);if(i.connection=u,u.events.onmessage=Oc.prototype.onMessageCallback.bind(i),u.events.onclose=function(d){var m;if(!i.hasJoined){(m=console.warn)===null||m===void 0||m.call(console,`Room connection was closed unexpectedly (${d.code}): ${d.reason}`),i.onError.invoke(d.code,d.reason);return}d.code===Fo.CloseCode.DEVMODE_RESTART&&e?e():(i.onLeave.invoke(d.code,d.reason),i.destroy())},u.events.onerror=function(d){var m;(m=console.warn)===null||m===void 0||m.call(console,`Room, onError (${d.code}): ${d.reason}`),i.onError.invoke(d.code,d.reason)},a.protocol==="h3"){const d=new URL(t);u.connect(d.origin,a)}else u.connect(t,l)}leave(t=!0){return new Promise(e=>{this.onLeave(i=>e(i)),this.connection?t?(this.packr.buffer[0]=Rn.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(Fo.CloseCode.CONSENTED)})}onMessage(t,e){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),e)}send(t,e){const i={offset:1};this.packr.buffer[0]=Rn.Protocol.ROOM_DATA,typeof t=="string"?qt.encode.string(this.packr.buffer,t,i):qt.encode.number(this.packr.buffer,t,i),this.packr.position=0;const a=e!==void 0?this.packr.pack(e,2048+i.offset):this.packr.buffer.subarray(0,i.offset);this.connection.send(a)}sendUnreliable(t,e){const i={offset:1};this.packr.buffer[0]=Rn.Protocol.ROOM_DATA,typeof t=="string"?qt.encode.string(this.packr.buffer,t,i):qt.encode.number(this.packr.buffer,t,i),this.packr.position=0;const a=e!==void 0?this.packr.pack(e,2048+i.offset):this.packr.buffer.subarray(0,i.offset);this.connection.sendUnreliable(a)}sendBytes(t,e){const i={offset:1};if(this.packr.buffer[0]=Rn.Protocol.ROOM_DATA_BYTES,typeof t=="string"?qt.encode.string(this.packr.buffer,t,i):qt.encode.number(this.packr.buffer,t,i),e.byteLength+i.offset>this.packr.buffer.byteLength){const a=new Uint8Array(i.offset+e.byteLength);a.set(this.packr.buffer),this.packr.useBuffer(a)}this.packr.buffer.set(e,i.offset),this.connection.send(this.packr.buffer.subarray(0,i.offset+e.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof Hh.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(t){const e=new Uint8Array(t.data),i={offset:1},a=e[0];if(a===Rn.Protocol.JOIN_ROOM){const l=qt.decode.utf8Read(e,i,e[i.offset++]);if(this.serializerId=qt.decode.utf8Read(e,i,e[i.offset++]),!this.serializer){const u=Uo.getSerializer(this.serializerId);this.serializer=new u}e.byteLength>i.offset&&this.serializer.handshake&&this.serializer.handshake(e,i),this.reconnectionToken=`${this.roomId}:${l}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=Rn.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(a===Rn.Protocol.ERROR){const l=qt.decode.number(e,i),u=qt.decode.string(e,i);this.onError.invoke(l,u)}else if(a===Rn.Protocol.LEAVE_ROOM)this.leave();else if(a===Rn.Protocol.ROOM_STATE)this.serializer.setState(e,i),this.onStateChange.invoke(this.serializer.getState());else if(a===Rn.Protocol.ROOM_STATE_PATCH)this.serializer.patch(e,i),this.onStateChange.invoke(this.serializer.getState());else if(a===Rn.Protocol.ROOM_DATA){const l=qt.decode.stringCheck(e,i)?qt.decode.string(e,i):qt.decode.number(e,i),u=e.byteLength>i.offset?Vo.unpack(e,{start:i.offset}):void 0;this.dispatchMessage(l,u)}else if(a===Rn.Protocol.ROOM_DATA_BYTES){const l=qt.decode.stringCheck(e,i)?qt.decode.string(e,i):qt.decode.number(e,i);this.dispatchMessage(l,e.subarray(i.offset))}}dispatchMessage(t,e){var i;const a=this.getMessageHandlerKey(t);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,e):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,e):(i=console.warn)===null||i===void 0||i.call(console,`colyseus.js: onMessage() not registered for type '${t}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(t){switch(typeof t){case"string":return t;case"number":return`i${t}`;default:throw new Error("invalid message type.")}}};Ya.Room=Gh;var xc={};function jo(s,t){t.headers=s.headers||{},t.statusMessage=s.statusText,t.statusCode=s.status,t.data=s.response}function Zn(s,t,e){return new Promise(function(i,a){e=e||{};var l=new XMLHttpRequest,u,d,m,g=e.body,y=e.headers||{};e.timeout&&(l.timeout=e.timeout),l.ontimeout=l.onerror=function(h){h.timeout=h.type=="timeout",a(h)},l.open(s,t.href||t),l.onload=function(){for(m=l.getAllResponseHeaders().trim().split(/[\r\n]+/),jo(l,l);d=m.shift();)d=d.split(": "),l.headers[d.shift().toLowerCase()]=d.join(": ");if(d=l.headers["content-type"],d&&~d.indexOf("application/json"))try{l.data=JSON.parse(l.data,e.reviver)}catch(h){return jo(l,h),a(h)}(l.status>=400?a:i)(l)},typeof FormData<"u"&&g instanceof FormData||g&&typeof g=="object"&&(y["content-type"]="application/json",g=JSON.stringify(g)),l.withCredentials=!!e.withCredentials;for(u in y)l.setRequestHeader(u,y[u]);l.send(g)})}var Zh=Zn.bind(Zn,"GET"),zh=Zn.bind(Zn,"POST"),Wh=Zn.bind(Zn,"PATCH"),Kh=Zn.bind(Zn,"DELETE"),qh=Zn.bind(Zn,"PUT");const Yh=Object.freeze(Object.defineProperty({__proto__:null,del:Kh,get:Zh,patch:Wh,post:zh,put:qh,send:Zn},Symbol.toStringTag,{value:"Module"})),Xh=ka(Yh);var Jh=cr,Qh=Xh;function ep(s){var t=Object.create(null);return s&&Object.keys(s).forEach(function(e){if(e!=="default"){var i=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(t,e,i.get?i:{enumerable:!0,get:function(){return s[e]}})}}),t.default=s,Object.freeze(t)}var tp=ep(Qh);let np=class{constructor(t,e={}){this.client=t,this.headers=e}get(t,e={}){return this.request("get",t,e)}post(t,e={}){return this.request("post",t,e)}del(t,e={}){return this.request("del",t,e)}put(t,e={}){return this.request("put",t,e)}request(t,e,i={}){return tp[t](this.client.getHttpEndpoint(e),this.getOptions(i)).catch(a=>{var l;const u=a.statusCode,d=((l=a.data)===null||l===void 0?void 0:l.error)||a.statusMessage||a.message;throw!u&&!d?a:new Jh.ServerError(u,d)})}getOptions(t){return t.headers=Object.assign({},this.headers,t.headers),this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(t.withCredentials=!0),t}};xc.HTTP=np;var ro={},Xr={},Ho=Zr;let ci;function ao(){if(!ci)try{ci=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!ci&&typeof globalThis.indexedDB<"u"&&(ci=new ap),ci||(ci={cache:{},setItem:function(s,t){this.cache[s]=t},getItem:function(s){this.cache[s]},removeItem:function(s){delete this.cache[s]}}),ci}function sp(s,t){ao().setItem(s,t)}function ip(s){ao().removeItem(s)}function rp(s,t){const e=ao().getItem(s);typeof Promise>"u"||!(e instanceof Promise)?t(e):e.then(i=>t(i))}class ap{constructor(){this.dbPromise=new Promise(t=>{const e=indexedDB.open("_colyseus_storage",1);e.onupgradeneeded=()=>e.result.createObjectStore("store"),e.onsuccess=()=>t(e.result)})}tx(t,e){return Ho.__awaiter(this,void 0,void 0,function*(){const a=(yield this.dbPromise).transaction("store",t).objectStore("store");return e(a)})}setItem(t,e){return this.tx("readwrite",i=>i.put(e,t)).then()}getItem(t){return Ho.__awaiter(this,void 0,void 0,function*(){const e=yield this.tx("readonly",i=>i.get(t));return new Promise(i=>{e.onsuccess=()=>i(e.result)})})}removeItem(t){return this.tx("readwrite",e=>e.delete(t)).then()}}Xr.getItem=rp;Xr.removeItem=ip;Xr.setItem=sp;var Ut=Zr,ca=Xr,op=Qa,Ar,Ra,Rs,Or;let lp=class{constructor(t){this.http=t,this.settings={path:"/auth",key:"colyseus-auth-token"},Ar.set(this,!1),Ra.set(this,void 0),Rs.set(this,void 0),Or.set(this,op.createNanoEvents()),ca.getItem(this.settings.key,e=>this.token=e)}set token(t){this.http.authToken=t}get token(){return this.http.authToken}onChange(t){const e=Ut.__classPrivateFieldGet(this,Or,"f").on("change",t);return Ut.__classPrivateFieldGet(this,Ar,"f")||Ut.__classPrivateFieldSet(this,Ra,new Promise((i,a)=>{this.getUserData().then(l=>{this.emitChange(Object.assign(Object.assign({},l),{token:this.token}))}).catch(l=>{this.emitChange({user:null,token:void 0})}).finally(()=>{i()})}),"f"),Ut.__classPrivateFieldSet(this,Ar,!0,"f"),e}getUserData(){return Ut.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(t,e,i){return Ut.__awaiter(this,void 0,void 0,function*(){const a=(yield this.http.post(`${this.settings.path}/register`,{body:{email:t,password:e,options:i}})).data;return this.emitChange(a),a})}signInWithEmailAndPassword(t,e){return Ut.__awaiter(this,void 0,void 0,function*(){const i=(yield this.http.post(`${this.settings.path}/login`,{body:{email:t,password:e}})).data;return this.emitChange(i),i})}signInAnonymously(t){return Ut.__awaiter(this,void 0,void 0,function*(){const e=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:t}})).data;return this.emitChange(e),e})}sendPasswordResetEmail(t){return Ut.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:t}})).data})}signInWithProvider(t){return Ut.__awaiter(this,arguments,void 0,function*(e,i={}){return new Promise((a,l)=>{const u=i.width||480,d=i.height||768,m=this.token?`?token=${this.token}`:"",g=`Login with ${e[0].toUpperCase()+e.substring(1)}`,y=this.http.client.getHttpEndpoint(`${i.prefix||`${this.settings.path}/provider`}/${e}${m}`),h=screen.width/2-u/2,I=screen.height/2-d/2;Ut.__classPrivateFieldSet(this,Rs,window.open(y,g,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+u+", height="+d+", top="+I+", left="+h),"f");const j=H=>{H.data.user===void 0&&H.data.token===void 0||(clearInterval(J),Ut.__classPrivateFieldGet(this,Rs,"f").close(),Ut.__classPrivateFieldSet(this,Rs,void 0,"f"),window.removeEventListener("message",j),H.data.error!==void 0?l(H.data.error):(a(H.data),this.emitChange(H.data)))},J=setInterval(()=>{(!Ut.__classPrivateFieldGet(this,Rs,"f")||Ut.__classPrivateFieldGet(this,Rs,"f").closed)&&(Ut.__classPrivateFieldSet(this,Rs,void 0,"f"),l("cancelled"),window.removeEventListener("message",j))},200);window.addEventListener("message",j)})})}signOut(){return Ut.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(t){t.token!==void 0&&(this.token=t.token,t.token===null?ca.removeItem(this.settings.key):ca.setItem(this.settings.key,t.token)),Ut.__classPrivateFieldGet(this,Or,"f").emit("change",t)}};Ar=new WeakMap,Ra=new WeakMap,Rs=new WeakMap,Or=new WeakMap;ro.Auth=lp;var Dc={};function cp(s){var t;const e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.hostname)||"localhost",i=s.hostname.split("."),a=!s.hostname.includes("trycloudflare.com")&&!s.hostname.includes("discordsays.com")&&i.length>2?`/${i[0]}`:"";return s.pathname.startsWith("/.proxy")?`${s.protocol}//${e}${a}${s.pathname}${s.search}`:`${s.protocol}//${e}/.proxy/colyseus${a}${s.pathname}${s.search}`}Dc.discordURLBuilder=cp;var bs=Zr,fp=cr,up=Ya,dp=xc,hp=ro,pp=Dc,fa;class Jr extends Error{constructor(t,e){super(t),this.code=e,this.name="MatchMakeError",Object.setPrototypeOf(this,Jr.prototype)}}const Go=typeof window<"u"&&typeof((fa=window==null?void 0:window.location)===null||fa===void 0?void 0:fa.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class Rc{constructor(t=Go,e){var i,a;if(typeof t=="string"){const l=t.startsWith("/")?new URL(t,Go):new URL(t),u=l.protocol==="https:"||l.protocol==="wss:",d=Number(l.port||(u?443:80));this.settings={hostname:l.hostname,pathname:l.pathname,port:d,secure:u}}else t.port===void 0&&(t.port=t.secure?443:80),t.pathname===void 0&&(t.pathname=""),this.settings=t;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new dp.HTTP(this,(e==null?void 0:e.headers)||{}),this.auth=new hp.Auth(this.http),this.urlBuilder=e==null?void 0:e.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((a=(i=window==null?void 0:window.location)===null||i===void 0?void 0:i.hostname)===null||a===void 0)&&a.includes("discordsays.com"))&&(this.urlBuilder=pp.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(t){return bs.__awaiter(this,arguments,void 0,function*(e,i={},a){return yield this.createMatchMakeRequest("joinOrCreate",e,i,a)})}create(t){return bs.__awaiter(this,arguments,void 0,function*(e,i={},a){return yield this.createMatchMakeRequest("create",e,i,a)})}join(t){return bs.__awaiter(this,arguments,void 0,function*(e,i={},a){return yield this.createMatchMakeRequest("join",e,i,a)})}joinById(t){return bs.__awaiter(this,arguments,void 0,function*(e,i={},a){return yield this.createMatchMakeRequest("joinById",e,i,a)})}reconnect(t,e){return bs.__awaiter(this,void 0,void 0,function*(){if(typeof t=="string"&&typeof e=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[i,a]=t.split(":");if(!i||!a)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",i,{reconnectionToken:a},e)})}consumeSeatReservation(t,e,i){return bs.__awaiter(this,void 0,void 0,function*(){const a=this.createRoom(t.room.name,e);a.roomId=t.room.roomId,a.sessionId=t.sessionId;const l={sessionId:a.sessionId};t.reconnectionToken&&(l.reconnectionToken=t.reconnectionToken);const u=i||a;return a.connect(this.buildEndpoint(t.room,l,t.protocol),t.devMode&&(()=>bs.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${a.roomId}'...`);let d=0,m=8;const g=()=>bs.__awaiter(this,void 0,void 0,function*(){d++;try{yield this.consumeSeatReservation(t,e,u),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${a.roomId}'`)}catch{d<m?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${d} out of ${m})`),setTimeout(g,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(g,2e3)})),u,t,this.http.headers),new Promise((d,m)=>{const g=(y,h)=>m(new fp.ServerError(y,h));u.onError.once(g),u.onJoin.once(()=>{u.onError.remove(g),d(u)})})})}createMatchMakeRequest(t,e){return bs.__awaiter(this,arguments,void 0,function*(i,a,l={},u,d){const m=(yield this.http.post(`matchmake/${i}/${a}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)})).data;if(m.error)throw new Jr(m.error,m.code);return i==="reconnect"&&(m.reconnectionToken=l.reconnectionToken),yield this.consumeSeatReservation(m,u,d)})}createRoom(t,e){return new up.Room(t,e)}buildEndpoint(t,e={},i="ws"){const a=[];this.http.authToken&&(e._authToken=this.http.authToken);for(const d in e)e.hasOwnProperty(d)&&a.push(`${d}=${e[d]}`);i==="h3"&&(i="http");let l=this.settings.secure?`${i}s://`:`${i}://`;t.publicAddress?l+=`${t.publicAddress}`:l+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const u=`${l}/${t.processId}/${t.roomId}?${a.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(u)):u}getHttpEndpoint(t=""){const e=t.startsWith("/")?t:`/${t}`,i=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${e}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}Rc.VERSION="0.16.16";Ka.Client=Rc;Ka.MatchMakeError=Jr;var Nc={};class gp{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}}Nc.NoneSerializer=gp;(function(s){var t=Ka,e=Ja,i=Ya,a=ro,l=cr,u=Wr,d=Nc,m=zr;m.registerSerializer("schema",u.SchemaSerializer),m.registerSerializer("none",d.NoneSerializer),s.Client=t.Client,s.MatchMakeError=t.MatchMakeError,Object.defineProperty(s,"ErrorCode",{enumerable:!0,get:function(){return e.ErrorCode}}),Object.defineProperty(s,"Protocol",{enumerable:!0,get:function(){return e.Protocol}}),s.Room=i.Room,s.Auth=a.Auth,s.ServerError=l.ServerError,s.SchemaSerializer=u.SchemaSerializer,s.getStateCallbacks=u.getStateCallbacks,s.registerSerializer=m.registerSerializer})(Hn);let S=null,Na=null,ws=new Map;async function oo(){return S?new Promise(s=>{const t=setTimeout(()=>{console.error("loadAllCardData: Timeout while waiting for card data"),s(!1)},5e3);S.send("getAllCards"),S.onMessage("allCards",e=>{clearTimeout(t),console.log(`Received ${e.length} cards from server`),ws.clear(),e.forEach(i=>{ws.set(i.id,i)}),s(!0)})}):!1}async function lo(s,t){const e=location.host.includes("localhost")?"ws://localhost:4001":`wss://${location.host}/.proxy/api`;Na=new Hn.Client(e);try{console.log("Attempting to join or create Colyseus room..."),S=await Na.joinOrCreate("game",{accessToken:s,username:t}),console.log("Successfully joined room:",S.roomId),console.log("Session ID:",S.sessionId),console.log("Initial room state:",S.state.toJSON()),console.log("Loading all card data..."),await oo(),console.log("Card data loaded, cache size:",ws.size),S.onStateChange(i=>{}),S.onError((i,a)=>{console.error("Colyseus room error:",i,a),S=null}),S.onLeave(i=>{console.log("Left Colyseus room, code:",i),S=null})}catch(i){throw console.error("Failed to connect to Colyseus:",i),i instanceof ProgressEvent?(console.error("Connection failed: Network error (ProgressEvent). Potential causes:"),console.error("- Colyseus server might not be running or accessible at the target URL:",e),console.error("- WebSocket connection blocked by firewall or proxy."),console.error("- Incorrect WebSocket proxy configuration on the deployment server (if applicable)."),alert("Failed to connect to game server: Network Error. Please ensure the server is running and accessible.")):i instanceof Error?(console.error("Connection failed due to error:",i.message),alert(`Failed to connect to game server: ${i.message}`)):(console.error("Connection failed due to unknown error:",i),alert("Failed to connect to game server: An unknown error occurred.")),S=null,i}}const mp=Object.freeze(Object.defineProperty({__proto__:null,get colyseusClient(){return Na},get colyseusRoom(){return S},connectColyseus:lo,globalCardDataCache:ws,loadAllCardData:oo},Symbol.toStringTag,{value:"Module"}));let fn;const Pc=new URLSearchParams(window.location.search),co=Pc.get("frame_id")!=null;let ks;const Pa="1363939642289946886",ua=Qr("user_id"),yp=Qr("guild_id"),bp=Qr("channel_id"),Ep=async()=>{if(co){const s=Pa;console.log("Discord SDK: Using embedded client ID:",s),ks=new Dd(s),await ks.ready()}else{ks=new $l(Pa,yp,bp);const s=String(ua.charCodeAt(0)%5),t={access_token:"mock_token",user:{username:ua,discriminator:s,id:ua,avatar:null,public_flags:1},scopes:[],expires:new Date(2112,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}};ks._updateCommandMocks({authenticate:async()=>(fn=t,console.log("Mock Authentication successful:",fn),await lo(fn.access_token,fn.user.username),t),authorize:async()=>(console.log("Mock Authorize called"),{code:"mock_code"})})}},vp=async()=>{if(!co){console.log("Running locally, attempting mock authentication...");try{return await ks.commands.authenticate({}),!0}catch(t){return console.error("Mock authentication failed:",t),!1}}let s="authorize";try{console.log("Requesting Discord authorization...");const{code:t}=await ks.commands.authorize({client_id:Pa,response_type:"code",state:"",prompt:"none",scope:["identify","guilds"]});console.log("Authorization code received:",t),s="fetchToken",console.log("Fetching access token from /.proxy/api/token...");const e=await fetch("/.proxy/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})});if(console.log("Token fetch response received. Status:",e.status),!e.ok){const a=await e.text();throw console.error("Token fetch failed:",e.status,e.statusText,a),new Error(`Token fetch failed: ${e.status} ${e.statusText} - ${a}`)}const{access_token:i}=await e.json();if(console.log("Access token received successfully."),s="discordAuthenticate",console.log("Authenticating with Discord SDK..."),fn=await ks.commands.authenticate({access_token:i}),!(fn!=null&&fn.user))throw console.error("Discord SDK Authentication failed: No user data received.",fn),new Error("Discord SDK Authentication failed to return user data.");console.log("Discord SDK Authentication successful:",fn.user.username),s="connectColyseus",console.log("Connecting to Colyseus...");try{await lo(fn.access_token,fn.user.username),console.log("Colyseus connection successful.")}catch(a){throw console.error("Colyseus connection failed:",a),a}return!0}catch(t){return console.error(`Error during step: ${s}`),console.error("Discord authorization or Colyseus connection failed:",t),t instanceof ProgressEvent?console.error("Network error (ProgressEvent) occurred, likely during fetch."):t.message&&t.message.includes("Token fetch failed")?console.error("Error specifically during token fetch step."):s==="connectColyseus"&&console.error("Error specifically during Colyseus connection step."),fn=null,!1}},_p=()=>fn?fn.user.username:!co&&ks instanceof $l?Qr("user_id")||"MockUser":"User";function Qr(s){const t=Pc.get(s);if(t!=null)return t;const e=sessionStorage.getItem(s);if(e!=null)return e;const i=Math.random().toString(36).slice(2,10);return sessionStorage.setItem(s,i),i}class wp extends fs.Scene{constructor(){super("Boot")}preload(){this.load.setPath("/assets"),this.load.image("background","bg.png"),this.load.image("fridge_bg","fridge_bg.png")}create(){this.scene.start("Preloader")}}class Tp extends fs.Scene{constructor(){super("Game");ce(this,"room")}async create(){this.scene.launch("background"),this.add.image(this.cameras.main.width*.5,this.cameras.main.height*.4,"grid").setScale(.6),await this.connect(),this.room.state.draggables.onAdd((i,a)=>{const l=this.add.image(i.x,i.y,a).setInteractive();l.name=a,l.setScale(.8),this.input.setDraggable(l),l.on("drag",(u,d,m)=>{this.room&&(l.x=Phaser.Math.Clamp(d,l.displayWidth/2,Number(this.game.config.width)-l.displayWidth/2),l.y=Phaser.Math.Clamp(m,l.displayHeight/2,Number(this.game.config.height)-l.displayHeight/2),this.room.send("move",{imageId:a,x:l.x,y:l.y}))})}),this.add.text(this.cameras.main.width*.5,this.cameras.main.height*.95,`Connected as: ${_p()}`,{font:"14px Arial",color:"#000000"}).setOrigin(.5)}async connect(){const e=location.host==="localhost:3000"?"ws://localhost:3001":`wss://${location.host}/.proxy/api/colyseus`,i=new Hn.Client(`${e}`);try{this.room=await i.joinOrCreate("some_other_room",{screenWidth:this.game.config.width,screenHeight:this.game.config.height}),this.room.onMessage("move",a=>{}),console.log("Successfully connected!")}catch(a){console.log(`Could not connect with the server: ${a}`)}}}class Ip extends fs.Scene{constructor(){super("MainMenu");ce(this,"statusText")}create(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let i=this.cameras.main.width/e.width+.2,a=this.cameras.main.height/e.height+.2,l=Math.max(i,a);e.setScale(l).setScrollFactor(0),this.add.text(Number(this.game.config.width)*.5,300,"Legends of the Friend",{fontFamily:"Arial Black",fontSize:58,color:"#ffff00",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(Number(this.game.config.width)*.5,460,"Click to Start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,520,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.input.once("pointerdown",async()=>{this.statusText.setText("Authorizing with Discord..."),await vp()?(this.statusText.setText("Connecting to server..."),await new Promise(d=>setTimeout(d,1e3)),S?(this.statusText.setText("Loading game data..."),await oo()?(this.statusText.setText("Connected! Entering Lobby..."),this.scene.start("Lobby")):this.statusText.setText("Failed to load game data. Please try again.")):this.statusText.setText("Failed to connect to server. Please try again.")):this.statusText.setText("Discord authorization failed. Please try again.")})}}class Sp extends fs.Scene{constructor(){super("Preloader")}init(){const t=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let e=this.cameras.main.width/t.width+.2,i=this.cameras.main.height/t.height+.2,a=Math.max(e,i);t.setScale(a).setScrollFactor(0),this.add.rectangle(Number(this.game.config.width)*.5,Number(this.game.config.height)*.5,468,32).setStrokeStyle(1,16777215);const l=this.add.rectangle(Number(this.game.config.width)*.5-230,Number(this.game.config.height)*.5,4,28,16777215);this.load.on("progress",u=>{l.width=4+460*u})}preload(){this.load.setPath("/assets"),this.load.image("logo","logo.png"),this.load.image("cardFullTier1","CardFullTier1.png"),this.load.image("cardMinionTier1","CardMinionTier1.png")}create(){this.scene.start("MainMenu")}}class Ap extends fs.Scene{constructor(){super("background")}create(){this.cameras.main.setBackgroundColor(11393254),this.scene.sendToBack()}}const Op="modulepreload",xp=function(s){return"/"+s},Zo={},Dp=function(t,e,i){let a=Promise.resolve();if(e&&e.length>0){const l=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),d=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));a=Promise.all(e.map(m=>{if(m=xp(m),m in Zo)return;Zo[m]=!0;const g=m.endsWith(".css"),y=g?'[rel="stylesheet"]':"";if(!!i)for(let j=l.length-1;j>=0;j--){const J=l[j];if(J.href===m&&(!g||J.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${y}`))return;const I=document.createElement("link");if(I.rel=g?"stylesheet":Op,g||(I.as="script",I.crossOrigin=""),I.href=m,d&&I.setAttribute("nonce",d),document.head.appendChild(I),g)return new Promise((j,J)=>{I.addEventListener("load",j),I.addEventListener("error",()=>J(new Error(`Unable to preload CSS for ${m}`)))})}))}return a.then(()=>t()).catch(l=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l})};var Ca={exports:{}};(function(s,t){(function(e,i){i(t)})(La,function(e){e.OPERATION=void 0,function(f){f[f.ADD=128]="ADD",f[f.REPLACE=0]="REPLACE",f[f.DELETE=64]="DELETE",f[f.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",f[f.MOVE_AND_ADD=160]="MOVE_AND_ADD",f[f.DELETE_AND_ADD=192]="DELETE_AND_ADD",f[f.CLEAR=10]="CLEAR",f[f.REVERSE=15]="REVERSE",f[f.MOVE=32]="MOVE",f[f.DELETE_BY_REFID=33]="DELETE_BY_REFID",f[f.ADD_BY_REFID=129]="ADD_BY_REFID"}(e.OPERATION||(e.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const l=Symbol("$track"),u=Symbol("$encoder"),d=Symbol("$decoder"),m=Symbol("$filter"),g=Symbol("$getByIndex"),y=Symbol("$deleteByIndex"),h=Symbol("$changes"),I=Symbol("$childType"),j=Symbol("$onEncodeEnd"),J=Symbol("$onDecodeEnd"),H=Symbol("$descriptors"),z="$__numFields",ue="$__refTypeFieldIndexes",de="$__viewFieldIndexes",re="$__fieldIndexesByViewTag";let Te;try{Te=new TextEncoder}catch{}const $e=new ArrayBuffer(8),tt=new Int32Array($e),at=new Float32Array($e),mt=new Float64Array($e),ot=new BigInt64Array($e),Je=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(f,n){for(var r=0,o=0,c=0,p=f.length;c<p;c++)r=f.charCodeAt(c),r<128?o+=1:r<2048?o+=2:r<55296||r>=57344?o+=3:(c++,o+=4);return o};function Ve(f,n,r){for(var o=0,c=0,p=n.length;c<p;c++)o=n.charCodeAt(c),o<128?f[r.offset++]=o:o<2048?(f[r.offset]=192|o>>6,f[r.offset+1]=128|o&63,r.offset+=2):o<55296||o>=57344?(f[r.offset]=224|o>>12,f[r.offset+1]=128|o>>6&63,f[r.offset+2]=128|o&63,r.offset+=3):(c++,o=65536+((o&1023)<<10|n.charCodeAt(c)&1023),f[r.offset]=240|o>>18,f[r.offset+1]=128|o>>12&63,f[r.offset+2]=128|o>>6&63,f[r.offset+3]=128|o&63,r.offset+=4)}function V(f,n,r){f[r.offset++]=n&255}function se(f,n,r){f[r.offset++]=n&255}function te(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255}function ee(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255}function ne(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255,f[r.offset++]=n>>16&255,f[r.offset++]=n>>24&255}function ge(f,n,r){const o=n>>24,c=n>>16,p=n>>8,b=n;f[r.offset++]=b&255,f[r.offset++]=p&255,f[r.offset++]=c&255,f[r.offset++]=o&255}function Re(f,n,r){const o=Math.floor(n/Math.pow(2,32)),c=n>>>0;ge(f,c,r),ge(f,o,r)}function Ie(f,n,r){const o=n/Math.pow(2,32)>>0,c=n>>>0;ge(f,c,r),ge(f,o,r)}function We(f,n,r){ot[0]=BigInt.asIntN(64,n),ne(f,tt[0],r),ne(f,tt[1],r)}function Ge(f,n,r){ot[0]=BigInt.asIntN(64,n),ne(f,tt[0],r),ne(f,tt[1],r)}function lt(f,n,r){at[0]=n,ne(f,tt[0],r)}function Tt(f,n,r){mt[0]=n,ne(f,tt[0],r),ne(f,tt[1],r)}function Ct(f,n,r){f[r.offset++]=n?1:0}function As(f,n,r){n||(n="");let o=Je(n,"utf8"),c=0;if(o<32)f[r.offset++]=o|160,c=1;else if(o<256)f[r.offset++]=217,f[r.offset++]=o%255,c=2;else if(o<65536)f[r.offset++]=218,ee(f,o,r),c=3;else if(o<4294967296)f[r.offset++]=219,ge(f,o,r),c=5;else throw new Error("String too long");return Ve(f,n,r),c+o}function mn(f,n,r){if(isNaN(n))return mn(f,0,r);if(isFinite(n)){if(n!==(n|0))return Math.abs(n)<=34028235e31&&(at[0]=n,Math.abs(Math.abs(at[0])-Math.abs(n))<1e-4)?(f[r.offset++]=202,lt(f,n,r),5):(f[r.offset++]=203,Tt(f,n,r),9)}else return mn(f,n>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,r);return n>=0?n<128?(f[r.offset++]=n&255,1):n<256?(f[r.offset++]=204,f[r.offset++]=n&255,2):n<65536?(f[r.offset++]=205,ee(f,n,r),3):n<4294967296?(f[r.offset++]=206,ge(f,n,r),5):(f[r.offset++]=207,Ie(f,n,r),9):n>=-32?(f[r.offset++]=224|n+32,1):n>=-128?(f[r.offset++]=208,V(f,n,r),2):n>=-32768?(f[r.offset++]=209,te(f,n,r),3):n>=-2147483648?(f[r.offset++]=210,ne(f,n,r),5):(f[r.offset++]=211,Re(f,n,r),9)}const ve={int8:V,uint8:se,int16:te,uint16:ee,int32:ne,uint32:ge,int64:Re,uint64:Ie,bigint64:We,biguint64:Ge,float32:lt,float64:Tt,boolean:Ct,string:As,number:mn,utf8Write:Ve,utf8Length:Je},zt=new ArrayBuffer(8),It=new Int32Array(zt),Qt=new Float32Array(zt),ds=new Float64Array(zt),Wn=new BigUint64Array(zt),Os=new BigInt64Array(zt);function Kn(f,n,r){for(var o="",c=0,p=n.offset,b=n.offset+r;p<b;p++){var _=f[p];if(!(_&128)){o+=String.fromCharCode(_);continue}if((_&224)===192){o+=String.fromCharCode((_&31)<<6|f[++p]&63);continue}if((_&240)===224){o+=String.fromCharCode((_&15)<<12|(f[++p]&63)<<6|(f[++p]&63)<<0);continue}if((_&248)===240){c=(_&7)<<18|(f[++p]&63)<<12|(f[++p]&63)<<6|(f[++p]&63)<<0,c>=65536?(c-=65536,o+=String.fromCharCode((c>>>10)+55296,(c&1023)+56320)):o+=String.fromCharCode(c);continue}console.error("Invalid byte "+_.toString(16))}return n.offset+=r,o}function qn(f,n){return Wt(f,n)<<24>>24}function Wt(f,n){return f[n.offset++]}function Yn(f,n){return yn(f,n)<<16>>16}function yn(f,n){return f[n.offset++]|f[n.offset++]<<8}function st(f,n){return f[n.offset++]|f[n.offset++]<<8|f[n.offset++]<<16|f[n.offset++]<<24}function Mt(f,n){return st(f,n)>>>0}function Xn(f,n){return It[0]=st(f,n),Qt[0]}function hs(f,n){return It[0]=st(f,n),It[1]=st(f,n),ds[0]}function Se(f,n){const r=Mt(f,n);return st(f,n)*Math.pow(2,32)+r}function en(f,n){const r=Mt(f,n);return Mt(f,n)*Math.pow(2,32)+r}function E(f,n){return It[0]=st(f,n),It[1]=st(f,n),Os[0]}function T(f,n){return It[0]=st(f,n),It[1]=st(f,n),Wn[0]}function x(f,n){return Wt(f,n)>0}function C(f,n){const r=f[n.offset++];let o;return r<192?o=r&31:r===217?o=Wt(f,n):r===218?o=yn(f,n):r===219&&(o=Mt(f,n)),Kn(f,n,o)}function Z(f,n){const r=f[n.offset++];if(r<128)return r;if(r===202)return Xn(f,n);if(r===203)return hs(f,n);if(r===204)return Wt(f,n);if(r===205)return yn(f,n);if(r===206)return Mt(f,n);if(r===207)return en(f,n);if(r===208)return qn(f,n);if(r===209)return Yn(f,n);if(r===210)return st(f,n);if(r===211)return Se(f,n);if(r>223)return(255-r+1)*-1}function M(f,n){const r=f[n.offset];return r<192&&r>160||r===217||r===218||r===219}const G={utf8Read:Kn,int8:qn,uint8:Wt,int16:Yn,uint16:yn,int32:st,uint32:Mt,float32:Xn,float64:hs,int64:Se,uint64:en,bigint64:E,biguint64:T,boolean:x,string:C,number:Z,stringCheck:M},Y={},Q=new Map;function fe(f,n){n.constructor&&(Q.set(n.constructor,f),Y[f]=n),n.encode&&(ve[f]=n.encode),n.decode&&(G[f]=n.decode)}function Ne(f){return Y[f]}function Pe(f){for(const n in f)fe(n,f[n]);return n=>ht(n)}const Et=class Et{static register(n){const r=Object.getPrototypeOf(n);if(r!==Me){let o=Et.inheritedTypes.get(r);o||(o=new Set,Et.inheritedTypes.set(r,o)),o.add(n)}}static cache(n){let r=Et.cachedContexts.get(n);return r||(r=new Et(n),Et.cachedContexts.set(n,r)),r}constructor(n){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},n&&this.discoverTypes(n)}has(n){return this.schemas.has(n)}get(n){return this.types[n]}add(n,r=this.schemas.size){return this.schemas.has(n)?!1:(this.types[r]=n,n[Symbol.metadata]===void 0&&xe.initialize(n),this.schemas.set(n,r),!0)}getTypeId(n){return this.schemas.get(n)}discoverTypes(n,r,o,c){var _,w;if(c&&this.registerFilteredByParent(n,r,o),!this.add(n))return;(_=Et.inheritedTypes.get(n))==null||_.forEach(A=>{this.discoverTypes(A,r,o,c)});let p=n;for(;(p=Object.getPrototypeOf(p))&&p!==Me&&p!==Function.prototype;)this.discoverTypes(p);const b=n[w=Symbol.metadata]??(n[w]={});b[de]&&(this.hasFilters=!0);for(const A in b){const D=A,$=b[D].type,R=b[D].tag!==void 0;if(typeof $!="string")if(Array.isArray($)){const X=$[0];if(X==="string")continue;this.discoverTypes(X,n,D,c||R)}else if(typeof $=="function")this.discoverTypes($,n,D,c||R);else{const X=Object.values($)[0];if(typeof X=="string")continue;this.discoverTypes(X,n,D,c||R)}}}registerFilteredByParent(n,r,o){let p=`${this.schemas.get(n)??this.schemas.size}`;r&&(p+=`-${this.schemas.get(r)}`),p+=`-${o}`,this.parentFiltered[p]=!0}debug(){let n="";for(const r in this.parentFiltered){const o=r.split("-").map(Number),c=o.pop();n+=`
		`,n+=`${r}: ${o.reverse().map((p,b)=>{const _=this.types[p],w=_[Symbol.metadata];let A=_.name;return b===0&&(A+=`[${w[c].name}]`),`${A}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${n}`}};Et.inheritedTypes=new Map,Et.cachedContexts=new Map;let Ae=Et;function At(f){return Array.isArray(f)?{array:f[0]}:typeof f.type<"u"?f.type:f}const xe={addField(f,n,r,o,c){if(n>64)throw new Error(`Can't define field '${r}'.
Schema instances may only have up to 64 fields.`);f[n]=Object.assign(f[n]||{},{type:At(o),index:n,name:r}),Object.defineProperty(f,H,{value:f[H]||{},enumerable:!1,configurable:!0}),c?(f[H][r]=c,f[H][`_${r}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):f[H][r]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(f,z,{value:n,enumerable:!1,configurable:!0}),Object.defineProperty(f,r,{value:n,enumerable:!1,configurable:!0}),typeof f[n].type!="string"&&(f[ue]===void 0&&Object.defineProperty(f,ue,{value:[],enumerable:!1,configurable:!0}),f[ue].push(n))},setTag(f,n,r){const o=f[n],c=f[o];c.tag=r,f[de]||(Object.defineProperty(f,de,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(f,re,{value:{},enumerable:!1,configurable:!0})),f[de].push(o),f[re][r]||(f[re][r]=[]),f[re][r].push(o)},setFields(f,n){const r=f.prototype.constructor;Ae.register(r);const o=Object.getPrototypeOf(r),c=o&&o[Symbol.metadata],p=xe.initialize(r);r[l]||(r[l]=Me[l]),r[u]||(r[u]=Me[u]),r[d]||(r[d]=Me[d]),r.prototype.toJSON||(r.prototype.toJSON=Me.prototype.toJSON);let b=p[z]??(c&&c[z])??-1;b++;for(const _ in n){const w=n[_],A=Array.isArray(w)?Ne("array"):typeof Object.keys(w)[0]=="string"&&Ne(Object.keys(w)[0]),D=A?Object.values(w)[0]:At(w);xe.addField(p,b,_,w,Js(`_${_}`,b,D,A)),b++}return f},isDeprecated(f,n){return f[n].deprecated===!0},init(f){const n={};f[Symbol.metadata]=n,Object.defineProperty(n,z,{value:0,enumerable:!1,configurable:!0})},initialize(f){const n=Object.getPrototypeOf(f),r=n[Symbol.metadata];let o=f[Symbol.metadata]??Object.create(null);return n!==Me&&o===r&&(o=Object.create(null),r&&(Object.setPrototypeOf(o,r),Object.defineProperty(o,z,{value:r[z],enumerable:!1,configurable:!0,writable:!0}),r[de]!==void 0&&(Object.defineProperty(o,de,{value:[...r[de]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,re,{value:{...r[re]},enumerable:!1,configurable:!0,writable:!0})),r[ue]!==void 0&&Object.defineProperty(o,ue,{value:[...r[ue]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,H,{value:{...r[H]},enumerable:!1,configurable:!0,writable:!0}))),f[Symbol.metadata]=o,o},isValidInstance(f){return f.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(f.constructor[Symbol.metadata],z)},getFields(f){const n=f[Symbol.metadata],r={};for(let o=0;o<=n[z];o++)r[n[o].name]=n[o].type;return r},hasViewTagAtIndex(f,n){var r;return(r=f==null?void 0:f[de])==null?void 0:r.includes(n)}};function tn(){return{indexes:{},operations:[]}}function nt(f,n){const r=f.indexes[n];r===void 0?f.indexes[n]=f.operations.push(n)-1:f.operations[r]=n}function Gs(f,n){var o;let r=f.indexes[n];r===void 0&&(r=Object.values(f.indexes).at(-1),n=(o=Object.entries(f.indexes).find(([c,p])=>p===r))==null?void 0:o[0]),f.operations[r]=void 0,delete f.indexes[n]}function Ye(f,n,r,o=n[r].queueRootIndex){if(f)f[r][o]!==n&&(n[r].queueRootIndex=f[r].push(n)-1);else return}class Lt{constructor(n){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=n;const r=n.constructor[Symbol.metadata];r!=null&&r[de]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(n){var o;this.root=n,this.checkIsFiltered(this.parent,this.parentIndex);const r=this.ref.constructor[Symbol.metadata];r?(o=r[ue])==null||o.forEach(c=>{const p=r[c],b=this.ref[p.name];b==null||b[h].setRoot(n)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((c,p)=>{c[h].setRoot(n)})}setParent(n,r,o){var p;if(this.parent=n,this.parentIndex=o,!r)return;r!==this.root?(this.root=r,this.checkIsFiltered(n,o)):r.add(this);const c=this.ref.constructor[Symbol.metadata];c?(p=c[ue])==null||p.forEach(b=>{const _=c[b],w=this.ref[_.name];w==null||w[h].setParent(this.ref,r,b)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((b,_)=>{b[h].setParent(this.ref,r,this.indexes[_]??_)})}forEachChild(n){var o;const r=this.ref.constructor[Symbol.metadata];r?(o=r[ue])==null||o.forEach(c=>{const p=r[c],b=this.ref[p.name];b&&n(b[h],c)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((c,p)=>{n(c[h],this.indexes[p]??p)})}operation(n){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-n),Ye(this.root,this,"filteredChanges")):(this.changes.operations.push(-n),Ye(this.root,this,"changes"))}change(n,r=e.OPERATION.ADD){var _;const o=this.ref.constructor[Symbol.metadata],c=this.isFiltered||((_=o==null?void 0:o[n])==null?void 0:_.tag)!==void 0,p=c?this.filteredChanges:this.changes,b=this.indexedOperations[n];if(!b||b===e.OPERATION.DELETE){const w=b&&b===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:r;this.indexedOperations[n]=w}nt(p,n),c?(nt(this.allFilteredChanges,n),this.root&&(Ye(this.root,this,"filteredChanges"),Ye(this.root,this,"allFilteredChanges"))):(nt(this.allChanges,n),Ye(this.root,this,"changes"))}shiftChangeIndexes(n){const r=this.isFiltered?this.filteredChanges:this.changes,o={},c={};for(const p in this.indexedOperations)o[Number(p)+n]=this.indexedOperations[p],c[Number(p)+n]=r.indexes[p];this.indexedOperations=o,r.indexes=c,r.operations=r.operations.map(p=>p+n)}shiftAllChangeIndexes(n,r=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(n,r,this.allFilteredChanges),this._shiftAllChangeIndexes(n,r,this.allChanges)):this._shiftAllChangeIndexes(n,r,this.allChanges)}_shiftAllChangeIndexes(n,r=0,o){const c={};let p=0;for(const b in o.indexes)c[p++]=o.indexes[b];o.indexes=c;for(let b=0;b<o.operations.length;b++){const _=o.operations[b];_>r&&(o.operations[b]=_+n)}}indexedOperation(n,r,o=n){this.indexedOperations[n]=r,this.filteredChanges!==void 0?(nt(this.allFilteredChanges,o),nt(this.filteredChanges,n),Ye(this.root,this,"filteredChanges")):(nt(this.allChanges,o),nt(this.changes,n),Ye(this.root,this,"changes"))}getType(n){return xe.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][n].type:this.ref[I]}getChange(n){return this.indexedOperations[n]}getValue(n,r=!1){return this.ref[g](n,r)}delete(n,r,o=n){var b;if(n===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${n}'`)}catch(_){console.warn(_)}return}const c=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[n]=r??e.OPERATION.DELETE,nt(c,n),Gs(this.allChanges,o);const p=this.getValue(n);return p&&p[h]&&((b=this.root)==null||b.remove(p[h])),this.filteredChanges!==void 0?(Gs(this.allFilteredChanges,o),Ye(this.root,this,"filteredChanges")):Ye(this.root,this,"changes"),p}endEncode(n){var r,o;this.indexedOperations={},this[n].indexes={},this[n].operations.length=0,this[n].queueRootIndex=void 0,(o=(r=this.ref)[j])==null||o.call(r),this.isNew=!1}discard(n=!1){var r,o;(o=(r=this.ref)[j])==null||o.call(r),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),n&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((c,p)=>{var b;return(b=this.root)==null?void 0:b.remove(c)}))}discardAll(){const n=Object.keys(this.indexedOperations);for(let r=0,o=n.length;r<o;r++){const c=this.getValue(Number(n[r]));c&&c[h]&&c[h].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(n,r){const o=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(n,r),this.filteredChanges!==void 0&&(Ye(this.root,this,"filteredChanges"),o&&this.root.allFilteredChanges.push(this))),this.isFiltered||(Ye(this.root,this,"changes"),o&&this.root.allChanges.push(this))}_checkFilteredByParent(n,r){if(!n)return;const o=xe.isValidInstance(this.ref)?this.ref.constructor:this.ref[I];let c,p=!xe.isValidInstance(n);p?(c=n[h],n=c.parent,r=c.parentIndex):c=n[h];const b=n.constructor;let _=`${this.root.types.getTypeId(o)}`;b&&(_+=`-${this.root.types.schemas.get(b)}`),_+=`-${r}`;const w=xe.hasViewTagAtIndex(b==null?void 0:b[Symbol.metadata],r);this.isFiltered=n[h].isFiltered||this.root.types.parentFiltered[_]||w,this.isFiltered&&(this.isVisibilitySharedWithParent=c.isFiltered&&typeof o!="string"&&!w&&p,this.filteredChanges||(this.filteredChanges=tn(),this.allFilteredChanges=tn()),this.changes.operations.length>0&&(this.changes.operations.forEach(A=>nt(this.filteredChanges,A)),this.allChanges.operations.forEach(A=>nt(this.allFilteredChanges,A)),this.changes=tn(),this.allChanges=tn()))}}function Ln(f,n,r,o,c,p){var b;typeof r=="string"?(b=ve[r])==null||b.call(ve,n,o,p):r[Symbol.metadata]!==void 0?(ve.number(n,o[h].refId,p),(c&e.OPERATION.ADD)===e.OPERATION.ADD&&f.tryEncodeTypeId(n,r,o.constructor,p)):ve.number(n,o[h].refId,p)}const ps=function(f,n,r,o,c,p,b,_,w){if(n[p.offset++]=(o|c)&255,c===e.OPERATION.DELETE)return;const A=r.ref,D=w[o];Ln(f,n,w[o].type,A[D.name],c,p)},bn=function(f,n,r,o,c,p){if(n[p.offset++]=c&255,c===e.OPERATION.CLEAR||(ve.number(n,o,p),c===e.OPERATION.DELETE))return;const b=r.ref;if((c&e.OPERATION.ADD)===e.OPERATION.ADD&&typeof b.set=="function"){const A=r.ref.$indexes.get(o);ve.string(n,A,p)}const _=b[I],w=b[g](o);Ln(f,n,_,w,c,p)},kn=function(f,n,r,o,c,p,b,_){const w=r.ref,A=_&&r.isFiltered&&typeof r.getType(o)!="string";let D;if(A?(D=w.tmpItems[o][h].refId,c===e.OPERATION.DELETE?c=e.OPERATION.DELETE_BY_REFID:c===e.OPERATION.ADD&&(c=e.OPERATION.ADD_BY_REFID)):D=o,n[p.offset++]=c&255,c===e.OPERATION.CLEAR||c===e.OPERATION.REVERSE||(ve.number(n,D,p),c===e.OPERATION.DELETE||c===e.OPERATION.DELETE_BY_REFID))return;const $=r.getType(o),R=r.getValue(o,b);Ln(f,n,$,R,c,p)},Zs=-1;function gs(f,n,r,o,c,p,b,_){const w=f.root,A=r[g](o);let D;if((n&e.OPERATION.DELETE)===e.OPERATION.DELETE){const $=w.refIds.get(A);$!==void 0&&w.removeRef($),n!==e.OPERATION.DELETE_AND_ADD&&r[y](o),D=void 0}if(n!==e.OPERATION.DELETE)if(Me.is(c)){const $=G.number(p,b);if(D=w.refs.get($),(n&e.OPERATION.ADD)===e.OPERATION.ADD){const R=f.getInstanceType(p,b,c);D||(D=f.createInstanceOfType(R)),w.addRef($,D,D!==A||n===e.OPERATION.DELETE_AND_ADD&&D===A)}}else if(typeof c=="string")D=G[c](p,b);else{const $=Ne(Object.keys(c)[0]),R=G.number(p,b),X=w.refs.has(R)?A||w.refs.get(R):new $.constructor;if(D=X.clone(!0),D[I]=Object.values(c)[0],A){let K=w.refIds.get(A);if(K!==void 0&&R!==K){const U=A.entries();let N;for(;(N=U.next())&&!N.done;){const[q,ye]=N.value;typeof ye=="object"&&(K=w.refIds.get(ye),w.removeRef(K)),_.push({ref:A,refId:K,op:e.OPERATION.DELETE,field:q,value:void 0,previousValue:ye})}}}w.addRef(R,D,X!==A||n===e.OPERATION.DELETE_AND_ADD&&X===A)}return{value:D,previousValue:A}}const zs=function(f,n,r,o,c){const p=n[r.offset++],b=o.constructor[Symbol.metadata],_=p>>6<<6,w=p%(_||255),A=b[w];if(A===void 0)return console.warn("@colyseus/schema: field not defined at",{index:w,ref:o.constructor.name,metadata:b}),Zs;const{value:D,previousValue:$}=gs(f,_,o,w,A.type,n,r,c);D!=null&&(o[A.name]=D),$!==D&&c.push({ref:o,refId:f.currentRefId,op:_,field:A.name,value:D,previousValue:$})},Bn=function(f,n,r,o,c){const p=n[r.offset++];if(p===e.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}const b=G.number(n,r),_=o[I];let w;(p&e.OPERATION.ADD)===e.OPERATION.ADD?typeof o.set=="function"?(w=G.string(n,r),o.setIndex(b,w)):w=b:w=o.getIndex(b);const{value:A,previousValue:D}=gs(f,p,o,b,_,n,r,c);if(A!=null){if(typeof o.set=="function")o.$items.set(w,A);else if(typeof o.$setAt=="function")o.$setAt(b,A,p);else if(typeof o.add=="function"){const $=o.add(A);typeof $=="number"&&o.setIndex($,$)}}D!==A&&c.push({ref:o,refId:f.currentRefId,op:p,field:"",dynamicIndex:w,value:A,previousValue:D})},Ni=function(f,n,r,o,c){let p=n[r.offset++],b;if(p===e.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}else if(p===e.OPERATION.REVERSE){o.reverse();return}else if(p===e.OPERATION.DELETE_BY_REFID){const $=G.number(n,r),R=f.root.refs.get($);b=o.findIndex(X=>X===R),o[y](b),c.push({ref:o,refId:f.currentRefId,op:e.OPERATION.DELETE,field:"",dynamicIndex:b,value:void 0,previousValue:R});return}else if(p===e.OPERATION.ADD_BY_REFID){const $=G.number(n,r),R=f.root.refs.get($);R&&(b=o.findIndex(X=>X===R)),(b===-1||b===void 0)&&(b=o.length)}else b=G.number(n,r);const _=o[I];let w=b;const{value:A,previousValue:D}=gs(f,p,o,b,_,n,r,c);A!=null&&A!==D&&o.$setAt(b,A,p),D!==A&&c.push({ref:o,refId:f.currentRefId,op:p,field:"",dynamicIndex:w,value:A,previousValue:D})};class Jn extends Error{}function Ws(f,n,r,o){let c,p=!1;switch(n){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(f)&&console.log(`trying to encode "NaN" in ${r.constructor.name}#${o}`);break;case"bigint64":case"biguint64":c="bigint";break;case"string":c="string",p=!0;break;case"boolean":return;default:return}if(typeof f!==c&&(!p||p&&f!==null)){let b=`'${JSON.stringify(f)}'${f&&f.constructor&&` (${f.constructor.name})`||""}`;throw new Jn(`a '${c}' was expected, but ${b} was provided in ${r.constructor.name}#${o}`)}}function On(f,n,r,o){if(!(f instanceof n))throw new Jn(`a '${n.name}' was expected, but '${f&&f.constructor.name}' was provided in ${r.constructor.name}#${o}`)}var En,Ks;const Pi=(f,n)=>{const r=f.toString(),o=n.toString();return r<o?-1:r>o?1:0},pt=class pt{static[(En=u,Ks=d,m)](n,r,o){var c;return!o||typeof n[I]=="string"||o.isChangeTreeVisible((c=n.tmpItems[r])==null?void 0:c[h])}static is(n){return Array.isArray(n)||n.array!==void 0}static from(n){return new pt(...Array.from(n))}constructor(...n){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const r=new Proxy(this,{get:(o,c)=>typeof c!="symbol"&&!isNaN(c)?this.items[c]:Reflect.get(o,c),set:(o,c,p)=>{var b;if(typeof c!="symbol"&&!isNaN(c)){if(p==null)o.$deleteAt(c);else{if(p[h]){On(p,o[I],o,c);const _=o.items[c];o.isMovingItems?(_!==void 0?p[h].isNew?o[h].indexedOperation(Number(c),e.OPERATION.MOVE_AND_ADD):(o[h].getChange(Number(c))&e.OPERATION.DELETE)===e.OPERATION.DELETE?o[h].indexedOperation(Number(c),e.OPERATION.DELETE_AND_MOVE):o[h].indexedOperation(Number(c),e.OPERATION.MOVE):p[h].isNew&&o[h].indexedOperation(Number(c),e.OPERATION.ADD),p[h].setParent(this,o[h].root,c)):o.$changeAt(Number(c),p),_!==void 0&&((b=_[h].root)==null||b.remove(_[h]))}else o.$changeAt(Number(c),p);o.items[c]=p,o.tmpItems[c]=p}return!0}else return Reflect.set(o,c,p)},deleteProperty:(o,c)=>(typeof c=="number"?o.$deleteAt(c):delete o[c],!0),has:(o,c)=>typeof c!="symbol"&&!isNaN(Number(c))?Reflect.has(this.items,c):Reflect.has(o,c)});return this[h]=new Lt(r),this[h].indexes={},n.length>0&&this.push(...n),r}set length(n){n===0?this.clear():n<this.items.length?this.splice(n,this.length-n):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...n){var c;let r=this.tmpItems.length;const o=this[h];for(let p=0,b=n.length;p<n.length;p++,r++){const _=n[p];if(_==null)return;typeof _=="object"&&this[I]&&On(_,this[I],this,p),o.indexedOperation(r,e.OPERATION.ADD,this.items.length),this.items.push(_),this.tmpItems.push(_),(c=_[h])==null||c.setParent(this,o.root,r)}return r}pop(){let n=-1;for(let r=this.tmpItems.length-1;r>=0;r--)if(this.deletedIndexes[r]!==!0){n=r;break}if(!(n<0))return this[h].delete(n,void 0,this.items.length-1),this.deletedIndexes[n]=!0,this.items.pop()}at(n){return n<0&&(n+=this.length),this.items[n]}$changeAt(n,r){var p;if(r==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[n]===r)return;const o=this.items[n]!==void 0?typeof r=="object"?e.OPERATION.DELETE_AND_ADD:e.OPERATION.REPLACE:e.OPERATION.ADD,c=this[h];c.change(n,o),(p=r[h])==null||p.setParent(this,c.root,n)}$deleteAt(n,r){this[h].delete(n,r)}$setAt(n,r,o){n===0&&o===e.OPERATION.ADD&&this.items[n]!==void 0?this.items.unshift(r):o===e.OPERATION.DELETE_AND_MOVE?(this.items.splice(n,1),this.items[n]=r):this.items[n]=r}clear(){if(this.items.length===0)return;const n=this[h];n.forEachChild((r,o)=>{r.discard(!0);const c=r.root;c!==void 0&&(c.removeChangeFromChangeSet("changes",r),c.removeChangeFromChangeSet("allChanges",r),c.removeChangeFromChangeSet("allFilteredChanges",r))}),n.discard(!0),n.operation(e.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...n){return new pt(...this.items.concat(...n))}join(n){return this.items.join(n)}reverse(){return this[h].operation(e.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const n=this[h],r=this.tmpItems.findIndex(c=>c===this.items[0]),o=this.items.findIndex(c=>c===this.items[0]);return n.delete(r,e.OPERATION.DELETE,o),n.shiftAllChangeIndexes(-1,o),this.items.shift()}slice(n,r){const o=new pt;return o.push(...this.items.slice(n,r)),o}sort(n=Pi){this.isMovingItems=!0;const r=this[h];return this.items.sort(n).forEach((c,p)=>r.change(p,e.OPERATION.REPLACE)),this.tmpItems.sort(n),this.isMovingItems=!1,this}splice(n,r,...o){var A;const c=this[h],p=this.items.length,b=this.tmpItems.length,_=o.length,w=[];for(let D=0;D<b;D++)this.deletedIndexes[D]!==!0&&w.push(D);if(p>n){r===void 0&&(r=p-n);for(let D=n;D<n+r;D++){const $=w[D];c.delete($,e.OPERATION.DELETE),this.deletedIndexes[$]=!0}}else r=0;if(_>0){if(_>r)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let D=0;D<_;D++){const $=(w[n]??p)+D;c.indexedOperation($,this.deletedIndexes[$]?e.OPERATION.DELETE_AND_ADD:e.OPERATION.ADD),(A=o[D][h])==null||A.setParent(this,c.root,$)}}return r>_&&c.shiftAllChangeIndexes(-(r-_),w[n+_]),c.filteredChanges!==void 0?Ye(c.root,c,"filteredChanges"):Ye(c.root,c,"changes"),this.items.splice(n,r,...o)}unshift(...n){const r=this[h];return r.shiftChangeIndexes(n.length),r.isFiltered?nt(r.filteredChanges,this.items.length):nt(r.allChanges,this.items.length),n.forEach((o,c)=>{r.change(c,e.OPERATION.ADD)}),this.tmpItems.unshift(...n),this.items.unshift(...n)}indexOf(n,r){return this.items.indexOf(n,r)}lastIndexOf(n,r=this.length-1){return this.items.lastIndexOf(n,r)}every(n,r){return this.items.every(n,r)}some(n,r){return this.items.some(n,r)}forEach(n,r){return this.items.forEach(n,r)}map(n,r){return this.items.map(n,r)}filter(n,r){return this.items.filter(n,r)}reduce(n,r){return this.items.reduce(n,r)}reduceRight(n,r){return this.items.reduceRight(n,r)}find(n,r){return this.items.find(n,r)}findIndex(n,r){return this.items.findIndex(n,r)}fill(n,r,o){throw new Error("ArraySchema#fill() not implemented")}copyWithin(n,r,o){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return pt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(n,r){return this.items.includes(n,r)}flatMap(n,r){throw new Error("ArraySchema#flatMap() is not supported.")}flat(n){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...n){return this.items.findLastIndex.apply(this.items,arguments)}with(n,r){const o=this.items.slice();return n<0&&(n+=this.length),o[n]=r,new pt(...o)}toReversed(){return this.items.slice().reverse()}toSorted(n){return this.items.slice().sort(n)}toSpliced(n,r,...o){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(n=>{let r=this.items.length;for(;r!=0;){let o=Math.floor(Math.random()*r);r--,[this[r],this[o]]=[this[o],this[r]]}})}move(n){return this.isMovingItems=!0,n(this),this.isMovingItems=!1,this}[g](n,r=!1){return r?this.items[n]:this.deletedIndexes[n]?this.items[n]:this.tmpItems[n]||this.items[n]}[y](n){this.items[n]=void 0,this.tmpItems[n]=void 0}[j](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[J](){this.items=this.items.filter(n=>n!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(n=>typeof n.toJSON=="function"?n.toJSON():n)}clone(n){let r;return n?(r=new pt,r.push(...this.items)):r=new pt(...this.map(o=>o[h]?o.clone():o)),r}};pt[En]=kn,pt[Ks]=Ni;let bt=pt;fe("array",{constructor:bt});var qs,Ys;const Bt=class Bt{static[(qs=u,Ys=d,m)](n,r,o){return!o||typeof n[I]=="string"||o.isChangeTreeVisible((n[g](r)??n.deletedItems[r])[h])}static is(n){return n.map!==void 0}constructor(n){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[h]=new Lt(this),this[h].indexes={},n)if(n instanceof Map||n instanceof Bt)n.forEach((r,o)=>this.set(o,r));else for(const r in n)this.set(r,n[r]);Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return Bt}set(n,r){var _;if(r==null)throw new Error(`MapSchema#set('${n}', ${r}): trying to set ${r} value on '${n}'.`);typeof r=="object"&&this[I]&&On(r,this[I],this,n),n=n.toString();const o=this[h],c=r[h]!==void 0;let p,b;if(typeof o.indexes[n]<"u"){p=o.indexes[n],b=e.OPERATION.REPLACE;const w=this.$items.get(n);if(w===r)return;c&&(b=e.OPERATION.DELETE_AND_ADD,w!==void 0&&((_=w[h].root)==null||_.remove(w[h])))}else p=o.indexes[z]??0,b=e.OPERATION.ADD,this.$indexes.set(p,n),o.indexes[n]=p,o.indexes[z]=p+1;return this.$items.set(n,r),o.change(p,b),c&&r[h].setParent(this,o.root,p),this}get(n){return this.$items.get(n)}delete(n){const r=this[h].indexes[n];return this.deletedItems[r]=this[h].delete(r),this.$items.delete(n)}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){return this.$items.has(n)}forEach(n){this.$items.forEach(n)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[j](){this.deletedItems={}}toJSON(){const n={};return this.forEach((r,o)=>{n[o]=typeof r.toJSON=="function"?r.toJSON():r}),n}clone(n){let r;return n?r=Object.assign(new Bt,this):(r=new Bt,this.forEach((o,c)=>{o[h]?r.set(c,o.clone()):r.set(c,o)})),r}};Bt[qs]=bn,Bt[Ys]=Bn;let ct=Bt;fe("map",{constructor:ct});const Ot=-1;function Ci(f){return Ae.register(f),f}function Xs(f=Ot){return function(n,r){var _;const o=n.constructor,p=Object.getPrototypeOf(o)[Symbol.metadata],b=o[_=Symbol.metadata]??(o[_]=Object.assign({},o[Symbol.metadata],p??Object.create(null)));xe.setTag(b,r,f)}}function ht(f,n){return function(r,o){const c=r.constructor;if(!f)throw new Error(`${c.name}: @type() reference provided for "${o}" is undefined. Make sure you don't have any circular dependencies.`);Ae.register(c);const b=Object.getPrototypeOf(c)[Symbol.metadata],_=xe.initialize(c);let w=_[o];if(_[w]!==void 0){if(_[w].deprecated)return;if(_[w].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${o}' definition on '${c.name}'.
Check @type() annotation`)}catch(A){const D=A.stack.split(`
`)[4].trim();throw new Error(`${A.message} ${D}`)}}else w=_[z]??(b&&b[z])??-1,w++;if(n&&n.manual)xe.addField(_,w,o,f,{enumerable:!0,configurable:!0,writable:!0});else{const A=Array.isArray(f)?Ne("array"):typeof Object.keys(f)[0]=="string"&&Ne(Object.keys(f)[0]),D=A?Object.values(f)[0]:f;xe.addField(_,w,o,f,Js(`_${o}`,w,D,A))}}}function Js(f,n,r,o){return{get:function(){return this[f]},set:function(c){var b,_;const p=this[f]??void 0;if(c!==p){if(c!=null){o?(o.constructor===bt&&!(c instanceof bt)&&(c=new bt(...c)),o.constructor===ct&&!(c instanceof ct)&&(c=new ct(c)),c[I]=r):typeof r!="string"?On(c,r,this,f.substring(1)):Ws(c,r,this,f.substring(1));const w=this[h];p!==void 0&&p[h]?((b=w.root)==null||b.remove(p[h]),this.constructor[l](w,n,e.OPERATION.DELETE_AND_ADD)):this.constructor[l](w,n,e.OPERATION.ADD),(_=c[h])==null||_.setParent(this,w.root,n)}else p!==void 0&&this[h].delete(n);this[f]=c}},enumerable:!0,configurable:!0}}function vn(f=!0){return function(n,r){var w;const o=n.constructor,p=Object.getPrototypeOf(o)[Symbol.metadata],b=o[w=Symbol.metadata]??(o[w]=Object.assign({},o[Symbol.metadata],p??Object.create(null))),_=b[r];b[_].deprecated=!0,f&&(b[H]??(b[H]={}),b[H][r]={get:function(){throw new Error(`${r} is deprecated.`)},set:function(A){},enumerable:!1,configurable:!0}),Object.defineProperty(b,_,{value:b[_],enumerable:!1,configurable:!0})}}function Li(f,n,r){for(let o in n)ht(n[o],r)(f.prototype,o);return f}function Qs(f,n,r=Me){const o={},c={};for(let b in f){const _=f[b];typeof _=="object"&&(_.default!==void 0&&(o[b]=_.default),_.view!==void 0&&(c[b]=typeof _.view=="boolean"?Ot:_.view))}const p=xe.setFields(class extends r{constructor(...b){b[0]=Object.assign({},o,b[0]),super(...b)}},f);for(let b in c)Xs(c[b])(p.prototype,b);return n&&Object.defineProperty(p,"name",{value:n}),p.extends=(b,_)=>Qs(b,_,p),p}function $n(f){return new Array(f).fill(0).map((n,r)=>r===f-1?" ":"   ").join("")}function ki(f){const n=f[h].root,r={ops:{},refs:[]};return n.changes.forEach(o=>{if(o===void 0)return;const c=o.indexedOperations;r.refs.push(`refId#${o.refId}`);for(const p in c){const b=c[p],_=e.OPERATION[b];r.ops[_]||(r.ops[_]=0),r.ops[e.OPERATION[b]]++}}),r}var ei,Qn;const Tn=class Tn{static initialize(n){var r;Object.defineProperty(n,h,{value:new Lt(n),enumerable:!1,writable:!0}),Object.defineProperties(n,((r=n.constructor[Symbol.metadata])==null?void 0:r[H])||{})}static is(n){return typeof n[Symbol.metadata]=="object"}static[(ei=u,Qn=d,l)](n,r,o=e.OPERATION.ADD){n.change(r,o)}static[m](n,r,o){var b,_;const p=(b=n.constructor[Symbol.metadata][r])==null?void 0:b.tag;if(o===void 0)return p===void 0;if(p===void 0)return!0;if(p===Ot)return o.isChangeTreeVisible(n[h]);{const w=(_=o.tags)==null?void 0:_.get(n[h]);return w&&w.has(p)}}constructor(...n){Tn.initialize(this),n[0]&&Object.assign(this,n[0])}assign(n){return Object.assign(this,n),this}setDirty(n,r){const o=this.constructor[Symbol.metadata];this[h].change(o[o[n]].index,r)}clone(){var o;const n=new this.constructor,r=this.constructor[Symbol.metadata];for(const c in r){const p=r[c].name;typeof this[p]=="object"&&typeof((o=this[p])==null?void 0:o.clone)=="function"?n[p]=this[p].clone():n[p]=this[p]}return n}toJSON(){const n={},r=this.constructor[Symbol.metadata];for(const o in r){const c=r[o],p=c.name;!c.deprecated&&this[p]!==null&&typeof this[p]<"u"&&(n[p]=typeof this[p].toJSON=="function"?this[p].toJSON():this[p])}return n}discardAllChanges(){this[h].discardAll()}[g](n){const r=this.constructor[Symbol.metadata];return this[r[n].name]}[y](n){const r=this.constructor[Symbol.metadata];this[r[n].name]=void 0}static debugRefIds(n,r=!1,o=0){const c=r?` - ${JSON.stringify(n.toJSON())}`:"",p=n[h],b=p.refId;let _="";return _+=`${$n(o)}${n.constructor.name} (refId: ${b})${c}
`,p.forEachChild(w=>_+=this.debugRefIds(w.ref,r,o+1)),_}static debugChanges(n,r=!1){const o=n[h],c=r?o.allChanges:o.changes,p=r?"allChanges":"changes";let b=`${n.constructor.name} (${o.refId}) -> .${p}:
`;function _(w){w.operations.filter(A=>A).forEach(A=>{const D=o.indexedOperations[A];console.log({index:A,operation:D}),b+=`- [${A}]: ${e.OPERATION[D]} (${JSON.stringify(o.getValue(Number(A),r))})
`})}return _(c),!r&&o.filteredChanges&&o.filteredChanges.operations.filter(w=>w).length>0&&(b+=`${n.constructor.name} (${o.refId}) -> .filteredChanges:
`,_(o.filteredChanges)),r&&o.allFilteredChanges&&o.allFilteredChanges.operations.filter(w=>w).length>0&&(b+=`${n.constructor.name} (${o.refId}) -> .allFilteredChanges:
`,_(o.allFilteredChanges)),b}static debugChangesDeep(n,r="changes"){var D,$;let o="";const c=n[h],p=c.root,b=new Map,_=[];let w=0;for(const[R,X]of Object.entries(p[r])){const K=p.changeTrees[R];let U=!1,N=[],q=(D=K.parent)==null?void 0:D[h];if(K===c)U=!0;else for(;q!==void 0;){if(N.push(q),q.ref===n){U=!0;break}q=($=q.parent)==null?void 0:$[h]}U&&(_.push(K.refId),w+=Object.keys(X).length,b.set(K,N.reverse()))}o+=`---
`,o+=`root refId: ${c.refId}
`,o+=`Total instances: ${_.length} (refIds: ${_.join(", ")})
`,o+=`Total changes: ${w}
`,o+=`---
`;const A=new WeakSet;for(const[R,X]of b.entries()){X.forEach((ye,De)=>{A.has(ye)||(o+=`${$n(De)}${ye.ref.constructor.name} (refId: ${ye.refId})
`,A.add(ye))});const K=R.indexedOperations,U=X.length,N=$n(U),q=U>0?`(${R.parentIndex}) `:"";o+=`${N}${q}${R.ref.constructor.name} (refId: ${R.refId}) - changes: ${Object.keys(K).length}
`;for(const ye in K){const De=K[ye];o+=`${$n(U+1)}${e.OPERATION[De]}: ${ye}
`}}return`${o}`}};Tn[ei]=ps,Tn[Qn]=zs;let Me=Tn;var ti,nn;const an=class an{static[(ti=u,nn=d,m)](n,r,o){return!o||typeof n[I]=="string"||o.isChangeTreeVisible((n[g](r)??n.deletedItems[r])[h])}static is(n){return n.collection!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Lt(this),this[h].indexes={},n&&n.forEach(r=>this.add(r)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){const r=this.$refId++;return n[h]!==void 0&&n[h].setParent(this,this[h].root,r),this[h].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,n),this[h].change(r),r}at(n){const r=Array.from(this.$items.keys())[n];return this.$items.get(r)}entries(){return this.$items.entries()}delete(n){const r=this.$items.entries();let o,c;for(;(c=r.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[h].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){return Array.from(this.$items.values()).some(r=>r===n)}forEach(n){this.$items.forEach((r,o,c)=>n(r,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[j](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((r,o)=>{n.push(typeof r.toJSON=="function"?r.toJSON():r)}),n}clone(n){let r;return n?r=Object.assign(new an,this):(r=new an,this.forEach(o=>{o[h]?r.add(o.clone()):r.add(o)})),r}};an[ti]=bn,an[nn]=Bn;let _n=an;fe("collection",{constructor:_n});var ni,si;const on=class on{static[(ni=u,si=d,m)](n,r,o){return!o||typeof n[I]=="string"||o.visible.has((n[g](r)??n.deletedItems[r])[h])}static is(n){return n.set!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Lt(this),this[h].indexes={},n&&n.forEach(r=>this.add(r)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){var c;if(this.has(n))return!1;const r=this.$refId++;n[h]!==void 0&&n[h].setParent(this,this[h].root,r);const o=((c=this[h].indexes[r])==null?void 0:c.op)??e.OPERATION.ADD;return this[h].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,n),this[h].change(r,o),r}entries(){return this.$items.entries()}delete(n){const r=this.$items.entries();let o,c;for(;(c=r.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[h].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[h];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(e.OPERATION.CLEAR)}has(n){const r=this.$items.values();let o=!1,c;for(;(c=r.next())&&!c.done;)if(n===c.value){o=!0;break}return o}forEach(n){this.$items.forEach((r,o,c)=>n(r,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[j](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((r,o)=>{n.push(typeof r.toJSON=="function"?r.toJSON():r)}),n}clone(n){let r;return n?r=Object.assign(new on,this):(r=new on,this.forEach(o=>{o[h]?r.add(o.clone()):r.add(o)})),r}};on[ni]=bn,on[si]=Bn;let wn=on;fe("set",{constructor:wn});function kt(f,n,r,o){var c=arguments.length,p=c<3?n:o===null?o=Object.getOwnPropertyDescriptor(n,r):o,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(f,n,r,o);else for(var _=f.length-1;_>=0;_--)(b=f[_])&&(p=(c<3?b(p):c>3?b(n,r,p):b(n,r))||p);return c>3&&p&&Object.defineProperty(n,r,p),p}typeof SuppressedError=="function"&&SuppressedError;class Bi{constructor(n){this.types=n,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(n){n.ensureRefId();const r=this.changeTrees[n.refId]===void 0;r&&(this.changeTrees[n.refId]=n);const o=this.refCount[n.refId];if(o===0){const c=n.allChanges.operations;let p=c.length;for(;p--;)n.indexedOperations[c[p]]=e.OPERATION.ADD,nt(n.changes,p)}return this.refCount[n.refId]=(o||0)+1,r}remove(n){const r=this.refCount[n.refId]-1;return r<=0?(n.root=void 0,delete this.changeTrees[n.refId],this.removeChangeFromChangeSet("allChanges",n),this.removeChangeFromChangeSet("changes",n),n.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",n),this.removeChangeFromChangeSet("filteredChanges",n)),this.refCount[n.refId]=0):(this.refCount[n.refId]=r,n.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",n),Ye(this,n,"filteredChanges")):(this.removeChangeFromChangeSet("changes",n),Ye(this,n,"changes"))),n.forEachChild((o,c)=>this.remove(o)),r}removeChangeFromChangeSet(n,r){const o=this[n],c=o.indexOf(r);if(c!==-1)return r[n].queueRootIndex=-1,o[c]=void 0,!0}clear(){this.changes.length=0}}const Mn=class Mn{constructor(n){this.sharedBuffer=Buffer.allocUnsafe(Mn.BUFFER_SIZE),this.context=Ae.cache(n.constructor),this.root=new Bi(this.context),this.setState(n)}setState(n){this.state=n,this.state[h].setRoot(this.root)}encode(n={offset:0},r,o=this.sharedBuffer,c="changes",p=c==="allChanges",b=n.offset){const _=r!==void 0,w=this.state[h],A=this.root[c];for(let D=0,$=A.length;D<$;D++){const R=A[D];if(!R)continue;if(_){if(!r.isChangeTreeVisible(R)){r.invisible.add(R);continue}r.invisible.delete(R)}const X=R[c],K=R.ref,U=X.operations.length;if(U===0)continue;const N=K.constructor,q=N[u],ye=N[m],De=N[Symbol.metadata];(_||n.offset>b||R!==w)&&(o[n.offset++]=255,ve.number(o,R.refId,n));for(let Ke=0;Ke<U;Ke++){const Ze=X.operations[Ke],Nt=Ze<0?Math.abs(Ze):p?e.OPERATION.ADD:R.indexedOperations[Ze];Ze===void 0||Nt===void 0||ye&&!ye(K,Ze,r)||q(this,o,R,Ze,Nt,n,p,_,De)}}if(n.offset>o.byteLength){const D=Math.ceil(n.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(D/1024)} * 1024; // ${Math.round(D/1024)} KB
`),o=Buffer.alloc(D,o),o===this.sharedBuffer&&(this.sharedBuffer=o),this.encode({offset:b},r,o,c,p)}else return o.subarray(0,n.offset)}encodeAll(n={offset:0},r=this.sharedBuffer){return this.encode(n,void 0,r,"allChanges",!0)}encodeAllView(n,r,o,c=this.sharedBuffer){const p=o.offset;return this.encode(o,n,c,"allFilteredChanges",!0,p),Buffer.concat([c.subarray(0,r),c.subarray(p,o.offset)])}debugChanges(n){(typeof n=="string"?this.root[n]:n).forEach(o=>{const c=o[n],p=o.ref.constructor[Symbol.metadata];console.log("->",{ref:o.ref.constructor.name,refId:o.refId,changes:Object.keys(c).length});for(const b in c){const _=c[b];console.log("  ->",{index:b,field:p==null?void 0:p[b],op:e.OPERATION[_]})}})}encodeView(n,r,o,c=this.sharedBuffer){const p=o.offset;for(const[b,_]of n.changes){const w=this.root.changeTrees[b];if(w===void 0){n.changes.delete(b);continue}const A=Object.keys(_);if(A.length===0)continue;const $=w.ref.constructor,R=$[u],X=$[Symbol.metadata];c[o.offset++]=255,ve.number(c,w.refId,o);for(let K=0,U=A.length;K<U;K++){const N=Number(A[K]),ye=w.ref[g](N)!==void 0&&_[N]||e.OPERATION.DELETE;R(this,c,w,N,ye,o,!1,!0,X)}}return n.changes.clear(),this.encode(o,n,c,"filteredChanges",!1,p),Buffer.concat([c.subarray(0,r),c.subarray(p,o.offset)])}discardChanges(){var r,o;let n=this.root.changes.length;if(n>0){for(;n--;)(r=this.root.changes[n])==null||r.endEncode("changes");this.root.changes.length=0}if(n=this.root.filteredChanges.length,n>0){for(;n--;)(o=this.root.filteredChanges[n])==null||o.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(n,r,o,c){const p=this.context.getTypeId(r),b=this.context.getTypeId(o);if(b===void 0){console.warn(`@colyseus/schema WARNING: Class "${o.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}p!==b&&(n[c.offset++]=213,ve.number(n,b,c))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};Mn.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let dn=Mn;function ii(f,n){if(n===-1||n>=f.length)return!1;const r=f.length-1;for(let o=n;o<r;o++)f[o]=f[o+1];return f.length=r,!0}class ri extends Error{constructor(n){super(n),this.name="DecodingWarning"}}class $i{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(n,r,o=!0){this.refs.set(n,r),this.refIds.set(r,n),o&&(this.refCounts[n]=(this.refCounts[n]||0)+1),this.deletedRefs.has(n)&&this.deletedRefs.delete(n)}removeRef(n){const r=this.refCounts[n];if(r===void 0){try{throw new ri("trying to remove refId that doesn't exist: "+n)}catch(o){console.warn(o)}return}if(r===0){try{const o=this.refs.get(n);throw new ri(`trying to remove refId '${n}' with 0 refCount (${o.constructor.name}: ${JSON.stringify(o)})`)}catch(o){console.warn(o)}return}(this.refCounts[n]=r-1)<=0&&this.deletedRefs.add(n)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(n=>{if(this.refCounts[n]>0)return;const r=this.refs.get(n);if(r.constructor[Symbol.metadata]!==void 0){const o=r.constructor[Symbol.metadata];for(const c in o){const p=o[c].name,b=typeof r[p]=="object"&&this.refIds.get(r[p]);b&&!this.deletedRefs.has(b)&&this.removeRef(b)}}else typeof r[I]=="function"&&Array.from(r.values()).forEach(o=>{const c=this.refIds.get(o);this.deletedRefs.has(c)||this.removeRef(c)});this.refs.delete(n),delete this.refCounts[n],delete this.callbacks[n]}),this.deletedRefs.clear()}addCallback(n,r,o){if(n===void 0){const c=typeof r=="number"?e.OPERATION[r]:r;throw new Error(`Can't addCallback on '${c}' (refId is undefined)`)}return this.callbacks[n]||(this.callbacks[n]={}),this.callbacks[n][r]||(this.callbacks[n][r]=[]),this.callbacks[n][r].push(o),()=>this.removeCallback(n,r,o)}removeCallback(n,r,o){var p,b,_;const c=(_=(b=(p=this.callbacks)==null?void 0:p[n])==null?void 0:b[r])==null?void 0:_.indexOf(o);c!==-1&&ii(this.callbacks[n][r],c)}}class es{constructor(n,r){this.currentRefId=0,this.setState(n),this.context=r||new Ae(n.constructor)}setState(n){this.state=n,this.root=new $i,this.root.addRef(0,n)}decode(n,r={offset:0},o=this.state){var w,A,D;const c=[],p=this.root,b=n.byteLength;let _=o.constructor[d];for(this.currentRefId=0;r.offset<b;){if(n[r.offset]==255){r.offset++,this.currentRefId=G.number(n,r);const R=p.refs.get(this.currentRefId);if(!R)throw new Error(`"refId" not found: ${this.currentRefId}`);(w=o[J])==null||w.call(o),o=R,_=o.constructor[d];continue}if(_(this,n,r,o,c)===Zs){console.warn("@colyseus/schema: definition mismatch");const R={offset:r.offset};for(;r.offset<b&&!(n[r.offset]===255&&(R.offset=r.offset+1,p.refs.has(G.number(n,R))));)r.offset++;continue}}return(A=o[J])==null||A.call(o),(D=this.triggerChanges)==null||D.call(this,c),p.garbageCollectDeletedRefs(),c}getInstanceType(n,r,o){let c;if(n[r.offset]===213){r.offset++;const p=G.number(n,r);c=this.context.get(p)}return c||o}createInstanceOfType(n){return new n}removeChildRefs(n,r){const o=typeof n[I]!="string",c=this.root.refIds.get(n);n.forEach((p,b)=>{r.push({ref:n,refId:c,op:e.OPERATION.DELETE,field:b,value:void 0,previousValue:p}),o&&this.root.removeRef(this.root.refIds.get(p))})}}class sn extends Me{}kt([ht("string")],sn.prototype,"name",void 0),kt([ht("string")],sn.prototype,"type",void 0),kt([ht("number")],sn.prototype,"referencedType",void 0);class rn extends Me{constructor(){super(...arguments),this.fields=new bt}}kt([ht("number")],rn.prototype,"id",void 0),kt([ht("number")],rn.prototype,"extendsId",void 0),kt([ht([sn])],rn.prototype,"fields",void 0);class Ht extends Me{constructor(){super(...arguments),this.types=new bt}static encode(n,r={offset:0}){const o=n.context,c=new Ht,p=new dn(c),b=o.schemas.get(n.state.constructor);b>0&&(c.rootType=b);const _=new Set,w={},A=$=>{if($.extendsId===void 0||_.has($.extendsId)){_.add($.id),c.types.push($);const R=w[$.id];R!==void 0&&(delete w[$.id],R.forEach(X=>A(X)))}else w[$.extendsId]===void 0&&(w[$.extendsId]=[]),w[$.extendsId].push($)};o.schemas.forEach(($,R)=>{const X=new rn;X.id=Number($);const K=Object.getPrototypeOf(R);K!==Me&&(X.extendsId=o.schemas.get(K));const U=R[Symbol.metadata];if(U!==K[Symbol.metadata])for(const N in U){const q=Number(N),ye=U[q].name;if(!Object.prototype.hasOwnProperty.call(U,ye))continue;const De=new sn;De.name=ye;let Ke;const Ze=U[q];if(typeof Ze.type=="string")Ke=Ze.type;else{let Nt;Me.is(Ze.type)?(Ke="ref",Nt=Ze.type):(Ke=Object.keys(Ze.type)[0],typeof Ze.type[Ke]=="string"?Ke+=":"+Ze.type[Ke]:Nt=Ze.type[Ke]),De.referencedType=Nt?o.getTypeId(Nt):-1}De.type=Ke,X.fields.push(De)}A(X)});for(const $ in w)w[$].forEach(R=>c.types.push(R));const D=p.encodeAll(r);return Buffer.from(D,0,r.offset)}static decode(n,r){const o=new Ht;new es(o).decode(n,r);const p=new Ae;o.types.forEach(w=>{const A=p.get(w.extendsId)??Me,D=class extends A{};Ae.register(D),p.add(D,w.id)},{});const b=(w,A,D)=>{A.fields.forEach(($,R)=>{const X=D+R;if($.referencedType!==void 0){let K=$.type,U=p.get($.referencedType);if(!U){const N=$.type.split(":");K=N[0],U=N[1]}K==="ref"?xe.addField(w,X,$.name,U):xe.addField(w,X,$.name,{[K]:U})}else xe.addField(w,X,$.name,$.type)})};o.types.forEach(w=>{const A=p.get(w.id),D=xe.initialize(A),$=[];let R=w;do $.push(R),R=o.types.find(K=>K.id===R.extendsId);while(R);let X=0;$.reverse().forEach(K=>{b(D,K,X),X+=K.fields.length})});const _=new(p.get(o.rootType||0));return new es(_,p)}}kt([ht([rn])],Ht.prototype,"types",void 0),kt([ht("number")],Ht.prototype,"rootType",void 0);function Mi(f){const n=f.root,r=n.callbacks,o=new WeakMap;let c;f.triggerChanges=function(_){var A;const w=new Set;for(let D=0,$=_.length;D<$;D++){const R=_[D],X=R.refId,K=R.ref,U=r[X];if(U){if((R.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&R.previousValue instanceof Me){const N=(A=r[n.refIds.get(R.previousValue)])==null?void 0:A[e.OPERATION.DELETE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q]()}if(K instanceof Me){if(!w.has(X)){const N=U==null?void 0:U[e.OPERATION.REPLACE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q]()}if(U.hasOwnProperty(R.field)){const N=U[R.field];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.previousValue)}}else{if((R.op&e.OPERATION.DELETE)===e.OPERATION.DELETE){if(R.previousValue!==void 0){const N=U[e.OPERATION.DELETE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.previousValue,R.dynamicIndex??R.field)}if((R.op&e.OPERATION.ADD)===e.OPERATION.ADD){const N=U[e.OPERATION.ADD];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}}else if((R.op&e.OPERATION.ADD)===e.OPERATION.ADD&&R.previousValue!==R.value){const N=U[e.OPERATION.ADD];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}if(R.value!==R.previousValue&&(R.value!==void 0||R.previousValue!==void 0)){const N=U[e.OPERATION.REPLACE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}}w.add(X)}}};function p(_,w){var $;let A=(($=w.instance)==null?void 0:$.constructor[Symbol.metadata])||_,D=w.instance&&typeof w.instance.forEach=="function"||_&&typeof _[Symbol.metadata]>"u";if(A&&!D){const R=function(X,K,U,N){return N&&w.instance[K]!==void 0&&!o.has(c)&&U(w.instance[K],void 0),n.addCallback(n.refIds.get(X),K,U)};return new Proxy({listen:function(K,U,N=!0){if(w.instance)return R(w.instance,K,U,N);{let q=()=>{};return w.onInstanceAvailable((ye,De)=>{q=R(ye,K,U,N&&De&&!o.has(c))}),()=>q()}},onChange:function(K){return n.addCallback(n.refIds.get(w.instance),e.OPERATION.REPLACE,K)},bindTo:function(K,U){return U||(U=Object.keys(A).map(N=>A[N].name)),n.addCallback(n.refIds.get(w.instance),e.OPERATION.REPLACE,()=>{U.forEach(N=>K[N]=w.instance[N])})}},{get(X,K){var N;const U=A[A[K]];if(U){const q=(N=w.instance)==null?void 0:N[K],ye=De=>{const Ke=b(w.instance).listen(K,(Ze,Nt)=>{De(Ze,!1),Ke==null||Ke()},!1);n.refIds.get(q)!==void 0&&De(q,!0)};return p(U.type,{instance:n.refIds.get(q)&&q,parentInstance:w.instance,onInstanceAvailable:ye})}else return X[K]},has(X,K){return A[K]!==void 0},set(X,K,U){throw new Error("not allowed")},deleteProperty(X,K){throw new Error("not allowed")}})}else{const R=function(U,N,q){return q&&U.forEach((ye,De)=>N(ye,De)),n.addCallback(n.refIds.get(U),e.OPERATION.ADD,(ye,De)=>{o.set(N,!0),c=N,N(ye,De),o.delete(N),c=void 0})},X=function(U,N){return n.addCallback(n.refIds.get(U),e.OPERATION.DELETE,N)},K=function(U,N){return n.addCallback(n.refIds.get(U),e.OPERATION.REPLACE,N)};return new Proxy({onAdd:function(U,N=!0){if(w.instance)return R(w.instance,U,N&&!o.has(c));if(w.onInstanceAvailable){let q=()=>{};return w.onInstanceAvailable((ye,De)=>{q=R(ye,U,N&&De&&!o.has(c))}),()=>q()}},onRemove:function(U){if(w.instance)return X(w.instance,U);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(q=>{N=X(q,U)}),()=>N()}},onChange:function(U){if(w.instance)return K(w.instance,U);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(q=>{N=K(q,U)}),()=>N()}}},{get(U,N){if(!U[N])throw new Error(`Can't access '${N}' through callback proxy. access the instance directly.`);return U[N]},has(U,N){return U[N]!==void 0},set(U,N,q){throw new Error("not allowed")},deleteProperty(U,N){throw new Error("not allowed")}})}}function b(_){return p(void 0,{instance:_})}return b}function Ui(f,n){f.triggerChanges=n}class Fi{constructor(n=!1){this.iterable=n,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,n&&(this.items=[])}add(n,r=Ot,o=!0){var _,w;const c=n==null?void 0:n[h];if(c){if(!c.parent&&c.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${c.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",n),this;const p=n.constructor[Symbol.metadata];this.visible.add(c),this.iterable&&o&&this.items.push(n),o&&c.parent&&this.addParentOf(c,r);let b=this.changes.get(c.refId);if(b===void 0&&(b={},this.changes.set(c.refId,b)),r!==Ot){this.tags||(this.tags=new WeakMap);let A;this.tags.has(c)?A=this.tags.get(c):(A=new Set,this.tags.set(c,A)),A.add(r),(w=(_=p==null?void 0:p[re])==null?void 0:_[r])==null||w.forEach(D=>{c.getChange(D)!==e.OPERATION.DELETE&&(b[D]=e.OPERATION.ADD)})}else{const A=this.invisible.has(c),D=c.filteredChanges!==void 0?c.allFilteredChanges:c.allChanges;for(let $=0,R=D.operations.length;$<R;$++){const X=D.operations[$];if(X===void 0)continue;const K=c.indexedOperations[X]??e.OPERATION.ADD,U=p==null?void 0:p[X].tag;!c.isNew&&(A||U===void 0||U===r)&&K!==e.OPERATION.DELETE&&(b[X]=K)}}return c.forEachChild((A,D)=>{p&&p[D].tag!==void 0&&p[D].tag!==r||this.add(A.ref,r,!1)}),this}addParentOf(n,r){var p;const o=n.parent[h],c=n.parentIndex;if(!this.visible.has(o)){this.visible.add(o);const b=(p=o.parent)==null?void 0:p[h];b&&b.filteredChanges!==void 0&&this.addParentOf(o,r)}if(o.getChange(c)!==e.OPERATION.DELETE){let b=this.changes.get(o.refId);b===void 0&&(b={},this.changes.set(o.refId,b)),this.tags||(this.tags=new WeakMap);let _;this.tags.has(o)?_=this.tags.get(o):(_=new Set,this.tags.set(o,_)),_.add(r),b[c]=e.OPERATION.ADD}}remove(n,r=Ot,o=!1){var w;const c=n[h];if(!c)return console.warn("StateView#remove(), invalid object:",n),this;this.visible.delete(c),this.iterable&&!o&&ii(this.items,this.items.indexOf(n));const b=c.ref.constructor[Symbol.metadata];let _=this.changes.get(c.refId);if(_===void 0&&(_={},this.changes.set(c.refId,_)),r===Ot){const A=c.parent;if(!xe.isValidInstance(A)&&c.isFiltered){const D=A[h];let $=this.changes.get(D.refId);$===void 0&&($={},this.changes.set(D.refId,$)),$[c.parentIndex]=e.OPERATION.DELETE}else(w=b==null?void 0:b[de])==null||w.forEach(D=>_[D]=e.OPERATION.DELETE)}else b==null||b[re][r].forEach(A=>_[A]=e.OPERATION.DELETE);if(this.tags&&this.tags.has(c)){const A=this.tags.get(c);r===void 0?this.tags.delete(c):(A.delete(r),A.size===0&&this.tags.delete(c))}return this}has(n){return this.visible.has(n[h])}hasTag(n,r=Ot){var c;const o=(c=this.tags)==null?void 0:c.get(n[h]);return(o==null?void 0:o.has(r))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let n=0,r=this.items.length;n<r;n++)this.remove(this.items[n],Ot,!0);this.items.length=0}isChangeTreeVisible(n){let r=this.visible.has(n);return!r&&n.isVisibilitySharedWithParent&&this.visible.has(n.parent[h])&&(this.visible.add(n),r=!0),r}}fe("map",{constructor:ct}),fe("array",{constructor:bt}),fe("set",{constructor:wn}),fe("collection",{constructor:_n}),e.$changes=h,e.$childType=I,e.$decoder=d,e.$deleteByIndex=y,e.$encoder=u,e.$filter=m,e.$getByIndex=g,e.$track=l,e.ArraySchema=bt,e.ChangeTree=Lt,e.CollectionSchema=_n,e.Decoder=es,e.Encoder=dn,e.MapSchema=ct,e.Metadata=xe,e.Reflection=Ht,e.ReflectionField=sn,e.ReflectionType=rn,e.Schema=Me,e.SetSchema=wn,e.StateView=Fi,e.TypeContext=Ae,e.decode=G,e.decodeKeyValueOperation=Bn,e.decodeSchemaOperation=zs,e.defineCustomTypes=Pe,e.defineTypes=Li,e.deprecated=vn,e.dumpChanges=ki,e.encode=ve,e.encodeArray=kn,e.encodeKeyValueOperation=bn,e.encodeSchemaOperation=ps,e.entity=Ci,e.getDecoderStateCallbacks=Mi,e.getRawChangesCallback=Ui,e.registerType=fe,e.schema=Qs,e.type=ht,e.view=Xs})})(Ca,Ca.exports);var rt=Ca.exports,Rp=Object.defineProperty,Np=Object.getOwnPropertyDescriptor,wt=(s,t,e,i)=>{for(var a=i>1?void 0:i?Np(t,e):t,l=s.length-1,u;l>=0;l--)(u=s[l])&&(a=(i?u(t,e,a):u(a))||a);return i&&a&&Rp(t,e,a),a},Ue=(s=>(s.Lobby="Lobby",s.Shop="Shop",s.Preparation="Preparation",s.Battle="Battle",s.BattleEnd="BattleEnd",s.GameOver="GameOver",s))(Ue||{});const zn=class Cc extends rt.Schema{constructor(){super(...arguments),this.instanceId="",this.cardId="",this.name="",this.attack=0,this.speed=0,this.health=0,this.currentHp=0,this.brewCost=0,this.description="",this.isLegend=!1}static fromCardData(t,e){const i=new Cc;return i.instanceId=e,i.cardId=t.id,i.name=t.name,i.attack=t.attack,i.speed=t.speed,i.health=t.health,i.currentHp=t.health,i.brewCost=t.brewCost,i.description=t.description,i.isLegend=t.isLegend,i}};wt([rt.type("string")],zn.prototype,"instanceId",2);wt([rt.type("string")],zn.prototype,"cardId",2);wt([rt.type("string")],zn.prototype,"name",2);wt([rt.type("number")],zn.prototype,"attack",2);wt([rt.type("number")],zn.prototype,"speed",2);wt([rt.type("number")],zn.prototype,"health",2);wt([rt.type("number")],zn.prototype,"currentHp",2);wt([rt.type("number")],zn.prototype,"brewCost",2);wt([rt.type("string")],zn.prototype,"description",2);wt([rt.type("boolean")],zn.prototype,"isLegend",2);let Lc=zn;class us extends rt.Schema{constructor(){super(...arguments),this.sessionId="",this.username="Player",this.health=100,this.brews=5,this.shopRefreshCost=1,this.hand=new rt.MapSchema,this.battlefield=new rt.MapSchema,this.isReady=!1,this.shopOfferIds=new rt.ArraySchema}}wt([rt.type("string")],us.prototype,"sessionId",2);wt([rt.type("string")],us.prototype,"username",2);wt([rt.type("number")],us.prototype,"health",2);wt([rt.type("number")],us.prototype,"brews",2);wt([rt.type("number")],us.prototype,"shopRefreshCost",2);wt([rt.type({map:Lc})],us.prototype,"hand",2);wt([rt.type({map:Lc})],us.prototype,"battlefield",2);wt([rt.type("boolean")],us.prototype,"isReady",2);wt([rt.type(["string"])],us.prototype,"shopOfferIds",2);class ea extends rt.Schema{constructor(){super(...arguments),this.players=new rt.MapSchema,this.currentDay=0,this.currentPhase="Lobby",this.battleTimer=0}}wt([rt.type({map:us})],ea.prototype,"players",2);wt([rt.type("number")],ea.prototype,"currentDay",2);wt([rt.type("string")],ea.prototype,"currentPhase",2);wt([rt.type("number")],ea.prototype,"battleTimer",2);class Pp extends fs.Scene{constructor(){super("Lobby");ce(this,"playerTextObjects",new Map);ce(this,"statusText");ce(this,"readyButton");ce(this,"waitingText");ce(this,"phaseListenerUnsub",null);ce(this,"playerAddListenerUnsub",null);ce(this,"playerRemoveListenerUnsub",null);ce(this,"playerStateListeners",new Map);ce(this,"listenersAttached",!1)}create(){if(this.scene.launch("background"),this.listenersAttached=!1,!S||!S.sessionId){console.error("Lobby Scene: Not connected to Colyseus room or no session ID!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Not connected to server.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{S==null||S.leave()}catch{}this.scene.start("MainMenu")});return}this.add.text(this.cameras.main.centerX,100,"Lobby",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,200,"Players in Lobby:",{fontFamily:"Arial",fontSize:32,color:"#dddddd",align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-100,"Connecting to lobby...",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.readyButton=this.add.text(this.cameras.main.centerX,this.cameras.main.height-150,"Ready Up",{fontFamily:"Arial Black",fontSize:40,color:"#888888",backgroundColor:"#333333",padding:{x:20,y:10},stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setVisible(!1).disableInteractive(),this.waitingText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-110,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.readyButton.on("pointerdown",()=>{var e;S&&((e=this.readyButton.input)!=null&&e.enabled)&&(console.log("Lobby: Sending playerReady message."),S.send("playerReady"))}),this.readyButton.on("pointerover",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled&&this.readyButton.setColor("#55ff55")}),this.readyButton.on("pointerout",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled?this.readyButton.setColor("#00ff00"):this.readyButton.setColor("#888888")}),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}attachMainListenersAndUI(){if(this.listenersAttached){console.log("Lobby: Main listeners and UI setup already performed, skipping.");return}if(!this.scene.isActive()){console.warn("Lobby: attachMainListenersAndUI called but scene is not active. Aborting.");return}if(!S||!S.state){console.warn("Lobby: attachMainListenersAndUI called but Colyseus room or state is not ready. Aborting.");return}console.log("Lobby: Attaching main Colyseus listeners and performing initial UI update."),this.attachMainListeners(),this.updateLobbyUI(),this.listenersAttached=!0}setupColyseusListeners(){if(!S){console.error("Lobby: setupColyseusListeners called but colyseusRoom is null.");return}console.log("Lobby: Setting up Colyseus general listeners."),S.state&&!this.listenersAttached&&(console.log("Lobby: State already available on setup. Scheduling attachMainListenersAndUI."),this.time.delayedCall(1,this.attachMainListenersAndUI,[],this)),S.onStateChange.once(e=>{if(console.log("Lobby: Initial state received via onStateChange.once."),!this.scene.isActive()){console.log("Lobby: Scene became inactive before onStateChange.once processing could complete.");return}this.attachMainListenersAndUI()})}attachMainListeners(){if(!S||!S.state){console.error("Lobby: attachMainListeners - colyseusRoom or state is null.");return}const e=Hn.getStateCallbacks(S);this.phaseListenerUnsub&&this.phaseListenerUnsub(),this.phaseListenerUnsub=e(S.state).listen("currentPhase",(i,a)=>{this.scene.isActive()&&(console.log(`Lobby: Phase changed from ${a} to: ${i}`),i===Ue.Shop?(this.statusText.setText("Starting Game!"),this.time.delayedCall(500,()=>{this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"))})):i===Ue.Lobby?this.updateLobbyUI():i===Ue.GameOver&&(this.statusText.setText("Game Over. Returning to Main Menu."),this.time.delayedCall(1500,()=>{if(this.scene.isActive()){try{S==null||S.leave()}catch{}this.scene.stop(),this.scene.start("MainMenu")}})))}),this.playerAddListenerUnsub&&this.playerAddListenerUnsub(),this.playerAddListenerUnsub=e(S.state.players).onAdd((i,a)=>{this.scene.isActive()&&(console.log(`Lobby: Player joined: ${i.username} (${a})`),this.addPlayerStateListener(i,a),this.updateLobbyUI())}),this.playerRemoveListenerUnsub&&this.playerRemoveListenerUnsub(),this.playerRemoveListenerUnsub=e(S.state.players).onRemove((i,a)=>{this.scene.isActive()&&(console.log(`Lobby: Player left: ${i.username} (${a})`),this.removePlayerStateListener(a),this.updateLobbyUI())}),S.state.players.forEach((i,a)=>{this.addPlayerStateListener(i,a)})}addPlayerStateListener(e,i){var u;if(!S)return;const a=Hn.getStateCallbacks(S);(u=this.playerStateListeners.get(i))==null||u(),console.log(`Lobby: Adding 'isReady' listener for player ${i}`);const l=a(e).listen("isReady",(d,m)=>{console.log(`Lobby: isReady changed for player ${i}: ${m} -> ${d}`),this.scene.isActive()&&this.updateLobbyUI()});this.playerStateListeners.set(i,l)}removePlayerStateListener(e){const i=this.playerStateListeners.get(e);i&&(console.log(`Lobby: Removing 'isReady' listener for player ${e}`),i(),this.playerStateListeners.delete(e))}updateLobbyUI(){if(!this.scene.isActive()){console.warn("Lobby: updateLobbyUI called but scene is NOT ACTIVE. Aborting UI update.");return}if(!S){console.warn("Lobby: updateLobbyUI called but colyseusRoom is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Connection lost.");return}if(!S.state){console.warn("Lobby: updateLobbyUI called but colyseusRoom.state is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Game state unavailable.");return}ws.size===0&&(console.log("Lobby: Card data not loaded yet. Loading..."),Dp(()=>Promise.resolve().then(()=>mp),void 0).then(({loadAllCardData:h})=>{h().then(I=>{I?console.log("Lobby: Card data loaded successfully"):console.warn("Lobby: Failed to load card data")})}));const e=S.state.players,i=S.sessionId,a=e.size,l=250,u=40;this.playerTextObjects.forEach(h=>h.destroy()),this.playerTextObjects.clear();let d=0,m=a>0,g=!1;const y=e.get(i);y&&(g=y.isReady),e.forEach((h,I)=>{const j=I===i,J=h.isReady?" [Ready]":" [Not Ready]",H=`${h.username||"Joining..."}${j?" (You)":""}${J}`,z=this.add.text(this.cameras.main.centerX,l+d*u,H,{fontFamily:"Arial",fontSize:24,color:h.isReady?"#00ff00":"#ffffff",align:"center"}).setOrigin(.5);this.playerTextObjects.set(I,z),d++,h.isReady||(m=!1)}),a<2?(this.statusText.setText("Waiting for opponent..."),this.readyButton.setVisible(!1).disableInteractive(),this.waitingText.setVisible(!1)):(this.readyButton.setVisible(!0),g?(this.statusText.setText("Waiting for opponent to ready up..."),this.readyButton.setText("Waiting...").setColor("#888888").disableInteractive(),this.waitingText.setText(m?"Starting game...":"Waiting for opponent...").setVisible(!0)):(this.statusText.setText("Lobby full. Ready up!"),this.readyButton.setText("Ready Up").setColor("#00ff00").setInteractive({useHandCursor:!0}),this.waitingText.setVisible(!1)),m&&(this.statusText.setText("Starting game..."),this.readyButton.setVisible(!1),this.waitingText.setVisible(!1)))}shutdown(){var e,i,a,l,u,d,m,g,y;console.log("Lobby scene shutting down."),this.listenersAttached=!1,(e=this.phaseListenerUnsub)==null||e.call(this),(i=this.playerAddListenerUnsub)==null||i.call(this),(a=this.playerRemoveListenerUnsub)==null||a.call(this),this.playerStateListeners.forEach(h=>h()),this.playerStateListeners.clear(),this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerTextObjects.forEach(h=>h.destroy()),this.playerTextObjects.clear(),(l=this.statusText)==null||l.destroy(),(u=this.readyButton)==null||u.destroy(),(d=this.waitingText)==null||d.destroy(),(m=this.readyButton)==null||m.off("pointerdown"),(g=this.readyButton)==null||g.off("pointerover"),(y=this.readyButton)==null||y.off("pointerout"),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const ts=120,fi=168;class Cp extends fs.Scene{constructor(){super("Shop");ce(this,"continueButton");ce(this,"shopCardObjects",[]);ce(this,"waitingText");ce(this,"refreshButton");ce(this,"cardDataCache",new Map);ce(this,"shopOffersContainer");ce(this,"shopOffersBackground");ce(this,"toggleShopButton");ce(this,"shopOffersVisible",!0);ce(this,"phaseListenerUnsub",null);ce(this,"playerStateListenersUnsub",new Map);ce(this,"shopOfferListenersUnsub",[]);ce(this,"listeners",[])}create(){var m;if(this.scene.launch("background"),(m=this.scene.get("BoardView"))!=null&&m.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!S||!S.state||!S.sessionId){console.error("Shop Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{S==null||S.leave(!0)}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,i=this.cameras.main.centerY,a=this.cameras.main.width,l=this.cameras.main.height;this.createShopCardsDisplay(e,i,a),this.setupDragAndDrop(),this.requestMissingCardData();const u=S.state.players.get(S.sessionId),d=(u==null?void 0:u.shopRefreshCost)||2;this.refreshButton=this.add.text(a-150,180,`Refresh: ${d} `,{fontFamily:"Arial",fontSize:18,color:"#FFFFFF",backgroundColor:"#4444AA",padding:{x:10,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.refreshButton.on("pointerdown",()=>{const g=S==null?void 0:S.state.players.get(S.sessionId);S&&g&&g.brews>=g.shopRefreshCost&&S.send("refreshShop")}),this.refreshButton.on("pointerover",()=>{var g;(g=this.refreshButton.input)!=null&&g.enabled&&this.refreshButton.setBackgroundColor("#6666CC")}),this.refreshButton.on("pointerout",()=>{var g;(g=this.refreshButton.input)!=null&&g.enabled&&this.refreshButton.setBackgroundColor("#4444AA")}),this.updateRefreshButtonState(),this.continueButton=this.add.text(e,l-50,"Continue",{fontFamily:"Arial Black",fontSize:40,color:"#00ff00",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.continueButton.on("pointerdown",()=>{const g=S==null?void 0:S.state.players.get(S.sessionId);S&&g&&!g.isReady&&S.state.currentPhase===Ue.Shop&&S.send("playerReady")}),this.continueButton.on("pointerover",()=>{var g;(g=this.continueButton.input)!=null&&g.enabled&&this.continueButton.setColor("#55ff55")}),this.continueButton.on("pointerout",()=>{var g;(g=this.continueButton.input)!=null&&g.enabled?this.continueButton.setColor("#00ff00"):this.continueButton.setColor("#888888")}),this.waitingText=this.add.text(e,l-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(50,()=>this.createShopCardsDisplay(e,i,a)),this.toggleShopButton=this.add.text(a-100,i-250,"Toggle Shop",{fontFamily:"Arial",fontSize:16,color:"#FFFFFF",backgroundColor:"#555555",padding:{x:5,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.toggleShopButton.on("pointerdown",()=>{this.shopOffersVisible=!this.shopOffersVisible,this.shopOffersContainer.setVisible(this.shopOffersVisible),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop")}),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop"),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createShopCardsDisplay(e,i,a){var J;(J=this.shopOffersContainer)==null||J.destroy(),this.shopOffersContainer=this.add.container(0,0),this.shopOffersContainer.setVisible(this.shopOffersVisible),this.shopCardObjects.forEach(H=>H.destroy()),this.shopCardObjects=[];const l=S==null?void 0:S.state.players.get(S.sessionId),u=l==null?void 0:l.shopOfferIds;if(!u||u.length===0){console.log("Shop: No shop offers from server."),this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.setVisible(!1);return}const d=20,m=u.length>0?u.length:4,g=i,y=m*ts+(m-1)*d,h=e-y/2+ts/2,I=y+d*2,j=fi+d*2;this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.destroy(),this.shopOffersBackground=this.add.rectangle(e,g,I,j,51,.6),this.shopOffersContainer.add(this.shopOffersBackground),u.forEach((H,z)=>{const ue=this.getCardDataFromServer(H);if(!ue){console.warn(`Shop: Card data not found for ID: ${H}`);return}const de=h+z*(ts+d),re=this.add.container(de,g),Te=this.add.image(0,0,"cardFullTier1").setOrigin(.5).setDisplaySize(ts,fi);re.add(Te);const $e=this.add.text(0,-20,ue.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:ts-20}}).setOrigin(.5,.5);re.add($e);const tt=this.add.text(-ts/2+32,fi*.03,`${ue.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(0,.5);re.add(tt);const at=this.add.text(ts/2-18,6,`${ue.health}/${ue.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,.5);re.add(at);const mt=this.add.text(0,fi/2-50,`${ue.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);re.add(mt);const ot=this.add.text(ts/2-8,-fi/2+8,`${ue.brewCost}B`,{fontFamily:"Arial",fontSize:14,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"right"}).setOrigin(1,0);re.add(ot),re.setSize(ts,fi),re.setSize(ts,fi),re.setInteractive({useHandCursor:!0}),re.setData("cardId",ue.id),re.setData("cardData",ue),this.input.setDraggable(re),re.off("pointerdown").on("pointerdown",Rt=>{var Je;(Je=re.input)!=null&&Je.enabled&&re.setData("isBeingDragged",!1)}),re.off("pointerup").on("pointerup",Rt=>{var V;if(!((V=re.input)!=null&&V.enabled)||!S||!S.sessionId)return;if(re.getData("isBeingDragged")===!0){re.setData("isBeingDragged",!1);return}const Je=S.state.players.get(S.sessionId);if(!Je)return;let Ve=-1;for(let se=0;se<5;se++)if(!Je.hand.has(String(se))){Ve=se;break}if(Ve!==-1){const se=re.getData("cardId"),te=re.getData("cardData");se&&te&&Je.brews>=te.brewCost?(console.log(`Shop: Click-to-buy card ${se} (Cost: ${te.brewCost}) into hand slot ${Ve}. Brews: ${Je.brews}`),S.send("buyCard",{cardId:se,handSlotIndex:Ve})):te&&Je.brews<te.brewCost?console.log(`Shop: Not enough brews (${Je.brews}) to click-buy card ${se} (Cost: ${te.brewCost}).`):console.log(`Shop: Click-to-buy failed for card ${se}. CardData: ${!!te}`)}else console.log("Shop: Hand is full, cannot click-buy.")}),this.shopCardObjects.push(re),this.shopOffersContainer.add(re)})}requestMissingCardData(){if(!S||!S.state||!S.sessionId)return;const e=S.state.players.get(S.sessionId);if(!e)return;const i=e.shopOfferIds;if(i&&i.length>0){const a=[];i.forEach(l=>{ws.has(l)||a.push(l)}),a.length>0&&(console.log("Requesting missing cards from server:",a),S.send("getCardsByIds",{cardIds:a}))}}getCardDataFromServer(e){if(ws.has(e))return ws.get(e);if(!S||!S.state)return;let i;return S.state.players.forEach(a=>{a.hand.forEach(l=>{l.cardId===e&&(i={id:l.cardId,name:l.name,attack:l.attack,speed:l.speed,health:l.health,brewCost:l.brewCost,description:l.description,isLegend:l.isLegend})}),a.battlefield.forEach(l=>{l.cardId===e&&(i={id:l.cardId,name:l.name,attack:l.attack,speed:l.speed,health:l.health,brewCost:l.brewCost,description:l.description,isLegend:l.isLegend})})}),i||(i={id:e,name:`Card ${e.split("_").pop()}`,attack:1,speed:1,health:1,brewCost:1,description:"Loading card details...",isLegend:!1},console.warn(`Shop: Card data not found for ID: ${e} in global cache or state`)),i}setupDragAndDrop(){this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),this.input.off("pointerdown"),this.input.off("pointerup"),this.shopCardObjects.forEach(e=>{e.off("pointerdown"),e.off("pointerup")}),this.input.on("dragstart",(e,i)=>{var a;!(i instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(i)||(a=i.input)!=null&&a.enabled&&(this.children.bringToTop(i),i.setAlpha(.7),i.setData("startX",i.x),i.setData("startY",i.y),i.setData("isBeingDragged",!0))}),this.input.on("drag",(e,i,a,l)=>{var u;!(i instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(i)||(u=i.input)!=null&&u.enabled&&i.getData("isBeingDragged")===!0&&(i.x=a,i.y=l)}),this.input.on("dragend",(e,i)=>{if(!S||!(i instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(i)){i instanceof Phaser.GameObjects.Container&&i.setData("isBeingDragged",!1);return}i.setAlpha(1);let a=!1;if(i.getData("isBeingDragged")===!0){const l=i.x,u=i.y,d=this.scene.get("BoardView");for(let m=0;m<5;m++){const g=d==null?void 0:d.getSlotPixelPosition(!0,"hand",m);if(g){const y=new Phaser.Geom.Rectangle(g.x-50,g.y-70,100,140);if(Phaser.Geom.Rectangle.Contains(y,l,u)){const h=S.state.players.get(S.sessionId);if(h&&!h.hand.has(String(m))){const I=i.getData("cardId"),j=i.getData("cardData");I&&j&&h.brews>=j.brewCost?(S.send("buyCard",{cardId:I,handSlotIndex:m}),a=!0):console.log("Shop: Drag-to-buy failed (not enough brews or card data missing).")}break}}}a||i.active&&(i.x=i.getData("startX"),i.y=i.getData("startY"))}i.setData("isBeingDragged",!1)})}updateRefreshButtonState(){if(!S||!this.refreshButton||!this.refreshButton.active)return;const e=S.state.players.get(S.sessionId);if(!e)return;this.refreshButton.setText(`Refresh: ${e.shopRefreshCost} `),e.brews>=e.shopRefreshCost&&S.state.currentPhase===Ue.Shop?(this.refreshButton.setColor("#FFFFFF"),this.refreshButton.setBackgroundColor("#4444AA"),this.refreshButton.setInteractive({useHandCursor:!0})):(this.refreshButton.setColor("#AAAAAA"),this.refreshButton.setBackgroundColor("#555555"),this.refreshButton.disableInteractive())}setupColyseusListeners(){if(!S||!S.sessionId)return;const e=Hn.getStateCallbacks(S),i=S.sessionId;this.phaseListenerUnsub=e(S.state).listen("currentPhase",l=>{this.scene.isActive()&&(l===Ue.Preparation?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Preparation")):l!==Ue.Shop&&this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby")),this.updateWaitingStatus())}),S.state.players.forEach((l,u)=>{const d=e(l).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(u,d)}),this.listeners.push(e(S.state.players).onAdd((l,u)=>{var m;this.playerStateListenersUnsub.has(u)&&((m=this.playerStateListenersUnsub.get(u))==null||m());const d=e(l).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(u,d),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(e(S.state.players).onRemove((l,u)=>{var d;(d=this.playerStateListenersUnsub.get(u))==null||d(),this.playerStateListenersUnsub.delete(u),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(S.onMessage("cardsByIds",l=>{if(this.scene.isActive()){Object.entries(l).forEach(([g,y])=>{ws.set(g,y)});const u=this.cameras.main.centerX,d=this.cameras.main.centerY,m=this.cameras.main.width;this.createShopCardsDisplay(u,d,m)}}));const a=S.state.players.get(i);if(a){const l=()=>{if(!this.scene.isActive())return;this.requestMissingCardData();const u=this.cameras.main.centerX,d=this.cameras.main.centerY,m=this.cameras.main.width;this.createShopCardsDisplay(u,d,m)};this.shopOfferListenersUnsub.push(e(a.shopOfferIds).onAdd(l)),this.shopOfferListenersUnsub.push(e(a.shopOfferIds).onRemove(l)),l(),this.listeners.push(e(a).listen("brews",()=>{this.scene.isActive()&&this.updateRefreshButtonState()})),this.listeners.push(e(a).listen("shopRefreshCost",()=>{this.scene.isActive()&&this.updateRefreshButtonState()}))}}cleanupListeners(){var e,i,a,l;console.log("Shop Scene: Cleaning up listeners."),(e=this.phaseListenerUnsub)==null||e.call(this),this.phaseListenerUnsub=null,this.playerStateListenersUnsub.forEach(u=>u()),this.playerStateListenersUnsub.clear(),this.shopOfferListenersUnsub.forEach(u=>u()),this.shopOfferListenersUnsub=[],this.listeners.forEach(u=>u()),this.listeners=[],this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(i=this.continueButton)==null||i.off("pointerdown"),(a=this.continueButton)==null||a.off("pointerover"),(l=this.continueButton)==null||l.off("pointerout")}updateWaitingStatus(){if(!S||!S.sessionId||!this.continueButton||!this.waitingText||!this.scene.isActive())return;const e=S.state.players.get(S.sessionId);if(!e)return;let i=!0;S.state.players.forEach(d=>{d.isReady||(i=!1)});const a=e.isReady,l=S.state.currentPhase===Ue.Shop,u=!a&&l;this.continueButton.setInteractive(u),this.continueButton.setColor(u?"#00ff00":"#888888"),a&&!i&&l?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.continueButton.setText("Waiting...")):l?(this.waitingText.setVisible(!1),this.continueButton.setText("Continue")):(this.waitingText.setText(`Waiting for ${S.state.currentPhase} phase...`).setVisible(!0),this.continueButton.setText("Continue")),this.shopCardObjects.forEach(d=>{d.input&&(d.input.enabled=u)})}shutdown(){var e,i,a,l,u,d,m,g;console.log("Shop scene shutting down."),this.cleanupListeners(),this.shopCardObjects.forEach(y=>y.destroy()),this.shopCardObjects=[],(e=this.continueButton)==null||e.destroy(),(i=this.waitingText)==null||i.destroy(),(a=this.refreshButton)==null||a.off("pointerdown"),(l=this.refreshButton)==null||l.off("pointerover"),(u=this.refreshButton)==null||u.off("pointerout"),(d=this.refreshButton)==null||d.destroy(),(m=this.toggleShopButton)==null||m.destroy(),(g=this.shopOffersContainer)==null||g.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class Lp extends fs.Scene{constructor(){super("Preparation");ce(this,"startBattleButton");ce(this,"waitingText");ce(this,"playerStateListener",null);ce(this,"handListener",null);ce(this,"battlefieldListener",null);ce(this,"phaseListener",null);ce(this,"playerStateListenerUnsub",null);ce(this,"handAddUnsub",null);ce(this,"handRemoveUnsub",null);ce(this,"handChangeUnsub",null);ce(this,"battlefieldAddUnsub",null);ce(this,"battlefieldRemoveUnsub",null);ce(this,"battlefieldChangeUnsub",null);ce(this,"phaseListenerUnsub",null);ce(this,"otherPlayerChangeListeners",new Map);ce(this,"otherPlayerAddUnsub",null);ce(this,"otherPlayerRemoveUnsub",null);ce(this,"clientSideCardLayout",new Map)}create(){var l;if(this.scene.launch("background"),(l=this.scene.get("BoardView"))!=null&&l.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!S||!S.state||!S.sessionId){console.error("Preparation Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>this.scene.start("MainMenu"));return}const e=this.cameras.main.centerX;this.cameras.main.centerY;const i=this.cameras.main.height;this.cameras.main.width;const a=S.state.players.get(S.sessionId);a?console.log("Preparation Create: Initial myPlayerState.hand contents:",JSON.stringify(Object.fromEntries(a.hand.entries()))):console.log("Preparation Create: myPlayerState not found initially."),this.add.text(e,80,"Preparation Phase",{fontFamily:"Arial Black",fontSize:48,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.startBattleButton=this.add.text(e,i-50,"Start Battle",{fontFamily:"Arial Black",fontSize:40,color:"#888888",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.startBattleButton.setColor("#888888").disableInteractive(),this.waitingText=this.add.text(e,i-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(100,this.updateStartButtonState,[],this),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!S||!S.sessionId)return;const e=S.sessionId,i=Hn.getStateCallbacks(S),a=S.state.players.get(e);a?(this.playerStateListenerUnsub=i(a).onChange(()=>{this.scene.isActive()&&this.updateWaitingStatus()}),this.handAddUnsub=i(a.hand).onAdd((l,u)=>{console.log(`Preparation Scene: player.hand.onAdd triggered for key: ${u}, card: ${l==null?void 0:l.name}. Scene active: ${this.scene.isActive()}`),this.scene.isActive()&&this.updateStartButtonState()}),this.handRemoveUnsub=i(a.hand).onRemove((l,u)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldAddUnsub=i(a.battlefield).onAdd((l,u)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldRemoveUnsub=i(a.battlefield).onRemove((l,u)=>{this.scene.isActive()&&this.updateStartButtonState()})):console.error("Preparation Scene: My player state not found on init."),this.phaseListenerUnsub=i(S.state).listen("currentPhase",l=>{this.scene.isActive()&&(console.log(`Preparation Scene: Phase changed to ${l}`),l===Ue.Battle?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Battle")):l!==Ue.Preparation&&(console.warn(`Preparation Scene: Unexpected phase change to ${l}. Returning to Lobby.`),this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby"))),this.updateWaitingStatus())}),this.otherPlayerAddUnsub=i(S.state.players).onAdd((l,u)=>{if(this.scene.isActive()){if(u!==e){const d=i(l).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(u,d)}this.updateWaitingStatus()}}),this.otherPlayerRemoveUnsub=i(S.state.players).onRemove((l,u)=>{if(this.scene.isActive()){const d=this.otherPlayerChangeListeners.get(u);d==null||d(),this.otherPlayerChangeListeners.delete(u),this.updateWaitingStatus()}}),S.state.players.forEach((l,u)=>{if(u!==e){const d=i(l).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(u,d)}})}cleanupListeners(){var e,i,a,l,u,d,m,g,y,h,I,j,J;console.log("Preparation Scene: Cleaning up listeners."),(e=this.playerStateListenerUnsub)==null||e.call(this),(i=this.handAddUnsub)==null||i.call(this),(a=this.handRemoveUnsub)==null||a.call(this),(l=this.handChangeUnsub)==null||l.call(this),(u=this.battlefieldAddUnsub)==null||u.call(this),(d=this.battlefieldRemoveUnsub)==null||d.call(this),(m=this.battlefieldChangeUnsub)==null||m.call(this),(g=this.phaseListenerUnsub)==null||g.call(this),(y=this.otherPlayerAddUnsub)==null||y.call(this),(h=this.otherPlayerRemoveUnsub)==null||h.call(this),this.otherPlayerChangeListeners.forEach(H=>H()),this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.otherPlayerChangeListeners.clear(),this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(I=this.startBattleButton)==null||I.off("pointerdown"),(j=this.startBattleButton)==null||j.off("pointerover"),(J=this.startBattleButton)==null||J.off("pointerout")}makeLocalPlayerCardsDraggable(){if(!S||!S.sessionId||!this.scene.isActive()){console.warn("Preparation: Cannot make cards draggable, room/session/scene inactive.");return}const e=S.sessionId,i=S.state.players.get(e),a=this.scene.get("BoardView");if(!i||!a){console.warn("Preparation: Player state or BoardView not found for making cards draggable.");return}this.clientSideCardLayout.forEach(u=>{u.gameObject&&u.gameObject.input&&this.input.disable(u.gameObject)}),this.clientSideCardLayout.clear();const l=(u,d)=>{u.forEach((m,g)=>{const y=a.getCardGameObjectByInstanceId(m.instanceId);y?(y.setInteractive({useHandCursor:!0}),this.input.setDraggable(y),this.clientSideCardLayout.set(m.instanceId,{area:d,slotKey:g,gameObject:y})):console.warn(`Preparation: Could not find GameObject in BoardView for card instance ${m.instanceId}`)})};l(i.hand,"hand"),l(i.battlefield,"battlefield"),console.log("Preparation: Made local player cards draggable and initialized clientSideCardLayout.",this.clientSideCardLayout),this.updateStartButtonState()}updateWaitingStatus(){if(!S||!S.sessionId||!this.startBattleButton||!this.waitingText)return;const e=S.state.players.get(S.sessionId);if(!e)return;let i=!0;S.state.players.forEach(l=>{l.isReady||(i=!1)});const a=e.isReady;!a&&(S.state.currentPhase,Ue.Preparation),this.updateStartButtonState(),a&&!i?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.startBattleButton.setText("Waiting..."),this.startBattleButton.disableInteractive().setColor("#888888")):(this.waitingText.setVisible(!1),this.startBattleButton.setText("Start Battle"),this.updateStartButtonState())}updateStartButtonState(){if(!this.startBattleButton||!this.startBattleButton.active){console.warn("updateStartButtonState called but button is null or inactive.");return}let e=0;const i=this.scene.get("BoardView");i&&i.scene.isActive()&&i.getLocalPlayerLayoutData().forEach(y=>{y.area==="battlefield"&&e++});const a=e>0,l=S==null?void 0:S.state.players.get(S==null?void 0:S.sessionId),u=(l==null?void 0:l.isReady)??!1,d=(S==null?void 0:S.state.currentPhase)===Ue.Preparation;a&&!u&&d?(this.startBattleButton.setColor("#00ff00"),this.startBattleButton.setInteractive({useHandCursor:!0}),this.startBattleButton.off("pointerdown"),this.startBattleButton.once("pointerdown",this.confirmPreparation,this),this.startBattleButton.on("pointerover",()=>this.startBattleButton.setColor("#55ff55")),this.startBattleButton.on("pointerout",()=>this.startBattleButton.setColor("#00ff00"))):(this.waitingText&&!this.waitingText.visible&&this.startBattleButton.setColor("#888888"),this.startBattleButton.disableInteractive(),this.startBattleButton.off("pointerdown"),this.startBattleButton.off("pointerover"),this.startBattleButton.off("pointerout"))}confirmPreparation(){if(!S)return;console.log("Confirming preparation layout...");const e=this.scene.get("BoardView");if(!e||!e.scene.isActive()){console.error("Preparation: BoardView not available to get layout data.");return}const{handLayout:i,battlefieldLayout:a}=e.getCardLayouts();console.log("Sending preparation layout to server:",{handLayout:i,battlefieldLayout:a}),S.send("setPreparation",{handLayout:i,battlefieldLayout:a}),this.updateWaitingStatus()}shutdown(){var e,i;console.log("Preparation scene shutting down explicitly."),this.cleanupListeners(),(e=this.startBattleButton)==null||e.destroy(),(i=this.waitingText)==null||i.destroy(),this.clientSideCardLayout.clear(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class kp extends fs.Scene{constructor(){super("Battle");ce(this,"handCardDisplayObjects",new Map);ce(this,"battleOver",!1);ce(this,"resultText");ce(this,"statusText");ce(this,"phaseListenerUnsubscribe",null)}create(){if(this.scene.launch("background"),this.battleOver=!1,!S||!S.state||!S.sessionId){console.error("Battle Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{S==null||S.leave()}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,i=this.cameras.main.centerY,a=this.cameras.main.height;this.cameras.main.width,this.resultText=this.add.text(e,i,"",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setAlpha(0),this.statusText=this.add.text(e,a-50,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5).setAlpha(0),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!S||!S.state)return;const e=Hn.getStateCallbacks(S);this.phaseListenerUnsubscribe=e(S.state).listen("currentPhase",i=>{if(this.scene.isActive()){if(console.log(`Battle Scene: Phase changed to ${i}`),i===Ue.BattleEnd)this.handleBattleEnd();else if(i===Ue.Shop)this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"));else if(i===Ue.GameOver)this.handleGameOver();else if(i!==Ue.Battle&&(console.warn(`Battle Scene: Unexpected phase change to ${i}. Returning to Lobby.`),this.scene.isActive())){try{S==null||S.leave()}catch{}this.scene.stop(),this.scene.start("Lobby")}}})}cleanupListeners(){var e;console.log("Battle Scene: Cleaning up listeners."),(e=this.phaseListenerUnsubscribe)==null||e.call(this),this.phaseListenerUnsubscribe=null}handleBattleEnd(){var u,d;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Battle ended (server signal received). Displaying results.");const e=S==null?void 0:S.state.players.get(S.sessionId);let i;S==null||S.state.players.forEach((m,g)=>{g!==(S==null?void 0:S.sessionId)&&(i=m)});let a="Battle Ended",l="#ffffff";e&&i?e.health>i.health?(a="Victory!",l="#88ff88"):i.health>e.health?(a="Defeat!",l="#ff8888"):(a="Draw!",l="#ffff88"):(a="Battle Ended (Opponent Left?)",l="#ffffff"),(u=this.resultText)!=null&&u.active&&this.resultText.setText(a).setColor(l).setAlpha(1),(d=this.statusText)!=null&&d.active&&this.statusText.setText("Waiting for next round...").setAlpha(1)}handleGameOver(){var u,d;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Game Over signal received.");const e=S==null?void 0:S.state.players.get(S.sessionId);let i;S==null||S.state.players.forEach((m,g)=>{g!==(S==null?void 0:S.sessionId)&&(i=m)});let a="Game Over!",l="#ffffff";e&&i?e.health>i.health?(a="You Win!",l="#00ff00"):i.health>e.health?(a="You Lose!",l="#ff0000"):(a="Draw!",l="#ffff00"):e?(a="You Win! (Opponent Left)",l="#00ff00"):(a="Game Over (Error?)",l="#ff0000"),(u=this.resultText)!=null&&u.active&&this.resultText.setText(a).setColor(l).setAlpha(1),(d=this.statusText)!=null&&d.active&&this.statusText.setText("Click to return to Main Menu").setAlpha(1),this.input.once("pointerdown",()=>{try{S==null||S.leave()}catch{}this.scene.stop("Background"),this.scene.start("MainMenu")})}shutdown(){var e,i;console.log("Battle scene shutting down explicitly."),this.cleanupListeners(),this.handCardDisplayObjects.forEach(a=>{a==null||a.forEach(l=>l==null?void 0:l.destroy())}),this.handCardDisplayObjects.clear(),(e=this.resultText)==null||e.destroy(),(i=this.statusText)==null||i.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const Ds=100,da=140,Un=120,Fn=168,zo=15,ha=580,pa=420,ga=100,ma=260;class Bp extends fs.Scene{constructor(){super("BoardView");ce(this,"playerVisuals",new Map);ce(this,"currentPhase",Ue.Lobby);ce(this,"sellZone");ce(this,"sellZoneRect");ce(this,"sellZoneText");ce(this,"brewGainText");ce(this,"playerHealthText");ce(this,"opponentHealthText");ce(this,"playerBrewsText");ce(this,"dayPhaseText");ce(this,"opponentUsernameText");ce(this,"listeners",[]);ce(this,"cardSchemaListeners",new Map)}updateCardHpVisuals(e,i,a){if(!e||!e.active)return;const l=e.getData("hpTextObject"),u=e.getData("mainCardImage");if(l&&l.active){l.setText(`${i}/${a}`);const m=a>0?i/a:0;i<=0?l.setColor("#ff0000"):m<.3?l.setColor("#ff8888"):m<.6?l.setColor("#ffff88"):l.setColor("#88ff88")}const d=e.alpha<1;i<=0?d||(e.setAlpha(.6),u&&u.active&&typeof u.setTint=="function"&&u.setTint(7829367)):d&&(e.setAlpha(1),u&&u.active&&typeof u.clearTint=="function"?u.clearTint():u&&u.active&&console.warn("BoardView: updateCardHpVisuals - clearTint method not found on mainCardImage for card.",e.getData("instanceId"),u))}preload(){if(!this.textures.exists("cardBack")){const e=this.make.graphics({x:0,y:0});e.fillStyle(5253758),e.fillRect(0,0,Un,Fn),e.lineStyle(2,12428501),e.strokeRect(0,0,Un,Fn),e.generateTexture("cardBack",Un,Fn),e.destroy()}}create(){console.log("BoardView creating..."),this.createNavbar(),this.createSellZone(),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createNavbar(){const e=this.cameras.main.centerX,i=this.cameras.main.width,a=30;this.add.rectangle(e,a,i,50,0,.7).setDepth(1e3);const u={fontFamily:"Arial",fontSize:16,color:"#ffffff",align:"left"};this.playerHealthText=this.add.text(i*.05,a,"You: -- HP",{...u,color:"#00ff00"}).setOrigin(0,.5).setDepth(1001),this.playerBrewsText=this.add.text(i*.95,a,"Brews: --",{...u,color:"#ffff00",align:"right"}).setOrigin(1,.5).setDepth(1001),this.opponentUsernameText=this.add.text(i*.25,a-10,"Opponent: --",{...u,fontSize:14}).setOrigin(0,.5).setDepth(1001),this.opponentHealthText=this.add.text(i*.25,a+10,"-- HP",{...u,color:"#ff0000"}).setOrigin(0,.5).setDepth(1001),this.dayPhaseText=this.add.text(e,a,"Day -- - Phase --",{...u,fontSize:20,align:"center"}).setOrigin(.5).setDepth(1001)}showAttackAnimation(e){const i=this.getCardGameObjectByInstanceId(e);if(i&&i.active){const a=i.scaleX,l=i.scaleY;this.tweens.add({targets:i,scaleX:a*1.15,scaleY:l*1.15,duration:100,yoyo:!0,ease:"Sine.easeInOut"})}}showDamageNumber(e,i){const a=this.getCardGameObjectByInstanceId(e);if(a&&a.active&&i>0){const l=this.add.text(a.x+Phaser.Math.Between(-10,10),a.y-Fn/2-10,`-${i}`,{fontFamily:"Arial Black",fontSize:24,color:"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(a.depth+1);this.tweens.add({targets:l,y:l.y-50,alpha:0,duration:1e3,ease:"Power1",onComplete:()=>{l.destroy()}})}}drawAttackLine(e,i){const a=this.getCardGameObjectByInstanceId(e),l=this.getCardGameObjectByInstanceId(i);if(a&&a.active&&l&&l.active){const u=this.add.line(0,0,a.x,a.y,l.x,l.y,16724787,.7).setOrigin(0,0).setLineWidth(2).setDepth(a.depth);this.time.delayedCall(250,()=>{u.destroy()})}}setupColyseusListeners(){if(!S||!S.state){console.error("BoardView: Colyseus room or state not available!"),this.time.delayedCall(100,this.setupColyseusListeners,[],this);return}const e=Hn.getStateCallbacks(S);this.listeners.push(e(S.state).listen("currentDay",()=>this.updateNavbarText())),this.listeners.push(e(S.state).listen("currentPhase",(i,a)=>{this.currentPhase=i,this.updateNavbarText(),i===Ue.Shop||i===Ue.Preparation?this.sellZone.setVisible(!0):this.sellZone.setVisible(!1);const l=(u,d,m,g)=>{if(!u.active)return;const y=u.getData("cooldownBarBg"),h=u.getData("cooldownBarFill");if(i===Ue.Battle){if(u.getData("area")==="battlefield")if(d)if(y&&h){y.setVisible(!0),h.setVisible(!0);const j=u.getData("cooldownBarBaseWidth"),J=typeof j=="number"?j:Ds-10;h.setSize(J,6);const H=(d.speed>0?d.speed:1.5)*1e3;u.setData("maxAttackCooldown",H),u.setData("attackCooldownTimer",H)}else console.warn(`BoardView: Battle Phase - Card ${d.instanceId} (Owner: ${m}, Slot: ${g}) missing cooldown bar elements in data. Bg: ${!!y}, Fill: ${!!h}`);else console.warn(`BoardView: Battle Phase - Battlefield card container (Owner: ${m}, Slot: ${g}) has no cardSchema. No cooldown bar shown.`)}else y&&y.setVisible(!1),h&&h.setVisible(!1);if((a===Ue.Battle||a===Ue.BattleEnd)&&i!==Ue.Battle&&i!==Ue.BattleEnd&&d&&d.currentHp>0){u.setAlpha(1);const I=u.getData("mainCardImage");I&&I.active&&typeof I.clearTint=="function"&&I.clearTint()}};this.playerVisuals.forEach((u,d)=>{u.battlefield.forEach((m,g)=>{var h;const y=(h=S==null?void 0:S.state.players.get(d))==null?void 0:h.battlefield.get(g);l(m,y,d,g)}),u.hand.forEach((m,g)=>{var h;const y=(h=S==null?void 0:S.state.players.get(d))==null?void 0:h.hand.get(g);if((a===Ue.Battle||a===Ue.BattleEnd)&&i!==Ue.Battle&&i!==Ue.BattleEnd&&y&&y.currentHp>0){m.setAlpha(1);const I=m.getData("mainCardImage");I&&I.active&&typeof I.clearTint=="function"&&I.clearTint()}})})})),this.listeners.push(e(S.state.players).onAdd((i,a)=>{console.log(`BoardView: Player added ${a}`),this.addPlayerVisuals(a),this.addPlayerListeners(i,a),this.updatePlayerSlots(i,a),this.updateNavbarText()})),this.listeners.push(e(S.state.players).onRemove((i,a)=>{console.log(`BoardView: Player removed ${a}`),this.removePlayerVisuals(a),this.updateNavbarText()})),this.listeners.push(S.onMessage("battleAttackEvent",i=>{if(this.currentPhase!==Ue.Battle||!this.scene.isActive())return;console.log("BoardView: Received battleAttackEvent",i);const a=this.getCardGameObjectByInstanceId(i.attackerInstanceId),l=this.getCardGameObjectByInstanceId(i.targetInstanceId);if(a&&a.active&&l&&l.active){this.drawAttackLine(i.attackerInstanceId,i.targetInstanceId),this.showAttackAnimation(i.attackerInstanceId),this.showDamageNumber(i.targetInstanceId,i.damageDealt);const u=a.getData("maxAttackCooldown");if(u>0){a.setData("attackCooldownTimer",u);const y=a.getData("cooldownBarFill"),h=a.getData("cooldownBarBaseWidth")||Ds-10;y&&y.setSize(h,6)}const d=l.getData("ownerSessionId"),m=l.getData("slotKey"),g=l.getData("area");if(d===i.targetPlayerId&&g==="battlefield"&&m){const y=S.state.players.get(i.targetPlayerId),h=y==null?void 0:y.battlefield.get(m);if(h&&h.instanceId===i.targetInstanceId){const I=Math.max(0,h.currentHp-i.damageDealt);this.updateCardHpVisuals(l,I,h.health)}else console.warn(`BoardView: battleAttackEvent - Target card schema not found or instanceId mismatch for player ${i.targetPlayerId}, slot ${m}, instance ${i.targetInstanceId}.`)}else console.warn(`BoardView: battleAttackEvent - Target card container data inconsistent or not on battlefield. Owner: ${d}, Area: ${g}, Slot: ${m}`)}else console.warn("BoardView: Attacker or target not found/active for battleAttackEvent",i)})),S.state.players.forEach((i,a)=>{this.addPlayerVisuals(a),this.addPlayerListeners(i,a),this.updatePlayerSlots(i,a)}),this.updateNavbarText()}update(e,i){!this.scene.isActive()||this.currentPhase!==Ue.Battle||!S||!S.state||this.playerVisuals.forEach(a=>{a.battlefield.forEach(l=>{if(!l.active)return;const u=l.getData("maxAttackCooldown");let d=l.getData("attackCooldownTimer");const m=l.getData("cooldownBarBaseWidth")||Ds-10;if(u>0){d-=i,d<0&&(d=0),l.setData("attackCooldownTimer",d);const g=l.getData("cooldownBarFill");if(g&&g.visible){const y=d/u;g.setSize(m*Math.max(0,y),6)}}})})}addPlayerListeners(e,i){const a=Hn.getStateCallbacks(S),l=[];l.push(a(e).listen("health",()=>this.updateNavbarText())),l.push(a(e).listen("brews",()=>this.updateNavbarText())),l.push(a(e).listen("username",()=>this.updateNavbarText())),l.push(a(e.hand).onAdd((u,d)=>{this.updateCardVisual(i,"hand",d,u),this.addCardSchemaListeners(u)})),l.push(a(e.hand).onRemove((u,d)=>{this.removeCardVisual(i,"hand",d)})),e.hand.forEach((u,d)=>{this.addCardSchemaListeners(u)}),l.push(a(e.battlefield).onAdd((u,d)=>{this.updateCardVisual(i,"battlefield",d,u),this.addCardSchemaListeners(u)})),l.push(a(e.battlefield).onRemove((u,d)=>{this.removeCardVisual(i,"battlefield",d)})),e.battlefield.forEach((u,d)=>{this.addCardSchemaListeners(u)}),this.listeners.push(...l)}addCardSchemaListeners(e){if(!e||!e.instanceId)return;const i=Hn.getStateCallbacks(S),a=this.cardSchemaListeners.get(e.instanceId);a&&(a.forEach(d=>d()),this.cardSchemaListeners.delete(e.instanceId));const l=[],u=i(e).listen("currentHp",(d,m)=>{const g=this.getCardGameObjectByInstanceId(e.instanceId);g&&this.updateCardHpVisuals(g,d,e.health)});l.push(u),l.length>0&&this.cardSchemaListeners.set(e.instanceId,l)}updatePlayerSlots(e,i){e.hand.forEach((a,l)=>this.updateCardVisual(i,"hand",l,a)),e.battlefield.forEach((a,l)=>this.updateCardVisual(i,"battlefield",l,a))}addPlayerVisuals(e){if(!this.playerVisuals.has(e)){const i=[],a=[],l=e===(S==null?void 0:S.sessionId);for(let u=0;u<5;u++){const d=this.calculateSlotX(u,"hand"),m=l?ha:ga,g=this.add.rectangle(d,m,Un,Fn).setStrokeStyle(2,l?11184810:7829367,.8).setDepth(0);i.push(g);const y=this.calculateSlotX(u,"battlefield"),h=l?pa:ma,I=this.add.rectangle(y,h,Ds,da).setStrokeStyle(2,l?16777215:11184810,1).setDepth(0);a.push(I)}this.playerVisuals.set(e,{hand:new Map,battlefield:new Map,handSlotOutlines:i,battlefieldSlotOutlines:a})}}removePlayerVisuals(e){const i=this.playerVisuals.get(e);i&&(i.hand.forEach(a=>a.destroy()),i.battlefield.forEach(a=>a.destroy()),i.handSlotOutlines.forEach(a=>a.destroy()),i.battlefieldSlotOutlines.forEach(a=>a.destroy())),this.playerVisuals.delete(e)}updateCardVisual(e,i,a,l){if(!this.scene.isActive()||!S||!S.state)return;this.removeCardVisual(e,i,a);const u=this.playerVisuals.get(e);if(!u)return;const d=e===(S==null?void 0:S.sessionId),m=this.calculateSlotX(parseInt(a,10),i);let g,y=!1;i==="hand"?(g=d?ha:ga,d||(y=!0)):g=d?pa:ma;const h=this.createCardGameObject(l,m,g,y,d,i);if(h.setData("instanceId",l.instanceId),h.setData("slotKey",a),h.setData("area",i),h.setData("ownerSessionId",e),h.setDepth(1),l.currentHp<=0){h.setAlpha(.6);const I=h.getData("mainCardImage");I&&I.active&&typeof I.setTint=="function"&&I.setTint(7829367);const j=h.getData("hpTextObject");j&&j.active&&j.setColor("#ff0000")}i==="hand"?u.hand.set(a,h):u.battlefield.set(a,h),this.addCardSchemaListeners(l),d&&this.makeCardInteractive(h)}removeCardVisual(e,i,a){const l=this.playerVisuals.get(e);if(l){const u=i==="hand"?l.hand:l.battlefield,d=u.get(a);if(d){const m=d.getData("instanceId");if(m){const g=this.cardSchemaListeners.get(m);g&&(console.log(`BoardView: Cleaning up ${g.length} listeners for card instance ${m} during removeCardVisual.`),g.forEach(y=>{if(typeof y=="function")try{y()}catch(h){console.warn(`BoardView: Error unsubscribing card listener for ${m}`,h)}}),this.cardSchemaListeners.delete(m))}d.input&&d.input.enabled&&this.input.disable(d),this.time.delayedCall(1,()=>{d.active&&d.destroy()}),u.delete(a)}}}calculateSlotX(e,i){const a=i==="hand"?Un:Ds,l=5*a+4*zo;return(this.cameras.main.width-l)/2+a/2+e*(a+zo)}createCardGameObject(e,i,a,l,u,d){const m=this.add.container(i,a),g=d==="hand"?Un:Ds,y=d==="hand"?Fn:da;if(m.setData("displayCardWidth",g),m.setData("displayCardHeight",y),l){const j=this.add.image(0,0,"cardBack").setOrigin(.5).setDisplaySize(Un,Fn);return m.add(j),m}const h=d==="hand"?"cardFullTier1":"cardMinionTier1",I=this.add.image(0,0,h).setOrigin(.5);if(I.setDisplaySize(g,y),m.add(I),m.setData("mainCardImage",I),d==="hand"){const j=this.add.text(0,-20,e.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:g-20}}).setOrigin(.5,.5);m.add(j);const J=this.add.text(-Ds/2+32,da*.03,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);m.add(J);const H=this.add.text(Ds/2-18,6,`${e.currentHp}  ${e.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(1,.5);m.add(H),m.setData("hpTextObject",H);const z=this.add.text(0,y/2-50,`${e.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);m.add(z)}else{const j=this.add.text(0,-y/2+5,e.name,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:g}}).setOrigin(.5,0);m.add(j);const J=this.add.text(-g/2+32,32,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);m.add(J);const H=this.add.text(0,43,`${e.speed}`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(1,0);m.add(H);const z=this.add.text(g/2-10,y/2-30,`${e.currentHp}/${e.health}`,{fontFamily:"Arial",fontSize:14,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,1);m.add(z),m.setData("hpTextObject",z);const ue=y/2-15,de=g-10,re=this.add.rectangle(0,ue,de,6,0,.5).setVisible(!1),Te=this.add.rectangle(-de/2,ue,de,6,4521796).setOrigin(0,.5).setVisible(!1);m.add(re),m.add(Te),m.setData("cooldownBarBg",re),m.setData("cooldownBarFill",Te),m.setData("attackCooldownTimer",0),m.setData("maxAttackCooldown",0),m.setData("cooldownBarBaseWidth",de)}return m}getCardGameObjectByInstanceId(e){for(const[i,a]of this.playerVisuals){for(const[l,u]of a.hand)if(u.getData("instanceId")===e)return u;for(const[l,u]of a.battlefield)if(u.getData("instanceId")===e)return u}}getSlotPixelPosition(e,i,a){if(a<0||a>4)return;const l=this.calculateSlotX(a,i);let u;return i==="hand"?u=e?ha:ga:u=e?pa:ma,{x:l,y:u}}makeCardInteractive(e){const i=e.getData("displayCardWidth"),a=e.getData("displayCardHeight");if(!i||!a){console.warn("BoardView: makeCardInteractive - displayCardWidth/Height not found on container.",e.getData("instanceId"));return}const l=new Phaser.Geom.Rectangle(-i/2,-a/2,i,a);e.setInteractive({hitArea:l,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}),this.input.setDraggable(e),e.input&&(e.input.enabled=!0),e.on("dragstart",u=>{this.currentPhase!==Ue.Shop&&this.currentPhase!==Ue.Preparation||!e.input||!e.input.enabled||(this.children.bringToTop(e),e.setAlpha(.7),e.setData("isDragging",!0),e.setData("originalX",e.x),e.setData("originalY",e.y),e.setData("originalAreaOnDragStart",e.getData("area")),e.setData("originalSlotKeyOnDragStart",e.getData("slotKey")))}),e.on("drag",(u,d,m)=>{if(e.getData("isDragging"))if(e.x=d,e.y=m,(this.currentPhase===Ue.Shop||this.currentPhase===Ue.Preparation)&&this.sellZone.visible)if(this.isDroppedOnSellZone(e)){const g=e.getData("instanceId"),y=e.getData("originalAreaOnDragStart"),h=e.getData("originalSlotKeyOnDragStart"),I=e.getData("ownerSessionId"),j=S==null?void 0:S.state.players.get(I);let J;if(j&&(y==="hand"?J=j.hand.get(h):J=j.battlefield.get(h)),J&&J.instanceId===g){const H=Math.max(1,Math.floor(J.brewCost/2));this.brewGainText.setText(`Sell: +${H} `),this.brewGainText.setAlpha(1)}else this.brewGainText.setAlpha(0)}else this.brewGainText.setAlpha(0);else this.brewGainText.setAlpha(0)}),e.on("dragend",u=>{if(!e.getData("isDragging"))return;e.setAlpha(1),e.setData("isDragging",!1),this.brewGainText.setAlpha(0);const d=e.getData("instanceId"),m=e.getData("originalAreaOnDragStart"),g=e.getData("originalSlotKeyOnDragStart"),y=e.getData("ownerSessionId");if((this.currentPhase===Ue.Shop||this.currentPhase===Ue.Preparation)&&this.sellZone.visible&&this.isDroppedOnSellZone(e)){const J=S==null?void 0:S.state.players.get(S==null?void 0:S.sessionId);let H;if(m==="hand"&&(J!=null&&J.hand.has(g))?H=J.hand.get(g):m==="battlefield"&&(J!=null&&J.battlefield.has(g))&&(H=J.battlefield.get(g)),H&&H.instanceId===d){const z=Math.max(1,Math.floor(H.brewCost/2));S==null||S.send("sellCard",{instanceId:d,area:m,slotKey:g}),this.showBrewGain(z);return}}let h=!1,I,j;for(let J=0;J<5;J++){const H=String(J),z=this.getSlotPixelPosition(!0,"hand",J);if(z){const ue=new Phaser.Geom.Rectangle(z.x-Un/2,z.y-Fn/2,Un,Fn);if(Phaser.Geom.Rectangle.Contains(ue,e.x,e.y)){if(this.isSlotEmpty(y,"hand",H,d)){let de=!1;if(this.currentPhase===Ue.Shop?m==="hand"&&(de=!0):this.currentPhase===Ue.Preparation&&m==="hand"&&(de=!0),de){e.x=z.x,e.y=z.y;const re=m!=="hand";if(e.setData("area","hand"),e.setData("slotKey",H),this.updateVisualMaps(y,m,g,"hand",H,e),re){const Te=S==null?void 0:S.state.players.get(y);let $e;Te&&($e=Te.hand.get(H),$e||(m==="battlefield"?$e=Te.battlefield.get(g):$e=Te.hand.get(g))),$e&&$e.instanceId===d&&this.updateCardVisual(y,"hand",H,$e)}h=!0,I="hand",j=H,this.currentPhase===Ue.Shop&&(m!=="hand"||g!==H)&&(S==null||S.send("moveCardInHand",{instanceId:d,fromSlotKey:g,toSlotKey:H}))}}if(h)break}}}if(!h&&this.currentPhase===Ue.Preparation)for(let J=0;J<5;J++){const H=String(J),z=this.getSlotPixelPosition(!0,"battlefield",J);if(z){const ue=new Phaser.Geom.Rectangle(z.x-Un/2,z.y-Fn/2,Un,Fn);if(Phaser.Geom.Rectangle.Contains(ue,e.x,e.y)){if(this.isSlotEmpty(y,"battlefield",H,d)){e.x=z.x,e.y=z.y;const de=m!=="battlefield";if(e.setData("area","battlefield"),e.setData("slotKey",H),this.updateVisualMaps(y,m,g,"battlefield",H,e),de){const re=S==null?void 0:S.state.players.get(y),Te=(re==null?void 0:re.battlefield.get(H))||(re==null?void 0:re.hand.get(g));Te&&Te.instanceId===d&&this.updateCardVisual(y,"battlefield",H,Te)}h=!0,I="battlefield",j=H}break}}}if(h?this.currentPhase===Ue.Preparation&&I&&j&&(m!==I||g!==j)&&(S==null||S.send("updatePrepLayout",{instanceId:d,newArea:I,newSlotKey:j})):(e.x=e.getData("originalX"),e.y=e.getData("originalY"),e.setData("area",m),e.setData("slotKey",g)),this.currentPhase===Ue.Preparation){const J=this.scene.get("Preparation");J&&J.scene.isActive()&&J.updateStartButtonState&&J.updateStartButtonState()}})}getCardLayouts(){const e={},i={};if(!S||!S.sessionId){for(let u=0;u<5;u++)e[String(u)]=null,i[String(u)]=null;return{handLayout:e,battlefieldLayout:i}}const a=S.sessionId,l=this.playerVisuals.get(a);for(let u=0;u<5;u++){const d=String(u);if(l&&l.hand.has(d)){const m=l.hand.get(d);e[d]=(m==null?void 0:m.getData("instanceId"))||null}else e[d]=null;if(l&&l.battlefield.has(d)){const m=l.battlefield.get(d);i[d]=(m==null?void 0:m.getData("instanceId"))||null}else i[d]=null}return{handLayout:e,battlefieldLayout:i}}isSlotEmpty(e,i,a,l){const u=this.playerVisuals.get(e);if(!u)return!1;const m=(i==="hand"?u.hand:u.battlefield).get(a);return m?m.getData("instanceId")===l:!0}isDroppedOnSellZone(e){return this.sellZone.visible?new Phaser.Geom.Rectangle(this.sellZone.x-this.sellZoneRect.width/2-20,this.sellZone.y-this.sellZoneRect.height/2-20,this.sellZoneRect.width+40,this.sellZoneRect.height+40).contains(e.x,e.y):!1}showBrewGain(e){this.brewGainText.setText(`+${e} `),this.brewGainText.setAlpha(1),this.brewGainText.y=-50,this.brewGainText.x=0,this.tweens.add({targets:this.brewGainText,scaleX:1.5,scaleY:1.5,duration:100,yoyo:!0,ease:"Cubic.easeOut",onComplete:()=>{this.tweens.add({targets:this.brewGainText,y:this.brewGainText.y-80,alpha:0,duration:1500,ease:"Power2"})}}),this.tweens.add({targets:this.sellZoneRect,fillAlpha:.7,duration:200,yoyo:!0,repeat:1,ease:"Cubic.easeOut"})}updateVisualMaps(e,i,a,l,u,d){const m=this.playerVisuals.get(e);if(!m)return;const g=i==="hand"?m.hand:m.battlefield;g.get(a)===d&&g.delete(a),(l==="hand"?m.hand:m.battlefield).set(u,d)}getPlayerCardGameObjects(e){const i=[],a=this.playerVisuals.get(e);return a&&(a.hand.forEach(l=>i.push(l)),a.battlefield.forEach(l=>i.push(l))),i}getLocalPlayerLayoutData(){const e=[];if(!S||!S.sessionId)return e;const i=S.sessionId,a=this.playerVisuals.get(i);return a&&(a.hand.forEach((l,u)=>{e.push({instanceId:l.getData("instanceId"),area:"hand",slotKey:l.getData("slotKey")})}),a.battlefield.forEach((l,u)=>{e.push({instanceId:l.getData("instanceId"),area:"battlefield",slotKey:l.getData("slotKey")})})),e}createSellZone(){this.sellZone=this.add.container(this.cameras.main.width-80,this.cameras.main.height/2),this.sellZone.setDepth(1e3),this.sellZoneRect=this.add.rectangle(0,0,120,160,16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1),this.sellZone.add(this.sellZoneRect),this.sellZoneText=this.add.text(0,0,"SELL",{fontFamily:"Arial Black",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.sellZone.add(this.sellZoneText),this.brewGainText=this.add.text(0,-50,"",{fontFamily:"Arial Black",fontSize:20,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setAlpha(0),this.sellZone.add(this.brewGainText);const e=this.add.text(0,50,`Drag cards here
to sell`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5);this.sellZone.add(e),this.input.on("dragenter",(i,a,l)=>{a instanceof Phaser.GameObjects.Container&&this.sellZone.visible&&this.isDroppedOnSellZone(a)&&(this.sellZoneRect.setFillStyle(16711680,.5),this.sellZoneRect.setStrokeStyle(3,16733525,1))}),this.input.on("dragleave",(i,a,l)=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.input.on("drop",()=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.sellZone.setVisible(!1)}updateNavbarText(){if(!S||!S.state||!this.playerHealthText||!this.playerHealthText.active)return;const e=S.sessionId,i=S.state.players.get(e);let a,l="Opponent: --";S.state.players.forEach((m,g)=>{g!==e&&(a=m,l=`Opponent: ${m.username||"Connecting..."}`)}),this.playerHealthText.setText(`You: ${(i==null?void 0:i.health)??"--"} HP`),this.playerBrewsText.setText(`Brews: ${(i==null?void 0:i.brews)??"--"}`),this.opponentUsernameText.setText(l),this.opponentHealthText.setText(`${(a==null?void 0:a.health)??"--"} HP`);const u=S.state.currentDay,d=S.state.currentPhase;this.dayPhaseText.setText(`Day ${u} - ${d}`)}cleanupListeners(){var e,i,a,l,u,d,m;console.log("BoardView: Cleaning up listeners."),this.listeners.forEach(g=>{if(typeof g=="function")try{g()}catch(y){console.warn("BoardView: Error cleaning up listener:",y)}}),this.listeners=[],this.cardSchemaListeners.forEach((g,y)=>{console.log(`BoardView cleanup: Cleaning up ${g.length} listeners for card instance ${y}`),g.forEach(h=>{if(typeof h=="function")try{h()}catch(I){console.warn(`BoardView: Error unsubscribing card listener for ${y}`,I)}})}),this.cardSchemaListeners.clear(),this.playerVisuals.forEach(g=>{g.hand.forEach(y=>y.destroy()),g.battlefield.forEach(y=>y.destroy())}),this.playerVisuals.clear(),(e=this.playerHealthText)==null||e.destroy(),(i=this.opponentHealthText)==null||i.destroy(),(a=this.playerBrewsText)==null||a.destroy(),(l=this.dayPhaseText)==null||l.destroy(),(u=this.opponentUsernameText)==null||u.destroy(),(d=this.sellZone)==null||d.destroy(),(m=this.brewGainText)==null||m.destroy(),this.input.off("dragenter"),this.input.off("dragleave"),this.input.off("drop")}shutdown(){console.log("BoardView shutting down..."),this.cleanupListeners(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}(async()=>(await Ep(),new ya({type:Phaser.AUTO,parent:"gameParent",width:1280,height:720,backgroundColor:"#000000",roundPixels:!1,pixelArt:!1,scene:[wp,Sp,Ip,Pp,Cp,Lp,kp,Bp,Tp,Ap]})))();
