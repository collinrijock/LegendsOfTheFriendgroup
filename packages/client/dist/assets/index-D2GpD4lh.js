var eo=Object.defineProperty;var to=(n,t,e)=>t in n?eo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var q=(n,t,e)=>(to(n,typeof t!="symbol"?t+"":t,e),e);import{P as Ii,p as pn,c as no}from"./phaser-B90dPXin.js";import{c as cn}from"./colyseus-C6TmO-rY.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();const we=class we{constructor(t){q(this,"game");q(this,"canvas");q(this,"parent");q(this,"guide");const e=t.width,s=t.height;we.width=e,we.height=s,we.center=new Ii.Math.Vector2(e/2,s/2),we.isLandscape=we.width>we.height,we.gameZone=new Ii.Geom.Rectangle(0,0,e,s),we.uiZone=new Ii.Geom.Rectangle(0,0,e,s),we.cameras=new Set,t.callbacks={postBoot:()=>this.gameBootHandler()},this.game=new Ii.Game(t)}gameBootHandler(){we.scaleManager=this.game.scale,we.scaleManager.on("resize",()=>this.onResizeHandler()),this.canvas=this.game.canvas,this.parent=this.canvas.parentElement,this.guide=document.getElementById("guide"),window.setTimeout(()=>this.onResizeHandler(),16)}onResizeHandler(){const t=this.parent.getBoundingClientRect(),e=this.canvas.getBoundingClientRect(),s=this.guide.getBoundingClientRect(),r=t.width/we.width,a=t.height/we.height,c=Math.max(r,a),u=t.width-r,y=t.height-a,p=u*(1/c),m=y*(1/c),h=we.width/2-p/2,I=we.width/2+p/2,M=we.height/2-m/2,H=we.height/2+m/2;we.uiZone.left=h,we.uiZone.right=I,we.uiZone.top=M,we.uiZone.bottom=H;const $=s.width/e.width,U=s.height/e.height,he=Math.min($,U);we.scaleFactor=he,we.cameras.forEach(ae=>{ae.zoom=he}),this.game.events.emit(we.RESIZE)}static addCamera(t){this.cameras.add(t),t.zoom=we.scaleFactor}static removeCamera(t){this.cameras.delete(t)}static getX(t){if(typeof t=="number")return t;const e=this.scaleManager.width,s=parseInt(t,10);return e*(s/100)}static getY(t){if(typeof t=="number")return t;const e=this.scaleManager.height,s=parseInt(t,10);return e*(s/100)}static getUIX(t){if(typeof t=="number")return t;const e=we.uiZone.width,s=parseInt(t,10);return e*(s/100)}static getUIY(t){if(typeof t=="number")return t;const e=we.uiZone.height,s=parseInt(t,10);return e*(s/100)}};q(we,"scaleManager"),q(we,"cameras"),q(we,"gameZone"),q(we,"uiZone"),q(we,"width"),q(we,"height"),q(we,"center"),q(we,"isLandscape"),q(we,"scaleFactor",1),q(we,"scaleFactor2",1),q(we,"RESIZE","scaleflowresize");let dr=we;var Si=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Qr={exports:{}};(function(n){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function r(y,p,m){this.fn=y,this.context=p,this.once=m||!1}function a(y,p,m,h,I){if(typeof m!="function")throw new TypeError("The listener must be a function");var M=new r(m,h||y,I),H=e?e+p:p;return y._events[H]?y._events[H].fn?y._events[H]=[y._events[H],M]:y._events[H].push(M):(y._events[H]=M,y._eventsCount++),y}function c(y,p){--y._eventsCount===0?y._events=new s:delete y._events[p]}function u(){this._events=new s,this._eventsCount=0}u.prototype.eventNames=function(){var p=[],m,h;if(this._eventsCount===0)return p;for(h in m=this._events)t.call(m,h)&&p.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(m)):p},u.prototype.listeners=function(p){var m=e?e+p:p,h=this._events[m];if(!h)return[];if(h.fn)return[h.fn];for(var I=0,M=h.length,H=new Array(M);I<M;I++)H[I]=h[I].fn;return H},u.prototype.listenerCount=function(p){var m=e?e+p:p,h=this._events[m];return h?h.fn?1:h.length:0},u.prototype.emit=function(p,m,h,I,M,H){var $=e?e+p:p;if(!this._events[$])return!1;var U=this._events[$],he=arguments.length,ae,X;if(U.fn){switch(U.once&&this.removeListener(p,U.fn,void 0,!0),he){case 1:return U.fn.call(U.context),!0;case 2:return U.fn.call(U.context,m),!0;case 3:return U.fn.call(U.context,m,h),!0;case 4:return U.fn.call(U.context,m,h,I),!0;case 5:return U.fn.call(U.context,m,h,I,M),!0;case 6:return U.fn.call(U.context,m,h,I,M,H),!0}for(X=1,ae=new Array(he-1);X<he;X++)ae[X-1]=arguments[X];U.fn.apply(U.context,ae)}else{var Pe=U.length,Ae;for(X=0;X<Pe;X++)switch(U[X].once&&this.removeListener(p,U[X].fn,void 0,!0),he){case 1:U[X].fn.call(U[X].context);break;case 2:U[X].fn.call(U[X].context,m);break;case 3:U[X].fn.call(U[X].context,m,h);break;case 4:U[X].fn.call(U[X].context,m,h,I);break;default:if(!ae)for(Ae=1,ae=new Array(he-1);Ae<he;Ae++)ae[Ae-1]=arguments[Ae];U[X].fn.apply(U[X].context,ae)}}return!0},u.prototype.on=function(p,m,h){return a(this,p,m,h,!1)},u.prototype.once=function(p,m,h){return a(this,p,m,h,!0)},u.prototype.removeListener=function(p,m,h,I){var M=e?e+p:p;if(!this._events[M])return this;if(!m)return c(this,M),this;var H=this._events[M];if(H.fn)H.fn===m&&(!I||H.once)&&(!h||H.context===h)&&c(this,M);else{for(var $=0,U=[],he=H.length;$<he;$++)(H[$].fn!==m||I&&!H[$].once||h&&H[$].context!==h)&&U.push(H[$]);U.length?this._events[M]=U.length===1?U[0]:U:c(this,M)}return this},u.prototype.removeAllListeners=function(p){var m;return p?(m=e?e+p:p,this._events[m]&&c(this,m)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=e,u.EventEmitter=u,n.exports=u})(Qr);var so=Qr.exports,ea=wr(so),Re;(function(n){n.assertEqual=r=>r;function t(r){}n.assertIs=t;function e(r){throw new Error}n.assertNever=e,n.arrayToEnum=r=>{const a={};for(const c of r)a[c]=c;return a},n.getValidEnumValues=r=>{const a=n.objectKeys(r).filter(u=>typeof r[r[u]]!="number"),c={};for(const u of a)c[u]=r[u];return n.objectValues(c)},n.objectValues=r=>n.objectKeys(r).map(function(a){return r[a]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const a=[];for(const c in r)Object.prototype.hasOwnProperty.call(r,c)&&a.push(c);return a},n.find=(r,a)=>{for(const c of r)if(a(c))return c},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function s(r,a=" | "){return r.map(c=>typeof c=="string"?`'${c}'`:c).join(a)}n.joinValues=s,n.jsonStringifyReplacer=(r,a)=>typeof a=="bigint"?a.toString():a})(Re||(Re={}));var hr;(function(n){n.mergeShapes=(t,e)=>({...t,...e})})(hr||(hr={}));const Q=Re.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Un=n=>{switch(typeof n){case"undefined":return Q.undefined;case"string":return Q.string;case"number":return isNaN(n)?Q.nan:Q.number;case"boolean":return Q.boolean;case"function":return Q.function;case"bigint":return Q.bigint;case"symbol":return Q.symbol;case"object":return Array.isArray(n)?Q.array:n===null?Q.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?Q.promise:typeof Map<"u"&&n instanceof Map?Q.map:typeof Set<"u"&&n instanceof Set?Q.set:typeof Date<"u"&&n instanceof Date?Q.date:Q.object;default:return Q.unknown}},j=Re.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),io=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class Ot extends Error{constructor(t){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const e=t||function(a){return a.message},s={_errors:[]},r=a=>{for(const c of a.issues)if(c.code==="invalid_union")c.unionErrors.map(r);else if(c.code==="invalid_return_type")r(c.returnTypeError);else if(c.code==="invalid_arguments")r(c.argumentsError);else if(c.path.length===0)s._errors.push(e(c));else{let u=s,y=0;for(;y<c.path.length;){const p=c.path[y];y===c.path.length-1?(u[p]=u[p]||{_errors:[]},u[p]._errors.push(e(c))):u[p]=u[p]||{_errors:[]},u=u[p],y++}}};return r(this),s}static assert(t){if(!(t instanceof Ot))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Re.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){const e={},s=[];for(const r of this.issues)r.path.length>0?(e[r.path[0]]=e[r.path[0]]||[],e[r.path[0]].push(t(r))):s.push(t(r));return{formErrors:s,fieldErrors:e}}get formErrors(){return this.flatten()}}Ot.create=n=>new Ot(n);const Ds=(n,t)=>{let e;switch(n.code){case j.invalid_type:n.received===Q.undefined?e="Required":e=`Expected ${n.expected}, received ${n.received}`;break;case j.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(n.expected,Re.jsonStringifyReplacer)}`;break;case j.unrecognized_keys:e=`Unrecognized key(s) in object: ${Re.joinValues(n.keys,", ")}`;break;case j.invalid_union:e="Invalid input";break;case j.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${Re.joinValues(n.options)}`;break;case j.invalid_enum_value:e=`Invalid enum value. Expected ${Re.joinValues(n.options)}, received '${n.received}'`;break;case j.invalid_arguments:e="Invalid function arguments";break;case j.invalid_return_type:e="Invalid function return type";break;case j.invalid_date:e="Invalid date";break;case j.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(e=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?e=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?e=`Invalid input: must end with "${n.validation.endsWith}"`:Re.assertNever(n.validation):n.validation!=="regex"?e=`Invalid ${n.validation}`:e="Invalid";break;case j.too_small:n.type==="array"?e=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?e=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?e=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?e=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:e="Invalid input";break;case j.too_big:n.type==="array"?e=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?e=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?e=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?e=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?e=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:e="Invalid input";break;case j.custom:e="Invalid input";break;case j.invalid_intersection_types:e="Intersection results could not be merged";break;case j.not_multiple_of:e=`Number must be a multiple of ${n.multipleOf}`;break;case j.not_finite:e="Number must be finite";break;default:e=t.defaultError,Re.assertNever(n)}return{message:e}};let ta=Ds;function ro(n){ta=n}function xi(){return ta}const Ni=n=>{const{data:t,path:e,errorMaps:s,issueData:r}=n,a=[...e,...r.path||[]],c={...r,path:a};if(r.message!==void 0)return{...r,path:a,message:r.message};let u="";const y=s.filter(p=>!!p).slice().reverse();for(const p of y)u=p(c,{data:t,defaultError:u}).message;return{...r,path:a,message:u}},ao=[];function J(n,t){const e=xi(),s=Ni({issueData:t,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,e,e===Ds?void 0:Ds].filter(r=>!!r)});n.common.issues.push(s)}class ct{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){const s=[];for(const r of e){if(r.status==="aborted")return pe;r.status==="dirty"&&t.dirty(),s.push(r.value)}return{status:t.value,value:s}}static async mergeObjectAsync(t,e){const s=[];for(const r of e){const a=await r.key,c=await r.value;s.push({key:a,value:c})}return ct.mergeObjectSync(t,s)}static mergeObjectSync(t,e){const s={};for(const r of e){const{key:a,value:c}=r;if(a.status==="aborted"||c.status==="aborted")return pe;a.status==="dirty"&&t.dirty(),c.status==="dirty"&&t.dirty(),a.value!=="__proto__"&&(typeof c.value<"u"||r.alwaysSet)&&(s[a.value]=c.value)}return{status:t.value,value:s}}}const pe=Object.freeze({status:"aborted"}),As=n=>({status:"dirty",value:n}),gt=n=>({status:"valid",value:n}),fr=n=>n.status==="aborted",pr=n=>n.status==="dirty",Fs=n=>n.status==="valid",Gs=n=>typeof Promise<"u"&&n instanceof Promise;function Ri(n,t,e,s){if(typeof t=="function"?n!==t||!s:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(n)}function na(n,t,e,s,r){if(typeof t=="function"?n!==t||!r:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(n,e),e}var le;(function(n){n.errToObj=t=>typeof t=="string"?{message:t}:t||{},n.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(le||(le={}));var Us,$s;class dn{constructor(t,e,s,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=s,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Fr=(n,t)=>{if(Fs(t))return{success:!0,data:t.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const e=new Ot(n.common.issues);return this._error=e,this._error}}};function Te(n){if(!n)return{};const{errorMap:t,invalid_type_error:e,required_error:s,description:r}=n;if(t&&(e||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:r}:{errorMap:(c,u)=>{var y,p;const{message:m}=n;return c.code==="invalid_enum_value"?{message:m??u.defaultError}:typeof u.data>"u"?{message:(y=m??s)!==null&&y!==void 0?y:u.defaultError}:c.code!=="invalid_type"?{message:u.defaultError}:{message:(p=m??e)!==null&&p!==void 0?p:u.defaultError}},description:r}}class Ie{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return Un(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:Un(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ct,ctx:{common:t.parent.common,data:t.data,parsedType:Un(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(Gs(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const s=this.safeParse(t,e);if(s.success)return s.data;throw s.error}safeParse(t,e){var s;const r={common:{issues:[],async:(s=e==null?void 0:e.async)!==null&&s!==void 0?s:!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Un(t)},a=this._parseSync({data:t,path:r.path,parent:r});return Fr(r,a)}async parseAsync(t,e){const s=await this.safeParseAsync(t,e);if(s.success)return s.data;throw s.error}async safeParseAsync(t,e){const s={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Un(t)},r=this._parse({data:t,path:s.path,parent:s}),a=await(Gs(r)?r:Promise.resolve(r));return Fr(s,a)}refine(t,e){const s=r=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,a)=>{const c=t(r),u=()=>a.addIssue({code:j.custom,...s(r)});return typeof Promise<"u"&&c instanceof Promise?c.then(y=>y?!0:(u(),!1)):c?!0:(u(),!1)})}refinement(t,e){return this._refinement((s,r)=>t(s)?!0:(r.addIssue(typeof e=="function"?e(s,r):e),!1))}_refinement(t){return new Kt({schema:this,typeName:fe.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return un.create(this,this._def)}nullable(){return Hn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Wt.create(this,this._def)}promise(){return Ns.create(this,this._def)}or(t){return zs.create([this,t],this._def)}and(t){return Ws.create(this,t,this._def)}transform(t){return new Kt({...Te(this._def),schema:this,typeName:fe.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const e=typeof t=="function"?t:()=>t;return new Js({...Te(this._def),innerType:this,defaultValue:e,typeName:fe.ZodDefault})}brand(){return new Ir({typeName:fe.ZodBranded,type:this,...Te(this._def)})}catch(t){const e=typeof t=="function"?t:()=>t;return new Qs({...Te(this._def),innerType:this,catchValue:e,typeName:fe.ZodCatch})}describe(t){const e=this.constructor;return new e({...this._def,description:t})}pipe(t){return si.create(this,t)}readonly(){return ei.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const oo=/^c[^\s-]{8,}$/i,lo=/^[0-9a-z]+$/,co=/^[0-9A-HJKMNP-TV-Z]{26}$/,uo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ho=/^[a-z0-9_-]{21}$/i,fo=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,po=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,go="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let nr;const mo=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,yo=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,vo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,sa="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bo=new RegExp(`^${sa}$`);function ia(n){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?t=`${t}\\.\\d{${n.precision}}`:n.precision==null&&(t=`${t}(\\.\\d+)?`),t}function _o(n){return new RegExp(`^${ia(n)}$`)}function ra(n){let t=`${sa}T${ia(n)}`;const e=[];return e.push(n.local?"Z?":"Z"),n.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function Eo(n,t){return!!((t==="v4"||!t)&&mo.test(n)||(t==="v6"||!t)&&yo.test(n))}class zt extends Ie{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Q.string){const a=this._getOrReturnCtx(t);return J(a,{code:j.invalid_type,expected:Q.string,received:a.parsedType}),pe}const s=new ct;let r;for(const a of this._def.checks)if(a.kind==="min")t.data.length<a.value&&(r=this._getOrReturnCtx(t,r),J(r,{code:j.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="max")t.data.length>a.value&&(r=this._getOrReturnCtx(t,r),J(r,{code:j.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="length"){const c=t.data.length>a.value,u=t.data.length<a.value;(c||u)&&(r=this._getOrReturnCtx(t,r),c?J(r,{code:j.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):u&&J(r,{code:j.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),s.dirty())}else if(a.kind==="email")po.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"email",code:j.invalid_string,message:a.message}),s.dirty());else if(a.kind==="emoji")nr||(nr=new RegExp(go,"u")),nr.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"emoji",code:j.invalid_string,message:a.message}),s.dirty());else if(a.kind==="uuid")uo.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"uuid",code:j.invalid_string,message:a.message}),s.dirty());else if(a.kind==="nanoid")ho.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"nanoid",code:j.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid")oo.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"cuid",code:j.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid2")lo.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"cuid2",code:j.invalid_string,message:a.message}),s.dirty());else if(a.kind==="ulid")co.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"ulid",code:j.invalid_string,message:a.message}),s.dirty());else if(a.kind==="url")try{new URL(t.data)}catch{r=this._getOrReturnCtx(t,r),J(r,{validation:"url",code:j.invalid_string,message:a.message}),s.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"regex",code:j.invalid_string,message:a.message}),s.dirty())):a.kind==="trim"?t.data=t.data.trim():a.kind==="includes"?t.data.includes(a.value,a.position)||(r=this._getOrReturnCtx(t,r),J(r,{code:j.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),s.dirty()):a.kind==="toLowerCase"?t.data=t.data.toLowerCase():a.kind==="toUpperCase"?t.data=t.data.toUpperCase():a.kind==="startsWith"?t.data.startsWith(a.value)||(r=this._getOrReturnCtx(t,r),J(r,{code:j.invalid_string,validation:{startsWith:a.value},message:a.message}),s.dirty()):a.kind==="endsWith"?t.data.endsWith(a.value)||(r=this._getOrReturnCtx(t,r),J(r,{code:j.invalid_string,validation:{endsWith:a.value},message:a.message}),s.dirty()):a.kind==="datetime"?ra(a).test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{code:j.invalid_string,validation:"datetime",message:a.message}),s.dirty()):a.kind==="date"?bo.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{code:j.invalid_string,validation:"date",message:a.message}),s.dirty()):a.kind==="time"?_o(a).test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{code:j.invalid_string,validation:"time",message:a.message}),s.dirty()):a.kind==="duration"?fo.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"duration",code:j.invalid_string,message:a.message}),s.dirty()):a.kind==="ip"?Eo(t.data,a.version)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"ip",code:j.invalid_string,message:a.message}),s.dirty()):a.kind==="base64"?vo.test(t.data)||(r=this._getOrReturnCtx(t,r),J(r,{validation:"base64",code:j.invalid_string,message:a.message}),s.dirty()):Re.assertNever(a);return{status:s.value,value:t.data}}_regex(t,e,s){return this.refinement(r=>t.test(r),{validation:e,code:j.invalid_string,...le.errToObj(s)})}_addCheck(t){return new zt({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...le.errToObj(t)})}url(t){return this._addCheck({kind:"url",...le.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...le.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...le.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...le.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...le.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...le.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...le.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...le.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...le.errToObj(t)})}datetime(t){var e,s;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(e=t==null?void 0:t.offset)!==null&&e!==void 0?e:!1,local:(s=t==null?void 0:t.local)!==null&&s!==void 0?s:!1,...le.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...le.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...le.errToObj(t)})}regex(t,e){return this._addCheck({kind:"regex",regex:t,...le.errToObj(e)})}includes(t,e){return this._addCheck({kind:"includes",value:t,position:e==null?void 0:e.position,...le.errToObj(e==null?void 0:e.message)})}startsWith(t,e){return this._addCheck({kind:"startsWith",value:t,...le.errToObj(e)})}endsWith(t,e){return this._addCheck({kind:"endsWith",value:t,...le.errToObj(e)})}min(t,e){return this._addCheck({kind:"min",value:t,...le.errToObj(e)})}max(t,e){return this._addCheck({kind:"max",value:t,...le.errToObj(e)})}length(t,e){return this._addCheck({kind:"length",value:t,...le.errToObj(e)})}nonempty(t){return this.min(1,le.errToObj(t))}trim(){return new zt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new zt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new zt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}zt.create=n=>{var t;return new zt({checks:[],typeName:fe.ZodString,coerce:(t=n==null?void 0:n.coerce)!==null&&t!==void 0?t:!1,...Te(n)})};function To(n,t){const e=(n.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,r=e>s?e:s,a=parseInt(n.toFixed(r).replace(".","")),c=parseInt(t.toFixed(r).replace(".",""));return a%c/Math.pow(10,r)}class Fn extends Ie{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Q.number){const a=this._getOrReturnCtx(t);return J(a,{code:j.invalid_type,expected:Q.number,received:a.parsedType}),pe}let s;const r=new ct;for(const a of this._def.checks)a.kind==="int"?Re.isInteger(t.data)||(s=this._getOrReturnCtx(t,s),J(s,{code:j.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(s=this._getOrReturnCtx(t,s),J(s,{code:j.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(s=this._getOrReturnCtx(t,s),J(s,{code:j.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="multipleOf"?To(t.data,a.value)!==0&&(s=this._getOrReturnCtx(t,s),J(s,{code:j.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):a.kind==="finite"?Number.isFinite(t.data)||(s=this._getOrReturnCtx(t,s),J(s,{code:j.not_finite,message:a.message}),r.dirty()):Re.assertNever(a);return{status:r.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,le.toString(e))}gt(t,e){return this.setLimit("min",t,!1,le.toString(e))}lte(t,e){return this.setLimit("max",t,!0,le.toString(e))}lt(t,e){return this.setLimit("max",t,!1,le.toString(e))}setLimit(t,e,s,r){return new Fn({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:s,message:le.toString(r)}]})}_addCheck(t){return new Fn({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:le.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:le.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:le.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:le.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:le.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:le.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:le.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:le.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:le.toString(t)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Re.isInteger(t.value))}get isFinite(){let t=null,e=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(e===null||s.value>e)&&(e=s.value):s.kind==="max"&&(t===null||s.value<t)&&(t=s.value)}return Number.isFinite(e)&&Number.isFinite(t)}}Fn.create=n=>new Fn({checks:[],typeName:fe.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Te(n)});class Gn extends Ie{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==Q.bigint){const a=this._getOrReturnCtx(t);return J(a,{code:j.invalid_type,expected:Q.bigint,received:a.parsedType}),pe}let s;const r=new ct;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(s=this._getOrReturnCtx(t,s),J(s,{code:j.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(s=this._getOrReturnCtx(t,s),J(s,{code:j.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="multipleOf"?t.data%a.value!==BigInt(0)&&(s=this._getOrReturnCtx(t,s),J(s,{code:j.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):Re.assertNever(a);return{status:r.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,le.toString(e))}gt(t,e){return this.setLimit("min",t,!1,le.toString(e))}lte(t,e){return this.setLimit("max",t,!0,le.toString(e))}lt(t,e){return this.setLimit("max",t,!1,le.toString(e))}setLimit(t,e,s,r){return new Gn({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:s,message:le.toString(r)}]})}_addCheck(t){return new Gn({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:le.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:le.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:le.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:le.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:le.toString(e)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}Gn.create=n=>{var t;return new Gn({checks:[],typeName:fe.ZodBigInt,coerce:(t=n==null?void 0:n.coerce)!==null&&t!==void 0?t:!1,...Te(n)})};class Zs extends Ie{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Q.boolean){const s=this._getOrReturnCtx(t);return J(s,{code:j.invalid_type,expected:Q.boolean,received:s.parsedType}),pe}return gt(t.data)}}Zs.create=n=>new Zs({typeName:fe.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Te(n)});class hs extends Ie{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Q.date){const a=this._getOrReturnCtx(t);return J(a,{code:j.invalid_type,expected:Q.date,received:a.parsedType}),pe}if(isNaN(t.data.getTime())){const a=this._getOrReturnCtx(t);return J(a,{code:j.invalid_date}),pe}const s=new ct;let r;for(const a of this._def.checks)a.kind==="min"?t.data.getTime()<a.value&&(r=this._getOrReturnCtx(t,r),J(r,{code:j.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),s.dirty()):a.kind==="max"?t.data.getTime()>a.value&&(r=this._getOrReturnCtx(t,r),J(r,{code:j.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),s.dirty()):Re.assertNever(a);return{status:s.value,value:new Date(t.data.getTime())}}_addCheck(t){return new hs({...this._def,checks:[...this._def.checks,t]})}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:le.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:le.toString(e)})}get minDate(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}}hs.create=n=>new hs({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:fe.ZodDate,...Te(n)});class Pi extends Ie{_parse(t){if(this._getType(t)!==Q.symbol){const s=this._getOrReturnCtx(t);return J(s,{code:j.invalid_type,expected:Q.symbol,received:s.parsedType}),pe}return gt(t.data)}}Pi.create=n=>new Pi({typeName:fe.ZodSymbol,...Te(n)});class Hs extends Ie{_parse(t){if(this._getType(t)!==Q.undefined){const s=this._getOrReturnCtx(t);return J(s,{code:j.invalid_type,expected:Q.undefined,received:s.parsedType}),pe}return gt(t.data)}}Hs.create=n=>new Hs({typeName:fe.ZodUndefined,...Te(n)});class js extends Ie{_parse(t){if(this._getType(t)!==Q.null){const s=this._getOrReturnCtx(t);return J(s,{code:j.invalid_type,expected:Q.null,received:s.parsedType}),pe}return gt(t.data)}}js.create=n=>new js({typeName:fe.ZodNull,...Te(n)});class xs extends Ie{constructor(){super(...arguments),this._any=!0}_parse(t){return gt(t.data)}}xs.create=n=>new xs({typeName:fe.ZodAny,...Te(n)});class us extends Ie{constructor(){super(...arguments),this._unknown=!0}_parse(t){return gt(t.data)}}us.create=n=>new us({typeName:fe.ZodUnknown,...Te(n)});class An extends Ie{_parse(t){const e=this._getOrReturnCtx(t);return J(e,{code:j.invalid_type,expected:Q.never,received:e.parsedType}),pe}}An.create=n=>new An({typeName:fe.ZodNever,...Te(n)});class Li extends Ie{_parse(t){if(this._getType(t)!==Q.undefined){const s=this._getOrReturnCtx(t);return J(s,{code:j.invalid_type,expected:Q.void,received:s.parsedType}),pe}return gt(t.data)}}Li.create=n=>new Li({typeName:fe.ZodVoid,...Te(n)});class Wt extends Ie{_parse(t){const{ctx:e,status:s}=this._processInputParams(t),r=this._def;if(e.parsedType!==Q.array)return J(e,{code:j.invalid_type,expected:Q.array,received:e.parsedType}),pe;if(r.exactLength!==null){const c=e.data.length>r.exactLength.value,u=e.data.length<r.exactLength.value;(c||u)&&(J(e,{code:c?j.too_big:j.too_small,minimum:u?r.exactLength.value:void 0,maximum:c?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(r.minLength!==null&&e.data.length<r.minLength.value&&(J(e,{code:j.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),r.maxLength!==null&&e.data.length>r.maxLength.value&&(J(e,{code:j.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),e.common.async)return Promise.all([...e.data].map((c,u)=>r.type._parseAsync(new dn(e,c,e.path,u)))).then(c=>ct.mergeArray(s,c));const a=[...e.data].map((c,u)=>r.type._parseSync(new dn(e,c,e.path,u)));return ct.mergeArray(s,a)}get element(){return this._def.type}min(t,e){return new Wt({...this._def,minLength:{value:t,message:le.toString(e)}})}max(t,e){return new Wt({...this._def,maxLength:{value:t,message:le.toString(e)}})}length(t,e){return new Wt({...this._def,exactLength:{value:t,message:le.toString(e)}})}nonempty(t){return this.min(1,t)}}Wt.create=(n,t)=>new Wt({type:n,minLength:null,maxLength:null,exactLength:null,typeName:fe.ZodArray,...Te(t)});function Ss(n){if(n instanceof Ve){const t={};for(const e in n.shape){const s=n.shape[e];t[e]=un.create(Ss(s))}return new Ve({...n._def,shape:()=>t})}else return n instanceof Wt?new Wt({...n._def,type:Ss(n.element)}):n instanceof un?un.create(Ss(n.unwrap())):n instanceof Hn?Hn.create(Ss(n.unwrap())):n instanceof hn?hn.create(n.items.map(t=>Ss(t))):n}class Ve extends Ie{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),e=Re.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==Q.object){const p=this._getOrReturnCtx(t);return J(p,{code:j.invalid_type,expected:Q.object,received:p.parsedType}),pe}const{status:s,ctx:r}=this._processInputParams(t),{shape:a,keys:c}=this._getCached(),u=[];if(!(this._def.catchall instanceof An&&this._def.unknownKeys==="strip"))for(const p in r.data)c.includes(p)||u.push(p);const y=[];for(const p of c){const m=a[p],h=r.data[p];y.push({key:{status:"valid",value:p},value:m._parse(new dn(r,h,r.path,p)),alwaysSet:p in r.data})}if(this._def.catchall instanceof An){const p=this._def.unknownKeys;if(p==="passthrough")for(const m of u)y.push({key:{status:"valid",value:m},value:{status:"valid",value:r.data[m]}});else if(p==="strict")u.length>0&&(J(r,{code:j.unrecognized_keys,keys:u}),s.dirty());else if(p!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const p=this._def.catchall;for(const m of u){const h=r.data[m];y.push({key:{status:"valid",value:m},value:p._parse(new dn(r,h,r.path,m)),alwaysSet:m in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const p=[];for(const m of y){const h=await m.key,I=await m.value;p.push({key:h,value:I,alwaysSet:m.alwaysSet})}return p}).then(p=>ct.mergeObjectSync(s,p)):ct.mergeObjectSync(s,y)}get shape(){return this._def.shape()}strict(t){return le.errToObj,new Ve({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(e,s)=>{var r,a,c,u;const y=(c=(a=(r=this._def).errorMap)===null||a===void 0?void 0:a.call(r,e,s).message)!==null&&c!==void 0?c:s.defaultError;return e.code==="unrecognized_keys"?{message:(u=le.errToObj(t).message)!==null&&u!==void 0?u:y}:{message:y}}}:{}})}strip(){return new Ve({...this._def,unknownKeys:"strip"})}passthrough(){return new Ve({...this._def,unknownKeys:"passthrough"})}extend(t){return new Ve({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Ve({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:fe.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new Ve({...this._def,catchall:t})}pick(t){const e={};return Re.objectKeys(t).forEach(s=>{t[s]&&this.shape[s]&&(e[s]=this.shape[s])}),new Ve({...this._def,shape:()=>e})}omit(t){const e={};return Re.objectKeys(this.shape).forEach(s=>{t[s]||(e[s]=this.shape[s])}),new Ve({...this._def,shape:()=>e})}deepPartial(){return Ss(this)}partial(t){const e={};return Re.objectKeys(this.shape).forEach(s=>{const r=this.shape[s];t&&!t[s]?e[s]=r:e[s]=r.optional()}),new Ve({...this._def,shape:()=>e})}required(t){const e={};return Re.objectKeys(this.shape).forEach(s=>{if(t&&!t[s])e[s]=this.shape[s];else{let a=this.shape[s];for(;a instanceof un;)a=a._def.innerType;e[s]=a}}),new Ve({...this._def,shape:()=>e})}keyof(){return aa(Re.objectKeys(this.shape))}}Ve.create=(n,t)=>new Ve({shape:()=>n,unknownKeys:"strip",catchall:An.create(),typeName:fe.ZodObject,...Te(t)});Ve.strictCreate=(n,t)=>new Ve({shape:()=>n,unknownKeys:"strict",catchall:An.create(),typeName:fe.ZodObject,...Te(t)});Ve.lazycreate=(n,t)=>new Ve({shape:n,unknownKeys:"strip",catchall:An.create(),typeName:fe.ZodObject,...Te(t)});class zs extends Ie{_parse(t){const{ctx:e}=this._processInputParams(t),s=this._def.options;function r(a){for(const u of a)if(u.result.status==="valid")return u.result;for(const u of a)if(u.result.status==="dirty")return e.common.issues.push(...u.ctx.common.issues),u.result;const c=a.map(u=>new Ot(u.ctx.common.issues));return J(e,{code:j.invalid_union,unionErrors:c}),pe}if(e.common.async)return Promise.all(s.map(async a=>{const c={...e,common:{...e.common,issues:[]},parent:null};return{result:await a._parseAsync({data:e.data,path:e.path,parent:c}),ctx:c}})).then(r);{let a;const c=[];for(const y of s){const p={...e,common:{...e.common,issues:[]},parent:null},m=y._parseSync({data:e.data,path:e.path,parent:p});if(m.status==="valid")return m;m.status==="dirty"&&!a&&(a={result:m,ctx:p}),p.common.issues.length&&c.push(p.common.issues)}if(a)return e.common.issues.push(...a.ctx.common.issues),a.result;const u=c.map(y=>new Ot(y));return J(e,{code:j.invalid_union,unionErrors:u}),pe}}get options(){return this._def.options}}zs.create=(n,t)=>new zs({options:n,typeName:fe.ZodUnion,...Te(t)});const En=n=>n instanceof Ys?En(n.schema):n instanceof Kt?En(n.innerType()):n instanceof qs?[n.value]:n instanceof Zn?n.options:n instanceof Xs?Re.objectValues(n.enum):n instanceof Js?En(n._def.innerType):n instanceof Hs?[void 0]:n instanceof js?[null]:n instanceof un?[void 0,...En(n.unwrap())]:n instanceof Hn?[null,...En(n.unwrap())]:n instanceof Ir||n instanceof ei?En(n.unwrap()):n instanceof Qs?En(n._def.innerType):[];class Ui extends Ie{_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==Q.object)return J(e,{code:j.invalid_type,expected:Q.object,received:e.parsedType}),pe;const s=this.discriminator,r=e.data[s],a=this.optionsMap.get(r);return a?e.common.async?a._parseAsync({data:e.data,path:e.path,parent:e}):a._parseSync({data:e.data,path:e.path,parent:e}):(J(e,{code:j.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),pe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,s){const r=new Map;for(const a of e){const c=En(a.shape[t]);if(!c.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const u of c){if(r.has(u))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(u)}`);r.set(u,a)}}return new Ui({typeName:fe.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:r,...Te(s)})}}function gr(n,t){const e=Un(n),s=Un(t);if(n===t)return{valid:!0,data:n};if(e===Q.object&&s===Q.object){const r=Re.objectKeys(t),a=Re.objectKeys(n).filter(u=>r.indexOf(u)!==-1),c={...n,...t};for(const u of a){const y=gr(n[u],t[u]);if(!y.valid)return{valid:!1};c[u]=y.data}return{valid:!0,data:c}}else if(e===Q.array&&s===Q.array){if(n.length!==t.length)return{valid:!1};const r=[];for(let a=0;a<n.length;a++){const c=n[a],u=t[a],y=gr(c,u);if(!y.valid)return{valid:!1};r.push(y.data)}return{valid:!0,data:r}}else return e===Q.date&&s===Q.date&&+n==+t?{valid:!0,data:n}:{valid:!1}}class Ws extends Ie{_parse(t){const{status:e,ctx:s}=this._processInputParams(t),r=(a,c)=>{if(fr(a)||fr(c))return pe;const u=gr(a.value,c.value);return u.valid?((pr(a)||pr(c))&&e.dirty(),{status:e.value,value:u.data}):(J(s,{code:j.invalid_intersection_types}),pe)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([a,c])=>r(a,c)):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Ws.create=(n,t,e)=>new Ws({left:n,right:t,typeName:fe.ZodIntersection,...Te(e)});class hn extends Ie{_parse(t){const{status:e,ctx:s}=this._processInputParams(t);if(s.parsedType!==Q.array)return J(s,{code:j.invalid_type,expected:Q.array,received:s.parsedType}),pe;if(s.data.length<this._def.items.length)return J(s,{code:j.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),pe;!this._def.rest&&s.data.length>this._def.items.length&&(J(s,{code:j.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());const a=[...s.data].map((c,u)=>{const y=this._def.items[u]||this._def.rest;return y?y._parse(new dn(s,c,s.path,u)):null}).filter(c=>!!c);return s.common.async?Promise.all(a).then(c=>ct.mergeArray(e,c)):ct.mergeArray(e,a)}get items(){return this._def.items}rest(t){return new hn({...this._def,rest:t})}}hn.create=(n,t)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new hn({items:n,typeName:fe.ZodTuple,rest:null,...Te(t)})};class Ks extends Ie{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:s}=this._processInputParams(t);if(s.parsedType!==Q.object)return J(s,{code:j.invalid_type,expected:Q.object,received:s.parsedType}),pe;const r=[],a=this._def.keyType,c=this._def.valueType;for(const u in s.data)r.push({key:a._parse(new dn(s,u,s.path,u)),value:c._parse(new dn(s,s.data[u],s.path,u)),alwaysSet:u in s.data});return s.common.async?ct.mergeObjectAsync(e,r):ct.mergeObjectSync(e,r)}get element(){return this._def.valueType}static create(t,e,s){return e instanceof Ie?new Ks({keyType:t,valueType:e,typeName:fe.ZodRecord,...Te(s)}):new Ks({keyType:zt.create(),valueType:t,typeName:fe.ZodRecord,...Te(e)})}}class ki extends Ie{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:s}=this._processInputParams(t);if(s.parsedType!==Q.map)return J(s,{code:j.invalid_type,expected:Q.map,received:s.parsedType}),pe;const r=this._def.keyType,a=this._def.valueType,c=[...s.data.entries()].map(([u,y],p)=>({key:r._parse(new dn(s,u,s.path,[p,"key"])),value:a._parse(new dn(s,y,s.path,[p,"value"]))}));if(s.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const y of c){const p=await y.key,m=await y.value;if(p.status==="aborted"||m.status==="aborted")return pe;(p.status==="dirty"||m.status==="dirty")&&e.dirty(),u.set(p.value,m.value)}return{status:e.value,value:u}})}else{const u=new Map;for(const y of c){const p=y.key,m=y.value;if(p.status==="aborted"||m.status==="aborted")return pe;(p.status==="dirty"||m.status==="dirty")&&e.dirty(),u.set(p.value,m.value)}return{status:e.value,value:u}}}}ki.create=(n,t,e)=>new ki({valueType:t,keyType:n,typeName:fe.ZodMap,...Te(e)});class fs extends Ie{_parse(t){const{status:e,ctx:s}=this._processInputParams(t);if(s.parsedType!==Q.set)return J(s,{code:j.invalid_type,expected:Q.set,received:s.parsedType}),pe;const r=this._def;r.minSize!==null&&s.data.size<r.minSize.value&&(J(s,{code:j.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),e.dirty()),r.maxSize!==null&&s.data.size>r.maxSize.value&&(J(s,{code:j.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),e.dirty());const a=this._def.valueType;function c(y){const p=new Set;for(const m of y){if(m.status==="aborted")return pe;m.status==="dirty"&&e.dirty(),p.add(m.value)}return{status:e.value,value:p}}const u=[...s.data.values()].map((y,p)=>a._parse(new dn(s,y,s.path,p)));return s.common.async?Promise.all(u).then(y=>c(y)):c(u)}min(t,e){return new fs({...this._def,minSize:{value:t,message:le.toString(e)}})}max(t,e){return new fs({...this._def,maxSize:{value:t,message:le.toString(e)}})}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}}fs.create=(n,t)=>new fs({valueType:n,minSize:null,maxSize:null,typeName:fe.ZodSet,...Te(t)});class Os extends Ie{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==Q.function)return J(e,{code:j.invalid_type,expected:Q.function,received:e.parsedType}),pe;function s(u,y){return Ni({data:u,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,xi(),Ds].filter(p=>!!p),issueData:{code:j.invalid_arguments,argumentsError:y}})}function r(u,y){return Ni({data:u,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,xi(),Ds].filter(p=>!!p),issueData:{code:j.invalid_return_type,returnTypeError:y}})}const a={errorMap:e.common.contextualErrorMap},c=e.data;if(this._def.returns instanceof Ns){const u=this;return gt(async function(...y){const p=new Ot([]),m=await u._def.args.parseAsync(y,a).catch(M=>{throw p.addIssue(s(y,M)),p}),h=await Reflect.apply(c,this,m);return await u._def.returns._def.type.parseAsync(h,a).catch(M=>{throw p.addIssue(r(h,M)),p})})}else{const u=this;return gt(function(...y){const p=u._def.args.safeParse(y,a);if(!p.success)throw new Ot([s(y,p.error)]);const m=Reflect.apply(c,this,p.data),h=u._def.returns.safeParse(m,a);if(!h.success)throw new Ot([r(m,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new Os({...this._def,args:hn.create(t).rest(us.create())})}returns(t){return new Os({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,s){return new Os({args:t||hn.create([]).rest(us.create()),returns:e||us.create(),typeName:fe.ZodFunction,...Te(s)})}}class Ys extends Ie{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}Ys.create=(n,t)=>new Ys({getter:n,typeName:fe.ZodLazy,...Te(t)});class qs extends Ie{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return J(e,{received:e.data,code:j.invalid_literal,expected:this._def.value}),pe}return{status:"valid",value:t.data}}get value(){return this._def.value}}qs.create=(n,t)=>new qs({value:n,typeName:fe.ZodLiteral,...Te(t)});function aa(n,t){return new Zn({values:n,typeName:fe.ZodEnum,...Te(t)})}class Zn extends Ie{constructor(){super(...arguments),Us.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const e=this._getOrReturnCtx(t),s=this._def.values;return J(e,{expected:Re.joinValues(s),received:e.parsedType,code:j.invalid_type}),pe}if(Ri(this,Us)||na(this,Us,new Set(this._def.values)),!Ri(this,Us).has(t.data)){const e=this._getOrReturnCtx(t),s=this._def.values;return J(e,{received:e.data,code:j.invalid_enum_value,options:s}),pe}return gt(t.data)}get options(){return this._def.values}get enum(){const t={};for(const e of this._def.values)t[e]=e;return t}get Values(){const t={};for(const e of this._def.values)t[e]=e;return t}get Enum(){const t={};for(const e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return Zn.create(t,{...this._def,...e})}exclude(t,e=this._def){return Zn.create(this.options.filter(s=>!t.includes(s)),{...this._def,...e})}}Us=new WeakMap;Zn.create=aa;class Xs extends Ie{constructor(){super(...arguments),$s.set(this,void 0)}_parse(t){const e=Re.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(t);if(s.parsedType!==Q.string&&s.parsedType!==Q.number){const r=Re.objectValues(e);return J(s,{expected:Re.joinValues(r),received:s.parsedType,code:j.invalid_type}),pe}if(Ri(this,$s)||na(this,$s,new Set(Re.getValidEnumValues(this._def.values))),!Ri(this,$s).has(t.data)){const r=Re.objectValues(e);return J(s,{received:s.data,code:j.invalid_enum_value,options:r}),pe}return gt(t.data)}get enum(){return this._def.values}}$s=new WeakMap;Xs.create=(n,t)=>new Xs({values:n,typeName:fe.ZodNativeEnum,...Te(t)});class Ns extends Ie{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==Q.promise&&e.common.async===!1)return J(e,{code:j.invalid_type,expected:Q.promise,received:e.parsedType}),pe;const s=e.parsedType===Q.promise?e.data:Promise.resolve(e.data);return gt(s.then(r=>this._def.type.parseAsync(r,{path:e.path,errorMap:e.common.contextualErrorMap})))}}Ns.create=(n,t)=>new Ns({type:n,typeName:fe.ZodPromise,...Te(t)});class Kt extends Ie{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===fe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:s}=this._processInputParams(t),r=this._def.effect||null,a={addIssue:c=>{J(s,c),c.fatal?e.abort():e.dirty()},get path(){return s.path}};if(a.addIssue=a.addIssue.bind(a),r.type==="preprocess"){const c=r.transform(s.data,a);if(s.common.async)return Promise.resolve(c).then(async u=>{if(e.value==="aborted")return pe;const y=await this._def.schema._parseAsync({data:u,path:s.path,parent:s});return y.status==="aborted"?pe:y.status==="dirty"||e.value==="dirty"?As(y.value):y});{if(e.value==="aborted")return pe;const u=this._def.schema._parseSync({data:c,path:s.path,parent:s});return u.status==="aborted"?pe:u.status==="dirty"||e.value==="dirty"?As(u.value):u}}if(r.type==="refinement"){const c=u=>{const y=r.refinement(u,a);if(s.common.async)return Promise.resolve(y);if(y instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(s.common.async===!1){const u=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return u.status==="aborted"?pe:(u.status==="dirty"&&e.dirty(),c(u.value),{status:e.value,value:u.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(u=>u.status==="aborted"?pe:(u.status==="dirty"&&e.dirty(),c(u.value).then(()=>({status:e.value,value:u.value}))))}if(r.type==="transform")if(s.common.async===!1){const c=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Fs(c))return c;const u=r.transform(c.value,a);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:u}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(c=>Fs(c)?Promise.resolve(r.transform(c.value,a)).then(u=>({status:e.value,value:u})):c);Re.assertNever(r)}}Kt.create=(n,t,e)=>new Kt({schema:n,typeName:fe.ZodEffects,effect:t,...Te(e)});Kt.createWithPreprocess=(n,t,e)=>new Kt({schema:t,effect:{type:"preprocess",transform:n},typeName:fe.ZodEffects,...Te(e)});class un extends Ie{_parse(t){return this._getType(t)===Q.undefined?gt(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}un.create=(n,t)=>new un({innerType:n,typeName:fe.ZodOptional,...Te(t)});class Hn extends Ie{_parse(t){return this._getType(t)===Q.null?gt(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Hn.create=(n,t)=>new Hn({innerType:n,typeName:fe.ZodNullable,...Te(t)});class Js extends Ie{_parse(t){const{ctx:e}=this._processInputParams(t);let s=e.data;return e.parsedType===Q.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}Js.create=(n,t)=>new Js({innerType:n,typeName:fe.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Te(t)});class Qs extends Ie{_parse(t){const{ctx:e}=this._processInputParams(t),s={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Gs(r)?r.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ot(s.common.issues)},input:s.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Ot(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Qs.create=(n,t)=>new Qs({innerType:n,typeName:fe.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Te(t)});class Bi extends Ie{_parse(t){if(this._getType(t)!==Q.nan){const s=this._getOrReturnCtx(t);return J(s,{code:j.invalid_type,expected:Q.nan,received:s.parsedType}),pe}return{status:"valid",value:t.data}}}Bi.create=n=>new Bi({typeName:fe.ZodNaN,...Te(n)});const wo=Symbol("zod_brand");class Ir extends Ie{_parse(t){const{ctx:e}=this._processInputParams(t),s=e.data;return this._def.type._parse({data:s,path:e.path,parent:e})}unwrap(){return this._def.type}}class si extends Ie{_parse(t){const{status:e,ctx:s}=this._processInputParams(t);if(s.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?pe:a.status==="dirty"?(e.dirty(),As(a.value)):this._def.out._parseAsync({data:a.value,path:s.path,parent:s})})();{const r=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?pe:r.status==="dirty"?(e.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:s.path,parent:s})}}static create(t,e){return new si({in:t,out:e,typeName:fe.ZodPipeline})}}class ei extends Ie{_parse(t){const e=this._def.innerType._parse(t),s=r=>(Fs(r)&&(r.value=Object.freeze(r.value)),r);return Gs(e)?e.then(r=>s(r)):s(e)}unwrap(){return this._def.innerType}}ei.create=(n,t)=>new ei({innerType:n,typeName:fe.ZodReadonly,...Te(t)});function Sr(n,t={},e){return n?xs.create().superRefine((s,r)=>{var a,c;if(!n(s)){const u=typeof t=="function"?t(s):typeof t=="string"?{message:t}:t,y=(c=(a=u.fatal)!==null&&a!==void 0?a:e)!==null&&c!==void 0?c:!0,p=typeof u=="string"?{message:u}:u;r.addIssue({code:"custom",...p,fatal:y})}}):xs.create()}const Io={object:Ve.lazycreate};var fe;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(fe||(fe={}));const So=(n,t={message:`Input not instance of ${n.name}`})=>Sr(e=>e instanceof n,t),A=zt.create,ce=Fn.create,Ao=Bi.create,oa=Gn.create,me=Zs.create,Oo=hs.create,Do=Pi.create,xo=Hs.create,Ar=js.create,No=xs.create,ti=us.create,Ro=An.create,Po=Li.create,Ne=Wt.create,K=Ve.create,Lo=Ve.strictCreate,Or=zs.create,ko=Ui.create,Bo=Ws.create,Co=hn.create,Mo=Ks.create,Uo=ki.create,$o=fs.create,Vo=Os.create,Fo=Ys.create,Qe=qs.create,Go=Zn.create,Ps=Xs.create,Zo=Ns.create,Gr=Kt.create,la=un.create,Ho=Hn.create,ca=Kt.createWithPreprocess,jo=si.create,zo=()=>A().optional(),Wo=()=>ce().optional(),Ko=()=>me().optional(),Yo={string:n=>zt.create({...n,coerce:!0}),number:n=>Fn.create({...n,coerce:!0}),boolean:n=>Zs.create({...n,coerce:!0}),bigint:n=>Gn.create({...n,coerce:!0}),date:n=>hs.create({...n,coerce:!0})},qo=pe;var re=Object.freeze({__proto__:null,defaultErrorMap:Ds,setErrorMap:ro,getErrorMap:xi,makeIssue:Ni,EMPTY_PATH:ao,addIssueToContext:J,ParseStatus:ct,INVALID:pe,DIRTY:As,OK:gt,isAborted:fr,isDirty:pr,isValid:Fs,isAsync:Gs,get util(){return Re},get objectUtil(){return hr},ZodParsedType:Q,getParsedType:Un,ZodType:Ie,datetimeRegex:ra,ZodString:zt,ZodNumber:Fn,ZodBigInt:Gn,ZodBoolean:Zs,ZodDate:hs,ZodSymbol:Pi,ZodUndefined:Hs,ZodNull:js,ZodAny:xs,ZodUnknown:us,ZodNever:An,ZodVoid:Li,ZodArray:Wt,ZodObject:Ve,ZodUnion:zs,ZodDiscriminatedUnion:Ui,ZodIntersection:Ws,ZodTuple:hn,ZodRecord:Ks,ZodMap:ki,ZodSet:fs,ZodFunction:Os,ZodLazy:Ys,ZodLiteral:qs,ZodEnum:Zn,ZodNativeEnum:Xs,ZodPromise:Ns,ZodEffects:Kt,ZodTransformer:Kt,ZodOptional:un,ZodNullable:Hn,ZodDefault:Js,ZodCatch:Qs,ZodNaN:Bi,BRAND:wo,ZodBranded:Ir,ZodPipeline:si,ZodReadonly:ei,custom:Sr,Schema:Ie,ZodSchema:Ie,late:Io,get ZodFirstPartyTypeKind(){return fe},coerce:Yo,any:No,array:Ne,bigint:oa,boolean:me,date:Oo,discriminatedUnion:ko,effect:Gr,enum:Go,function:Vo,instanceof:So,intersection:Bo,lazy:Fo,literal:Qe,map:Uo,nan:Ao,nativeEnum:Ps,never:Ro,null:Ar,nullable:Ho,number:ce,object:K,oboolean:Ko,onumber:Wo,optional:la,ostring:zo,pipeline:jo,preprocess:ca,promise:Zo,record:Mo,set:$o,strictObject:Lo,string:A,symbol:Do,transformer:Gr,tuple:Co,undefined:xo,union:Or,unknown:ti,void:Po,NEVER:qo,ZodIssueCode:j,quotelessJson:io,ZodError:Ot}),ua={exports:{}};(function(n){var t=function(e){var s=1e7,r=7,a=9007199254740992,c=H(a),u="0123456789abcdefghijklmnopqrstuvwxyz",y=typeof BigInt=="function";function p(d,b,w,D){return typeof d>"u"?p[0]:typeof b<"u"?+b==10&&!w?de(d):Jt(d,b,w,D):de(d)}function m(d,b){this.value=d,this.sign=b,this.isSmall=!1}m.prototype=Object.create(p.prototype);function h(d){this.value=d,this.sign=d<0,this.isSmall=!0}h.prototype=Object.create(p.prototype);function I(d){this.value=d}I.prototype=Object.create(p.prototype);function M(d){return-a<d&&d<a}function H(d){return d<1e7?[d]:d<1e14?[d%1e7,Math.floor(d/1e7)]:[d%1e7,Math.floor(d/1e7)%1e7,Math.floor(d/1e14)]}function $(d){U(d);var b=d.length;if(b<4&&Nt(d,c)<0)switch(b){case 0:return 0;case 1:return d[0];case 2:return d[0]+d[1]*s;default:return d[0]+(d[1]+d[2]*s)*s}return d}function U(d){for(var b=d.length;d[--b]===0;);d.length=b+1}function he(d){for(var b=new Array(d),w=-1;++w<d;)b[w]=0;return b}function ae(d){return d>0?Math.floor(d):Math.ceil(d)}function X(d,b){var w=d.length,D=b.length,P=new Array(w),R=0,k=s,C,F;for(F=0;F<D;F++)C=d[F]+b[F]+R,R=C>=k?1:0,P[F]=C-R*k;for(;F<w;)C=d[F]+R,R=C===k?1:0,P[F++]=C-R*k;return R>0&&P.push(R),P}function Pe(d,b){return d.length>=b.length?X(d,b):X(b,d)}function Ae(d,b){var w=d.length,D=new Array(w),P=s,R,k;for(k=0;k<w;k++)R=d[k]-P+b,b=Math.floor(R/P),D[k]=R-b*P,b+=1;for(;b>0;)D[k++]=b%P,b=Math.floor(b/P);return D}m.prototype.add=function(d){var b=de(d);if(this.sign!==b.sign)return this.subtract(b.negate());var w=this.value,D=b.value;return b.isSmall?new m(Ae(w,Math.abs(D)),this.sign):new m(Pe(w,D),this.sign)},m.prototype.plus=m.prototype.add,h.prototype.add=function(d){var b=de(d),w=this.value;if(w<0!==b.sign)return this.subtract(b.negate());var D=b.value;if(b.isSmall){if(M(w+D))return new h(w+D);D=H(Math.abs(D))}return new m(Ae(D,Math.abs(w)),w<0)},h.prototype.plus=h.prototype.add,I.prototype.add=function(d){return new I(this.value+de(d).value)},I.prototype.plus=I.prototype.add;function Ge(d,b){var w=d.length,D=b.length,P=new Array(w),R=0,k=s,C,F;for(C=0;C<D;C++)F=d[C]-R-b[C],F<0?(F+=k,R=1):R=0,P[C]=F;for(C=D;C<w;C++){if(F=d[C]-R,F<0)F+=k;else{P[C++]=F;break}P[C]=F}for(;C<w;C++)P[C]=d[C];return U(P),P}function Ze(d,b,w){var D;return Nt(d,b)>=0?D=Ge(d,b):(D=Ge(b,d),w=!w),D=$(D),typeof D=="number"?(w&&(D=-D),new h(D)):new m(D,w)}function st(d,b,w){var D=d.length,P=new Array(D),R=-b,k=s,C,F;for(C=0;C<D;C++)F=d[C]+R,R=Math.floor(F/k),F%=k,P[C]=F<0?F+k:F;return P=$(P),typeof P=="number"?(w&&(P=-P),new h(P)):new m(P,w)}m.prototype.subtract=function(d){var b=de(d);if(this.sign!==b.sign)return this.add(b.negate());var w=this.value,D=b.value;return b.isSmall?st(w,Math.abs(D),this.sign):Ze(w,D,this.sign)},m.prototype.minus=m.prototype.subtract,h.prototype.subtract=function(d){var b=de(d),w=this.value;if(w<0!==b.sign)return this.add(b.negate());var D=b.value;return b.isSmall?new h(w-D):st(D,Math.abs(w),w>=0)},h.prototype.minus=h.prototype.subtract,I.prototype.subtract=function(d){return new I(this.value-de(d).value)},I.prototype.minus=I.prototype.subtract,m.prototype.negate=function(){return new m(this.value,!this.sign)},h.prototype.negate=function(){var d=this.sign,b=new h(-this.value);return b.sign=!d,b},I.prototype.negate=function(){return new I(-this.value)},m.prototype.abs=function(){return new m(this.value,!1)},h.prototype.abs=function(){return new h(Math.abs(this.value))},I.prototype.abs=function(){return new I(this.value>=0?this.value:-this.value)};function ot(d,b){var w=d.length,D=b.length,P=w+D,R=he(P),k=s,C,F,ne,_e,ge;for(ne=0;ne<w;++ne){_e=d[ne];for(var ye=0;ye<D;++ye)ge=b[ye],C=_e*ge+R[ne+ye],F=Math.floor(C/k),R[ne+ye]=C-F*k,R[ne+ye+1]+=F}return U(R),R}function dt(d,b){var w=d.length,D=new Array(w),P=s,R=0,k,C;for(C=0;C<w;C++)k=d[C]*b+R,R=Math.floor(k/P),D[C]=k-R*P;for(;R>0;)D[C++]=R%P,R=Math.floor(R/P);return D}function Ce(d,b){for(var w=[];b-- >0;)w.push(0);return w.concat(d)}function Oe(d,b){var w=Math.max(d.length,b.length);if(w<=30)return ot(d,b);w=Math.ceil(w/2);var D=d.slice(w),P=d.slice(0,w),R=b.slice(w),k=b.slice(0,w),C=Oe(P,k),F=Oe(D,R),ne=Oe(Pe(P,D),Pe(k,R)),_e=Pe(Pe(C,Ce(Ge(Ge(ne,C),F),w)),Ce(F,2*w));return U(_e),_e}function mn(d,b){return-.012*d-.012*b+15e-6*d*b>0}m.prototype.multiply=function(d){var b=de(d),w=this.value,D=b.value,P=this.sign!==b.sign,R;if(b.isSmall){if(D===0)return p[0];if(D===1)return this;if(D===-1)return this.negate();if(R=Math.abs(D),R<s)return new m(dt(w,R),P);D=H(R)}return mn(w.length,D.length)?new m(Oe(w,D),P):new m(ot(w,D),P)},m.prototype.times=m.prototype.multiply;function it(d,b,w){return d<s?new m(dt(b,d),w):new m(ot(b,H(d)),w)}h.prototype._multiplyBySmall=function(d){return M(d.value*this.value)?new h(d.value*this.value):it(Math.abs(d.value),H(Math.abs(this.value)),this.sign!==d.sign)},m.prototype._multiplyBySmall=function(d){return d.value===0?p[0]:d.value===1?this:d.value===-1?this.negate():it(Math.abs(d.value),this.value,this.sign!==d.sign)},h.prototype.multiply=function(d){return de(d)._multiplyBySmall(this)},h.prototype.times=h.prototype.multiply,I.prototype.multiply=function(d){return new I(this.value*de(d).value)},I.prototype.times=I.prototype.multiply;function ht(d){var b=d.length,w=he(b+b),D=s,P,R,k,C,F;for(k=0;k<b;k++){C=d[k],R=0-C*C;for(var ne=k;ne<b;ne++)F=d[ne],P=2*(C*F)+w[k+ne]+R,R=Math.floor(P/D),w[k+ne]=P-R*D;w[k+b]=R}return U(w),w}m.prototype.square=function(){return new m(ht(this.value),!1)},h.prototype.square=function(){var d=this.value*this.value;return M(d)?new h(d):new m(ht(H(Math.abs(this.value))),!1)},I.prototype.square=function(d){return new I(this.value*this.value)};function Wn(d,b){var w=d.length,D=b.length,P=s,R=he(b.length),k=b[D-1],C=Math.ceil(P/(2*k)),F=dt(d,C),ne=dt(b,C),_e,ge,ye,et,De,Qt,Xe;for(F.length<=w&&F.push(0),ne.push(0),k=ne[D-1],ge=w-D;ge>=0;ge--){for(_e=P-1,F[ge+D]!==k&&(_e=Math.floor((F[ge+D]*P+F[ge+D-1])/k)),ye=0,et=0,Qt=ne.length,De=0;De<Qt;De++)ye+=_e*ne[De],Xe=Math.floor(ye/P),et+=F[ge+De]-(ye-Xe*P),ye=Xe,et<0?(F[ge+De]=et+P,et=-1):(F[ge+De]=et,et=0);for(;et!==0;){for(_e-=1,ye=0,De=0;De<Qt;De++)ye+=F[ge+De]-P+ne[De],ye<0?(F[ge+De]=ye+P,ye=0):(F[ge+De]=ye,ye=1);et+=ye}R[ge]=_e}return F=Dt(F,C)[0],[$(R),$(F)]}function Et(d,b){for(var w=d.length,D=b.length,P=[],R=[],k=s,C,F,ne,_e,ge;w;){if(R.unshift(d[--w]),U(R),Nt(R,b)<0){P.push(0);continue}F=R.length,ne=R[F-1]*k+R[F-2],_e=b[D-1]*k+b[D-2],F>D&&(ne=(ne+1)*k),C=Math.ceil(ne/_e);do{if(ge=dt(b,C),Nt(ge,R)<=0)break;C--}while(C);P.push(C),R=Ge(R,ge)}return P.reverse(),[$(P),$(R)]}function Dt(d,b){var w=d.length,D=he(w),P=s,R,k,C,F;for(C=0,R=w-1;R>=0;--R)F=C*P+d[R],k=ae(F/b),C=F-k*b,D[R]=k|0;return[D,C|0]}function xt(d,b){var w,D=de(b);if(y)return[new I(d.value/D.value),new I(d.value%D.value)];var P=d.value,R=D.value,k;if(R===0)throw new Error("Cannot divide by zero");if(d.isSmall)return D.isSmall?[new h(ae(P/R)),new h(P%R)]:[p[0],d];if(D.isSmall){if(R===1)return[d,p[0]];if(R==-1)return[d.negate(),p[0]];var C=Math.abs(R);if(C<s){w=Dt(P,C),k=$(w[0]);var F=w[1];return d.sign&&(F=-F),typeof k=="number"?(d.sign!==D.sign&&(k=-k),[new h(k),new h(F)]):[new m(k,d.sign!==D.sign),new h(F)]}R=H(C)}var ne=Nt(P,R);if(ne===-1)return[p[0],d];if(ne===0)return[p[d.sign===D.sign?1:-1],p[0]];P.length+R.length<=200?w=Wn(P,R):w=Et(P,R),k=w[0];var _e=d.sign!==D.sign,ge=w[1],ye=d.sign;return typeof k=="number"?(_e&&(k=-k),k=new h(k)):k=new m(k,_e),typeof ge=="number"?(ye&&(ge=-ge),ge=new h(ge)):ge=new m(ge,ye),[k,ge]}m.prototype.divmod=function(d){var b=xt(this,d);return{quotient:b[0],remainder:b[1]}},I.prototype.divmod=h.prototype.divmod=m.prototype.divmod,m.prototype.divide=function(d){return xt(this,d)[0]},I.prototype.over=I.prototype.divide=function(d){return new I(this.value/de(d).value)},h.prototype.over=h.prototype.divide=m.prototype.over=m.prototype.divide,m.prototype.mod=function(d){return xt(this,d)[1]},I.prototype.mod=I.prototype.remainder=function(d){return new I(this.value%de(d).value)},h.prototype.remainder=h.prototype.mod=m.prototype.remainder=m.prototype.mod,m.prototype.pow=function(d){var b=de(d),w=this.value,D=b.value,P,R,k;if(D===0)return p[1];if(w===0)return p[0];if(w===1)return p[1];if(w===-1)return b.isEven()?p[1]:p[-1];if(b.sign)return p[0];if(!b.isSmall)throw new Error("The exponent "+b.toString()+" is too large.");if(this.isSmall&&M(P=Math.pow(w,D)))return new h(ae(P));for(R=this,k=p[1];D&!0&&(k=k.times(R),--D),D!==0;)D/=2,R=R.square();return k},h.prototype.pow=m.prototype.pow,I.prototype.pow=function(d){var b=de(d),w=this.value,D=b.value,P=BigInt(0),R=BigInt(1),k=BigInt(2);if(D===P)return p[1];if(w===P)return p[0];if(w===R)return p[1];if(w===BigInt(-1))return b.isEven()?p[1]:p[-1];if(b.isNegative())return new I(P);for(var C=this,F=p[1];(D&R)===R&&(F=F.times(C),--D),D!==P;)D/=k,C=C.square();return F},m.prototype.modPow=function(d,b){if(d=de(d),b=de(b),b.isZero())throw new Error("Cannot take modPow with modulus 0");var w=p[1],D=this.mod(b);for(d.isNegative()&&(d=d.multiply(p[-1]),D=D.modInv(b));d.isPositive();){if(D.isZero())return p[0];d.isOdd()&&(w=w.multiply(D).mod(b)),d=d.divide(2),D=D.square().mod(b)}return w},I.prototype.modPow=h.prototype.modPow=m.prototype.modPow;function Nt(d,b){if(d.length!==b.length)return d.length>b.length?1:-1;for(var w=d.length-1;w>=0;w--)if(d[w]!==b[w])return d[w]>b[w]?1:-1;return 0}m.prototype.compareAbs=function(d){var b=de(d),w=this.value,D=b.value;return b.isSmall?1:Nt(w,D)},h.prototype.compareAbs=function(d){var b=de(d),w=Math.abs(this.value),D=b.value;return b.isSmall?(D=Math.abs(D),w===D?0:w>D?1:-1):-1},I.prototype.compareAbs=function(d){var b=this.value,w=de(d).value;return b=b>=0?b:-b,w=w>=0?w:-w,b===w?0:b>w?1:-1},m.prototype.compare=function(d){if(d===1/0)return-1;if(d===-1/0)return 1;var b=de(d),w=this.value,D=b.value;return this.sign!==b.sign?b.sign?1:-1:b.isSmall?this.sign?-1:1:Nt(w,D)*(this.sign?-1:1)},m.prototype.compareTo=m.prototype.compare,h.prototype.compare=function(d){if(d===1/0)return-1;if(d===-1/0)return 1;var b=de(d),w=this.value,D=b.value;return b.isSmall?w==D?0:w>D?1:-1:w<0!==b.sign?w<0?-1:1:w<0?1:-1},h.prototype.compareTo=h.prototype.compare,I.prototype.compare=function(d){if(d===1/0)return-1;if(d===-1/0)return 1;var b=this.value,w=de(d).value;return b===w?0:b>w?1:-1},I.prototype.compareTo=I.prototype.compare,m.prototype.equals=function(d){return this.compare(d)===0},I.prototype.eq=I.prototype.equals=h.prototype.eq=h.prototype.equals=m.prototype.eq=m.prototype.equals,m.prototype.notEquals=function(d){return this.compare(d)!==0},I.prototype.neq=I.prototype.notEquals=h.prototype.neq=h.prototype.notEquals=m.prototype.neq=m.prototype.notEquals,m.prototype.greater=function(d){return this.compare(d)>0},I.prototype.gt=I.prototype.greater=h.prototype.gt=h.prototype.greater=m.prototype.gt=m.prototype.greater,m.prototype.lesser=function(d){return this.compare(d)<0},I.prototype.lt=I.prototype.lesser=h.prototype.lt=h.prototype.lesser=m.prototype.lt=m.prototype.lesser,m.prototype.greaterOrEquals=function(d){return this.compare(d)>=0},I.prototype.geq=I.prototype.greaterOrEquals=h.prototype.geq=h.prototype.greaterOrEquals=m.prototype.geq=m.prototype.greaterOrEquals,m.prototype.lesserOrEquals=function(d){return this.compare(d)<=0},I.prototype.leq=I.prototype.lesserOrEquals=h.prototype.leq=h.prototype.lesserOrEquals=m.prototype.leq=m.prototype.lesserOrEquals,m.prototype.isEven=function(){return(this.value[0]&1)===0},h.prototype.isEven=function(){return(this.value&1)===0},I.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},m.prototype.isOdd=function(){return(this.value[0]&1)===1},h.prototype.isOdd=function(){return(this.value&1)===1},I.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},m.prototype.isPositive=function(){return!this.sign},h.prototype.isPositive=function(){return this.value>0},I.prototype.isPositive=h.prototype.isPositive,m.prototype.isNegative=function(){return this.sign},h.prototype.isNegative=function(){return this.value<0},I.prototype.isNegative=h.prototype.isNegative,m.prototype.isUnit=function(){return!1},h.prototype.isUnit=function(){return Math.abs(this.value)===1},I.prototype.isUnit=function(){return this.abs().value===BigInt(1)},m.prototype.isZero=function(){return!1},h.prototype.isZero=function(){return this.value===0},I.prototype.isZero=function(){return this.value===BigInt(0)},m.prototype.isDivisibleBy=function(d){var b=de(d);return b.isZero()?!1:b.isUnit()?!0:b.compareAbs(2)===0?this.isEven():this.mod(b).isZero()},I.prototype.isDivisibleBy=h.prototype.isDivisibleBy=m.prototype.isDivisibleBy;function gs(d){var b=d.abs();if(b.isUnit())return!1;if(b.equals(2)||b.equals(3)||b.equals(5))return!0;if(b.isEven()||b.isDivisibleBy(3)||b.isDivisibleBy(5))return!1;if(b.lesser(49))return!0}function Kn(d,b){for(var w=d.prev(),D=w,P=0,R,k,C;D.isEven();)D=D.divide(2),P++;e:for(k=0;k<b.length;k++)if(!d.lesser(b[k])&&(C=t(b[k]).modPow(D,d),!(C.isUnit()||C.equals(w)))){for(R=P-1;R!=0;R--){if(C=C.square().mod(d),C.isUnit())return!1;if(C.equals(w))continue e}return!1}return!0}m.prototype.isPrime=function(d){var b=gs(this);if(b!==e)return b;var w=this.abs(),D=w.bitLength();if(D<=64)return Kn(w,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var P=Math.log(2)*D.toJSNumber(),R=Math.ceil(d===!0?2*Math.pow(P,2):P),k=[],C=0;C<R;C++)k.push(t(C+2));return Kn(w,k)},I.prototype.isPrime=h.prototype.isPrime=m.prototype.isPrime,m.prototype.isProbablePrime=function(d,b){var w=gs(this);if(w!==e)return w;for(var D=this.abs(),P=d===e?5:d,R=[],k=0;k<P;k++)R.push(t.randBetween(2,D.minus(2),b));return Kn(D,R)},I.prototype.isProbablePrime=h.prototype.isProbablePrime=m.prototype.isProbablePrime,m.prototype.modInv=function(d){for(var b=t.zero,w=t.one,D=de(d),P=this.abs(),R,k,C;!P.isZero();)R=D.divide(P),k=b,C=D,b=w,D=P,w=k.subtract(R.multiply(w)),P=C.subtract(R.multiply(P));if(!D.isUnit())throw new Error(this.toString()+" and "+d.toString()+" are not co-prime");return b.compare(0)===-1&&(b=b.add(d)),this.isNegative()?b.negate():b},I.prototype.modInv=h.prototype.modInv=m.prototype.modInv,m.prototype.next=function(){var d=this.value;return this.sign?st(d,1,this.sign):new m(Ae(d,1),this.sign)},h.prototype.next=function(){var d=this.value;return d+1<a?new h(d+1):new m(c,!1)},I.prototype.next=function(){return new I(this.value+BigInt(1))},m.prototype.prev=function(){var d=this.value;return this.sign?new m(Ae(d,1),!0):st(d,1,this.sign)},h.prototype.prev=function(){var d=this.value;return d-1>-a?new h(d-1):new m(c,!0)},I.prototype.prev=function(){return new I(this.value-BigInt(1))};for(var mt=[1];2*mt[mt.length-1]<=s;)mt.push(2*mt[mt.length-1]);var qt=mt.length,$t=mt[qt-1];function ms(d){return Math.abs(d)<=s}m.prototype.shiftLeft=function(d){var b=de(d).toJSNumber();if(!ms(b))throw new Error(String(b)+" is too large for shifting.");if(b<0)return this.shiftRight(-b);var w=this;if(w.isZero())return w;for(;b>=qt;)w=w.multiply($t),b-=qt-1;return w.multiply(mt[b])},I.prototype.shiftLeft=h.prototype.shiftLeft=m.prototype.shiftLeft,m.prototype.shiftRight=function(d){var b,w=de(d).toJSNumber();if(!ms(w))throw new Error(String(w)+" is too large for shifting.");if(w<0)return this.shiftLeft(-w);for(var D=this;w>=qt;){if(D.isZero()||D.isNegative()&&D.isUnit())return D;b=xt(D,$t),D=b[1].isNegative()?b[0].prev():b[0],w-=qt-1}return b=xt(D,mt[w]),b[1].isNegative()?b[0].prev():b[0]},I.prototype.shiftRight=h.prototype.shiftRight=m.prototype.shiftRight;function yn(d,b,w){b=de(b);for(var D=d.isNegative(),P=b.isNegative(),R=D?d.not():d,k=P?b.not():b,C=0,F=0,ne=null,_e=null,ge=[];!R.isZero()||!k.isZero();)ne=xt(R,$t),C=ne[1].toJSNumber(),D&&(C=$t-1-C),_e=xt(k,$t),F=_e[1].toJSNumber(),P&&(F=$t-1-F),R=ne[0],k=_e[0],ge.push(w(C,F));for(var ye=w(D?1:0,P?1:0)!==0?t(-1):t(0),et=ge.length-1;et>=0;et-=1)ye=ye.multiply($t).add(t(ge[et]));return ye}m.prototype.not=function(){return this.negate().prev()},I.prototype.not=h.prototype.not=m.prototype.not,m.prototype.and=function(d){return yn(this,d,function(b,w){return b&w})},I.prototype.and=h.prototype.and=m.prototype.and,m.prototype.or=function(d){return yn(this,d,function(b,w){return b|w})},I.prototype.or=h.prototype.or=m.prototype.or,m.prototype.xor=function(d){return yn(this,d,function(b,w){return b^w})},I.prototype.xor=h.prototype.xor=m.prototype.xor;var be=1<<30,Xt=(s&-s)*(s&-s)|be;function yt(d){var b=d.value,w=typeof b=="number"?b|be:typeof b=="bigint"?b|BigInt(be):b[0]+b[1]*s|Xt;return w&-w}function Tt(d,b){if(b.compareTo(d)<=0){var w=Tt(d,b.square(b)),D=w.p,P=w.e,R=D.multiply(b);return R.compareTo(d)<=0?{p:R,e:P*2+1}:{p:D,e:P*2}}return{p:t(1),e:0}}m.prototype.bitLength=function(){var d=this;return d.compareTo(t(0))<0&&(d=d.negate().subtract(t(1))),d.compareTo(t(0))===0?t(0):t(Tt(d,t(2)).e).add(t(1))},I.prototype.bitLength=h.prototype.bitLength=m.prototype.bitLength;function Yn(d,b){return d=de(d),b=de(b),d.greater(b)?d:b}function On(d,b){return d=de(d),b=de(b),d.lesser(b)?d:b}function ys(d,b){if(d=de(d).abs(),b=de(b).abs(),d.equals(b))return d;if(d.isZero())return b;if(b.isZero())return d;for(var w=p[1],D,P;d.isEven()&&b.isEven();)D=On(yt(d),yt(b)),d=d.divide(D),b=b.divide(D),w=w.multiply(D);for(;d.isEven();)d=d.divide(yt(d));do{for(;b.isEven();)b=b.divide(yt(b));d.greater(b)&&(P=b,b=d,d=P),b=b.subtract(d)}while(!b.isZero());return w.isUnit()?d:d.multiply(w)}function qn(d,b){return d=de(d).abs(),b=de(b).abs(),d.divide(ys(d,b)).multiply(b)}function Xn(d,b,w){d=de(d),b=de(b);var D=w||Math.random,P=On(d,b),R=Yn(d,b),k=R.subtract(P).add(1);if(k.isSmall)return P.add(Math.floor(D()*k));for(var C=qe(k,s).value,F=[],ne=!0,_e=0;_e<C.length;_e++){var ge=ne?C[_e]+(_e+1<C.length?C[_e+1]/s:0):s,ye=ae(D()*ge);F.push(ye),ye<C[_e]&&(ne=!1)}return P.add(p.fromArray(F,s,!1))}var Jt=function(d,b,w,D){w=w||u,d=String(d),D||(d=d.toLowerCase(),w=w.toLowerCase());var P=d.length,R,k=Math.abs(b),C={};for(R=0;R<w.length;R++)C[w[R]]=R;for(R=0;R<P;R++){var F=d[R];if(F!=="-"&&F in C&&C[F]>=k){if(F==="1"&&k===1)continue;throw new Error(F+" is not a valid digit in base "+b+".")}}b=de(b);var ne=[],_e=d[0]==="-";for(R=_e?1:0;R<d.length;R++){var F=d[R];if(F in C)ne.push(de(C[F]));else if(F==="<"){var ge=R;do R++;while(d[R]!==">"&&R<d.length);ne.push(de(d.slice(ge+1,R)))}else throw new Error(F+" is not a valid character")}return Jn(ne,b,_e)};function Jn(d,b,w){var D=p[0],P=p[1],R;for(R=d.length-1;R>=0;R--)D=D.add(d[R].times(P)),P=P.times(b);return w?D.negate():D}function Dn(d,b){return b=b||u,d<b.length?b[d]:"<"+d+">"}function qe(d,b){if(b=t(b),b.isZero()){if(d.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(b.equals(-1)){if(d.isZero())return{value:[0],isNegative:!1};if(d.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-d.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var w=Array.apply(null,Array(d.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return w.unshift([1]),{value:[].concat.apply([],w),isNegative:!1}}var D=!1;if(d.isNegative()&&b.isPositive()&&(D=!0,d=d.abs()),b.isUnit())return d.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(d.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:D};for(var P=[],R=d,k;R.isNegative()||R.compareAbs(b)>=0;){k=R.divmod(b),R=k.quotient;var C=k.remainder;C.isNegative()&&(C=b.minus(C).abs(),R=R.next()),P.push(C.toJSNumber())}return P.push(R.toJSNumber()),{value:P.reverse(),isNegative:D}}function Vt(d,b,w){var D=qe(d,b);return(D.isNegative?"-":"")+D.value.map(function(P){return Dn(P,w)}).join("")}m.prototype.toArray=function(d){return qe(this,d)},h.prototype.toArray=function(d){return qe(this,d)},I.prototype.toArray=function(d){return qe(this,d)},m.prototype.toString=function(d,b){if(d===e&&(d=10),d!==10||b)return Vt(this,d,b);for(var w=this.value,D=w.length,P=String(w[--D]),R="0000000",k;--D>=0;)k=String(w[D]),P+=R.slice(k.length)+k;var C=this.sign?"-":"";return C+P},h.prototype.toString=function(d,b){return d===e&&(d=10),d!=10||b?Vt(this,d,b):String(this.value)},I.prototype.toString=h.prototype.toString,I.prototype.toJSON=m.prototype.toJSON=h.prototype.toJSON=function(){return this.toString()},m.prototype.valueOf=function(){return parseInt(this.toString(),10)},m.prototype.toJSNumber=m.prototype.valueOf,h.prototype.valueOf=function(){return this.value},h.prototype.toJSNumber=h.prototype.valueOf,I.prototype.valueOf=I.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function Qn(d){if(M(+d)){var b=+d;if(b===ae(b))return y?new I(BigInt(b)):new h(b);throw new Error("Invalid integer: "+d)}var w=d[0]==="-";w&&(d=d.slice(1));var D=d.split(/e/i);if(D.length>2)throw new Error("Invalid integer: "+D.join("e"));if(D.length===2){var P=D[1];if(P[0]==="+"&&(P=P.slice(1)),P=+P,P!==ae(P)||!M(P))throw new Error("Invalid integer: "+P+" is not a valid exponent.");var R=D[0],k=R.indexOf(".");if(k>=0&&(P-=R.length-k-1,R=R.slice(0,k)+R.slice(k+1)),P<0)throw new Error("Cannot include negative exponent part for integers");R+=new Array(P+1).join("0"),d=R}var C=/^([0-9][0-9]*)$/.test(d);if(!C)throw new Error("Invalid integer: "+d);if(y)return new I(BigInt(w?"-"+d:d));for(var F=[],ne=d.length,_e=r,ge=ne-_e;ne>0;)F.push(+d.slice(ge,ne)),ge-=_e,ge<0&&(ge=0),ne-=_e;return U(F),new m(F,w)}function vs(d){if(y)return new I(BigInt(d));if(M(d)){if(d!==ae(d))throw new Error(d+" is not an integer.");return new h(d)}return Qn(d.toString())}function de(d){return typeof d=="number"?vs(d):typeof d=="string"?Qn(d):typeof d=="bigint"?new I(d):d}for(var Rt=0;Rt<1e3;Rt++)p[Rt]=de(Rt),Rt>0&&(p[-Rt]=de(-Rt));return p.one=p[1],p.zero=p[0],p.minusOne=p[-1],p.max=Yn,p.min=On,p.gcd=ys,p.lcm=qn,p.isInstance=function(d){return d instanceof m||d instanceof h||d instanceof I},p.randBetween=Xn,p.fromArray=function(d,b,w){return Jn(d.map(de),de(b||10),w)},p}();n.hasOwnProperty("exports")&&(n.exports=t)})(ua);var Xo=ua.exports,da=wr(Xo);const ha=64,mr=16,$n=ha/mr;function Jo(){try{return!0}catch{return!1}}function Qo(n,t,e){let s=0;for(let r=0;r<e;r++){const a=n[t+r];if(a===void 0)break;s+=a*16**r}return s}function fa(n){const t=[];for(let e=0;e<n.length;e++){let s=Number(n[e]);for(let r=0;s||r<t.length;r++)s+=(t[r]||0)*10,t[r]=s%16,s=(s-t[r])/16}return t}function el(n){const t=fa(n),e=Array($n);for(let s=0;s<$n;s++)e[$n-1-s]=Qo(t,s*$n,$n);return e}class an{static fromString(t){return new an(el(t),t)}static fromBit(t){const e=Array($n),s=Math.floor(t/mr);for(let r=0;r<$n;r++)e[$n-1-r]=r===s?1<<t-s*mr:0;return new an(e)}constructor(t,e){this.parts=t,this.str=e}and({parts:t}){return new an(this.parts.map((e,s)=>e&t[s]))}or({parts:t}){return new an(this.parts.map((e,s)=>e|t[s]))}xor({parts:t}){return new an(this.parts.map((e,s)=>e^t[s]))}not(){return new an(this.parts.map(t=>~t))}equals({parts:t}){return this.parts.every((e,s)=>e===t[s])}toString(){if(this.str!=null)return this.str;const t=new Array(ha/4);return this.parts.forEach((e,s)=>{const r=fa(e.toString());for(let a=0;a<4;a++)t[a+s*4]=r[3-a]||0}),this.str=da.fromArray(t,16).toString()}toJSON(){return this.toString()}}const zn=Jo();zn&&BigInt.prototype.toJSON==null&&(BigInt.prototype.toJSON=function(){return this.toString()});const Ai={},pa=zn?function(t){return BigInt(t)}:function(t){return t instanceof an?t:(typeof t=="number"&&(t=t.toString()),Ai[t]!=null||(Ai[t]=an.fromString(t)),Ai[t])},at=pa(0),$i=zn?function(t=at,e=at){return t&e}:function(t=at,e=at){return t.and(e)},ga=zn?function(t=at,e=at){return t|e}:function(t=at,e=at){return t.or(e)},tl=zn?function(t=at,e=at){return t^e}:function(t=at,e=at){return t.xor(e)},nl=zn?function(t=at){return~t}:function(t=at){return t.not()},Dr=zn?function(t,e){return t===e}:function(t,e){return t==null||e==null?t==e:t.equals(e)};function sl(...n){let t=n[0];for(let e=1;e<n.length;e++)t=ga(t,n[e]);return t}function il(n,t){return Dr($i(n,t),t)}function rl(n,t){return!Dr($i(n,t),at)}function al(n,t){return t===at?n:ga(n,t)}function ol(n,t){return t===at?n:tl(n,$i(n,t))}const ll=zn?function(t){return BigInt(1)<<BigInt(t)}:function(t){return an.fromBit(t)};var Zr={combine:sl,add:al,remove:ol,filter:$i,invert:nl,has:il,hasAny:rl,equals:Dr,deserialize:pa,getFlag:ll},Hr;(function(n){n[n.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",n[n.CLOSE_UNSUPPORTED=1003]="CLOSE_UNSUPPORTED",n[n.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",n[n.INVALID_CLIENTID=4e3]="INVALID_CLIENTID",n[n.INVALID_ORIGIN=4001]="INVALID_ORIGIN",n[n.RATELIMITED=4002]="RATELIMITED",n[n.TOKEN_REVOKED=4003]="TOKEN_REVOKED",n[n.INVALID_VERSION=4004]="INVALID_VERSION",n[n.INVALID_ENCODING=4005]="INVALID_ENCODING"})(Hr||(Hr={}));var yr;(function(n){n[n.INVALID_PAYLOAD=4e3]="INVALID_PAYLOAD",n[n.INVALID_COMMAND=4002]="INVALID_COMMAND",n[n.INVALID_EVENT=4004]="INVALID_EVENT",n[n.INVALID_PERMISSIONS=4006]="INVALID_PERMISSIONS"})(yr||(yr={}));var vr;(function(n){n.LANDSCAPE="landscape",n.PORTRAIT="portrait"})(vr||(vr={}));var wn;(function(n){n.MOBILE="mobile",n.DESKTOP="desktop"})(wn||(wn={}));Object.freeze({CREATE_INSTANT_INVITE:Zr.getFlag(0),ADMINISTRATOR:Zr.getFlag(3)});function ut(n){return ca(t=>{var e;const[s]=(e=Object.entries(n).find(([,r])=>r===t))!==null&&e!==void 0?e:[];return t!=null&&s===void 0?n.UNHANDLED:t},A().or(ce()))}function cl(n){const t=Sr().transform(e=>{const s=n.safeParse(e);return s.success?s.data:n._def.defaultValue()});return t.overlayType=n,t}const ul=re.object({image_url:re.string()}),dl=re.object({mediaUrl:re.string().max(1024)}),hl=re.object({access_token:re.union([re.string(),re.null()]).optional()}),ma=re.object({access_token:re.string(),user:re.object({username:re.string(),discriminator:re.string(),id:re.string(),avatar:re.union([re.string(),re.null()]).optional(),public_flags:re.number(),global_name:re.union([re.string(),re.null()]).optional()}),scopes:re.array(cl(re.enum(["identify","email","connections","guilds","guilds.join","guilds.members.read","guilds.channels.read","gdm.join","bot","rpc","rpc.notifications.read","rpc.voice.read","rpc.voice.write","rpc.video.read","rpc.video.write","rpc.screenshare.read","rpc.screenshare.write","rpc.activities.write","webhook.incoming","messages.read","applications.builds.upload","applications.builds.read","applications.commands","applications.commands.permissions.update","applications.commands.update","applications.store.update","applications.entitlements","activities.read","activities.write","relationships.read","relationships.write","voice","dm_channels.read","role_connections.write","presences.read","presences.write","openid","dm_channels.messages.read","dm_channels.messages.write","gateway.connect","account.global_name.update","payment_sources.country_code","sdk.social_layer"]).or(re.literal(-1)).default(-1))),expires:re.string(),application:re.object({description:re.string(),icon:re.union([re.string(),re.null()]).optional(),id:re.string(),rpc_origins:re.array(re.string()).optional(),name:re.string()})}),ya=re.object({participants:re.array(re.object({id:re.string(),username:re.string(),global_name:re.union([re.string(),re.null()]).optional(),discriminator:re.string(),avatar:re.union([re.string(),re.null()]).optional(),flags:re.number(),bot:re.boolean(),avatar_decoration_data:re.union([re.object({asset:re.string(),skuId:re.string().optional()}),re.null()]).optional(),premium_type:re.union([re.number(),re.null()]).optional(),nickname:re.string().optional()}))});var on;(function(n){n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.AUTHENTICATE="AUTHENTICATE",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(on||(on={}));const fl=re.object({}).optional().nullable(),jr=re.void(),va={[on.INITIATE_IMAGE_UPLOAD]:{request:jr,response:ul},[on.OPEN_SHARE_MOMENT_DIALOG]:{request:dl,response:fl},[on.AUTHENTICATE]:{request:hl,response:ma},[on.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS]:{request:jr,response:ya}},pl="DISPATCH";var ue;(function(n){n.AUTHORIZE="AUTHORIZE",n.AUTHENTICATE="AUTHENTICATE",n.GET_GUILDS="GET_GUILDS",n.GET_GUILD="GET_GUILD",n.GET_CHANNEL="GET_CHANNEL",n.GET_CHANNELS="GET_CHANNELS",n.SELECT_VOICE_CHANNEL="SELECT_VOICE_CHANNEL",n.SELECT_TEXT_CHANNEL="SELECT_TEXT_CHANNEL",n.SUBSCRIBE="SUBSCRIBE",n.UNSUBSCRIBE="UNSUBSCRIBE",n.CAPTURE_SHORTCUT="CAPTURE_SHORTCUT",n.SET_CERTIFIED_DEVICES="SET_CERTIFIED_DEVICES",n.SET_ACTIVITY="SET_ACTIVITY",n.GET_SKUS="GET_SKUS",n.GET_ENTITLEMENTS="GET_ENTITLEMENTS",n.GET_SKUS_EMBEDDED="GET_SKUS_EMBEDDED",n.GET_ENTITLEMENTS_EMBEDDED="GET_ENTITLEMENTS_EMBEDDED",n.START_PURCHASE="START_PURCHASE",n.SET_CONFIG="SET_CONFIG",n.SEND_ANALYTICS_EVENT="SEND_ANALYTICS_EVENT",n.USER_SETTINGS_GET_LOCALE="USER_SETTINGS_GET_LOCALE",n.OPEN_EXTERNAL_LINK="OPEN_EXTERNAL_LINK",n.ENCOURAGE_HW_ACCELERATION="ENCOURAGE_HW_ACCELERATION",n.CAPTURE_LOG="CAPTURE_LOG",n.SET_ORIENTATION_LOCK_STATE="SET_ORIENTATION_LOCK_STATE",n.OPEN_INVITE_DIALOG="OPEN_INVITE_DIALOG",n.GET_PLATFORM_BEHAVIORS="GET_PLATFORM_BEHAVIORS",n.GET_CHANNEL_PERMISSIONS="GET_CHANNEL_PERMISSIONS",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(ue||(ue={}));const Ls=K({cmd:A(),data:ti(),evt:Ar(),nonce:A()}).passthrough(),gl=Object.assign(Object.assign({},ma.shape.scopes.element.overlayType._def.innerType.options[0].Values),{UNHANDLED:-1});ut(gl);const jn=K({id:A(),username:A(),discriminator:A(),global_name:A().optional().nullable(),avatar:A().optional().nullable(),avatar_decoration_data:K({asset:A(),sku_id:A().optional()}).nullable(),bot:me(),flags:ce().optional().nullable(),premium_type:ce().optional().nullable()}),xr=K({user:jn,nick:A().optional().nullable(),roles:Ne(A()),joined_at:A(),deaf:me(),mute:me()}),ml=K({user_id:A(),nick:A().optional().nullable(),guild_id:A(),avatar:A().optional().nullable(),avatar_decoration_data:K({asset:A(),sku_id:A().optional().nullable()}).optional().nullable(),color_string:A().optional().nullable()}),Nr=K({id:A(),name:A().optional().nullable(),roles:Ne(A()).optional().nullable(),user:jn.optional().nullable(),require_colons:me().optional().nullable(),managed:me().optional().nullable(),animated:me().optional().nullable(),available:me().optional().nullable()}),ba=K({mute:me(),deaf:me(),self_mute:me(),self_deaf:me(),suppress:me()}),_a=K({mute:me(),nick:A(),user:jn,voice_state:ba,volume:ce()}),yl={UNHANDLED:-1,IDLE:"idle",DND:"dnd",ONLINE:"online",OFFLINE:"offline"},Oi=ut(yl),Vs=K({name:A(),type:ce(),url:A().optional().nullable(),created_at:ce().optional().nullable(),timestamps:K({start:ce(),end:ce()}).partial().optional().nullable(),application_id:A().optional().nullable(),details:A().optional().nullable(),state:A().optional().nullable(),emoji:Nr.optional().nullable(),party:K({id:A().optional().nullable(),size:Ne(ce()).optional().nullable()}).optional().nullable(),assets:K({large_image:A().nullable(),large_text:A().nullable(),small_image:A().nullable(),small_text:A().nullable()}).partial().optional().nullable(),secrets:K({join:A(),match:A()}).partial().optional().nullable(),instance:me().optional().nullable(),flags:ce().optional().nullable()}),vl={UNHANDLED:-1,ROLE:0,MEMBER:1},bl=K({id:A(),type:ut(vl),allow:A(),deny:A()}),Rr={UNHANDLED:-1,DM:1,GROUP_DM:3,GUILD_TEXT:0,GUILD_VOICE:2,GUILD_CATEGORY:4,GUILD_ANNOUNCEMENT:5,GUILD_STORE:6,ANNOUNCEMENT_THREAD:10,PUBLIC_THREAD:11,PRIVATE_THREAD:12,GUILD_STAGE_VOICE:13,GUILD_DIRECTORY:14,GUILD_FORUM:15},Ea=K({id:A(),type:ut(Rr),guild_id:A().optional().nullable(),position:ce().optional().nullable(),permission_overwrites:Ne(bl).optional().nullable(),name:A().optional().nullable(),topic:A().optional().nullable(),nsfw:me().optional().nullable(),last_message_id:A().optional().nullable(),bitrate:ce().optional().nullable(),user_limit:ce().optional().nullable(),rate_limit_per_user:ce().optional().nullable(),recipients:Ne(jn).optional().nullable(),icon:A().optional().nullable(),owner_id:A().optional().nullable(),application_id:A().optional().nullable(),parent_id:A().optional().nullable(),last_pin_timestamp:A().optional().nullable()}),_l=K({user:jn,guild_id:A(),status:Oi,activities:Ne(Vs),client_status:K({desktop:Oi,mobile:Oi,web:Oi}).partial()}),El=K({id:A(),name:A(),color:ce(),hoist:me(),position:ce(),permissions:A(),managed:me(),mentionable:me()});K({id:A(),name:A(),owner_id:A(),icon:A().nullable(),icon_hash:A().optional().nullable(),splash:A().nullable(),discovery_splash:A().nullable(),owner:me().optional().nullable(),permissions:A().optional().nullable(),region:A(),afk_channel_id:A().nullable(),afk_timeout:ce(),widget_enabled:me().optional().nullable(),widget_channel_id:A().optional().nullable(),verification_level:ce(),default_message_notifications:ce(),explicit_content_filter:ce(),roles:Ne(El),emojis:Ne(Nr),features:Ne(A()),mfa_level:ce(),application_id:A().nullable(),system_channel_id:A().nullable(),system_channel_flags:ce(),rules_channel_id:A().nullable(),joined_at:A().optional().nullable(),large:me().optional().nullable(),unavailable:me().optional().nullable(),member_count:ce().optional().nullable(),voice_states:Ne(ba).optional().nullable(),members:Ne(xr).optional().nullable(),channels:Ne(Ea).optional().nullable(),presences:Ne(_l).optional().nullable(),max_presences:ce().optional().nullable(),max_members:ce().optional().nullable(),vanity_url_code:A().nullable(),description:A().nullable(),banner:A().nullable(),premium_tier:ce(),premium_subscription_count:ce().optional().nullable(),preferred_locale:A(),public_updates_channel_id:A().nullable(),max_video_channel_users:ce().optional().nullable(),approximate_member_count:ce().optional().nullable(),approximate_presence_count:ce().optional().nullable()});const Tl=K({id:A(),guild_id:A(),type:ce(),name:A()}),wl=K({id:A(),filename:A(),size:ce(),url:A(),proxy_url:A(),height:ce().optional().nullable(),width:ce().optional().nullable()}),Il=K({text:A(),icon_url:A().optional().nullable(),proxy_icon_url:A().optional().nullable()}),br=K({url:A().optional().nullable(),proxy_url:A().optional().nullable(),height:ce().optional().nullable(),width:ce().optional().nullable()}),Sl=br.omit({proxy_url:!0}),Al=K({name:A().optional().nullable(),url:A().optional().nullable()}),Ol=K({name:A().optional().nullable(),url:A().optional().nullable(),icon_url:A().optional().nullable(),proxy_icon_url:A().optional().nullable()}),Dl=K({name:A(),value:A(),inline:me()}),xl=K({title:A().optional().nullable(),type:A().optional().nullable(),description:A().optional().nullable(),url:A().optional().nullable(),timestamp:A().optional().nullable(),color:ce().optional().nullable(),footer:Il.optional().nullable(),image:br.optional().nullable(),thumbnail:br.optional().nullable(),video:Sl.optional().nullable(),provider:Al.optional().nullable(),author:Ol.optional().nullable(),fields:Ne(Dl).optional().nullable()}),Nl=K({count:ce(),me:me(),emoji:Nr}),Rl=K({type:ce(),party_id:A().optional().nullable()}),Pl=K({id:A(),cover_image:A().optional().nullable(),description:A(),icon:A().optional().nullable(),name:A()}),Ll=K({message_id:A().optional().nullable(),channel_id:A().optional().nullable(),guild_id:A().optional().nullable()}),kl=K({id:A(),channel_id:A(),guild_id:A().optional().nullable(),author:jn.optional().nullable(),member:xr.optional().nullable(),content:A(),timestamp:A(),edited_timestamp:A().optional().nullable(),tts:me(),mention_everyone:me(),mentions:Ne(jn),mention_roles:Ne(A()),mention_channels:Ne(Tl),attachments:Ne(wl),embeds:Ne(xl),reactions:Ne(Nl).optional().nullable(),nonce:Or([A(),ce()]).optional().nullable(),pinned:me(),webhook_id:A().optional().nullable(),type:ce(),activity:Rl.optional().nullable(),application:Pl.optional().nullable(),message_reference:Ll.optional().nullable(),flags:ce().optional().nullable(),stickers:Ne(ti()).optional().nullable(),referenced_message:ti().optional().nullable()}),Bl=K({id:A(),name:A()}),Cl={UNHANDLED:-1,KEYBOARD_KEY:0,MOUSE_BUTTON:1,KEYBOARD_MODIFIER_KEY:2,GAMEPAD_BUTTON:3},Ta=K({type:ut(Cl),code:ce(),name:A()}),Ml={UNHANDLED:-1,PUSH_TO_TALK:"PUSH_TO_TALK",VOICE_ACTIVITY:"VOICE_ACTIVITY"},Ul=K({type:ut(Ml),auto_threshold:me(),threshold:ce(),shortcut:Ne(Ta),delay:ce()}),zr=K({device_id:A(),volume:ce(),available_devices:Ne(Bl)}),$l={UNHANDLED:-1,AUDIO_INPUT:"AUDIO_INPUT",AUDIO_OUTPUT:"AUDIO_OUTPUT",VIDEO_INPUT:"VIDEO_INPUT"};K({type:ut($l),id:A(),vendor:K({name:A(),url:A()}),model:K({name:A(),url:A()}),related:Ne(A()),echo_cancellation:me().optional().nullable(),noise_suppression:me().optional().nullable(),automatic_gain_control:me().optional().nullable(),hardware_mute:me().optional().nullable()});const Vl={UNHANDLED:-1,APPLICATION:1,DLC:2,CONSUMABLE:3,BUNDLE:4,SUBSCRIPTION:5},Fl=K({id:A(),name:A(),type:ut(Vl),price:K({amount:ce(),currency:A()}),application_id:A(),flags:ce(),release_date:A().nullable()}),Gl={UNHANDLED:-1,PURCHASE:1,PREMIUM_SUBSCRIPTION:2,DEVELOPER_GIFT:3,TEST_MODE_PURCHASE:4,FREE_PURCHASE:5,USER_GIFT:6,PREMIUM_PURCHASE:7},Pr=K({id:A(),sku_id:A(),application_id:A(),user_id:A(),gift_code_flags:ce(),type:ut(Gl),gifter_user_id:A().optional().nullable(),branches:Ne(A()).optional().nullable(),starts_at:A().optional().nullable(),ends_at:A().optional().nullable(),parent_id:A().optional().nullable(),consumed:me().optional().nullable(),deleted:me().optional().nullable(),gift_code_batch_id:A().optional().nullable()}),Zl={UNHANDLED:-1,UNLOCKED:1,PORTRAIT:2,LANDSCAPE:3};ut(Zl);const Hl={UNHANDLED:-1,NOMINAL:0,FAIR:1,SERIOUS:2,CRITICAL:3},jl=ut(Hl),wa={UNHANDLED:-1,PORTRAIT:0,LANDSCAPE:1};ut(wa);const Ia={UNHANDLED:-1,FOCUSED:0,PIP:1,GRID:2};ut(Ia);const Lr="ERROR";var Le;(function(n){n.READY="READY",n.VOICE_STATE_UPDATE="VOICE_STATE_UPDATE",n.SPEAKING_START="SPEAKING_START",n.SPEAKING_STOP="SPEAKING_STOP",n.ACTIVITY_LAYOUT_MODE_UPDATE="ACTIVITY_LAYOUT_MODE_UPDATE",n.ORIENTATION_UPDATE="ORIENTATION_UPDATE",n.CURRENT_USER_UPDATE="CURRENT_USER_UPDATE",n.CURRENT_GUILD_MEMBER_UPDATE="CURRENT_GUILD_MEMBER_UPDATE",n.ENTITLEMENT_CREATE="ENTITLEMENT_CREATE",n.THERMAL_STATE_UPDATE="THERMAL_STATE_UPDATE",n.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE="ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE"})(Le||(Le={}));const St=Ls.extend({evt:Ps(Le),nonce:A().nullable(),cmd:Qe(pl),data:K({}).passthrough()}),Sa=Ls.extend({evt:Qe(Lr),data:K({code:ce(),message:A().optional()}).passthrough(),cmd:Ps(ue),nonce:A().nullable()}),zl=St.extend({evt:A()}),Wl=Or([St,zl,Sa]);function Kl(n){const t=n.evt;if(!(t in Le))throw new Error(`Unrecognized event type ${n.evt}`);return Yl[t].payload.parse(n)}const Yl={[Le.READY]:{payload:St.extend({evt:Qe(Le.READY),data:K({v:ce(),config:K({cdn_host:A().optional(),api_endpoint:A(),environment:A()}),user:K({id:A(),username:A(),discriminator:A(),avatar:A().optional()}).optional()})})},[Le.VOICE_STATE_UPDATE]:{payload:St.extend({evt:Qe(Le.VOICE_STATE_UPDATE),data:_a}),subscribeArgs:K({channel_id:A()})},[Le.SPEAKING_START]:{payload:St.extend({evt:Qe(Le.SPEAKING_START),data:K({lobby_id:A().optional(),channel_id:A().optional(),user_id:A()})}),subscribeArgs:K({lobby_id:A().nullable().optional(),channel_id:A().nullable().optional()})},[Le.SPEAKING_STOP]:{payload:St.extend({evt:Qe(Le.SPEAKING_STOP),data:K({lobby_id:A().optional(),channel_id:A().optional(),user_id:A()})}),subscribeArgs:K({lobby_id:A().nullable().optional(),channel_id:A().nullable().optional()})},[Le.ACTIVITY_LAYOUT_MODE_UPDATE]:{payload:St.extend({evt:Qe(Le.ACTIVITY_LAYOUT_MODE_UPDATE),data:K({layout_mode:ut(Ia)})})},[Le.ORIENTATION_UPDATE]:{payload:St.extend({evt:Qe(Le.ORIENTATION_UPDATE),data:K({screen_orientation:ut(wa),orientation:Ps(vr)})})},[Le.CURRENT_USER_UPDATE]:{payload:St.extend({evt:Qe(Le.CURRENT_USER_UPDATE),data:jn})},[Le.CURRENT_GUILD_MEMBER_UPDATE]:{payload:St.extend({evt:Qe(Le.CURRENT_GUILD_MEMBER_UPDATE),data:ml}),subscribeArgs:K({guild_id:A()})},[Le.ENTITLEMENT_CREATE]:{payload:St.extend({evt:Qe(Le.ENTITLEMENT_CREATE),data:K({entitlement:Pr})})},[Le.THERMAL_STATE_UPDATE]:{payload:St.extend({evt:Qe(Le.THERMAL_STATE_UPDATE),data:K({thermal_state:jl})})},[Le.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE]:{payload:St.extend({evt:Qe(Le.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE),data:K({participants:ya.shape.participants})})}};function ql(n,t){throw t}const ii=K({}).nullable(),Aa=K({code:A()}),Xl=K({guilds:Ne(K({id:A(),name:A()}))}),Jl=K({id:A(),name:A(),icon_url:A().optional(),members:Ne(xr)}),Rs=K({id:A(),type:ut(Rr),guild_id:A().optional().nullable(),name:A().optional().nullable(),topic:A().optional().nullable(),bitrate:ce().optional().nullable(),user_limit:ce().optional().nullable(),position:ce().optional().nullable(),voice_states:Ne(_a),messages:Ne(kl)}),Ql=K({channels:Ne(Ea)});Rs.nullable();const ec=Rs.nullable(),tc=Rs.nullable();K({input:zr,output:zr,mode:Ul,automatic_gain_control:me(),echo_cancellation:me(),noise_suppression:me(),qos:me(),silence_warning:me(),deaf:me(),mute:me()});const nc=K({evt:A()}),sc=K({shortcut:Ta}),Oa=Vs,Da=K({skus:Ne(Fl)}),xa=K({entitlements:Ne(Pr)}),Na=Ne(Pr).nullable(),Ra=K({use_interactive_pip:me()}),Pa=K({locale:A()}),La=K({enabled:me()}),ka=K({permissions:oa().or(A())}),Ba=K({iosKeyboardResizesView:la(me())}),ic=Ls.extend({cmd:Ps(ue),evt:Ar()});function rc({cmd:n,data:t}){switch(n){case ue.AUTHORIZE:return Aa.parse(t);case ue.CAPTURE_SHORTCUT:return sc.parse(t);case ue.ENCOURAGE_HW_ACCELERATION:return La.parse(t);case ue.GET_CHANNEL:return Rs.parse(t);case ue.GET_CHANNELS:return Ql.parse(t);case ue.GET_CHANNEL_PERMISSIONS:return ka.parse(t);case ue.GET_GUILD:return Jl.parse(t);case ue.GET_GUILDS:return Xl.parse(t);case ue.GET_PLATFORM_BEHAVIORS:return Ba.parse(t);case ue.GET_CHANNEL:return Rs.parse(t);case ue.SELECT_TEXT_CHANNEL:return tc.parse(t);case ue.SELECT_VOICE_CHANNEL:return ec.parse(t);case ue.SET_ACTIVITY:return Oa.parse(t);case ue.GET_SKUS_EMBEDDED:return Da.parse(t);case ue.GET_ENTITLEMENTS_EMBEDDED:return xa.parse(t);case ue.SET_CONFIG:return Ra.parse(t);case ue.START_PURCHASE:return Na.parse(t);case ue.SUBSCRIBE:case ue.UNSUBSCRIBE:return nc.parse(t);case ue.USER_SETTINGS_GET_LOCALE:return Pa.parse(t);case ue.OPEN_EXTERNAL_LINK:case ue.SET_ORIENTATION_LOCK_STATE:case ue.SET_CERTIFIED_DEVICES:case ue.SEND_ANALYTICS_EVENT:case ue.OPEN_INVITE_DIALOG:case ue.CAPTURE_LOG:case ue.GET_SKUS:case ue.GET_ENTITLEMENTS:return ii.parse(t);case ue.AUTHENTICATE:case ue.INITIATE_IMAGE_UPLOAD:case ue.OPEN_SHARE_MOMENT_DIALOG:case ue.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS:const{response:e}=va[n];return e.parse(t);default:ql(n,new Error(`Unrecognized command ${n}`))}}function ac(n){return Object.assign(Object.assign({},n),{data:rc(n)})}K({frame_id:A(),platform:Ps(wn).optional().nullable()});K({v:Qe(1),encoding:Qe("json").optional(),client_id:A(),frame_id:A()});const oc=K({code:ce(),message:A().optional()}),lc=K({evt:A().nullable(),nonce:A().nullable(),data:ti().nullable(),cmd:A()}).passthrough();function cc(n){const t=lc.parse(n);return t.evt!=null?t.evt===Lr?Sa.parse(t):Kl(Wl.parse(t)):ac(ic.passthrough().parse(t))}function _t(n,t,e,s=()=>{}){const r=Ls.extend({cmd:Qe(t),data:e});return async a=>{const c=await n({cmd:t,args:a,transfer:s(a)});return r.parse(c).data}}function Vi(n,t=()=>{}){const e=va[n].response,s=Ls.extend({cmd:Qe(n),data:e});return r=>async a=>{const c=await r({cmd:n,args:a,transfer:t(a)});return s.parse(c).data}}const uc=Vi(on.AUTHENTICATE),dc=n=>_t(n,ue.AUTHORIZE,Aa),hc=n=>_t(n,ue.CAPTURE_LOG,ii),fc=n=>_t(n,ue.ENCOURAGE_HW_ACCELERATION,La),pc=n=>_t(n,ue.GET_ENTITLEMENTS_EMBEDDED,xa),gc=n=>_t(n,ue.GET_SKUS_EMBEDDED,Da),mc=n=>_t(n,ue.GET_CHANNEL_PERMISSIONS,ka),yc=n=>_t(n,ue.GET_PLATFORM_BEHAVIORS,Ba),vc=n=>_t(n,ue.OPEN_EXTERNAL_LINK,ii),bc=n=>_t(n,ue.OPEN_INVITE_DIALOG,ii),_c=Vi(on.OPEN_SHARE_MOMENT_DIALOG);Vs.pick({state:!0,details:!0,timestamps:!0,assets:!0,party:!0,secrets:!0,instance:!0,type:!0}).extend({type:Vs.shape.type.optional(),instance:Vs.shape.instance.optional()}).nullable();const Ec=n=>_t(n,ue.SET_ACTIVITY,Oa),Tc=n=>_t(n,ue.SET_CONFIG,Ra);function wc({sendCommand:n,cmd:t,response:e,fallbackTransform:s,transferTransform:r=()=>{}}){const a=Ls.extend({cmd:Qe(t),data:e});return async c=>{try{const u=await n({cmd:t,args:c,transfer:r(c)});return a.parse(u).data}catch(u){if(u.code===yr.INVALID_PAYLOAD){const y=s(c),p=await n({cmd:t,args:y,transfer:r(y)});return a.parse(p).data}else throw u}}}const Ic=n=>({lock_state:n.lock_state,picture_in_picture_lock_state:n.picture_in_picture_lock_state}),Sc=n=>wc({sendCommand:n,cmd:ue.SET_ORIENTATION_LOCK_STATE,response:ii,fallbackTransform:Ic}),Ac=n=>_t(n,ue.START_PURCHASE,Na),Oc=n=>_t(n,ue.USER_SETTINGS_GET_LOCALE,Pa),Dc=Vi(on.INITIATE_IMAGE_UPLOAD),xc=n=>_t(n,ue.GET_CHANNEL,Rs),Nc=Vi(on.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS);function Rc(n){return{authenticate:uc(n),authorize:dc(n),captureLog:hc(n),encourageHardwareAcceleration:fc(n),getChannel:xc(n),getChannelPermissions:mc(n),getEntitlements:pc(n),getPlatformBehaviors:yc(n),getSkus:gc(n),openExternalLink:vc(n),openInviteDialog:bc(n),openShareMomentDialog:_c(n),setActivity:Ec(n),setConfig:Tc(n),setOrientationLockState:Sc(n),startPurchase:Ac(n),userSettingsGetLocale:Oc(n),initiateImageUpload:Dc(n),getInstanceConnectedParticipants:Nc(n)}}class Pc extends Error{constructor(t,e=""){super(e),this.code=t,this.message=e,this.name="Discord SDK Error"}}function Ca(){return{disableConsoleLogOverride:!1}}const Lc=["log","warn","debug","info","error"];function kc(n,t,e){const s=n[t],r=n;s&&(n[t]=function(){const a=[].slice.call(arguments),c=""+a.join(" ");e(t,c),s.apply(r,a)})}var Bc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Wr={randomUUID:Bc},Di,Cc=new Uint8Array(16);function Mc(){if(!Di&&(Di=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Di))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Di(Cc)}var rt=[];for(var sr=0;sr<256;++sr)rt.push((sr+256).toString(16).slice(1));function Uc(n,t=0){return(rt[n[t+0]]+rt[n[t+1]]+rt[n[t+2]]+rt[n[t+3]]+"-"+rt[n[t+4]]+rt[n[t+5]]+"-"+rt[n[t+6]]+rt[n[t+7]]+"-"+rt[n[t+8]]+rt[n[t+9]]+"-"+rt[n[t+10]]+rt[n[t+11]]+rt[n[t+12]]+rt[n[t+13]]+rt[n[t+14]]+rt[n[t+15]]).toLowerCase()}function Kr(n,t,e){if(Wr.randomUUID&&!t&&!n)return Wr.randomUUID();n=n||{};var s=n.random||(n.rng||Mc)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Uc(s)}var Tn;(function(n){n[n.HANDSHAKE=0]="HANDSHAKE",n[n.FRAME=1]="FRAME",n[n.CLOSE=2]="CLOSE",n[n.HELLO=3]="HELLO"})(Tn||(Tn={}));const $c=new Set(Vc());function Vc(){return typeof window>"u"?[]:[window.location.origin,"https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]}function Fc(){var n;return[(n=window.parent.opener)!==null&&n!==void 0?n:window.parent,document.referrer?document.referrer:"*"]}class Gc{getTransfer(t){var e;switch(t.cmd){case ue.SUBSCRIBE:case ue.UNSUBSCRIBE:return;default:return(e=t.transfer)!==null&&e!==void 0?e:void 0}}constructor(t,e){if(this.source=null,this.sourceOrigin="",this.eventBus=new ea,this.pendingCommands=new Map,this.sendCommand=u=>{var y;if(this.source==null)throw new Error("Attempting to send message before initialization");const p=Kr();return(y=this.source)===null||y===void 0||y.postMessage([Tn.FRAME,Object.assign(Object.assign({},u),{nonce:p})],this.sourceOrigin,this.getTransfer(u)),new Promise((h,I)=>{this.pendingCommands.set(p,{resolve:h,reject:I})})},this.commands=Rc(this.sendCommand),this.handleMessage=u=>{if(!$c.has(u.origin))return;const y=u.data;if(!Array.isArray(y))return;const[p,m]=y;switch(p){case Tn.HELLO:return;case Tn.CLOSE:return this.handleClose(m);case Tn.HANDSHAKE:return this.handleHandshake();case Tn.FRAME:return this.handleFrame(m);default:throw new Error("Invalid message format")}},this.isReady=!1,this.clientId=t,this.configuration=e??Ca(),typeof window<"u"&&window.addEventListener("message",this.handleMessage),typeof window>"u"){this.frameId="",this.instanceId="",this.platform=wn.DESKTOP,this.guildId=null,this.channelId=null;return}const s=new URLSearchParams(this._getSearch()),r=s.get("frame_id");if(!r)throw new Error("frame_id query param is not defined");this.frameId=r;const a=s.get("instance_id");if(!a)throw new Error("instance_id query param is not defined");this.instanceId=a;const c=s.get("platform");if(c){if(c!==wn.DESKTOP&&c!==wn.MOBILE)throw new Error(`Invalid query param "platform" of "${c}". Valid values are "${wn.DESKTOP}" or "${wn.MOBILE}"`)}else throw new Error("platform query param is not defined");this.platform=c,this.guildId=s.get("guild_id"),this.channelId=s.get("channel_id"),[this.source,this.sourceOrigin]=Fc(),this.addOnReadyListener(),this.handshake()}close(t,e){var s;window.removeEventListener("message",this.handleMessage);const r=Kr();(s=this.source)===null||s===void 0||s.postMessage([Tn.CLOSE,{code:t,message:e,nonce:r}],this.sourceOrigin)}async subscribe(t,e,...s){const[r]=s,a=this.eventBus.listenerCount(t),c=this.eventBus.on(t,e);return Object.values(Le).includes(t)&&t!==Le.READY&&a===0&&await this.sendCommand({cmd:ue.SUBSCRIBE,args:r,evt:t}),c}async unsubscribe(t,e,...s){const[r]=s;return t!==Le.READY&&this.eventBus.listenerCount(t)===1&&await this.sendCommand({cmd:ue.UNSUBSCRIBE,evt:t,args:r}),this.eventBus.off(t,e)}async ready(){this.isReady||await new Promise(t=>{this.eventBus.once(Le.READY,t)})}handshake(){var t;(t=this.source)===null||t===void 0||t.postMessage([Tn.HANDSHAKE,{v:1,encoding:"json",client_id:this.clientId,frame_id:this.frameId}],this.sourceOrigin)}addOnReadyListener(){this.eventBus.once(Le.READY,()=>{this.overrideConsoleLogging(),this.isReady=!0})}overrideConsoleLogging(){if(this.configuration.disableConsoleLogOverride)return;const t=(e,s)=>{this.commands.captureLog({level:e,message:s})};Lc.forEach(e=>{kc(console,e,t)})}handleClose(t){oc.parse(t)}handleHandshake(){}handleFrame(t){var e,s;let r;try{r=cc(t)}catch(a){console.error("Failed to parse",t),console.error(a);return}if(r.cmd==="DISPATCH")this.eventBus.emit(r.evt,r.data);else{if(r.evt===Lr){if(r.nonce!=null){(e=this.pendingCommands.get(r.nonce))===null||e===void 0||e.reject(r.data),this.pendingCommands.delete(r.nonce);return}this.eventBus.emit("error",new Pc(r.data.code,r.data.message))}if(r.nonce==null){console.error("Missing nonce",t);return}(s=this.pendingCommands.get(r.nonce))===null||s===void 0||s.resolve(r),this.pendingCommands.delete(r.nonce)}}_getSearch(){return typeof window>"u"?"":window.location.search}}var ks=1e9,Zc={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Ga,$e=!0,Ut="[DecimalError] ",ds=Ut+"Invalid argument: ",kr=Ut+"Exponent out of range: ",Bs=Math.floor,cs=Math.pow,Hc=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,At,nt=1e7,Ue=7,Ma=9007199254740991,Ci=Bs(Ma/Ue),ee={};ee.absoluteValue=ee.abs=function(){var n=new this.constructor(this);return n.s&&(n.s=1),n};ee.comparedTo=ee.cmp=function(n){var t,e,s,r,a=this;if(n=new a.constructor(n),a.s!==n.s)return a.s||-n.s;if(a.e!==n.e)return a.e>n.e^a.s<0?1:-1;for(s=a.d.length,r=n.d.length,t=0,e=s<r?s:r;t<e;++t)if(a.d[t]!==n.d[t])return a.d[t]>n.d[t]^a.s<0?1:-1;return s===r?0:s>r^a.s<0?1:-1};ee.decimalPlaces=ee.dp=function(){var n=this,t=n.d.length-1,e=(t-n.e)*Ue;if(t=n.d[t],t)for(;t%10==0;t/=10)e--;return e<0?0:e};ee.dividedBy=ee.div=function(n){return Sn(this,new this.constructor(n))};ee.dividedToIntegerBy=ee.idiv=function(n){var t=this,e=t.constructor;return Me(Sn(t,new e(n),0,1),e.precision)};ee.equals=ee.eq=function(n){return!this.cmp(n)};ee.exponent=function(){return Ye(this)};ee.greaterThan=ee.gt=function(n){return this.cmp(n)>0};ee.greaterThanOrEqualTo=ee.gte=function(n){return this.cmp(n)>=0};ee.isInteger=ee.isint=function(){return this.e>this.d.length-2};ee.isNegative=ee.isneg=function(){return this.s<0};ee.isPositive=ee.ispos=function(){return this.s>0};ee.isZero=function(){return this.s===0};ee.lessThan=ee.lt=function(n){return this.cmp(n)<0};ee.lessThanOrEqualTo=ee.lte=function(n){return this.cmp(n)<1};ee.logarithm=ee.log=function(n){var t,e=this,s=e.constructor,r=s.precision,a=r+5;if(n===void 0)n=new s(10);else if(n=new s(n),n.s<1||n.eq(At))throw Error(Ut+"NaN");if(e.s<1)throw Error(Ut+(e.s?"NaN":"-Infinity"));return e.eq(At)?new s(0):($e=!1,t=Sn(ni(e,a),ni(n,a),a),$e=!0,Me(t,r))};ee.minus=ee.sub=function(n){var t=this;return n=new t.constructor(n),t.s==n.s?Va(t,n):Ua(t,(n.s=-n.s,n))};ee.modulo=ee.mod=function(n){var t,e=this,s=e.constructor,r=s.precision;if(n=new s(n),!n.s)throw Error(Ut+"NaN");return e.s?($e=!1,t=Sn(e,n,0,1).times(n),$e=!0,e.minus(t)):Me(new s(e),r)};ee.naturalExponential=ee.exp=function(){return $a(this)};ee.naturalLogarithm=ee.ln=function(){return ni(this)};ee.negated=ee.neg=function(){var n=new this.constructor(this);return n.s=-n.s||0,n};ee.plus=ee.add=function(n){var t=this;return n=new t.constructor(n),t.s==n.s?Ua(t,n):Va(t,(n.s=-n.s,n))};ee.precision=ee.sd=function(n){var t,e,s,r=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(ds+n);if(t=Ye(r)+1,s=r.d.length-1,e=s*Ue+1,s=r.d[s],s){for(;s%10==0;s/=10)e--;for(s=r.d[0];s>=10;s/=10)e++}return n&&t>e?t:e};ee.squareRoot=ee.sqrt=function(){var n,t,e,s,r,a,c,u=this,y=u.constructor;if(u.s<1){if(!u.s)return new y(0);throw Error(Ut+"NaN")}for(n=Ye(u),$e=!1,r=Math.sqrt(+u),r==0||r==1/0?(t=ln(u.d),(t.length+n)%2==0&&(t+="0"),r=Math.sqrt(t),n=Bs((n+1)/2)-(n<0||n%2),r==1/0?t="5e"+n:(t=r.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),s=new y(t)):s=new y(r.toString()),e=y.precision,r=c=e+3;;)if(a=s,s=a.plus(Sn(u,a,c+2)).times(.5),ln(a.d).slice(0,c)===(t=ln(s.d)).slice(0,c)){if(t=t.slice(c-3,c+1),r==c&&t=="4999"){if(Me(a,e+1,0),a.times(a).eq(u)){s=a;break}}else if(t!="9999")break;c+=4}return $e=!0,Me(s,e)};ee.times=ee.mul=function(n){var t,e,s,r,a,c,u,y,p,m=this,h=m.constructor,I=m.d,M=(n=new h(n)).d;if(!m.s||!n.s)return new h(0);for(n.s*=m.s,e=m.e+n.e,y=I.length,p=M.length,y<p&&(a=I,I=M,M=a,c=y,y=p,p=c),a=[],c=y+p,s=c;s--;)a.push(0);for(s=p;--s>=0;){for(t=0,r=y+s;r>s;)u=a[r]+M[s]*I[r-s-1]+t,a[r--]=u%nt|0,t=u/nt|0;a[r]=(a[r]+t)%nt|0}for(;!a[--c];)a.pop();return t?++e:a.shift(),n.d=a,n.e=e,$e?Me(n,h.precision):n};ee.toDecimalPlaces=ee.todp=function(n,t){var e=this,s=e.constructor;return e=new s(e),n===void 0?e:(fn(n,0,ks),t===void 0?t=s.rounding:fn(t,0,8),Me(e,n+Ye(e)+1,t))};ee.toExponential=function(n,t){var e,s=this,r=s.constructor;return n===void 0?e=ps(s,!0):(fn(n,0,ks),t===void 0?t=r.rounding:fn(t,0,8),s=Me(new r(s),n+1,t),e=ps(s,!0,n+1)),e};ee.toFixed=function(n,t){var e,s,r=this,a=r.constructor;return n===void 0?ps(r):(fn(n,0,ks),t===void 0?t=a.rounding:fn(t,0,8),s=Me(new a(r),n+Ye(r)+1,t),e=ps(s.abs(),!1,n+Ye(s)+1),r.isneg()&&!r.isZero()?"-"+e:e)};ee.toInteger=ee.toint=function(){var n=this,t=n.constructor;return Me(new t(n),Ye(n)+1,t.rounding)};ee.toNumber=function(){return+this};ee.toPower=ee.pow=function(n){var t,e,s,r,a,c,u=this,y=u.constructor,p=12,m=+(n=new y(n));if(!n.s)return new y(At);if(u=new y(u),!u.s){if(n.s<1)throw Error(Ut+"Infinity");return u}if(u.eq(At))return u;if(s=y.precision,n.eq(At))return Me(u,s);if(t=n.e,e=n.d.length-1,c=t>=e,a=u.s,c){if((e=m<0?-m:m)<=Ma){for(r=new y(At),t=Math.ceil(s/Ue+4),$e=!1;e%2&&(r=r.times(u),qr(r.d,t)),e=Bs(e/2),e!==0;)u=u.times(u),qr(u.d,t);return $e=!0,n.s<0?new y(At).div(r):Me(r,s)}}else if(a<0)throw Error(Ut+"NaN");return a=a<0&&n.d[Math.max(t,e)]&1?-1:1,u.s=1,$e=!1,r=n.times(ni(u,s+p)),$e=!0,r=$a(r),r.s=a,r};ee.toPrecision=function(n,t){var e,s,r=this,a=r.constructor;return n===void 0?(e=Ye(r),s=ps(r,e<=a.toExpNeg||e>=a.toExpPos)):(fn(n,1,ks),t===void 0?t=a.rounding:fn(t,0,8),r=Me(new a(r),n,t),e=Ye(r),s=ps(r,n<=e||e<=a.toExpNeg,n)),s};ee.toSignificantDigits=ee.tosd=function(n,t){var e=this,s=e.constructor;return n===void 0?(n=s.precision,t=s.rounding):(fn(n,1,ks),t===void 0?t=s.rounding:fn(t,0,8)),Me(new s(e),n,t)};ee.toString=ee.valueOf=ee.val=ee.toJSON=ee[Symbol.for("nodejs.util.inspect.custom")]=function(){var n=this,t=Ye(n),e=n.constructor;return ps(n,t<=e.toExpNeg||t>=e.toExpPos)};function Ua(n,t){var e,s,r,a,c,u,y,p,m=n.constructor,h=m.precision;if(!n.s||!t.s)return t.s||(t=new m(n)),$e?Me(t,h):t;if(y=n.d,p=t.d,c=n.e,r=t.e,y=y.slice(),a=c-r,a){for(a<0?(s=y,a=-a,u=p.length):(s=p,r=c,u=y.length),c=Math.ceil(h/Ue),u=c>u?c+1:u+1,a>u&&(a=u,s.length=1),s.reverse();a--;)s.push(0);s.reverse()}for(u=y.length,a=p.length,u-a<0&&(a=u,s=p,p=y,y=s),e=0;a;)e=(y[--a]=y[a]+p[a]+e)/nt|0,y[a]%=nt;for(e&&(y.unshift(e),++r),u=y.length;y[--u]==0;)y.pop();return t.d=y,t.e=r,$e?Me(t,h):t}function fn(n,t,e){if(n!==~~n||n<t||n>e)throw Error(ds+n)}function ln(n){var t,e,s,r=n.length-1,a="",c=n[0];if(r>0){for(a+=c,t=1;t<r;t++)s=n[t]+"",e=Ue-s.length,e&&(a+=Mn(e)),a+=s;c=n[t],s=c+"",e=Ue-s.length,e&&(a+=Mn(e))}else if(c===0)return"0";for(;c%10===0;)c/=10;return a+c}var Sn=function(){function n(s,r){var a,c=0,u=s.length;for(s=s.slice();u--;)a=s[u]*r+c,s[u]=a%nt|0,c=a/nt|0;return c&&s.unshift(c),s}function t(s,r,a,c){var u,y;if(a!=c)y=a>c?1:-1;else for(u=y=0;u<a;u++)if(s[u]!=r[u]){y=s[u]>r[u]?1:-1;break}return y}function e(s,r,a){for(var c=0;a--;)s[a]-=c,c=s[a]<r[a]?1:0,s[a]=c*nt+s[a]-r[a];for(;!s[0]&&s.length>1;)s.shift()}return function(s,r,a,c){var u,y,p,m,h,I,M,H,$,U,he,ae,X,Pe,Ae,Ge,Ze,st,ot=s.constructor,dt=s.s==r.s?1:-1,Ce=s.d,Oe=r.d;if(!s.s)return new ot(s);if(!r.s)throw Error(Ut+"Division by zero");for(y=s.e-r.e,Ze=Oe.length,Ae=Ce.length,M=new ot(dt),H=M.d=[],p=0;Oe[p]==(Ce[p]||0);)++p;if(Oe[p]>(Ce[p]||0)&&--y,a==null?ae=a=ot.precision:c?ae=a+(Ye(s)-Ye(r))+1:ae=a,ae<0)return new ot(0);if(ae=ae/Ue+2|0,p=0,Ze==1)for(m=0,Oe=Oe[0],ae++;(p<Ae||m)&&ae--;p++)X=m*nt+(Ce[p]||0),H[p]=X/Oe|0,m=X%Oe|0;else{for(m=nt/(Oe[0]+1)|0,m>1&&(Oe=n(Oe,m),Ce=n(Ce,m),Ze=Oe.length,Ae=Ce.length),Pe=Ze,$=Ce.slice(0,Ze),U=$.length;U<Ze;)$[U++]=0;st=Oe.slice(),st.unshift(0),Ge=Oe[0],Oe[1]>=nt/2&&++Ge;do m=0,u=t(Oe,$,Ze,U),u<0?(he=$[0],Ze!=U&&(he=he*nt+($[1]||0)),m=he/Ge|0,m>1?(m>=nt&&(m=nt-1),h=n(Oe,m),I=h.length,U=$.length,u=t(h,$,I,U),u==1&&(m--,e(h,Ze<I?st:Oe,I))):(m==0&&(u=m=1),h=Oe.slice()),I=h.length,I<U&&h.unshift(0),e($,h,U),u==-1&&(U=$.length,u=t(Oe,$,Ze,U),u<1&&(m++,e($,Ze<U?st:Oe,U))),U=$.length):u===0&&(m++,$=[0]),H[p++]=m,u&&$[0]?$[U++]=Ce[Pe]||0:($=[Ce[Pe]],U=1);while((Pe++<Ae||$[0]!==void 0)&&ae--)}return H[0]||H.shift(),M.e=y,Me(M,c?a+Ye(M)+1:a)}}();function $a(n,t){var e,s,r,a,c,u,y=0,p=0,m=n.constructor,h=m.precision;if(Ye(n)>16)throw Error(kr+Ye(n));if(!n.s)return new m(At);for(t==null?($e=!1,u=h):u=t,c=new m(.03125);n.abs().gte(.1);)n=n.times(c),p+=5;for(s=Math.log(cs(2,p))/Math.LN10*2+5|0,u+=s,e=r=a=new m(At),m.precision=u;;){if(r=Me(r.times(n),u),e=e.times(++y),c=a.plus(Sn(r,e,u)),ln(c.d).slice(0,u)===ln(a.d).slice(0,u)){for(;p--;)a=Me(a.times(a),u);return m.precision=h,t==null?($e=!0,Me(a,h)):a}a=c}}function Ye(n){for(var t=n.e*Ue,e=n.d[0];e>=10;e/=10)t++;return t}function ir(n,t,e){if(t>n.LN10.sd())throw $e=!0,e&&(n.precision=e),Error(Ut+"LN10 precision limit exceeded");return Me(new n(n.LN10),t)}function Mn(n){for(var t="";n--;)t+="0";return t}function ni(n,t){var e,s,r,a,c,u,y,p,m,h=1,I=10,M=n,H=M.d,$=M.constructor,U=$.precision;if(M.s<1)throw Error(Ut+(M.s?"NaN":"-Infinity"));if(M.eq(At))return new $(0);if(t==null?($e=!1,p=U):p=t,M.eq(10))return t==null&&($e=!0),ir($,p);if(p+=I,$.precision=p,e=ln(H),s=e.charAt(0),a=Ye(M),Math.abs(a)<15e14){for(;s<7&&s!=1||s==1&&e.charAt(1)>3;)M=M.times(n),e=ln(M.d),s=e.charAt(0),h++;a=Ye(M),s>1?(M=new $("0."+e),a++):M=new $(s+"."+e.slice(1))}else return y=ir($,p+2,U).times(a+""),M=ni(new $(s+"."+e.slice(1)),p-I).plus(y),$.precision=U,t==null?($e=!0,Me(M,U)):M;for(u=c=M=Sn(M.minus(At),M.plus(At),p),m=Me(M.times(M),p),r=3;;){if(c=Me(c.times(m),p),y=u.plus(Sn(c,new $(r),p)),ln(y.d).slice(0,p)===ln(u.d).slice(0,p))return u=u.times(2),a!==0&&(u=u.plus(ir($,p+2,U).times(a+""))),u=Sn(u,new $(h),p),$.precision=U,t==null?($e=!0,Me(u,U)):u;u=y,r+=2}}function Yr(n,t){var e,s,r;for((e=t.indexOf("."))>-1&&(t=t.replace(".","")),(s=t.search(/e/i))>0?(e<0&&(e=s),e+=+t.slice(s+1),t=t.substring(0,s)):e<0&&(e=t.length),s=0;t.charCodeAt(s)===48;)++s;for(r=t.length;t.charCodeAt(r-1)===48;)--r;if(t=t.slice(s,r),t){if(r-=s,e=e-s-1,n.e=Bs(e/Ue),n.d=[],s=(e+1)%Ue,e<0&&(s+=Ue),s<r){for(s&&n.d.push(+t.slice(0,s)),r-=Ue;s<r;)n.d.push(+t.slice(s,s+=Ue));t=t.slice(s),s=Ue-t.length}else s-=r;for(;s--;)t+="0";if(n.d.push(+t),$e&&(n.e>Ci||n.e<-Ci))throw Error(kr+e)}else n.s=0,n.e=0,n.d=[0];return n}function Me(n,t,e){var s,r,a,c,u,y,p,m,h=n.d;for(c=1,a=h[0];a>=10;a/=10)c++;if(s=t-c,s<0)s+=Ue,r=t,p=h[m=0];else{if(m=Math.ceil((s+1)/Ue),a=h.length,m>=a)return n;for(p=a=h[m],c=1;a>=10;a/=10)c++;s%=Ue,r=s-Ue+c}if(e!==void 0&&(a=cs(10,c-r-1),u=p/a%10|0,y=t<0||h[m+1]!==void 0||p%a,y=e<4?(u||y)&&(e==0||e==(n.s<0?3:2)):u>5||u==5&&(e==4||y||e==6&&(s>0?r>0?p/cs(10,c-r):0:h[m-1])%10&1||e==(n.s<0?8:7))),t<1||!h[0])return y?(a=Ye(n),h.length=1,t=t-a-1,h[0]=cs(10,(Ue-t%Ue)%Ue),n.e=Bs(-t/Ue)||0):(h.length=1,h[0]=n.e=n.s=0),n;if(s==0?(h.length=m,a=1,m--):(h.length=m+1,a=cs(10,Ue-s),h[m]=r>0?(p/cs(10,c-r)%cs(10,r)|0)*a:0),y)for(;;)if(m==0){(h[0]+=a)==nt&&(h[0]=1,++n.e);break}else{if(h[m]+=a,h[m]!=nt)break;h[m--]=0,a=1}for(s=h.length;h[--s]===0;)h.pop();if($e&&(n.e>Ci||n.e<-Ci))throw Error(kr+Ye(n));return n}function Va(n,t){var e,s,r,a,c,u,y,p,m,h,I=n.constructor,M=I.precision;if(!n.s||!t.s)return t.s?t.s=-t.s:t=new I(n),$e?Me(t,M):t;if(y=n.d,h=t.d,s=t.e,p=n.e,y=y.slice(),c=p-s,c){for(m=c<0,m?(e=y,c=-c,u=h.length):(e=h,s=p,u=y.length),r=Math.max(Math.ceil(M/Ue),u)+2,c>r&&(c=r,e.length=1),e.reverse(),r=c;r--;)e.push(0);e.reverse()}else{for(r=y.length,u=h.length,m=r<u,m&&(u=r),r=0;r<u;r++)if(y[r]!=h[r]){m=y[r]<h[r];break}c=0}for(m&&(e=y,y=h,h=e,t.s=-t.s),u=y.length,r=h.length-u;r>0;--r)y[u++]=0;for(r=h.length;r>c;){if(y[--r]<h[r]){for(a=r;a&&y[--a]===0;)y[a]=nt-1;--y[a],y[r]+=nt}y[r]-=h[r]}for(;y[--u]===0;)y.pop();for(;y[0]===0;y.shift())--s;return y[0]?(t.d=y,t.e=s,$e?Me(t,M):t):new I(0)}function ps(n,t,e){var s,r=Ye(n),a=ln(n.d),c=a.length;return t?(e&&(s=e-c)>0?a=a.charAt(0)+"."+a.slice(1)+Mn(s):c>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(r<0?"e":"e+")+r):r<0?(a="0."+Mn(-r-1)+a,e&&(s=e-c)>0&&(a+=Mn(s))):r>=c?(a+=Mn(r+1-c),e&&(s=e-r-1)>0&&(a=a+"."+Mn(s))):((s=r+1)<c&&(a=a.slice(0,s)+"."+a.slice(s)),e&&(s=e-c)>0&&(r+1===c&&(a+="."),a+=Mn(s))),n.s<0?"-"+a:a}function qr(n,t){if(n.length>t)return n.length=t,!0}function Fa(n){var t,e,s;function r(a){var c=this;if(!(c instanceof r))return new r(a);if(c.constructor=r,a instanceof r){c.s=a.s,c.e=a.e,c.d=(a=a.d)?a.slice():a;return}if(typeof a=="number"){if(a*0!==0)throw Error(ds+a);if(a>0)c.s=1;else if(a<0)a=-a,c.s=-1;else{c.s=0,c.e=0,c.d=[0];return}if(a===~~a&&a<1e7){c.e=0,c.d=[a];return}return Yr(c,a.toString())}else if(typeof a!="string")throw Error(ds+a);if(a.charCodeAt(0)===45?(a=a.slice(1),c.s=-1):c.s=1,Hc.test(a))Yr(c,a);else throw Error(ds+a)}if(r.prototype=ee,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.clone=Fa,r.config=r.set=jc,n===void 0&&(n={}),n)for(s=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<s.length;)n.hasOwnProperty(e=s[t++])||(n[e]=this[e]);return r.config(n),r}function jc(n){if(!n||typeof n!="object")throw Error(Ut+"Object expected");var t,e,s,r=["precision",1,ks,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<r.length;t+=3)if((s=n[e=r[t]])!==void 0)if(Bs(s)===s&&s>=r[t+1]&&s<=r[t+2])this[e]=s;else throw Error(ds+e+": "+s);if((s=n[e="LN10"])!==void 0)if(s==Math.LN10)this[e]=new this(s);else throw Error(ds+e+": "+s);return this}var Ga=Fa(Zc);At=new Ga(1);var O;(function(n){n.AED="aed",n.AFN="afn",n.ALL="all",n.AMD="amd",n.ANG="ang",n.AOA="aoa",n.ARS="ars",n.AUD="aud",n.AWG="awg",n.AZN="azn",n.BAM="bam",n.BBD="bbd",n.BDT="bdt",n.BGN="bgn",n.BHD="bhd",n.BIF="bif",n.BMD="bmd",n.BND="bnd",n.BOB="bob",n.BOV="bov",n.BRL="brl",n.BSD="bsd",n.BTN="btn",n.BWP="bwp",n.BYN="byn",n.BYR="byr",n.BZD="bzd",n.CAD="cad",n.CDF="cdf",n.CHE="che",n.CHF="chf",n.CHW="chw",n.CLF="clf",n.CLP="clp",n.CNY="cny",n.COP="cop",n.COU="cou",n.CRC="crc",n.CUC="cuc",n.CUP="cup",n.CVE="cve",n.CZK="czk",n.DJF="djf",n.DKK="dkk",n.DOP="dop",n.DZD="dzd",n.EGP="egp",n.ERN="ern",n.ETB="etb",n.EUR="eur",n.FJD="fjd",n.FKP="fkp",n.GBP="gbp",n.GEL="gel",n.GHS="ghs",n.GIP="gip",n.GMD="gmd",n.GNF="gnf",n.GTQ="gtq",n.GYD="gyd",n.HKD="hkd",n.HNL="hnl",n.HRK="hrk",n.HTG="htg",n.HUF="huf",n.IDR="idr",n.ILS="ils",n.INR="inr",n.IQD="iqd",n.IRR="irr",n.ISK="isk",n.JMD="jmd",n.JOD="jod",n.JPY="jpy",n.KES="kes",n.KGS="kgs",n.KHR="khr",n.KMF="kmf",n.KPW="kpw",n.KRW="krw",n.KWD="kwd",n.KYD="kyd",n.KZT="kzt",n.LAK="lak",n.LBP="lbp",n.LKR="lkr",n.LRD="lrd",n.LSL="lsl",n.LTL="ltl",n.LVL="lvl",n.LYD="lyd",n.MAD="mad",n.MDL="mdl",n.MGA="mga",n.MKD="mkd",n.MMK="mmk",n.MNT="mnt",n.MOP="mop",n.MRO="mro",n.MUR="mur",n.MVR="mvr",n.MWK="mwk",n.MXN="mxn",n.MXV="mxv",n.MYR="myr",n.MZN="mzn",n.NAD="nad",n.NGN="ngn",n.NIO="nio",n.NOK="nok",n.NPR="npr",n.NZD="nzd",n.OMR="omr",n.PAB="pab",n.PEN="pen",n.PGK="pgk",n.PHP="php",n.PKR="pkr",n.PLN="pln",n.PYG="pyg",n.QAR="qar",n.RON="ron",n.RSD="rsd",n.RUB="rub",n.RWF="rwf",n.SAR="sar",n.SBD="sbd",n.SCR="scr",n.SDG="sdg",n.SEK="sek",n.SGD="sgd",n.SHP="shp",n.SLL="sll",n.SOS="sos",n.SRD="srd",n.SSP="ssp",n.STD="std",n.SVC="svc",n.SYP="syp",n.SZL="szl",n.THB="thb",n.TJS="tjs",n.TMT="tmt",n.TND="tnd",n.TOP="top",n.TRY="try",n.TTD="ttd",n.TWD="twd",n.TZS="tzs",n.UAH="uah",n.UGX="ugx",n.USD="usd",n.USN="usn",n.USS="uss",n.UYI="uyi",n.UYU="uyu",n.UZS="uzs",n.VEF="vef",n.VND="vnd",n.VUV="vuv",n.WST="wst",n.XAF="xaf",n.XAG="xag",n.XAU="xau",n.XBA="xba",n.XBB="xbb",n.XBC="xbc",n.XBD="xbd",n.XCD="xcd",n.XDR="xdr",n.XFU="xfu",n.XOF="xof",n.XPD="xpd",n.XPF="xpf",n.XPT="xpt",n.XSU="xsu",n.XTS="xts",n.XUA="xua",n.YER="yer",n.ZAR="zar",n.ZMW="zmw",n.ZWL="zwl"})(O||(O={}));O.AED+"",O.AFN+"",O.ALL+"",O.AMD+"",O.ANG+"",O.AOA+"",O.ARS+"",O.AUD+"",O.AWG+"",O.AZN+"",O.BAM+"",O.BBD+"",O.BDT+"",O.BGN+"",O.BHD+"",O.BIF+"",O.BMD+"",O.BND+"",O.BOB+"",O.BOV+"",O.BRL+"",O.BSD+"",O.BTN+"",O.BWP+"",O.BYR+"",O.BYN+"",O.BZD+"",O.CAD+"",O.CDF+"",O.CHE+"",O.CHF+"",O.CHW+"",O.CLF+"",O.CLP+"",O.CNY+"",O.COP+"",O.COU+"",O.CRC+"",O.CUC+"",O.CUP+"",O.CVE+"",O.CZK+"",O.DJF+"",O.DKK+"",O.DOP+"",O.DZD+"",O.EGP+"",O.ERN+"",O.ETB+"",O.EUR+"",O.FJD+"",O.FKP+"",O.GBP+"",O.GEL+"",O.GHS+"",O.GIP+"",O.GMD+"",O.GNF+"",O.GTQ+"",O.GYD+"",O.HKD+"",O.HNL+"",O.HRK+"",O.HTG+"",O.HUF+"",O.IDR+"",O.ILS+"",O.INR+"",O.IQD+"",O.IRR+"",O.ISK+"",O.JMD+"",O.JOD+"",O.JPY+"",O.KES+"",O.KGS+"",O.KHR+"",O.KMF+"",O.KPW+"",O.KRW+"",O.KWD+"",O.KYD+"",O.KZT+"",O.LAK+"",O.LBP+"",O.LKR+"",O.LRD+"",O.LSL+"",O.LTL+"",O.LVL+"",O.LYD+"",O.MAD+"",O.MDL+"",O.MGA+"",O.MKD+"",O.MMK+"",O.MNT+"",O.MOP+"",O.MRO+"",O.MUR+"",O.MVR+"",O.MWK+"",O.MXN+"",O.MXV+"",O.MYR+"",O.MZN+"",O.NAD+"",O.NGN+"",O.NIO+"",O.NOK+"",O.NPR+"",O.NZD+"",O.OMR+"",O.PAB+"",O.PEN+"",O.PGK+"",O.PHP+"",O.PKR+"",O.PLN+"",O.PYG+"",O.QAR+"",O.RON+"",O.RSD+"",O.RUB+"",O.RWF+"",O.SAR+"",O.SBD+"",O.SCR+"",O.SDG+"",O.SEK+"",O.SGD+"",O.SHP+"",O.SLL+"",O.SOS+"",O.SRD+"",O.SSP+"",O.STD+"",O.SVC+"",O.SYP+"",O.SZL+"",O.THB+"",O.TJS+"",O.TMT+"",O.TND+"",O.TOP+"",O.TRY+"",O.TTD+"",O.TWD+"",O.TZS+"",O.UAH+"",O.UGX+"",O.USD+"",O.USN+"",O.USS+"",O.UYI+"",O.UYU+"",O.UZS+"",O.VEF+"",O.VND+"",O.VUV+"",O.WST+"",O.XAF+"",O.XAG+"",O.XAU+"",O.XBA+"",O.XBB+"",O.XBC+"",O.XBD+"",O.XCD+"",O.XDR+"",O.XFU+"",O.XOF+"",O.XPD+"",O.XPF+"",O.XPT+"",O.XSU+"",O.XTS+"",O.XUA+"",O.YER+"",O.ZAR+"",O.ZMW+"",O.ZWL+"";var Mi={exports:{}};Mi.exports;(function(n,t){var e=200,s="Expected a function",r="__lodash_hash_undefined__",a=1,c=2,u=1/0,y=9007199254740991,p="[object Arguments]",m="[object Array]",h="[object Boolean]",I="[object Date]",M="[object Error]",H="[object Function]",$="[object GeneratorFunction]",U="[object Map]",he="[object Number]",ae="[object Object]",X="[object Promise]",Pe="[object RegExp]",Ae="[object Set]",Ge="[object String]",Ze="[object Symbol]",st="[object WeakMap]",ot="[object ArrayBuffer]",dt="[object DataView]",Ce="[object Float32Array]",Oe="[object Float64Array]",mn="[object Int8Array]",it="[object Int16Array]",ht="[object Int32Array]",Wn="[object Uint8Array]",Et="[object Uint8ClampedArray]",Dt="[object Uint16Array]",xt="[object Uint32Array]",Nt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,gs=/^\w*$/,Kn=/^\./,mt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qt=/[\\^$.*+?()[\]{}|]/g,$t=/\\(\\)?/g,ms=/^\[object .+?Constructor\]$/,yn=/^(?:0|[1-9]\d*)$/,be={};be[Ce]=be[Oe]=be[mn]=be[it]=be[ht]=be[Wn]=be[Et]=be[Dt]=be[xt]=!0,be[p]=be[m]=be[ot]=be[h]=be[dt]=be[I]=be[M]=be[H]=be[U]=be[he]=be[ae]=be[Pe]=be[Ae]=be[Ge]=be[st]=!1;var Xt=typeof Si=="object"&&Si&&Si.Object===Object&&Si,yt=typeof self=="object"&&self&&self.Object===Object&&self,Tt=Xt||yt||Function("return this")(),Yn=t&&!t.nodeType&&t,On=Yn&&!0&&n&&!n.nodeType&&n,ys=On&&On.exports===Yn,qn=ys&&Xt.process,Xn=function(){try{return qn&&qn.binding("util")}catch{}}(),Jt=Xn&&Xn.isTypedArray;function Jn(g,T){for(var L=-1,W=g?g.length:0;++L<W&&T(g[L],L,g)!==!1;);return g}function Dn(g,T){for(var L=-1,W=g?g.length:0;++L<W;)if(T(g[L],L,g))return!0;return!1}function qe(g){return function(T){return T==null?void 0:T[g]}}function Vt(g,T){for(var L=-1,W=Array(g);++L<g;)W[L]=T(L);return W}function Qn(g){return function(T){return g(T)}}function vs(g,T){return g==null?void 0:g[T]}function de(g){var T=!1;if(g!=null&&typeof g.toString!="function")try{T=!!(g+"")}catch{}return T}function Rt(g){var T=-1,L=Array(g.size);return g.forEach(function(W,ve){L[++T]=[ve,W]}),L}function d(g,T){return function(L){return g(T(L))}}function b(g){var T=-1,L=Array(g.size);return g.forEach(function(W){L[++T]=W}),L}var w=Array.prototype,D=Function.prototype,P=Object.prototype,R=Tt["__core-js_shared__"],k=function(){var g=/[^.]+$/.exec(R&&R.keys&&R.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),C=D.toString,F=P.hasOwnProperty,ne=P.toString,_e=RegExp("^"+C.call(F).replace(qt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ge=Tt.Symbol,ye=Tt.Uint8Array,et=d(Object.getPrototypeOf,Object),De=Object.create,Qt=P.propertyIsEnumerable,Xe=w.splice,ri=d(Object.keys,Object),Je=x(Tt,"DataView"),Pt=x(Tt,"Map"),es=x(Tt,"Promise"),bs=x(Tt,"Set"),xn=x(Tt,"WeakMap"),Nn=x(Object,"create"),ai=Be(Je),Cs=Be(Pt),oi=Be(es),_s=Be(bs),Zi=Be(xn),ts=ge?ge.prototype:void 0,Ms=ts?ts.valueOf:void 0,ns=ts?ts.toString:void 0;function en(g){var T=-1,L=g?g.length:0;for(this.clear();++T<L;){var W=g[T];this.set(W[0],W[1])}}function li(){this.__data__=Nn?Nn(null):{}}function Hi(g){return this.has(g)&&delete this.__data__[g]}function Lt(g){var T=this.__data__;if(Nn){var L=T[g];return L===r?void 0:L}return F.call(T,g)?T[g]:void 0}function ci(g){var T=this.__data__;return Nn?T[g]!==void 0:F.call(T,g)}function ui(g,T){var L=this.__data__;return L[g]=Nn&&T===void 0?r:T,this}en.prototype.clear=li,en.prototype.delete=Hi,en.prototype.get=Lt,en.prototype.has=ci,en.prototype.set=ui;function tt(g){var T=-1,L=g?g.length:0;for(this.clear();++T<L;){var W=g[T];this.set(W[0],W[1])}}function Ft(){this.__data__=[]}function ji(g){var T=this.__data__,L=vn(T,g);if(L<0)return!1;var W=T.length-1;return L==W?T.pop():Xe.call(T,L,1),!0}function di(g){var T=this.__data__,L=vn(T,g);return L<0?void 0:T[L][1]}function wt(g){return vn(this.__data__,g)>-1}function hi(g,T){var L=this.__data__,W=vn(L,g);return W<0?L.push([g,T]):L[W][1]=T,this}tt.prototype.clear=Ft,tt.prototype.delete=ji,tt.prototype.get=di,tt.prototype.has=wt,tt.prototype.set=hi;function Gt(g){var T=-1,L=g?g.length:0;for(this.clear();++T<L;){var W=g[T];this.set(W[0],W[1])}}function zi(){this.__data__={hash:new en,map:new(Pt||tt),string:new en}}function fi(g){return _(this,g).delete(g)}function Es(g){return _(this,g).get(g)}function Wi(g){return _(this,g).has(g)}function pi(g,T){return _(this,g).set(g,T),this}Gt.prototype.clear=zi,Gt.prototype.delete=fi,Gt.prototype.get=Es,Gt.prototype.has=Wi,Gt.prototype.set=pi;function ss(g){var T=-1,L=g?g.length:0;for(this.__data__=new Gt;++T<L;)this.add(g[T])}function He(g){return this.__data__.set(g,r),this}function gi(g){return this.__data__.has(g)}ss.prototype.add=ss.prototype.push=He,ss.prototype.has=gi;function kt(g){this.__data__=new tt(g)}function is(){this.__data__=new tt}function mi(g){return this.__data__.delete(g)}function yi(g){return this.__data__.get(g)}function rs(g){return this.__data__.has(g)}function tn(g,T){var L=this.__data__;if(L instanceof tt){var W=L.__data__;if(!Pt||W.length<e-1)return W.push([g,T]),this;L=this.__data__=new Gt(W)}return L.set(g,T),this}kt.prototype.clear=is,kt.prototype.delete=mi,kt.prototype.get=yi,kt.prototype.has=rs,kt.prototype.set=tn;function Ki(g,T){var L=bn(g)||Zt(g)?Vt(g.length,String):[],W=L.length,ve=!!W;for(var oe in g)F.call(g,oe)&&!(ve&&(oe=="length"||V(oe,W)))&&L.push(oe);return L}function vn(g,T){for(var L=g.length;L--;)if(Ke(g[L][0],T))return L;return-1}function vi(g){return Is(g)?De(g):{}}var bi=i();function Yi(g,T){return g&&bi(g,T,Ei)}function Ts(g,T){T=z(T,g)?[T]:v(T);for(var L=0,W=T.length;g!=null&&L<W;)g=g[xe(T[L++])];return L&&L==W?g:void 0}function Rn(g){return ne.call(g)}function Pn(g,T){return g!=null&&T in Object(g)}function nn(g,T,L,W,ve){return g===T?!0:g==null||T==null||!Is(g)&&!_i(T)?g!==g&&T!==T:qi(g,T,nn,L,W,ve)}function qi(g,T,L,W,ve,oe){var Se=bn(g),ze=bn(T),je=m,lt=m;Se||(je=N(g),je=je==p?ae:je),ze||(lt=N(T),lt=lt==p?ae:lt);var vt=je==ae&&!de(g),bt=lt==ae&&!de(T),ft=je==lt;if(ft&&!vt)return oe||(oe=new kt),Se||$r(g)?o(g,T,L,W,ve,oe):l(g,T,je,L,W,ve,oe);if(!(ve&c)){var Ct=vt&&F.call(g,"__wrapped__"),Mt=bt&&F.call(T,"__wrapped__");if(Ct||Mt){var Bn=Ct?g.value():g,_n=Mt?T.value():T;return oe||(oe=new kt),L(Bn,_n,W,ve,oe)}}return ft?(oe||(oe=new kt),f(g,T,L,W,ve,oe)):!1}function Xi(g,T,L,W){var ve=L.length,oe=ve;if(g==null)return!oe;for(g=Object(g);ve--;){var Se=L[ve];if(Se[2]?Se[1]!==g[Se[0]]:!(Se[0]in g))return!1}for(;++ve<oe;){Se=L[ve];var ze=Se[0],je=g[ze],lt=Se[1];if(Se[2]){if(je===void 0&&!(ze in g))return!1}else{var vt=new kt,bt;if(!(bt===void 0?nn(lt,je,W,a|c,vt):bt))return!1}}return!0}function Ji(g){if(!Is(g)||ie(g))return!1;var T=Qi(g)||de(g)?_e:ms;return T.test(Be(g))}function Bt(g){return _i(g)&&er(g.length)&&!!be[ne.call(g)]}function It(g){return typeof g=="function"?g:g==null?Ja:typeof g=="object"?bn(g)?Ln(g[0],g[1]):as(g):Qa(g)}function sn(g){if(!te(g))return ri(g);var T=[];for(var L in Object(g))F.call(g,L)&&L!="constructor"&&T.push(L);return T}function as(g){var T=S(g);return T.length==1&&T[0][2]?Z(T[0][0],T[0][1]):function(L){return L===g||Xi(L,g,T)}}function Ln(g,T){return z(g)&&Y(T)?Z(xe(g),T):function(L){var W=Ya(L,g);return W===void 0&&W===T?qa(L,g):nn(T,W,void 0,a|c)}}function kn(g){return function(T){return Ts(T,g)}}function ws(g){if(typeof g=="string")return g;if(tr(g))return ns?ns.call(g):"";var T=g+"";return T=="0"&&1/g==-u?"-0":T}function v(g){return bn(g)?g:se(g)}function i(g){return function(T,L,W){for(var ve=-1,oe=Object(T),Se=W(T),ze=Se.length;ze--;){var je=Se[++ve];if(L(oe[je],je,oe)===!1)break}return T}}function o(g,T,L,W,ve,oe){var Se=ve&c,ze=g.length,je=T.length;if(ze!=je&&!(Se&&je>ze))return!1;var lt=oe.get(g);if(lt&&oe.get(T))return lt==T;var vt=-1,bt=!0,ft=ve&a?new ss:void 0;for(oe.set(g,T),oe.set(T,g);++vt<ze;){var Ct=g[vt],Mt=T[vt];if(W)var Bn=Se?W(Mt,Ct,vt,T,g,oe):W(Ct,Mt,vt,g,T,oe);if(Bn!==void 0){if(Bn)continue;bt=!1;break}if(ft){if(!Dn(T,function(_n,os){if(!ft.has(os)&&(Ct===_n||L(Ct,_n,W,ve,oe)))return ft.add(os)})){bt=!1;break}}else if(!(Ct===Mt||L(Ct,Mt,W,ve,oe))){bt=!1;break}}return oe.delete(g),oe.delete(T),bt}function l(g,T,L,W,ve,oe,Se){switch(L){case dt:if(g.byteLength!=T.byteLength||g.byteOffset!=T.byteOffset)return!1;g=g.buffer,T=T.buffer;case ot:return!(g.byteLength!=T.byteLength||!W(new ye(g),new ye(T)));case h:case I:case he:return Ke(+g,+T);case M:return g.name==T.name&&g.message==T.message;case Pe:case Ge:return g==T+"";case U:var ze=Rt;case Ae:var je=oe&c;if(ze||(ze=b),g.size!=T.size&&!je)return!1;var lt=Se.get(g);if(lt)return lt==T;oe|=a,Se.set(g,T);var vt=o(ze(g),ze(T),W,ve,oe,Se);return Se.delete(g),vt;case Ze:if(Ms)return Ms.call(g)==Ms.call(T)}return!1}function f(g,T,L,W,ve,oe){var Se=ve&c,ze=Ei(g),je=ze.length,lt=Ei(T),vt=lt.length;if(je!=vt&&!Se)return!1;for(var bt=je;bt--;){var ft=ze[bt];if(!(Se?ft in T:F.call(T,ft)))return!1}var Ct=oe.get(g);if(Ct&&oe.get(T))return Ct==T;var Mt=!0;oe.set(g,T),oe.set(T,g);for(var Bn=Se;++bt<je;){ft=ze[bt];var _n=g[ft],os=T[ft];if(W)var Vr=Se?W(os,_n,ft,T,g,oe):W(_n,os,ft,g,T,oe);if(!(Vr===void 0?_n===os||L(_n,os,W,ve,oe):Vr)){Mt=!1;break}Bn||(Bn=ft=="constructor")}if(Mt&&!Bn){var Ti=g.constructor,wi=T.constructor;Ti!=wi&&"constructor"in g&&"constructor"in T&&!(typeof Ti=="function"&&Ti instanceof Ti&&typeof wi=="function"&&wi instanceof wi)&&(Mt=!1)}return oe.delete(g),oe.delete(T),Mt}function _(g,T){var L=g.__data__;return G(T)?L[typeof T=="string"?"string":"hash"]:L.map}function S(g){for(var T=Ei(g),L=T.length;L--;){var W=T[L],ve=g[W];T[L]=[W,ve,Y(ve)]}return T}function x(g,T){var L=vs(g,T);return Ji(L)?L:void 0}var N=Rn;(Je&&N(new Je(new ArrayBuffer(1)))!=dt||Pt&&N(new Pt)!=U||es&&N(es.resolve())!=X||bs&&N(new bs)!=Ae||xn&&N(new xn)!=st)&&(N=function(g){var T=ne.call(g),L=T==ae?g.constructor:void 0,W=L?Be(L):void 0;if(W)switch(W){case ai:return dt;case Cs:return U;case oi:return X;case _s:return Ae;case Zi:return st}return T});function B(g,T,L){T=z(T,g)?[T]:v(T);for(var W,ve=-1,Se=T.length;++ve<Se;){var oe=xe(T[ve]);if(!(W=g!=null&&L(g,oe)))break;g=g[oe]}if(W)return W;var Se=g?g.length:0;return!!Se&&er(Se)&&V(oe,Se)&&(bn(g)||Zt(g))}function V(g,T){return T=T??y,!!T&&(typeof g=="number"||yn.test(g))&&g>-1&&g%1==0&&g<T}function z(g,T){if(bn(g))return!1;var L=typeof g;return L=="number"||L=="symbol"||L=="boolean"||g==null||tr(g)?!0:gs.test(g)||!Nt.test(g)||T!=null&&g in Object(T)}function G(g){var T=typeof g;return T=="string"||T=="number"||T=="symbol"||T=="boolean"?g!=="__proto__":g===null}function ie(g){return!!k&&k in g}function te(g){var T=g&&g.constructor,L=typeof T=="function"&&T.prototype||P;return g===L}function Y(g){return g===g&&!Is(g)}function Z(g,T){return function(L){return L==null?!1:L[g]===T&&(T!==void 0||g in Object(L))}}var se=We(function(g){g=Ka(g);var T=[];return Kn.test(g)&&T.push(""),g.replace(mt,function(L,W,ve,oe){T.push(ve?oe.replace($t,"$1"):W||L)}),T});function xe(g){if(typeof g=="string"||tr(g))return g;var T=g+"";return T=="0"&&1/g==-u?"-0":T}function Be(g){if(g!=null){try{return C.call(g)}catch{}try{return g+""}catch{}}return""}function We(g,T){if(typeof g!="function"||T&&typeof T!="function")throw new TypeError(s);var L=function(){var W=arguments,ve=T?T.apply(this,W):W[0],oe=L.cache;if(oe.has(ve))return oe.get(ve);var Se=g.apply(this,W);return L.cache=oe.set(ve,Se),Se};return L.cache=new(We.Cache||Gt),L}We.Cache=Gt;function Ke(g,T){return g===T||g!==g&&T!==T}function Zt(g){return Wa(g)&&F.call(g,"callee")&&(!Qt.call(g,"callee")||ne.call(g)==p)}var bn=Array.isArray;function Ur(g){return g!=null&&er(g.length)&&!Qi(g)}function Wa(g){return _i(g)&&Ur(g)}function Qi(g){var T=Is(g)?ne.call(g):"";return T==H||T==$}function er(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=y}function Is(g){var T=typeof g;return!!g&&(T=="object"||T=="function")}function _i(g){return!!g&&typeof g=="object"}function tr(g){return typeof g=="symbol"||_i(g)&&ne.call(g)==Ze}var $r=Jt?Qn(Jt):Bt;function Ka(g){return g==null?"":ws(g)}function Ya(g,T,L){var W=g==null?void 0:Ts(g,T);return W===void 0?L:W}function qa(g,T){return g!=null&&B(g,T,Pn)}function Ei(g){return Ur(g)?Ki(g):sn(g)}function Xa(g,T,L){var W=bn(g)||$r(g);if(T=It(T),L==null)if(W||Is(g)){var ve=g.constructor;W?L=bn(g)?new ve:[]:L=Qi(ve)?vi(et(g)):{}}else L={};return(W?Jn:Yi)(g,function(oe,Se,ze){return T(L,oe,Se,ze)}),L}function Ja(g){return g}function Qa(g){return z(g)?qe(xe(g)):kn(g)}n.exports=Xa})(Mi,Mi.exports);var zc=Mi.exports,Wc=wr(zc);class Za{constructor(t,e,s){this.platform=wn.DESKTOP,this.instanceId="123456789012345678",this.configuration=Ca(),this.source=null,this.sourceOrigin="",this.frameId="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",this.eventBus=new ea,this.clientId=t,this.commands=this._updateCommandMocks({}),this.guildId=e,this.channelId=s}_updateCommandMocks(t){return this.commands=Wc(Object.assign({},Kc,t),(e,s,r)=>{e[r]=async(...a)=>(console.info(`DiscordSDKMock: ${String(r)}(${JSON.stringify(a)})`),await s(...a))}),this.commands}emitReady(){this.emitEvent("READY",void 0)}close(...t){console.info(`DiscordSDKMock: close(${JSON.stringify(t)})`)}ready(){return Promise.resolve()}async subscribe(t,e,...s){return await this.eventBus.on(t,e)}async unsubscribe(t,e,...s){return await this.eventBus.off(t,e)}emitEvent(t,e){this.eventBus.emit(t,e)}}const Kc={authorize:()=>Promise.resolve({code:"mock_code"}),authenticate:()=>Promise.resolve({access_token:"mock_token",user:{username:"mock_user_username",discriminator:"mock_user_discriminator",id:"mock_user_id",avatar:null,public_flags:1},scopes:[],expires:new Date(2121,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}}),setActivity:()=>Promise.resolve({name:"mock_activity_name",type:0}),getChannel:()=>Promise.resolve({id:"mock_channel_id",name:"mock_channel_name",type:Rr.GUILD_TEXT,voice_states:[],messages:[]}),getSkus:()=>Promise.resolve({skus:[]}),getEntitlements:()=>Promise.resolve({entitlements:[]}),startPurchase:()=>Promise.resolve([]),setConfig:()=>Promise.resolve({use_interactive_pip:!1}),userSettingsGetLocale:()=>Promise.resolve({locale:""}),openExternalLink:()=>Promise.resolve(null),encourageHardwareAcceleration:()=>Promise.resolve({enabled:!0}),captureLog:()=>Promise.resolve(null),setOrientationLockState:()=>Promise.resolve(null),openInviteDialog:()=>Promise.resolve(null),getPlatformBehaviors:()=>Promise.resolve({iosKeyboardResizesView:!0}),getChannelPermissions:()=>Promise.resolve({permissions:da(1234567890)}),openShareMomentDialog:()=>Promise.resolve(null),initiateImageUpload:()=>Promise.resolve({image_url:"https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0b52aa9e99b832574a53_full_logo_blurple_RGB.png"}),getInstanceConnectedParticipants:()=>Promise.resolve({participants:[]})};let E=null,_r=null,In=new Map;async function Br(){return E?new Promise(n=>{const t=setTimeout(()=>{console.error("loadAllCardData: Timeout while waiting for card data"),n(!1)},5e3);E.send("getAllCards"),E.onMessage("allCards",e=>{clearTimeout(t),console.log(`Received ${e.length} cards from server`),In.clear(),e.forEach(s=>{In.set(s.id,s)}),n(!0)})}):!1}async function Cr(n,t){const e=location.host.includes("localhost")?"ws://localhost:4001":`wss://${location.host}/.proxy/api`;_r=new cn.Client(e);try{console.log("Attempting to join or create Colyseus room..."),E=await _r.joinOrCreate("game",{accessToken:n,username:t}),console.log("Successfully joined room:",E.roomId),console.log("Session ID:",E.sessionId),console.log("Initial room state:",E.state.toJSON()),console.log("Loading all card data..."),await Br(),console.log("Card data loaded, cache size:",In.size),E.onStateChange(s=>{}),E.onError((s,r)=>{console.error("Colyseus room error:",s,r),E=null}),E.onLeave(s=>{console.log("Left Colyseus room, code:",s),E=null})}catch(s){throw console.error("Failed to connect to Colyseus:",s),s instanceof ProgressEvent?(console.error("Connection failed: Network error (ProgressEvent). Potential causes:"),console.error("- Colyseus server might not be running or accessible at the target URL:",e),console.error("- WebSocket connection blocked by firewall or proxy."),console.error("- Incorrect WebSocket proxy configuration on the deployment server (if applicable)."),alert("Failed to connect to game server: Network Error. Please ensure the server is running and accessible.")):s instanceof Error?(console.error("Connection failed due to error:",s.message),alert(`Failed to connect to game server: ${s.message}`)):(console.error("Connection failed due to unknown error:",s),alert("Failed to connect to game server: An unknown error occurred.")),E=null,s}}const Yc=Object.freeze(Object.defineProperty({__proto__:null,get colyseusClient(){return _r},get colyseusRoom(){return E},connectColyseus:Cr,globalCardDataCache:In,loadAllCardData:Br},Symbol.toStringTag,{value:"Module"}));let pt;const Ha=new URLSearchParams(window.location.search),Mr=Ha.get("frame_id")!=null;let Vn;const Er="1363939642289946886",rr=Fi("user_id"),qc=Fi("guild_id"),Xc=Fi("channel_id"),Jc=async()=>{if(Mr){const n=Er;console.log("Discord SDK: Using embedded client ID:",n),Vn=new Gc(n),await Vn.ready()}else{Vn=new Za(Er,qc,Xc);const n=String(rr.charCodeAt(0)%5),t={access_token:"mock_token",user:{username:rr,discriminator:n,id:rr,avatar:null,public_flags:1},scopes:[],expires:new Date(2112,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}};Vn._updateCommandMocks({authenticate:async()=>(pt=t,console.log("Mock Authentication successful:",pt),await Cr(pt.access_token,pt.user.username),t),authorize:async()=>(console.log("Mock Authorize called"),{code:"mock_code"})})}},Qc=async()=>{if(!Mr){console.log("Running locally, attempting mock authentication...");try{return await Vn.commands.authenticate({}),!0}catch(t){return console.error("Mock authentication failed:",t),!1}}let n="authorize";try{console.log("Requesting Discord authorization...");const{code:t}=await Vn.commands.authorize({client_id:Er,response_type:"code",state:"",prompt:"none",scope:["identify","guilds"]});console.log("Authorization code received:",t),n="fetchToken",console.log("Fetching access token from /.proxy/api/token...");const e=await fetch("/.proxy/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})});if(console.log("Token fetch response received. Status:",e.status),!e.ok){const r=await e.text();throw console.error("Token fetch failed:",e.status,e.statusText,r),new Error(`Token fetch failed: ${e.status} ${e.statusText} - ${r}`)}const{access_token:s}=await e.json();if(console.log("Access token received successfully."),n="discordAuthenticate",console.log("Authenticating with Discord SDK..."),pt=await Vn.commands.authenticate({access_token:s}),!(pt!=null&&pt.user))throw console.error("Discord SDK Authentication failed: No user data received.",pt),new Error("Discord SDK Authentication failed to return user data.");console.log("Discord SDK Authentication successful:",pt.user.username),n="connectColyseus",console.log("Connecting to Colyseus...");try{await Cr(pt.access_token,pt.user.username),console.log("Colyseus connection successful.")}catch(r){throw console.error("Colyseus connection failed:",r),r}return!0}catch(t){return console.error(`Error during step: ${n}`),console.error("Discord authorization or Colyseus connection failed:",t),t instanceof ProgressEvent?console.error("Network error (ProgressEvent) occurred, likely during fetch."):t.message&&t.message.includes("Token fetch failed")?console.error("Error specifically during token fetch step."):n==="connectColyseus"&&console.error("Error specifically during Colyseus connection step."),pt=null,!1}},eu=()=>pt?pt.user.username:!Mr&&Vn instanceof Za?Fi("user_id")||"MockUser":"User";function Fi(n){const t=Ha.get(n);if(t!=null)return t;const e=sessionStorage.getItem(n);if(e!=null)return e;const s=Math.random().toString(36).slice(2,10);return sessionStorage.setItem(n,s),s}class tu extends pn.Scene{constructor(){super("Boot")}preload(){this.load.setPath("/assets"),this.load.image("background","bg.png"),this.load.image("fridge_bg","fridge_bg.png")}create(){this.scene.start("Preloader")}}class nu extends pn.Scene{constructor(){super("Game");q(this,"room")}async create(){this.scene.launch("background"),this.add.image(this.cameras.main.width*.5,this.cameras.main.height*.4,"grid").setScale(.6),await this.connect(),this.room.state.draggables.onAdd((s,r)=>{const a=this.add.image(s.x,s.y,r).setInteractive();a.name=r,a.setScale(.8),this.input.setDraggable(a),a.on("drag",(c,u,y)=>{this.room&&(a.x=Phaser.Math.Clamp(u,a.displayWidth/2,Number(this.game.config.width)-a.displayWidth/2),a.y=Phaser.Math.Clamp(y,a.displayHeight/2,Number(this.game.config.height)-a.displayHeight/2),this.room.send("move",{imageId:r,x:a.x,y:a.y}))})}),this.add.text(this.cameras.main.width*.5,this.cameras.main.height*.95,`Connected as: ${eu()}`,{font:"14px Arial",color:"#000000"}).setOrigin(.5)}async connect(){const e=location.host==="localhost:3000"?"ws://localhost:3001":`wss://${location.host}/.proxy/api/colyseus`,s=new cn.Client(`${e}`);try{this.room=await s.joinOrCreate("some_other_room",{screenWidth:this.game.config.width,screenHeight:this.game.config.height}),this.room.onMessage("move",r=>{}),console.log("Successfully connected!")}catch(r){console.log(`Could not connect with the server: ${r}`)}}}class su extends pn.Scene{constructor(){super("MainMenu");q(this,"statusText")}create(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let s=this.cameras.main.width/e.width+.2,r=this.cameras.main.height/e.height+.2,a=Math.max(s,r);e.setScale(a).setScrollFactor(0),this.add.text(Number(this.game.config.width)*.5,300,"Legends of the Friend",{fontFamily:"Arial Black",fontSize:58,color:"#ffff00",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(Number(this.game.config.width)*.5,460,"Click to Start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,520,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.input.once("pointerdown",async()=>{this.statusText.setText("Authorizing with Discord..."),await Qc()?(this.statusText.setText("Connecting to server..."),await new Promise(u=>setTimeout(u,1e3)),E?(this.statusText.setText("Loading game data..."),await Br()?(this.statusText.setText("Connected! Entering Lobby..."),this.scene.start("Lobby")):this.statusText.setText("Failed to load game data. Please try again.")):this.statusText.setText("Failed to connect to server. Please try again.")):this.statusText.setText("Discord authorization failed. Please try again.")})}}class iu extends pn.Scene{constructor(){super("Preloader")}init(){const t=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let e=this.cameras.main.width/t.width+.2,s=this.cameras.main.height/t.height+.2,r=Math.max(e,s);t.setScale(r).setScrollFactor(0),this.add.rectangle(Number(this.game.config.width)*.5,Number(this.game.config.height)*.5,468,32).setStrokeStyle(1,16777215);const a=this.add.rectangle(Number(this.game.config.width)*.5-230,Number(this.game.config.height)*.5,4,28,16777215);this.load.on("progress",c=>{a.width=4+460*c})}preload(){this.load.setPath("/assets"),this.load.image("logo","logo.png"),this.load.image("cardFullTier1","CardFullTier1.png"),this.load.image("cardMinionTier1","CardMinionTier1.png")}create(){this.scene.start("MainMenu")}}class ru extends pn.Scene{constructor(){super("background")}create(){this.cameras.main.setBackgroundColor(11393254),this.scene.sendToBack()}}const au="modulepreload",ou=function(n){return"/"+n},Xr={},lu=function(t,e,s){let r=Promise.resolve();if(e&&e.length>0){const a=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=Promise.all(e.map(y=>{if(y=ou(y),y in Xr)return;Xr[y]=!0;const p=y.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(!!s)for(let M=a.length-1;M>=0;M--){const H=a[M];if(H.href===y&&(!p||H.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${m}`))return;const I=document.createElement("link");if(I.rel=p?"stylesheet":au,p||(I.as="script",I.crossOrigin=""),I.href=y,u&&I.setAttribute("nonce",u),document.head.appendChild(I),p)return new Promise((M,H)=>{I.addEventListener("load",M),I.addEventListener("error",()=>H(new Error(`Unable to preload CSS for ${y}`)))})}))}return r.then(()=>t()).catch(a=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a})};var Tr={exports:{}};(function(n,t){(function(e,s){s(t)})(no,function(e){e.OPERATION=void 0,function(v){v[v.ADD=128]="ADD",v[v.REPLACE=0]="REPLACE",v[v.DELETE=64]="DELETE",v[v.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",v[v.MOVE_AND_ADD=160]="MOVE_AND_ADD",v[v.DELETE_AND_ADD=192]="DELETE_AND_ADD",v[v.CLEAR=10]="CLEAR",v[v.REVERSE=15]="REVERSE",v[v.MOVE=32]="MOVE",v[v.DELETE_BY_REFID=33]="DELETE_BY_REFID",v[v.ADD_BY_REFID=129]="ADD_BY_REFID"}(e.OPERATION||(e.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const a=Symbol("$track"),c=Symbol("$encoder"),u=Symbol("$decoder"),y=Symbol("$filter"),p=Symbol("$getByIndex"),m=Symbol("$deleteByIndex"),h=Symbol("$changes"),I=Symbol("$childType"),M=Symbol("$onEncodeEnd"),H=Symbol("$onDecodeEnd"),$=Symbol("$descriptors"),U="$__numFields",he="$__refTypeFieldIndexes",ae="$__viewFieldIndexes",X="$__fieldIndexesByViewTag";let Pe;try{Pe=new TextEncoder}catch{}const Ae=new ArrayBuffer(8),Ge=new Int32Array(Ae),Ze=new Float32Array(Ae),st=new Float64Array(Ae),ot=new BigInt64Array(Ae),Ce=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(v,i){for(var o=0,l=0,f=0,_=v.length;f<_;f++)o=v.charCodeAt(f),o<128?l+=1:o<2048?l+=2:o<55296||o>=57344?l+=3:(f++,l+=4);return l};function Oe(v,i,o){for(var l=0,f=0,_=i.length;f<_;f++)l=i.charCodeAt(f),l<128?v[o.offset++]=l:l<2048?(v[o.offset]=192|l>>6,v[o.offset+1]=128|l&63,o.offset+=2):l<55296||l>=57344?(v[o.offset]=224|l>>12,v[o.offset+1]=128|l>>6&63,v[o.offset+2]=128|l&63,o.offset+=3):(f++,l=65536+((l&1023)<<10|i.charCodeAt(f)&1023),v[o.offset]=240|l>>18,v[o.offset+1]=128|l>>12&63,v[o.offset+2]=128|l>>6&63,v[o.offset+3]=128|l&63,o.offset+=4)}function mn(v,i,o){v[o.offset++]=i&255}function it(v,i,o){v[o.offset++]=i&255}function ht(v,i,o){v[o.offset++]=i&255,v[o.offset++]=i>>8&255}function Wn(v,i,o){v[o.offset++]=i&255,v[o.offset++]=i>>8&255}function Et(v,i,o){v[o.offset++]=i&255,v[o.offset++]=i>>8&255,v[o.offset++]=i>>16&255,v[o.offset++]=i>>24&255}function Dt(v,i,o){const l=i>>24,f=i>>16,_=i>>8,S=i;v[o.offset++]=S&255,v[o.offset++]=_&255,v[o.offset++]=f&255,v[o.offset++]=l&255}function xt(v,i,o){const l=Math.floor(i/Math.pow(2,32)),f=i>>>0;Dt(v,f,o),Dt(v,l,o)}function Nt(v,i,o){const l=i/Math.pow(2,32)>>0,f=i>>>0;Dt(v,f,o),Dt(v,l,o)}function gs(v,i,o){ot[0]=BigInt.asIntN(64,i),Et(v,Ge[0],o),Et(v,Ge[1],o)}function Kn(v,i,o){ot[0]=BigInt.asIntN(64,i),Et(v,Ge[0],o),Et(v,Ge[1],o)}function mt(v,i,o){Ze[0]=i,Et(v,Ge[0],o)}function qt(v,i,o){st[0]=i,Et(v,Ge[0],o),Et(v,Ge[1],o)}function $t(v,i,o){v[o.offset++]=i?1:0}function ms(v,i,o){i||(i="");let l=Ce(i,"utf8"),f=0;if(l<32)v[o.offset++]=l|160,f=1;else if(l<256)v[o.offset++]=217,v[o.offset++]=l%255,f=2;else if(l<65536)v[o.offset++]=218,Wn(v,l,o),f=3;else if(l<4294967296)v[o.offset++]=219,Dt(v,l,o),f=5;else throw new Error("String too long");return Oe(v,i,o),f+l}function yn(v,i,o){if(isNaN(i))return yn(v,0,o);if(isFinite(i)){if(i!==(i|0))return Math.abs(i)<=34028235e31&&(Ze[0]=i,Math.abs(Math.abs(Ze[0])-Math.abs(i))<1e-4)?(v[o.offset++]=202,mt(v,i,o),5):(v[o.offset++]=203,qt(v,i,o),9)}else return yn(v,i>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,o);return i>=0?i<128?(v[o.offset++]=i&255,1):i<256?(v[o.offset++]=204,v[o.offset++]=i&255,2):i<65536?(v[o.offset++]=205,Wn(v,i,o),3):i<4294967296?(v[o.offset++]=206,Dt(v,i,o),5):(v[o.offset++]=207,Nt(v,i,o),9):i>=-32?(v[o.offset++]=224|i+32,1):i>=-128?(v[o.offset++]=208,mn(v,i,o),2):i>=-32768?(v[o.offset++]=209,ht(v,i,o),3):i>=-2147483648?(v[o.offset++]=210,Et(v,i,o),5):(v[o.offset++]=211,xt(v,i,o),9)}const be={int8:mn,uint8:it,int16:ht,uint16:Wn,int32:Et,uint32:Dt,int64:xt,uint64:Nt,bigint64:gs,biguint64:Kn,float32:mt,float64:qt,boolean:$t,string:ms,number:yn,utf8Write:Oe,utf8Length:Ce},Xt=new ArrayBuffer(8),yt=new Int32Array(Xt),Tt=new Float32Array(Xt),Yn=new Float64Array(Xt),On=new BigUint64Array(Xt),ys=new BigInt64Array(Xt);function qn(v,i,o){for(var l="",f=0,_=i.offset,S=i.offset+o;_<S;_++){var x=v[_];if(!(x&128)){l+=String.fromCharCode(x);continue}if((x&224)===192){l+=String.fromCharCode((x&31)<<6|v[++_]&63);continue}if((x&240)===224){l+=String.fromCharCode((x&15)<<12|(v[++_]&63)<<6|(v[++_]&63)<<0);continue}if((x&248)===240){f=(x&7)<<18|(v[++_]&63)<<12|(v[++_]&63)<<6|(v[++_]&63)<<0,f>=65536?(f-=65536,l+=String.fromCharCode((f>>>10)+55296,(f&1023)+56320)):l+=String.fromCharCode(f);continue}console.error("Invalid byte "+x.toString(16))}return i.offset+=o,l}function Xn(v,i){return Jt(v,i)<<24>>24}function Jt(v,i){return v[i.offset++]}function Jn(v,i){return Dn(v,i)<<16>>16}function Dn(v,i){return v[i.offset++]|v[i.offset++]<<8}function qe(v,i){return v[i.offset++]|v[i.offset++]<<8|v[i.offset++]<<16|v[i.offset++]<<24}function Vt(v,i){return qe(v,i)>>>0}function Qn(v,i){return yt[0]=qe(v,i),Tt[0]}function vs(v,i){return yt[0]=qe(v,i),yt[1]=qe(v,i),Yn[0]}function de(v,i){const o=Vt(v,i);return qe(v,i)*Math.pow(2,32)+o}function Rt(v,i){const o=Vt(v,i);return Vt(v,i)*Math.pow(2,32)+o}function d(v,i){return yt[0]=qe(v,i),yt[1]=qe(v,i),ys[0]}function b(v,i){return yt[0]=qe(v,i),yt[1]=qe(v,i),On[0]}function w(v,i){return Jt(v,i)>0}function D(v,i){const o=v[i.offset++];let l;return o<192?l=o&31:o===217?l=Jt(v,i):o===218?l=Dn(v,i):o===219&&(l=Vt(v,i)),qn(v,i,l)}function P(v,i){const o=v[i.offset++];if(o<128)return o;if(o===202)return Qn(v,i);if(o===203)return vs(v,i);if(o===204)return Jt(v,i);if(o===205)return Dn(v,i);if(o===206)return Vt(v,i);if(o===207)return Rt(v,i);if(o===208)return Xn(v,i);if(o===209)return Jn(v,i);if(o===210)return qe(v,i);if(o===211)return de(v,i);if(o>223)return(255-o+1)*-1}function R(v,i){const o=v[i.offset];return o<192&&o>160||o===217||o===218||o===219}const k={utf8Read:qn,int8:Xn,uint8:Jt,int16:Jn,uint16:Dn,int32:qe,uint32:Vt,float32:Qn,float64:vs,int64:de,uint64:Rt,bigint64:d,biguint64:b,boolean:w,string:D,number:P,stringCheck:R},C={},F=new Map;function ne(v,i){i.constructor&&(F.set(i.constructor,v),C[v]=i),i.encode&&(be[v]=i.encode),i.decode&&(k[v]=i.decode)}function _e(v){return C[v]}function ge(v){for(const i in v)ne(i,v[i]);return i=>wt(i)}const Bt=class Bt{static register(i){const o=Object.getPrototypeOf(i);if(o!==He){let l=Bt.inheritedTypes.get(o);l||(l=new Set,Bt.inheritedTypes.set(o,l)),l.add(i)}}static cache(i){let o=Bt.cachedContexts.get(i);return o||(o=new Bt(i),Bt.cachedContexts.set(i,o)),o}constructor(i){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},i&&this.discoverTypes(i)}has(i){return this.schemas.has(i)}get(i){return this.types[i]}add(i,o=this.schemas.size){return this.schemas.has(i)?!1:(this.types[o]=i,i[Symbol.metadata]===void 0&&De.initialize(i),this.schemas.set(i,o),!0)}getTypeId(i){return this.schemas.get(i)}discoverTypes(i,o,l,f){var x,N;if(f&&this.registerFilteredByParent(i,o,l),!this.add(i))return;(x=Bt.inheritedTypes.get(i))==null||x.forEach(B=>{this.discoverTypes(B,o,l,f)});let _=i;for(;(_=Object.getPrototypeOf(_))&&_!==He&&_!==Function.prototype;)this.discoverTypes(_);const S=i[N=Symbol.metadata]??(i[N]={});S[ae]&&(this.hasFilters=!0);for(const B in S){const V=B,z=S[V].type,G=S[V].tag!==void 0;if(typeof z!="string")if(Array.isArray(z)){const ie=z[0];if(ie==="string")continue;this.discoverTypes(ie,i,V,f||G)}else if(typeof z=="function")this.discoverTypes(z,i,V,f||G);else{const ie=Object.values(z)[0];if(typeof ie=="string")continue;this.discoverTypes(ie,i,V,f||G)}}}registerFilteredByParent(i,o,l){let _=`${this.schemas.get(i)??this.schemas.size}`;o&&(_+=`-${this.schemas.get(o)}`),_+=`-${l}`,this.parentFiltered[_]=!0}debug(){let i="";for(const o in this.parentFiltered){const l=o.split("-").map(Number),f=l.pop();i+=`
		`,i+=`${o}: ${l.reverse().map((_,S)=>{const x=this.types[_],N=x[Symbol.metadata];let B=x.name;return S===0&&(B+=`[${N[f].name}]`),`${B}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${i}`}};Bt.inheritedTypes=new Map,Bt.cachedContexts=new Map;let ye=Bt;function et(v){return Array.isArray(v)?{array:v[0]}:typeof v.type<"u"?v.type:v}const De={addField(v,i,o,l,f){if(i>64)throw new Error(`Can't define field '${o}'.
Schema instances may only have up to 64 fields.`);v[i]=Object.assign(v[i]||{},{type:et(l),index:i,name:o}),Object.defineProperty(v,$,{value:v[$]||{},enumerable:!1,configurable:!0}),f?(v[$][o]=f,v[$][`_${o}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):v[$][o]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(v,U,{value:i,enumerable:!1,configurable:!0}),Object.defineProperty(v,o,{value:i,enumerable:!1,configurable:!0}),typeof v[i].type!="string"&&(v[he]===void 0&&Object.defineProperty(v,he,{value:[],enumerable:!1,configurable:!0}),v[he].push(i))},setTag(v,i,o){const l=v[i],f=v[l];f.tag=o,v[ae]||(Object.defineProperty(v,ae,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(v,X,{value:{},enumerable:!1,configurable:!0})),v[ae].push(l),v[X][o]||(v[X][o]=[]),v[X][o].push(l)},setFields(v,i){const o=v.prototype.constructor;ye.register(o);const l=Object.getPrototypeOf(o),f=l&&l[Symbol.metadata],_=De.initialize(o);o[a]||(o[a]=He[a]),o[c]||(o[c]=He[c]),o[u]||(o[u]=He[u]),o.prototype.toJSON||(o.prototype.toJSON=He.prototype.toJSON);let S=_[U]??(f&&f[U])??-1;S++;for(const x in i){const N=i[x],B=Array.isArray(N)?_e("array"):typeof Object.keys(N)[0]=="string"&&_e(Object.keys(N)[0]),V=B?Object.values(N)[0]:et(N);De.addField(_,S,x,N,hi(`_${x}`,S,V,B)),S++}return v},isDeprecated(v,i){return v[i].deprecated===!0},init(v){const i={};v[Symbol.metadata]=i,Object.defineProperty(i,U,{value:0,enumerable:!1,configurable:!0})},initialize(v){const i=Object.getPrototypeOf(v),o=i[Symbol.metadata];let l=v[Symbol.metadata]??Object.create(null);return i!==He&&l===o&&(l=Object.create(null),o&&(Object.setPrototypeOf(l,o),Object.defineProperty(l,U,{value:o[U],enumerable:!1,configurable:!0,writable:!0}),o[ae]!==void 0&&(Object.defineProperty(l,ae,{value:[...o[ae]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(l,X,{value:{...o[X]},enumerable:!1,configurable:!0,writable:!0})),o[he]!==void 0&&Object.defineProperty(l,he,{value:[...o[he]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(l,$,{value:{...o[$]},enumerable:!1,configurable:!0,writable:!0}))),v[Symbol.metadata]=l,l},isValidInstance(v){return v.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(v.constructor[Symbol.metadata],U)},getFields(v){const i=v[Symbol.metadata],o={};for(let l=0;l<=i[U];l++)o[i[l].name]=i[l].type;return o},hasViewTagAtIndex(v,i){var o;return(o=v==null?void 0:v[ae])==null?void 0:o.includes(i)}};function Qt(){return{indexes:{},operations:[]}}function Xe(v,i){const o=v.indexes[i];o===void 0?v.indexes[i]=v.operations.push(i)-1:v.operations[o]=i}function ri(v,i){var l;let o=v.indexes[i];o===void 0&&(o=Object.values(v.indexes).at(-1),i=(l=Object.entries(v.indexes).find(([f,_])=>_===o))==null?void 0:l[0]),v.operations[o]=void 0,delete v.indexes[i]}function Je(v,i,o,l=i[o].queueRootIndex){if(v)v[o][l]!==i&&(i[o].queueRootIndex=v[o].push(i)-1);else return}class Pt{constructor(i){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=i;const o=i.constructor[Symbol.metadata];o!=null&&o[ae]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(i){var l;this.root=i,this.checkIsFiltered(this.parent,this.parentIndex);const o=this.ref.constructor[Symbol.metadata];o?(l=o[he])==null||l.forEach(f=>{const _=o[f],S=this.ref[_.name];S==null||S[h].setRoot(i)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((f,_)=>{f[h].setRoot(i)})}setParent(i,o,l){var _;if(this.parent=i,this.parentIndex=l,!o)return;o!==this.root?(this.root=o,this.checkIsFiltered(i,l)):o.add(this);const f=this.ref.constructor[Symbol.metadata];f?(_=f[he])==null||_.forEach(S=>{const x=f[S],N=this.ref[x.name];N==null||N[h].setParent(this.ref,o,S)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((S,x)=>{S[h].setParent(this.ref,o,this.indexes[x]??x)})}forEachChild(i){var l;const o=this.ref.constructor[Symbol.metadata];o?(l=o[he])==null||l.forEach(f=>{const _=o[f],S=this.ref[_.name];S&&i(S[h],f)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((f,_)=>{i(f[h],this.indexes[_]??_)})}operation(i){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-i),Je(this.root,this,"filteredChanges")):(this.changes.operations.push(-i),Je(this.root,this,"changes"))}change(i,o=e.OPERATION.ADD){var x;const l=this.ref.constructor[Symbol.metadata],f=this.isFiltered||((x=l==null?void 0:l[i])==null?void 0:x.tag)!==void 0,_=f?this.filteredChanges:this.changes,S=this.indexedOperations[i];if(!S||S===e.OPERATION.DELETE){const N=S&&S===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:o;this.indexedOperations[i]=N}Xe(_,i),f?(Xe(this.allFilteredChanges,i),this.root&&(Je(this.root,this,"filteredChanges"),Je(this.root,this,"allFilteredChanges"))):(Xe(this.allChanges,i),Je(this.root,this,"changes"))}shiftChangeIndexes(i){const o=this.isFiltered?this.filteredChanges:this.changes,l={},f={};for(const _ in this.indexedOperations)l[Number(_)+i]=this.indexedOperations[_],f[Number(_)+i]=o.indexes[_];this.indexedOperations=l,o.indexes=f,o.operations=o.operations.map(_=>_+i)}shiftAllChangeIndexes(i,o=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(i,o,this.allFilteredChanges),this._shiftAllChangeIndexes(i,o,this.allChanges)):this._shiftAllChangeIndexes(i,o,this.allChanges)}_shiftAllChangeIndexes(i,o=0,l){const f={};let _=0;for(const S in l.indexes)f[_++]=l.indexes[S];l.indexes=f;for(let S=0;S<l.operations.length;S++){const x=l.operations[S];x>o&&(l.operations[S]=x+i)}}indexedOperation(i,o,l=i){this.indexedOperations[i]=o,this.filteredChanges!==void 0?(Xe(this.allFilteredChanges,l),Xe(this.filteredChanges,i),Je(this.root,this,"filteredChanges")):(Xe(this.allChanges,l),Xe(this.changes,i),Je(this.root,this,"changes"))}getType(i){return De.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][i].type:this.ref[I]}getChange(i){return this.indexedOperations[i]}getValue(i,o=!1){return this.ref[p](i,o)}delete(i,o,l=i){var S;if(i===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${i}'`)}catch(x){console.warn(x)}return}const f=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[i]=o??e.OPERATION.DELETE,Xe(f,i),ri(this.allChanges,l);const _=this.getValue(i);return _&&_[h]&&((S=this.root)==null||S.remove(_[h])),this.filteredChanges!==void 0?(ri(this.allFilteredChanges,l),Je(this.root,this,"filteredChanges")):Je(this.root,this,"changes"),_}endEncode(i){var o,l;this.indexedOperations={},this[i].indexes={},this[i].operations.length=0,this[i].queueRootIndex=void 0,(l=(o=this.ref)[M])==null||l.call(o),this.isNew=!1}discard(i=!1){var o,l;(l=(o=this.ref)[M])==null||l.call(o),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),i&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((f,_)=>{var S;return(S=this.root)==null?void 0:S.remove(f)}))}discardAll(){const i=Object.keys(this.indexedOperations);for(let o=0,l=i.length;o<l;o++){const f=this.getValue(Number(i[o]));f&&f[h]&&f[h].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(i,o){const l=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(i,o),this.filteredChanges!==void 0&&(Je(this.root,this,"filteredChanges"),l&&this.root.allFilteredChanges.push(this))),this.isFiltered||(Je(this.root,this,"changes"),l&&this.root.allChanges.push(this))}_checkFilteredByParent(i,o){if(!i)return;const l=De.isValidInstance(this.ref)?this.ref.constructor:this.ref[I];let f,_=!De.isValidInstance(i);_?(f=i[h],i=f.parent,o=f.parentIndex):f=i[h];const S=i.constructor;let x=`${this.root.types.getTypeId(l)}`;S&&(x+=`-${this.root.types.schemas.get(S)}`),x+=`-${o}`;const N=De.hasViewTagAtIndex(S==null?void 0:S[Symbol.metadata],o);this.isFiltered=i[h].isFiltered||this.root.types.parentFiltered[x]||N,this.isFiltered&&(this.isVisibilitySharedWithParent=f.isFiltered&&typeof l!="string"&&!N&&_,this.filteredChanges||(this.filteredChanges=Qt(),this.allFilteredChanges=Qt()),this.changes.operations.length>0&&(this.changes.operations.forEach(B=>Xe(this.filteredChanges,B)),this.allChanges.operations.forEach(B=>Xe(this.allFilteredChanges,B)),this.changes=Qt(),this.allChanges=Qt()))}}function es(v,i,o,l,f,_){var S;typeof o=="string"?(S=be[o])==null||S.call(be,i,l,_):o[Symbol.metadata]!==void 0?(be.number(i,l[h].refId,_),(f&e.OPERATION.ADD)===e.OPERATION.ADD&&v.tryEncodeTypeId(i,o,l.constructor,_)):be.number(i,l[h].refId,_)}const bs=function(v,i,o,l,f,_,S,x,N){if(i[_.offset++]=(l|f)&255,f===e.OPERATION.DELETE)return;const B=o.ref,V=N[l];es(v,i,N[l].type,B[V.name],f,_)},xn=function(v,i,o,l,f,_){if(i[_.offset++]=f&255,f===e.OPERATION.CLEAR||(be.number(i,l,_),f===e.OPERATION.DELETE))return;const S=o.ref;if((f&e.OPERATION.ADD)===e.OPERATION.ADD&&typeof S.set=="function"){const B=o.ref.$indexes.get(l);be.string(i,B,_)}const x=S[I],N=S[p](l);es(v,i,x,N,f,_)},Nn=function(v,i,o,l,f,_,S,x){const N=o.ref,B=x&&o.isFiltered&&typeof o.getType(l)!="string";let V;if(B?(V=N.tmpItems[l][h].refId,f===e.OPERATION.DELETE?f=e.OPERATION.DELETE_BY_REFID:f===e.OPERATION.ADD&&(f=e.OPERATION.ADD_BY_REFID)):V=l,i[_.offset++]=f&255,f===e.OPERATION.CLEAR||f===e.OPERATION.REVERSE||(be.number(i,V,_),f===e.OPERATION.DELETE||f===e.OPERATION.DELETE_BY_REFID))return;const z=o.getType(l),G=o.getValue(l,S);es(v,i,z,G,f,_)},ai=-1;function Cs(v,i,o,l,f,_,S,x){const N=v.root,B=o[p](l);let V;if((i&e.OPERATION.DELETE)===e.OPERATION.DELETE){const z=N.refIds.get(B);z!==void 0&&N.removeRef(z),i!==e.OPERATION.DELETE_AND_ADD&&o[m](l),V=void 0}if(i!==e.OPERATION.DELETE)if(He.is(f)){const z=k.number(_,S);if(V=N.refs.get(z),(i&e.OPERATION.ADD)===e.OPERATION.ADD){const G=v.getInstanceType(_,S,f);V||(V=v.createInstanceOfType(G)),N.addRef(z,V,V!==B||i===e.OPERATION.DELETE_AND_ADD&&V===B)}}else if(typeof f=="string")V=k[f](_,S);else{const z=_e(Object.keys(f)[0]),G=k.number(_,S),ie=N.refs.has(G)?B||N.refs.get(G):new z.constructor;if(V=ie.clone(!0),V[I]=Object.values(f)[0],B){let te=N.refIds.get(B);if(te!==void 0&&G!==te){const Y=B.entries();let Z;for(;(Z=Y.next())&&!Z.done;){const[se,xe]=Z.value;typeof xe=="object"&&(te=N.refIds.get(xe),N.removeRef(te)),x.push({ref:B,refId:te,op:e.OPERATION.DELETE,field:se,value:void 0,previousValue:xe})}}}N.addRef(G,V,ie!==B||i===e.OPERATION.DELETE_AND_ADD&&ie===B)}return{value:V,previousValue:B}}const oi=function(v,i,o,l,f){const _=i[o.offset++],S=l.constructor[Symbol.metadata],x=_>>6<<6,N=_%(x||255),B=S[N];if(B===void 0)return console.warn("@colyseus/schema: field not defined at",{index:N,ref:l.constructor.name,metadata:S}),ai;const{value:V,previousValue:z}=Cs(v,x,l,N,B.type,i,o,f);V!=null&&(l[B.name]=V),z!==V&&f.push({ref:l,refId:v.currentRefId,op:x,field:B.name,value:V,previousValue:z})},_s=function(v,i,o,l,f){const _=i[o.offset++];if(_===e.OPERATION.CLEAR){v.removeChildRefs(l,f),l.clear();return}const S=k.number(i,o),x=l[I];let N;(_&e.OPERATION.ADD)===e.OPERATION.ADD?typeof l.set=="function"?(N=k.string(i,o),l.setIndex(S,N)):N=S:N=l.getIndex(S);const{value:B,previousValue:V}=Cs(v,_,l,S,x,i,o,f);if(B!=null){if(typeof l.set=="function")l.$items.set(N,B);else if(typeof l.$setAt=="function")l.$setAt(S,B,_);else if(typeof l.add=="function"){const z=l.add(B);typeof z=="number"&&l.setIndex(z,z)}}V!==B&&f.push({ref:l,refId:v.currentRefId,op:_,field:"",dynamicIndex:N,value:B,previousValue:V})},Zi=function(v,i,o,l,f){let _=i[o.offset++],S;if(_===e.OPERATION.CLEAR){v.removeChildRefs(l,f),l.clear();return}else if(_===e.OPERATION.REVERSE){l.reverse();return}else if(_===e.OPERATION.DELETE_BY_REFID){const z=k.number(i,o),G=v.root.refs.get(z);S=l.findIndex(ie=>ie===G),l[m](S),f.push({ref:l,refId:v.currentRefId,op:e.OPERATION.DELETE,field:"",dynamicIndex:S,value:void 0,previousValue:G});return}else if(_===e.OPERATION.ADD_BY_REFID){const z=k.number(i,o),G=v.root.refs.get(z);G&&(S=l.findIndex(ie=>ie===G)),(S===-1||S===void 0)&&(S=l.length)}else S=k.number(i,o);const x=l[I];let N=S;const{value:B,previousValue:V}=Cs(v,_,l,S,x,i,o,f);B!=null&&B!==V&&l.$setAt(S,B,_),V!==B&&f.push({ref:l,refId:v.currentRefId,op:_,field:"",dynamicIndex:N,value:B,previousValue:V})};class ts extends Error{}function Ms(v,i,o,l){let f,_=!1;switch(i){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":f="number",isNaN(v)&&console.log(`trying to encode "NaN" in ${o.constructor.name}#${l}`);break;case"bigint64":case"biguint64":f="bigint";break;case"string":f="string",_=!0;break;case"boolean":return;default:return}if(typeof v!==f&&(!_||_&&v!==null)){let S=`'${JSON.stringify(v)}'${v&&v.constructor&&` (${v.constructor.name})`||""}`;throw new ts(`a '${f}' was expected, but ${S} was provided in ${o.constructor.name}#${l}`)}}function ns(v,i,o,l){if(!(v instanceof i))throw new ts(`a '${i.name}' was expected, but '${v&&v.constructor.name}' was provided in ${o.constructor.name}#${l}`)}var en,li;const Hi=(v,i)=>{const o=v.toString(),l=i.toString();return o<l?-1:o>l?1:0},It=class It{static[(en=c,li=u,y)](i,o,l){var f;return!l||typeof i[I]=="string"||l.isChangeTreeVisible((f=i.tmpItems[o])==null?void 0:f[h])}static is(i){return Array.isArray(i)||i.array!==void 0}static from(i){return new It(...Array.from(i))}constructor(...i){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const o=new Proxy(this,{get:(l,f)=>typeof f!="symbol"&&!isNaN(f)?this.items[f]:Reflect.get(l,f),set:(l,f,_)=>{var S;if(typeof f!="symbol"&&!isNaN(f)){if(_==null)l.$deleteAt(f);else{if(_[h]){ns(_,l[I],l,f);const x=l.items[f];l.isMovingItems?(x!==void 0?_[h].isNew?l[h].indexedOperation(Number(f),e.OPERATION.MOVE_AND_ADD):(l[h].getChange(Number(f))&e.OPERATION.DELETE)===e.OPERATION.DELETE?l[h].indexedOperation(Number(f),e.OPERATION.DELETE_AND_MOVE):l[h].indexedOperation(Number(f),e.OPERATION.MOVE):_[h].isNew&&l[h].indexedOperation(Number(f),e.OPERATION.ADD),_[h].setParent(this,l[h].root,f)):l.$changeAt(Number(f),_),x!==void 0&&((S=x[h].root)==null||S.remove(x[h]))}else l.$changeAt(Number(f),_);l.items[f]=_,l.tmpItems[f]=_}return!0}else return Reflect.set(l,f,_)},deleteProperty:(l,f)=>(typeof f=="number"?l.$deleteAt(f):delete l[f],!0),has:(l,f)=>typeof f!="symbol"&&!isNaN(Number(f))?Reflect.has(this.items,f):Reflect.has(l,f)});return this[h]=new Pt(o),this[h].indexes={},i.length>0&&this.push(...i),o}set length(i){i===0?this.clear():i<this.items.length?this.splice(i,this.length-i):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...i){var f;let o=this.tmpItems.length;const l=this[h];for(let _=0,S=i.length;_<i.length;_++,o++){const x=i[_];if(x==null)return;typeof x=="object"&&this[I]&&ns(x,this[I],this,_),l.indexedOperation(o,e.OPERATION.ADD,this.items.length),this.items.push(x),this.tmpItems.push(x),(f=x[h])==null||f.setParent(this,l.root,o)}return o}pop(){let i=-1;for(let o=this.tmpItems.length-1;o>=0;o--)if(this.deletedIndexes[o]!==!0){i=o;break}if(!(i<0))return this[h].delete(i,void 0,this.items.length-1),this.deletedIndexes[i]=!0,this.items.pop()}at(i){return i<0&&(i+=this.length),this.items[i]}$changeAt(i,o){var _;if(o==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[i]===o)return;const l=this.items[i]!==void 0?typeof o=="object"?e.OPERATION.DELETE_AND_ADD:e.OPERATION.REPLACE:e.OPERATION.ADD,f=this[h];f.change(i,l),(_=o[h])==null||_.setParent(this,f.root,i)}$deleteAt(i,o){this[h].delete(i,o)}$setAt(i,o,l){i===0&&l===e.OPERATION.ADD&&this.items[i]!==void 0?this.items.unshift(o):l===e.OPERATION.DELETE_AND_MOVE?(this.items.splice(i,1),this.items[i]=o):this.items[i]=o}clear(){if(this.items.length===0)return;const i=this[h];i.forEachChild((o,l)=>{o.discard(!0);const f=o.root;f!==void 0&&(f.removeChangeFromChangeSet("changes",o),f.removeChangeFromChangeSet("allChanges",o),f.removeChangeFromChangeSet("allFilteredChanges",o))}),i.discard(!0),i.operation(e.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...i){return new It(...this.items.concat(...i))}join(i){return this.items.join(i)}reverse(){return this[h].operation(e.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const i=this[h],o=this.tmpItems.findIndex(f=>f===this.items[0]),l=this.items.findIndex(f=>f===this.items[0]);return i.delete(o,e.OPERATION.DELETE,l),i.shiftAllChangeIndexes(-1,l),this.items.shift()}slice(i,o){const l=new It;return l.push(...this.items.slice(i,o)),l}sort(i=Hi){this.isMovingItems=!0;const o=this[h];return this.items.sort(i).forEach((f,_)=>o.change(_,e.OPERATION.REPLACE)),this.tmpItems.sort(i),this.isMovingItems=!1,this}splice(i,o,...l){var B;const f=this[h],_=this.items.length,S=this.tmpItems.length,x=l.length,N=[];for(let V=0;V<S;V++)this.deletedIndexes[V]!==!0&&N.push(V);if(_>i){o===void 0&&(o=_-i);for(let V=i;V<i+o;V++){const z=N[V];f.delete(z,e.OPERATION.DELETE),this.deletedIndexes[z]=!0}}else o=0;if(x>0){if(x>o)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let V=0;V<x;V++){const z=(N[i]??_)+V;f.indexedOperation(z,this.deletedIndexes[z]?e.OPERATION.DELETE_AND_ADD:e.OPERATION.ADD),(B=l[V][h])==null||B.setParent(this,f.root,z)}}return o>x&&f.shiftAllChangeIndexes(-(o-x),N[i+x]),f.filteredChanges!==void 0?Je(f.root,f,"filteredChanges"):Je(f.root,f,"changes"),this.items.splice(i,o,...l)}unshift(...i){const o=this[h];return o.shiftChangeIndexes(i.length),o.isFiltered?Xe(o.filteredChanges,this.items.length):Xe(o.allChanges,this.items.length),i.forEach((l,f)=>{o.change(f,e.OPERATION.ADD)}),this.tmpItems.unshift(...i),this.items.unshift(...i)}indexOf(i,o){return this.items.indexOf(i,o)}lastIndexOf(i,o=this.length-1){return this.items.lastIndexOf(i,o)}every(i,o){return this.items.every(i,o)}some(i,o){return this.items.some(i,o)}forEach(i,o){return this.items.forEach(i,o)}map(i,o){return this.items.map(i,o)}filter(i,o){return this.items.filter(i,o)}reduce(i,o){return this.items.reduce(i,o)}reduceRight(i,o){return this.items.reduceRight(i,o)}find(i,o){return this.items.find(i,o)}findIndex(i,o){return this.items.findIndex(i,o)}fill(i,o,l){throw new Error("ArraySchema#fill() not implemented")}copyWithin(i,o,l){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return It}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(i,o){return this.items.includes(i,o)}flatMap(i,o){throw new Error("ArraySchema#flatMap() is not supported.")}flat(i){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...i){return this.items.findLastIndex.apply(this.items,arguments)}with(i,o){const l=this.items.slice();return i<0&&(i+=this.length),l[i]=o,new It(...l)}toReversed(){return this.items.slice().reverse()}toSorted(i){return this.items.slice().sort(i)}toSpliced(i,o,...l){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(i=>{let o=this.items.length;for(;o!=0;){let l=Math.floor(Math.random()*o);o--,[this[o],this[l]]=[this[l],this[o]]}})}move(i){return this.isMovingItems=!0,i(this),this.isMovingItems=!1,this}[p](i,o=!1){return o?this.items[i]:this.deletedIndexes[i]?this.items[i]:this.tmpItems[i]||this.items[i]}[m](i){this.items[i]=void 0,this.tmpItems[i]=void 0}[M](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[H](){this.items=this.items.filter(i=>i!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(i=>typeof i.toJSON=="function"?i.toJSON():i)}clone(i){let o;return i?(o=new It,o.push(...this.items)):o=new It(...this.map(l=>l[h]?l.clone():l)),o}};It[en]=Nn,It[li]=Zi;let Lt=It;ne("array",{constructor:Lt});var ci,ui;const sn=class sn{static[(ci=c,ui=u,y)](i,o,l){return!l||typeof i[I]=="string"||l.isChangeTreeVisible((i[p](o)??i.deletedItems[o])[h])}static is(i){return i.map!==void 0}constructor(i){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[h]=new Pt(this),this[h].indexes={},i)if(i instanceof Map||i instanceof sn)i.forEach((o,l)=>this.set(l,o));else for(const o in i)this.set(o,i[o]);Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return sn}set(i,o){var x;if(o==null)throw new Error(`MapSchema#set('${i}', ${o}): trying to set ${o} value on '${i}'.`);typeof o=="object"&&this[I]&&ns(o,this[I],this,i),i=i.toString();const l=this[h],f=o[h]!==void 0;let _,S;if(typeof l.indexes[i]<"u"){_=l.indexes[i],S=e.OPERATION.REPLACE;const N=this.$items.get(i);if(N===o)return;f&&(S=e.OPERATION.DELETE_AND_ADD,N!==void 0&&((x=N[h].root)==null||x.remove(N[h])))}else _=l.indexes[U]??0,S=e.OPERATION.ADD,this.$indexes.set(_,i),l.indexes[i]=_,l.indexes[U]=_+1;return this.$items.set(i,o),l.change(_,S),f&&o[h].setParent(this,l.root,_),this}get(i){return this.$items.get(i)}delete(i){const o=this[h].indexes[i];return this.deletedItems[o]=this[h].delete(o),this.$items.delete(i)}clear(){const i=this[h];i.discard(!0),i.indexes={},this.$indexes.clear(),this.$items.clear(),i.operation(e.OPERATION.CLEAR)}has(i){return this.$items.has(i)}forEach(i){this.$items.forEach(i)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(i,o){this.$indexes.set(i,o)}getIndex(i){return this.$indexes.get(i)}[p](i){return this.$items.get(this.$indexes.get(i))}[m](i){const o=this.$indexes.get(i);this.$items.delete(o),this.$indexes.delete(i)}[M](){this.deletedItems={}}toJSON(){const i={};return this.forEach((o,l)=>{i[l]=typeof o.toJSON=="function"?o.toJSON():o}),i}clone(i){let o;return i?o=Object.assign(new sn,this):(o=new sn,this.forEach((l,f)=>{l[h]?o.set(f,l.clone()):o.set(f,l)})),o}};sn[ci]=xn,sn[ui]=_s;let tt=sn;ne("map",{constructor:tt});const Ft=-1;function ji(v){return ye.register(v),v}function di(v=Ft){return function(i,o){var x;const l=i.constructor,_=Object.getPrototypeOf(l)[Symbol.metadata],S=l[x=Symbol.metadata]??(l[x]=Object.assign({},l[Symbol.metadata],_??Object.create(null)));De.setTag(S,o,v)}}function wt(v,i){return function(o,l){const f=o.constructor;if(!v)throw new Error(`${f.name}: @type() reference provided for "${l}" is undefined. Make sure you don't have any circular dependencies.`);ye.register(f);const S=Object.getPrototypeOf(f)[Symbol.metadata],x=De.initialize(f);let N=x[l];if(x[N]!==void 0){if(x[N].deprecated)return;if(x[N].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${l}' definition on '${f.name}'.
Check @type() annotation`)}catch(B){const V=B.stack.split(`
`)[4].trim();throw new Error(`${B.message} ${V}`)}}else N=x[U]??(S&&S[U])??-1,N++;if(i&&i.manual)De.addField(x,N,l,v,{enumerable:!0,configurable:!0,writable:!0});else{const B=Array.isArray(v)?_e("array"):typeof Object.keys(v)[0]=="string"&&_e(Object.keys(v)[0]),V=B?Object.values(v)[0]:v;De.addField(x,N,l,v,hi(`_${l}`,N,V,B))}}}function hi(v,i,o,l){return{get:function(){return this[v]},set:function(f){var S,x;const _=this[v]??void 0;if(f!==_){if(f!=null){l?(l.constructor===Lt&&!(f instanceof Lt)&&(f=new Lt(...f)),l.constructor===tt&&!(f instanceof tt)&&(f=new tt(f)),f[I]=o):typeof o!="string"?ns(f,o,this,v.substring(1)):Ms(f,o,this,v.substring(1));const N=this[h];_!==void 0&&_[h]?((S=N.root)==null||S.remove(_[h]),this.constructor[a](N,i,e.OPERATION.DELETE_AND_ADD)):this.constructor[a](N,i,e.OPERATION.ADD),(x=f[h])==null||x.setParent(this,N.root,i)}else _!==void 0&&this[h].delete(i);this[v]=f}},enumerable:!0,configurable:!0}}function Gt(v=!0){return function(i,o){var N;const l=i.constructor,_=Object.getPrototypeOf(l)[Symbol.metadata],S=l[N=Symbol.metadata]??(l[N]=Object.assign({},l[Symbol.metadata],_??Object.create(null))),x=S[o];S[x].deprecated=!0,v&&(S[$]??(S[$]={}),S[$][o]={get:function(){throw new Error(`${o} is deprecated.`)},set:function(B){},enumerable:!1,configurable:!0}),Object.defineProperty(S,x,{value:S[x],enumerable:!1,configurable:!0})}}function zi(v,i,o){for(let l in i)wt(i[l],o)(v.prototype,l);return v}function fi(v,i,o=He){const l={},f={};for(let S in v){const x=v[S];typeof x=="object"&&(x.default!==void 0&&(l[S]=x.default),x.view!==void 0&&(f[S]=typeof x.view=="boolean"?Ft:x.view))}const _=De.setFields(class extends o{constructor(...S){S[0]=Object.assign({},l,S[0]),super(...S)}},v);for(let S in f)di(f[S])(_.prototype,S);return i&&Object.defineProperty(_,"name",{value:i}),_.extends=(S,x)=>fi(S,x,_),_}function Es(v){return new Array(v).fill(0).map((i,o)=>o===v-1?" ":"   ").join("")}function Wi(v){const i=v[h].root,o={ops:{},refs:[]};return i.changes.forEach(l=>{if(l===void 0)return;const f=l.indexedOperations;o.refs.push(`refId#${l.refId}`);for(const _ in f){const S=f[_],x=e.OPERATION[S];o.ops[x]||(o.ops[x]=0),o.ops[e.OPERATION[S]]++}}),o}var pi,ss;const as=class as{static initialize(i){var o;Object.defineProperty(i,h,{value:new Pt(i),enumerable:!1,writable:!0}),Object.defineProperties(i,((o=i.constructor[Symbol.metadata])==null?void 0:o[$])||{})}static is(i){return typeof i[Symbol.metadata]=="object"}static[(pi=c,ss=u,a)](i,o,l=e.OPERATION.ADD){i.change(o,l)}static[y](i,o,l){var S,x;const _=(S=i.constructor[Symbol.metadata][o])==null?void 0:S.tag;if(l===void 0)return _===void 0;if(_===void 0)return!0;if(_===Ft)return l.isChangeTreeVisible(i[h]);{const N=(x=l.tags)==null?void 0:x.get(i[h]);return N&&N.has(_)}}constructor(...i){as.initialize(this),i[0]&&Object.assign(this,i[0])}assign(i){return Object.assign(this,i),this}setDirty(i,o){const l=this.constructor[Symbol.metadata];this[h].change(l[l[i]].index,o)}clone(){var l;const i=new this.constructor,o=this.constructor[Symbol.metadata];for(const f in o){const _=o[f].name;typeof this[_]=="object"&&typeof((l=this[_])==null?void 0:l.clone)=="function"?i[_]=this[_].clone():i[_]=this[_]}return i}toJSON(){const i={},o=this.constructor[Symbol.metadata];for(const l in o){const f=o[l],_=f.name;!f.deprecated&&this[_]!==null&&typeof this[_]<"u"&&(i[_]=typeof this[_].toJSON=="function"?this[_].toJSON():this[_])}return i}discardAllChanges(){this[h].discardAll()}[p](i){const o=this.constructor[Symbol.metadata];return this[o[i].name]}[m](i){const o=this.constructor[Symbol.metadata];this[o[i].name]=void 0}static debugRefIds(i,o=!1,l=0){const f=o?` - ${JSON.stringify(i.toJSON())}`:"",_=i[h],S=_.refId;let x="";return x+=`${Es(l)}${i.constructor.name} (refId: ${S})${f}
`,_.forEachChild(N=>x+=this.debugRefIds(N.ref,o,l+1)),x}static debugChanges(i,o=!1){const l=i[h],f=o?l.allChanges:l.changes,_=o?"allChanges":"changes";let S=`${i.constructor.name} (${l.refId}) -> .${_}:
`;function x(N){N.operations.filter(B=>B).forEach(B=>{const V=l.indexedOperations[B];console.log({index:B,operation:V}),S+=`- [${B}]: ${e.OPERATION[V]} (${JSON.stringify(l.getValue(Number(B),o))})
`})}return x(f),!o&&l.filteredChanges&&l.filteredChanges.operations.filter(N=>N).length>0&&(S+=`${i.constructor.name} (${l.refId}) -> .filteredChanges:
`,x(l.filteredChanges)),o&&l.allFilteredChanges&&l.allFilteredChanges.operations.filter(N=>N).length>0&&(S+=`${i.constructor.name} (${l.refId}) -> .allFilteredChanges:
`,x(l.allFilteredChanges)),S}static debugChangesDeep(i,o="changes"){var V,z;let l="";const f=i[h],_=f.root,S=new Map,x=[];let N=0;for(const[G,ie]of Object.entries(_[o])){const te=_.changeTrees[G];let Y=!1,Z=[],se=(V=te.parent)==null?void 0:V[h];if(te===f)Y=!0;else for(;se!==void 0;){if(Z.push(se),se.ref===i){Y=!0;break}se=(z=se.parent)==null?void 0:z[h]}Y&&(x.push(te.refId),N+=Object.keys(ie).length,S.set(te,Z.reverse()))}l+=`---
`,l+=`root refId: ${f.refId}
`,l+=`Total instances: ${x.length} (refIds: ${x.join(", ")})
`,l+=`Total changes: ${N}
`,l+=`---
`;const B=new WeakSet;for(const[G,ie]of S.entries()){ie.forEach((xe,Be)=>{B.has(xe)||(l+=`${Es(Be)}${xe.ref.constructor.name} (refId: ${xe.refId})
`,B.add(xe))});const te=G.indexedOperations,Y=ie.length,Z=Es(Y),se=Y>0?`(${G.parentIndex}) `:"";l+=`${Z}${se}${G.ref.constructor.name} (refId: ${G.refId}) - changes: ${Object.keys(te).length}
`;for(const xe in te){const Be=te[xe];l+=`${Es(Y+1)}${e.OPERATION[Be]}: ${xe}
`}}return`${l}`}};as[pi]=bs,as[ss]=oi;let He=as;var gi,kt;const Ln=class Ln{static[(gi=c,kt=u,y)](i,o,l){return!l||typeof i[I]=="string"||l.isChangeTreeVisible((i[p](o)??i.deletedItems[o])[h])}static is(i){return i.collection!==void 0}constructor(i){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Pt(this),this[h].indexes={},i&&i.forEach(o=>this.add(o)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(i){const o=this.$refId++;return i[h]!==void 0&&i[h].setParent(this,this[h].root,o),this[h].indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,i),this[h].change(o),o}at(i){const o=Array.from(this.$items.keys())[i];return this.$items.get(o)}entries(){return this.$items.entries()}delete(i){const o=this.$items.entries();let l,f;for(;(f=o.next())&&!f.done;)if(i===f.value[1]){l=f.value[0];break}return l===void 0?!1:(this.deletedItems[l]=this[h].delete(l),this.$indexes.delete(l),this.$items.delete(l))}clear(){const i=this[h];i.discard(!0),i.indexes={},this.$indexes.clear(),this.$items.clear(),i.operation(e.OPERATION.CLEAR)}has(i){return Array.from(this.$items.values()).some(o=>o===i)}forEach(i){this.$items.forEach((o,l,f)=>i(o,l,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(i,o){this.$indexes.set(i,o)}getIndex(i){return this.$indexes.get(i)}[p](i){return this.$items.get(this.$indexes.get(i))}[m](i){const o=this.$indexes.get(i);this.$items.delete(o),this.$indexes.delete(i)}[M](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const i=[];return this.forEach((o,l)=>{i.push(typeof o.toJSON=="function"?o.toJSON():o)}),i}clone(i){let o;return i?o=Object.assign(new Ln,this):(o=new Ln,this.forEach(l=>{l[h]?o.add(l.clone()):o.add(l)})),o}};Ln[gi]=xn,Ln[kt]=_s;let is=Ln;ne("collection",{constructor:is});var mi,yi;const kn=class kn{static[(mi=c,yi=u,y)](i,o,l){return!l||typeof i[I]=="string"||l.visible.has((i[p](o)??i.deletedItems[o])[h])}static is(i){return i.set!==void 0}constructor(i){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[h]=new Pt(this),this[h].indexes={},i&&i.forEach(o=>this.add(o)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(i){var f;if(this.has(i))return!1;const o=this.$refId++;i[h]!==void 0&&i[h].setParent(this,this[h].root,o);const l=((f=this[h].indexes[o])==null?void 0:f.op)??e.OPERATION.ADD;return this[h].indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,i),this[h].change(o,l),o}entries(){return this.$items.entries()}delete(i){const o=this.$items.entries();let l,f;for(;(f=o.next())&&!f.done;)if(i===f.value[1]){l=f.value[0];break}return l===void 0?!1:(this.deletedItems[l]=this[h].delete(l),this.$indexes.delete(l),this.$items.delete(l))}clear(){const i=this[h];i.discard(!0),i.indexes={},this.$indexes.clear(),this.$items.clear(),i.operation(e.OPERATION.CLEAR)}has(i){const o=this.$items.values();let l=!1,f;for(;(f=o.next())&&!f.done;)if(i===f.value){l=!0;break}return l}forEach(i){this.$items.forEach((o,l,f)=>i(o,l,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(i,o){this.$indexes.set(i,o)}getIndex(i){return this.$indexes.get(i)}[p](i){return this.$items.get(this.$indexes.get(i))}[m](i){const o=this.$indexes.get(i);this.$items.delete(o),this.$indexes.delete(i)}[M](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const i=[];return this.forEach((o,l)=>{i.push(typeof o.toJSON=="function"?o.toJSON():o)}),i}clone(i){let o;return i?o=Object.assign(new kn,this):(o=new kn,this.forEach(l=>{l[h]?o.add(l.clone()):o.add(l)})),o}};kn[mi]=xn,kn[yi]=_s;let rs=kn;ne("set",{constructor:rs});function tn(v,i,o,l){var f=arguments.length,_=f<3?i:l===null?l=Object.getOwnPropertyDescriptor(i,o):l,S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(v,i,o,l);else for(var x=v.length-1;x>=0;x--)(S=v[x])&&(_=(f<3?S(_):f>3?S(i,o,_):S(i,o))||_);return f>3&&_&&Object.defineProperty(i,o,_),_}typeof SuppressedError=="function"&&SuppressedError;class Ki{constructor(i){this.types=i,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(i){i.ensureRefId();const o=this.changeTrees[i.refId]===void 0;o&&(this.changeTrees[i.refId]=i);const l=this.refCount[i.refId];if(l===0){const f=i.allChanges.operations;let _=f.length;for(;_--;)i.indexedOperations[f[_]]=e.OPERATION.ADD,Xe(i.changes,_)}return this.refCount[i.refId]=(l||0)+1,o}remove(i){const o=this.refCount[i.refId]-1;return o<=0?(i.root=void 0,delete this.changeTrees[i.refId],this.removeChangeFromChangeSet("allChanges",i),this.removeChangeFromChangeSet("changes",i),i.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",i),this.removeChangeFromChangeSet("filteredChanges",i)),this.refCount[i.refId]=0):(this.refCount[i.refId]=o,i.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",i),Je(this,i,"filteredChanges")):(this.removeChangeFromChangeSet("changes",i),Je(this,i,"changes"))),i.forEachChild((l,f)=>this.remove(l)),o}removeChangeFromChangeSet(i,o){const l=this[i],f=l.indexOf(o);if(f!==-1)return o[i].queueRootIndex=-1,l[f]=void 0,!0}clear(){this.changes.length=0}}const ws=class ws{constructor(i){this.sharedBuffer=Buffer.allocUnsafe(ws.BUFFER_SIZE),this.context=ye.cache(i.constructor),this.root=new Ki(this.context),this.setState(i)}setState(i){this.state=i,this.state[h].setRoot(this.root)}encode(i={offset:0},o,l=this.sharedBuffer,f="changes",_=f==="allChanges",S=i.offset){const x=o!==void 0,N=this.state[h],B=this.root[f];for(let V=0,z=B.length;V<z;V++){const G=B[V];if(!G)continue;if(x){if(!o.isChangeTreeVisible(G)){o.invisible.add(G);continue}o.invisible.delete(G)}const ie=G[f],te=G.ref,Y=ie.operations.length;if(Y===0)continue;const Z=te.constructor,se=Z[c],xe=Z[y],Be=Z[Symbol.metadata];(x||i.offset>S||G!==N)&&(l[i.offset++]=255,be.number(l,G.refId,i));for(let We=0;We<Y;We++){const Ke=ie.operations[We],Zt=Ke<0?Math.abs(Ke):_?e.OPERATION.ADD:G.indexedOperations[Ke];Ke===void 0||Zt===void 0||xe&&!xe(te,Ke,o)||se(this,l,G,Ke,Zt,i,_,x,Be)}}if(i.offset>l.byteLength){const V=Math.ceil(i.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(V/1024)} * 1024; // ${Math.round(V/1024)} KB
`),l=Buffer.alloc(V,l),l===this.sharedBuffer&&(this.sharedBuffer=l),this.encode({offset:S},o,l,f,_)}else return l.subarray(0,i.offset)}encodeAll(i={offset:0},o=this.sharedBuffer){return this.encode(i,void 0,o,"allChanges",!0)}encodeAllView(i,o,l,f=this.sharedBuffer){const _=l.offset;return this.encode(l,i,f,"allFilteredChanges",!0,_),Buffer.concat([f.subarray(0,o),f.subarray(_,l.offset)])}debugChanges(i){(typeof i=="string"?this.root[i]:i).forEach(l=>{const f=l[i],_=l.ref.constructor[Symbol.metadata];console.log("->",{ref:l.ref.constructor.name,refId:l.refId,changes:Object.keys(f).length});for(const S in f){const x=f[S];console.log("  ->",{index:S,field:_==null?void 0:_[S],op:e.OPERATION[x]})}})}encodeView(i,o,l,f=this.sharedBuffer){const _=l.offset;for(const[S,x]of i.changes){const N=this.root.changeTrees[S];if(N===void 0){i.changes.delete(S);continue}const B=Object.keys(x);if(B.length===0)continue;const z=N.ref.constructor,G=z[c],ie=z[Symbol.metadata];f[l.offset++]=255,be.number(f,N.refId,l);for(let te=0,Y=B.length;te<Y;te++){const Z=Number(B[te]),xe=N.ref[p](Z)!==void 0&&x[Z]||e.OPERATION.DELETE;G(this,f,N,Z,xe,l,!1,!0,ie)}}return i.changes.clear(),this.encode(l,i,f,"filteredChanges",!1,_),Buffer.concat([f.subarray(0,o),f.subarray(_,l.offset)])}discardChanges(){var o,l;let i=this.root.changes.length;if(i>0){for(;i--;)(o=this.root.changes[i])==null||o.endEncode("changes");this.root.changes.length=0}if(i=this.root.filteredChanges.length,i>0){for(;i--;)(l=this.root.filteredChanges[i])==null||l.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(i,o,l,f){const _=this.context.getTypeId(o),S=this.context.getTypeId(l);if(S===void 0){console.warn(`@colyseus/schema WARNING: Class "${l.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}_!==S&&(i[f.offset++]=213,be.number(i,S,f))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};ws.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let vn=ws;function vi(v,i){if(i===-1||i>=v.length)return!1;const o=v.length-1;for(let l=i;l<o;l++)v[l]=v[l+1];return v.length=o,!0}class bi extends Error{constructor(i){super(i),this.name="DecodingWarning"}}class Yi{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(i,o,l=!0){this.refs.set(i,o),this.refIds.set(o,i),l&&(this.refCounts[i]=(this.refCounts[i]||0)+1),this.deletedRefs.has(i)&&this.deletedRefs.delete(i)}removeRef(i){const o=this.refCounts[i];if(o===void 0){try{throw new bi("trying to remove refId that doesn't exist: "+i)}catch(l){console.warn(l)}return}if(o===0){try{const l=this.refs.get(i);throw new bi(`trying to remove refId '${i}' with 0 refCount (${l.constructor.name}: ${JSON.stringify(l)})`)}catch(l){console.warn(l)}return}(this.refCounts[i]=o-1)<=0&&this.deletedRefs.add(i)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(i=>{if(this.refCounts[i]>0)return;const o=this.refs.get(i);if(o.constructor[Symbol.metadata]!==void 0){const l=o.constructor[Symbol.metadata];for(const f in l){const _=l[f].name,S=typeof o[_]=="object"&&this.refIds.get(o[_]);S&&!this.deletedRefs.has(S)&&this.removeRef(S)}}else typeof o[I]=="function"&&Array.from(o.values()).forEach(l=>{const f=this.refIds.get(l);this.deletedRefs.has(f)||this.removeRef(f)});this.refs.delete(i),delete this.refCounts[i],delete this.callbacks[i]}),this.deletedRefs.clear()}addCallback(i,o,l){if(i===void 0){const f=typeof o=="number"?e.OPERATION[o]:o;throw new Error(`Can't addCallback on '${f}' (refId is undefined)`)}return this.callbacks[i]||(this.callbacks[i]={}),this.callbacks[i][o]||(this.callbacks[i][o]=[]),this.callbacks[i][o].push(l),()=>this.removeCallback(i,o,l)}removeCallback(i,o,l){var _,S,x;const f=(x=(S=(_=this.callbacks)==null?void 0:_[i])==null?void 0:S[o])==null?void 0:x.indexOf(l);f!==-1&&vi(this.callbacks[i][o],f)}}class Ts{constructor(i,o){this.currentRefId=0,this.setState(i),this.context=o||new ye(i.constructor)}setState(i){this.state=i,this.root=new Yi,this.root.addRef(0,i)}decode(i,o={offset:0},l=this.state){var N,B,V;const f=[],_=this.root,S=i.byteLength;let x=l.constructor[u];for(this.currentRefId=0;o.offset<S;){if(i[o.offset]==255){o.offset++,this.currentRefId=k.number(i,o);const G=_.refs.get(this.currentRefId);if(!G)throw new Error(`"refId" not found: ${this.currentRefId}`);(N=l[H])==null||N.call(l),l=G,x=l.constructor[u];continue}if(x(this,i,o,l,f)===ai){console.warn("@colyseus/schema: definition mismatch");const G={offset:o.offset};for(;o.offset<S&&!(i[o.offset]===255&&(G.offset=o.offset+1,_.refs.has(k.number(i,G))));)o.offset++;continue}}return(B=l[H])==null||B.call(l),(V=this.triggerChanges)==null||V.call(this,f),_.garbageCollectDeletedRefs(),f}getInstanceType(i,o,l){let f;if(i[o.offset]===213){o.offset++;const _=k.number(i,o);f=this.context.get(_)}return f||l}createInstanceOfType(i){return new i}removeChildRefs(i,o){const l=typeof i[I]!="string",f=this.root.refIds.get(i);i.forEach((_,S)=>{o.push({ref:i,refId:f,op:e.OPERATION.DELETE,field:S,value:void 0,previousValue:_}),l&&this.root.removeRef(this.root.refIds.get(_))})}}class Rn extends He{}tn([wt("string")],Rn.prototype,"name",void 0),tn([wt("string")],Rn.prototype,"type",void 0),tn([wt("number")],Rn.prototype,"referencedType",void 0);class Pn extends He{constructor(){super(...arguments),this.fields=new Lt}}tn([wt("number")],Pn.prototype,"id",void 0),tn([wt("number")],Pn.prototype,"extendsId",void 0),tn([wt([Rn])],Pn.prototype,"fields",void 0);class nn extends He{constructor(){super(...arguments),this.types=new Lt}static encode(i,o={offset:0}){const l=i.context,f=new nn,_=new vn(f),S=l.schemas.get(i.state.constructor);S>0&&(f.rootType=S);const x=new Set,N={},B=z=>{if(z.extendsId===void 0||x.has(z.extendsId)){x.add(z.id),f.types.push(z);const G=N[z.id];G!==void 0&&(delete N[z.id],G.forEach(ie=>B(ie)))}else N[z.extendsId]===void 0&&(N[z.extendsId]=[]),N[z.extendsId].push(z)};l.schemas.forEach((z,G)=>{const ie=new Pn;ie.id=Number(z);const te=Object.getPrototypeOf(G);te!==He&&(ie.extendsId=l.schemas.get(te));const Y=G[Symbol.metadata];if(Y!==te[Symbol.metadata])for(const Z in Y){const se=Number(Z),xe=Y[se].name;if(!Object.prototype.hasOwnProperty.call(Y,xe))continue;const Be=new Rn;Be.name=xe;let We;const Ke=Y[se];if(typeof Ke.type=="string")We=Ke.type;else{let Zt;He.is(Ke.type)?(We="ref",Zt=Ke.type):(We=Object.keys(Ke.type)[0],typeof Ke.type[We]=="string"?We+=":"+Ke.type[We]:Zt=Ke.type[We]),Be.referencedType=Zt?l.getTypeId(Zt):-1}Be.type=We,ie.fields.push(Be)}B(ie)});for(const z in N)N[z].forEach(G=>f.types.push(G));const V=_.encodeAll(o);return Buffer.from(V,0,o.offset)}static decode(i,o){const l=new nn;new Ts(l).decode(i,o);const _=new ye;l.types.forEach(N=>{const B=_.get(N.extendsId)??He,V=class extends B{};ye.register(V),_.add(V,N.id)},{});const S=(N,B,V)=>{B.fields.forEach((z,G)=>{const ie=V+G;if(z.referencedType!==void 0){let te=z.type,Y=_.get(z.referencedType);if(!Y){const Z=z.type.split(":");te=Z[0],Y=Z[1]}te==="ref"?De.addField(N,ie,z.name,Y):De.addField(N,ie,z.name,{[te]:Y})}else De.addField(N,ie,z.name,z.type)})};l.types.forEach(N=>{const B=_.get(N.id),V=De.initialize(B),z=[];let G=N;do z.push(G),G=l.types.find(te=>te.id===G.extendsId);while(G);let ie=0;z.reverse().forEach(te=>{S(V,te,ie),ie+=te.fields.length})});const x=new(_.get(l.rootType||0));return new Ts(x,_)}}tn([wt([Pn])],nn.prototype,"types",void 0),tn([wt("number")],nn.prototype,"rootType",void 0);function qi(v){const i=v.root,o=i.callbacks,l=new WeakMap;let f;v.triggerChanges=function(x){var B;const N=new Set;for(let V=0,z=x.length;V<z;V++){const G=x[V],ie=G.refId,te=G.ref,Y=o[ie];if(Y){if((G.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&G.previousValue instanceof He){const Z=(B=o[i.refIds.get(G.previousValue)])==null?void 0:B[e.OPERATION.DELETE];for(let se=(Z==null?void 0:Z.length)-1;se>=0;se--)Z[se]()}if(te instanceof He){if(!N.has(ie)){const Z=Y==null?void 0:Y[e.OPERATION.REPLACE];for(let se=(Z==null?void 0:Z.length)-1;se>=0;se--)Z[se]()}if(Y.hasOwnProperty(G.field)){const Z=Y[G.field];for(let se=(Z==null?void 0:Z.length)-1;se>=0;se--)Z[se](G.value,G.previousValue)}}else{if((G.op&e.OPERATION.DELETE)===e.OPERATION.DELETE){if(G.previousValue!==void 0){const Z=Y[e.OPERATION.DELETE];for(let se=(Z==null?void 0:Z.length)-1;se>=0;se--)Z[se](G.previousValue,G.dynamicIndex??G.field)}if((G.op&e.OPERATION.ADD)===e.OPERATION.ADD){const Z=Y[e.OPERATION.ADD];for(let se=(Z==null?void 0:Z.length)-1;se>=0;se--)Z[se](G.value,G.dynamicIndex??G.field)}}else if((G.op&e.OPERATION.ADD)===e.OPERATION.ADD&&G.previousValue!==G.value){const Z=Y[e.OPERATION.ADD];for(let se=(Z==null?void 0:Z.length)-1;se>=0;se--)Z[se](G.value,G.dynamicIndex??G.field)}if(G.value!==G.previousValue&&(G.value!==void 0||G.previousValue!==void 0)){const Z=Y[e.OPERATION.REPLACE];for(let se=(Z==null?void 0:Z.length)-1;se>=0;se--)Z[se](G.value,G.dynamicIndex??G.field)}}N.add(ie)}}};function _(x,N){var z;let B=((z=N.instance)==null?void 0:z.constructor[Symbol.metadata])||x,V=N.instance&&typeof N.instance.forEach=="function"||x&&typeof x[Symbol.metadata]>"u";if(B&&!V){const G=function(ie,te,Y,Z){return Z&&N.instance[te]!==void 0&&!l.has(f)&&Y(N.instance[te],void 0),i.addCallback(i.refIds.get(ie),te,Y)};return new Proxy({listen:function(te,Y,Z=!0){if(N.instance)return G(N.instance,te,Y,Z);{let se=()=>{};return N.onInstanceAvailable((xe,Be)=>{se=G(xe,te,Y,Z&&Be&&!l.has(f))}),()=>se()}},onChange:function(te){return i.addCallback(i.refIds.get(N.instance),e.OPERATION.REPLACE,te)},bindTo:function(te,Y){return Y||(Y=Object.keys(B).map(Z=>B[Z].name)),i.addCallback(i.refIds.get(N.instance),e.OPERATION.REPLACE,()=>{Y.forEach(Z=>te[Z]=N.instance[Z])})}},{get(ie,te){var Z;const Y=B[B[te]];if(Y){const se=(Z=N.instance)==null?void 0:Z[te],xe=Be=>{const We=S(N.instance).listen(te,(Ke,Zt)=>{Be(Ke,!1),We==null||We()},!1);i.refIds.get(se)!==void 0&&Be(se,!0)};return _(Y.type,{instance:i.refIds.get(se)&&se,parentInstance:N.instance,onInstanceAvailable:xe})}else return ie[te]},has(ie,te){return B[te]!==void 0},set(ie,te,Y){throw new Error("not allowed")},deleteProperty(ie,te){throw new Error("not allowed")}})}else{const G=function(Y,Z,se){return se&&Y.forEach((xe,Be)=>Z(xe,Be)),i.addCallback(i.refIds.get(Y),e.OPERATION.ADD,(xe,Be)=>{l.set(Z,!0),f=Z,Z(xe,Be),l.delete(Z),f=void 0})},ie=function(Y,Z){return i.addCallback(i.refIds.get(Y),e.OPERATION.DELETE,Z)},te=function(Y,Z){return i.addCallback(i.refIds.get(Y),e.OPERATION.REPLACE,Z)};return new Proxy({onAdd:function(Y,Z=!0){if(N.instance)return G(N.instance,Y,Z&&!l.has(f));if(N.onInstanceAvailable){let se=()=>{};return N.onInstanceAvailable((xe,Be)=>{se=G(xe,Y,Z&&Be&&!l.has(f))}),()=>se()}},onRemove:function(Y){if(N.instance)return ie(N.instance,Y);if(N.onInstanceAvailable){let Z=()=>{};return N.onInstanceAvailable(se=>{Z=ie(se,Y)}),()=>Z()}},onChange:function(Y){if(N.instance)return te(N.instance,Y);if(N.onInstanceAvailable){let Z=()=>{};return N.onInstanceAvailable(se=>{Z=te(se,Y)}),()=>Z()}}},{get(Y,Z){if(!Y[Z])throw new Error(`Can't access '${Z}' through callback proxy. access the instance directly.`);return Y[Z]},has(Y,Z){return Y[Z]!==void 0},set(Y,Z,se){throw new Error("not allowed")},deleteProperty(Y,Z){throw new Error("not allowed")}})}}function S(x){return _(void 0,{instance:x})}return S}function Xi(v,i){v.triggerChanges=i}class Ji{constructor(i=!1){this.iterable=i,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,i&&(this.items=[])}add(i,o=Ft,l=!0){var x,N;const f=i==null?void 0:i[h];if(f){if(!f.parent&&f.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${f.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",i),this;const _=i.constructor[Symbol.metadata];this.visible.add(f),this.iterable&&l&&this.items.push(i),l&&f.parent&&this.addParentOf(f,o);let S=this.changes.get(f.refId);if(S===void 0&&(S={},this.changes.set(f.refId,S)),o!==Ft){this.tags||(this.tags=new WeakMap);let B;this.tags.has(f)?B=this.tags.get(f):(B=new Set,this.tags.set(f,B)),B.add(o),(N=(x=_==null?void 0:_[X])==null?void 0:x[o])==null||N.forEach(V=>{f.getChange(V)!==e.OPERATION.DELETE&&(S[V]=e.OPERATION.ADD)})}else{const B=this.invisible.has(f),V=f.filteredChanges!==void 0?f.allFilteredChanges:f.allChanges;for(let z=0,G=V.operations.length;z<G;z++){const ie=V.operations[z];if(ie===void 0)continue;const te=f.indexedOperations[ie]??e.OPERATION.ADD,Y=_==null?void 0:_[ie].tag;!f.isNew&&(B||Y===void 0||Y===o)&&te!==e.OPERATION.DELETE&&(S[ie]=te)}}return f.forEachChild((B,V)=>{_&&_[V].tag!==void 0&&_[V].tag!==o||this.add(B.ref,o,!1)}),this}addParentOf(i,o){var _;const l=i.parent[h],f=i.parentIndex;if(!this.visible.has(l)){this.visible.add(l);const S=(_=l.parent)==null?void 0:_[h];S&&S.filteredChanges!==void 0&&this.addParentOf(l,o)}if(l.getChange(f)!==e.OPERATION.DELETE){let S=this.changes.get(l.refId);S===void 0&&(S={},this.changes.set(l.refId,S)),this.tags||(this.tags=new WeakMap);let x;this.tags.has(l)?x=this.tags.get(l):(x=new Set,this.tags.set(l,x)),x.add(o),S[f]=e.OPERATION.ADD}}remove(i,o=Ft,l=!1){var N;const f=i[h];if(!f)return console.warn("StateView#remove(), invalid object:",i),this;this.visible.delete(f),this.iterable&&!l&&vi(this.items,this.items.indexOf(i));const S=f.ref.constructor[Symbol.metadata];let x=this.changes.get(f.refId);if(x===void 0&&(x={},this.changes.set(f.refId,x)),o===Ft){const B=f.parent;if(!De.isValidInstance(B)&&f.isFiltered){const V=B[h];let z=this.changes.get(V.refId);z===void 0&&(z={},this.changes.set(V.refId,z)),z[f.parentIndex]=e.OPERATION.DELETE}else(N=S==null?void 0:S[ae])==null||N.forEach(V=>x[V]=e.OPERATION.DELETE)}else S==null||S[X][o].forEach(B=>x[B]=e.OPERATION.DELETE);if(this.tags&&this.tags.has(f)){const B=this.tags.get(f);o===void 0?this.tags.delete(f):(B.delete(o),B.size===0&&this.tags.delete(f))}return this}has(i){return this.visible.has(i[h])}hasTag(i,o=Ft){var f;const l=(f=this.tags)==null?void 0:f.get(i[h]);return(l==null?void 0:l.has(o))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let i=0,o=this.items.length;i<o;i++)this.remove(this.items[i],Ft,!0);this.items.length=0}isChangeTreeVisible(i){let o=this.visible.has(i);return!o&&i.isVisibilitySharedWithParent&&this.visible.has(i.parent[h])&&(this.visible.add(i),o=!0),o}}ne("map",{constructor:tt}),ne("array",{constructor:Lt}),ne("set",{constructor:rs}),ne("collection",{constructor:is}),e.$changes=h,e.$childType=I,e.$decoder=u,e.$deleteByIndex=m,e.$encoder=c,e.$filter=y,e.$getByIndex=p,e.$track=a,e.ArraySchema=Lt,e.ChangeTree=Pt,e.CollectionSchema=is,e.Decoder=Ts,e.Encoder=vn,e.MapSchema=tt,e.Metadata=De,e.Reflection=nn,e.ReflectionField=Rn,e.ReflectionType=Pn,e.Schema=He,e.SetSchema=rs,e.StateView=Ji,e.TypeContext=ye,e.decode=k,e.decodeKeyValueOperation=_s,e.decodeSchemaOperation=oi,e.defineCustomTypes=ge,e.defineTypes=zi,e.deprecated=Gt,e.dumpChanges=Wi,e.encode=be,e.encodeArray=Nn,e.encodeKeyValueOperation=xn,e.encodeSchemaOperation=bs,e.entity=ji,e.getDecoderStateCallbacks=qi,e.getRawChangesCallback=Xi,e.registerType=ne,e.schema=fi,e.type=wt,e.view=di})})(Tr,Tr.exports);var ke=Tr.exports,cu=Object.defineProperty,uu=Object.getOwnPropertyDescriptor,Fe=(n,t,e,s)=>{for(var r=s>1?void 0:s?uu(t,e):t,a=n.length-1,c;a>=0;a--)(c=n[a])&&(r=(s?c(t,e,r):c(r))||r);return s&&r&&cu(t,e,r),r},Ee=(n=>(n.Lobby="Lobby",n.Shop="Shop",n.Preparation="Preparation",n.Battle="Battle",n.BattleEnd="BattleEnd",n.GameOver="GameOver",n))(Ee||{});const Yt=class ja extends ke.Schema{constructor(){super(...arguments),this.instanceId="",this.cardId="",this.name="",this.attack=0,this.speed=0,this.health=0,this.currentHp=0,this.brewCost=0,this.description="",this.isLegend=!1}static fromCardData(t,e){const s=new ja;return s.instanceId=e,s.cardId=t.id,s.name=t.name,s.attack=t.attack,s.speed=t.speed,s.health=t.health,s.currentHp=t.health,s.brewCost=t.brewCost,s.description=t.description,s.isLegend=t.isLegend,s}};Fe([ke.type("string")],Yt.prototype,"instanceId",2);Fe([ke.type("string")],Yt.prototype,"cardId",2);Fe([ke.type("string")],Yt.prototype,"name",2);Fe([ke.type("number")],Yt.prototype,"attack",2);Fe([ke.type("number")],Yt.prototype,"speed",2);Fe([ke.type("number")],Yt.prototype,"health",2);Fe([ke.type("number")],Yt.prototype,"currentHp",2);Fe([ke.type("number")],Yt.prototype,"brewCost",2);Fe([ke.type("string")],Yt.prototype,"description",2);Fe([ke.type("boolean")],Yt.prototype,"isLegend",2);let za=Yt;class gn extends ke.Schema{constructor(){super(...arguments),this.sessionId="",this.username="Player",this.health=100,this.brews=5,this.shopRefreshCost=1,this.hand=new ke.MapSchema,this.battlefield=new ke.MapSchema,this.isReady=!1,this.shopOfferIds=new ke.ArraySchema}}Fe([ke.type("string")],gn.prototype,"sessionId",2);Fe([ke.type("string")],gn.prototype,"username",2);Fe([ke.type("number")],gn.prototype,"health",2);Fe([ke.type("number")],gn.prototype,"brews",2);Fe([ke.type("number")],gn.prototype,"shopRefreshCost",2);Fe([ke.type({map:za})],gn.prototype,"hand",2);Fe([ke.type({map:za})],gn.prototype,"battlefield",2);Fe([ke.type("boolean")],gn.prototype,"isReady",2);Fe([ke.type(["string"])],gn.prototype,"shopOfferIds",2);class Gi extends ke.Schema{constructor(){super(...arguments),this.players=new ke.MapSchema,this.currentDay=0,this.currentPhase="Lobby",this.battleTimer=0}}Fe([ke.type({map:gn})],Gi.prototype,"players",2);Fe([ke.type("number")],Gi.prototype,"currentDay",2);Fe([ke.type("string")],Gi.prototype,"currentPhase",2);Fe([ke.type("number")],Gi.prototype,"battleTimer",2);class du extends pn.Scene{constructor(){super("Lobby");q(this,"playerTextObjects",new Map);q(this,"statusText");q(this,"readyButton");q(this,"waitingText");q(this,"phaseListenerUnsub",null);q(this,"playerAddListenerUnsub",null);q(this,"playerRemoveListenerUnsub",null);q(this,"playerStateListeners",new Map);q(this,"listenersAttached",!1)}create(){if(this.scene.launch("background"),this.listenersAttached=!1,!E||!E.sessionId){console.error("Lobby Scene: Not connected to Colyseus room or no session ID!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Not connected to server.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{E==null||E.leave()}catch{}this.scene.start("MainMenu")});return}this.add.text(this.cameras.main.centerX,100,"Lobby",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,200,"Players in Lobby:",{fontFamily:"Arial",fontSize:32,color:"#dddddd",align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-100,"Connecting to lobby...",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.readyButton=this.add.text(this.cameras.main.centerX,this.cameras.main.height-150,"Ready Up",{fontFamily:"Arial Black",fontSize:40,color:"#888888",backgroundColor:"#333333",padding:{x:20,y:10},stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setVisible(!1).disableInteractive(),this.waitingText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-110,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.readyButton.on("pointerdown",()=>{var e;E&&((e=this.readyButton.input)!=null&&e.enabled)&&(console.log("Lobby: Sending playerReady message."),E.send("playerReady"))}),this.readyButton.on("pointerover",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled&&this.readyButton.setColor("#55ff55")}),this.readyButton.on("pointerout",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled?this.readyButton.setColor("#00ff00"):this.readyButton.setColor("#888888")}),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}attachMainListenersAndUI(){if(this.listenersAttached){console.log("Lobby: Main listeners and UI setup already performed, skipping.");return}if(!this.scene.isActive()){console.warn("Lobby: attachMainListenersAndUI called but scene is not active. Aborting.");return}if(!E||!E.state){console.warn("Lobby: attachMainListenersAndUI called but Colyseus room or state is not ready. Aborting.");return}console.log("Lobby: Attaching main Colyseus listeners and performing initial UI update."),this.attachMainListeners(),this.updateLobbyUI(),this.listenersAttached=!0}setupColyseusListeners(){if(!E){console.error("Lobby: setupColyseusListeners called but colyseusRoom is null.");return}console.log("Lobby: Setting up Colyseus general listeners."),E.state&&!this.listenersAttached&&(console.log("Lobby: State already available on setup. Scheduling attachMainListenersAndUI."),this.time.delayedCall(1,this.attachMainListenersAndUI,[],this)),E.onStateChange.once(e=>{if(console.log("Lobby: Initial state received via onStateChange.once."),!this.scene.isActive()){console.log("Lobby: Scene became inactive before onStateChange.once processing could complete.");return}this.attachMainListenersAndUI()})}attachMainListeners(){if(!E||!E.state){console.error("Lobby: attachMainListeners - colyseusRoom or state is null.");return}const e=cn.getStateCallbacks(E);this.phaseListenerUnsub&&this.phaseListenerUnsub(),this.phaseListenerUnsub=e(E.state).listen("currentPhase",(s,r)=>{this.scene.isActive()&&(console.log(`Lobby: Phase changed from ${r} to: ${s}`),s===Ee.Shop?(this.statusText.setText("Starting Game!"),this.time.delayedCall(500,()=>{this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"))})):s===Ee.Lobby?this.updateLobbyUI():s===Ee.GameOver&&(this.statusText.setText("Game Over. Returning to Main Menu."),this.time.delayedCall(1500,()=>{if(this.scene.isActive()){try{E==null||E.leave()}catch{}this.scene.stop(),this.scene.start("MainMenu")}})))}),this.playerAddListenerUnsub&&this.playerAddListenerUnsub(),this.playerAddListenerUnsub=e(E.state.players).onAdd((s,r)=>{this.scene.isActive()&&(console.log(`Lobby: Player joined: ${s.username} (${r})`),this.addPlayerStateListener(s,r),this.updateLobbyUI())}),this.playerRemoveListenerUnsub&&this.playerRemoveListenerUnsub(),this.playerRemoveListenerUnsub=e(E.state.players).onRemove((s,r)=>{this.scene.isActive()&&(console.log(`Lobby: Player left: ${s.username} (${r})`),this.removePlayerStateListener(r),this.updateLobbyUI())}),E.state.players.forEach((s,r)=>{this.addPlayerStateListener(s,r)})}addPlayerStateListener(e,s){var c;if(!E)return;const r=cn.getStateCallbacks(E);(c=this.playerStateListeners.get(s))==null||c(),console.log(`Lobby: Adding 'isReady' listener for player ${s}`);const a=r(e).listen("isReady",(u,y)=>{console.log(`Lobby: isReady changed for player ${s}: ${y} -> ${u}`),this.scene.isActive()&&this.updateLobbyUI()});this.playerStateListeners.set(s,a)}removePlayerStateListener(e){const s=this.playerStateListeners.get(e);s&&(console.log(`Lobby: Removing 'isReady' listener for player ${e}`),s(),this.playerStateListeners.delete(e))}updateLobbyUI(){if(!this.scene.isActive()){console.warn("Lobby: updateLobbyUI called but scene is NOT ACTIVE. Aborting UI update.");return}if(!E){console.warn("Lobby: updateLobbyUI called but colyseusRoom is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Connection lost.");return}if(!E.state){console.warn("Lobby: updateLobbyUI called but colyseusRoom.state is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Game state unavailable.");return}In.size===0&&(console.log("Lobby: Card data not loaded yet. Loading..."),lu(()=>Promise.resolve().then(()=>Yc),void 0).then(({loadAllCardData:h})=>{h().then(I=>{I?console.log("Lobby: Card data loaded successfully"):console.warn("Lobby: Failed to load card data")})}));const e=E.state.players,s=E.sessionId,r=e.size,a=250,c=40;this.playerTextObjects.forEach(h=>h.destroy()),this.playerTextObjects.clear();let u=0,y=r>0,p=!1;const m=e.get(s);m&&(p=m.isReady),e.forEach((h,I)=>{const M=I===s,H=h.isReady?" [Ready]":" [Not Ready]",$=`${h.username||"Joining..."}${M?" (You)":""}${H}`,U=this.add.text(this.cameras.main.centerX,a+u*c,$,{fontFamily:"Arial",fontSize:24,color:h.isReady?"#00ff00":"#ffffff",align:"center"}).setOrigin(.5);this.playerTextObjects.set(I,U),u++,h.isReady||(y=!1)}),r<2?(this.statusText.setText("Waiting for opponent..."),this.readyButton.setVisible(!1).disableInteractive(),this.waitingText.setVisible(!1)):(this.readyButton.setVisible(!0),p?(this.statusText.setText("Waiting for opponent to ready up..."),this.readyButton.setText("Waiting...").setColor("#888888").disableInteractive(),this.waitingText.setText(y?"Starting game...":"Waiting for opponent...").setVisible(!0)):(this.statusText.setText("Lobby full. Ready up!"),this.readyButton.setText("Ready Up").setColor("#00ff00").setInteractive({useHandCursor:!0}),this.waitingText.setVisible(!1)),y&&(this.statusText.setText("Starting game..."),this.readyButton.setVisible(!1),this.waitingText.setVisible(!1)))}shutdown(){var e,s,r,a,c,u,y,p,m;console.log("Lobby scene shutting down."),this.listenersAttached=!1,(e=this.phaseListenerUnsub)==null||e.call(this),(s=this.playerAddListenerUnsub)==null||s.call(this),(r=this.playerRemoveListenerUnsub)==null||r.call(this),this.playerStateListeners.forEach(h=>h()),this.playerStateListeners.clear(),this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerTextObjects.forEach(h=>h.destroy()),this.playerTextObjects.clear(),(a=this.statusText)==null||a.destroy(),(c=this.readyButton)==null||c.destroy(),(u=this.waitingText)==null||u.destroy(),(y=this.readyButton)==null||y.off("pointerdown"),(p=this.readyButton)==null||p.off("pointerover"),(m=this.readyButton)==null||m.off("pointerout"),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const rn=120,ls=168;class hu extends pn.Scene{constructor(){super("Shop");q(this,"continueButton");q(this,"shopCardObjects",[]);q(this,"waitingText");q(this,"refreshButton");q(this,"cardDataCache",new Map);q(this,"shopOffersContainer");q(this,"shopOffersBackground");q(this,"toggleShopButton");q(this,"shopOffersVisible",!0);q(this,"phaseListenerUnsub",null);q(this,"playerStateListenersUnsub",new Map);q(this,"shopOfferListenersUnsub",[]);q(this,"listeners",[])}create(){var y;if(this.scene.launch("background"),(y=this.scene.get("BoardView"))!=null&&y.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!E||!E.state||!E.sessionId){console.error("Shop Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{E==null||E.leave(!0)}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,s=this.cameras.main.centerY,r=this.cameras.main.width,a=this.cameras.main.height;this.createShopCardsDisplay(e,s,r),this.setupDragAndDrop(),this.requestMissingCardData();const c=E.state.players.get(E.sessionId),u=(c==null?void 0:c.shopRefreshCost)||2;this.refreshButton=this.add.text(r-150,180,`Refresh: ${u} `,{fontFamily:"Arial",fontSize:18,color:"#FFFFFF",backgroundColor:"#4444AA",padding:{x:10,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.refreshButton.on("pointerdown",()=>{const p=E==null?void 0:E.state.players.get(E.sessionId);E&&p&&p.brews>=p.shopRefreshCost&&E.send("refreshShop")}),this.refreshButton.on("pointerover",()=>{var p;(p=this.refreshButton.input)!=null&&p.enabled&&this.refreshButton.setBackgroundColor("#6666CC")}),this.refreshButton.on("pointerout",()=>{var p;(p=this.refreshButton.input)!=null&&p.enabled&&this.refreshButton.setBackgroundColor("#4444AA")}),this.updateRefreshButtonState(),this.continueButton=this.add.text(e,a-50,"Continue",{fontFamily:"Arial Black",fontSize:40,color:"#00ff00",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.continueButton.on("pointerdown",()=>{const p=E==null?void 0:E.state.players.get(E.sessionId);E&&p&&!p.isReady&&E.state.currentPhase===Ee.Shop&&E.send("playerReady")}),this.continueButton.on("pointerover",()=>{var p;(p=this.continueButton.input)!=null&&p.enabled&&this.continueButton.setColor("#55ff55")}),this.continueButton.on("pointerout",()=>{var p;(p=this.continueButton.input)!=null&&p.enabled?this.continueButton.setColor("#00ff00"):this.continueButton.setColor("#888888")}),this.waitingText=this.add.text(e,a-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(50,()=>this.createShopCardsDisplay(e,s,r)),this.toggleShopButton=this.add.text(r-100,s-250,"Toggle Shop",{fontFamily:"Arial",fontSize:16,color:"#FFFFFF",backgroundColor:"#555555",padding:{x:5,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.toggleShopButton.on("pointerdown",()=>{this.shopOffersVisible=!this.shopOffersVisible,this.shopOffersContainer.setVisible(this.shopOffersVisible),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop")}),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop"),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createShopCardsDisplay(e,s,r){var H;(H=this.shopOffersContainer)==null||H.destroy(),this.shopOffersContainer=this.add.container(0,0),this.shopOffersContainer.setVisible(this.shopOffersVisible),this.shopCardObjects.forEach($=>$.destroy()),this.shopCardObjects=[];const a=E==null?void 0:E.state.players.get(E.sessionId),c=a==null?void 0:a.shopOfferIds;if(!c||c.length===0){console.log("Shop: No shop offers from server."),this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.setVisible(!1);return}const u=20,y=c.length>0?c.length:4,p=s,m=y*rn+(y-1)*u,h=e-m/2+rn/2,I=m+u*2,M=ls+u*2;this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.destroy(),this.shopOffersBackground=this.add.rectangle(e,p,I,M,51,.6),this.shopOffersContainer.add(this.shopOffersBackground),c.forEach(($,U)=>{const he=this.getCardDataFromServer($);if(!he){console.warn(`Shop: Card data not found for ID: ${$}`);return}const ae=h+U*(rn+u),X=this.add.container(ae,p),Pe=this.add.image(0,0,"cardFullTier1").setOrigin(.5).setDisplaySize(rn,ls);X.add(Pe);const Ae=this.add.text(0,-20,he.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:rn-20}}).setOrigin(.5,.5);X.add(Ae);const Ge=this.add.text(-rn/2+32,ls*.03,`${he.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(0,.5);X.add(Ge);const Ze=this.add.text(rn/2-18,6,`${he.health}/${he.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,.5);X.add(Ze);const st=this.add.text(0,ls/2-50,`${he.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);X.add(st);const ot=this.add.text(rn/2-8,-ls/2+8,`${he.brewCost}B`,{fontFamily:"Arial",fontSize:14,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"right"}).setOrigin(1,0);X.add(ot),X.setSize(rn,ls),X.setSize(rn,ls),X.setInteractive({useHandCursor:!0}),X.setData("cardId",he.id),X.setData("cardData",he),this.input.setDraggable(X),X.off("pointerdown").on("pointerdown",dt=>{var Ce;(Ce=X.input)!=null&&Ce.enabled&&X.setData("isBeingDragged",!1)}),X.off("pointerup").on("pointerup",dt=>{var mn;if(!((mn=X.input)!=null&&mn.enabled)||!E||!E.sessionId)return;if(X.getData("isBeingDragged")===!0){X.setData("isBeingDragged",!1);return}const Ce=E.state.players.get(E.sessionId);if(!Ce)return;let Oe=-1;for(let it=0;it<5;it++)if(!Ce.hand.has(String(it))){Oe=it;break}if(Oe!==-1){const it=X.getData("cardId"),ht=X.getData("cardData");it&&ht&&Ce.brews>=ht.brewCost?(console.log(`Shop: Click-to-buy card ${it} (Cost: ${ht.brewCost}) into hand slot ${Oe}. Brews: ${Ce.brews}`),E.send("buyCard",{cardId:it,handSlotIndex:Oe})):ht&&Ce.brews<ht.brewCost?console.log(`Shop: Not enough brews (${Ce.brews}) to click-buy card ${it} (Cost: ${ht.brewCost}).`):console.log(`Shop: Click-to-buy failed for card ${it}. CardData: ${!!ht}`)}else console.log("Shop: Hand is full, cannot click-buy.")}),this.shopCardObjects.push(X),this.shopOffersContainer.add(X)})}requestMissingCardData(){if(!E||!E.state||!E.sessionId)return;const e=E.state.players.get(E.sessionId);if(!e)return;const s=e.shopOfferIds;if(s&&s.length>0){const r=[];s.forEach(a=>{In.has(a)||r.push(a)}),r.length>0&&(console.log("Requesting missing cards from server:",r),E.send("getCardsByIds",{cardIds:r}))}}getCardDataFromServer(e){if(In.has(e))return In.get(e);if(!E||!E.state)return;let s;return E.state.players.forEach(r=>{r.hand.forEach(a=>{a.cardId===e&&(s={id:a.cardId,name:a.name,attack:a.attack,speed:a.speed,health:a.health,brewCost:a.brewCost,description:a.description,isLegend:a.isLegend})}),r.battlefield.forEach(a=>{a.cardId===e&&(s={id:a.cardId,name:a.name,attack:a.attack,speed:a.speed,health:a.health,brewCost:a.brewCost,description:a.description,isLegend:a.isLegend})})}),s||(s={id:e,name:`Card ${e.split("_").pop()}`,attack:1,speed:1,health:1,brewCost:1,description:"Loading card details...",isLegend:!1},console.warn(`Shop: Card data not found for ID: ${e} in global cache or state`)),s}setupDragAndDrop(){this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),this.input.off("pointerdown"),this.input.off("pointerup"),this.shopCardObjects.forEach(e=>{e.off("pointerdown"),e.off("pointerup")}),this.input.on("dragstart",(e,s)=>{var r;!(s instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(s)||(r=s.input)!=null&&r.enabled&&(this.children.bringToTop(s),s.setAlpha(.7),s.setData("startX",s.x),s.setData("startY",s.y),s.setData("isBeingDragged",!0))}),this.input.on("drag",(e,s,r,a)=>{var c;!(s instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(s)||(c=s.input)!=null&&c.enabled&&s.getData("isBeingDragged")===!0&&(s.x=r,s.y=a)}),this.input.on("dragend",(e,s)=>{if(!E||!(s instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(s)){s instanceof Phaser.GameObjects.Container&&s.setData("isBeingDragged",!1);return}s.setAlpha(1);let r=!1;if(s.getData("isBeingDragged")===!0){const a=s.x,c=s.y,u=this.scene.get("BoardView");for(let y=0;y<5;y++){const p=u==null?void 0:u.getSlotPixelPosition(!0,"hand",y);if(p){const m=new Phaser.Geom.Rectangle(p.x-50,p.y-70,100,140);if(Phaser.Geom.Rectangle.Contains(m,a,c)){const h=E.state.players.get(E.sessionId);if(h&&!h.hand.has(String(y))){const I=s.getData("cardId"),M=s.getData("cardData");I&&M&&h.brews>=M.brewCost?(E.send("buyCard",{cardId:I,handSlotIndex:y}),r=!0):console.log("Shop: Drag-to-buy failed (not enough brews or card data missing).")}break}}}r||s.active&&(s.x=s.getData("startX"),s.y=s.getData("startY"))}s.setData("isBeingDragged",!1)})}updateRefreshButtonState(){if(!E||!this.refreshButton||!this.refreshButton.active)return;const e=E.state.players.get(E.sessionId);if(!e)return;this.refreshButton.setText(`Refresh: ${e.shopRefreshCost} `),e.brews>=e.shopRefreshCost&&E.state.currentPhase===Ee.Shop?(this.refreshButton.setColor("#FFFFFF"),this.refreshButton.setBackgroundColor("#4444AA"),this.refreshButton.setInteractive({useHandCursor:!0})):(this.refreshButton.setColor("#AAAAAA"),this.refreshButton.setBackgroundColor("#555555"),this.refreshButton.disableInteractive())}setupColyseusListeners(){if(!E||!E.sessionId)return;const e=cn.getStateCallbacks(E),s=E.sessionId;this.phaseListenerUnsub=e(E.state).listen("currentPhase",a=>{this.scene.isActive()&&(a===Ee.Preparation?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Preparation")):a!==Ee.Shop&&this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby")),this.updateWaitingStatus())}),E.state.players.forEach((a,c)=>{const u=e(a).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(c,u)}),this.listeners.push(e(E.state.players).onAdd((a,c)=>{var y;this.playerStateListenersUnsub.has(c)&&((y=this.playerStateListenersUnsub.get(c))==null||y());const u=e(a).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(c,u),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(e(E.state.players).onRemove((a,c)=>{var u;(u=this.playerStateListenersUnsub.get(c))==null||u(),this.playerStateListenersUnsub.delete(c),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(E.onMessage("cardsByIds",a=>{if(this.scene.isActive()){Object.entries(a).forEach(([p,m])=>{In.set(p,m)});const c=this.cameras.main.centerX,u=this.cameras.main.centerY,y=this.cameras.main.width;this.createShopCardsDisplay(c,u,y)}}));const r=E.state.players.get(s);if(r){const a=()=>{if(!this.scene.isActive())return;this.requestMissingCardData();const c=this.cameras.main.centerX,u=this.cameras.main.centerY,y=this.cameras.main.width;this.createShopCardsDisplay(c,u,y)};this.shopOfferListenersUnsub.push(e(r.shopOfferIds).onAdd(a)),this.shopOfferListenersUnsub.push(e(r.shopOfferIds).onRemove(a)),a(),this.listeners.push(e(r).listen("brews",()=>{this.scene.isActive()&&this.updateRefreshButtonState()})),this.listeners.push(e(r).listen("shopRefreshCost",()=>{this.scene.isActive()&&this.updateRefreshButtonState()}))}}cleanupListeners(){var e,s,r,a;console.log("Shop Scene: Cleaning up listeners."),(e=this.phaseListenerUnsub)==null||e.call(this),this.phaseListenerUnsub=null,this.playerStateListenersUnsub.forEach(c=>c()),this.playerStateListenersUnsub.clear(),this.shopOfferListenersUnsub.forEach(c=>c()),this.shopOfferListenersUnsub=[],this.listeners.forEach(c=>c()),this.listeners=[],this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(s=this.continueButton)==null||s.off("pointerdown"),(r=this.continueButton)==null||r.off("pointerover"),(a=this.continueButton)==null||a.off("pointerout")}updateWaitingStatus(){if(!E||!E.sessionId||!this.continueButton||!this.waitingText||!this.scene.isActive())return;const e=E.state.players.get(E.sessionId);if(!e)return;let s=!0;E.state.players.forEach(u=>{u.isReady||(s=!1)});const r=e.isReady,a=E.state.currentPhase===Ee.Shop,c=!r&&a;this.continueButton.setInteractive(c),this.continueButton.setColor(c?"#00ff00":"#888888"),r&&!s&&a?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.continueButton.setText("Waiting...")):a?(this.waitingText.setVisible(!1),this.continueButton.setText("Continue")):(this.waitingText.setText(`Waiting for ${E.state.currentPhase} phase...`).setVisible(!0),this.continueButton.setText("Continue")),this.shopCardObjects.forEach(u=>{u.input&&(u.input.enabled=c)})}shutdown(){var e,s,r,a,c,u,y,p;console.log("Shop scene shutting down."),this.cleanupListeners(),this.shopCardObjects.forEach(m=>m.destroy()),this.shopCardObjects=[],(e=this.continueButton)==null||e.destroy(),(s=this.waitingText)==null||s.destroy(),(r=this.refreshButton)==null||r.off("pointerdown"),(a=this.refreshButton)==null||a.off("pointerover"),(c=this.refreshButton)==null||c.off("pointerout"),(u=this.refreshButton)==null||u.destroy(),(y=this.toggleShopButton)==null||y.destroy(),(p=this.shopOffersContainer)==null||p.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class fu extends pn.Scene{constructor(){super("Preparation");q(this,"startBattleButton");q(this,"waitingText");q(this,"playerStateListener",null);q(this,"handListener",null);q(this,"battlefieldListener",null);q(this,"phaseListener",null);q(this,"playerStateListenerUnsub",null);q(this,"handAddUnsub",null);q(this,"handRemoveUnsub",null);q(this,"handChangeUnsub",null);q(this,"battlefieldAddUnsub",null);q(this,"battlefieldRemoveUnsub",null);q(this,"battlefieldChangeUnsub",null);q(this,"phaseListenerUnsub",null);q(this,"otherPlayerChangeListeners",new Map);q(this,"otherPlayerAddUnsub",null);q(this,"otherPlayerRemoveUnsub",null);q(this,"clientSideCardLayout",new Map)}create(){var a;if(this.scene.launch("background"),(a=this.scene.get("BoardView"))!=null&&a.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!E||!E.state||!E.sessionId){console.error("Preparation Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>this.scene.start("MainMenu"));return}const e=this.cameras.main.centerX;this.cameras.main.centerY;const s=this.cameras.main.height;this.cameras.main.width;const r=E.state.players.get(E.sessionId);r?console.log("Preparation Create: Initial myPlayerState.hand contents:",JSON.stringify(Object.fromEntries(r.hand.entries()))):console.log("Preparation Create: myPlayerState not found initially."),this.add.text(e,80,"Preparation Phase",{fontFamily:"Arial Black",fontSize:48,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.startBattleButton=this.add.text(e,s-50,"Start Battle",{fontFamily:"Arial Black",fontSize:40,color:"#888888",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.startBattleButton.setColor("#888888").disableInteractive(),this.waitingText=this.add.text(e,s-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(100,this.updateStartButtonState,[],this),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!E||!E.sessionId)return;const e=E.sessionId,s=cn.getStateCallbacks(E),r=E.state.players.get(e);r?(this.playerStateListenerUnsub=s(r).onChange(()=>{this.scene.isActive()&&this.updateWaitingStatus()}),this.handAddUnsub=s(r.hand).onAdd((a,c)=>{console.log(`Preparation Scene: player.hand.onAdd triggered for key: ${c}, card: ${a==null?void 0:a.name}. Scene active: ${this.scene.isActive()}`),this.scene.isActive()&&this.updateStartButtonState()}),this.handRemoveUnsub=s(r.hand).onRemove((a,c)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldAddUnsub=s(r.battlefield).onAdd((a,c)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldRemoveUnsub=s(r.battlefield).onRemove((a,c)=>{this.scene.isActive()&&this.updateStartButtonState()})):console.error("Preparation Scene: My player state not found on init."),this.phaseListenerUnsub=s(E.state).listen("currentPhase",a=>{this.scene.isActive()&&(console.log(`Preparation Scene: Phase changed to ${a}`),a===Ee.Battle?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Battle")):a!==Ee.Preparation&&(console.warn(`Preparation Scene: Unexpected phase change to ${a}. Returning to Lobby.`),this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby"))),this.updateWaitingStatus())}),this.otherPlayerAddUnsub=s(E.state.players).onAdd((a,c)=>{if(this.scene.isActive()){if(c!==e){const u=s(a).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(c,u)}this.updateWaitingStatus()}}),this.otherPlayerRemoveUnsub=s(E.state.players).onRemove((a,c)=>{if(this.scene.isActive()){const u=this.otherPlayerChangeListeners.get(c);u==null||u(),this.otherPlayerChangeListeners.delete(c),this.updateWaitingStatus()}}),E.state.players.forEach((a,c)=>{if(c!==e){const u=s(a).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(c,u)}})}cleanupListeners(){var e,s,r,a,c,u,y,p,m,h,I,M,H;console.log("Preparation Scene: Cleaning up listeners."),(e=this.playerStateListenerUnsub)==null||e.call(this),(s=this.handAddUnsub)==null||s.call(this),(r=this.handRemoveUnsub)==null||r.call(this),(a=this.handChangeUnsub)==null||a.call(this),(c=this.battlefieldAddUnsub)==null||c.call(this),(u=this.battlefieldRemoveUnsub)==null||u.call(this),(y=this.battlefieldChangeUnsub)==null||y.call(this),(p=this.phaseListenerUnsub)==null||p.call(this),(m=this.otherPlayerAddUnsub)==null||m.call(this),(h=this.otherPlayerRemoveUnsub)==null||h.call(this),this.otherPlayerChangeListeners.forEach($=>$()),this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.otherPlayerChangeListeners.clear(),this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(I=this.startBattleButton)==null||I.off("pointerdown"),(M=this.startBattleButton)==null||M.off("pointerover"),(H=this.startBattleButton)==null||H.off("pointerout")}makeLocalPlayerCardsDraggable(){if(!E||!E.sessionId||!this.scene.isActive()){console.warn("Preparation: Cannot make cards draggable, room/session/scene inactive.");return}const e=E.sessionId,s=E.state.players.get(e),r=this.scene.get("BoardView");if(!s||!r){console.warn("Preparation: Player state or BoardView not found for making cards draggable.");return}this.clientSideCardLayout.forEach(c=>{c.gameObject&&c.gameObject.input&&this.input.disable(c.gameObject)}),this.clientSideCardLayout.clear();const a=(c,u)=>{c.forEach((y,p)=>{const m=r.getCardGameObjectByInstanceId(y.instanceId);m?(m.setInteractive({useHandCursor:!0}),this.input.setDraggable(m),this.clientSideCardLayout.set(y.instanceId,{area:u,slotKey:p,gameObject:m})):console.warn(`Preparation: Could not find GameObject in BoardView for card instance ${y.instanceId}`)})};a(s.hand,"hand"),a(s.battlefield,"battlefield"),console.log("Preparation: Made local player cards draggable and initialized clientSideCardLayout.",this.clientSideCardLayout),this.updateStartButtonState()}updateWaitingStatus(){if(!E||!E.sessionId||!this.startBattleButton||!this.waitingText)return;const e=E.state.players.get(E.sessionId);if(!e)return;let s=!0;E.state.players.forEach(a=>{a.isReady||(s=!1)});const r=e.isReady;!r&&(E.state.currentPhase,Ee.Preparation),this.updateStartButtonState(),r&&!s?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.startBattleButton.setText("Waiting..."),this.startBattleButton.disableInteractive().setColor("#888888")):(this.waitingText.setVisible(!1),this.startBattleButton.setText("Start Battle"),this.updateStartButtonState())}updateStartButtonState(){if(!this.startBattleButton||!this.startBattleButton.active){console.warn("updateStartButtonState called but button is null or inactive.");return}let e=0;const s=this.scene.get("BoardView");s&&s.scene.isActive()&&s.getLocalPlayerLayoutData().forEach(m=>{m.area==="battlefield"&&e++});const r=e>0,a=E==null?void 0:E.state.players.get(E==null?void 0:E.sessionId),c=(a==null?void 0:a.isReady)??!1,u=(E==null?void 0:E.state.currentPhase)===Ee.Preparation;r&&!c&&u?(this.startBattleButton.setColor("#00ff00"),this.startBattleButton.setInteractive({useHandCursor:!0}),this.startBattleButton.off("pointerdown"),this.startBattleButton.once("pointerdown",this.confirmPreparation,this),this.startBattleButton.on("pointerover",()=>this.startBattleButton.setColor("#55ff55")),this.startBattleButton.on("pointerout",()=>this.startBattleButton.setColor("#00ff00"))):(this.waitingText&&!this.waitingText.visible&&this.startBattleButton.setColor("#888888"),this.startBattleButton.disableInteractive(),this.startBattleButton.off("pointerdown"),this.startBattleButton.off("pointerover"),this.startBattleButton.off("pointerout"))}confirmPreparation(){if(!E)return;console.log("Confirming preparation layout...");const e=this.scene.get("BoardView");if(!e||!e.scene.isActive()){console.error("Preparation: BoardView not available to get layout data.");return}const{handLayout:s,battlefieldLayout:r}=e.getCardLayouts();console.log("Sending preparation layout to server:",{handLayout:s,battlefieldLayout:r}),E.send("setPreparation",{handLayout:s,battlefieldLayout:r}),this.updateWaitingStatus()}shutdown(){var e,s;console.log("Preparation scene shutting down explicitly."),this.cleanupListeners(),(e=this.startBattleButton)==null||e.destroy(),(s=this.waitingText)==null||s.destroy(),this.clientSideCardLayout.clear(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class pu extends pn.Scene{constructor(){super("Battle");q(this,"handCardDisplayObjects",new Map);q(this,"battleOver",!1);q(this,"resultText");q(this,"statusText");q(this,"phaseListenerUnsubscribe",null)}create(){if(this.scene.launch("background"),this.battleOver=!1,!E||!E.state||!E.sessionId){console.error("Battle Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{E==null||E.leave()}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,s=this.cameras.main.centerY,r=this.cameras.main.height;this.cameras.main.width,this.resultText=this.add.text(e,s,"",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setAlpha(0),this.statusText=this.add.text(e,r-50,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5).setAlpha(0),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!E||!E.state)return;const e=cn.getStateCallbacks(E);this.phaseListenerUnsubscribe=e(E.state).listen("currentPhase",s=>{if(this.scene.isActive()){if(console.log(`Battle Scene: Phase changed to ${s}`),s===Ee.BattleEnd)this.handleBattleEnd();else if(s===Ee.Shop)this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"));else if(s===Ee.GameOver)this.handleGameOver();else if(s!==Ee.Battle&&(console.warn(`Battle Scene: Unexpected phase change to ${s}. Returning to Lobby.`),this.scene.isActive())){try{E==null||E.leave()}catch{}this.scene.stop(),this.scene.start("Lobby")}}})}cleanupListeners(){var e;console.log("Battle Scene: Cleaning up listeners."),(e=this.phaseListenerUnsubscribe)==null||e.call(this),this.phaseListenerUnsubscribe=null}handleBattleEnd(){var c,u;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Battle ended (server signal received). Displaying results.");const e=E==null?void 0:E.state.players.get(E.sessionId);let s;E==null||E.state.players.forEach((y,p)=>{p!==(E==null?void 0:E.sessionId)&&(s=y)});let r="Battle Ended",a="#ffffff";e&&s?e.health>s.health?(r="Victory!",a="#88ff88"):s.health>e.health?(r="Defeat!",a="#ff8888"):(r="Draw!",a="#ffff88"):(r="Battle Ended (Opponent Left?)",a="#ffffff"),(c=this.resultText)!=null&&c.active&&this.resultText.setText(r).setColor(a).setAlpha(1),(u=this.statusText)!=null&&u.active&&this.statusText.setText("Waiting for next round...").setAlpha(1)}handleGameOver(){var c,u;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Game Over signal received.");const e=E==null?void 0:E.state.players.get(E.sessionId);let s;E==null||E.state.players.forEach((y,p)=>{p!==(E==null?void 0:E.sessionId)&&(s=y)});let r="Game Over!",a="#ffffff";e&&s?e.health>s.health?(r="You Win!",a="#00ff00"):s.health>e.health?(r="You Lose!",a="#ff0000"):(r="Draw!",a="#ffff00"):e?(r="You Win! (Opponent Left)",a="#00ff00"):(r="Game Over (Error?)",a="#ff0000"),(c=this.resultText)!=null&&c.active&&this.resultText.setText(r).setColor(a).setAlpha(1),(u=this.statusText)!=null&&u.active&&this.statusText.setText("Click to return to Main Menu").setAlpha(1),this.input.once("pointerdown",()=>{try{E==null||E.leave()}catch{}this.scene.stop("Background"),this.scene.start("MainMenu")})}shutdown(){var e,s;console.log("Battle scene shutting down explicitly."),this.cleanupListeners(),this.handCardDisplayObjects.forEach(r=>{r==null||r.forEach(a=>a==null?void 0:a.destroy())}),this.handCardDisplayObjects.clear(),(e=this.resultText)==null||e.destroy(),(s=this.statusText)==null||s.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const Cn=100,ar=140,Ht=120,jt=168,Jr=15,or=580,lr=420,cr=100,ur=260;class gu extends pn.Scene{constructor(){super("BoardView");q(this,"playerVisuals",new Map);q(this,"currentPhase",Ee.Lobby);q(this,"sellZone");q(this,"sellZoneRect");q(this,"sellZoneText");q(this,"brewGainText");q(this,"playerHealthText");q(this,"opponentHealthText");q(this,"playerBrewsText");q(this,"dayPhaseText");q(this,"opponentUsernameText");q(this,"listeners",[]);q(this,"cardSchemaListeners",new Map)}updateCardHpVisuals(e,s,r){if(!e||!e.active)return;const a=e.getData("hpTextObject"),c=e.getData("mainCardImage");if(a&&a.active){a.setText(`${s}/${r}`);const y=r>0?s/r:0;s<=0?a.setColor("#ff0000"):y<.3?a.setColor("#ff8888"):y<.6?a.setColor("#ffff88"):a.setColor("#88ff88")}const u=e.alpha<1;s<=0?u||(e.setAlpha(.6),c&&c.active&&typeof c.setTint=="function"&&c.setTint(7829367)):u&&(e.setAlpha(1),c&&c.active&&typeof c.clearTint=="function"?c.clearTint():c&&c.active&&console.warn("BoardView: updateCardHpVisuals - clearTint method not found on mainCardImage for card.",e.getData("instanceId"),c))}preload(){if(!this.textures.exists("cardBack")){const e=this.make.graphics({x:0,y:0});e.fillStyle(5253758),e.fillRect(0,0,Ht,jt),e.lineStyle(2,12428501),e.strokeRect(0,0,Ht,jt),e.generateTexture("cardBack",Ht,jt),e.destroy()}}create(){console.log("BoardView creating..."),this.createNavbar(),this.createSellZone(),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createNavbar(){const e=this.cameras.main.centerX,s=this.cameras.main.width,r=30;this.add.rectangle(e,r,s,50,0,.7).setDepth(1e3);const c={fontFamily:"Arial",fontSize:16,color:"#ffffff",align:"left"};this.playerHealthText=this.add.text(s*.05,r,"You: -- HP",{...c,color:"#00ff00"}).setOrigin(0,.5).setDepth(1001),this.playerBrewsText=this.add.text(s*.95,r,"Brews: --",{...c,color:"#ffff00",align:"right"}).setOrigin(1,.5).setDepth(1001),this.opponentUsernameText=this.add.text(s*.25,r-10,"Opponent: --",{...c,fontSize:14}).setOrigin(0,.5).setDepth(1001),this.opponentHealthText=this.add.text(s*.25,r+10,"-- HP",{...c,color:"#ff0000"}).setOrigin(0,.5).setDepth(1001),this.dayPhaseText=this.add.text(e,r,"Day -- - Phase --",{...c,fontSize:20,align:"center"}).setOrigin(.5).setDepth(1001)}showAttackAnimation(e){const s=this.getCardGameObjectByInstanceId(e);if(s&&s.active){const r=s.scaleX,a=s.scaleY;this.tweens.add({targets:s,scaleX:r*1.15,scaleY:a*1.15,duration:100,yoyo:!0,ease:"Sine.easeInOut"})}}showDamageNumber(e,s){const r=this.getCardGameObjectByInstanceId(e);if(r&&r.active&&s>0){const a=this.add.text(r.x+Phaser.Math.Between(-10,10),r.y-jt/2-10,`-${s}`,{fontFamily:"Arial Black",fontSize:24,color:"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(r.depth+1);this.tweens.add({targets:a,y:a.y-50,alpha:0,duration:1e3,ease:"Power1",onComplete:()=>{a.destroy()}})}}drawAttackLine(e,s){const r=this.getCardGameObjectByInstanceId(e),a=this.getCardGameObjectByInstanceId(s);if(r&&r.active&&a&&a.active){const c=this.add.line(0,0,r.x,r.y,a.x,a.y,16724787,.7).setOrigin(0,0).setLineWidth(2).setDepth(r.depth);this.time.delayedCall(250,()=>{c.destroy()})}}setupColyseusListeners(){if(!E||!E.state){console.error("BoardView: Colyseus room or state not available!"),this.time.delayedCall(100,this.setupColyseusListeners,[],this);return}const e=cn.getStateCallbacks(E);this.listeners.push(e(E.state).listen("currentDay",()=>this.updateNavbarText())),this.listeners.push(e(E.state).listen("currentPhase",(s,r)=>{this.currentPhase=s,this.updateNavbarText(),s===Ee.Shop||s===Ee.Preparation?this.sellZone.setVisible(!0):this.sellZone.setVisible(!1);const a=(c,u,y,p)=>{if(!c.active)return;const m=c.getData("cooldownBarBg"),h=c.getData("cooldownBarFill");if(s===Ee.Battle){if(c.getData("area")==="battlefield")if(u)if(m&&h){m.setVisible(!0),h.setVisible(!0);const M=c.getData("cooldownBarBaseWidth"),H=typeof M=="number"?M:Cn-10;h.setSize(H,6);const $=(u.speed>0?u.speed:1.5)*1e3;c.setData("maxAttackCooldown",$),c.setData("attackCooldownTimer",$)}else console.warn(`BoardView: Battle Phase - Card ${u.instanceId} (Owner: ${y}, Slot: ${p}) missing cooldown bar elements in data. Bg: ${!!m}, Fill: ${!!h}`);else console.warn(`BoardView: Battle Phase - Battlefield card container (Owner: ${y}, Slot: ${p}) has no cardSchema. No cooldown bar shown.`)}else m&&m.setVisible(!1),h&&h.setVisible(!1);if((r===Ee.Battle||r===Ee.BattleEnd)&&s!==Ee.Battle&&s!==Ee.BattleEnd&&u&&u.currentHp>0){c.setAlpha(1);const I=c.getData("mainCardImage");I&&I.active&&typeof I.clearTint=="function"&&I.clearTint()}};this.playerVisuals.forEach((c,u)=>{c.battlefield.forEach((y,p)=>{var h;const m=(h=E==null?void 0:E.state.players.get(u))==null?void 0:h.battlefield.get(p);a(y,m,u,p)}),c.hand.forEach((y,p)=>{var h;const m=(h=E==null?void 0:E.state.players.get(u))==null?void 0:h.hand.get(p);if((r===Ee.Battle||r===Ee.BattleEnd)&&s!==Ee.Battle&&s!==Ee.BattleEnd&&m&&m.currentHp>0){y.setAlpha(1);const I=y.getData("mainCardImage");I&&I.active&&typeof I.clearTint=="function"&&I.clearTint()}})})})),this.listeners.push(e(E.state.players).onAdd((s,r)=>{console.log(`BoardView: Player added ${r}`),this.addPlayerVisuals(r),this.addPlayerListeners(s,r),this.updatePlayerSlots(s,r),this.updateNavbarText()})),this.listeners.push(e(E.state.players).onRemove((s,r)=>{console.log(`BoardView: Player removed ${r}`),this.removePlayerVisuals(r),this.updateNavbarText()})),this.listeners.push(E.onMessage("battleAttackEvent",s=>{if(this.currentPhase!==Ee.Battle||!this.scene.isActive())return;console.log("BoardView: Received battleAttackEvent",s);const r=this.getCardGameObjectByInstanceId(s.attackerInstanceId),a=this.getCardGameObjectByInstanceId(s.targetInstanceId);if(r&&r.active&&a&&a.active){this.drawAttackLine(s.attackerInstanceId,s.targetInstanceId),this.showAttackAnimation(s.attackerInstanceId),this.showDamageNumber(s.targetInstanceId,s.damageDealt);const c=r.getData("maxAttackCooldown");if(c>0){r.setData("attackCooldownTimer",c);const m=r.getData("cooldownBarFill"),h=r.getData("cooldownBarBaseWidth")||Cn-10;m&&m.setSize(h,6)}const u=a.getData("ownerSessionId"),y=a.getData("slotKey"),p=a.getData("area");if(u===s.targetPlayerId&&p==="battlefield"&&y){const m=E.state.players.get(s.targetPlayerId),h=m==null?void 0:m.battlefield.get(y);if(h&&h.instanceId===s.targetInstanceId){const I=Math.max(0,h.currentHp-s.damageDealt);this.updateCardHpVisuals(a,I,h.health)}else console.warn(`BoardView: battleAttackEvent - Target card schema not found or instanceId mismatch for player ${s.targetPlayerId}, slot ${y}, instance ${s.targetInstanceId}.`)}else console.warn(`BoardView: battleAttackEvent - Target card container data inconsistent or not on battlefield. Owner: ${u}, Area: ${p}, Slot: ${y}`)}else console.warn("BoardView: Attacker or target not found/active for battleAttackEvent",s)})),E.state.players.forEach((s,r)=>{this.addPlayerVisuals(r),this.addPlayerListeners(s,r),this.updatePlayerSlots(s,r)}),this.updateNavbarText()}update(e,s){!this.scene.isActive()||this.currentPhase!==Ee.Battle||!E||!E.state||this.playerVisuals.forEach(r=>{r.battlefield.forEach(a=>{if(!a.active)return;const c=a.getData("maxAttackCooldown");let u=a.getData("attackCooldownTimer");const y=a.getData("cooldownBarBaseWidth")||Cn-10;if(c>0){u-=s,u<0&&(u=0),a.setData("attackCooldownTimer",u);const p=a.getData("cooldownBarFill");if(p&&p.visible){const m=u/c;p.setSize(y*Math.max(0,m),6)}}})})}addPlayerListeners(e,s){const r=cn.getStateCallbacks(E),a=[];a.push(r(e).listen("health",()=>this.updateNavbarText())),a.push(r(e).listen("brews",()=>this.updateNavbarText())),a.push(r(e).listen("username",()=>this.updateNavbarText())),a.push(r(e.hand).onAdd((c,u)=>{this.updateCardVisual(s,"hand",u,c),this.addCardSchemaListeners(c)})),a.push(r(e.hand).onRemove((c,u)=>{this.removeCardVisual(s,"hand",u)})),e.hand.forEach((c,u)=>{this.addCardSchemaListeners(c)}),a.push(r(e.battlefield).onAdd((c,u)=>{this.updateCardVisual(s,"battlefield",u,c),this.addCardSchemaListeners(c)})),a.push(r(e.battlefield).onRemove((c,u)=>{this.removeCardVisual(s,"battlefield",u)})),e.battlefield.forEach((c,u)=>{this.addCardSchemaListeners(c)}),this.listeners.push(...a)}addCardSchemaListeners(e){if(!e||!e.instanceId)return;const s=cn.getStateCallbacks(E),r=this.cardSchemaListeners.get(e.instanceId);r&&(r.forEach(u=>u()),this.cardSchemaListeners.delete(e.instanceId));const a=[],c=s(e).listen("currentHp",(u,y)=>{const p=this.getCardGameObjectByInstanceId(e.instanceId);p&&this.updateCardHpVisuals(p,u,e.health)});a.push(c),a.length>0&&this.cardSchemaListeners.set(e.instanceId,a)}updatePlayerSlots(e,s){e.hand.forEach((r,a)=>this.updateCardVisual(s,"hand",a,r)),e.battlefield.forEach((r,a)=>this.updateCardVisual(s,"battlefield",a,r))}addPlayerVisuals(e){if(!this.playerVisuals.has(e)){const s=[],r=[],a=e===(E==null?void 0:E.sessionId);for(let c=0;c<5;c++){const u=this.calculateSlotX(c,"hand"),y=a?or:cr,p=this.add.rectangle(u,y,Ht,jt).setStrokeStyle(2,a?11184810:7829367,.8).setDepth(0);s.push(p);const m=this.calculateSlotX(c,"battlefield"),h=a?lr:ur,I=this.add.rectangle(m,h,Cn,ar).setStrokeStyle(2,a?16777215:11184810,1).setDepth(0);r.push(I)}this.playerVisuals.set(e,{hand:new Map,battlefield:new Map,handSlotOutlines:s,battlefieldSlotOutlines:r})}}removePlayerVisuals(e){const s=this.playerVisuals.get(e);s&&(s.hand.forEach(r=>r.destroy()),s.battlefield.forEach(r=>r.destroy()),s.handSlotOutlines.forEach(r=>r.destroy()),s.battlefieldSlotOutlines.forEach(r=>r.destroy())),this.playerVisuals.delete(e)}updateCardVisual(e,s,r,a){if(!this.scene.isActive()||!E||!E.state)return;this.removeCardVisual(e,s,r);const c=this.playerVisuals.get(e);if(!c)return;const u=e===(E==null?void 0:E.sessionId),y=this.calculateSlotX(parseInt(r,10),s);let p,m=!1;s==="hand"?(p=u?or:cr,u||(m=!0)):p=u?lr:ur;const h=this.createCardGameObject(a,y,p,m,u,s);if(h.setData("instanceId",a.instanceId),h.setData("slotKey",r),h.setData("area",s),h.setData("ownerSessionId",e),h.setDepth(1),a.currentHp<=0){h.setAlpha(.6);const I=h.getData("mainCardImage");I&&I.active&&typeof I.setTint=="function"&&I.setTint(7829367);const M=h.getData("hpTextObject");M&&M.active&&M.setColor("#ff0000")}s==="hand"?c.hand.set(r,h):c.battlefield.set(r,h),this.addCardSchemaListeners(a),u&&this.makeCardInteractive(h)}removeCardVisual(e,s,r){const a=this.playerVisuals.get(e);if(a){const c=s==="hand"?a.hand:a.battlefield,u=c.get(r);if(u){const y=u.getData("instanceId");if(y){const p=this.cardSchemaListeners.get(y);p&&(console.log(`BoardView: Cleaning up ${p.length} listeners for card instance ${y} during removeCardVisual.`),p.forEach(m=>{if(typeof m=="function")try{m()}catch(h){console.warn(`BoardView: Error unsubscribing card listener for ${y}`,h)}}),this.cardSchemaListeners.delete(y))}u.input&&u.input.enabled&&this.input.disable(u),this.time.delayedCall(1,()=>{u.active&&u.destroy()}),c.delete(r)}}}calculateSlotX(e,s){const r=s==="hand"?Ht:Cn,a=5*r+4*Jr;return(this.cameras.main.width-a)/2+r/2+e*(r+Jr)}createCardGameObject(e,s,r,a,c,u){const y=this.add.container(s,r),p=u==="hand"?Ht:Cn,m=u==="hand"?jt:ar;if(y.setData("displayCardWidth",p),y.setData("displayCardHeight",m),a){const M=this.add.image(0,0,"cardBack").setOrigin(.5).setDisplaySize(Ht,jt);return y.add(M),y}const h=u==="hand"?"cardFullTier1":"cardMinionTier1",I=this.add.image(0,0,h).setOrigin(.5);if(I.setDisplaySize(p,m),y.add(I),y.setData("mainCardImage",I),u==="hand"){const M=this.add.text(0,-20,e.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:p-20}}).setOrigin(.5,.5);y.add(M);const H=this.add.text(-Cn/2+32,ar*.03,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);y.add(H);const $=this.add.text(Cn/2-18,6,`${e.currentHp}  ${e.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(1,.5);y.add($),y.setData("hpTextObject",$);const U=this.add.text(0,m/2-50,`${e.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);y.add(U)}else{const M=this.add.text(0,-m/2+5,e.name,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:p}}).setOrigin(.5,0);y.add(M);const H=this.add.text(-p/2+32,32,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);y.add(H);const $=this.add.text(0,43,`${e.speed}`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(1,0);y.add($);const U=this.add.text(p/2-10,m/2-30,`${e.currentHp}/${e.health}`,{fontFamily:"Arial",fontSize:14,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,1);y.add(U),y.setData("hpTextObject",U);const he=m/2-15,ae=p-10,X=this.add.rectangle(0,he,ae,6,0,.5).setVisible(!1),Pe=this.add.rectangle(-ae/2,he,ae,6,4521796).setOrigin(0,.5).setVisible(!1);y.add(X),y.add(Pe),y.setData("cooldownBarBg",X),y.setData("cooldownBarFill",Pe),y.setData("attackCooldownTimer",0),y.setData("maxAttackCooldown",0),y.setData("cooldownBarBaseWidth",ae)}return y}getCardGameObjectByInstanceId(e){for(const[s,r]of this.playerVisuals){for(const[a,c]of r.hand)if(c.getData("instanceId")===e)return c;for(const[a,c]of r.battlefield)if(c.getData("instanceId")===e)return c}}getSlotPixelPosition(e,s,r){if(r<0||r>4)return;const a=this.calculateSlotX(r,s);let c;return s==="hand"?c=e?or:cr:c=e?lr:ur,{x:a,y:c}}makeCardInteractive(e){const s=e.getData("displayCardWidth"),r=e.getData("displayCardHeight");if(!s||!r){console.warn("BoardView: makeCardInteractive - displayCardWidth/Height not found on container.",e.getData("instanceId"));return}const a=new Phaser.Geom.Rectangle(-s/2,-r/2,s,r);e.setInteractive({hitArea:a,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}),this.input.setDraggable(e),e.input&&(e.input.enabled=!0),e.on("dragstart",c=>{this.currentPhase!==Ee.Shop&&this.currentPhase!==Ee.Preparation||!e.input||!e.input.enabled||(this.children.bringToTop(e),e.setAlpha(.7),e.setData("isDragging",!0),e.setData("originalX",e.x),e.setData("originalY",e.y),e.setData("originalAreaOnDragStart",e.getData("area")),e.setData("originalSlotKeyOnDragStart",e.getData("slotKey")))}),e.on("drag",(c,u,y)=>{if(e.getData("isDragging"))if(e.x=u,e.y=y,(this.currentPhase===Ee.Shop||this.currentPhase===Ee.Preparation)&&this.sellZone.visible)if(this.isDroppedOnSellZone(e)){const p=e.getData("instanceId"),m=e.getData("originalAreaOnDragStart"),h=e.getData("originalSlotKeyOnDragStart"),I=e.getData("ownerSessionId"),M=E==null?void 0:E.state.players.get(I);let H;if(M&&(m==="hand"?H=M.hand.get(h):H=M.battlefield.get(h)),H&&H.instanceId===p){const $=Math.max(1,Math.floor(H.brewCost/2));this.brewGainText.setText(`Sell: +${$} `),this.brewGainText.setAlpha(1)}else this.brewGainText.setAlpha(0)}else this.brewGainText.setAlpha(0);else this.brewGainText.setAlpha(0)}),e.on("dragend",c=>{if(!e.getData("isDragging"))return;e.setAlpha(1),e.setData("isDragging",!1),this.brewGainText.setAlpha(0);const u=e.getData("instanceId"),y=e.getData("originalAreaOnDragStart"),p=e.getData("originalSlotKeyOnDragStart"),m=e.getData("ownerSessionId");if((this.currentPhase===Ee.Shop||this.currentPhase===Ee.Preparation)&&this.sellZone.visible&&this.isDroppedOnSellZone(e)){const H=E==null?void 0:E.state.players.get(E==null?void 0:E.sessionId);let $;if(y==="hand"&&(H!=null&&H.hand.has(p))?$=H.hand.get(p):y==="battlefield"&&(H!=null&&H.battlefield.has(p))&&($=H.battlefield.get(p)),$&&$.instanceId===u){const U=Math.max(1,Math.floor($.brewCost/2));E==null||E.send("sellCard",{instanceId:u,area:y,slotKey:p}),this.showBrewGain(U);return}}let h=!1,I,M;for(let H=0;H<5;H++){const $=String(H),U=this.getSlotPixelPosition(!0,"hand",H);if(U){const he=new Phaser.Geom.Rectangle(U.x-Ht/2,U.y-jt/2,Ht,jt);if(Phaser.Geom.Rectangle.Contains(he,e.x,e.y)){if(this.isSlotEmpty(m,"hand",$,u)){let ae=!1;if(this.currentPhase===Ee.Shop?y==="hand"&&(ae=!0):this.currentPhase===Ee.Preparation&&y==="hand"&&(ae=!0),ae){e.x=U.x,e.y=U.y;const X=y!=="hand";if(e.setData("area","hand"),e.setData("slotKey",$),this.updateVisualMaps(m,y,p,"hand",$,e),X){const Pe=E==null?void 0:E.state.players.get(m);let Ae;Pe&&(Ae=Pe.hand.get($),Ae||(y==="battlefield"?Ae=Pe.battlefield.get(p):Ae=Pe.hand.get(p))),Ae&&Ae.instanceId===u&&this.updateCardVisual(m,"hand",$,Ae)}h=!0,I="hand",M=$,this.currentPhase===Ee.Shop&&(y!=="hand"||p!==$)&&(E==null||E.send("moveCardInHand",{instanceId:u,fromSlotKey:p,toSlotKey:$}))}}if(h)break}}}if(!h&&this.currentPhase===Ee.Preparation)for(let H=0;H<5;H++){const $=String(H),U=this.getSlotPixelPosition(!0,"battlefield",H);if(U){const he=new Phaser.Geom.Rectangle(U.x-Ht/2,U.y-jt/2,Ht,jt);if(Phaser.Geom.Rectangle.Contains(he,e.x,e.y)){if(this.isSlotEmpty(m,"battlefield",$,u)){e.x=U.x,e.y=U.y;const ae=y!=="battlefield";if(e.setData("area","battlefield"),e.setData("slotKey",$),this.updateVisualMaps(m,y,p,"battlefield",$,e),ae){const X=E==null?void 0:E.state.players.get(m),Pe=(X==null?void 0:X.battlefield.get($))||(X==null?void 0:X.hand.get(p));Pe&&Pe.instanceId===u&&this.updateCardVisual(m,"battlefield",$,Pe)}h=!0,I="battlefield",M=$}break}}}if(h?this.currentPhase===Ee.Preparation&&I&&M&&(y!==I||p!==M)&&(E==null||E.send("updatePrepLayout",{instanceId:u,newArea:I,newSlotKey:M})):(e.x=e.getData("originalX"),e.y=e.getData("originalY"),e.setData("area",y),e.setData("slotKey",p)),this.currentPhase===Ee.Preparation){const H=this.scene.get("Preparation");H&&H.scene.isActive()&&H.updateStartButtonState&&H.updateStartButtonState()}})}getCardLayouts(){const e={},s={};if(!E||!E.sessionId){for(let c=0;c<5;c++)e[String(c)]=null,s[String(c)]=null;return{handLayout:e,battlefieldLayout:s}}const r=E.sessionId,a=this.playerVisuals.get(r);for(let c=0;c<5;c++){const u=String(c);if(a&&a.hand.has(u)){const y=a.hand.get(u);e[u]=(y==null?void 0:y.getData("instanceId"))||null}else e[u]=null;if(a&&a.battlefield.has(u)){const y=a.battlefield.get(u);s[u]=(y==null?void 0:y.getData("instanceId"))||null}else s[u]=null}return{handLayout:e,battlefieldLayout:s}}isSlotEmpty(e,s,r,a){const c=this.playerVisuals.get(e);if(!c)return!1;const y=(s==="hand"?c.hand:c.battlefield).get(r);return y?y.getData("instanceId")===a:!0}isDroppedOnSellZone(e){return this.sellZone.visible?new Phaser.Geom.Rectangle(this.sellZone.x-this.sellZoneRect.width/2-20,this.sellZone.y-this.sellZoneRect.height/2-20,this.sellZoneRect.width+40,this.sellZoneRect.height+40).contains(e.x,e.y):!1}showBrewGain(e){this.brewGainText.setText(`+${e} `),this.brewGainText.setAlpha(1),this.brewGainText.y=-50,this.brewGainText.x=0,this.tweens.add({targets:this.brewGainText,scaleX:1.5,scaleY:1.5,duration:100,yoyo:!0,ease:"Cubic.easeOut",onComplete:()=>{this.tweens.add({targets:this.brewGainText,y:this.brewGainText.y-80,alpha:0,duration:1500,ease:"Power2"})}}),this.tweens.add({targets:this.sellZoneRect,fillAlpha:.7,duration:200,yoyo:!0,repeat:1,ease:"Cubic.easeOut"})}updateVisualMaps(e,s,r,a,c,u){const y=this.playerVisuals.get(e);if(!y)return;const p=s==="hand"?y.hand:y.battlefield;p.get(r)===u&&p.delete(r),(a==="hand"?y.hand:y.battlefield).set(c,u)}getPlayerCardGameObjects(e){const s=[],r=this.playerVisuals.get(e);return r&&(r.hand.forEach(a=>s.push(a)),r.battlefield.forEach(a=>s.push(a))),s}getLocalPlayerLayoutData(){const e=[];if(!E||!E.sessionId)return e;const s=E.sessionId,r=this.playerVisuals.get(s);return r&&(r.hand.forEach((a,c)=>{e.push({instanceId:a.getData("instanceId"),area:"hand",slotKey:a.getData("slotKey")})}),r.battlefield.forEach((a,c)=>{e.push({instanceId:a.getData("instanceId"),area:"battlefield",slotKey:a.getData("slotKey")})})),e}createSellZone(){this.sellZone=this.add.container(this.cameras.main.width-80,this.cameras.main.height/2),this.sellZone.setDepth(1e3),this.sellZoneRect=this.add.rectangle(0,0,120,160,16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1),this.sellZone.add(this.sellZoneRect),this.sellZoneText=this.add.text(0,0,"SELL",{fontFamily:"Arial Black",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.sellZone.add(this.sellZoneText),this.brewGainText=this.add.text(0,-50,"",{fontFamily:"Arial Black",fontSize:20,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setAlpha(0),this.sellZone.add(this.brewGainText);const e=this.add.text(0,50,`Drag cards here
to sell`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5);this.sellZone.add(e),this.input.on("dragenter",(s,r,a)=>{r instanceof Phaser.GameObjects.Container&&this.sellZone.visible&&this.isDroppedOnSellZone(r)&&(this.sellZoneRect.setFillStyle(16711680,.5),this.sellZoneRect.setStrokeStyle(3,16733525,1))}),this.input.on("dragleave",(s,r,a)=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.input.on("drop",()=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.sellZone.setVisible(!1)}updateNavbarText(){if(!E||!E.state||!this.playerHealthText||!this.playerHealthText.active)return;const e=E.sessionId,s=E.state.players.get(e);let r,a="Opponent: --";E.state.players.forEach((y,p)=>{p!==e&&(r=y,a=`Opponent: ${y.username||"Connecting..."}`)}),this.playerHealthText.setText(`You: ${(s==null?void 0:s.health)??"--"} HP`),this.playerBrewsText.setText(`Brews: ${(s==null?void 0:s.brews)??"--"}`),this.opponentUsernameText.setText(a),this.opponentHealthText.setText(`${(r==null?void 0:r.health)??"--"} HP`);const c=E.state.currentDay,u=E.state.currentPhase;this.dayPhaseText.setText(`Day ${c} - ${u}`)}cleanupListeners(){var e,s,r,a,c,u,y;console.log("BoardView: Cleaning up listeners."),this.listeners.forEach(p=>{if(typeof p=="function")try{p()}catch(m){console.warn("BoardView: Error cleaning up listener:",m)}}),this.listeners=[],this.cardSchemaListeners.forEach((p,m)=>{console.log(`BoardView cleanup: Cleaning up ${p.length} listeners for card instance ${m}`),p.forEach(h=>{if(typeof h=="function")try{h()}catch(I){console.warn(`BoardView: Error unsubscribing card listener for ${m}`,I)}})}),this.cardSchemaListeners.clear(),this.playerVisuals.forEach(p=>{p.hand.forEach(m=>m.destroy()),p.battlefield.forEach(m=>m.destroy())}),this.playerVisuals.clear(),(e=this.playerHealthText)==null||e.destroy(),(s=this.opponentHealthText)==null||s.destroy(),(r=this.playerBrewsText)==null||r.destroy(),(a=this.dayPhaseText)==null||a.destroy(),(c=this.opponentUsernameText)==null||c.destroy(),(u=this.sellZone)==null||u.destroy(),(y=this.brewGainText)==null||y.destroy(),this.input.off("dragenter"),this.input.off("dragleave"),this.input.off("drop")}shutdown(){console.log("BoardView shutting down..."),this.cleanupListeners(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}(async()=>(await Jc(),new dr({type:Phaser.AUTO,parent:"gameParent",width:1280,height:720,backgroundColor:"#000000",roundPixels:!1,pixelArt:!1,scene:[tu,iu,su,du,hu,fu,pu,gu,nu,ru]})))();
