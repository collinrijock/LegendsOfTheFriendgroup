import{c as xr,g as un}from"./phaser-B90dPXin.js";var Vs={};ArrayBuffer.isView||(ArrayBuffer.isView=i=>i!==null&&typeof i=="object"&&i.buffer instanceof ArrayBuffer);typeof FormData>"u"&&(xr.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var dn={},an=function(i,t){return an=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var f in o)Object.prototype.hasOwnProperty.call(o,f)&&(n[f]=o[f])},an(i,t)};function Sr(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");an(i,t);function n(){this.constructor=i}i.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Ft=function(){return Ft=Object.assign||function(t){for(var n,o=1,f=arguments.length;o<f;o++){n=arguments[o];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(t[l]=n[l])}return t},Ft.apply(this,arguments)};function Ar(i,t){var n={};for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&t.indexOf(o)<0&&(n[o]=i[o]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,o=Object.getOwnPropertySymbols(i);f<o.length;f++)t.indexOf(o[f])<0&&Object.prototype.propertyIsEnumerable.call(i,o[f])&&(n[o[f]]=i[o[f]]);return n}function Tr(i,t,n,o){var f=arguments.length,l=f<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,n):o,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(i,t,n,o);else for(var O=i.length-1;O>=0;O--)(g=i[O])&&(l=(f<3?g(l):f>3?g(t,n,l):g(t,n))||l);return f>3&&l&&Object.defineProperty(t,n,l),l}function _r(i,t){return function(n,o){t(n,o,i)}}function zs(i,t,n,o,f,l){function g(se){if(se!==void 0&&typeof se!="function")throw new TypeError("Function expected");return se}for(var O=o.kind,N=O==="getter"?"get":O==="setter"?"set":"value",_=!t&&i?o.static?i:i.prototype:null,L=t||(_?Object.getOwnPropertyDescriptor(_,o.name):{}),E,k=!1,W=n.length-1;W>=0;W--){var te={};for(var V in o)te[V]=V==="access"?{}:o[V];for(var V in o.access)te.access[V]=o.access[V];te.addInitializer=function(se){if(k)throw new TypeError("Cannot add initializers after decoration has completed");l.push(g(se||null))};var X=(0,n[W])(O==="accessor"?{get:L.get,set:L.set}:L[N],te);if(O==="accessor"){if(X===void 0)continue;if(X===null||typeof X!="object")throw new TypeError("Object expected");(E=g(X.get))&&(L.get=E),(E=g(X.set))&&(L.set=E),(E=g(X.init))&&f.unshift(E)}else(E=g(X))&&(O==="field"?f.unshift(E):L[N]=E)}_&&Object.defineProperty(_,o.name,L),k=!0}function Hs(i,t,n){for(var o=arguments.length>2,f=0;f<t.length;f++)n=o?t[f].call(i,n):t[f].call(i);return o?n:void 0}function Ws(i){return typeof i=="symbol"?i:"".concat(i)}function Js(i,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function vr(i,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,t)}function Rr(i,t,n,o){function f(l){return l instanceof n?l:new n(function(g){g(l)})}return new(n||(n=Promise))(function(l,g){function O(L){try{_(o.next(L))}catch(E){g(E)}}function N(L){try{_(o.throw(L))}catch(E){g(E)}}function _(L){L.done?l(L.value):f(L.value).then(O,N)}_((o=o.apply(i,t||[])).next())})}function Cr(i,t){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},o,f,l,g;return g={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function O(_){return function(L){return N([_,L])}}function N(_){if(o)throw new TypeError("Generator is already executing.");for(;g&&(g=0,_[0]&&(n=0)),n;)try{if(o=1,f&&(l=_[0]&2?f.return:_[0]?f.throw||((l=f.return)&&l.call(f),0):f.next)&&!(l=l.call(f,_[1])).done)return l;switch(f=0,l&&(_=[_[0]&2,l.value]),_[0]){case 0:case 1:l=_;break;case 4:return n.label++,{value:_[1],done:!1};case 5:n.label++,f=_[1],_=[0];continue;case 7:_=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(_[0]===6||_[0]===2)){n=0;continue}if(_[0]===3&&(!l||_[1]>l[0]&&_[1]<l[3])){n.label=_[1];break}if(_[0]===6&&n.label<l[1]){n.label=l[1],l=_;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(_);break}l[2]&&n.ops.pop(),n.trys.pop();continue}_=t.call(i,n)}catch(L){_=[6,L],f=0}finally{o=l=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}var zt=Object.create?function(i,t,n,o){o===void 0&&(o=n);var f=Object.getOwnPropertyDescriptor(t,n);(!f||("get"in f?!t.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(i,o,f)}:function(i,t,n,o){o===void 0&&(o=n),i[o]=t[n]};function $r(i,t){for(var n in i)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&zt(t,i,n)}function jt(i){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&i[t],o=0;if(n)return n.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&o>=i.length&&(i=void 0),{value:i&&i[o++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function gn(i,t){var n=typeof Symbol=="function"&&i[Symbol.iterator];if(!n)return i;var o=n.call(i),f,l=[],g;try{for(;(t===void 0||t-- >0)&&!(f=o.next()).done;)l.push(f.value)}catch(O){g={error:O}}finally{try{f&&!f.done&&(n=o.return)&&n.call(o)}finally{if(g)throw g.error}}return l}function Dr(){for(var i=[],t=0;t<arguments.length;t++)i=i.concat(gn(arguments[t]));return i}function Pr(){for(var i=0,t=0,n=arguments.length;t<n;t++)i+=arguments[t].length;for(var o=Array(i),f=0,t=0;t<n;t++)for(var l=arguments[t],g=0,O=l.length;g<O;g++,f++)o[f]=l[g];return o}function Nr(i,t,n){if(n||arguments.length===2)for(var o=0,f=t.length,l;o<f;o++)(l||!(o in t))&&(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return i.concat(l||Array.prototype.slice.call(t))}function lt(i){return this instanceof lt?(this.v=i,this):new lt(i)}function kr(i,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=n.apply(i,t||[]),f,l=[];return f={},g("next"),g("throw"),g("return"),f[Symbol.asyncIterator]=function(){return this},f;function g(k){o[k]&&(f[k]=function(W){return new Promise(function(te,V){l.push([k,W,te,V])>1||O(k,W)})})}function O(k,W){try{N(o[k](W))}catch(te){E(l[0][3],te)}}function N(k){k.value instanceof lt?Promise.resolve(k.value.v).then(_,L):E(l[0][2],k)}function _(k){O("next",k)}function L(k){O("throw",k)}function E(k,W){k(W),l.shift(),l.length&&O(l[0][0],l[0][1])}}function Mr(i){var t,n;return t={},o("next"),o("throw",function(f){throw f}),o("return"),t[Symbol.iterator]=function(){return this},t;function o(f,l){t[f]=i[f]?function(g){return(n=!n)?{value:lt(i[f](g)),done:!1}:l?l(g):g}:l}}function Br(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=i[Symbol.asyncIterator],n;return t?t.call(i):(i=typeof jt=="function"?jt(i):i[Symbol.iterator](),n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n);function o(l){n[l]=i[l]&&function(g){return new Promise(function(O,N){g=i[l](g),f(O,N,g.done,g.value)})}}function f(l,g,O,N){Promise.resolve(N).then(function(_){l({value:_,done:O})},g)}}function Lr(i,t){return Object.defineProperty?Object.defineProperty(i,"raw",{value:t}):i.raw=t,i}var qs=Object.create?function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}:function(i,t){i.default=t};function Fr(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var n in i)n!=="default"&&Object.prototype.hasOwnProperty.call(i,n)&&zt(t,i,n);return qs(t,i),t}function jr(i){return i&&i.__esModule?i:{default:i}}function Ur(i,t,n,o){if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?i!==t||!o:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?o:n==="a"?o.call(i):o?o.value:t.get(i)}function Vr(i,t,n,o,f){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?i!==t||!f:!t.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?f.call(i,n):f?f.value=n:t.set(i,n),n}function zr(i,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof i=="function"?t===i:i.has(t)}function Hr(i,t,n){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var o;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(o===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose]}if(typeof o!="function")throw new TypeError("Object not disposable.");i.stack.push({value:t,dispose:o,async:n})}else n&&i.stack.push({async:!0});return t}var Ks=typeof SuppressedError=="function"?SuppressedError:function(i,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=i,o.suppressed=t,o};function Wr(i){function t(o){i.error=i.hasError?new Ks(o,i.error,"An error was suppressed during disposal."):o,i.hasError=!0}function n(){for(;i.stack.length;){var o=i.stack.pop();try{var f=o.dispose&&o.dispose.call(o.value);if(o.async)return Promise.resolve(f).then(n,function(l){return t(l),n()})}catch(l){t(l)}}if(i.hasError)throw i.error}return n()}const Ys={__extends:Sr,__assign:Ft,__rest:Ar,__decorate:Tr,__param:_r,__metadata:vr,__awaiter:Rr,__generator:Cr,__createBinding:zt,__exportStar:$r,__values:jt,__read:gn,__spread:Dr,__spreadArrays:Pr,__spreadArray:Nr,__await:lt,__asyncGenerator:kr,__asyncDelegator:Mr,__asyncValues:Br,__makeTemplateObject:Lr,__importStar:Fr,__importDefault:jr,__classPrivateFieldGet:Ur,__classPrivateFieldSet:Vr,__classPrivateFieldIn:zr,__addDisposableResource:Hr,__disposeResources:Wr},Gs=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Hr,get __assign(){return Ft},__asyncDelegator:Mr,__asyncGenerator:kr,__asyncValues:Br,__await:lt,__awaiter:Rr,__classPrivateFieldGet:Ur,__classPrivateFieldIn:zr,__classPrivateFieldSet:Vr,__createBinding:zt,__decorate:Tr,__disposeResources:Wr,__esDecorate:zs,__exportStar:$r,__extends:Sr,__generator:Cr,__importDefault:jr,__importStar:Fr,__makeTemplateObject:Lr,__metadata:vr,__param:_r,__propKey:Ws,__read:gn,__rest:Ar,__runInitializers:Hs,__setFunctionName:Js,__spread:Dr,__spreadArray:Nr,__spreadArrays:Pr,__values:jt,default:Ys},Symbol.toStringTag,{value:"Module"})),Ht=un(Gs);var Et={};(function(i){i.CloseCode=void 0,function(n){n[n.CONSENTED=4e3]="CONSENTED",n[n.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(i.CloseCode||(i.CloseCode={}));class t extends Error{constructor(o,f){super(f),this.name="ServerError",this.code=o}}i.ServerError=t})(Et);var mn={},Jr={},qr={},fn={exports:{}};(function(i,t){(function(n,o){o(t)})(xr,function(n){n.OPERATION=void 0,function(c){c[c.ADD=128]="ADD",c[c.REPLACE=0]="REPLACE",c[c.DELETE=64]="DELETE",c[c.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",c[c.MOVE_AND_ADD=160]="MOVE_AND_ADD",c[c.DELETE_AND_ADD=192]="DELETE_AND_ADD",c[c.CLEAR=10]="CLEAR",c[c.REVERSE=15]="REVERSE",c[c.MOVE=32]="MOVE",c[c.DELETE_BY_REFID=33]="DELETE_BY_REFID",c[c.ADD_BY_REFID=129]="ADD_BY_REFID"}(n.OPERATION||(n.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const l=Symbol("$track"),g=Symbol("$encoder"),O=Symbol("$decoder"),N=Symbol("$filter"),_=Symbol("$getByIndex"),L=Symbol("$deleteByIndex"),E=Symbol("$changes"),k=Symbol("$childType"),W=Symbol("$onEncodeEnd"),te=Symbol("$onDecodeEnd"),V=Symbol("$descriptors"),X="$__numFields",se="$__refTypeFieldIndexes",pe="$__viewFieldIndexes",Oe="$__fieldIndexesByViewTag";let Q;try{Q=new TextEncoder}catch{}const Ke=new ArrayBuffer(8),$e=new Int32Array(Ke),et=new Float32Array(Ke),tt=new Float64Array(Ke),Ae=new BigInt64Array(Ke),ht=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(c,e){for(var r=0,s=0,a=0,h=c.length;a<h;a++)r=c.charCodeAt(a),r<128?s+=1:r<2048?s+=2:r<55296||r>=57344?s+=3:(a++,s+=4);return s};function xt(c,e,r){for(var s=0,a=0,h=e.length;a<h;a++)s=e.charCodeAt(a),s<128?c[r.offset++]=s:s<2048?(c[r.offset]=192|s>>6,c[r.offset+1]=128|s&63,r.offset+=2):s<55296||s>=57344?(c[r.offset]=224|s>>12,c[r.offset+1]=128|s>>6&63,c[r.offset+2]=128|s&63,r.offset+=3):(a++,s=65536+((s&1023)<<10|e.charCodeAt(a)&1023),c[r.offset]=240|s>>18,c[r.offset+1]=128|s>>12&63,c[r.offset+2]=128|s>>6&63,c[r.offset+3]=128|s&63,r.offset+=4)}function b(c,e,r){c[r.offset++]=e&255}function P(c,e,r){c[r.offset++]=e&255}function C(c,e,r){c[r.offset++]=e&255,c[r.offset++]=e>>8&255}function T(c,e,r){c[r.offset++]=e&255,c[r.offset++]=e>>8&255}function R(c,e,r){c[r.offset++]=e&255,c[r.offset++]=e>>8&255,c[r.offset++]=e>>16&255,c[r.offset++]=e>>24&255}function j(c,e,r){const s=e>>24,a=e>>16,h=e>>8,u=e;c[r.offset++]=u&255,c[r.offset++]=h&255,c[r.offset++]=a&255,c[r.offset++]=s&255}function z(c,e,r){const s=Math.floor(e/Math.pow(2,32)),a=e>>>0;j(c,a,r),j(c,s,r)}function U(c,e,r){const s=e/Math.pow(2,32)>>0,a=e>>>0;j(c,a,r),j(c,s,r)}function q(c,e,r){Ae[0]=BigInt.asIntN(64,e),R(c,$e[0],r),R(c,$e[1],r)}function K(c,e,r){Ae[0]=BigInt.asIntN(64,e),R(c,$e[0],r),R(c,$e[1],r)}function ye(c,e,r){et[0]=e,R(c,$e[0],r)}function Te(c,e,r){tt[0]=e,R(c,$e[0],r),R(c,$e[1],r)}function Ye(c,e,r){c[r.offset++]=e?1:0}function ys(c,e,r){e||(e="");let s=ht(e,"utf8"),a=0;if(s<32)c[r.offset++]=s|160,a=1;else if(s<256)c[r.offset++]=217,c[r.offset++]=s%255,a=2;else if(s<65536)c[r.offset++]=218,T(c,s,r),a=3;else if(s<4294967296)c[r.offset++]=219,j(c,s,r),a=5;else throw new Error("String too long");return xt(c,e,r),a+s}function Xt(c,e,r){if(isNaN(e))return Xt(c,0,r);if(isFinite(e)){if(e!==(e|0))return Math.abs(e)<=34028235e31&&(et[0]=e,Math.abs(Math.abs(et[0])-Math.abs(e))<1e-4)?(c[r.offset++]=202,ye(c,e,r),5):(c[r.offset++]=203,Te(c,e,r),9)}else return Xt(c,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,r);return e>=0?e<128?(c[r.offset++]=e&255,1):e<256?(c[r.offset++]=204,c[r.offset++]=e&255,2):e<65536?(c[r.offset++]=205,T(c,e,r),3):e<4294967296?(c[r.offset++]=206,j(c,e,r),5):(c[r.offset++]=207,U(c,e,r),9):e>=-32?(c[r.offset++]=224|e+32,1):e>=-128?(c[r.offset++]=208,b(c,e,r),2):e>=-32768?(c[r.offset++]=209,C(c,e,r),3):e>=-2147483648?(c[r.offset++]=210,R(c,e,r),5):(c[r.offset++]=211,z(c,e,r),9)}const we={int8:b,uint8:P,int16:C,uint16:T,int32:R,uint32:j,int64:z,uint64:U,bigint64:q,biguint64:K,float32:ye,float64:Te,boolean:Ye,string:ys,number:Xt,utf8Write:xt,utf8Length:ht},ut=new ArrayBuffer(8),Ge=new Int32Array(ut),ws=new Float32Array(ut),Es=new Float64Array(ut),bs=new BigUint64Array(ut),Os=new BigInt64Array(ut);function Tn(c,e,r){for(var s="",a=0,h=e.offset,u=e.offset+r;h<u;h++){var p=c[h];if(!(p&128)){s+=String.fromCharCode(p);continue}if((p&224)===192){s+=String.fromCharCode((p&31)<<6|c[++h]&63);continue}if((p&240)===224){s+=String.fromCharCode((p&15)<<12|(c[++h]&63)<<6|(c[++h]&63)<<0);continue}if((p&248)===240){a=(p&7)<<18|(c[++h]&63)<<12|(c[++h]&63)<<6|(c[++h]&63)<<0,a>=65536?(a-=65536,s+=String.fromCharCode((a>>>10)+55296,(a&1023)+56320)):s+=String.fromCharCode(a);continue}console.error("Invalid byte "+p.toString(16))}return e.offset+=r,s}function _n(c,e){return dt(c,e)<<24>>24}function dt(c,e){return c[e.offset++]}function vn(c,e){return St(c,e)<<16>>16}function St(c,e){return c[e.offset++]|c[e.offset++]<<8}function _e(c,e){return c[e.offset++]|c[e.offset++]<<8|c[e.offset++]<<16|c[e.offset++]<<24}function nt(c,e){return _e(c,e)>>>0}function Rn(c,e){return Ge[0]=_e(c,e),ws[0]}function Cn(c,e){return Ge[0]=_e(c,e),Ge[1]=_e(c,e),Es[0]}function $n(c,e){const r=nt(c,e);return _e(c,e)*Math.pow(2,32)+r}function Dn(c,e){const r=nt(c,e);return nt(c,e)*Math.pow(2,32)+r}function Is(c,e){return Ge[0]=_e(c,e),Ge[1]=_e(c,e),Os[0]}function xs(c,e){return Ge[0]=_e(c,e),Ge[1]=_e(c,e),bs[0]}function Ss(c,e){return dt(c,e)>0}function As(c,e){const r=c[e.offset++];let s;return r<192?s=r&31:r===217?s=dt(c,e):r===218?s=St(c,e):r===219&&(s=nt(c,e)),Tn(c,e,s)}function Ts(c,e){const r=c[e.offset++];if(r<128)return r;if(r===202)return Rn(c,e);if(r===203)return Cn(c,e);if(r===204)return dt(c,e);if(r===205)return St(c,e);if(r===206)return nt(c,e);if(r===207)return Dn(c,e);if(r===208)return _n(c,e);if(r===209)return vn(c,e);if(r===210)return _e(c,e);if(r===211)return $n(c,e);if(r>223)return(255-r+1)*-1}function _s(c,e){const r=c[e.offset];return r<192&&r>160||r===217||r===218||r===219}const Ee={utf8Read:Tn,int8:_n,uint8:dt,int16:vn,uint16:St,int32:_e,uint32:nt,float32:Rn,float64:Cn,int64:$n,uint64:Dn,bigint64:Is,biguint64:xs,boolean:Ss,string:As,number:Ts,stringCheck:_s},Pn={},vs=new Map;function De(c,e){e.constructor&&(vs.set(e.constructor,c),Pn[c]=e),e.encode&&(we[c]=e.encode),e.decode&&(Ee[c]=e.decode)}function gt(c){return Pn[c]}function Rs(c){for(const e in c)De(e,c[e]);return e=>ve(e)}const ke=class ke{static register(e){const r=Object.getPrototypeOf(e);if(r!==ie){let s=ke.inheritedTypes.get(r);s||(s=new Set,ke.inheritedTypes.set(r,s)),s.add(e)}}static cache(e){let r=ke.cachedContexts.get(e);return r||(r=new ke(e),ke.cachedContexts.set(e,r)),r}constructor(e){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},e&&this.discoverTypes(e)}has(e){return this.schemas.has(e)}get(e){return this.types[e]}add(e,r=this.schemas.size){return this.schemas.has(e)?!1:(this.types[r]=e,e[Symbol.metadata]===void 0&&oe.initialize(e),this.schemas.set(e,r),!0)}getTypeId(e){return this.schemas.get(e)}discoverTypes(e,r,s,a){var p,y;if(a&&this.registerFilteredByParent(e,r,s),!this.add(e))return;(p=ke.inheritedTypes.get(e))==null||p.forEach(I=>{this.discoverTypes(I,r,s,a)});let h=e;for(;(h=Object.getPrototypeOf(h))&&h!==ie&&h!==Function.prototype;)this.discoverTypes(h);const u=e[y=Symbol.metadata]??(e[y]={});u[pe]&&(this.hasFilters=!0);for(const I in u){const x=I,v=u[x].type,S=u[x].tag!==void 0;if(typeof v!="string")if(Array.isArray(v)){const F=v[0];if(F==="string")continue;this.discoverTypes(F,e,x,a||S)}else if(typeof v=="function")this.discoverTypes(v,e,x,a||S);else{const F=Object.values(v)[0];if(typeof F=="string")continue;this.discoverTypes(F,e,x,a||S)}}}registerFilteredByParent(e,r,s){let h=`${this.schemas.get(e)??this.schemas.size}`;r&&(h+=`-${this.schemas.get(r)}`),h+=`-${s}`,this.parentFiltered[h]=!0}debug(){let e="";for(const r in this.parentFiltered){const s=r.split("-").map(Number),a=s.pop();e+=`
		`,e+=`${r}: ${s.reverse().map((h,u)=>{const p=this.types[h],y=p[Symbol.metadata];let I=p.name;return u===0&&(I+=`[${y[a].name}]`),`${I}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${e}`}};ke.inheritedTypes=new Map,ke.cachedContexts=new Map;let Pe=ke;function Nn(c){return Array.isArray(c)?{array:c[0]}:typeof c.type<"u"?c.type:c}const oe={addField(c,e,r,s,a){if(e>64)throw new Error(`Can't define field '${r}'.
Schema instances may only have up to 64 fields.`);c[e]=Object.assign(c[e]||{},{type:Nn(s),index:e,name:r}),Object.defineProperty(c,V,{value:c[V]||{},enumerable:!1,configurable:!0}),a?(c[V][r]=a,c[V][`_${r}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):c[V][r]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(c,X,{value:e,enumerable:!1,configurable:!0}),Object.defineProperty(c,r,{value:e,enumerable:!1,configurable:!0}),typeof c[e].type!="string"&&(c[se]===void 0&&Object.defineProperty(c,se,{value:[],enumerable:!1,configurable:!0}),c[se].push(e))},setTag(c,e,r){const s=c[e],a=c[s];a.tag=r,c[pe]||(Object.defineProperty(c,pe,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(c,Oe,{value:{},enumerable:!1,configurable:!0})),c[pe].push(s),c[Oe][r]||(c[Oe][r]=[]),c[Oe][r].push(s)},setFields(c,e){const r=c.prototype.constructor;Pe.register(r);const s=Object.getPrototypeOf(r),a=s&&s[Symbol.metadata],h=oe.initialize(r);r[l]||(r[l]=ie[l]),r[g]||(r[g]=ie[g]),r[O]||(r[O]=ie[O]),r.prototype.toJSON||(r.prototype.toJSON=ie.prototype.toJSON);let u=h[X]??(a&&a[X])??-1;u++;for(const p in e){const y=e[p],I=Array.isArray(y)?gt("array"):typeof Object.keys(y)[0]=="string"&&gt(Object.keys(y)[0]),x=I?Object.values(y)[0]:Nn(y);oe.addField(h,u,p,y,Jn(`_${p}`,u,x,I)),u++}return c},isDeprecated(c,e){return c[e].deprecated===!0},init(c){const e={};c[Symbol.metadata]=e,Object.defineProperty(e,X,{value:0,enumerable:!1,configurable:!0})},initialize(c){const e=Object.getPrototypeOf(c),r=e[Symbol.metadata];let s=c[Symbol.metadata]??Object.create(null);return e!==ie&&s===r&&(s=Object.create(null),r&&(Object.setPrototypeOf(s,r),Object.defineProperty(s,X,{value:r[X],enumerable:!1,configurable:!0,writable:!0}),r[pe]!==void 0&&(Object.defineProperty(s,pe,{value:[...r[pe]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(s,Oe,{value:{...r[Oe]},enumerable:!1,configurable:!0,writable:!0})),r[se]!==void 0&&Object.defineProperty(s,se,{value:[...r[se]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(s,V,{value:{...r[V]},enumerable:!1,configurable:!0,writable:!0}))),c[Symbol.metadata]=s,s},isValidInstance(c){return c.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(c.constructor[Symbol.metadata],X)},getFields(c){const e=c[Symbol.metadata],r={};for(let s=0;s<=e[X];s++)r[e[s].name]=e[s].type;return r},hasViewTagAtIndex(c,e){var r;return(r=c==null?void 0:c[pe])==null?void 0:r.includes(e)}};function At(){return{indexes:{},operations:[]}}function be(c,e){const r=c.indexes[e];r===void 0?c.indexes[e]=c.operations.push(e)-1:c.operations[r]=e}function kn(c,e){var s;let r=c.indexes[e];r===void 0&&(r=Object.values(c.indexes).at(-1),e=(s=Object.entries(c.indexes).find(([a,h])=>h===r))==null?void 0:s[0]),c.operations[r]=void 0,delete c.indexes[e]}function ge(c,e,r,s=e[r].queueRootIndex){if(c)c[r][s]!==e&&(e[r].queueRootIndex=c[r].push(e)-1);else return}class rt{constructor(e){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=e;const r=e.constructor[Symbol.metadata];r!=null&&r[pe]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(e){var s;this.root=e,this.checkIsFiltered(this.parent,this.parentIndex);const r=this.ref.constructor[Symbol.metadata];r?(s=r[se])==null||s.forEach(a=>{const h=r[a],u=this.ref[h.name];u==null||u[E].setRoot(e)}):this.ref[k]&&typeof this.ref[k]!="string"&&this.ref.forEach((a,h)=>{a[E].setRoot(e)})}setParent(e,r,s){var h;if(this.parent=e,this.parentIndex=s,!r)return;r!==this.root?(this.root=r,this.checkIsFiltered(e,s)):r.add(this);const a=this.ref.constructor[Symbol.metadata];a?(h=a[se])==null||h.forEach(u=>{const p=a[u],y=this.ref[p.name];y==null||y[E].setParent(this.ref,r,u)}):this.ref[k]&&typeof this.ref[k]!="string"&&this.ref.forEach((u,p)=>{u[E].setParent(this.ref,r,this.indexes[p]??p)})}forEachChild(e){var s;const r=this.ref.constructor[Symbol.metadata];r?(s=r[se])==null||s.forEach(a=>{const h=r[a],u=this.ref[h.name];u&&e(u[E],a)}):this.ref[k]&&typeof this.ref[k]!="string"&&this.ref.forEach((a,h)=>{e(a[E],this.indexes[h]??h)})}operation(e){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-e),ge(this.root,this,"filteredChanges")):(this.changes.operations.push(-e),ge(this.root,this,"changes"))}change(e,r=n.OPERATION.ADD){var p;const s=this.ref.constructor[Symbol.metadata],a=this.isFiltered||((p=s==null?void 0:s[e])==null?void 0:p.tag)!==void 0,h=a?this.filteredChanges:this.changes,u=this.indexedOperations[e];if(!u||u===n.OPERATION.DELETE){const y=u&&u===n.OPERATION.DELETE?n.OPERATION.DELETE_AND_ADD:r;this.indexedOperations[e]=y}be(h,e),a?(be(this.allFilteredChanges,e),this.root&&(ge(this.root,this,"filteredChanges"),ge(this.root,this,"allFilteredChanges"))):(be(this.allChanges,e),ge(this.root,this,"changes"))}shiftChangeIndexes(e){const r=this.isFiltered?this.filteredChanges:this.changes,s={},a={};for(const h in this.indexedOperations)s[Number(h)+e]=this.indexedOperations[h],a[Number(h)+e]=r.indexes[h];this.indexedOperations=s,r.indexes=a,r.operations=r.operations.map(h=>h+e)}shiftAllChangeIndexes(e,r=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(e,r,this.allFilteredChanges),this._shiftAllChangeIndexes(e,r,this.allChanges)):this._shiftAllChangeIndexes(e,r,this.allChanges)}_shiftAllChangeIndexes(e,r=0,s){const a={};let h=0;for(const u in s.indexes)a[h++]=s.indexes[u];s.indexes=a;for(let u=0;u<s.operations.length;u++){const p=s.operations[u];p>r&&(s.operations[u]=p+e)}}indexedOperation(e,r,s=e){this.indexedOperations[e]=r,this.filteredChanges!==void 0?(be(this.allFilteredChanges,s),be(this.filteredChanges,e),ge(this.root,this,"filteredChanges")):(be(this.allChanges,s),be(this.changes,e),ge(this.root,this,"changes"))}getType(e){return oe.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][e].type:this.ref[k]}getChange(e){return this.indexedOperations[e]}getValue(e,r=!1){return this.ref[_](e,r)}delete(e,r,s=e){var u;if(e===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${e}'`)}catch(p){console.warn(p)}return}const a=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[e]=r??n.OPERATION.DELETE,be(a,e),kn(this.allChanges,s);const h=this.getValue(e);return h&&h[E]&&((u=this.root)==null||u.remove(h[E])),this.filteredChanges!==void 0?(kn(this.allFilteredChanges,s),ge(this.root,this,"filteredChanges")):ge(this.root,this,"changes"),h}endEncode(e){var r,s;this.indexedOperations={},this[e].indexes={},this[e].operations.length=0,this[e].queueRootIndex=void 0,(s=(r=this.ref)[W])==null||s.call(r),this.isNew=!1}discard(e=!1){var r,s;(s=(r=this.ref)[W])==null||s.call(r),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),e&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((a,h)=>{var u;return(u=this.root)==null?void 0:u.remove(a)}))}discardAll(){const e=Object.keys(this.indexedOperations);for(let r=0,s=e.length;r<s;r++){const a=this.getValue(Number(e[r]));a&&a[E]&&a[E].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(e,r){const s=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(e,r),this.filteredChanges!==void 0&&(ge(this.root,this,"filteredChanges"),s&&this.root.allFilteredChanges.push(this))),this.isFiltered||(ge(this.root,this,"changes"),s&&this.root.allChanges.push(this))}_checkFilteredByParent(e,r){if(!e)return;const s=oe.isValidInstance(this.ref)?this.ref.constructor:this.ref[k];let a,h=!oe.isValidInstance(e);h?(a=e[E],e=a.parent,r=a.parentIndex):a=e[E];const u=e.constructor;let p=`${this.root.types.getTypeId(s)}`;u&&(p+=`-${this.root.types.schemas.get(u)}`),p+=`-${r}`;const y=oe.hasViewTagAtIndex(u==null?void 0:u[Symbol.metadata],r);this.isFiltered=e[E].isFiltered||this.root.types.parentFiltered[p]||y,this.isFiltered&&(this.isVisibilitySharedWithParent=a.isFiltered&&typeof s!="string"&&!y&&h,this.filteredChanges||(this.filteredChanges=At(),this.allFilteredChanges=At()),this.changes.operations.length>0&&(this.changes.operations.forEach(I=>be(this.filteredChanges,I)),this.allChanges.operations.forEach(I=>be(this.allFilteredChanges,I)),this.changes=At(),this.allChanges=At()))}}function Qt(c,e,r,s,a,h){var u;typeof r=="string"?(u=we[r])==null||u.call(we,e,s,h):r[Symbol.metadata]!==void 0?(we.number(e,s[E].refId,h),(a&n.OPERATION.ADD)===n.OPERATION.ADD&&c.tryEncodeTypeId(e,r,s.constructor,h)):we.number(e,s[E].refId,h)}const Mn=function(c,e,r,s,a,h,u,p,y){if(e[h.offset++]=(s|a)&255,a===n.OPERATION.DELETE)return;const I=r.ref,x=y[s];Qt(c,e,y[s].type,I[x.name],a,h)},Tt=function(c,e,r,s,a,h){if(e[h.offset++]=a&255,a===n.OPERATION.CLEAR||(we.number(e,s,h),a===n.OPERATION.DELETE))return;const u=r.ref;if((a&n.OPERATION.ADD)===n.OPERATION.ADD&&typeof u.set=="function"){const I=r.ref.$indexes.get(s);we.string(e,I,h)}const p=u[k],y=u[_](s);Qt(c,e,p,y,a,h)},Bn=function(c,e,r,s,a,h,u,p){const y=r.ref,I=p&&r.isFiltered&&typeof r.getType(s)!="string";let x;if(I?(x=y.tmpItems[s][E].refId,a===n.OPERATION.DELETE?a=n.OPERATION.DELETE_BY_REFID:a===n.OPERATION.ADD&&(a=n.OPERATION.ADD_BY_REFID)):x=s,e[h.offset++]=a&255,a===n.OPERATION.CLEAR||a===n.OPERATION.REVERSE||(we.number(e,x,h),a===n.OPERATION.DELETE||a===n.OPERATION.DELETE_BY_REFID))return;const v=r.getType(s),S=r.getValue(s,u);Qt(c,e,v,S,a,h)},Ln=-1;function en(c,e,r,s,a,h,u,p){const y=c.root,I=r[_](s);let x;if((e&n.OPERATION.DELETE)===n.OPERATION.DELETE){const v=y.refIds.get(I);v!==void 0&&y.removeRef(v),e!==n.OPERATION.DELETE_AND_ADD&&r[L](s),x=void 0}if(e!==n.OPERATION.DELETE)if(ie.is(a)){const v=Ee.number(h,u);if(x=y.refs.get(v),(e&n.OPERATION.ADD)===n.OPERATION.ADD){const S=c.getInstanceType(h,u,a);x||(x=c.createInstanceOfType(S)),y.addRef(v,x,x!==I||e===n.OPERATION.DELETE_AND_ADD&&x===I)}}else if(typeof a=="string")x=Ee[a](h,u);else{const v=gt(Object.keys(a)[0]),S=Ee.number(h,u),F=y.refs.has(S)?I||y.refs.get(S):new v.constructor;if(x=F.clone(!0),x[k]=Object.values(a)[0],I){let M=y.refIds.get(I);if(M!==void 0&&S!==M){const D=I.entries();let A;for(;(A=D.next())&&!A.done;){const[B,Y]=A.value;typeof Y=="object"&&(M=y.refIds.get(Y),y.removeRef(M)),p.push({ref:I,refId:M,op:n.OPERATION.DELETE,field:B,value:void 0,previousValue:Y})}}}y.addRef(S,x,F!==I||e===n.OPERATION.DELETE_AND_ADD&&F===I)}return{value:x,previousValue:I}}const Fn=function(c,e,r,s,a){const h=e[r.offset++],u=s.constructor[Symbol.metadata],p=h>>6<<6,y=h%(p||255),I=u[y];if(I===void 0)return console.warn("@colyseus/schema: field not defined at",{index:y,ref:s.constructor.name,metadata:u}),Ln;const{value:x,previousValue:v}=en(c,p,s,y,I.type,e,r,a);x!=null&&(s[I.name]=x),v!==x&&a.push({ref:s,refId:c.currentRefId,op:p,field:I.name,value:x,previousValue:v})},_t=function(c,e,r,s,a){const h=e[r.offset++];if(h===n.OPERATION.CLEAR){c.removeChildRefs(s,a),s.clear();return}const u=Ee.number(e,r),p=s[k];let y;(h&n.OPERATION.ADD)===n.OPERATION.ADD?typeof s.set=="function"?(y=Ee.string(e,r),s.setIndex(u,y)):y=u:y=s.getIndex(u);const{value:I,previousValue:x}=en(c,h,s,u,p,e,r,a);if(I!=null){if(typeof s.set=="function")s.$items.set(y,I);else if(typeof s.$setAt=="function")s.$setAt(u,I,h);else if(typeof s.add=="function"){const v=s.add(I);typeof v=="number"&&s.setIndex(v,v)}}x!==I&&a.push({ref:s,refId:c.currentRefId,op:h,field:"",dynamicIndex:y,value:I,previousValue:x})},Cs=function(c,e,r,s,a){let h=e[r.offset++],u;if(h===n.OPERATION.CLEAR){c.removeChildRefs(s,a),s.clear();return}else if(h===n.OPERATION.REVERSE){s.reverse();return}else if(h===n.OPERATION.DELETE_BY_REFID){const v=Ee.number(e,r),S=c.root.refs.get(v);u=s.findIndex(F=>F===S),s[L](u),a.push({ref:s,refId:c.currentRefId,op:n.OPERATION.DELETE,field:"",dynamicIndex:u,value:void 0,previousValue:S});return}else if(h===n.OPERATION.ADD_BY_REFID){const v=Ee.number(e,r),S=c.root.refs.get(v);S&&(u=s.findIndex(F=>F===S)),(u===-1||u===void 0)&&(u=s.length)}else u=Ee.number(e,r);const p=s[k];let y=u;const{value:I,previousValue:x}=en(c,h,s,u,p,e,r,a);I!=null&&I!==x&&s.$setAt(u,I,h),x!==I&&a.push({ref:s,refId:c.currentRefId,op:h,field:"",dynamicIndex:y,value:I,previousValue:x})};class jn extends Error{}function $s(c,e,r,s){let a,h=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":a="number",isNaN(c)&&console.log(`trying to encode "NaN" in ${r.constructor.name}#${s}`);break;case"bigint64":case"biguint64":a="bigint";break;case"string":a="string",h=!0;break;case"boolean":return;default:return}if(typeof c!==a&&(!h||h&&c!==null)){let u=`'${JSON.stringify(c)}'${c&&c.constructor&&` (${c.constructor.name})`||""}`;throw new jn(`a '${a}' was expected, but ${u} was provided in ${r.constructor.name}#${s}`)}}function vt(c,e,r,s){if(!(c instanceof e))throw new jn(`a '${e.name}' was expected, but '${c&&c.constructor.name}' was provided in ${r.constructor.name}#${s}`)}var Un,Vn;const Ds=(c,e)=>{const r=c.toString(),s=e.toString();return r<s?-1:r>s?1:0},Re=class Re{static[(Un=g,Vn=O,N)](e,r,s){var a;return!s||typeof e[k]=="string"||s.isChangeTreeVisible((a=e.tmpItems[r])==null?void 0:a[E])}static is(e){return Array.isArray(e)||e.array!==void 0}static from(e){return new Re(...Array.from(e))}constructor(...e){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,k,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const r=new Proxy(this,{get:(s,a)=>typeof a!="symbol"&&!isNaN(a)?this.items[a]:Reflect.get(s,a),set:(s,a,h)=>{var u;if(typeof a!="symbol"&&!isNaN(a)){if(h==null)s.$deleteAt(a);else{if(h[E]){vt(h,s[k],s,a);const p=s.items[a];s.isMovingItems?(p!==void 0?h[E].isNew?s[E].indexedOperation(Number(a),n.OPERATION.MOVE_AND_ADD):(s[E].getChange(Number(a))&n.OPERATION.DELETE)===n.OPERATION.DELETE?s[E].indexedOperation(Number(a),n.OPERATION.DELETE_AND_MOVE):s[E].indexedOperation(Number(a),n.OPERATION.MOVE):h[E].isNew&&s[E].indexedOperation(Number(a),n.OPERATION.ADD),h[E].setParent(this,s[E].root,a)):s.$changeAt(Number(a),h),p!==void 0&&((u=p[E].root)==null||u.remove(p[E]))}else s.$changeAt(Number(a),h);s.items[a]=h,s.tmpItems[a]=h}return!0}else return Reflect.set(s,a,h)},deleteProperty:(s,a)=>(typeof a=="number"?s.$deleteAt(a):delete s[a],!0),has:(s,a)=>typeof a!="symbol"&&!isNaN(Number(a))?Reflect.has(this.items,a):Reflect.has(s,a)});return this[E]=new rt(r),this[E].indexes={},e.length>0&&this.push(...e),r}set length(e){e===0?this.clear():e<this.items.length?this.splice(e,this.length-e):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...e){var a;let r=this.tmpItems.length;const s=this[E];for(let h=0,u=e.length;h<e.length;h++,r++){const p=e[h];if(p==null)return;typeof p=="object"&&this[k]&&vt(p,this[k],this,h),s.indexedOperation(r,n.OPERATION.ADD,this.items.length),this.items.push(p),this.tmpItems.push(p),(a=p[E])==null||a.setParent(this,s.root,r)}return r}pop(){let e=-1;for(let r=this.tmpItems.length-1;r>=0;r--)if(this.deletedIndexes[r]!==!0){e=r;break}if(!(e<0))return this[E].delete(e,void 0,this.items.length-1),this.deletedIndexes[e]=!0,this.items.pop()}at(e){return e<0&&(e+=this.length),this.items[e]}$changeAt(e,r){var h;if(r==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[e]===r)return;const s=this.items[e]!==void 0?typeof r=="object"?n.OPERATION.DELETE_AND_ADD:n.OPERATION.REPLACE:n.OPERATION.ADD,a=this[E];a.change(e,s),(h=r[E])==null||h.setParent(this,a.root,e)}$deleteAt(e,r){this[E].delete(e,r)}$setAt(e,r,s){e===0&&s===n.OPERATION.ADD&&this.items[e]!==void 0?this.items.unshift(r):s===n.OPERATION.DELETE_AND_MOVE?(this.items.splice(e,1),this.items[e]=r):this.items[e]=r}clear(){if(this.items.length===0)return;const e=this[E];e.forEachChild((r,s)=>{r.discard(!0);const a=r.root;a!==void 0&&(a.removeChangeFromChangeSet("changes",r),a.removeChangeFromChangeSet("allChanges",r),a.removeChangeFromChangeSet("allFilteredChanges",r))}),e.discard(!0),e.operation(n.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...e){return new Re(...this.items.concat(...e))}join(e){return this.items.join(e)}reverse(){return this[E].operation(n.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const e=this[E],r=this.tmpItems.findIndex(a=>a===this.items[0]),s=this.items.findIndex(a=>a===this.items[0]);return e.delete(r,n.OPERATION.DELETE,s),e.shiftAllChangeIndexes(-1,s),this.items.shift()}slice(e,r){const s=new Re;return s.push(...this.items.slice(e,r)),s}sort(e=Ds){this.isMovingItems=!0;const r=this[E];return this.items.sort(e).forEach((a,h)=>r.change(h,n.OPERATION.REPLACE)),this.tmpItems.sort(e),this.isMovingItems=!1,this}splice(e,r,...s){var I;const a=this[E],h=this.items.length,u=this.tmpItems.length,p=s.length,y=[];for(let x=0;x<u;x++)this.deletedIndexes[x]!==!0&&y.push(x);if(h>e){r===void 0&&(r=h-e);for(let x=e;x<e+r;x++){const v=y[x];a.delete(v,n.OPERATION.DELETE),this.deletedIndexes[v]=!0}}else r=0;if(p>0){if(p>r)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let x=0;x<p;x++){const v=(y[e]??h)+x;a.indexedOperation(v,this.deletedIndexes[v]?n.OPERATION.DELETE_AND_ADD:n.OPERATION.ADD),(I=s[x][E])==null||I.setParent(this,a.root,v)}}return r>p&&a.shiftAllChangeIndexes(-(r-p),y[e+p]),a.filteredChanges!==void 0?ge(a.root,a,"filteredChanges"):ge(a.root,a,"changes"),this.items.splice(e,r,...s)}unshift(...e){const r=this[E];return r.shiftChangeIndexes(e.length),r.isFiltered?be(r.filteredChanges,this.items.length):be(r.allChanges,this.items.length),e.forEach((s,a)=>{r.change(a,n.OPERATION.ADD)}),this.tmpItems.unshift(...e),this.items.unshift(...e)}indexOf(e,r){return this.items.indexOf(e,r)}lastIndexOf(e,r=this.length-1){return this.items.lastIndexOf(e,r)}every(e,r){return this.items.every(e,r)}some(e,r){return this.items.some(e,r)}forEach(e,r){return this.items.forEach(e,r)}map(e,r){return this.items.map(e,r)}filter(e,r){return this.items.filter(e,r)}reduce(e,r){return this.items.reduce(e,r)}reduceRight(e,r){return this.items.reduceRight(e,r)}find(e,r){return this.items.find(e,r)}findIndex(e,r){return this.items.findIndex(e,r)}fill(e,r,s){throw new Error("ArraySchema#fill() not implemented")}copyWithin(e,r,s){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return Re}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(e,r){return this.items.includes(e,r)}flatMap(e,r){throw new Error("ArraySchema#flatMap() is not supported.")}flat(e){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...e){return this.items.findLastIndex.apply(this.items,arguments)}with(e,r){const s=this.items.slice();return e<0&&(e+=this.length),s[e]=r,new Re(...s)}toReversed(){return this.items.slice().reverse()}toSorted(e){return this.items.slice().sort(e)}toSpliced(e,r,...s){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(e=>{let r=this.items.length;for(;r!=0;){let s=Math.floor(Math.random()*r);r--,[this[r],this[s]]=[this[s],this[r]]}})}move(e){return this.isMovingItems=!0,e(this),this.isMovingItems=!1,this}[_](e,r=!1){return r?this.items[e]:this.deletedIndexes[e]?this.items[e]:this.tmpItems[e]||this.items[e]}[L](e){this.items[e]=void 0,this.tmpItems[e]=void 0}[W](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[te](){this.items=this.items.filter(e=>e!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(e=>typeof e.toJSON=="function"?e.toJSON():e)}clone(e){let r;return e?(r=new Re,r.push(...this.items)):r=new Re(...this.map(s=>s[E]?s.clone():s)),r}};Re[Un]=Bn,Re[Vn]=Cs;let Ne=Re;De("array",{constructor:Ne});var zn,Hn;const Ve=class Ve{static[(zn=g,Hn=O,N)](e,r,s){return!s||typeof e[k]=="string"||s.isChangeTreeVisible((e[_](r)??e.deletedItems[r])[E])}static is(e){return e.map!==void 0}constructor(e){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[E]=new rt(this),this[E].indexes={},e)if(e instanceof Map||e instanceof Ve)e.forEach((r,s)=>this.set(s,r));else for(const r in e)this.set(r,e[r]);Object.defineProperty(this,k,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return Ve}set(e,r){var p;if(r==null)throw new Error(`MapSchema#set('${e}', ${r}): trying to set ${r} value on '${e}'.`);typeof r=="object"&&this[k]&&vt(r,this[k],this,e),e=e.toString();const s=this[E],a=r[E]!==void 0;let h,u;if(typeof s.indexes[e]<"u"){h=s.indexes[e],u=n.OPERATION.REPLACE;const y=this.$items.get(e);if(y===r)return;a&&(u=n.OPERATION.DELETE_AND_ADD,y!==void 0&&((p=y[E].root)==null||p.remove(y[E])))}else h=s.indexes[X]??0,u=n.OPERATION.ADD,this.$indexes.set(h,e),s.indexes[e]=h,s.indexes[X]=h+1;return this.$items.set(e,r),s.change(h,u),a&&r[E].setParent(this,s.root,h),this}get(e){return this.$items.get(e)}delete(e){const r=this[E].indexes[e];return this.deletedItems[r]=this[E].delete(r),this.$items.delete(e)}clear(){const e=this[E];e.discard(!0),e.indexes={},this.$indexes.clear(),this.$items.clear(),e.operation(n.OPERATION.CLEAR)}has(e){return this.$items.has(e)}forEach(e){this.$items.forEach(e)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(e,r){this.$indexes.set(e,r)}getIndex(e){return this.$indexes.get(e)}[_](e){return this.$items.get(this.$indexes.get(e))}[L](e){const r=this.$indexes.get(e);this.$items.delete(r),this.$indexes.delete(e)}[W](){this.deletedItems={}}toJSON(){const e={};return this.forEach((r,s)=>{e[s]=typeof r.toJSON=="function"?r.toJSON():r}),e}clone(e){let r;return e?r=Object.assign(new Ve,this):(r=new Ve,this.forEach((s,a)=>{s[E]?r.set(a,s.clone()):r.set(a,s)})),r}};Ve[zn]=Tt,Ve[Hn]=_t;let je=Ve;De("map",{constructor:je});const Be=-1;function Ps(c){return Pe.register(c),c}function Wn(c=Be){return function(e,r){var p;const s=e.constructor,h=Object.getPrototypeOf(s)[Symbol.metadata],u=s[p=Symbol.metadata]??(s[p]=Object.assign({},s[Symbol.metadata],h??Object.create(null)));oe.setTag(u,r,c)}}function ve(c,e){return function(r,s){const a=r.constructor;if(!c)throw new Error(`${a.name}: @type() reference provided for "${s}" is undefined. Make sure you don't have any circular dependencies.`);Pe.register(a);const u=Object.getPrototypeOf(a)[Symbol.metadata],p=oe.initialize(a);let y=p[s];if(p[y]!==void 0){if(p[y].deprecated)return;if(p[y].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${s}' definition on '${a.name}'.
Check @type() annotation`)}catch(I){const x=I.stack.split(`
`)[4].trim();throw new Error(`${I.message} ${x}`)}}else y=p[X]??(u&&u[X])??-1,y++;if(e&&e.manual)oe.addField(p,y,s,c,{enumerable:!0,configurable:!0,writable:!0});else{const I=Array.isArray(c)?gt("array"):typeof Object.keys(c)[0]=="string"&&gt(Object.keys(c)[0]),x=I?Object.values(c)[0]:c;oe.addField(p,y,s,c,Jn(`_${s}`,y,x,I))}}}function Jn(c,e,r,s){return{get:function(){return this[c]},set:function(a){var u,p;const h=this[c]??void 0;if(a!==h){if(a!=null){s?(s.constructor===Ne&&!(a instanceof Ne)&&(a=new Ne(...a)),s.constructor===je&&!(a instanceof je)&&(a=new je(a)),a[k]=r):typeof r!="string"?vt(a,r,this,c.substring(1)):$s(a,r,this,c.substring(1));const y=this[E];h!==void 0&&h[E]?((u=y.root)==null||u.remove(h[E]),this.constructor[l](y,e,n.OPERATION.DELETE_AND_ADD)):this.constructor[l](y,e,n.OPERATION.ADD),(p=a[E])==null||p.setParent(this,y.root,e)}else h!==void 0&&this[E].delete(e);this[c]=a}},enumerable:!0,configurable:!0}}function Ns(c=!0){return function(e,r){var y;const s=e.constructor,h=Object.getPrototypeOf(s)[Symbol.metadata],u=s[y=Symbol.metadata]??(s[y]=Object.assign({},s[Symbol.metadata],h??Object.create(null))),p=u[r];u[p].deprecated=!0,c&&(u[V]??(u[V]={}),u[V][r]={get:function(){throw new Error(`${r} is deprecated.`)},set:function(I){},enumerable:!1,configurable:!0}),Object.defineProperty(u,p,{value:u[p],enumerable:!1,configurable:!0})}}function ks(c,e,r){for(let s in e)ve(e[s],r)(c.prototype,s);return c}function qn(c,e,r=ie){const s={},a={};for(let u in c){const p=c[u];typeof p=="object"&&(p.default!==void 0&&(s[u]=p.default),p.view!==void 0&&(a[u]=typeof p.view=="boolean"?Be:p.view))}const h=oe.setFields(class extends r{constructor(...u){u[0]=Object.assign({},s,u[0]),super(...u)}},c);for(let u in a)Wn(a[u])(h.prototype,u);return e&&Object.defineProperty(h,"name",{value:e}),h.extends=(u,p)=>qn(u,p,h),h}function Rt(c){return new Array(c).fill(0).map((e,r)=>r===c-1?"└─ ":"   ").join("")}function Ms(c){const e=c[E].root,r={ops:{},refs:[]};return e.changes.forEach(s=>{if(s===void 0)return;const a=s.indexedOperations;r.refs.push(`refId#${s.refId}`);for(const h in a){const u=a[h],p=n.OPERATION[u];r.ops[p]||(r.ops[p]=0),r.ops[n.OPERATION[u]]++}}),r}var Kn,Yn;const yt=class yt{static initialize(e){var r;Object.defineProperty(e,E,{value:new rt(e),enumerable:!1,writable:!0}),Object.defineProperties(e,((r=e.constructor[Symbol.metadata])==null?void 0:r[V])||{})}static is(e){return typeof e[Symbol.metadata]=="object"}static[(Kn=g,Yn=O,l)](e,r,s=n.OPERATION.ADD){e.change(r,s)}static[N](e,r,s){var u,p;const h=(u=e.constructor[Symbol.metadata][r])==null?void 0:u.tag;if(s===void 0)return h===void 0;if(h===void 0)return!0;if(h===Be)return s.isChangeTreeVisible(e[E]);{const y=(p=s.tags)==null?void 0:p.get(e[E]);return y&&y.has(h)}}constructor(...e){yt.initialize(this),e[0]&&Object.assign(this,e[0])}assign(e){return Object.assign(this,e),this}setDirty(e,r){const s=this.constructor[Symbol.metadata];this[E].change(s[s[e]].index,r)}clone(){var s;const e=new this.constructor,r=this.constructor[Symbol.metadata];for(const a in r){const h=r[a].name;typeof this[h]=="object"&&typeof((s=this[h])==null?void 0:s.clone)=="function"?e[h]=this[h].clone():e[h]=this[h]}return e}toJSON(){const e={},r=this.constructor[Symbol.metadata];for(const s in r){const a=r[s],h=a.name;!a.deprecated&&this[h]!==null&&typeof this[h]<"u"&&(e[h]=typeof this[h].toJSON=="function"?this[h].toJSON():this[h])}return e}discardAllChanges(){this[E].discardAll()}[_](e){const r=this.constructor[Symbol.metadata];return this[r[e].name]}[L](e){const r=this.constructor[Symbol.metadata];this[r[e].name]=void 0}static debugRefIds(e,r=!1,s=0){const a=r?` - ${JSON.stringify(e.toJSON())}`:"",h=e[E],u=h.refId;let p="";return p+=`${Rt(s)}${e.constructor.name} (refId: ${u})${a}
`,h.forEachChild(y=>p+=this.debugRefIds(y.ref,r,s+1)),p}static debugChanges(e,r=!1){const s=e[E],a=r?s.allChanges:s.changes,h=r?"allChanges":"changes";let u=`${e.constructor.name} (${s.refId}) -> .${h}:
`;function p(y){y.operations.filter(I=>I).forEach(I=>{const x=s.indexedOperations[I];console.log({index:I,operation:x}),u+=`- [${I}]: ${n.OPERATION[x]} (${JSON.stringify(s.getValue(Number(I),r))})
`})}return p(a),!r&&s.filteredChanges&&s.filteredChanges.operations.filter(y=>y).length>0&&(u+=`${e.constructor.name} (${s.refId}) -> .filteredChanges:
`,p(s.filteredChanges)),r&&s.allFilteredChanges&&s.allFilteredChanges.operations.filter(y=>y).length>0&&(u+=`${e.constructor.name} (${s.refId}) -> .allFilteredChanges:
`,p(s.allFilteredChanges)),u}static debugChangesDeep(e,r="changes"){var x,v;let s="";const a=e[E],h=a.root,u=new Map,p=[];let y=0;for(const[S,F]of Object.entries(h[r])){const M=h.changeTrees[S];let D=!1,A=[],B=(x=M.parent)==null?void 0:x[E];if(M===a)D=!0;else for(;B!==void 0;){if(A.push(B),B.ref===e){D=!0;break}B=(v=B.parent)==null?void 0:v[E]}D&&(p.push(M.refId),y+=Object.keys(F).length,u.set(M,A.reverse()))}s+=`---
`,s+=`root refId: ${a.refId}
`,s+=`Total instances: ${p.length} (refIds: ${p.join(", ")})
`,s+=`Total changes: ${y}
`,s+=`---
`;const I=new WeakSet;for(const[S,F]of u.entries()){F.forEach((Y,ne)=>{I.has(Y)||(s+=`${Rt(ne)}${Y.ref.constructor.name} (refId: ${Y.refId})
`,I.add(Y))});const M=S.indexedOperations,D=F.length,A=Rt(D),B=D>0?`(${S.parentIndex}) `:"";s+=`${A}${B}${S.ref.constructor.name} (refId: ${S.refId}) - changes: ${Object.keys(M).length}
`;for(const Y in M){const ne=M[Y];s+=`${Rt(D+1)}${n.OPERATION[ne]}: ${Y}
`}}return`${s}`}};yt[Kn]=Mn,yt[Yn]=Fn;let ie=yt;var Gn,Zn;const at=class at{static[(Gn=g,Zn=O,N)](e,r,s){return!s||typeof e[k]=="string"||s.isChangeTreeVisible((e[_](r)??e.deletedItems[r])[E])}static is(e){return e.collection!==void 0}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[E]=new rt(this),this[E].indexes={},e&&e.forEach(r=>this.add(r)),Object.defineProperty(this,k,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(e){const r=this.$refId++;return e[E]!==void 0&&e[E].setParent(this,this[E].root,r),this[E].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,e),this[E].change(r),r}at(e){const r=Array.from(this.$items.keys())[e];return this.$items.get(r)}entries(){return this.$items.entries()}delete(e){const r=this.$items.entries();let s,a;for(;(a=r.next())&&!a.done;)if(e===a.value[1]){s=a.value[0];break}return s===void 0?!1:(this.deletedItems[s]=this[E].delete(s),this.$indexes.delete(s),this.$items.delete(s))}clear(){const e=this[E];e.discard(!0),e.indexes={},this.$indexes.clear(),this.$items.clear(),e.operation(n.OPERATION.CLEAR)}has(e){return Array.from(this.$items.values()).some(r=>r===e)}forEach(e){this.$items.forEach((r,s,a)=>e(r,s,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(e,r){this.$indexes.set(e,r)}getIndex(e){return this.$indexes.get(e)}[_](e){return this.$items.get(this.$indexes.get(e))}[L](e){const r=this.$indexes.get(e);this.$items.delete(r),this.$indexes.delete(e)}[W](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const e=[];return this.forEach((r,s)=>{e.push(typeof r.toJSON=="function"?r.toJSON():r)}),e}clone(e){let r;return e?r=Object.assign(new at,this):(r=new at,this.forEach(s=>{s[E]?r.add(s.clone()):r.add(s)})),r}};at[Gn]=Tt,at[Zn]=_t;let mt=at;De("collection",{constructor:mt});var Xn,Qn;const ft=class ft{static[(Xn=g,Qn=O,N)](e,r,s){return!s||typeof e[k]=="string"||s.visible.has((e[_](r)??e.deletedItems[r])[E])}static is(e){return e.set!==void 0}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[E]=new rt(this),this[E].indexes={},e&&e.forEach(r=>this.add(r)),Object.defineProperty(this,k,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(e){var a;if(this.has(e))return!1;const r=this.$refId++;e[E]!==void 0&&e[E].setParent(this,this[E].root,r);const s=((a=this[E].indexes[r])==null?void 0:a.op)??n.OPERATION.ADD;return this[E].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,e),this[E].change(r,s),r}entries(){return this.$items.entries()}delete(e){const r=this.$items.entries();let s,a;for(;(a=r.next())&&!a.done;)if(e===a.value[1]){s=a.value[0];break}return s===void 0?!1:(this.deletedItems[s]=this[E].delete(s),this.$indexes.delete(s),this.$items.delete(s))}clear(){const e=this[E];e.discard(!0),e.indexes={},this.$indexes.clear(),this.$items.clear(),e.operation(n.OPERATION.CLEAR)}has(e){const r=this.$items.values();let s=!1,a;for(;(a=r.next())&&!a.done;)if(e===a.value){s=!0;break}return s}forEach(e){this.$items.forEach((r,s,a)=>e(r,s,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(e,r){this.$indexes.set(e,r)}getIndex(e){return this.$indexes.get(e)}[_](e){return this.$items.get(this.$indexes.get(e))}[L](e){const r=this.$indexes.get(e);this.$items.delete(r),this.$indexes.delete(e)}[W](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const e=[];return this.forEach((r,s)=>{e.push(typeof r.toJSON=="function"?r.toJSON():r)}),e}clone(e){let r;return e?r=Object.assign(new ft,this):(r=new ft,this.forEach(s=>{s[E]?r.add(s.clone()):r.add(s)})),r}};ft[Xn]=Tt,ft[Qn]=_t;let pt=ft;De("set",{constructor:pt});function Ue(c,e,r,s){var a=arguments.length,h=a<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,r):s,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(c,e,r,s);else for(var p=c.length-1;p>=0;p--)(u=c[p])&&(h=(a<3?u(h):a>3?u(e,r,h):u(e,r))||h);return a>3&&h&&Object.defineProperty(e,r,h),h}typeof SuppressedError=="function"&&SuppressedError;class Bs{constructor(e){this.types=e,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(e){e.ensureRefId();const r=this.changeTrees[e.refId]===void 0;r&&(this.changeTrees[e.refId]=e);const s=this.refCount[e.refId];if(s===0){const a=e.allChanges.operations;let h=a.length;for(;h--;)e.indexedOperations[a[h]]=n.OPERATION.ADD,be(e.changes,h)}return this.refCount[e.refId]=(s||0)+1,r}remove(e){const r=this.refCount[e.refId]-1;return r<=0?(e.root=void 0,delete this.changeTrees[e.refId],this.removeChangeFromChangeSet("allChanges",e),this.removeChangeFromChangeSet("changes",e),e.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",e),this.removeChangeFromChangeSet("filteredChanges",e)),this.refCount[e.refId]=0):(this.refCount[e.refId]=r,e.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",e),ge(this,e,"filteredChanges")):(this.removeChangeFromChangeSet("changes",e),ge(this,e,"changes"))),e.forEachChild((s,a)=>this.remove(s)),r}removeChangeFromChangeSet(e,r){const s=this[e],a=s.indexOf(r);if(a!==-1)return r[e].queueRootIndex=-1,s[a]=void 0,!0}clear(){this.changes.length=0}}const $t=class $t{constructor(e){this.sharedBuffer=Buffer.allocUnsafe($t.BUFFER_SIZE),this.context=Pe.cache(e.constructor),this.root=new Bs(this.context),this.setState(e)}setState(e){this.state=e,this.state[E].setRoot(this.root)}encode(e={offset:0},r,s=this.sharedBuffer,a="changes",h=a==="allChanges",u=e.offset){const p=r!==void 0,y=this.state[E],I=this.root[a];for(let x=0,v=I.length;x<v;x++){const S=I[x];if(!S)continue;if(p){if(!r.isChangeTreeVisible(S)){r.invisible.add(S);continue}r.invisible.delete(S)}const F=S[a],M=S.ref,D=F.operations.length;if(D===0)continue;const A=M.constructor,B=A[g],Y=A[N],ne=A[Symbol.metadata];(p||e.offset>u||S!==y)&&(s[e.offset++]=255,we.number(s,S.refId,e));for(let he=0;he<D;he++){const le=F.operations[he],ze=le<0?Math.abs(le):h?n.OPERATION.ADD:S.indexedOperations[le];le===void 0||ze===void 0||Y&&!Y(M,le,r)||B(this,s,S,le,ze,e,h,p,ne)}}if(e.offset>s.byteLength){const x=Math.ceil(e.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(x/1024)} * 1024; // ${Math.round(x/1024)} KB
`),s=Buffer.alloc(x,s),s===this.sharedBuffer&&(this.sharedBuffer=s),this.encode({offset:u},r,s,a,h)}else return s.subarray(0,e.offset)}encodeAll(e={offset:0},r=this.sharedBuffer){return this.encode(e,void 0,r,"allChanges",!0)}encodeAllView(e,r,s,a=this.sharedBuffer){const h=s.offset;return this.encode(s,e,a,"allFilteredChanges",!0,h),Buffer.concat([a.subarray(0,r),a.subarray(h,s.offset)])}debugChanges(e){(typeof e=="string"?this.root[e]:e).forEach(s=>{const a=s[e],h=s.ref.constructor[Symbol.metadata];console.log("->",{ref:s.ref.constructor.name,refId:s.refId,changes:Object.keys(a).length});for(const u in a){const p=a[u];console.log("  ->",{index:u,field:h==null?void 0:h[u],op:n.OPERATION[p]})}})}encodeView(e,r,s,a=this.sharedBuffer){const h=s.offset;for(const[u,p]of e.changes){const y=this.root.changeTrees[u];if(y===void 0){e.changes.delete(u);continue}const I=Object.keys(p);if(I.length===0)continue;const v=y.ref.constructor,S=v[g],F=v[Symbol.metadata];a[s.offset++]=255,we.number(a,y.refId,s);for(let M=0,D=I.length;M<D;M++){const A=Number(I[M]),Y=y.ref[_](A)!==void 0&&p[A]||n.OPERATION.DELETE;S(this,a,y,A,Y,s,!1,!0,F)}}return e.changes.clear(),this.encode(s,e,a,"filteredChanges",!1,h),Buffer.concat([a.subarray(0,r),a.subarray(h,s.offset)])}discardChanges(){var r,s;let e=this.root.changes.length;if(e>0){for(;e--;)(r=this.root.changes[e])==null||r.endEncode("changes");this.root.changes.length=0}if(e=this.root.filteredChanges.length,e>0){for(;e--;)(s=this.root.filteredChanges[e])==null||s.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(e,r,s,a){const h=this.context.getTypeId(r),u=this.context.getTypeId(s);if(u===void 0){console.warn(`@colyseus/schema WARNING: Class "${s.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}h!==u&&(e[a.offset++]=213,we.number(e,u,a))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};$t.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let Ct=$t;function er(c,e){if(e===-1||e>=c.length)return!1;const r=c.length-1;for(let s=e;s<r;s++)c[s]=c[s+1];return c.length=r,!0}class tr extends Error{constructor(e){super(e),this.name="DecodingWarning"}}class Ls{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(e,r,s=!0){this.refs.set(e,r),this.refIds.set(r,e),s&&(this.refCounts[e]=(this.refCounts[e]||0)+1),this.deletedRefs.has(e)&&this.deletedRefs.delete(e)}removeRef(e){const r=this.refCounts[e];if(r===void 0){try{throw new tr("trying to remove refId that doesn't exist: "+e)}catch(s){console.warn(s)}return}if(r===0){try{const s=this.refs.get(e);throw new tr(`trying to remove refId '${e}' with 0 refCount (${s.constructor.name}: ${JSON.stringify(s)})`)}catch(s){console.warn(s)}return}(this.refCounts[e]=r-1)<=0&&this.deletedRefs.add(e)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(e=>{if(this.refCounts[e]>0)return;const r=this.refs.get(e);if(r.constructor[Symbol.metadata]!==void 0){const s=r.constructor[Symbol.metadata];for(const a in s){const h=s[a].name,u=typeof r[h]=="object"&&this.refIds.get(r[h]);u&&!this.deletedRefs.has(u)&&this.removeRef(u)}}else typeof r[k]=="function"&&Array.from(r.values()).forEach(s=>{const a=this.refIds.get(s);this.deletedRefs.has(a)||this.removeRef(a)});this.refs.delete(e),delete this.refCounts[e],delete this.callbacks[e]}),this.deletedRefs.clear()}addCallback(e,r,s){if(e===void 0){const a=typeof r=="number"?n.OPERATION[r]:r;throw new Error(`Can't addCallback on '${a}' (refId is undefined)`)}return this.callbacks[e]||(this.callbacks[e]={}),this.callbacks[e][r]||(this.callbacks[e][r]=[]),this.callbacks[e][r].push(s),()=>this.removeCallback(e,r,s)}removeCallback(e,r,s){var h,u,p;const a=(p=(u=(h=this.callbacks)==null?void 0:h[e])==null?void 0:u[r])==null?void 0:p.indexOf(s);a!==-1&&er(this.callbacks[e][r],a)}}class tn{constructor(e,r){this.currentRefId=0,this.setState(e),this.context=r||new Pe(e.constructor)}setState(e){this.state=e,this.root=new Ls,this.root.addRef(0,e)}decode(e,r={offset:0},s=this.state){var y,I,x;const a=[],h=this.root,u=e.byteLength;let p=s.constructor[O];for(this.currentRefId=0;r.offset<u;){if(e[r.offset]==255){r.offset++,this.currentRefId=Ee.number(e,r);const S=h.refs.get(this.currentRefId);if(!S)throw new Error(`"refId" not found: ${this.currentRefId}`);(y=s[te])==null||y.call(s),s=S,p=s.constructor[O];continue}if(p(this,e,r,s,a)===Ln){console.warn("@colyseus/schema: definition mismatch");const S={offset:r.offset};for(;r.offset<u&&!(e[r.offset]===255&&(S.offset=r.offset+1,h.refs.has(Ee.number(e,S))));)r.offset++;continue}}return(I=s[te])==null||I.call(s),(x=this.triggerChanges)==null||x.call(this,a),h.garbageCollectDeletedRefs(),a}getInstanceType(e,r,s){let a;if(e[r.offset]===213){r.offset++;const h=Ee.number(e,r);a=this.context.get(h)}return a||s}createInstanceOfType(e){return new e}removeChildRefs(e,r){const s=typeof e[k]!="string",a=this.root.refIds.get(e);e.forEach((h,u)=>{r.push({ref:e,refId:a,op:n.OPERATION.DELETE,field:u,value:void 0,previousValue:h}),s&&this.root.removeRef(this.root.refIds.get(h))})}}class st extends ie{}Ue([ve("string")],st.prototype,"name",void 0),Ue([ve("string")],st.prototype,"type",void 0),Ue([ve("number")],st.prototype,"referencedType",void 0);class it extends ie{constructor(){super(...arguments),this.fields=new Ne}}Ue([ve("number")],it.prototype,"id",void 0),Ue([ve("number")],it.prototype,"extendsId",void 0),Ue([ve([st])],it.prototype,"fields",void 0);class ot extends ie{constructor(){super(...arguments),this.types=new Ne}static encode(e,r={offset:0}){const s=e.context,a=new ot,h=new Ct(a),u=s.schemas.get(e.state.constructor);u>0&&(a.rootType=u);const p=new Set,y={},I=v=>{if(v.extendsId===void 0||p.has(v.extendsId)){p.add(v.id),a.types.push(v);const S=y[v.id];S!==void 0&&(delete y[v.id],S.forEach(F=>I(F)))}else y[v.extendsId]===void 0&&(y[v.extendsId]=[]),y[v.extendsId].push(v)};s.schemas.forEach((v,S)=>{const F=new it;F.id=Number(v);const M=Object.getPrototypeOf(S);M!==ie&&(F.extendsId=s.schemas.get(M));const D=S[Symbol.metadata];if(D!==M[Symbol.metadata])for(const A in D){const B=Number(A),Y=D[B].name;if(!Object.prototype.hasOwnProperty.call(D,Y))continue;const ne=new st;ne.name=Y;let he;const le=D[B];if(typeof le.type=="string")he=le.type;else{let ze;ie.is(le.type)?(he="ref",ze=le.type):(he=Object.keys(le.type)[0],typeof le.type[he]=="string"?he+=":"+le.type[he]:ze=le.type[he]),ne.referencedType=ze?s.getTypeId(ze):-1}ne.type=he,F.fields.push(ne)}I(F)});for(const v in y)y[v].forEach(S=>a.types.push(S));const x=h.encodeAll(r);return Buffer.from(x,0,r.offset)}static decode(e,r){const s=new ot;new tn(s).decode(e,r);const h=new Pe;s.types.forEach(y=>{const I=h.get(y.extendsId)??ie,x=class extends I{};Pe.register(x),h.add(x,y.id)},{});const u=(y,I,x)=>{I.fields.forEach((v,S)=>{const F=x+S;if(v.referencedType!==void 0){let M=v.type,D=h.get(v.referencedType);if(!D){const A=v.type.split(":");M=A[0],D=A[1]}M==="ref"?oe.addField(y,F,v.name,D):oe.addField(y,F,v.name,{[M]:D})}else oe.addField(y,F,v.name,v.type)})};s.types.forEach(y=>{const I=h.get(y.id),x=oe.initialize(I),v=[];let S=y;do v.push(S),S=s.types.find(M=>M.id===S.extendsId);while(S);let F=0;v.reverse().forEach(M=>{u(x,M,F),F+=M.fields.length})});const p=new(h.get(s.rootType||0));return new tn(p,h)}}Ue([ve([it])],ot.prototype,"types",void 0),Ue([ve("number")],ot.prototype,"rootType",void 0);function Fs(c){const e=c.root,r=e.callbacks,s=new WeakMap;let a;c.triggerChanges=function(p){var I;const y=new Set;for(let x=0,v=p.length;x<v;x++){const S=p[x],F=S.refId,M=S.ref,D=r[F];if(D){if((S.op&n.OPERATION.DELETE)===n.OPERATION.DELETE&&S.previousValue instanceof ie){const A=(I=r[e.refIds.get(S.previousValue)])==null?void 0:I[n.OPERATION.DELETE];for(let B=(A==null?void 0:A.length)-1;B>=0;B--)A[B]()}if(M instanceof ie){if(!y.has(F)){const A=D==null?void 0:D[n.OPERATION.REPLACE];for(let B=(A==null?void 0:A.length)-1;B>=0;B--)A[B]()}if(D.hasOwnProperty(S.field)){const A=D[S.field];for(let B=(A==null?void 0:A.length)-1;B>=0;B--)A[B](S.value,S.previousValue)}}else{if((S.op&n.OPERATION.DELETE)===n.OPERATION.DELETE){if(S.previousValue!==void 0){const A=D[n.OPERATION.DELETE];for(let B=(A==null?void 0:A.length)-1;B>=0;B--)A[B](S.previousValue,S.dynamicIndex??S.field)}if((S.op&n.OPERATION.ADD)===n.OPERATION.ADD){const A=D[n.OPERATION.ADD];for(let B=(A==null?void 0:A.length)-1;B>=0;B--)A[B](S.value,S.dynamicIndex??S.field)}}else if((S.op&n.OPERATION.ADD)===n.OPERATION.ADD&&S.previousValue!==S.value){const A=D[n.OPERATION.ADD];for(let B=(A==null?void 0:A.length)-1;B>=0;B--)A[B](S.value,S.dynamicIndex??S.field)}if(S.value!==S.previousValue&&(S.value!==void 0||S.previousValue!==void 0)){const A=D[n.OPERATION.REPLACE];for(let B=(A==null?void 0:A.length)-1;B>=0;B--)A[B](S.value,S.dynamicIndex??S.field)}}y.add(F)}}};function h(p,y){var v;let I=((v=y.instance)==null?void 0:v.constructor[Symbol.metadata])||p,x=y.instance&&typeof y.instance.forEach=="function"||p&&typeof p[Symbol.metadata]>"u";if(I&&!x){const S=function(F,M,D,A){return A&&y.instance[M]!==void 0&&!s.has(a)&&D(y.instance[M],void 0),e.addCallback(e.refIds.get(F),M,D)};return new Proxy({listen:function(M,D,A=!0){if(y.instance)return S(y.instance,M,D,A);{let B=()=>{};return y.onInstanceAvailable((Y,ne)=>{B=S(Y,M,D,A&&ne&&!s.has(a))}),()=>B()}},onChange:function(M){return e.addCallback(e.refIds.get(y.instance),n.OPERATION.REPLACE,M)},bindTo:function(M,D){return D||(D=Object.keys(I).map(A=>I[A].name)),e.addCallback(e.refIds.get(y.instance),n.OPERATION.REPLACE,()=>{D.forEach(A=>M[A]=y.instance[A])})}},{get(F,M){var A;const D=I[I[M]];if(D){const B=(A=y.instance)==null?void 0:A[M],Y=ne=>{const he=u(y.instance).listen(M,(le,ze)=>{ne(le,!1),he==null||he()},!1);e.refIds.get(B)!==void 0&&ne(B,!0)};return h(D.type,{instance:e.refIds.get(B)&&B,parentInstance:y.instance,onInstanceAvailable:Y})}else return F[M]},has(F,M){return I[M]!==void 0},set(F,M,D){throw new Error("not allowed")},deleteProperty(F,M){throw new Error("not allowed")}})}else{const S=function(D,A,B){return B&&D.forEach((Y,ne)=>A(Y,ne)),e.addCallback(e.refIds.get(D),n.OPERATION.ADD,(Y,ne)=>{s.set(A,!0),a=A,A(Y,ne),s.delete(A),a=void 0})},F=function(D,A){return e.addCallback(e.refIds.get(D),n.OPERATION.DELETE,A)},M=function(D,A){return e.addCallback(e.refIds.get(D),n.OPERATION.REPLACE,A)};return new Proxy({onAdd:function(D,A=!0){if(y.instance)return S(y.instance,D,A&&!s.has(a));if(y.onInstanceAvailable){let B=()=>{};return y.onInstanceAvailable((Y,ne)=>{B=S(Y,D,A&&ne&&!s.has(a))}),()=>B()}},onRemove:function(D){if(y.instance)return F(y.instance,D);if(y.onInstanceAvailable){let A=()=>{};return y.onInstanceAvailable(B=>{A=F(B,D)}),()=>A()}},onChange:function(D){if(y.instance)return M(y.instance,D);if(y.onInstanceAvailable){let A=()=>{};return y.onInstanceAvailable(B=>{A=M(B,D)}),()=>A()}}},{get(D,A){if(!D[A])throw new Error(`Can't access '${A}' through callback proxy. access the instance directly.`);return D[A]},has(D,A){return D[A]!==void 0},set(D,A,B){throw new Error("not allowed")},deleteProperty(D,A){throw new Error("not allowed")}})}}function u(p){return h(void 0,{instance:p})}return u}function js(c,e){c.triggerChanges=e}class Us{constructor(e=!1){this.iterable=e,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,e&&(this.items=[])}add(e,r=Be,s=!0){var p,y;const a=e==null?void 0:e[E];if(a){if(!a.parent&&a.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${a.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",e),this;const h=e.constructor[Symbol.metadata];this.visible.add(a),this.iterable&&s&&this.items.push(e),s&&a.parent&&this.addParentOf(a,r);let u=this.changes.get(a.refId);if(u===void 0&&(u={},this.changes.set(a.refId,u)),r!==Be){this.tags||(this.tags=new WeakMap);let I;this.tags.has(a)?I=this.tags.get(a):(I=new Set,this.tags.set(a,I)),I.add(r),(y=(p=h==null?void 0:h[Oe])==null?void 0:p[r])==null||y.forEach(x=>{a.getChange(x)!==n.OPERATION.DELETE&&(u[x]=n.OPERATION.ADD)})}else{const I=this.invisible.has(a),x=a.filteredChanges!==void 0?a.allFilteredChanges:a.allChanges;for(let v=0,S=x.operations.length;v<S;v++){const F=x.operations[v];if(F===void 0)continue;const M=a.indexedOperations[F]??n.OPERATION.ADD,D=h==null?void 0:h[F].tag;!a.isNew&&(I||D===void 0||D===r)&&M!==n.OPERATION.DELETE&&(u[F]=M)}}return a.forEachChild((I,x)=>{h&&h[x].tag!==void 0&&h[x].tag!==r||this.add(I.ref,r,!1)}),this}addParentOf(e,r){var h;const s=e.parent[E],a=e.parentIndex;if(!this.visible.has(s)){this.visible.add(s);const u=(h=s.parent)==null?void 0:h[E];u&&u.filteredChanges!==void 0&&this.addParentOf(s,r)}if(s.getChange(a)!==n.OPERATION.DELETE){let u=this.changes.get(s.refId);u===void 0&&(u={},this.changes.set(s.refId,u)),this.tags||(this.tags=new WeakMap);let p;this.tags.has(s)?p=this.tags.get(s):(p=new Set,this.tags.set(s,p)),p.add(r),u[a]=n.OPERATION.ADD}}remove(e,r=Be,s=!1){var y;const a=e[E];if(!a)return console.warn("StateView#remove(), invalid object:",e),this;this.visible.delete(a),this.iterable&&!s&&er(this.items,this.items.indexOf(e));const u=a.ref.constructor[Symbol.metadata];let p=this.changes.get(a.refId);if(p===void 0&&(p={},this.changes.set(a.refId,p)),r===Be){const I=a.parent;if(!oe.isValidInstance(I)&&a.isFiltered){const x=I[E];let v=this.changes.get(x.refId);v===void 0&&(v={},this.changes.set(x.refId,v)),v[a.parentIndex]=n.OPERATION.DELETE}else(y=u==null?void 0:u[pe])==null||y.forEach(x=>p[x]=n.OPERATION.DELETE)}else u==null||u[Oe][r].forEach(I=>p[I]=n.OPERATION.DELETE);if(this.tags&&this.tags.has(a)){const I=this.tags.get(a);r===void 0?this.tags.delete(a):(I.delete(r),I.size===0&&this.tags.delete(a))}return this}has(e){return this.visible.has(e[E])}hasTag(e,r=Be){var a;const s=(a=this.tags)==null?void 0:a.get(e[E]);return(s==null?void 0:s.has(r))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let e=0,r=this.items.length;e<r;e++)this.remove(this.items[e],Be,!0);this.items.length=0}isChangeTreeVisible(e){let r=this.visible.has(e);return!r&&e.isVisibilitySharedWithParent&&this.visible.has(e.parent[E])&&(this.visible.add(e),r=!0),r}}De("map",{constructor:je}),De("array",{constructor:Ne}),De("set",{constructor:pt}),De("collection",{constructor:mt}),n.$changes=E,n.$childType=k,n.$decoder=O,n.$deleteByIndex=L,n.$encoder=g,n.$filter=N,n.$getByIndex=_,n.$track=l,n.ArraySchema=Ne,n.ChangeTree=rt,n.CollectionSchema=mt,n.Decoder=tn,n.Encoder=Ct,n.MapSchema=je,n.Metadata=oe,n.Reflection=ot,n.ReflectionField=st,n.ReflectionType=it,n.Schema=ie,n.SetSchema=pt,n.StateView=Us,n.TypeContext=Pe,n.decode=Ee,n.decodeKeyValueOperation=_t,n.decodeSchemaOperation=Fn,n.defineCustomTypes=Rs,n.defineTypes=ks,n.deprecated=Ns,n.dumpChanges=Ms,n.encode=we,n.encodeArray=Bn,n.encodeKeyValueOperation=Tt,n.encodeSchemaOperation=Mn,n.entity=Ps,n.getDecoderStateCallbacks=Fs,n.getRawChangesCallback=js,n.registerType=De,n.schema=qn,n.type=ve,n.view=Wn})})(fn,fn.exports);var pn=fn.exports,nr=Ht,Ze=pn;class Zs{constructor(t){this.events=t,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(t,n={}){const o=n.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(n.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(t,o),this.wt.ready.then(f=>{console.log("WebTransport ready!",f),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(g=>{this.reader=g.value.readable.getReader(),this.writer=g.value.writable.getWriter(),this.sendSeatReservation(n.room.roomId,n.sessionId,n.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(g=>{console.error("failed to read incoming stream",g),console.error("TODO: close the connection")})}).catch(f=>{console.log("WebTransport not ready!",f),this._close()}),this.wt.closed.then(f=>{console.log("WebTransport closed w/ success",f),this.events.onclose({code:f.closeCode,reason:f.reason})}).catch(f=>{console.log("WebTransport closed w/ error",f),this.events.onerror(f),this.events.onclose({code:f.closeCode,reason:f.reason})}).finally(()=>{this._close()})}send(t){const n=Ze.encode.number(this.lengthPrefixBuffer,t.length,{offset:0}),o=new Uint8Array(n+t.length);o.set(this.lengthPrefixBuffer.subarray(0,n),0),o.set(t,n),this.writer.write(o)}sendUnreliable(t){const n=Ze.encode.number(this.lengthPrefixBuffer,t.length,{offset:0}),o=new Uint8Array(n+t.length);o.set(this.lengthPrefixBuffer.subarray(0,n),0),o.set(t,n),this.unreliableWriter.write(o)}close(t,n){try{this.wt.close({closeCode:t,reason:n})}catch(o){console.error(o)}}readIncomingData(){return nr.__awaiter(this,void 0,void 0,function*(){let t;for(;this.isOpen;){try{t=yield this.reader.read();const n=t.value,o={offset:0};do{const f=Ze.decode.number(n,o);this.events.onmessage({data:n.subarray(o.offset,o.offset+f)}),o.offset+=f}while(o.offset<n.length)}catch(n){n.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",n);break}if(t.done)break}})}readIncomingUnreliableData(){return nr.__awaiter(this,void 0,void 0,function*(){let t;for(;this.isOpen;){try{t=yield this.unreliableReader.read();const n=t.value,o={offset:0};do{const f=Ze.decode.number(n,o);this.events.onmessage({data:n.subarray(o.offset,o.offset+f)}),o.offset+=f}while(o.offset<n.length)}catch(n){n.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",n);break}if(t.done)break}})}sendSeatReservation(t,n,o){const f={offset:0},l=[];Ze.encode.string(l,t,f),Ze.encode.string(l,n,f),o&&Ze.encode.string(l,o,f),this.writer.write(new Uint8Array(l).buffer)}_close(){this.isOpen=!1}}qr.H3TransportTransport=Zs;var Kr={},Xs=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},Qs=Xs;const nn=globalThis.WebSocket||Qs;let ei=class{constructor(t){this.events=t}send(t){this.ws.send(t)}sendUnreliable(t){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(t,n){try{this.ws=new nn(t,{headers:n,protocols:this.protocols})}catch{this.ws=new nn(t,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(t,n){this.ws.close(t,n)}get isOpen(){return this.ws.readyState===nn.OPEN}};Kr.WebSocketTransport=ei;var ti=qr,ni=Kr;let ri=class{constructor(t){switch(this.events={},t){case"h3":this.transport=new ti.H3TransportTransport(this.events);break;default:this.transport=new ni.WebSocketTransport(this.events);break}}connect(t,n){this.transport.connect.call(this.transport,t,n)}send(t){this.transport.send(t)}sendUnreliable(t){this.transport.sendUnreliable(t)}close(t,n){this.transport.close(t,n)}get isOpen(){return this.transport.isOpen}};Jr.Connection=ri;var yn={};(function(i){i.Protocol=void 0,function(t){t[t.HANDSHAKE=9]="HANDSHAKE",t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.ERROR=11]="ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",t[t.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",t[t.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(i.Protocol||(i.Protocol={})),i.ErrorCode=void 0,function(t){t[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(i.ErrorCode||(i.ErrorCode={}))})(yn);var Wt={};const Yr={};function si(i,t){Yr[i]=t}function ii(i){const t=Yr[i];if(!t)throw new Error("missing serializer: "+i);return t}Wt.getSerializer=ii;Wt.registerSerializer=si;var wn={};const oi=()=>({emit(i,...t){let n=this.events[i]||[];for(let o=0,f=n.length;o<f;o++)n[o](...t)},events:{},on(i,t){var n;return!((n=this.events[i])===null||n===void 0)&&n.push(t)||(this.events[i]=[t]),()=>{var o;this.events[i]=(o=this.events[i])===null||o===void 0?void 0:o.filter(f=>t!==f)}}});wn.createNanoEvents=oi;var En={};class Gr{constructor(){this.handlers=[]}register(t,n=!1){return this.handlers.push(t),this}invoke(...t){this.handlers.forEach(n=>n.apply(this,t))}invokeAsync(...t){return Promise.all(this.handlers.map(n=>n.apply(this,t)))}remove(t){const n=this.handlers.indexOf(t);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function ai(){const i=new Gr;function t(n){return i.register(n,this===null)}return t.once=n=>{const o=function(...f){n.apply(this,f),i.remove(o)};i.register(o)},t.remove=n=>i.remove(n),t.invoke=(...n)=>i.invoke(...n),t.invokeAsync=(...n)=>i.invokeAsync(...n),t.clear=()=>i.clear(),t}En.EventEmitter=Gr;En.createSignal=ai;var Jt={},kt=pn;function fi(i){try{return kt.getDecoderStateCallbacks(i.serializer.decoder)}catch{return}}let ci=class{setState(t,n){this.decoder.decode(t,n)}getState(){return this.state}patch(t,n){return this.decoder.decode(t,n)}teardown(){this.decoder.root.clearRefs()}handshake(t,n){this.state?(kt.Reflection.decode(t,n),this.decoder=new kt.Decoder(this.state)):(this.decoder=kt.Reflection.decode(t,n),this.state=this.decoder.state)}};Jt.SchemaSerializer=ci;Jt.getStateCallbacks=fi;var cn;try{cn=new TextDecoder}catch{}var $,Se,d=0,G={},J,We,xe=0,Me=0,ce,Fe,de=[],H,rr={useRecords:!1,mapsAsObjects:!0};class Zr{}const bn=new Zr;bn.name="MessagePack 0xC1";var Je=!1,Xr=2,sr;try{new Function("")}catch{Xr=1/0}class qe{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if($)return ss(()=>(Ut(),this?this.unpack(t,n):qe.prototype.unpack.call(rr,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof n=="object"?(Se=n.end||t.length,d=n.start||0):(d=0,Se=n>-1?n:t.length),Me=0,We=null,ce=null,$=t;try{H=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(o){throw $=null,t instanceof Uint8Array?o:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof qe){if(G=this,this.structures)return J=this.structures,Dt(n);(!J||J.length>0)&&(J=[])}else G=rr,(!J||J.length>0)&&(J=[]);return Dt(n)}unpackMultiple(t,n){let o,f=0;try{Je=!0;let l=t.length,g=this?this.unpack(t,l):Kt.unpack(t,l);if(n){if(n(g,f,d)===!1)return;for(;d<l;)if(f=d,n(Dt(),f,d)===!1)return}else{for(o=[g];d<l;)f=d,o.push(Dt());return o}}catch(l){throw l.lastPosition=f,l.values=o,l}finally{Je=!1,Ut()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(o=>o.slice(0)));for(let o=0,f=t.length;o<f;o++){let l=t[o];l&&(l.isShared=!0,o>=32&&(l.highByte=o-32>>5))}t.sharedLength=t.length;for(let o in n||[])if(o>=0){let f=t[o],l=n[o];l&&(f&&((t.restoreStructures||(t.restoreStructures=[]))[o]=f),t[o]=l)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Dt(i){try{if(!G.trusted&&!Je){let n=J.sharedLength||0;n<J.length&&(J.length=n)}let t;if(G.randomAccessStructure&&$[d]<64&&$[d]>=32&&sr?(t=sr($,d,Se,G),$=null,!(i&&i.lazy)&&t&&(t=t.toJSON()),d=Se):t=re(),ce&&(d=ce.postBundlePosition,ce=null),Je&&(J.restoreStructures=null),d==Se)J&&J.restoreStructures&&ir(),J=null,$=null,Fe&&(Fe=null);else{if(d>Se)throw new Error("Unexpected end of MessagePack data");if(!Je){let n;try{n=JSON.stringify(t,(o,f)=>typeof f=="bigint"?`${f}n`:f).slice(0,100)}catch(o){n="(JSON view not available "+o+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw J&&J.restoreStructures&&ir(),Ut(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||d>Se)&&(t.incomplete=!0),t}}function ir(){for(let i in J.restoreStructures)J[i]=J.restoreStructures[i];J.restoreStructures=null}function re(){let i=$[d++];if(i<160)if(i<128){if(i<64)return i;{let t=J[i&63]||G.getStructures&&Qr()[i&63];return t?(t.read||(t.read=On(t,i&63)),t.read()):i}}else if(i<144)if(i-=128,G.mapsAsObjects){let t={};for(let n=0;n<i;n++){let o=ts();o==="__proto__"&&(o="__proto_"),t[o]=re()}return t}else{let t=new Map;for(let n=0;n<i;n++)t.set(re(),re());return t}else{i-=144;let t=new Array(i);for(let n=0;n<i;n++)t[n]=re();return G.freezeData?Object.freeze(t):t}else if(i<192){let t=i-160;if(Me>=d)return We.slice(d-xe,(d+=t)-xe);if(Me==0&&Se<140){let n=t<16?In(t):es(t);if(n!=null)return n}return ln(t)}else{let t;switch(i){case 192:return null;case 193:return ce?(t=re(),t>0?ce[1].slice(ce.position1,ce.position1+=t):ce[0].slice(ce.position0,ce.position0-=t)):bn;case 194:return!1;case 195:return!0;case 196:if(t=$[d++],t===void 0)throw new Error("Unexpected end of buffer");return rn(t);case 197:return t=H.getUint16(d),d+=2,rn(t);case 198:return t=H.getUint32(d),d+=4,rn(t);case 199:return Xe($[d++]);case 200:return t=H.getUint16(d),d+=2,Xe(t);case 201:return t=H.getUint32(d),d+=4,Xe(t);case 202:if(t=H.getFloat32(d),G.useFloat32>2){let n=qt[($[d]&127)<<1|$[d+1]>>7];return d+=4,(n*t+(t>0?.5:-.5)>>0)/n}return d+=4,t;case 203:return t=H.getFloat64(d),d+=8,t;case 204:return $[d++];case 205:return t=H.getUint16(d),d+=2,t;case 206:return t=H.getUint32(d),d+=4,t;case 207:return G.int64AsType==="number"?(t=H.getUint32(d)*4294967296,t+=H.getUint32(d+4)):G.int64AsType==="string"?t=H.getBigUint64(d).toString():G.int64AsType==="auto"?(t=H.getBigUint64(d),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=H.getBigUint64(d),d+=8,t;case 208:return H.getInt8(d++);case 209:return t=H.getInt16(d),d+=2,t;case 210:return t=H.getInt32(d),d+=4,t;case 211:return G.int64AsType==="number"?(t=H.getInt32(d)*4294967296,t+=H.getUint32(d+4)):G.int64AsType==="string"?t=H.getBigInt64(d).toString():G.int64AsType==="auto"?(t=H.getBigInt64(d),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=H.getBigInt64(d),d+=8,t;case 212:if(t=$[d++],t==114)return hr($[d++]&63);{let n=de[t];if(n)return n.read?(d++,n.read(re())):n.noBuffer?(d++,n()):n($.subarray(d,++d));throw new Error("Unknown extension "+t)}case 213:return t=$[d],t==114?(d++,hr($[d++]&63,$[d++])):Xe(2);case 214:return Xe(4);case 215:return Xe(8);case 216:return Xe(16);case 217:return t=$[d++],Me>=d?We.slice(d-xe,(d+=t)-xe):hi(t);case 218:return t=H.getUint16(d),d+=2,Me>=d?We.slice(d-xe,(d+=t)-xe):ui(t);case 219:return t=H.getUint32(d),d+=4,Me>=d?We.slice(d-xe,(d+=t)-xe):di(t);case 220:return t=H.getUint16(d),d+=2,ar(t);case 221:return t=H.getUint32(d),d+=4,ar(t);case 222:return t=H.getUint16(d),d+=2,fr(t);case 223:return t=H.getUint32(d),d+=4,fr(t);default:if(i>=224)return i-256;if(i===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+i)}}}const li=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function On(i,t){function n(){if(n.count++>Xr){let f=i.read=new Function("r","return function(){return "+(G.freezeData?"Object.freeze":"")+"({"+i.map(l=>l==="__proto__"?"__proto_:r()":li.test(l)?l+":r()":"["+JSON.stringify(l)+"]:r()").join(",")+"})}")(re);return i.highByte===0&&(i.read=or(t,i.read)),f()}let o={};for(let f=0,l=i.length;f<l;f++){let g=i[f];g==="__proto__"&&(g="__proto_"),o[g]=re()}return G.freezeData?Object.freeze(o):o}return n.count=0,i.highByte===0?or(t,n):n}const or=(i,t)=>function(){let n=$[d++];if(n===0)return t();let o=i<32?-(i+(n<<5)):i+(n<<5),f=J[o]||Qr()[o];if(!f)throw new Error("Record id is not defined for "+o);return f.read||(f.read=On(f,i)),f.read()};function Qr(){let i=ss(()=>($=null,G.getStructures()));return J=G._mergeStructures(i,J)}var ln=bt,hi=bt,ui=bt,di=bt;let gi=!1;function bt(i){let t;if(i<16&&(t=In(i)))return t;if(i>64&&cn)return cn.decode($.subarray(d,d+=i));const n=d+i,o=[];for(t="";d<n;){const f=$[d++];if(!(f&128))o.push(f);else if((f&224)===192){const l=$[d++]&63;o.push((f&31)<<6|l)}else if((f&240)===224){const l=$[d++]&63,g=$[d++]&63;o.push((f&31)<<12|l<<6|g)}else if((f&248)===240){const l=$[d++]&63,g=$[d++]&63,O=$[d++]&63;let N=(f&7)<<18|l<<12|g<<6|O;N>65535&&(N-=65536,o.push(N>>>10&1023|55296),N=56320|N&1023),o.push(N)}else o.push(f);o.length>=4096&&(t+=fe.apply(String,o),o.length=0)}return o.length>0&&(t+=fe.apply(String,o)),t}function ar(i){let t=new Array(i);for(let n=0;n<i;n++)t[n]=re();return G.freezeData?Object.freeze(t):t}function fr(i){if(G.mapsAsObjects){let t={};for(let n=0;n<i;n++){let o=ts();o==="__proto__"&&(o="__proto_"),t[o]=re()}return t}else{let t=new Map;for(let n=0;n<i;n++)t.set(re(),re());return t}}var fe=String.fromCharCode;function es(i){let t=d,n=new Array(i);for(let o=0;o<i;o++){const f=$[d++];if((f&128)>0){d=t;return}n[o]=f}return fe.apply(String,n)}function In(i){if(i<4)if(i<2){if(i===0)return"";{let t=$[d++];if((t&128)>1){d-=1;return}return fe(t)}}else{let t=$[d++],n=$[d++];if((t&128)>0||(n&128)>0){d-=2;return}if(i<3)return fe(t,n);let o=$[d++];if((o&128)>0){d-=3;return}return fe(t,n,o)}else{let t=$[d++],n=$[d++],o=$[d++],f=$[d++];if((t&128)>0||(n&128)>0||(o&128)>0||(f&128)>0){d-=4;return}if(i<6){if(i===4)return fe(t,n,o,f);{let l=$[d++];if((l&128)>0){d-=5;return}return fe(t,n,o,f,l)}}else if(i<8){let l=$[d++],g=$[d++];if((l&128)>0||(g&128)>0){d-=6;return}if(i<7)return fe(t,n,o,f,l,g);let O=$[d++];if((O&128)>0){d-=7;return}return fe(t,n,o,f,l,g,O)}else{let l=$[d++],g=$[d++],O=$[d++],N=$[d++];if((l&128)>0||(g&128)>0||(O&128)>0||(N&128)>0){d-=8;return}if(i<10){if(i===8)return fe(t,n,o,f,l,g,O,N);{let _=$[d++];if((_&128)>0){d-=9;return}return fe(t,n,o,f,l,g,O,N,_)}}else if(i<12){let _=$[d++],L=$[d++];if((_&128)>0||(L&128)>0){d-=10;return}if(i<11)return fe(t,n,o,f,l,g,O,N,_,L);let E=$[d++];if((E&128)>0){d-=11;return}return fe(t,n,o,f,l,g,O,N,_,L,E)}else{let _=$[d++],L=$[d++],E=$[d++],k=$[d++];if((_&128)>0||(L&128)>0||(E&128)>0||(k&128)>0){d-=12;return}if(i<14){if(i===12)return fe(t,n,o,f,l,g,O,N,_,L,E,k);{let W=$[d++];if((W&128)>0){d-=13;return}return fe(t,n,o,f,l,g,O,N,_,L,E,k,W)}}else{let W=$[d++],te=$[d++];if((W&128)>0||(te&128)>0){d-=14;return}if(i<15)return fe(t,n,o,f,l,g,O,N,_,L,E,k,W,te);let V=$[d++];if((V&128)>0){d-=15;return}return fe(t,n,o,f,l,g,O,N,_,L,E,k,W,te,V)}}}}}function cr(){let i=$[d++],t;if(i<192)t=i-160;else switch(i){case 217:t=$[d++];break;case 218:t=H.getUint16(d),d+=2;break;case 219:t=H.getUint32(d),d+=4;break;default:throw new Error("Expected string")}return bt(t)}function rn(i){return G.copyBuffers?Uint8Array.prototype.slice.call($,d,d+=i):$.subarray(d,d+=i)}function Xe(i){let t=$[d++];if(de[t]){let n;return de[t]($.subarray(d,n=d+=i),o=>{d=o;try{return re()}finally{d=n}})}else throw new Error("Unknown extension type "+t)}var lr=new Array(4096);function ts(){let i=$[d++];if(i>=160&&i<192){if(i=i-160,Me>=d)return We.slice(d-xe,(d+=i)-xe);if(!(Me==0&&Se<180))return ln(i)}else return d--,ns(re());let t=(i<<5^(i>1?H.getUint16(d):i>0?$[d]:0))&4095,n=lr[t],o=d,f=d+i-3,l,g=0;if(n&&n.bytes==i){for(;o<f;){if(l=H.getUint32(o),l!=n[g++]){o=1879048192;break}o+=4}for(f+=3;o<f;)if(l=$[o++],l!=n[g++]){o=1879048192;break}if(o===f)return d=o,n.string;f-=3,o=d}for(n=[],lr[t]=n,n.bytes=i;o<f;)l=H.getUint32(o),n.push(l),o+=4;for(f+=3;o<f;)l=$[o++],n.push(l);let O=i<16?In(i):es(i);return O!=null?n.string=O:n.string=ln(i)}function ns(i){if(typeof i=="string")return i;if(typeof i=="number"||typeof i=="boolean"||typeof i=="bigint")return i.toString();if(i==null)return i+"";if(G.allowArraysInMapKeys&&Array.isArray(i)&&i.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return i.flat().toString();throw new Error(`Invalid property type for record: ${typeof i}`)}const hr=(i,t)=>{let n=re().map(ns),o=i;t!==void 0&&(i=i<32?-((t<<5)+i):(t<<5)+i,n.highByte=t);let f=J[i];return f&&(f.isShared||Je)&&((J.restoreStructures||(J.restoreStructures=[]))[i]=f),J[i]=n,n.read=On(n,o),n.read()};de[0]=()=>{};de[0].noBuffer=!0;de[66]=i=>{let t=i.length,n=BigInt(i[0]&128?i[0]-256:i[0]);for(let o=1;o<t;o++)n<<=BigInt(8),n+=BigInt(i[o]);return n};let mi={Error,TypeError,ReferenceError};de[101]=()=>{let i=re();return(mi[i[0]]||Error)(i[1],{cause:i[2]})};de[105]=i=>{if(G.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=H.getUint32(d-4);Fe||(Fe=new Map);let n=$[d],o;n>=144&&n<160||n==220||n==221?o=[]:o={};let f={target:o};Fe.set(t,f);let l=re();return f.used?Object.assign(o,l):(f.target=l,l)};de[112]=i=>{if(G.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=H.getUint32(d-4),n=Fe.get(t);return n.used=!0,n.target};de[115]=()=>new Set(re());const rs=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(i=>i+"Array");let pi=typeof globalThis=="object"?globalThis:window;de[116]=i=>{let t=i[0],n=rs[t];if(!n){if(t===16){let o=new ArrayBuffer(i.length-1);return new Uint8Array(o).set(i.subarray(1)),o}throw new Error("Could not find typed array for code "+t)}return new pi[n](Uint8Array.prototype.slice.call(i,1).buffer)};de[120]=()=>{let i=re();return new RegExp(i[0],i[1])};const yi=[];de[98]=i=>{let t=(i[0]<<24)+(i[1]<<16)+(i[2]<<8)+i[3],n=d;return d+=t-i.length,ce=yi,ce=[cr(),cr()],ce.position0=0,ce.position1=0,ce.postBundlePosition=d,d=n,re()};de[255]=i=>i.length==4?new Date((i[0]*16777216+(i[1]<<16)+(i[2]<<8)+i[3])*1e3):i.length==8?new Date(((i[0]<<22)+(i[1]<<14)+(i[2]<<6)+(i[3]>>2))/1e6+((i[3]&3)*4294967296+i[4]*16777216+(i[5]<<16)+(i[6]<<8)+i[7])*1e3):i.length==12?new Date(((i[0]<<24)+(i[1]<<16)+(i[2]<<8)+i[3])/1e6+((i[4]&128?-281474976710656:0)+i[6]*1099511627776+i[7]*4294967296+i[8]*16777216+(i[9]<<16)+(i[10]<<8)+i[11])*1e3):new Date("invalid");function ss(i){let t=Se,n=d,o=xe,f=Me,l=We,g=Fe,O=ce,N=new Uint8Array($.slice(0,Se)),_=J,L=J.slice(0,J.length),E=G,k=Je,W=i();return Se=t,d=n,xe=o,Me=f,We=l,Fe=g,ce=O,$=N,Je=k,J=_,J.splice(0,J.length,...L),G=E,H=new DataView($.buffer,$.byteOffset,$.byteLength),W}function Ut(){$=null,Fe=null,J=null}function wi(i){i.unpack?de[i.type]=i.unpack:de[i.type]=i}const qt=new Array(147);for(let i=0;i<256;i++)qt[i]=+("1e"+Math.floor(45.15-i*.30103));const Ei=qe;var Kt=new qe({useRecords:!1});const bi=Kt.unpack,Oi=Kt.unpackMultiple,Ii=Kt.unpack,is={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let os=new Float32Array(1),ur=new Uint8Array(os.buffer,0,4);function xi(i){os[0]=i;let t=qt[(ur[3]&127)<<1|ur[2]>>7];return(t*i+(i>0?.5:-.5)>>0)/t}let Mt;try{Mt=new TextEncoder}catch{}let Vt,xn;const Yt=typeof Buffer<"u",Pt=Yt?function(i){return Buffer.allocUnsafeSlow(i)}:Uint8Array,as=Yt?Buffer:Uint8Array,dr=Yt?4294967296:2144337920;let w,wt,Z,m=0,me,ee=null,Si;const Ai=21760,Ti=/[\u0080-\uFFFF]/,ct=Symbol("record-id");class Ot extends qe{constructor(t){super(t),this.offset=0;let n,o,f,l,g=as.prototype.utf8Write?function(b,P){return w.utf8Write(b,P,w.byteLength-P)}:Mt&&Mt.encodeInto?function(b,P){return Mt.encodeInto(b,w.subarray(P)).written}:!1,O=this;t||(t={});let N=t&&t.sequential,_=t.structures||t.saveStructures,L=t.maxSharedStructures;if(L==null&&(L=_?32:0),L>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let E=t.maxOwnStructures;E==null&&(E=_?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let k=L>32||E+L>64,W=L+64,te=L+E+64;if(te>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let V=[],X=0,se=0;this.pack=this.encode=function(b,P){if(w||(w=new Pt(8192),Z=w.dataView||(w.dataView=new DataView(w.buffer,0,8192)),m=0),me=w.length-10,me-m<2048?(w=new Pt(w.length),Z=w.dataView||(w.dataView=new DataView(w.buffer,0,w.length)),me=w.length-10,m=0):m=m+7&2147483640,n=m,P&hs&&(m+=P&255),l=O.structuredClone?new Map:null,O.bundleStrings&&typeof b!="string"?(ee=[],ee.size=1/0):ee=null,f=O.structures,f){f.uninitialized&&(f=O._mergeStructures(O.getStructures()));let T=f.sharedLength||0;if(T>L)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+f.sharedLength);if(!f.transitions){f.transitions=Object.create(null);for(let R=0;R<T;R++){let j=f[R];if(!j)continue;let z,U=f.transitions;for(let q=0,K=j.length;q<K;q++){let ye=j[q];z=U[ye],z||(z=U[ye]=Object.create(null)),U=z}U[ct]=R+64}this.lastNamedStructuresLength=T}N||(f.nextId=T+64)}o&&(o=!1);let C;try{O.randomAccessStructure&&b&&b.constructor&&b.constructor===Object?xt(b):Q(b);let T=ee;if(ee&&pr(n,Q,0),l&&l.idsToInsert){let R=l.idsToInsert.sort((q,K)=>q.offset>K.offset?1:-1),j=R.length,z=-1;for(;T&&j>0;){let q=R[--j].offset+n;q<T.stringsPosition+n&&z===-1&&(z=0),q>T.position+n?z>=0&&(z+=6):(z>=0&&(Z.setUint32(T.position+n,Z.getUint32(T.position+n)+z),z=-1),T=T.previous,j++)}z>=0&&T&&Z.setUint32(T.position+n,Z.getUint32(T.position+n)+z),m+=R.length*6,m>me&&Ae(m),O.offset=m;let U=vi(w.subarray(n,m),R);return l=null,U}return O.offset=m,P&cs?(w.start=n,w.end=m,w):w.subarray(n,m)}catch(T){throw C=T,T}finally{if(f&&(pe(),o&&O.saveStructures)){let T=f.sharedLength||0,R=w.subarray(n,m),j=Ci(f,O);if(!C)return O.saveStructures(j,j.isCompatible)===!1?O.pack(b,P):(O.lastNamedStructuresLength=T,w.length>1073741824&&(w=null),R)}w.length>1073741824&&(w=null),P&ls&&(m=n)}};const pe=()=>{se<10&&se++;let b=f.sharedLength||0;if(f.length>b&&!N&&(f.length=b),X>1e4)f.transitions=null,se=0,X=0,V.length>0&&(V=[]);else if(V.length>0&&!N){for(let P=0,C=V.length;P<C;P++)V[P][ct]=0;V=[]}},Oe=b=>{var P=b.length;P<16?w[m++]=144|P:P<65536?(w[m++]=220,w[m++]=P>>8,w[m++]=P&255):(w[m++]=221,Z.setUint32(m,P),m+=4);for(let C=0;C<P;C++)Q(b[C])},Q=b=>{m>me&&(w=Ae(m));var P=typeof b,C;if(P==="string"){let T=b.length;if(ee&&T>=4&&T<4096){if((ee.size+=T)>Ai){let U,q=(ee[0]?ee[0].length*3+ee[1].length:0)+10;m+q>me&&(w=Ae(m+q));let K;ee.position?(K=ee,w[m]=200,m+=3,w[m++]=98,U=m-n,m+=4,pr(n,Q,0),Z.setUint16(U+n-3,m-n-U)):(w[m++]=214,w[m++]=98,U=m-n,m+=4),ee=["",""],ee.previous=K,ee.size=0,ee.position=U}let z=Ti.test(b);ee[z?0:1]+=b,w[m++]=193,Q(z?-T:T);return}let R;T<32?R=1:T<256?R=2:T<65536?R=3:R=5;let j=T*3;if(m+j>me&&(w=Ae(m+j)),T<64||!g){let z,U,q,K=m+R;for(z=0;z<T;z++)U=b.charCodeAt(z),U<128?w[K++]=U:U<2048?(w[K++]=U>>6|192,w[K++]=U&63|128):(U&64512)===55296&&((q=b.charCodeAt(z+1))&64512)===56320?(U=65536+((U&1023)<<10)+(q&1023),z++,w[K++]=U>>18|240,w[K++]=U>>12&63|128,w[K++]=U>>6&63|128,w[K++]=U&63|128):(w[K++]=U>>12|224,w[K++]=U>>6&63|128,w[K++]=U&63|128);C=K-m-R}else C=g(b,m+R);C<32?w[m++]=160|C:C<256?(R<2&&w.copyWithin(m+2,m+1,m+1+C),w[m++]=217,w[m++]=C):C<65536?(R<3&&w.copyWithin(m+3,m+2,m+2+C),w[m++]=218,w[m++]=C>>8,w[m++]=C&255):(R<5&&w.copyWithin(m+5,m+3,m+3+C),w[m++]=219,Z.setUint32(m,C),m+=4),m+=C}else if(P==="number")if(b>>>0===b)b<32||b<128&&this.useRecords===!1||b<64&&!this.randomAccessStructure?w[m++]=b:b<256?(w[m++]=204,w[m++]=b):b<65536?(w[m++]=205,w[m++]=b>>8,w[m++]=b&255):(w[m++]=206,Z.setUint32(m,b),m+=4);else if(b>>0===b)b>=-32?w[m++]=256+b:b>=-128?(w[m++]=208,w[m++]=b+256):b>=-32768?(w[m++]=209,Z.setInt16(m,b),m+=2):(w[m++]=210,Z.setInt32(m,b),m+=4);else{let T;if((T=this.useFloat32)>0&&b<4294967296&&b>=-2147483648){w[m++]=202,Z.setFloat32(m,b);let R;if(T<4||(R=b*qt[(w[m]&127)<<1|w[m+1]>>7])>>0===R){m+=4;return}else m--}w[m++]=203,Z.setFloat64(m,b),m+=8}else if(P==="object"||P==="function")if(!b)w[m++]=192;else{if(l){let R=l.get(b);if(R){if(!R.id){let j=l.idsToInsert||(l.idsToInsert=[]);R.id=j.push(R)}w[m++]=214,w[m++]=112,Z.setUint32(m,R.id),m+=4;return}else l.set(b,{offset:m-n})}let T=b.constructor;if(T===Object)tt(b);else if(T===Array)Oe(b);else if(T===Map)if(this.mapAsEmptyObject)w[m++]=128;else{C=b.size,C<16?w[m++]=128|C:C<65536?(w[m++]=222,w[m++]=C>>8,w[m++]=C&255):(w[m++]=223,Z.setUint32(m,C),m+=4);for(let[R,j]of b)Q(R),Q(j)}else{for(let R=0,j=Vt.length;R<j;R++){let z=xn[R];if(b instanceof z){let U=Vt[R];if(U.write){U.type&&(w[m++]=212,w[m++]=U.type,w[m++]=0);let Ye=U.write.call(this,b);Ye===b?Array.isArray(b)?Oe(b):tt(b):Q(Ye);return}let q=w,K=Z,ye=m;w=null;let Te;try{Te=U.pack.call(this,b,Ye=>(w=q,q=null,m+=Ye,m>me&&Ae(m),{target:w,targetView:Z,position:m-Ye}),Q)}finally{q&&(w=q,Z=K,m=ye,me=w.length-10)}Te&&(Te.length+m>me&&Ae(Te.length+m),m=_i(Te,w,m,U.type));return}}if(Array.isArray(b))Oe(b);else{if(b.toJSON){const R=b.toJSON();if(R!==b)return Q(R)}if(P==="function")return Q(this.writeFunction&&this.writeFunction(b));tt(b)}}}else if(P==="boolean")w[m++]=b?195:194;else if(P==="bigint"){if(b<BigInt(1)<<BigInt(63)&&b>=-(BigInt(1)<<BigInt(63)))w[m++]=211,Z.setBigInt64(m,b);else if(b<BigInt(1)<<BigInt(64)&&b>0)w[m++]=207,Z.setBigUint64(m,b);else if(this.largeBigIntToFloat)w[m++]=203,Z.setFloat64(m,Number(b));else{if(this.largeBigIntToString)return Q(b.toString());if(this.useBigIntExtension&&b<BigInt(2)**BigInt(1023)&&b>-(BigInt(2)**BigInt(1023))){w[m++]=199,m++,w[m++]=66;let T=[],R;do{let j=b&BigInt(255);R=(j&BigInt(128))===(b<BigInt(0)?BigInt(128):BigInt(0)),T.push(j),b>>=BigInt(8)}while(!((b===BigInt(0)||b===BigInt(-1))&&R));w[m-2]=T.length;for(let j=T.length;j>0;)w[m++]=Number(T[--j]);return}else throw new RangeError(b+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}m+=8}else if(P==="undefined")this.encodeUndefinedAsNil?w[m++]=192:(w[m++]=212,w[m++]=0,w[m++]=0);else throw new Error("Unknown type: "+P)},Ke=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?b=>{let P;if(this.skipValues){P=[];for(let R in b)(typeof b.hasOwnProperty!="function"||b.hasOwnProperty(R))&&!this.skipValues.includes(b[R])&&P.push(R)}else P=Object.keys(b);let C=P.length;C<16?w[m++]=128|C:C<65536?(w[m++]=222,w[m++]=C>>8,w[m++]=C&255):(w[m++]=223,Z.setUint32(m,C),m+=4);let T;if(this.coercibleKeyAsNumber)for(let R=0;R<C;R++){T=P[R];let j=Number(T);Q(isNaN(j)?T:j),Q(b[T])}else for(let R=0;R<C;R++)Q(T=P[R]),Q(b[T])}:b=>{w[m++]=222;let P=m-n;m+=2;let C=0;for(let T in b)(typeof b.hasOwnProperty!="function"||b.hasOwnProperty(T))&&(Q(T),Q(b[T]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');w[P+++n]=C>>8,w[P+n]=C&255},$e=this.useRecords===!1?Ke:t.progressiveRecords&&!k?b=>{let P,C=f.transitions||(f.transitions=Object.create(null)),T=m++-n,R;for(let j in b)if(typeof b.hasOwnProperty!="function"||b.hasOwnProperty(j)){if(P=C[j],P)C=P;else{let z=Object.keys(b),U=C;C=f.transitions;let q=0;for(let K=0,ye=z.length;K<ye;K++){let Te=z[K];P=C[Te],P||(P=C[Te]=Object.create(null),q++),C=P}T+n+1==m?(m--,It(C,z,q)):ht(C,z,T,q),R=!0,C=U[j]}Q(b[j])}if(!R){let j=C[ct];j?w[T+n]=j:ht(C,Object.keys(b),T,0)}}:b=>{let P,C=f.transitions||(f.transitions=Object.create(null)),T=0;for(let j in b)(typeof b.hasOwnProperty!="function"||b.hasOwnProperty(j))&&(P=C[j],P||(P=C[j]=Object.create(null),T++),C=P);let R=C[ct];R?R>=96&&k?(w[m++]=((R-=96)&31)+96,w[m++]=R>>5):w[m++]=R:It(C,C.__keys__||Object.keys(b),T);for(let j in b)(typeof b.hasOwnProperty!="function"||b.hasOwnProperty(j))&&Q(b[j])},et=typeof this.useRecords=="function"&&this.useRecords,tt=et?b=>{et(b)?$e(b):Ke(b)}:$e,Ae=b=>{let P;if(b>16777216){if(b-n>dr)throw new Error("Packed buffer would be larger than maximum buffer size");P=Math.min(dr,Math.round(Math.max((b-n)*(b>67108864?1.25:2),4194304)/4096)*4096)}else P=(Math.max(b-n<<2,w.length-1)>>12)+1<<12;let C=new Pt(P);return Z=C.dataView||(C.dataView=new DataView(C.buffer,0,P)),b=Math.min(b,w.length),w.copy?w.copy(C,0,n,b):C.set(w.slice(n,b)),m-=n,n=0,me=C.length-10,w=C},It=(b,P,C)=>{let T=f.nextId;T||(T=64),T<W&&this.shouldShareStructure&&!this.shouldShareStructure(P)?(T=f.nextOwnId,T<te||(T=W),f.nextOwnId=T+1):(T>=te&&(T=W),f.nextId=T+1);let R=P.highByte=T>=96&&k?T-96>>5:-1;b[ct]=T,b.__keys__=P,f[T-64]=P,T<W?(P.isShared=!0,f.sharedLength=T-63,o=!0,R>=0?(w[m++]=(T&31)+96,w[m++]=R):w[m++]=T):(R>=0?(w[m++]=213,w[m++]=114,w[m++]=(T&31)+96,w[m++]=R):(w[m++]=212,w[m++]=114,w[m++]=T),C&&(X+=se*C),V.length>=E&&(V.shift()[ct]=0),V.push(b),Q(P))},ht=(b,P,C,T)=>{let R=w,j=m,z=me,U=n;w=wt,m=0,n=0,w||(wt=w=new Pt(8192)),me=w.length-10,It(b,P,T),wt=w;let q=m;if(w=R,m=j,me=z,n=U,q>1){let K=m+q-1;K>me&&Ae(K);let ye=C+n;w.copyWithin(ye+q,ye+1,m),w.set(wt.slice(0,q),ye),m=K}else w[C+n]=wt[0]},xt=b=>{let P=Si(b,w,n,m,f,Ae,(C,T,R)=>{if(R)return o=!0;m=T;let j=w;return Q(C),pe(),j!==w?{position:m,targetView:Z,target:w}:m},this);if(P===0)return tt(b);m=P}}useBuffer(t){w=t,w.dataView||(w.dataView=new DataView(w.buffer,w.byteOffset,w.byteLength)),m=0}set position(t){m=t}get position(){return m}set buffer(t){w=t}get buffer(){return w}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}xn=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Zr];Vt=[{pack(i,t,n){let o=i.getTime()/1e3;if((this.useTimestamp32||i.getMilliseconds()===0)&&o>=0&&o<4294967296){let{target:f,targetView:l,position:g}=t(6);f[g++]=214,f[g++]=255,l.setUint32(g,o)}else if(o>0&&o<4294967296){let{target:f,targetView:l,position:g}=t(10);f[g++]=215,f[g++]=255,l.setUint32(g,i.getMilliseconds()*4e6+(o/1e3/4294967296>>0)),l.setUint32(g+4,o)}else if(isNaN(o)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:f,targetView:l,position:g}=t(3);f[g++]=212,f[g++]=255,f[g++]=255}else{let{target:f,targetView:l,position:g}=t(15);f[g++]=199,f[g++]=12,f[g++]=255,l.setUint32(g,i.getMilliseconds()*1e6),l.setBigInt64(g+4,BigInt(Math.floor(o)))}}},{pack(i,t,n){if(this.setAsEmptyObject)return t(0),n({});let o=Array.from(i),{target:f,position:l}=t(this.moreTypes?3:0);this.moreTypes&&(f[l++]=212,f[l++]=115,f[l++]=0),n(o)}},{pack(i,t,n){let{target:o,position:f}=t(this.moreTypes?3:0);this.moreTypes&&(o[f++]=212,o[f++]=101,o[f++]=0),n([i.name,i.message,i.cause])}},{pack(i,t,n){let{target:o,position:f}=t(this.moreTypes?3:0);this.moreTypes&&(o[f++]=212,o[f++]=120,o[f++]=0),n([i.source,i.flags])}},{pack(i,t){this.moreTypes?gr(i,16,t):mr(Yt?Buffer.from(i):new Uint8Array(i),t)}},{pack(i,t){let n=i.constructor;n!==as&&this.moreTypes?gr(i,rs.indexOf(n.name),t):mr(i,t)}},{pack(i,t){let{target:n,position:o}=t(1);n[o]=193}}];function gr(i,t,n,o){let f=i.byteLength;if(f+1<256){var{target:l,position:g}=n(4+f);l[g++]=199,l[g++]=f+1}else if(f+1<65536){var{target:l,position:g}=n(5+f);l[g++]=200,l[g++]=f+1>>8,l[g++]=f+1&255}else{var{target:l,position:g,targetView:O}=n(7+f);l[g++]=201,O.setUint32(g,f+1),g+=4}l[g++]=116,l[g++]=t,i.buffer||(i=new Uint8Array(i)),l.set(new Uint8Array(i.buffer,i.byteOffset,i.byteLength),g)}function mr(i,t){let n=i.byteLength;var o,f;if(n<256){var{target:o,position:f}=t(n+2);o[f++]=196,o[f++]=n}else if(n<65536){var{target:o,position:f}=t(n+3);o[f++]=197,o[f++]=n>>8,o[f++]=n&255}else{var{target:o,position:f,targetView:l}=t(n+5);o[f++]=198,l.setUint32(f,n),f+=4}o.set(i,f)}function _i(i,t,n,o){let f=i.length;switch(f){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:f<256?(t[n++]=199,t[n++]=f):f<65536?(t[n++]=200,t[n++]=f>>8,t[n++]=f&255):(t[n++]=201,t[n++]=f>>24,t[n++]=f>>16&255,t[n++]=f>>8&255,t[n++]=f&255)}return t[n++]=o,t.set(i,n),n+=f,n}function vi(i,t){let n,o=t.length*6,f=i.length-o;for(;n=t.pop();){let l=n.offset,g=n.id;i.copyWithin(l+o,l,f),o-=6;let O=l+o;i[O++]=214,i[O++]=105,i[O++]=g>>24,i[O++]=g>>16&255,i[O++]=g>>8&255,i[O++]=g&255,f=l}return i}function pr(i,t,n){if(ee.length>0){Z.setUint32(ee.position+i,m+n-ee.position-i),ee.stringsPosition=m-i;let o=ee;ee=null,t(o[0]),t(o[1])}}function Ri(i){if(i.Class){if(!i.pack&&!i.write)throw new Error("Extension has no pack or write function");if(i.pack&&!i.type)throw new Error("Extension has no type (numeric code to identify the extension)");xn.unshift(i.Class),Vt.unshift(i)}wi(i)}function Ci(i,t){return i.isCompatible=n=>{let o=!n||(t.lastNamedStructuresLength||0)===n.length;return o||t._mergeStructures(n),o},i}let fs=new Ot({useRecords:!1});const $i=fs.pack,Di=fs.pack,Pi=Ot,{NEVER:Ni,ALWAYS:ki,DECIMAL_ROUND:Mi,DECIMAL_FIT:Bi}=is,cs=512,ls=1024,hs=2048;function Li(i,t={}){if(!i||typeof i!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof i[Symbol.iterator]=="function")return Fi(i,t);if(typeof i.then=="function"||typeof i[Symbol.asyncIterator]=="function")return ji(i,t);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Fi(i,t){const n=new Ot(t);for(const o of i)yield n.pack(o)}async function*ji(i,t){const n=new Ot(t);for await(const o of i)yield n.pack(o)}function Ui(i,t={}){if(!i||typeof i!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const n=new qe(t);let o;const f=l=>{let g;o&&(l=Buffer.concat([o,l]),o=void 0);try{g=n.unpackMultiple(l)}catch(O){if(O.incomplete)o=l.slice(O.lastPosition),g=O.values;else throw O}return g};if(typeof i[Symbol.iterator]=="function")return function*(){for(const g of i)yield*f(g)}();if(typeof i[Symbol.asyncIterator]=="function")return async function*(){for await(const g of i)yield*f(g)}()}const Vi=Ui,zi=Li,Hi=!1,Wi=!0,Ji=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:ki,C1:bn,DECIMAL_FIT:Bi,DECIMAL_ROUND:Mi,Decoder:Ei,Encoder:Pi,FLOAT32_OPTIONS:is,NEVER:Ni,Packr:Ot,RESERVE_START_SPACE:hs,RESET_BUFFER_MODE:ls,REUSE_BUFFER_MODE:cs,Unpackr:qe,addExtension:Ri,clearSource:Ut,decode:Ii,decodeIter:Vi,encode:Di,encodeIter:zi,isNativeAccelerationEnabled:gi,mapsAsObjects:Wi,pack:$i,roundFloat32:xi,unpack:bi,unpackMultiple:Oi,useRecords:Hi},Symbol.toStringTag,{value:"Module"})),qi=un(Ji);var Ki=Jr,Ie=yn,yr=Wt,Yi=wn,Nt=En,ue=pn,Gi=Jt,wr=Et,Er=qi;let Zi=class us{constructor(t,n){this.onStateChange=Nt.createSignal(),this.onError=Nt.createSignal(),this.onLeave=Nt.createSignal(),this.onJoin=Nt.createSignal(),this.hasJoined=!1,this.onMessageHandlers=Yi.createNanoEvents(),this.roomId=null,this.name=t,this.packr=new Er.Packr,this.packr.encode(void 0),n&&(this.serializer=new(yr.getSerializer("schema")),this.rootSchema=n,this.serializer.state=new n),this.onError((o,f)=>{var l;return(l=console.warn)===null||l===void 0?void 0:l.call(console,`colyseus.js - onError => (${o}) ${f}`)}),this.onLeave(()=>this.removeAllListeners())}connect(t,n,o=this,f,l){const g=new Ki.Connection(f.protocol);if(o.connection=g,g.events.onmessage=us.prototype.onMessageCallback.bind(o),g.events.onclose=function(O){var N;if(!o.hasJoined){(N=console.warn)===null||N===void 0||N.call(console,`Room connection was closed unexpectedly (${O.code}): ${O.reason}`),o.onError.invoke(O.code,O.reason);return}O.code===wr.CloseCode.DEVMODE_RESTART&&n?n():(o.onLeave.invoke(O.code,O.reason),o.destroy())},g.events.onerror=function(O){var N;(N=console.warn)===null||N===void 0||N.call(console,`Room, onError (${O.code}): ${O.reason}`),o.onError.invoke(O.code,O.reason)},f.protocol==="h3"){const O=new URL(t);g.connect(O.origin,f)}else g.connect(t,l)}leave(t=!0){return new Promise(n=>{this.onLeave(o=>n(o)),this.connection?t?(this.packr.buffer[0]=Ie.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(wr.CloseCode.CONSENTED)})}onMessage(t,n){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),n)}send(t,n){const o={offset:1};this.packr.buffer[0]=Ie.Protocol.ROOM_DATA,typeof t=="string"?ue.encode.string(this.packr.buffer,t,o):ue.encode.number(this.packr.buffer,t,o),this.packr.position=0;const f=n!==void 0?this.packr.pack(n,2048+o.offset):this.packr.buffer.subarray(0,o.offset);this.connection.send(f)}sendUnreliable(t,n){const o={offset:1};this.packr.buffer[0]=Ie.Protocol.ROOM_DATA,typeof t=="string"?ue.encode.string(this.packr.buffer,t,o):ue.encode.number(this.packr.buffer,t,o),this.packr.position=0;const f=n!==void 0?this.packr.pack(n,2048+o.offset):this.packr.buffer.subarray(0,o.offset);this.connection.sendUnreliable(f)}sendBytes(t,n){const o={offset:1};if(this.packr.buffer[0]=Ie.Protocol.ROOM_DATA_BYTES,typeof t=="string"?ue.encode.string(this.packr.buffer,t,o):ue.encode.number(this.packr.buffer,t,o),n.byteLength+o.offset>this.packr.buffer.byteLength){const f=new Uint8Array(o.offset+n.byteLength);f.set(this.packr.buffer),this.packr.useBuffer(f)}this.packr.buffer.set(n,o.offset),this.connection.send(this.packr.buffer.subarray(0,o.offset+n.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof Gi.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(t){const n=new Uint8Array(t.data),o={offset:1},f=n[0];if(f===Ie.Protocol.JOIN_ROOM){const l=ue.decode.utf8Read(n,o,n[o.offset++]);if(this.serializerId=ue.decode.utf8Read(n,o,n[o.offset++]),!this.serializer){const g=yr.getSerializer(this.serializerId);this.serializer=new g}n.byteLength>o.offset&&this.serializer.handshake&&this.serializer.handshake(n,o),this.reconnectionToken=`${this.roomId}:${l}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=Ie.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(f===Ie.Protocol.ERROR){const l=ue.decode.number(n,o),g=ue.decode.string(n,o);this.onError.invoke(l,g)}else if(f===Ie.Protocol.LEAVE_ROOM)this.leave();else if(f===Ie.Protocol.ROOM_STATE)this.serializer.setState(n,o),this.onStateChange.invoke(this.serializer.getState());else if(f===Ie.Protocol.ROOM_STATE_PATCH)this.serializer.patch(n,o),this.onStateChange.invoke(this.serializer.getState());else if(f===Ie.Protocol.ROOM_DATA){const l=ue.decode.stringCheck(n,o)?ue.decode.string(n,o):ue.decode.number(n,o),g=n.byteLength>o.offset?Er.unpack(n,{start:o.offset}):void 0;this.dispatchMessage(l,g)}else if(f===Ie.Protocol.ROOM_DATA_BYTES){const l=ue.decode.stringCheck(n,o)?ue.decode.string(n,o):ue.decode.number(n,o);this.dispatchMessage(l,n.subarray(o.offset))}}dispatchMessage(t,n){var o;const f=this.getMessageHandlerKey(t);this.onMessageHandlers.events[f]?this.onMessageHandlers.emit(f,n):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,n):(o=console.warn)===null||o===void 0||o.call(console,`colyseus.js: onMessage() not registered for type '${t}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(t){switch(typeof t){case"string":return t;case"number":return`i${t}`;default:throw new Error("invalid message type.")}}};mn.Room=Zi;var ds={};function br(i,t){t.headers=i.headers||{},t.statusMessage=i.statusText,t.statusCode=i.status,t.data=i.response}function Ce(i,t,n){return new Promise(function(o,f){n=n||{};var l=new XMLHttpRequest,g,O,N,_=n.body,L=n.headers||{};n.timeout&&(l.timeout=n.timeout),l.ontimeout=l.onerror=function(E){E.timeout=E.type=="timeout",f(E)},l.open(i,t.href||t),l.onload=function(){for(N=l.getAllResponseHeaders().trim().split(/[\r\n]+/),br(l,l);O=N.shift();)O=O.split(": "),l.headers[O.shift().toLowerCase()]=O.join(": ");if(O=l.headers["content-type"],O&&~O.indexOf("application/json"))try{l.data=JSON.parse(l.data,n.reviver)}catch(E){return br(l,E),f(E)}(l.status>=400?f:o)(l)},typeof FormData<"u"&&_ instanceof FormData||_&&typeof _=="object"&&(L["content-type"]="application/json",_=JSON.stringify(_)),l.withCredentials=!!n.withCredentials;for(g in L)l.setRequestHeader(g,L[g]);l.send(_)})}var Xi=Ce.bind(Ce,"GET"),Qi=Ce.bind(Ce,"POST"),eo=Ce.bind(Ce,"PATCH"),to=Ce.bind(Ce,"DELETE"),no=Ce.bind(Ce,"PUT");const ro=Object.freeze(Object.defineProperty({__proto__:null,del:to,get:Xi,patch:eo,post:Qi,put:no,send:Ce},Symbol.toStringTag,{value:"Module"})),so=un(ro);var io=Et,oo=so;function ao(i){var t=Object.create(null);return i&&Object.keys(i).forEach(function(n){if(n!=="default"){var o=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return i[n]}})}}),t.default=i,Object.freeze(t)}var fo=ao(oo);let co=class{constructor(t,n={}){this.client=t,this.headers=n}get(t,n={}){return this.request("get",t,n)}post(t,n={}){return this.request("post",t,n)}del(t,n={}){return this.request("del",t,n)}put(t,n={}){return this.request("put",t,n)}request(t,n,o={}){return fo[t](this.client.getHttpEndpoint(n),this.getOptions(o)).catch(f=>{var l;const g=f.statusCode,O=((l=f.data)===null||l===void 0?void 0:l.error)||f.statusMessage||f.message;throw!g&&!O?f:new io.ServerError(g,O)})}getOptions(t){return t.headers=Object.assign({},this.headers,t.headers),this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(t.withCredentials=!0),t}};ds.HTTP=co;var Sn={},Gt={},Or=Ht;let Qe;function An(){if(!Qe)try{Qe=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!Qe&&typeof globalThis.indexedDB<"u"&&(Qe=new go),Qe||(Qe={cache:{},setItem:function(i,t){this.cache[i]=t},getItem:function(i){this.cache[i]},removeItem:function(i){delete this.cache[i]}}),Qe}function lo(i,t){An().setItem(i,t)}function ho(i){An().removeItem(i)}function uo(i,t){const n=An().getItem(i);typeof Promise>"u"||!(n instanceof Promise)?t(n):n.then(o=>t(o))}class go{constructor(){this.dbPromise=new Promise(t=>{const n=indexedDB.open("_colyseus_storage",1);n.onupgradeneeded=()=>n.result.createObjectStore("store"),n.onsuccess=()=>t(n.result)})}tx(t,n){return Or.__awaiter(this,void 0,void 0,function*(){const f=(yield this.dbPromise).transaction("store",t).objectStore("store");return n(f)})}setItem(t,n){return this.tx("readwrite",o=>o.put(n,t)).then()}getItem(t){return Or.__awaiter(this,void 0,void 0,function*(){const n=yield this.tx("readonly",o=>o.get(t));return new Promise(o=>{n.onsuccess=()=>o(n.result)})})}removeItem(t){return this.tx("readwrite",n=>n.delete(t)).then()}}Gt.getItem=uo;Gt.removeItem=ho;Gt.setItem=lo;var ae=Ht,sn=Gt,mo=wn,Bt,hn,He,Lt;let po=class{constructor(t){this.http=t,this.settings={path:"/auth",key:"colyseus-auth-token"},Bt.set(this,!1),hn.set(this,void 0),He.set(this,void 0),Lt.set(this,mo.createNanoEvents()),sn.getItem(this.settings.key,n=>this.token=n)}set token(t){this.http.authToken=t}get token(){return this.http.authToken}onChange(t){const n=ae.__classPrivateFieldGet(this,Lt,"f").on("change",t);return ae.__classPrivateFieldGet(this,Bt,"f")||ae.__classPrivateFieldSet(this,hn,new Promise((o,f)=>{this.getUserData().then(l=>{this.emitChange(Object.assign(Object.assign({},l),{token:this.token}))}).catch(l=>{this.emitChange({user:null,token:void 0})}).finally(()=>{o()})}),"f"),ae.__classPrivateFieldSet(this,Bt,!0,"f"),n}getUserData(){return ae.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(t,n,o){return ae.__awaiter(this,void 0,void 0,function*(){const f=(yield this.http.post(`${this.settings.path}/register`,{body:{email:t,password:n,options:o}})).data;return this.emitChange(f),f})}signInWithEmailAndPassword(t,n){return ae.__awaiter(this,void 0,void 0,function*(){const o=(yield this.http.post(`${this.settings.path}/login`,{body:{email:t,password:n}})).data;return this.emitChange(o),o})}signInAnonymously(t){return ae.__awaiter(this,void 0,void 0,function*(){const n=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:t}})).data;return this.emitChange(n),n})}sendPasswordResetEmail(t){return ae.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:t}})).data})}signInWithProvider(t){return ae.__awaiter(this,arguments,void 0,function*(n,o={}){return new Promise((f,l)=>{const g=o.width||480,O=o.height||768,N=this.token?`?token=${this.token}`:"",_=`Login with ${n[0].toUpperCase()+n.substring(1)}`,L=this.http.client.getHttpEndpoint(`${o.prefix||`${this.settings.path}/provider`}/${n}${N}`),E=screen.width/2-g/2,k=screen.height/2-O/2;ae.__classPrivateFieldSet(this,He,window.open(L,_,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+g+", height="+O+", top="+k+", left="+E),"f");const W=V=>{V.data.user===void 0&&V.data.token===void 0||(clearInterval(te),ae.__classPrivateFieldGet(this,He,"f").close(),ae.__classPrivateFieldSet(this,He,void 0,"f"),window.removeEventListener("message",W),V.data.error!==void 0?l(V.data.error):(f(V.data),this.emitChange(V.data)))},te=setInterval(()=>{(!ae.__classPrivateFieldGet(this,He,"f")||ae.__classPrivateFieldGet(this,He,"f").closed)&&(ae.__classPrivateFieldSet(this,He,void 0,"f"),l("cancelled"),window.removeEventListener("message",W))},200);window.addEventListener("message",W)})})}signOut(){return ae.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(t){t.token!==void 0&&(this.token=t.token,t.token===null?sn.removeItem(this.settings.key):sn.setItem(this.settings.key,t.token)),ae.__classPrivateFieldGet(this,Lt,"f").emit("change",t)}};Bt=new WeakMap,hn=new WeakMap,He=new WeakMap,Lt=new WeakMap;Sn.Auth=po;var gs={};function yo(i){var t;const n=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.hostname)||"localhost",o=i.hostname.split("."),f=!i.hostname.includes("trycloudflare.com")&&!i.hostname.includes("discordsays.com")&&o.length>2?`/${o[0]}`:"";return i.pathname.startsWith("/.proxy")?`${i.protocol}//${n}${f}${i.pathname}${i.search}`:`${i.protocol}//${n}/.proxy/colyseus${f}${i.pathname}${i.search}`}gs.discordURLBuilder=yo;var Le=Ht,wo=Et,Eo=mn,bo=ds,Oo=Sn,Io=gs,on;class Zt extends Error{constructor(t,n){super(t),this.code=n,this.name="MatchMakeError",Object.setPrototypeOf(this,Zt.prototype)}}const Ir=typeof window<"u"&&typeof((on=window==null?void 0:window.location)===null||on===void 0?void 0:on.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class ms{constructor(t=Ir,n){var o,f;if(typeof t=="string"){const l=t.startsWith("/")?new URL(t,Ir):new URL(t),g=l.protocol==="https:"||l.protocol==="wss:",O=Number(l.port||(g?443:80));this.settings={hostname:l.hostname,pathname:l.pathname,port:O,secure:g}}else t.port===void 0&&(t.port=t.secure?443:80),t.pathname===void 0&&(t.pathname=""),this.settings=t;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new bo.HTTP(this,(n==null?void 0:n.headers)||{}),this.auth=new Oo.Auth(this.http),this.urlBuilder=n==null?void 0:n.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((f=(o=window==null?void 0:window.location)===null||o===void 0?void 0:o.hostname)===null||f===void 0)&&f.includes("discordsays.com"))&&(this.urlBuilder=Io.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(t){return Le.__awaiter(this,arguments,void 0,function*(n,o={},f){return yield this.createMatchMakeRequest("joinOrCreate",n,o,f)})}create(t){return Le.__awaiter(this,arguments,void 0,function*(n,o={},f){return yield this.createMatchMakeRequest("create",n,o,f)})}join(t){return Le.__awaiter(this,arguments,void 0,function*(n,o={},f){return yield this.createMatchMakeRequest("join",n,o,f)})}joinById(t){return Le.__awaiter(this,arguments,void 0,function*(n,o={},f){return yield this.createMatchMakeRequest("joinById",n,o,f)})}reconnect(t,n){return Le.__awaiter(this,void 0,void 0,function*(){if(typeof t=="string"&&typeof n=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[o,f]=t.split(":");if(!o||!f)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",o,{reconnectionToken:f},n)})}consumeSeatReservation(t,n,o){return Le.__awaiter(this,void 0,void 0,function*(){const f=this.createRoom(t.room.name,n);f.roomId=t.room.roomId,f.sessionId=t.sessionId;const l={sessionId:f.sessionId};t.reconnectionToken&&(l.reconnectionToken=t.reconnectionToken);const g=o||f;return f.connect(this.buildEndpoint(t.room,l,t.protocol),t.devMode&&(()=>Le.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${f.roomId}'...`);let O=0,N=8;const _=()=>Le.__awaiter(this,void 0,void 0,function*(){O++;try{yield this.consumeSeatReservation(t,n,g),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${f.roomId}'`)}catch{O<N?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${O} out of ${N})`),setTimeout(_,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(_,2e3)})),g,t,this.http.headers),new Promise((O,N)=>{const _=(L,E)=>N(new wo.ServerError(L,E));g.onError.once(_),g.onJoin.once(()=>{g.onError.remove(_),O(g)})})})}createMatchMakeRequest(t,n){return Le.__awaiter(this,arguments,void 0,function*(o,f,l={},g,O){const N=(yield this.http.post(`matchmake/${o}/${f}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)})).data;if(N.error)throw new Zt(N.error,N.code);return o==="reconnect"&&(N.reconnectionToken=l.reconnectionToken),yield this.consumeSeatReservation(N,g,O)})}createRoom(t,n){return new Eo.Room(t,n)}buildEndpoint(t,n={},o="ws"){const f=[];this.http.authToken&&(n._authToken=this.http.authToken);for(const O in n)n.hasOwnProperty(O)&&f.push(`${O}=${n[O]}`);o==="h3"&&(o="http");let l=this.settings.secure?`${o}s://`:`${o}://`;t.publicAddress?l+=`${t.publicAddress}`:l+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const g=`${l}/${t.processId}/${t.roomId}?${f.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(g)):g}getHttpEndpoint(t=""){const n=t.startsWith("/")?t:`/${t}`,o=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${n}`;return this.urlBuilder?this.urlBuilder(new URL(o)):o}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}ms.VERSION="0.16.16";dn.Client=ms;dn.MatchMakeError=Zt;var ps={};class xo{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}}ps.NoneSerializer=xo;(function(i){var t=dn,n=yn,o=mn,f=Sn,l=Et,g=Jt,O=ps,N=Wt;N.registerSerializer("schema",g.SchemaSerializer),N.registerSerializer("none",O.NoneSerializer),i.Client=t.Client,i.MatchMakeError=t.MatchMakeError,Object.defineProperty(i,"ErrorCode",{enumerable:!0,get:function(){return n.ErrorCode}}),Object.defineProperty(i,"Protocol",{enumerable:!0,get:function(){return n.Protocol}}),i.Room=o.Room,i.Auth=f.Auth,i.ServerError=l.ServerError,i.SchemaSerializer=g.SchemaSerializer,i.getStateCallbacks=g.getStateCallbacks,i.registerSerializer=N.registerSerializer})(Vs);export{Vs as c};
