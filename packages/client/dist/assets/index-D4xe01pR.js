import{P as os,c as Aa,g as Ia,p as dr}from"./phaser-B90dPXin.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const pt=class pt{constructor(e){const t=e.width,r=e.height;pt.width=t,pt.height=r,pt.center=new os.Math.Vector2(t/2,r/2),pt.isLandscape=pt.width>pt.height,pt.gameZone=new os.Geom.Rectangle(0,0,t,r),pt.uiZone=new os.Geom.Rectangle(0,0,t,r),pt.cameras=new Set,e.callbacks={postBoot:()=>this.gameBootHandler()},this.game=new os.Game(e)}gameBootHandler(){pt.scaleManager=this.game.scale,pt.scaleManager.on("resize",()=>this.onResizeHandler()),this.canvas=this.game.canvas,this.parent=this.canvas.parentElement,this.guide=document.getElementById("guide"),window.setTimeout(()=>this.onResizeHandler(),16)}onResizeHandler(){const e=this.parent.getBoundingClientRect(),t=this.canvas.getBoundingClientRect(),r=this.guide.getBoundingClientRect(),i=e.width/pt.width,s=e.height/pt.height,c=Math.max(i,s),u=e.width-i,v=e.height-s,g=u*(1/c),p=v*(1/c),y=pt.width/2-g/2,O=pt.width/2+g/2,V=pt.height/2-p/2,X=pt.height/2+p/2;pt.uiZone.left=y,pt.uiZone.right=O,pt.uiZone.top=V,pt.uiZone.bottom=X;const Z=r.width/t.width,z=r.height/t.height,me=Math.min(Z,z);pt.scaleFactor=me,pt.cameras.forEach(le=>{le.zoom=me}),this.game.events.emit(pt.RESIZE)}static addCamera(e){this.cameras.add(e),e.zoom=pt.scaleFactor}static removeCamera(e){this.cameras.delete(e)}static getX(e){if(typeof e=="number")return e;const t=this.scaleManager.width,r=parseInt(e,10);return t*(r/100)}static getY(e){if(typeof e=="number")return e;const t=this.scaleManager.height,r=parseInt(e,10);return t*(r/100)}static getUIX(e){if(typeof e=="number")return e;const t=pt.uiZone.width,r=parseInt(e,10);return t*(r/100)}static getUIY(e){if(typeof e=="number")return e;const t=pt.uiZone.height,r=parseInt(e,10);return t*(r/100)}};pt.scaleFactor=1,pt.scaleFactor2=1,pt.RESIZE="scaleflowresize";let fa=pt;var ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oa(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Mo={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(v,g,p){this.fn=v,this.context=g,this.once=p||!1}function s(v,g,p,y,O){if(typeof p!="function")throw new TypeError("The listener must be a function");var V=new i(p,y||v,O),X=t?t+g:g;return v._events[X]?v._events[X].fn?v._events[X]=[v._events[X],V]:v._events[X].push(V):(v._events[X]=V,v._eventsCount++),v}function c(v,g){--v._eventsCount===0?v._events=new r:delete v._events[g]}function u(){this._events=new r,this._eventsCount=0}u.prototype.eventNames=function(){var g=[],p,y;if(this._eventsCount===0)return g;for(y in p=this._events)e.call(p,y)&&g.push(t?y.slice(1):y);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(p)):g},u.prototype.listeners=function(g){var p=t?t+g:g,y=this._events[p];if(!y)return[];if(y.fn)return[y.fn];for(var O=0,V=y.length,X=new Array(V);O<V;O++)X[O]=y[O].fn;return X},u.prototype.listenerCount=function(g){var p=t?t+g:g,y=this._events[p];return y?y.fn?1:y.length:0},u.prototype.emit=function(g,p,y,O,V,X){var Z=t?t+g:g;if(!this._events[Z])return!1;var z=this._events[Z],me=arguments.length,le,ve;if(z.fn){switch(z.once&&this.removeListener(g,z.fn,void 0,!0),me){case 1:return z.fn.call(z.context),!0;case 2:return z.fn.call(z.context,p),!0;case 3:return z.fn.call(z.context,p,y),!0;case 4:return z.fn.call(z.context,p,y,O),!0;case 5:return z.fn.call(z.context,p,y,O,V),!0;case 6:return z.fn.call(z.context,p,y,O,V,X),!0}for(ve=1,le=new Array(me-1);ve<me;ve++)le[ve-1]=arguments[ve];z.fn.apply(z.context,le)}else{var Le=z.length,ut;for(ve=0;ve<Le;ve++)switch(z[ve].once&&this.removeListener(g,z[ve].fn,void 0,!0),me){case 1:z[ve].fn.call(z[ve].context);break;case 2:z[ve].fn.call(z[ve].context,p);break;case 3:z[ve].fn.call(z[ve].context,p,y);break;case 4:z[ve].fn.call(z[ve].context,p,y,O);break;default:if(!le)for(ut=1,le=new Array(me-1);ut<me;ut++)le[ut-1]=arguments[ut];z[ve].fn.apply(z[ve].context,le)}}return!0},u.prototype.on=function(g,p,y){return s(this,g,p,y,!1)},u.prototype.once=function(g,p,y){return s(this,g,p,y,!0)},u.prototype.removeListener=function(g,p,y,O){var V=t?t+g:g;if(!this._events[V])return this;if(!p)return c(this,V),this;var X=this._events[V];if(X.fn)X.fn===p&&(!O||X.once)&&(!y||X.context===y)&&c(this,V);else{for(var Z=0,z=[],me=X.length;Z<me;Z++)(X[Z].fn!==p||O&&!X[Z].once||y&&X[Z].context!==y)&&z.push(X[Z]);z.length?this._events[V]=z.length===1?z[0]:z:c(this,V)}return this},u.prototype.removeAllListeners=function(g){var p;return g?(p=t?t+g:g,this._events[p]&&c(this,p)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,n.exports=u})(Mo);var Pc=Mo.exports,Uo=Oa(Pc),dt;(function(n){n.assertEqual=i=>i;function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const s={};for(const c of i)s[c]=c;return s},n.getValidEnumValues=i=>{const s=n.objectKeys(i).filter(u=>typeof i[i[u]]!="number"),c={};for(const u of s)c[u]=i[u];return n.objectValues(c)},n.objectValues=i=>n.objectKeys(i).map(function(s){return i[s]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const c in i)Object.prototype.hasOwnProperty.call(i,c)&&s.push(c);return s},n.find=(i,s)=>{for(const c of i)if(s(c))return c},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(c=>typeof c=="string"?`'${c}'`:c).join(s)}n.joinValues=r,n.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(dt||(dt={}));var ha;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(ha||(ha={}));const ye=dt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Hr=n=>{switch(typeof n){case"undefined":return ye.undefined;case"string":return ye.string;case"number":return isNaN(n)?ye.nan:ye.number;case"boolean":return ye.boolean;case"function":return ye.function;case"bigint":return ye.bigint;case"symbol":return ye.symbol;case"object":return Array.isArray(n)?ye.array:n===null?ye.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?ye.promise:typeof Map<"u"&&n instanceof Map?ye.map:typeof Set<"u"&&n instanceof Set?ye.set:typeof Date<"u"&&n instanceof Date?ye.date:ye.object;default:return ye.unknown}},ie=dt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),kc=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class Rn extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(s){return s.message},r={_errors:[]},i=s=>{for(const c of s.issues)if(c.code==="invalid_union")c.unionErrors.map(i);else if(c.code==="invalid_return_type")i(c.returnTypeError);else if(c.code==="invalid_arguments")i(c.argumentsError);else if(c.path.length===0)r._errors.push(t(c));else{let u=r,v=0;for(;v<c.path.length;){const g=c.path[v];v===c.path.length-1?(u[g]=u[g]||{_errors:[]},u[g]._errors.push(t(c))):u[g]=u[g]||{_errors:[]},u=u[g],v++}}};return i(this),r}static assert(e){if(!(e instanceof Rn))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,dt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Rn.create=n=>new Rn(n);const _i=(n,e)=>{let t;switch(n.code){case ie.invalid_type:n.received===ye.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case ie.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,dt.jsonStringifyReplacer)}`;break;case ie.unrecognized_keys:t=`Unrecognized key(s) in object: ${dt.joinValues(n.keys,", ")}`;break;case ie.invalid_union:t="Invalid input";break;case ie.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${dt.joinValues(n.options)}`;break;case ie.invalid_enum_value:t=`Invalid enum value. Expected ${dt.joinValues(n.options)}, received '${n.received}'`;break;case ie.invalid_arguments:t="Invalid function arguments";break;case ie.invalid_return_type:t="Invalid function return type";break;case ie.invalid_date:t="Invalid date";break;case ie.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:dt.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case ie.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case ie.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case ie.custom:t="Invalid input";break;case ie.invalid_intersection_types:t="Intersection results could not be merged";break;case ie.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case ie.not_finite:t="Number must be finite";break;default:t=e.defaultError,dt.assertNever(n)}return{message:t}};let Fo=_i;function $c(n){Fo=n}function bs(){return Fo}const Es=n=>{const{data:e,path:t,errorMaps:r,issueData:i}=n,s=[...t,...i.path||[]],c={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let u="";const v=r.filter(g=>!!g).slice().reverse();for(const g of v)u=g(c,{data:e,defaultError:u}).message;return{...i,path:s,message:u}},Lc=[];function ge(n,e){const t=bs(),r=Es({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===_i?void 0:_i].filter(i=>!!i)});n.common.issues.push(r)}class fn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const i of t){if(i.status==="aborted")return Fe;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const i of t){const s=await i.key,c=await i.value;r.push({key:s,value:c})}return fn.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const i of t){const{key:s,value:c}=i;if(s.status==="aborted"||c.status==="aborted")return Fe;s.status==="dirty"&&e.dirty(),c.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof c.value<"u"||i.alwaysSet)&&(r[s.value]=c.value)}return{status:e.value,value:r}}}const Fe=Object.freeze({status:"aborted"}),bi=n=>({status:"dirty",value:n}),En=n=>({status:"valid",value:n}),da=n=>n.status==="aborted",pa=n=>n.status==="dirty",$i=n=>n.status==="valid",Li=n=>typeof Promise<"u"&&n instanceof Promise;function _s(n,e,t,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function Vo(n,e,t,r,i){if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var Ne;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Ne||(Ne={}));var Ni,Pi;class ur{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const ro=(n,e)=>{if($i(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Rn(n.common.issues);return this._error=t,this._error}}};function Xe(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:i}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(c,u)=>{var v,g;const{message:p}=n;return c.code==="invalid_enum_value"?{message:p??u.defaultError}:typeof u.data>"u"?{message:(v=p??r)!==null&&v!==void 0?v:u.defaultError}:c.code!=="invalid_type"?{message:u.defaultError}:{message:(g=p??t)!==null&&g!==void 0?g:u.defaultError}},description:i}}class et{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Hr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Hr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new fn,ctx:{common:e.parent.common,data:e.data,parsedType:Hr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Li(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const i={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Hr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return ro(i,s)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Hr(e)},i=this._parse({data:e,path:r.path,parent:r}),s=await(Li(i)?i:Promise.resolve(i));return ro(r,s)}refine(e,t){const r=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{const c=e(i),u=()=>s.addIssue({code:ie.custom,...r(i)});return typeof Promise<"u"&&c instanceof Promise?c.then(v=>v?!0:(u(),!1)):c?!0:(u(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new Yn({schema:this,typeName:Ue.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return cr.create(this,this._def)}nullable(){return Jr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Kn.create(this,this._def)}promise(){return Ti.create(this,this._def)}or(e){return Ui.create([this,e],this._def)}and(e){return Fi.create(this,e,this._def)}transform(e){return new Yn({...Xe(this._def),schema:this,typeName:Ue.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Zi({...Xe(this._def),innerType:this,defaultValue:t,typeName:Ue.ZodDefault})}brand(){return new xa({typeName:Ue.ZodBranded,type:this,...Xe(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new zi({...Xe(this._def),innerType:this,catchValue:t,typeName:Ue.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Yi.create(this,e)}readonly(){return Wi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Cc=/^c[^\s-]{8,}$/i,Bc=/^[0-9a-z]+$/,Mc=/^[0-9A-HJKMNP-TV-Z]{26}$/,Uc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Fc=/^[a-z0-9_-]{21}$/i,Vc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,jc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Hc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Js;const Gc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Zc=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,zc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,jo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Wc=new RegExp(`^${jo}$`);function Ho(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Kc(n){return new RegExp(`^${Ho(n)}$`)}function Go(n){let e=`${jo}T${Ho(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function qc(n,e){return!!((e==="v4"||!e)&&Gc.test(n)||(e==="v6"||!e)&&Zc.test(n))}class Wn extends et{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ye.string){const s=this._getOrReturnCtx(e);return ge(s,{code:ie.invalid_type,expected:ye.string,received:s.parsedType}),Fe}const r=new fn;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const c=e.data.length>s.value,u=e.data.length<s.value;(c||u)&&(i=this._getOrReturnCtx(e,i),c?ge(i,{code:ie.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):u&&ge(i,{code:ie.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")jc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"email",code:ie.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")Js||(Js=new RegExp(Hc,"u")),Js.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"emoji",code:ie.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Uc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"uuid",code:ie.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")Fc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"nanoid",code:ie.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")Cc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"cuid",code:ie.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")Bc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"cuid2",code:ie.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")Mc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"ulid",code:ie.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),ge(i,{validation:"url",code:ie.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"regex",code:ie.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?Go(s).test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?Wc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?Kc(s).test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?Vc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"duration",code:ie.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?qc(e.data,s.version)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"ip",code:ie.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?zc.test(e.data)||(i=this._getOrReturnCtx(e,i),ge(i,{validation:"base64",code:ie.invalid_string,message:s.message}),r.dirty()):dt.assertNever(s);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(i=>e.test(i),{validation:t,code:ie.invalid_string,...Ne.errToObj(r)})}_addCheck(e){return new Wn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Ne.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Ne.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Ne.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Ne.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Ne.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Ne.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Ne.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Ne.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Ne.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Ne.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...Ne.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Ne.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Ne.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Ne.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...Ne.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Ne.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Ne.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Ne.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Ne.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Ne.errToObj(t)})}nonempty(e){return this.min(1,Ne.errToObj(e))}trim(){return new Wn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Wn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Wn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Wn.create=n=>{var e;return new Wn({checks:[],typeName:Ue.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Xe(n)})};function Yc(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,s=parseInt(n.toFixed(i).replace(".","")),c=parseInt(e.toFixed(i).replace(".",""));return s%c/Math.pow(10,i)}class qr extends et{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ye.number){const s=this._getOrReturnCtx(e);return ge(s,{code:ie.invalid_type,expected:ye.number,received:s.parsedType}),Fe}let r;const i=new fn;for(const s of this._def.checks)s.kind==="int"?dt.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),ge(r,{code:ie.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),ge(r,{code:ie.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),ge(r,{code:ie.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?Yc(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),ge(r,{code:ie.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),ge(r,{code:ie.not_finite,message:s.message}),i.dirty()):dt.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Ne.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ne.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ne.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ne.toString(t))}setLimit(e,t,r,i){return new qr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Ne.toString(i)}]})}_addCheck(e){return new qr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Ne.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ne.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ne.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ne.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ne.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ne.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Ne.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ne.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ne.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&dt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}qr.create=n=>new qr({checks:[],typeName:Ue.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Xe(n)});class Yr extends et{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==ye.bigint){const s=this._getOrReturnCtx(e);return ge(s,{code:ie.invalid_type,expected:ye.bigint,received:s.parsedType}),Fe}let r;const i=new fn;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),ge(r,{code:ie.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),ge(r,{code:ie.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),ge(r,{code:ie.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):dt.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Ne.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ne.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ne.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ne.toString(t))}setLimit(e,t,r,i){return new Yr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Ne.toString(i)}]})}_addCheck(e){return new Yr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ne.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ne.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ne.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ne.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ne.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Yr.create=n=>{var e;return new Yr({checks:[],typeName:Ue.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Xe(n)})};class Ci extends et{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ye.boolean){const r=this._getOrReturnCtx(e);return ge(r,{code:ie.invalid_type,expected:ye.boolean,received:r.parsedType}),Fe}return En(e.data)}}Ci.create=n=>new Ci({typeName:Ue.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Xe(n)});class fi extends et{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ye.date){const s=this._getOrReturnCtx(e);return ge(s,{code:ie.invalid_type,expected:ye.date,received:s.parsedType}),Fe}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return ge(s,{code:ie.invalid_date}),Fe}const r=new fn;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),ge(i,{code:ie.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):dt.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new fi({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Ne.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Ne.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}fi.create=n=>new fi({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Ue.ZodDate,...Xe(n)});class ws extends et{_parse(e){if(this._getType(e)!==ye.symbol){const r=this._getOrReturnCtx(e);return ge(r,{code:ie.invalid_type,expected:ye.symbol,received:r.parsedType}),Fe}return En(e.data)}}ws.create=n=>new ws({typeName:Ue.ZodSymbol,...Xe(n)});class Bi extends et{_parse(e){if(this._getType(e)!==ye.undefined){const r=this._getOrReturnCtx(e);return ge(r,{code:ie.invalid_type,expected:ye.undefined,received:r.parsedType}),Fe}return En(e.data)}}Bi.create=n=>new Bi({typeName:Ue.ZodUndefined,...Xe(n)});class Mi extends et{_parse(e){if(this._getType(e)!==ye.null){const r=this._getOrReturnCtx(e);return ge(r,{code:ie.invalid_type,expected:ye.null,received:r.parsedType}),Fe}return En(e.data)}}Mi.create=n=>new Mi({typeName:Ue.ZodNull,...Xe(n)});class wi extends et{constructor(){super(...arguments),this._any=!0}_parse(e){return En(e.data)}}wi.create=n=>new wi({typeName:Ue.ZodAny,...Xe(n)});class ci extends et{constructor(){super(...arguments),this._unknown=!0}_parse(e){return En(e.data)}}ci.create=n=>new ci({typeName:Ue.ZodUnknown,...Xe(n)});class xr extends et{_parse(e){const t=this._getOrReturnCtx(e);return ge(t,{code:ie.invalid_type,expected:ye.never,received:t.parsedType}),Fe}}xr.create=n=>new xr({typeName:Ue.ZodNever,...Xe(n)});class Ts extends et{_parse(e){if(this._getType(e)!==ye.undefined){const r=this._getOrReturnCtx(e);return ge(r,{code:ie.invalid_type,expected:ye.void,received:r.parsedType}),Fe}return En(e.data)}}Ts.create=n=>new Ts({typeName:Ue.ZodVoid,...Xe(n)});class Kn extends et{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==ye.array)return ge(t,{code:ie.invalid_type,expected:ye.array,received:t.parsedType}),Fe;if(i.exactLength!==null){const c=t.data.length>i.exactLength.value,u=t.data.length<i.exactLength.value;(c||u)&&(ge(t,{code:c?ie.too_big:ie.too_small,minimum:u?i.exactLength.value:void 0,maximum:c?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(ge(t,{code:ie.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(ge(t,{code:ie.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((c,u)=>i.type._parseAsync(new ur(t,c,t.path,u)))).then(c=>fn.mergeArray(r,c));const s=[...t.data].map((c,u)=>i.type._parseSync(new ur(t,c,t.path,u)));return fn.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new Kn({...this._def,minLength:{value:e,message:Ne.toString(t)}})}max(e,t){return new Kn({...this._def,maxLength:{value:e,message:Ne.toString(t)}})}length(e,t){return new Kn({...this._def,exactLength:{value:e,message:Ne.toString(t)}})}nonempty(e){return this.min(1,e)}}Kn.create=(n,e)=>new Kn({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Ue.ZodArray,...Xe(e)});function vi(n){if(n instanceof Lt){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=cr.create(vi(r))}return new Lt({...n._def,shape:()=>e})}else return n instanceof Kn?new Kn({...n._def,type:vi(n.element)}):n instanceof cr?cr.create(vi(n.unwrap())):n instanceof Jr?Jr.create(vi(n.unwrap())):n instanceof fr?fr.create(n.items.map(e=>vi(e))):n}class Lt extends et{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=dt.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ye.object){const g=this._getOrReturnCtx(e);return ge(g,{code:ie.invalid_type,expected:ye.object,received:g.parsedType}),Fe}const{status:r,ctx:i}=this._processInputParams(e),{shape:s,keys:c}=this._getCached(),u=[];if(!(this._def.catchall instanceof xr&&this._def.unknownKeys==="strip"))for(const g in i.data)c.includes(g)||u.push(g);const v=[];for(const g of c){const p=s[g],y=i.data[g];v.push({key:{status:"valid",value:g},value:p._parse(new ur(i,y,i.path,g)),alwaysSet:g in i.data})}if(this._def.catchall instanceof xr){const g=this._def.unknownKeys;if(g==="passthrough")for(const p of u)v.push({key:{status:"valid",value:p},value:{status:"valid",value:i.data[p]}});else if(g==="strict")u.length>0&&(ge(i,{code:ie.unrecognized_keys,keys:u}),r.dirty());else if(g!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const g=this._def.catchall;for(const p of u){const y=i.data[p];v.push({key:{status:"valid",value:p},value:g._parse(new ur(i,y,i.path,p)),alwaysSet:p in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const g=[];for(const p of v){const y=await p.key,O=await p.value;g.push({key:y,value:O,alwaysSet:p.alwaysSet})}return g}).then(g=>fn.mergeObjectSync(r,g)):fn.mergeObjectSync(r,v)}get shape(){return this._def.shape()}strict(e){return Ne.errToObj,new Lt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,s,c,u;const v=(c=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,t,r).message)!==null&&c!==void 0?c:r.defaultError;return t.code==="unrecognized_keys"?{message:(u=Ne.errToObj(e).message)!==null&&u!==void 0?u:v}:{message:v}}}:{}})}strip(){return new Lt({...this._def,unknownKeys:"strip"})}passthrough(){return new Lt({...this._def,unknownKeys:"passthrough"})}extend(e){return new Lt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Lt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ue.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Lt({...this._def,catchall:e})}pick(e){const t={};return dt.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new Lt({...this._def,shape:()=>t})}omit(e){const t={};return dt.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new Lt({...this._def,shape:()=>t})}deepPartial(){return vi(this)}partial(e){const t={};return dt.objectKeys(this.shape).forEach(r=>{const i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}),new Lt({...this._def,shape:()=>t})}required(e){const t={};return dt.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof cr;)s=s._def.innerType;t[r]=s}}),new Lt({...this._def,shape:()=>t})}keyof(){return Zo(dt.objectKeys(this.shape))}}Lt.create=(n,e)=>new Lt({shape:()=>n,unknownKeys:"strip",catchall:xr.create(),typeName:Ue.ZodObject,...Xe(e)});Lt.strictCreate=(n,e)=>new Lt({shape:()=>n,unknownKeys:"strict",catchall:xr.create(),typeName:Ue.ZodObject,...Xe(e)});Lt.lazycreate=(n,e)=>new Lt({shape:n,unknownKeys:"strip",catchall:xr.create(),typeName:Ue.ZodObject,...Xe(e)});class Ui extends et{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function i(s){for(const u of s)if(u.result.status==="valid")return u.result;for(const u of s)if(u.result.status==="dirty")return t.common.issues.push(...u.ctx.common.issues),u.result;const c=s.map(u=>new Rn(u.ctx.common.issues));return ge(t,{code:ie.invalid_union,unionErrors:c}),Fe}if(t.common.async)return Promise.all(r.map(async s=>{const c={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:c}),ctx:c}})).then(i);{let s;const c=[];for(const v of r){const g={...t,common:{...t.common,issues:[]},parent:null},p=v._parseSync({data:t.data,path:t.path,parent:g});if(p.status==="valid")return p;p.status==="dirty"&&!s&&(s={result:p,ctx:g}),g.common.issues.length&&c.push(g.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const u=c.map(v=>new Rn(v));return ge(t,{code:ie.invalid_union,unionErrors:u}),Fe}}get options(){return this._def.options}}Ui.create=(n,e)=>new Ui({options:n,typeName:Ue.ZodUnion,...Xe(e)});const Tr=n=>n instanceof ji?Tr(n.schema):n instanceof Yn?Tr(n.innerType()):n instanceof Hi?[n.value]:n instanceof Xr?n.options:n instanceof Gi?dt.objectValues(n.enum):n instanceof Zi?Tr(n._def.innerType):n instanceof Bi?[void 0]:n instanceof Mi?[null]:n instanceof cr?[void 0,...Tr(n.unwrap())]:n instanceof Jr?[null,...Tr(n.unwrap())]:n instanceof xa||n instanceof Wi?Tr(n.unwrap()):n instanceof zi?Tr(n._def.innerType):[];class Ps extends et{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ye.object)return ge(t,{code:ie.invalid_type,expected:ye.object,received:t.parsedType}),Fe;const r=this.discriminator,i=t.data[r],s=this.optionsMap.get(i);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(ge(t,{code:ie.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Fe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const i=new Map;for(const s of t){const c=Tr(s.shape[e]);if(!c.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const u of c){if(i.has(u))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(u)}`);i.set(u,s)}}return new Ps({typeName:Ue.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...Xe(r)})}}function ga(n,e){const t=Hr(n),r=Hr(e);if(n===e)return{valid:!0,data:n};if(t===ye.object&&r===ye.object){const i=dt.objectKeys(e),s=dt.objectKeys(n).filter(u=>i.indexOf(u)!==-1),c={...n,...e};for(const u of s){const v=ga(n[u],e[u]);if(!v.valid)return{valid:!1};c[u]=v.data}return{valid:!0,data:c}}else if(t===ye.array&&r===ye.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<n.length;s++){const c=n[s],u=e[s],v=ga(c,u);if(!v.valid)return{valid:!1};i.push(v.data)}return{valid:!0,data:i}}else return t===ye.date&&r===ye.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Fi extends et{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=(s,c)=>{if(da(s)||da(c))return Fe;const u=ga(s.value,c.value);return u.valid?((pa(s)||pa(c))&&t.dirty(),{status:t.value,value:u.data}):(ge(r,{code:ie.invalid_intersection_types}),Fe)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,c])=>i(s,c)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Fi.create=(n,e,t)=>new Fi({left:n,right:e,typeName:Ue.ZodIntersection,...Xe(t)});class fr extends et{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ye.array)return ge(r,{code:ie.invalid_type,expected:ye.array,received:r.parsedType}),Fe;if(r.data.length<this._def.items.length)return ge(r,{code:ie.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Fe;!this._def.rest&&r.data.length>this._def.items.length&&(ge(r,{code:ie.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map((c,u)=>{const v=this._def.items[u]||this._def.rest;return v?v._parse(new ur(r,c,r.path,u)):null}).filter(c=>!!c);return r.common.async?Promise.all(s).then(c=>fn.mergeArray(t,c)):fn.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new fr({...this._def,rest:e})}}fr.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new fr({items:n,typeName:Ue.ZodTuple,rest:null,...Xe(e)})};class Vi extends et{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ye.object)return ge(r,{code:ie.invalid_type,expected:ye.object,received:r.parsedType}),Fe;const i=[],s=this._def.keyType,c=this._def.valueType;for(const u in r.data)i.push({key:s._parse(new ur(r,u,r.path,u)),value:c._parse(new ur(r,r.data[u],r.path,u)),alwaysSet:u in r.data});return r.common.async?fn.mergeObjectAsync(t,i):fn.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof et?new Vi({keyType:e,valueType:t,typeName:Ue.ZodRecord,...Xe(r)}):new Vi({keyType:Wn.create(),valueType:e,typeName:Ue.ZodRecord,...Xe(t)})}}class Ss extends et{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ye.map)return ge(r,{code:ie.invalid_type,expected:ye.map,received:r.parsedType}),Fe;const i=this._def.keyType,s=this._def.valueType,c=[...r.data.entries()].map(([u,v],g)=>({key:i._parse(new ur(r,u,r.path,[g,"key"])),value:s._parse(new ur(r,v,r.path,[g,"value"]))}));if(r.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const v of c){const g=await v.key,p=await v.value;if(g.status==="aborted"||p.status==="aborted")return Fe;(g.status==="dirty"||p.status==="dirty")&&t.dirty(),u.set(g.value,p.value)}return{status:t.value,value:u}})}else{const u=new Map;for(const v of c){const g=v.key,p=v.value;if(g.status==="aborted"||p.status==="aborted")return Fe;(g.status==="dirty"||p.status==="dirty")&&t.dirty(),u.set(g.value,p.value)}return{status:t.value,value:u}}}}Ss.create=(n,e,t)=>new Ss({valueType:e,keyType:n,typeName:Ue.ZodMap,...Xe(t)});class hi extends et{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ye.set)return ge(r,{code:ie.invalid_type,expected:ye.set,received:r.parsedType}),Fe;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(ge(r,{code:ie.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(ge(r,{code:ie.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const s=this._def.valueType;function c(v){const g=new Set;for(const p of v){if(p.status==="aborted")return Fe;p.status==="dirty"&&t.dirty(),g.add(p.value)}return{status:t.value,value:g}}const u=[...r.data.values()].map((v,g)=>s._parse(new ur(r,v,r.path,g)));return r.common.async?Promise.all(u).then(v=>c(v)):c(u)}min(e,t){return new hi({...this._def,minSize:{value:e,message:Ne.toString(t)}})}max(e,t){return new hi({...this._def,maxSize:{value:e,message:Ne.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}hi.create=(n,e)=>new hi({valueType:n,minSize:null,maxSize:null,typeName:Ue.ZodSet,...Xe(e)});class Ei extends et{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ye.function)return ge(t,{code:ie.invalid_type,expected:ye.function,received:t.parsedType}),Fe;function r(u,v){return Es({data:u,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,bs(),_i].filter(g=>!!g),issueData:{code:ie.invalid_arguments,argumentsError:v}})}function i(u,v){return Es({data:u,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,bs(),_i].filter(g=>!!g),issueData:{code:ie.invalid_return_type,returnTypeError:v}})}const s={errorMap:t.common.contextualErrorMap},c=t.data;if(this._def.returns instanceof Ti){const u=this;return En(async function(...v){const g=new Rn([]),p=await u._def.args.parseAsync(v,s).catch(V=>{throw g.addIssue(r(v,V)),g}),y=await Reflect.apply(c,this,p);return await u._def.returns._def.type.parseAsync(y,s).catch(V=>{throw g.addIssue(i(y,V)),g})})}else{const u=this;return En(function(...v){const g=u._def.args.safeParse(v,s);if(!g.success)throw new Rn([r(v,g.error)]);const p=Reflect.apply(c,this,g.data),y=u._def.returns.safeParse(p,s);if(!y.success)throw new Rn([i(p,y.error)]);return y.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ei({...this._def,args:fr.create(e).rest(ci.create())})}returns(e){return new Ei({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Ei({args:e||fr.create([]).rest(ci.create()),returns:t||ci.create(),typeName:Ue.ZodFunction,...Xe(r)})}}class ji extends et{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ji.create=(n,e)=>new ji({getter:n,typeName:Ue.ZodLazy,...Xe(e)});class Hi extends et{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ge(t,{received:t.data,code:ie.invalid_literal,expected:this._def.value}),Fe}return{status:"valid",value:e.data}}get value(){return this._def.value}}Hi.create=(n,e)=>new Hi({value:n,typeName:Ue.ZodLiteral,...Xe(e)});function Zo(n,e){return new Xr({values:n,typeName:Ue.ZodEnum,...Xe(e)})}class Xr extends et{constructor(){super(...arguments),Ni.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return ge(t,{expected:dt.joinValues(r),received:t.parsedType,code:ie.invalid_type}),Fe}if(_s(this,Ni)||Vo(this,Ni,new Set(this._def.values)),!_s(this,Ni).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return ge(t,{received:t.data,code:ie.invalid_enum_value,options:r}),Fe}return En(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Xr.create(e,{...this._def,...t})}exclude(e,t=this._def){return Xr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}Ni=new WeakMap;Xr.create=Zo;class Gi extends et{constructor(){super(...arguments),Pi.set(this,void 0)}_parse(e){const t=dt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ye.string&&r.parsedType!==ye.number){const i=dt.objectValues(t);return ge(r,{expected:dt.joinValues(i),received:r.parsedType,code:ie.invalid_type}),Fe}if(_s(this,Pi)||Vo(this,Pi,new Set(dt.getValidEnumValues(this._def.values))),!_s(this,Pi).has(e.data)){const i=dt.objectValues(t);return ge(r,{received:r.data,code:ie.invalid_enum_value,options:i}),Fe}return En(e.data)}get enum(){return this._def.values}}Pi=new WeakMap;Gi.create=(n,e)=>new Gi({values:n,typeName:Ue.ZodNativeEnum,...Xe(e)});class Ti extends et{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ye.promise&&t.common.async===!1)return ge(t,{code:ie.invalid_type,expected:ye.promise,received:t.parsedType}),Fe;const r=t.parsedType===ye.promise?t.data:Promise.resolve(t.data);return En(r.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ti.create=(n,e)=>new Ti({type:n,typeName:Ue.ZodPromise,...Xe(e)});class Yn extends et{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ue.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:c=>{ge(r,c),c.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const c=i.transform(r.data,s);if(r.common.async)return Promise.resolve(c).then(async u=>{if(t.value==="aborted")return Fe;const v=await this._def.schema._parseAsync({data:u,path:r.path,parent:r});return v.status==="aborted"?Fe:v.status==="dirty"||t.value==="dirty"?bi(v.value):v});{if(t.value==="aborted")return Fe;const u=this._def.schema._parseSync({data:c,path:r.path,parent:r});return u.status==="aborted"?Fe:u.status==="dirty"||t.value==="dirty"?bi(u.value):u}}if(i.type==="refinement"){const c=u=>{const v=i.refinement(u,s);if(r.common.async)return Promise.resolve(v);if(v instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(r.common.async===!1){const u=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return u.status==="aborted"?Fe:(u.status==="dirty"&&t.dirty(),c(u.value),{status:t.value,value:u.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(u=>u.status==="aborted"?Fe:(u.status==="dirty"&&t.dirty(),c(u.value).then(()=>({status:t.value,value:u.value}))))}if(i.type==="transform")if(r.common.async===!1){const c=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$i(c))return c;const u=i.transform(c.value,s);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:u}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(c=>$i(c)?Promise.resolve(i.transform(c.value,s)).then(u=>({status:t.value,value:u})):c);dt.assertNever(i)}}Yn.create=(n,e,t)=>new Yn({schema:n,typeName:Ue.ZodEffects,effect:e,...Xe(t)});Yn.createWithPreprocess=(n,e,t)=>new Yn({schema:e,effect:{type:"preprocess",transform:n},typeName:Ue.ZodEffects,...Xe(t)});class cr extends et{_parse(e){return this._getType(e)===ye.undefined?En(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}cr.create=(n,e)=>new cr({innerType:n,typeName:Ue.ZodOptional,...Xe(e)});class Jr extends et{_parse(e){return this._getType(e)===ye.null?En(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Jr.create=(n,e)=>new Jr({innerType:n,typeName:Ue.ZodNullable,...Xe(e)});class Zi extends et{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===ye.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Zi.create=(n,e)=>new Zi({innerType:n,typeName:Ue.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Xe(e)});class zi extends et{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Li(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Rn(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Rn(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}zi.create=(n,e)=>new zi({innerType:n,typeName:Ue.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Xe(e)});class As extends et{_parse(e){if(this._getType(e)!==ye.nan){const r=this._getOrReturnCtx(e);return ge(r,{code:ie.invalid_type,expected:ye.nan,received:r.parsedType}),Fe}return{status:"valid",value:e.data}}}As.create=n=>new As({typeName:Ue.ZodNaN,...Xe(n)});const Xc=Symbol("zod_brand");class xa extends et{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Yi extends et{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?Fe:s.status==="dirty"?(t.dirty(),bi(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Fe:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,t){return new Yi({in:e,out:t,typeName:Ue.ZodPipeline})}}class Wi extends et{_parse(e){const t=this._def.innerType._parse(e),r=i=>($i(i)&&(i.value=Object.freeze(i.value)),i);return Li(t)?t.then(i=>r(i)):r(t)}unwrap(){return this._def.innerType}}Wi.create=(n,e)=>new Wi({innerType:n,typeName:Ue.ZodReadonly,...Xe(e)});function Da(n,e={},t){return n?wi.create().superRefine((r,i)=>{var s,c;if(!n(r)){const u=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,v=(c=(s=u.fatal)!==null&&s!==void 0?s:t)!==null&&c!==void 0?c:!0,g=typeof u=="string"?{message:u}:u;i.addIssue({code:"custom",...g,fatal:v})}}):wi.create()}const Jc={object:Lt.lazycreate};var Ue;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Ue||(Ue={}));const Qc=(n,e={message:`Input not instance of ${n.name}`})=>Da(t=>t instanceof n,e),P=Wn.create,Pe=qr.create,eu=As.create,zo=Yr.create,He=Ci.create,tu=fi.create,nu=ws.create,ru=Bi.create,Ra=Mi.create,iu=wi.create,Ki=ci.create,su=xr.create,au=Ts.create,ht=Kn.create,ue=Lt.create,ou=Lt.strictCreate,Na=Ui.create,lu=Ps.create,cu=Fi.create,uu=fr.create,fu=Vi.create,hu=Ss.create,du=hi.create,pu=Ei.create,gu=ji.create,Yt=Hi.create,mu=Xr.create,Ii=Gi.create,yu=Ti.create,io=Yn.create,Wo=cr.create,vu=Jr.create,Ko=Yn.createWithPreprocess,bu=Yi.create,Eu=()=>P().optional(),_u=()=>Pe().optional(),wu=()=>He().optional(),Tu={string:n=>Wn.create({...n,coerce:!0}),number:n=>qr.create({...n,coerce:!0}),boolean:n=>Ci.create({...n,coerce:!0}),bigint:n=>Yr.create({...n,coerce:!0}),date:n=>fi.create({...n,coerce:!0})},Su=Fe;var xe=Object.freeze({__proto__:null,defaultErrorMap:_i,setErrorMap:$c,getErrorMap:bs,makeIssue:Es,EMPTY_PATH:Lc,addIssueToContext:ge,ParseStatus:fn,INVALID:Fe,DIRTY:bi,OK:En,isAborted:da,isDirty:pa,isValid:$i,isAsync:Li,get util(){return dt},get objectUtil(){return ha},ZodParsedType:ye,getParsedType:Hr,ZodType:et,datetimeRegex:Go,ZodString:Wn,ZodNumber:qr,ZodBigInt:Yr,ZodBoolean:Ci,ZodDate:fi,ZodSymbol:ws,ZodUndefined:Bi,ZodNull:Mi,ZodAny:wi,ZodUnknown:ci,ZodNever:xr,ZodVoid:Ts,ZodArray:Kn,ZodObject:Lt,ZodUnion:Ui,ZodDiscriminatedUnion:Ps,ZodIntersection:Fi,ZodTuple:fr,ZodRecord:Vi,ZodMap:Ss,ZodSet:hi,ZodFunction:Ei,ZodLazy:ji,ZodLiteral:Hi,ZodEnum:Xr,ZodNativeEnum:Gi,ZodPromise:Ti,ZodEffects:Yn,ZodTransformer:Yn,ZodOptional:cr,ZodNullable:Jr,ZodDefault:Zi,ZodCatch:zi,ZodNaN:As,BRAND:Xc,ZodBranded:xa,ZodPipeline:Yi,ZodReadonly:Wi,custom:Da,Schema:et,ZodSchema:et,late:Jc,get ZodFirstPartyTypeKind(){return Ue},coerce:Tu,any:iu,array:ht,bigint:zo,boolean:He,date:tu,discriminatedUnion:lu,effect:io,enum:mu,function:pu,instanceof:Qc,intersection:cu,lazy:gu,literal:Yt,map:hu,nan:eu,nativeEnum:Ii,never:su,null:Ra,nullable:vu,number:Pe,object:ue,oboolean:wu,onumber:_u,optional:Wo,ostring:Eu,pipeline:bu,preprocess:Ko,promise:yu,record:fu,set:du,strictObject:ou,string:P,symbol:nu,transformer:io,tuple:uu,undefined:ru,union:Na,unknown:Ki,void:au,NEVER:Su,ZodIssueCode:ie,quotelessJson:kc,ZodError:Rn}),qo={exports:{}};(function(n){var e=function(t){var r=1e7,i=7,s=9007199254740992,c=X(s),u="0123456789abcdefghijklmnopqrstuvwxyz",v=typeof BigInt=="function";function g(m,T,x,N){return typeof m>"u"?g[0]:typeof T<"u"?+T==10&&!x?ke(m):an(m,T,x,N):ke(m)}function p(m,T){this.value=m,this.sign=T,this.isSmall=!1}p.prototype=Object.create(g.prototype);function y(m){this.value=m,this.sign=m<0,this.isSmall=!0}y.prototype=Object.create(g.prototype);function O(m){this.value=m}O.prototype=Object.create(g.prototype);function V(m){return-s<m&&m<s}function X(m){return m<1e7?[m]:m<1e14?[m%1e7,Math.floor(m/1e7)]:[m%1e7,Math.floor(m/1e7)%1e7,Math.floor(m/1e14)]}function Z(m){z(m);var T=m.length;if(T<4&&Ae(m,c)<0)switch(T){case 0:return 0;case 1:return m[0];case 2:return m[0]+m[1]*r;default:return m[0]+(m[1]+m[2]*r)*r}return m}function z(m){for(var T=m.length;m[--T]===0;);m.length=T+1}function me(m){for(var T=new Array(m),x=-1;++x<m;)T[x]=0;return T}function le(m){return m>0?Math.floor(m):Math.ceil(m)}function ve(m,T){var x=m.length,N=T.length,j=new Array(x),U=0,G=r,W,Y;for(Y=0;Y<N;Y++)W=m[Y]+T[Y]+U,U=W>=G?1:0,j[Y]=W-U*G;for(;Y<x;)W=m[Y]+U,U=W===G?1:0,j[Y++]=W-U*G;return U>0&&j.push(U),j}function Le(m,T){return m.length>=T.length?ve(m,T):ve(T,m)}function ut(m,T){var x=m.length,N=new Array(x),j=r,U,G;for(G=0;G<x;G++)U=m[G]-j+T,T=Math.floor(U/j),N[G]=U-T*j,T+=1;for(;T>0;)N[G++]=T%j,T=Math.floor(T/j);return N}p.prototype.add=function(m){var T=ke(m);if(this.sign!==T.sign)return this.subtract(T.negate());var x=this.value,N=T.value;return T.isSmall?new p(ut(x,Math.abs(N)),this.sign):new p(Le(x,N),this.sign)},p.prototype.plus=p.prototype.add,y.prototype.add=function(m){var T=ke(m),x=this.value;if(x<0!==T.sign)return this.subtract(T.negate());var N=T.value;if(T.isSmall){if(V(x+N))return new y(x+N);N=X(Math.abs(N))}return new p(ut(N,Math.abs(x)),x<0)},y.prototype.plus=y.prototype.add,O.prototype.add=function(m){return new O(this.value+ke(m).value)},O.prototype.plus=O.prototype.add;function St(m,T){var x=m.length,N=T.length,j=new Array(x),U=0,G=r,W,Y;for(W=0;W<N;W++)Y=m[W]-U-T[W],Y<0?(Y+=G,U=1):U=0,j[W]=Y;for(W=N;W<x;W++){if(Y=m[W]-U,Y<0)Y+=G;else{j[W++]=Y;break}j[W]=Y}for(;W<x;W++)j[W]=m[W];return z(j),j}function yt(m,T,x){var N;return Ae(m,T)>=0?N=St(m,T):(N=St(T,m),x=!x),N=Z(N),typeof N=="number"?(x&&(N=-N),new y(N)):new p(N,x)}function Rt(m,T,x){var N=m.length,j=new Array(N),U=-T,G=r,W,Y;for(W=0;W<N;W++)Y=m[W]+U,U=Math.floor(Y/G),Y%=G,j[W]=Y<0?Y+G:Y;return j=Z(j),typeof j=="number"?(x&&(j=-j),new y(j)):new p(j,x)}p.prototype.subtract=function(m){var T=ke(m);if(this.sign!==T.sign)return this.add(T.negate());var x=this.value,N=T.value;return T.isSmall?Rt(x,Math.abs(N),this.sign):yt(x,N,this.sign)},p.prototype.minus=p.prototype.subtract,y.prototype.subtract=function(m){var T=ke(m),x=this.value;if(x<0!==T.sign)return this.add(T.negate());var N=T.value;return T.isSmall?new y(x-N):Rt(N,Math.abs(x),x>=0)},y.prototype.minus=y.prototype.subtract,O.prototype.subtract=function(m){return new O(this.value-ke(m).value)},O.prototype.minus=O.prototype.subtract,p.prototype.negate=function(){return new p(this.value,!this.sign)},y.prototype.negate=function(){var m=this.sign,T=new y(-this.value);return T.sign=!m,T},O.prototype.negate=function(){return new O(-this.value)},p.prototype.abs=function(){return new p(this.value,!1)},y.prototype.abs=function(){return new y(Math.abs(this.value))},O.prototype.abs=function(){return new O(this.value>=0?this.value:-this.value)};function tt(m,T){var x=m.length,N=T.length,j=x+N,U=me(j),G=r,W,Y,Ee,Ze,Be;for(Ee=0;Ee<x;++Ee){Ze=m[Ee];for(var Ve=0;Ve<N;++Ve)Be=T[Ve],W=Ze*Be+U[Ee+Ve],Y=Math.floor(W/G),U[Ee+Ve]=W-Y*G,U[Ee+Ve+1]+=Y}return z(U),U}function bt(m,T){var x=m.length,N=new Array(x),j=r,U=0,G,W;for(W=0;W<x;W++)G=m[W]*T+U,U=Math.floor(G/j),N[W]=G-U*j;for(;U>0;)N[W++]=U%j,U=Math.floor(U/j);return N}function _t(m,T){for(var x=[];T-- >0;)x.push(0);return x.concat(m)}function ot(m,T){var x=Math.max(m.length,T.length);if(x<=30)return tt(m,T);x=Math.ceil(x/2);var N=m.slice(x),j=m.slice(0,x),U=T.slice(x),G=T.slice(0,x),W=ot(j,G),Y=ot(N,U),Ee=ot(Le(j,N),Le(G,U)),Ze=Le(Le(W,_t(St(St(Ee,W),Y),x)),_t(Y,2*x));return z(Ze),Ze}function M(m,T){return-.012*m-.012*T+15e-6*m*T>0}p.prototype.multiply=function(m){var T=ke(m),x=this.value,N=T.value,j=this.sign!==T.sign,U;if(T.isSmall){if(N===0)return g[0];if(N===1)return this;if(N===-1)return this.negate();if(U=Math.abs(N),U<r)return new p(bt(x,U),j);N=X(U)}return M(x.length,N.length)?new p(ot(x,N),j):new p(tt(x,N),j)},p.prototype.times=p.prototype.multiply;function oe(m,T,x){return m<r?new p(bt(T,m),x):new p(tt(T,X(m)),x)}y.prototype._multiplyBySmall=function(m){return V(m.value*this.value)?new y(m.value*this.value):oe(Math.abs(m.value),X(Math.abs(this.value)),this.sign!==m.sign)},p.prototype._multiplyBySmall=function(m){return m.value===0?g[0]:m.value===1?this:m.value===-1?this.negate():oe(Math.abs(m.value),this.value,this.sign!==m.sign)},y.prototype.multiply=function(m){return ke(m)._multiplyBySmall(this)},y.prototype.times=y.prototype.multiply,O.prototype.multiply=function(m){return new O(this.value*ke(m).value)},O.prototype.times=O.prototype.multiply;function se(m){var T=m.length,x=me(T+T),N=r,j,U,G,W,Y;for(G=0;G<T;G++){W=m[G],U=0-W*W;for(var Ee=G;Ee<T;Ee++)Y=m[Ee],j=2*(W*Y)+x[G+Ee]+U,U=Math.floor(j/N),x[G+Ee]=j-U*N;x[G+T]=U}return z(x),x}p.prototype.square=function(){return new p(se(this.value),!1)},y.prototype.square=function(){var m=this.value*this.value;return V(m)?new y(m):new p(se(X(Math.abs(this.value))),!1)},O.prototype.square=function(m){return new O(this.value*this.value)};function te(m,T){var x=m.length,N=T.length,j=r,U=me(T.length),G=T[N-1],W=Math.ceil(j/(2*G)),Y=bt(m,W),Ee=bt(T,W),Ze,Be,Ve,Ct,rt,kn,Ut;for(Y.length<=x&&Y.push(0),Ee.push(0),G=Ee[N-1],Be=x-N;Be>=0;Be--){for(Ze=j-1,Y[Be+N]!==G&&(Ze=Math.floor((Y[Be+N]*j+Y[Be+N-1])/G)),Ve=0,Ct=0,kn=Ee.length,rt=0;rt<kn;rt++)Ve+=Ze*Ee[rt],Ut=Math.floor(Ve/j),Ct+=Y[Be+rt]-(Ve-Ut*j),Ve=Ut,Ct<0?(Y[Be+rt]=Ct+j,Ct=-1):(Y[Be+rt]=Ct,Ct=0);for(;Ct!==0;){for(Ze-=1,Ve=0,rt=0;rt<kn;rt++)Ve+=Y[Be+rt]-j+Ee[rt],Ve<0?(Y[Be+rt]=Ve+j,Ve=0):(Y[Be+rt]=Ve,Ve=1);Ct+=Ve}U[Be]=Ze}return Y=we(Y,W)[0],[Z(U),Z(Y)]}function Q(m,T){for(var x=m.length,N=T.length,j=[],U=[],G=r,W,Y,Ee,Ze,Be;x;){if(U.unshift(m[--x]),z(U),Ae(U,T)<0){j.push(0);continue}Y=U.length,Ee=U[Y-1]*G+U[Y-2],Ze=T[N-1]*G+T[N-2],Y>N&&(Ee=(Ee+1)*G),W=Math.ceil(Ee/Ze);do{if(Be=bt(T,W),Ae(Be,U)<=0)break;W--}while(W);j.push(W),U=St(U,Be)}return j.reverse(),[Z(j),Z(U)]}function we(m,T){var x=m.length,N=me(x),j=r,U,G,W,Y;for(W=0,U=x-1;U>=0;--U)Y=W*j+m[U],G=le(Y/T),W=Y-G*T,N[U]=G|0;return[N,W|0]}function Ce(m,T){var x,N=ke(T);if(v)return[new O(m.value/N.value),new O(m.value%N.value)];var j=m.value,U=N.value,G;if(U===0)throw new Error("Cannot divide by zero");if(m.isSmall)return N.isSmall?[new y(le(j/U)),new y(j%U)]:[g[0],m];if(N.isSmall){if(U===1)return[m,g[0]];if(U==-1)return[m.negate(),g[0]];var W=Math.abs(U);if(W<r){x=we(j,W),G=Z(x[0]);var Y=x[1];return m.sign&&(Y=-Y),typeof G=="number"?(m.sign!==N.sign&&(G=-G),[new y(G),new y(Y)]):[new p(G,m.sign!==N.sign),new y(Y)]}U=X(W)}var Ee=Ae(j,U);if(Ee===-1)return[g[0],m];if(Ee===0)return[g[m.sign===N.sign?1:-1],g[0]];j.length+U.length<=200?x=te(j,U):x=Q(j,U),G=x[0];var Ze=m.sign!==N.sign,Be=x[1],Ve=m.sign;return typeof G=="number"?(Ze&&(G=-G),G=new y(G)):G=new p(G,Ze),typeof Be=="number"?(Ve&&(Be=-Be),Be=new y(Be)):Be=new p(Be,Ve),[G,Be]}p.prototype.divmod=function(m){var T=Ce(this,m);return{quotient:T[0],remainder:T[1]}},O.prototype.divmod=y.prototype.divmod=p.prototype.divmod,p.prototype.divide=function(m){return Ce(this,m)[0]},O.prototype.over=O.prototype.divide=function(m){return new O(this.value/ke(m).value)},y.prototype.over=y.prototype.divide=p.prototype.over=p.prototype.divide,p.prototype.mod=function(m){return Ce(this,m)[1]},O.prototype.mod=O.prototype.remainder=function(m){return new O(this.value%ke(m).value)},y.prototype.remainder=y.prototype.mod=p.prototype.remainder=p.prototype.mod,p.prototype.pow=function(m){var T=ke(m),x=this.value,N=T.value,j,U,G;if(N===0)return g[1];if(x===0)return g[0];if(x===1)return g[1];if(x===-1)return T.isEven()?g[1]:g[-1];if(T.sign)return g[0];if(!T.isSmall)throw new Error("The exponent "+T.toString()+" is too large.");if(this.isSmall&&V(j=Math.pow(x,N)))return new y(le(j));for(U=this,G=g[1];N&!0&&(G=G.times(U),--N),N!==0;)N/=2,U=U.square();return G},y.prototype.pow=p.prototype.pow,O.prototype.pow=function(m){var T=ke(m),x=this.value,N=T.value,j=BigInt(0),U=BigInt(1),G=BigInt(2);if(N===j)return g[1];if(x===j)return g[0];if(x===U)return g[1];if(x===BigInt(-1))return T.isEven()?g[1]:g[-1];if(T.isNegative())return new O(j);for(var W=this,Y=g[1];(N&U)===U&&(Y=Y.times(W),--N),N!==j;)N/=G,W=W.square();return Y},p.prototype.modPow=function(m,T){if(m=ke(m),T=ke(T),T.isZero())throw new Error("Cannot take modPow with modulus 0");var x=g[1],N=this.mod(T);for(m.isNegative()&&(m=m.multiply(g[-1]),N=N.modInv(T));m.isPositive();){if(N.isZero())return g[0];m.isOdd()&&(x=x.multiply(N).mod(T)),m=m.divide(2),N=N.square().mod(T)}return x},O.prototype.modPow=y.prototype.modPow=p.prototype.modPow;function Ae(m,T){if(m.length!==T.length)return m.length>T.length?1:-1;for(var x=m.length-1;x>=0;x--)if(m[x]!==T[x])return m[x]>T[x]?1:-1;return 0}p.prototype.compareAbs=function(m){var T=ke(m),x=this.value,N=T.value;return T.isSmall?1:Ae(x,N)},y.prototype.compareAbs=function(m){var T=ke(m),x=Math.abs(this.value),N=T.value;return T.isSmall?(N=Math.abs(N),x===N?0:x>N?1:-1):-1},O.prototype.compareAbs=function(m){var T=this.value,x=ke(m).value;return T=T>=0?T:-T,x=x>=0?x:-x,T===x?0:T>x?1:-1},p.prototype.compare=function(m){if(m===1/0)return-1;if(m===-1/0)return 1;var T=ke(m),x=this.value,N=T.value;return this.sign!==T.sign?T.sign?1:-1:T.isSmall?this.sign?-1:1:Ae(x,N)*(this.sign?-1:1)},p.prototype.compareTo=p.prototype.compare,y.prototype.compare=function(m){if(m===1/0)return-1;if(m===-1/0)return 1;var T=ke(m),x=this.value,N=T.value;return T.isSmall?x==N?0:x>N?1:-1:x<0!==T.sign?x<0?-1:1:x<0?1:-1},y.prototype.compareTo=y.prototype.compare,O.prototype.compare=function(m){if(m===1/0)return-1;if(m===-1/0)return 1;var T=this.value,x=ke(m).value;return T===x?0:T>x?1:-1},O.prototype.compareTo=O.prototype.compare,p.prototype.equals=function(m){return this.compare(m)===0},O.prototype.eq=O.prototype.equals=y.prototype.eq=y.prototype.equals=p.prototype.eq=p.prototype.equals,p.prototype.notEquals=function(m){return this.compare(m)!==0},O.prototype.neq=O.prototype.notEquals=y.prototype.neq=y.prototype.notEquals=p.prototype.neq=p.prototype.notEquals,p.prototype.greater=function(m){return this.compare(m)>0},O.prototype.gt=O.prototype.greater=y.prototype.gt=y.prototype.greater=p.prototype.gt=p.prototype.greater,p.prototype.lesser=function(m){return this.compare(m)<0},O.prototype.lt=O.prototype.lesser=y.prototype.lt=y.prototype.lesser=p.prototype.lt=p.prototype.lesser,p.prototype.greaterOrEquals=function(m){return this.compare(m)>=0},O.prototype.geq=O.prototype.greaterOrEquals=y.prototype.geq=y.prototype.greaterOrEquals=p.prototype.geq=p.prototype.greaterOrEquals,p.prototype.lesserOrEquals=function(m){return this.compare(m)<=0},O.prototype.leq=O.prototype.lesserOrEquals=y.prototype.leq=y.prototype.lesserOrEquals=p.prototype.leq=p.prototype.lesserOrEquals,p.prototype.isEven=function(){return(this.value[0]&1)===0},y.prototype.isEven=function(){return(this.value&1)===0},O.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},p.prototype.isOdd=function(){return(this.value[0]&1)===1},y.prototype.isOdd=function(){return(this.value&1)===1},O.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},p.prototype.isPositive=function(){return!this.sign},y.prototype.isPositive=function(){return this.value>0},O.prototype.isPositive=y.prototype.isPositive,p.prototype.isNegative=function(){return this.sign},y.prototype.isNegative=function(){return this.value<0},O.prototype.isNegative=y.prototype.isNegative,p.prototype.isUnit=function(){return!1},y.prototype.isUnit=function(){return Math.abs(this.value)===1},O.prototype.isUnit=function(){return this.abs().value===BigInt(1)},p.prototype.isZero=function(){return!1},y.prototype.isZero=function(){return this.value===0},O.prototype.isZero=function(){return this.value===BigInt(0)},p.prototype.isDivisibleBy=function(m){var T=ke(m);return T.isZero()?!1:T.isUnit()?!0:T.compareAbs(2)===0?this.isEven():this.mod(T).isZero()},O.prototype.isDivisibleBy=y.prototype.isDivisibleBy=p.prototype.isDivisibleBy;function We(m){var T=m.abs();if(T.isUnit())return!1;if(T.equals(2)||T.equals(3)||T.equals(5))return!0;if(T.isEven()||T.isDivisibleBy(3)||T.isDivisibleBy(5))return!1;if(T.lesser(49))return!0}function nt(m,T){for(var x=m.prev(),N=x,j=0,U,G,W;N.isEven();)N=N.divide(2),j++;e:for(G=0;G<T.length;G++)if(!m.lesser(T[G])&&(W=e(T[G]).modPow(N,m),!(W.isUnit()||W.equals(x)))){for(U=j-1;U!=0;U--){if(W=W.square().mod(m),W.isUnit())return!1;if(W.equals(x))continue e}return!1}return!0}p.prototype.isPrime=function(m){var T=We(this);if(T!==t)return T;var x=this.abs(),N=x.bitLength();if(N<=64)return nt(x,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var j=Math.log(2)*N.toJSNumber(),U=Math.ceil(m===!0?2*Math.pow(j,2):j),G=[],W=0;W<U;W++)G.push(e(W+2));return nt(x,G)},O.prototype.isPrime=y.prototype.isPrime=p.prototype.isPrime,p.prototype.isProbablePrime=function(m,T){var x=We(this);if(x!==t)return x;for(var N=this.abs(),j=m===t?5:m,U=[],G=0;G<j;G++)U.push(e.randBetween(2,N.minus(2),T));return nt(N,U)},O.prototype.isProbablePrime=y.prototype.isProbablePrime=p.prototype.isProbablePrime,p.prototype.modInv=function(m){for(var T=e.zero,x=e.one,N=ke(m),j=this.abs(),U,G,W;!j.isZero();)U=N.divide(j),G=T,W=N,T=x,N=j,x=G.subtract(U.multiply(x)),j=W.subtract(U.multiply(j));if(!N.isUnit())throw new Error(this.toString()+" and "+m.toString()+" are not co-prime");return T.compare(0)===-1&&(T=T.add(m)),this.isNegative()?T.negate():T},O.prototype.modInv=y.prototype.modInv=p.prototype.modInv,p.prototype.next=function(){var m=this.value;return this.sign?Rt(m,1,this.sign):new p(ut(m,1),this.sign)},y.prototype.next=function(){var m=this.value;return m+1<s?new y(m+1):new p(c,!1)},O.prototype.next=function(){return new O(this.value+BigInt(1))},p.prototype.prev=function(){var m=this.value;return this.sign?new p(ut(m,1),!0):Rt(m,1,this.sign)},y.prototype.prev=function(){var m=this.value;return m-1>-s?new y(m-1):new p(c,!0)},O.prototype.prev=function(){return new O(this.value-BigInt(1))};for(var wt=[1];2*wt[wt.length-1]<=r;)wt.push(2*wt[wt.length-1]);var Mt=wt.length,Wt=wt[Mt-1];function Nn(m){return Math.abs(m)<=r}p.prototype.shiftLeft=function(m){var T=ke(m).toJSNumber();if(!Nn(T))throw new Error(String(T)+" is too large for shifting.");if(T<0)return this.shiftRight(-T);var x=this;if(x.isZero())return x;for(;T>=Mt;)x=x.multiply(Wt),T-=Mt-1;return x.multiply(wt[T])},O.prototype.shiftLeft=y.prototype.shiftLeft=p.prototype.shiftLeft,p.prototype.shiftRight=function(m){var T,x=ke(m).toJSNumber();if(!Nn(x))throw new Error(String(x)+" is too large for shifting.");if(x<0)return this.shiftLeft(-x);for(var N=this;x>=Mt;){if(N.isZero()||N.isNegative()&&N.isUnit())return N;T=Ce(N,Wt),N=T[1].isNegative()?T[0].prev():T[0],x-=Mt-1}return T=Ce(N,wt[x]),T[1].isNegative()?T[0].prev():T[0]},O.prototype.shiftRight=y.prototype.shiftRight=p.prototype.shiftRight;function jn(m,T,x){T=ke(T);for(var N=m.isNegative(),j=T.isNegative(),U=N?m.not():m,G=j?T.not():T,W=0,Y=0,Ee=null,Ze=null,Be=[];!U.isZero()||!G.isZero();)Ee=Ce(U,Wt),W=Ee[1].toJSNumber(),N&&(W=Wt-1-W),Ze=Ce(G,Wt),Y=Ze[1].toJSNumber(),j&&(Y=Wt-1-Y),U=Ee[0],G=Ze[0],Be.push(x(W,Y));for(var Ve=x(N?1:0,j?1:0)!==0?e(-1):e(0),Ct=Be.length-1;Ct>=0;Ct-=1)Ve=Ve.multiply(Wt).add(e(Be[Ct]));return Ve}p.prototype.not=function(){return this.negate().prev()},O.prototype.not=y.prototype.not=p.prototype.not,p.prototype.and=function(m){return jn(this,m,function(T,x){return T&x})},O.prototype.and=y.prototype.and=p.prototype.and,p.prototype.or=function(m){return jn(this,m,function(T,x){return T|x})},O.prototype.or=y.prototype.or=p.prototype.or,p.prototype.xor=function(m){return jn(this,m,function(T,x){return T^x})},O.prototype.xor=y.prototype.xor=p.prototype.xor;var Ge=1<<30,An=(r&-r)*(r&-r)|Ge;function Xt(m){var T=m.value,x=typeof T=="number"?T|Ge:typeof T=="bigint"?T|BigInt(Ge):T[0]+T[1]*r|An;return x&-x}function pn(m,T){if(T.compareTo(m)<=0){var x=pn(m,T.square(T)),N=x.p,j=x.e,U=N.multiply(T);return U.compareTo(m)<=0?{p:U,e:j*2+1}:{p:N,e:j*2}}return{p:e(1),e:0}}p.prototype.bitLength=function(){var m=this;return m.compareTo(e(0))<0&&(m=m.negate().subtract(e(1))),m.compareTo(e(0))===0?e(0):e(pn(m,e(2)).e).add(e(1))},O.prototype.bitLength=y.prototype.bitLength=p.prototype.bitLength;function Pn(m,T){return m=ke(m),T=ke(T),m.greater(T)?m:T}function kt(m,T){return m=ke(m),T=ke(T),m.lesser(T)?m:T}function Jn(m,T){if(m=ke(m).abs(),T=ke(T).abs(),m.equals(T))return m;if(m.isZero())return T;if(T.isZero())return m;for(var x=g[1],N,j;m.isEven()&&T.isEven();)N=kt(Xt(m),Xt(T)),m=m.divide(N),T=T.divide(N),x=x.multiply(N);for(;m.isEven();)m=m.divide(Xt(m));do{for(;T.isEven();)T=T.divide(Xt(T));m.greater(T)&&(j=T,T=m,m=j),T=T.subtract(m)}while(!T.isZero());return x.isUnit()?m:m.multiply(x)}function pr(m,T){return m=ke(m).abs(),T=ke(T).abs(),m.divide(Jn(m,T)).multiply(T)}function Qn(m,T,x){m=ke(m),T=ke(T);var N=x||Math.random,j=kt(m,T),U=Pn(m,T),G=U.subtract(j).add(1);if(G.isSmall)return j.add(Math.floor(N()*G));for(var W=At(G,r).value,Y=[],Ee=!0,Ze=0;Ze<W.length;Ze++){var Be=Ee?W[Ze]+(Ze+1<W.length?W[Ze+1]/r:0):r,Ve=le(N()*Be);Y.push(Ve),Ve<W[Ze]&&(Ee=!1)}return j.add(g.fromArray(Y,r,!1))}var an=function(m,T,x,N){x=x||u,m=String(m),N||(m=m.toLowerCase(),x=x.toLowerCase());var j=m.length,U,G=Math.abs(T),W={};for(U=0;U<x.length;U++)W[x[U]]=U;for(U=0;U<j;U++){var Y=m[U];if(Y!=="-"&&Y in W&&W[Y]>=G){if(Y==="1"&&G===1)continue;throw new Error(Y+" is not a valid digit in base "+T+".")}}T=ke(T);var Ee=[],Ze=m[0]==="-";for(U=Ze?1:0;U<m.length;U++){var Y=m[U];if(Y in W)Ee.push(ke(W[Y]));else if(Y==="<"){var Be=U;do U++;while(m[U]!==">"&&U<m.length);Ee.push(ke(m.slice(Be+1,U)))}else throw new Error(Y+" is not a valid character")}return er(Ee,T,Ze)};function er(m,T,x){var N=g[0],j=g[1],U;for(U=m.length-1;U>=0;U--)N=N.add(m[U].times(j)),j=j.times(T);return x?N.negate():N}function In(m,T){return T=T||u,m<T.length?T[m]:"<"+m+">"}function At(m,T){if(T=e(T),T.isZero()){if(m.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(T.equals(-1)){if(m.isZero())return{value:[0],isNegative:!1};if(m.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-m.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var x=Array.apply(null,Array(m.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return x.unshift([1]),{value:[].concat.apply([],x),isNegative:!1}}var N=!1;if(m.isNegative()&&T.isPositive()&&(N=!0,m=m.abs()),T.isUnit())return m.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(m.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:N};for(var j=[],U=m,G;U.isNegative()||U.compareAbs(T)>=0;){G=U.divmod(T),U=G.quotient;var W=G.remainder;W.isNegative()&&(W=T.minus(W).abs(),U=U.next()),j.push(W.toJSNumber())}return j.push(U.toJSNumber()),{value:j.reverse(),isNegative:N}}function Jt(m,T,x){var N=At(m,T);return(N.isNegative?"-":"")+N.value.map(function(j){return In(j,x)}).join("")}p.prototype.toArray=function(m){return At(this,m)},y.prototype.toArray=function(m){return At(this,m)},O.prototype.toArray=function(m){return At(this,m)},p.prototype.toString=function(m,T){if(m===t&&(m=10),m!==10||T)return Jt(this,m,T);for(var x=this.value,N=x.length,j=String(x[--N]),U="0000000",G;--N>=0;)G=String(x[N]),j+=U.slice(G.length)+G;var W=this.sign?"-":"";return W+j},y.prototype.toString=function(m,T){return m===t&&(m=10),m!=10||T?Jt(this,m,T):String(this.value)},O.prototype.toString=y.prototype.toString,O.prototype.toJSON=p.prototype.toJSON=y.prototype.toJSON=function(){return this.toString()},p.prototype.valueOf=function(){return parseInt(this.toString(),10)},p.prototype.toJSNumber=p.prototype.valueOf,y.prototype.valueOf=function(){return this.value},y.prototype.toJSNumber=y.prototype.valueOf,O.prototype.valueOf=O.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function gr(m){if(V(+m)){var T=+m;if(T===le(T))return v?new O(BigInt(T)):new y(T);throw new Error("Invalid integer: "+m)}var x=m[0]==="-";x&&(m=m.slice(1));var N=m.split(/e/i);if(N.length>2)throw new Error("Invalid integer: "+N.join("e"));if(N.length===2){var j=N[1];if(j[0]==="+"&&(j=j.slice(1)),j=+j,j!==le(j)||!V(j))throw new Error("Invalid integer: "+j+" is not a valid exponent.");var U=N[0],G=U.indexOf(".");if(G>=0&&(j-=U.length-G-1,U=U.slice(0,G)+U.slice(G+1)),j<0)throw new Error("Cannot include negative exponent part for integers");U+=new Array(j+1).join("0"),m=U}var W=/^([0-9][0-9]*)$/.test(m);if(!W)throw new Error("Invalid integer: "+m);if(v)return new O(BigInt(x?"-"+m:m));for(var Y=[],Ee=m.length,Ze=i,Be=Ee-Ze;Ee>0;)Y.push(+m.slice(Be,Ee)),Be-=Ze,Be<0&&(Be=0),Ee-=Ze;return z(Y),new p(Y,x)}function Dr(m){if(v)return new O(BigInt(m));if(V(m)){if(m!==le(m))throw new Error(m+" is not an integer.");return new y(m)}return gr(m.toString())}function ke(m){return typeof m=="number"?Dr(m):typeof m=="string"?gr(m):typeof m=="bigint"?new O(m):m}for(var gn=0;gn<1e3;gn++)g[gn]=ke(gn),gn>0&&(g[-gn]=ke(-gn));return g.one=g[1],g.zero=g[0],g.minusOne=g[-1],g.max=Pn,g.min=kt,g.gcd=Jn,g.lcm=pr,g.isInstance=function(m){return m instanceof p||m instanceof y||m instanceof O},g.randBetween=Qn,g.fromArray=function(m,T,x){return er(m.map(ke),ke(T||10),x)},g}();n.hasOwnProperty("exports")&&(n.exports=e)})(qo);var Au=qo.exports,Yo=Oa(Au);const Xo=64,ma=16,Gr=Xo/ma;function Iu(){try{return!0}catch{return!1}}function Ou(n,e,t){let r=0;for(let i=0;i<t;i++){const s=n[e+i];if(s===void 0)break;r+=s*16**i}return r}function Jo(n){const e=[];for(let t=0;t<n.length;t++){let r=Number(n[t]);for(let i=0;r||i<e.length;i++)r+=(e[i]||0)*10,e[i]=r%16,r=(r-e[i])/16}return e}function xu(n){const e=Jo(n),t=Array(Gr);for(let r=0;r<Gr;r++)t[Gr-1-r]=Ou(e,r*Gr,Gr);return t}class sr{static fromString(e){return new sr(xu(e),e)}static fromBit(e){const t=Array(Gr),r=Math.floor(e/ma);for(let i=0;i<Gr;i++)t[Gr-1-i]=i===r?1<<e-r*ma:0;return new sr(t)}constructor(e,t){this.parts=e,this.str=t}and({parts:e}){return new sr(this.parts.map((t,r)=>t&e[r]))}or({parts:e}){return new sr(this.parts.map((t,r)=>t|e[r]))}xor({parts:e}){return new sr(this.parts.map((t,r)=>t^e[r]))}not(){return new sr(this.parts.map(e=>~e))}equals({parts:e}){return this.parts.every((t,r)=>t===e[r])}toString(){if(this.str!=null)return this.str;const e=new Array(Xo/4);return this.parts.forEach((t,r)=>{const i=Jo(t.toString());for(let s=0;s<4;s++)e[s+r*4]=i[3-s]||0}),this.str=Yo.fromArray(e,16).toString()}toJSON(){return this.toString()}}const ti=Iu();ti&&BigInt.prototype.toJSON==null&&(BigInt.prototype.toJSON=function(){return this.toString()});const cs={},Qo=ti?function(e){return BigInt(e)}:function(e){return e instanceof sr?e:(typeof e=="number"&&(e=e.toString()),cs[e]!=null||(cs[e]=sr.fromString(e)),cs[e])},sn=Qo(0),ks=ti?function(e=sn,t=sn){return e&t}:function(e=sn,t=sn){return e.and(t)},el=ti?function(e=sn,t=sn){return e|t}:function(e=sn,t=sn){return e.or(t)},Du=ti?function(e=sn,t=sn){return e^t}:function(e=sn,t=sn){return e.xor(t)},Ru=ti?function(e=sn){return~e}:function(e=sn){return e.not()},Pa=ti?function(e,t){return e===t}:function(e,t){return e==null||t==null?e==t:e.equals(t)};function Nu(...n){let e=n[0];for(let t=1;t<n.length;t++)e=el(e,n[t]);return e}function Pu(n,e){return Pa(ks(n,e),e)}function ku(n,e){return!Pa(ks(n,e),sn)}function $u(n,e){return e===sn?n:el(n,e)}function Lu(n,e){return e===sn?n:Du(n,ks(n,e))}const Cu=ti?function(e){return BigInt(1)<<BigInt(e)}:function(e){return sr.fromBit(e)};var so={combine:Nu,add:$u,remove:Lu,filter:ks,invert:Ru,has:Pu,hasAny:ku,equals:Pa,deserialize:Qo,getFlag:Cu},ao;(function(n){n[n.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",n[n.CLOSE_UNSUPPORTED=1003]="CLOSE_UNSUPPORTED",n[n.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",n[n.INVALID_CLIENTID=4e3]="INVALID_CLIENTID",n[n.INVALID_ORIGIN=4001]="INVALID_ORIGIN",n[n.RATELIMITED=4002]="RATELIMITED",n[n.TOKEN_REVOKED=4003]="TOKEN_REVOKED",n[n.INVALID_VERSION=4004]="INVALID_VERSION",n[n.INVALID_ENCODING=4005]="INVALID_ENCODING"})(ao||(ao={}));var ya;(function(n){n[n.INVALID_PAYLOAD=4e3]="INVALID_PAYLOAD",n[n.INVALID_COMMAND=4002]="INVALID_COMMAND",n[n.INVALID_EVENT=4004]="INVALID_EVENT",n[n.INVALID_PERMISSIONS=4006]="INVALID_PERMISSIONS"})(ya||(ya={}));var va;(function(n){n.LANDSCAPE="landscape",n.PORTRAIT="portrait"})(va||(va={}));var Ar;(function(n){n.MOBILE="mobile",n.DESKTOP="desktop"})(Ar||(Ar={}));Object.freeze({CREATE_INSTANT_INVITE:so.getFlag(0),ADMINISTRATOR:so.getFlag(3)});function hn(n){return Ko(e=>{var t;const[r]=(t=Object.entries(n).find(([,i])=>i===e))!==null&&t!==void 0?t:[];return e!=null&&r===void 0?n.UNHANDLED:e},P().or(Pe()))}function Bu(n){const e=Da().transform(t=>{const r=n.safeParse(t);return r.success?r.data:n._def.defaultValue()});return e.overlayType=n,e}const Mu=xe.object({image_url:xe.string()}),Uu=xe.object({mediaUrl:xe.string().max(1024)}),Fu=xe.object({access_token:xe.union([xe.string(),xe.null()]).optional()}),tl=xe.object({access_token:xe.string(),user:xe.object({username:xe.string(),discriminator:xe.string(),id:xe.string(),avatar:xe.union([xe.string(),xe.null()]).optional(),public_flags:xe.number(),global_name:xe.union([xe.string(),xe.null()]).optional()}),scopes:xe.array(Bu(xe.enum(["identify","email","connections","guilds","guilds.join","guilds.members.read","guilds.channels.read","gdm.join","bot","rpc","rpc.notifications.read","rpc.voice.read","rpc.voice.write","rpc.video.read","rpc.video.write","rpc.screenshare.read","rpc.screenshare.write","rpc.activities.write","webhook.incoming","messages.read","applications.builds.upload","applications.builds.read","applications.commands","applications.commands.permissions.update","applications.commands.update","applications.store.update","applications.entitlements","activities.read","activities.write","relationships.read","relationships.write","voice","dm_channels.read","role_connections.write","presences.read","presences.write","openid","dm_channels.messages.read","dm_channels.messages.write","gateway.connect","account.global_name.update","payment_sources.country_code","sdk.social_layer"]).or(xe.literal(-1)).default(-1))),expires:xe.string(),application:xe.object({description:xe.string(),icon:xe.union([xe.string(),xe.null()]).optional(),id:xe.string(),rpc_origins:xe.array(xe.string()).optional(),name:xe.string()})}),nl=xe.object({participants:xe.array(xe.object({id:xe.string(),username:xe.string(),global_name:xe.union([xe.string(),xe.null()]).optional(),discriminator:xe.string(),avatar:xe.union([xe.string(),xe.null()]).optional(),flags:xe.number(),bot:xe.boolean(),avatar_decoration_data:xe.union([xe.object({asset:xe.string(),skuId:xe.string().optional()}),xe.null()]).optional(),premium_type:xe.union([xe.number(),xe.null()]).optional(),nickname:xe.string().optional()}))});var or;(function(n){n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.AUTHENTICATE="AUTHENTICATE",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(or||(or={}));const Vu=xe.object({}).optional().nullable(),oo=xe.void(),rl={[or.INITIATE_IMAGE_UPLOAD]:{request:oo,response:Mu},[or.OPEN_SHARE_MOMENT_DIALOG]:{request:Uu,response:Vu},[or.AUTHENTICATE]:{request:Fu,response:tl},[or.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS]:{request:oo,response:nl}},ju="DISPATCH";var $e;(function(n){n.AUTHORIZE="AUTHORIZE",n.AUTHENTICATE="AUTHENTICATE",n.GET_GUILDS="GET_GUILDS",n.GET_GUILD="GET_GUILD",n.GET_CHANNEL="GET_CHANNEL",n.GET_CHANNELS="GET_CHANNELS",n.SELECT_VOICE_CHANNEL="SELECT_VOICE_CHANNEL",n.SELECT_TEXT_CHANNEL="SELECT_TEXT_CHANNEL",n.SUBSCRIBE="SUBSCRIBE",n.UNSUBSCRIBE="UNSUBSCRIBE",n.CAPTURE_SHORTCUT="CAPTURE_SHORTCUT",n.SET_CERTIFIED_DEVICES="SET_CERTIFIED_DEVICES",n.SET_ACTIVITY="SET_ACTIVITY",n.GET_SKUS="GET_SKUS",n.GET_ENTITLEMENTS="GET_ENTITLEMENTS",n.GET_SKUS_EMBEDDED="GET_SKUS_EMBEDDED",n.GET_ENTITLEMENTS_EMBEDDED="GET_ENTITLEMENTS_EMBEDDED",n.START_PURCHASE="START_PURCHASE",n.SET_CONFIG="SET_CONFIG",n.SEND_ANALYTICS_EVENT="SEND_ANALYTICS_EVENT",n.USER_SETTINGS_GET_LOCALE="USER_SETTINGS_GET_LOCALE",n.OPEN_EXTERNAL_LINK="OPEN_EXTERNAL_LINK",n.ENCOURAGE_HW_ACCELERATION="ENCOURAGE_HW_ACCELERATION",n.CAPTURE_LOG="CAPTURE_LOG",n.SET_ORIENTATION_LOCK_STATE="SET_ORIENTATION_LOCK_STATE",n.OPEN_INVITE_DIALOG="OPEN_INVITE_DIALOG",n.GET_PLATFORM_BEHAVIORS="GET_PLATFORM_BEHAVIORS",n.GET_CHANNEL_PERMISSIONS="GET_CHANNEL_PERMISSIONS",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})($e||($e={}));const Oi=ue({cmd:P(),data:Ki(),evt:Ra(),nonce:P()}).passthrough(),Hu=Object.assign(Object.assign({},tl.shape.scopes.element.overlayType._def.innerType.options[0].Values),{UNHANDLED:-1});hn(Hu);const Qr=ue({id:P(),username:P(),discriminator:P(),global_name:P().optional().nullable(),avatar:P().optional().nullable(),avatar_decoration_data:ue({asset:P(),sku_id:P().optional()}).nullable(),bot:He(),flags:Pe().optional().nullable(),premium_type:Pe().optional().nullable()}),ka=ue({user:Qr,nick:P().optional().nullable(),roles:ht(P()),joined_at:P(),deaf:He(),mute:He()}),Gu=ue({user_id:P(),nick:P().optional().nullable(),guild_id:P(),avatar:P().optional().nullable(),avatar_decoration_data:ue({asset:P(),sku_id:P().optional().nullable()}).optional().nullable(),color_string:P().optional().nullable()}),$a=ue({id:P(),name:P().optional().nullable(),roles:ht(P()).optional().nullable(),user:Qr.optional().nullable(),require_colons:He().optional().nullable(),managed:He().optional().nullable(),animated:He().optional().nullable(),available:He().optional().nullable()}),il=ue({mute:He(),deaf:He(),self_mute:He(),self_deaf:He(),suppress:He()}),sl=ue({mute:He(),nick:P(),user:Qr,voice_state:il,volume:Pe()}),Zu={UNHANDLED:-1,IDLE:"idle",DND:"dnd",ONLINE:"online",OFFLINE:"offline"},us=hn(Zu),ki=ue({name:P(),type:Pe(),url:P().optional().nullable(),created_at:Pe().optional().nullable(),timestamps:ue({start:Pe(),end:Pe()}).partial().optional().nullable(),application_id:P().optional().nullable(),details:P().optional().nullable(),state:P().optional().nullable(),emoji:$a.optional().nullable(),party:ue({id:P().optional().nullable(),size:ht(Pe()).optional().nullable()}).optional().nullable(),assets:ue({large_image:P().nullable(),large_text:P().nullable(),small_image:P().nullable(),small_text:P().nullable()}).partial().optional().nullable(),secrets:ue({join:P(),match:P()}).partial().optional().nullable(),instance:He().optional().nullable(),flags:Pe().optional().nullable()}),zu={UNHANDLED:-1,ROLE:0,MEMBER:1},Wu=ue({id:P(),type:hn(zu),allow:P(),deny:P()}),La={UNHANDLED:-1,DM:1,GROUP_DM:3,GUILD_TEXT:0,GUILD_VOICE:2,GUILD_CATEGORY:4,GUILD_ANNOUNCEMENT:5,GUILD_STORE:6,ANNOUNCEMENT_THREAD:10,PUBLIC_THREAD:11,PRIVATE_THREAD:12,GUILD_STAGE_VOICE:13,GUILD_DIRECTORY:14,GUILD_FORUM:15},al=ue({id:P(),type:hn(La),guild_id:P().optional().nullable(),position:Pe().optional().nullable(),permission_overwrites:ht(Wu).optional().nullable(),name:P().optional().nullable(),topic:P().optional().nullable(),nsfw:He().optional().nullable(),last_message_id:P().optional().nullable(),bitrate:Pe().optional().nullable(),user_limit:Pe().optional().nullable(),rate_limit_per_user:Pe().optional().nullable(),recipients:ht(Qr).optional().nullable(),icon:P().optional().nullable(),owner_id:P().optional().nullable(),application_id:P().optional().nullable(),parent_id:P().optional().nullable(),last_pin_timestamp:P().optional().nullable()}),Ku=ue({user:Qr,guild_id:P(),status:us,activities:ht(ki),client_status:ue({desktop:us,mobile:us,web:us}).partial()}),qu=ue({id:P(),name:P(),color:Pe(),hoist:He(),position:Pe(),permissions:P(),managed:He(),mentionable:He()});ue({id:P(),name:P(),owner_id:P(),icon:P().nullable(),icon_hash:P().optional().nullable(),splash:P().nullable(),discovery_splash:P().nullable(),owner:He().optional().nullable(),permissions:P().optional().nullable(),region:P(),afk_channel_id:P().nullable(),afk_timeout:Pe(),widget_enabled:He().optional().nullable(),widget_channel_id:P().optional().nullable(),verification_level:Pe(),default_message_notifications:Pe(),explicit_content_filter:Pe(),roles:ht(qu),emojis:ht($a),features:ht(P()),mfa_level:Pe(),application_id:P().nullable(),system_channel_id:P().nullable(),system_channel_flags:Pe(),rules_channel_id:P().nullable(),joined_at:P().optional().nullable(),large:He().optional().nullable(),unavailable:He().optional().nullable(),member_count:Pe().optional().nullable(),voice_states:ht(il).optional().nullable(),members:ht(ka).optional().nullable(),channels:ht(al).optional().nullable(),presences:ht(Ku).optional().nullable(),max_presences:Pe().optional().nullable(),max_members:Pe().optional().nullable(),vanity_url_code:P().nullable(),description:P().nullable(),banner:P().nullable(),premium_tier:Pe(),premium_subscription_count:Pe().optional().nullable(),preferred_locale:P(),public_updates_channel_id:P().nullable(),max_video_channel_users:Pe().optional().nullable(),approximate_member_count:Pe().optional().nullable(),approximate_presence_count:Pe().optional().nullable()});const Yu=ue({id:P(),guild_id:P(),type:Pe(),name:P()}),Xu=ue({id:P(),filename:P(),size:Pe(),url:P(),proxy_url:P(),height:Pe().optional().nullable(),width:Pe().optional().nullable()}),Ju=ue({text:P(),icon_url:P().optional().nullable(),proxy_icon_url:P().optional().nullable()}),ba=ue({url:P().optional().nullable(),proxy_url:P().optional().nullable(),height:Pe().optional().nullable(),width:Pe().optional().nullable()}),Qu=ba.omit({proxy_url:!0}),ef=ue({name:P().optional().nullable(),url:P().optional().nullable()}),tf=ue({name:P().optional().nullable(),url:P().optional().nullable(),icon_url:P().optional().nullable(),proxy_icon_url:P().optional().nullable()}),nf=ue({name:P(),value:P(),inline:He()}),rf=ue({title:P().optional().nullable(),type:P().optional().nullable(),description:P().optional().nullable(),url:P().optional().nullable(),timestamp:P().optional().nullable(),color:Pe().optional().nullable(),footer:Ju.optional().nullable(),image:ba.optional().nullable(),thumbnail:ba.optional().nullable(),video:Qu.optional().nullable(),provider:ef.optional().nullable(),author:tf.optional().nullable(),fields:ht(nf).optional().nullable()}),sf=ue({count:Pe(),me:He(),emoji:$a}),af=ue({type:Pe(),party_id:P().optional().nullable()}),of=ue({id:P(),cover_image:P().optional().nullable(),description:P(),icon:P().optional().nullable(),name:P()}),lf=ue({message_id:P().optional().nullable(),channel_id:P().optional().nullable(),guild_id:P().optional().nullable()}),cf=ue({id:P(),channel_id:P(),guild_id:P().optional().nullable(),author:Qr.optional().nullable(),member:ka.optional().nullable(),content:P(),timestamp:P(),edited_timestamp:P().optional().nullable(),tts:He(),mention_everyone:He(),mentions:ht(Qr),mention_roles:ht(P()),mention_channels:ht(Yu),attachments:ht(Xu),embeds:ht(rf),reactions:ht(sf).optional().nullable(),nonce:Na([P(),Pe()]).optional().nullable(),pinned:He(),webhook_id:P().optional().nullable(),type:Pe(),activity:af.optional().nullable(),application:of.optional().nullable(),message_reference:lf.optional().nullable(),flags:Pe().optional().nullable(),stickers:ht(Ki()).optional().nullable(),referenced_message:Ki().optional().nullable()}),uf=ue({id:P(),name:P()}),ff={UNHANDLED:-1,KEYBOARD_KEY:0,MOUSE_BUTTON:1,KEYBOARD_MODIFIER_KEY:2,GAMEPAD_BUTTON:3},ol=ue({type:hn(ff),code:Pe(),name:P()}),hf={UNHANDLED:-1,PUSH_TO_TALK:"PUSH_TO_TALK",VOICE_ACTIVITY:"VOICE_ACTIVITY"},df=ue({type:hn(hf),auto_threshold:He(),threshold:Pe(),shortcut:ht(ol),delay:Pe()}),lo=ue({device_id:P(),volume:Pe(),available_devices:ht(uf)}),pf={UNHANDLED:-1,AUDIO_INPUT:"AUDIO_INPUT",AUDIO_OUTPUT:"AUDIO_OUTPUT",VIDEO_INPUT:"VIDEO_INPUT"};ue({type:hn(pf),id:P(),vendor:ue({name:P(),url:P()}),model:ue({name:P(),url:P()}),related:ht(P()),echo_cancellation:He().optional().nullable(),noise_suppression:He().optional().nullable(),automatic_gain_control:He().optional().nullable(),hardware_mute:He().optional().nullable()});const gf={UNHANDLED:-1,APPLICATION:1,DLC:2,CONSUMABLE:3,BUNDLE:4,SUBSCRIPTION:5},mf=ue({id:P(),name:P(),type:hn(gf),price:ue({amount:Pe(),currency:P()}),application_id:P(),flags:Pe(),release_date:P().nullable()}),yf={UNHANDLED:-1,PURCHASE:1,PREMIUM_SUBSCRIPTION:2,DEVELOPER_GIFT:3,TEST_MODE_PURCHASE:4,FREE_PURCHASE:5,USER_GIFT:6,PREMIUM_PURCHASE:7},Ca=ue({id:P(),sku_id:P(),application_id:P(),user_id:P(),gift_code_flags:Pe(),type:hn(yf),gifter_user_id:P().optional().nullable(),branches:ht(P()).optional().nullable(),starts_at:P().optional().nullable(),ends_at:P().optional().nullable(),parent_id:P().optional().nullable(),consumed:He().optional().nullable(),deleted:He().optional().nullable(),gift_code_batch_id:P().optional().nullable()}),vf={UNHANDLED:-1,UNLOCKED:1,PORTRAIT:2,LANDSCAPE:3};hn(vf);const bf={UNHANDLED:-1,NOMINAL:0,FAIR:1,SERIOUS:2,CRITICAL:3},Ef=hn(bf),ll={UNHANDLED:-1,PORTRAIT:0,LANDSCAPE:1};hn(ll);const cl={UNHANDLED:-1,FOCUSED:0,PIP:1,GRID:2};hn(cl);const Ba="ERROR";var mt;(function(n){n.READY="READY",n.VOICE_STATE_UPDATE="VOICE_STATE_UPDATE",n.SPEAKING_START="SPEAKING_START",n.SPEAKING_STOP="SPEAKING_STOP",n.ACTIVITY_LAYOUT_MODE_UPDATE="ACTIVITY_LAYOUT_MODE_UPDATE",n.ORIENTATION_UPDATE="ORIENTATION_UPDATE",n.CURRENT_USER_UPDATE="CURRENT_USER_UPDATE",n.CURRENT_GUILD_MEMBER_UPDATE="CURRENT_GUILD_MEMBER_UPDATE",n.ENTITLEMENT_CREATE="ENTITLEMENT_CREATE",n.THERMAL_STATE_UPDATE="THERMAL_STATE_UPDATE",n.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE="ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE"})(mt||(mt={}));const xn=Oi.extend({evt:Ii(mt),nonce:P().nullable(),cmd:Yt(ju),data:ue({}).passthrough()}),ul=Oi.extend({evt:Yt(Ba),data:ue({code:Pe(),message:P().optional()}).passthrough(),cmd:Ii($e),nonce:P().nullable()}),_f=xn.extend({evt:P()}),wf=Na([xn,_f,ul]);function Tf(n){const e=n.evt;if(!(e in mt))throw new Error(`Unrecognized event type ${n.evt}`);return Sf[e].payload.parse(n)}const Sf={[mt.READY]:{payload:xn.extend({evt:Yt(mt.READY),data:ue({v:Pe(),config:ue({cdn_host:P().optional(),api_endpoint:P(),environment:P()}),user:ue({id:P(),username:P(),discriminator:P(),avatar:P().optional()}).optional()})})},[mt.VOICE_STATE_UPDATE]:{payload:xn.extend({evt:Yt(mt.VOICE_STATE_UPDATE),data:sl}),subscribeArgs:ue({channel_id:P()})},[mt.SPEAKING_START]:{payload:xn.extend({evt:Yt(mt.SPEAKING_START),data:ue({lobby_id:P().optional(),channel_id:P().optional(),user_id:P()})}),subscribeArgs:ue({lobby_id:P().nullable().optional(),channel_id:P().nullable().optional()})},[mt.SPEAKING_STOP]:{payload:xn.extend({evt:Yt(mt.SPEAKING_STOP),data:ue({lobby_id:P().optional(),channel_id:P().optional(),user_id:P()})}),subscribeArgs:ue({lobby_id:P().nullable().optional(),channel_id:P().nullable().optional()})},[mt.ACTIVITY_LAYOUT_MODE_UPDATE]:{payload:xn.extend({evt:Yt(mt.ACTIVITY_LAYOUT_MODE_UPDATE),data:ue({layout_mode:hn(cl)})})},[mt.ORIENTATION_UPDATE]:{payload:xn.extend({evt:Yt(mt.ORIENTATION_UPDATE),data:ue({screen_orientation:hn(ll),orientation:Ii(va)})})},[mt.CURRENT_USER_UPDATE]:{payload:xn.extend({evt:Yt(mt.CURRENT_USER_UPDATE),data:Qr})},[mt.CURRENT_GUILD_MEMBER_UPDATE]:{payload:xn.extend({evt:Yt(mt.CURRENT_GUILD_MEMBER_UPDATE),data:Gu}),subscribeArgs:ue({guild_id:P()})},[mt.ENTITLEMENT_CREATE]:{payload:xn.extend({evt:Yt(mt.ENTITLEMENT_CREATE),data:ue({entitlement:Ca})})},[mt.THERMAL_STATE_UPDATE]:{payload:xn.extend({evt:Yt(mt.THERMAL_STATE_UPDATE),data:ue({thermal_state:Ef})})},[mt.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE]:{payload:xn.extend({evt:Yt(mt.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE),data:ue({participants:nl.shape.participants})})}};function Af(n,e){throw e}const Xi=ue({}).nullable(),fl=ue({code:P()}),If=ue({guilds:ht(ue({id:P(),name:P()}))}),Of=ue({id:P(),name:P(),icon_url:P().optional(),members:ht(ka)}),Si=ue({id:P(),type:hn(La),guild_id:P().optional().nullable(),name:P().optional().nullable(),topic:P().optional().nullable(),bitrate:Pe().optional().nullable(),user_limit:Pe().optional().nullable(),position:Pe().optional().nullable(),voice_states:ht(sl),messages:ht(cf)}),xf=ue({channels:ht(al)});Si.nullable();const Df=Si.nullable(),Rf=Si.nullable();ue({input:lo,output:lo,mode:df,automatic_gain_control:He(),echo_cancellation:He(),noise_suppression:He(),qos:He(),silence_warning:He(),deaf:He(),mute:He()});const Nf=ue({evt:P()}),Pf=ue({shortcut:ol}),hl=ki,dl=ue({skus:ht(mf)}),pl=ue({entitlements:ht(Ca)}),gl=ht(Ca).nullable(),ml=ue({use_interactive_pip:He()}),yl=ue({locale:P()}),vl=ue({enabled:He()}),bl=ue({permissions:zo().or(P())}),El=ue({iosKeyboardResizesView:Wo(He())}),kf=Oi.extend({cmd:Ii($e),evt:Ra()});function $f({cmd:n,data:e}){switch(n){case $e.AUTHORIZE:return fl.parse(e);case $e.CAPTURE_SHORTCUT:return Pf.parse(e);case $e.ENCOURAGE_HW_ACCELERATION:return vl.parse(e);case $e.GET_CHANNEL:return Si.parse(e);case $e.GET_CHANNELS:return xf.parse(e);case $e.GET_CHANNEL_PERMISSIONS:return bl.parse(e);case $e.GET_GUILD:return Of.parse(e);case $e.GET_GUILDS:return If.parse(e);case $e.GET_PLATFORM_BEHAVIORS:return El.parse(e);case $e.GET_CHANNEL:return Si.parse(e);case $e.SELECT_TEXT_CHANNEL:return Rf.parse(e);case $e.SELECT_VOICE_CHANNEL:return Df.parse(e);case $e.SET_ACTIVITY:return hl.parse(e);case $e.GET_SKUS_EMBEDDED:return dl.parse(e);case $e.GET_ENTITLEMENTS_EMBEDDED:return pl.parse(e);case $e.SET_CONFIG:return ml.parse(e);case $e.START_PURCHASE:return gl.parse(e);case $e.SUBSCRIBE:case $e.UNSUBSCRIBE:return Nf.parse(e);case $e.USER_SETTINGS_GET_LOCALE:return yl.parse(e);case $e.OPEN_EXTERNAL_LINK:case $e.SET_ORIENTATION_LOCK_STATE:case $e.SET_CERTIFIED_DEVICES:case $e.SEND_ANALYTICS_EVENT:case $e.OPEN_INVITE_DIALOG:case $e.CAPTURE_LOG:case $e.GET_SKUS:case $e.GET_ENTITLEMENTS:return Xi.parse(e);case $e.AUTHENTICATE:case $e.INITIATE_IMAGE_UPLOAD:case $e.OPEN_SHARE_MOMENT_DIALOG:case $e.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS:const{response:t}=rl[n];return t.parse(e);default:Af(n,new Error(`Unrecognized command ${n}`))}}function Lf(n){return Object.assign(Object.assign({},n),{data:$f(n)})}ue({frame_id:P(),platform:Ii(Ar).optional().nullable()});ue({v:Yt(1),encoding:Yt("json").optional(),client_id:P(),frame_id:P()});const Cf=ue({code:Pe(),message:P().optional()}),Bf=ue({evt:P().nullable(),nonce:P().nullable(),data:Ki().nullable(),cmd:P()}).passthrough();function Mf(n){const e=Bf.parse(n);return e.evt!=null?e.evt===Ba?ul.parse(e):Tf(wf.parse(e)):Lf(kf.passthrough().parse(e))}function Sn(n,e,t,r=()=>{}){const i=Oi.extend({cmd:Yt(e),data:t});return async s=>{const c=await n({cmd:e,args:s,transfer:r(s)});return i.parse(c).data}}function $s(n,e=()=>{}){const t=rl[n].response,r=Oi.extend({cmd:Yt(n),data:t});return i=>async s=>{const c=await i({cmd:n,args:s,transfer:e(s)});return r.parse(c).data}}const Uf=$s(or.AUTHENTICATE),Ff=n=>Sn(n,$e.AUTHORIZE,fl),Vf=n=>Sn(n,$e.CAPTURE_LOG,Xi),jf=n=>Sn(n,$e.ENCOURAGE_HW_ACCELERATION,vl),Hf=n=>Sn(n,$e.GET_ENTITLEMENTS_EMBEDDED,pl),Gf=n=>Sn(n,$e.GET_SKUS_EMBEDDED,dl),Zf=n=>Sn(n,$e.GET_CHANNEL_PERMISSIONS,bl),zf=n=>Sn(n,$e.GET_PLATFORM_BEHAVIORS,El),Wf=n=>Sn(n,$e.OPEN_EXTERNAL_LINK,Xi),Kf=n=>Sn(n,$e.OPEN_INVITE_DIALOG,Xi),qf=$s(or.OPEN_SHARE_MOMENT_DIALOG);ki.pick({state:!0,details:!0,timestamps:!0,assets:!0,party:!0,secrets:!0,instance:!0,type:!0}).extend({type:ki.shape.type.optional(),instance:ki.shape.instance.optional()}).nullable();const Yf=n=>Sn(n,$e.SET_ACTIVITY,hl),Xf=n=>Sn(n,$e.SET_CONFIG,ml);function Jf({sendCommand:n,cmd:e,response:t,fallbackTransform:r,transferTransform:i=()=>{}}){const s=Oi.extend({cmd:Yt(e),data:t});return async c=>{try{const u=await n({cmd:e,args:c,transfer:i(c)});return s.parse(u).data}catch(u){if(u.code===ya.INVALID_PAYLOAD){const v=r(c),g=await n({cmd:e,args:v,transfer:i(v)});return s.parse(g).data}else throw u}}}const Qf=n=>({lock_state:n.lock_state,picture_in_picture_lock_state:n.picture_in_picture_lock_state}),eh=n=>Jf({sendCommand:n,cmd:$e.SET_ORIENTATION_LOCK_STATE,response:Xi,fallbackTransform:Qf}),th=n=>Sn(n,$e.START_PURCHASE,gl),nh=n=>Sn(n,$e.USER_SETTINGS_GET_LOCALE,yl),rh=$s(or.INITIATE_IMAGE_UPLOAD),ih=n=>Sn(n,$e.GET_CHANNEL,Si),sh=$s(or.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS);function ah(n){return{authenticate:Uf(n),authorize:Ff(n),captureLog:Vf(n),encourageHardwareAcceleration:jf(n),getChannel:ih(n),getChannelPermissions:Zf(n),getEntitlements:Hf(n),getPlatformBehaviors:zf(n),getSkus:Gf(n),openExternalLink:Wf(n),openInviteDialog:Kf(n),openShareMomentDialog:qf(n),setActivity:Yf(n),setConfig:Xf(n),setOrientationLockState:eh(n),startPurchase:th(n),userSettingsGetLocale:nh(n),initiateImageUpload:rh(n),getInstanceConnectedParticipants:sh(n)}}class oh extends Error{constructor(e,t=""){super(t),this.code=e,this.message=t,this.name="Discord SDK Error"}}function _l(){return{disableConsoleLogOverride:!1}}const lh=["log","warn","debug","info","error"];function ch(n,e,t){const r=n[e],i=n;r&&(n[e]=function(){const s=[].slice.call(arguments),c=""+s.join(" ");t(e,c),r.apply(i,s)})}var uh=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),co={randomUUID:uh},fs,fh=new Uint8Array(16);function hh(){if(!fs&&(fs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!fs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return fs(fh)}var rn=[];for(var Qs=0;Qs<256;++Qs)rn.push((Qs+256).toString(16).slice(1));function dh(n,e=0){return(rn[n[e+0]]+rn[n[e+1]]+rn[n[e+2]]+rn[n[e+3]]+"-"+rn[n[e+4]]+rn[n[e+5]]+"-"+rn[n[e+6]]+rn[n[e+7]]+"-"+rn[n[e+8]]+rn[n[e+9]]+"-"+rn[n[e+10]]+rn[n[e+11]]+rn[n[e+12]]+rn[n[e+13]]+rn[n[e+14]]+rn[n[e+15]]).toLowerCase()}function uo(n,e,t){if(co.randomUUID&&!e&&!n)return co.randomUUID();n=n||{};var r=n.random||(n.rng||hh)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,dh(r)}var Sr;(function(n){n[n.HANDSHAKE=0]="HANDSHAKE",n[n.FRAME=1]="FRAME",n[n.CLOSE=2]="CLOSE",n[n.HELLO=3]="HELLO"})(Sr||(Sr={}));const ph=new Set(gh());function gh(){return typeof window>"u"?[]:[window.location.origin,"https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]}function mh(){var n;return[(n=window.parent.opener)!==null&&n!==void 0?n:window.parent,document.referrer?document.referrer:"*"]}class yh{getTransfer(e){var t;switch(e.cmd){case $e.SUBSCRIBE:case $e.UNSUBSCRIBE:return;default:return(t=e.transfer)!==null&&t!==void 0?t:void 0}}constructor(e,t){if(this.source=null,this.sourceOrigin="",this.eventBus=new Uo,this.pendingCommands=new Map,this.sendCommand=u=>{var v;if(this.source==null)throw new Error("Attempting to send message before initialization");const g=uo();return(v=this.source)===null||v===void 0||v.postMessage([Sr.FRAME,Object.assign(Object.assign({},u),{nonce:g})],this.sourceOrigin,this.getTransfer(u)),new Promise((y,O)=>{this.pendingCommands.set(g,{resolve:y,reject:O})})},this.commands=ah(this.sendCommand),this.handleMessage=u=>{if(!ph.has(u.origin))return;const v=u.data;if(!Array.isArray(v))return;const[g,p]=v;switch(g){case Sr.HELLO:return;case Sr.CLOSE:return this.handleClose(p);case Sr.HANDSHAKE:return this.handleHandshake();case Sr.FRAME:return this.handleFrame(p);default:throw new Error("Invalid message format")}},this.isReady=!1,this.clientId=e,this.configuration=t??_l(),typeof window<"u"&&window.addEventListener("message",this.handleMessage),typeof window>"u"){this.frameId="",this.instanceId="",this.platform=Ar.DESKTOP,this.guildId=null,this.channelId=null;return}const r=new URLSearchParams(this._getSearch()),i=r.get("frame_id");if(!i)throw new Error("frame_id query param is not defined");this.frameId=i;const s=r.get("instance_id");if(!s)throw new Error("instance_id query param is not defined");this.instanceId=s;const c=r.get("platform");if(c){if(c!==Ar.DESKTOP&&c!==Ar.MOBILE)throw new Error(`Invalid query param "platform" of "${c}". Valid values are "${Ar.DESKTOP}" or "${Ar.MOBILE}"`)}else throw new Error("platform query param is not defined");this.platform=c,this.guildId=r.get("guild_id"),this.channelId=r.get("channel_id"),[this.source,this.sourceOrigin]=mh(),this.addOnReadyListener(),this.handshake()}close(e,t){var r;window.removeEventListener("message",this.handleMessage);const i=uo();(r=this.source)===null||r===void 0||r.postMessage([Sr.CLOSE,{code:e,message:t,nonce:i}],this.sourceOrigin)}async subscribe(e,t,...r){const[i]=r,s=this.eventBus.listenerCount(e),c=this.eventBus.on(e,t);return Object.values(mt).includes(e)&&e!==mt.READY&&s===0&&await this.sendCommand({cmd:$e.SUBSCRIBE,args:i,evt:e}),c}async unsubscribe(e,t,...r){const[i]=r;return e!==mt.READY&&this.eventBus.listenerCount(e)===1&&await this.sendCommand({cmd:$e.UNSUBSCRIBE,evt:e,args:i}),this.eventBus.off(e,t)}async ready(){this.isReady||await new Promise(e=>{this.eventBus.once(mt.READY,e)})}handshake(){var e;(e=this.source)===null||e===void 0||e.postMessage([Sr.HANDSHAKE,{v:1,encoding:"json",client_id:this.clientId,frame_id:this.frameId}],this.sourceOrigin)}addOnReadyListener(){this.eventBus.once(mt.READY,()=>{this.overrideConsoleLogging(),this.isReady=!0})}overrideConsoleLogging(){if(this.configuration.disableConsoleLogOverride)return;const e=(t,r)=>{this.commands.captureLog({level:t,message:r})};lh.forEach(t=>{ch(console,t,e)})}handleClose(e){Cf.parse(e)}handleHandshake(){}handleFrame(e){var t,r;let i;try{i=Mf(e)}catch(s){console.error("Failed to parse",e),console.error(s);return}if(i.cmd==="DISPATCH")this.eventBus.emit(i.evt,i.data);else{if(i.evt===Ba){if(i.nonce!=null){(t=this.pendingCommands.get(i.nonce))===null||t===void 0||t.reject(i.data),this.pendingCommands.delete(i.nonce);return}this.eventBus.emit("error",new oh(i.data.code,i.data.message))}if(i.nonce==null){console.error("Missing nonce",e);return}(r=this.pendingCommands.get(i.nonce))===null||r===void 0||r.resolve(i),this.pendingCommands.delete(i.nonce)}}_getSearch(){return typeof window>"u"?"":window.location.search}}var xi=1e9,vh={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Ol,Pt=!0,Vn="[DecimalError] ",ui=Vn+"Invalid argument: ",Ma=Vn+"Exponent out of range: ",Di=Math.floor,li=Math.pow,bh=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Dn,tn=1e7,Nt=7,wl=9007199254740991,Is=Di(wl/Nt),be={};be.absoluteValue=be.abs=function(){var n=new this.constructor(this);return n.s&&(n.s=1),n};be.comparedTo=be.cmp=function(n){var e,t,r,i,s=this;if(n=new s.constructor(n),s.s!==n.s)return s.s||-n.s;if(s.e!==n.e)return s.e>n.e^s.s<0?1:-1;for(r=s.d.length,i=n.d.length,e=0,t=r<i?r:i;e<t;++e)if(s.d[e]!==n.d[e])return s.d[e]>n.d[e]^s.s<0?1:-1;return r===i?0:r>i^s.s<0?1:-1};be.decimalPlaces=be.dp=function(){var n=this,e=n.d.length-1,t=(e-n.e)*Nt;if(e=n.d[e],e)for(;e%10==0;e/=10)t--;return t<0?0:t};be.dividedBy=be.div=function(n){return Ir(this,new this.constructor(n))};be.dividedToIntegerBy=be.idiv=function(n){var e=this,t=e.constructor;return xt(Ir(e,new t(n),0,1),t.precision)};be.equals=be.eq=function(n){return!this.cmp(n)};be.exponent=function(){return zt(this)};be.greaterThan=be.gt=function(n){return this.cmp(n)>0};be.greaterThanOrEqualTo=be.gte=function(n){return this.cmp(n)>=0};be.isInteger=be.isint=function(){return this.e>this.d.length-2};be.isNegative=be.isneg=function(){return this.s<0};be.isPositive=be.ispos=function(){return this.s>0};be.isZero=function(){return this.s===0};be.lessThan=be.lt=function(n){return this.cmp(n)<0};be.lessThanOrEqualTo=be.lte=function(n){return this.cmp(n)<1};be.logarithm=be.log=function(n){var e,t=this,r=t.constructor,i=r.precision,s=i+5;if(n===void 0)n=new r(10);else if(n=new r(n),n.s<1||n.eq(Dn))throw Error(Vn+"NaN");if(t.s<1)throw Error(Vn+(t.s?"NaN":"-Infinity"));return t.eq(Dn)?new r(0):(Pt=!1,e=Ir(qi(t,s),qi(n,s),s),Pt=!0,xt(e,i))};be.minus=be.sub=function(n){var e=this;return n=new e.constructor(n),e.s==n.s?Al(e,n):Tl(e,(n.s=-n.s,n))};be.modulo=be.mod=function(n){var e,t=this,r=t.constructor,i=r.precision;if(n=new r(n),!n.s)throw Error(Vn+"NaN");return t.s?(Pt=!1,e=Ir(t,n,0,1).times(n),Pt=!0,t.minus(e)):xt(new r(t),i)};be.naturalExponential=be.exp=function(){return Sl(this)};be.naturalLogarithm=be.ln=function(){return qi(this)};be.negated=be.neg=function(){var n=new this.constructor(this);return n.s=-n.s||0,n};be.plus=be.add=function(n){var e=this;return n=new e.constructor(n),e.s==n.s?Tl(e,n):Al(e,(n.s=-n.s,n))};be.precision=be.sd=function(n){var e,t,r,i=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(ui+n);if(e=zt(i)+1,r=i.d.length-1,t=r*Nt+1,r=i.d[r],r){for(;r%10==0;r/=10)t--;for(r=i.d[0];r>=10;r/=10)t++}return n&&e>t?e:t};be.squareRoot=be.sqrt=function(){var n,e,t,r,i,s,c,u=this,v=u.constructor;if(u.s<1){if(!u.s)return new v(0);throw Error(Vn+"NaN")}for(n=zt(u),Pt=!1,i=Math.sqrt(+u),i==0||i==1/0?(e=lr(u.d),(e.length+n)%2==0&&(e+="0"),i=Math.sqrt(e),n=Di((n+1)/2)-(n<0||n%2),i==1/0?e="5e"+n:(e=i.toExponential(),e=e.slice(0,e.indexOf("e")+1)+n),r=new v(e)):r=new v(i.toString()),t=v.precision,i=c=t+3;;)if(s=r,r=s.plus(Ir(u,s,c+2)).times(.5),lr(s.d).slice(0,c)===(e=lr(r.d)).slice(0,c)){if(e=e.slice(c-3,c+1),i==c&&e=="4999"){if(xt(s,t+1,0),s.times(s).eq(u)){r=s;break}}else if(e!="9999")break;c+=4}return Pt=!0,xt(r,t)};be.times=be.mul=function(n){var e,t,r,i,s,c,u,v,g,p=this,y=p.constructor,O=p.d,V=(n=new y(n)).d;if(!p.s||!n.s)return new y(0);for(n.s*=p.s,t=p.e+n.e,v=O.length,g=V.length,v<g&&(s=O,O=V,V=s,c=v,v=g,g=c),s=[],c=v+g,r=c;r--;)s.push(0);for(r=g;--r>=0;){for(e=0,i=v+r;i>r;)u=s[i]+V[r]*O[i-r-1]+e,s[i--]=u%tn|0,e=u/tn|0;s[i]=(s[i]+e)%tn|0}for(;!s[--c];)s.pop();return e?++t:s.shift(),n.d=s,n.e=t,Pt?xt(n,y.precision):n};be.toDecimalPlaces=be.todp=function(n,e){var t=this,r=t.constructor;return t=new r(t),n===void 0?t:(hr(n,0,xi),e===void 0?e=r.rounding:hr(e,0,8),xt(t,n+zt(t)+1,e))};be.toExponential=function(n,e){var t,r=this,i=r.constructor;return n===void 0?t=di(r,!0):(hr(n,0,xi),e===void 0?e=i.rounding:hr(e,0,8),r=xt(new i(r),n+1,e),t=di(r,!0,n+1)),t};be.toFixed=function(n,e){var t,r,i=this,s=i.constructor;return n===void 0?di(i):(hr(n,0,xi),e===void 0?e=s.rounding:hr(e,0,8),r=xt(new s(i),n+zt(i)+1,e),t=di(r.abs(),!1,n+zt(r)+1),i.isneg()&&!i.isZero()?"-"+t:t)};be.toInteger=be.toint=function(){var n=this,e=n.constructor;return xt(new e(n),zt(n)+1,e.rounding)};be.toNumber=function(){return+this};be.toPower=be.pow=function(n){var e,t,r,i,s,c,u=this,v=u.constructor,g=12,p=+(n=new v(n));if(!n.s)return new v(Dn);if(u=new v(u),!u.s){if(n.s<1)throw Error(Vn+"Infinity");return u}if(u.eq(Dn))return u;if(r=v.precision,n.eq(Dn))return xt(u,r);if(e=n.e,t=n.d.length-1,c=e>=t,s=u.s,c){if((t=p<0?-p:p)<=wl){for(i=new v(Dn),e=Math.ceil(r/Nt+4),Pt=!1;t%2&&(i=i.times(u),ho(i.d,e)),t=Di(t/2),t!==0;)u=u.times(u),ho(u.d,e);return Pt=!0,n.s<0?new v(Dn).div(i):xt(i,r)}}else if(s<0)throw Error(Vn+"NaN");return s=s<0&&n.d[Math.max(e,t)]&1?-1:1,u.s=1,Pt=!1,i=n.times(qi(u,r+g)),Pt=!0,i=Sl(i),i.s=s,i};be.toPrecision=function(n,e){var t,r,i=this,s=i.constructor;return n===void 0?(t=zt(i),r=di(i,t<=s.toExpNeg||t>=s.toExpPos)):(hr(n,1,xi),e===void 0?e=s.rounding:hr(e,0,8),i=xt(new s(i),n,e),t=zt(i),r=di(i,n<=t||t<=s.toExpNeg,n)),r};be.toSignificantDigits=be.tosd=function(n,e){var t=this,r=t.constructor;return n===void 0?(n=r.precision,e=r.rounding):(hr(n,1,xi),e===void 0?e=r.rounding:hr(e,0,8)),xt(new r(t),n,e)};be.toString=be.valueOf=be.val=be.toJSON=be[Symbol.for("nodejs.util.inspect.custom")]=function(){var n=this,e=zt(n),t=n.constructor;return di(n,e<=t.toExpNeg||e>=t.toExpPos)};function Tl(n,e){var t,r,i,s,c,u,v,g,p=n.constructor,y=p.precision;if(!n.s||!e.s)return e.s||(e=new p(n)),Pt?xt(e,y):e;if(v=n.d,g=e.d,c=n.e,i=e.e,v=v.slice(),s=c-i,s){for(s<0?(r=v,s=-s,u=g.length):(r=g,i=c,u=v.length),c=Math.ceil(y/Nt),u=c>u?c+1:u+1,s>u&&(s=u,r.length=1),r.reverse();s--;)r.push(0);r.reverse()}for(u=v.length,s=g.length,u-s<0&&(s=u,r=g,g=v,v=r),t=0;s;)t=(v[--s]=v[s]+g[s]+t)/tn|0,v[s]%=tn;for(t&&(v.unshift(t),++i),u=v.length;v[--u]==0;)v.pop();return e.d=v,e.e=i,Pt?xt(e,y):e}function hr(n,e,t){if(n!==~~n||n<e||n>t)throw Error(ui+n)}function lr(n){var e,t,r,i=n.length-1,s="",c=n[0];if(i>0){for(s+=c,e=1;e<i;e++)r=n[e]+"",t=Nt-r.length,t&&(s+=jr(t)),s+=r;c=n[e],r=c+"",t=Nt-r.length,t&&(s+=jr(t))}else if(c===0)return"0";for(;c%10===0;)c/=10;return s+c}var Ir=function(){function n(r,i){var s,c=0,u=r.length;for(r=r.slice();u--;)s=r[u]*i+c,r[u]=s%tn|0,c=s/tn|0;return c&&r.unshift(c),r}function e(r,i,s,c){var u,v;if(s!=c)v=s>c?1:-1;else for(u=v=0;u<s;u++)if(r[u]!=i[u]){v=r[u]>i[u]?1:-1;break}return v}function t(r,i,s){for(var c=0;s--;)r[s]-=c,c=r[s]<i[s]?1:0,r[s]=c*tn+r[s]-i[s];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,s,c){var u,v,g,p,y,O,V,X,Z,z,me,le,ve,Le,ut,St,yt,Rt,tt=r.constructor,bt=r.s==i.s?1:-1,_t=r.d,ot=i.d;if(!r.s)return new tt(r);if(!i.s)throw Error(Vn+"Division by zero");for(v=r.e-i.e,yt=ot.length,ut=_t.length,V=new tt(bt),X=V.d=[],g=0;ot[g]==(_t[g]||0);)++g;if(ot[g]>(_t[g]||0)&&--v,s==null?le=s=tt.precision:c?le=s+(zt(r)-zt(i))+1:le=s,le<0)return new tt(0);if(le=le/Nt+2|0,g=0,yt==1)for(p=0,ot=ot[0],le++;(g<ut||p)&&le--;g++)ve=p*tn+(_t[g]||0),X[g]=ve/ot|0,p=ve%ot|0;else{for(p=tn/(ot[0]+1)|0,p>1&&(ot=n(ot,p),_t=n(_t,p),yt=ot.length,ut=_t.length),Le=yt,Z=_t.slice(0,yt),z=Z.length;z<yt;)Z[z++]=0;Rt=ot.slice(),Rt.unshift(0),St=ot[0],ot[1]>=tn/2&&++St;do p=0,u=e(ot,Z,yt,z),u<0?(me=Z[0],yt!=z&&(me=me*tn+(Z[1]||0)),p=me/St|0,p>1?(p>=tn&&(p=tn-1),y=n(ot,p),O=y.length,z=Z.length,u=e(y,Z,O,z),u==1&&(p--,t(y,yt<O?Rt:ot,O))):(p==0&&(u=p=1),y=ot.slice()),O=y.length,O<z&&y.unshift(0),t(Z,y,z),u==-1&&(z=Z.length,u=e(ot,Z,yt,z),u<1&&(p++,t(Z,yt<z?Rt:ot,z))),z=Z.length):u===0&&(p++,Z=[0]),X[g++]=p,u&&Z[0]?Z[z++]=_t[Le]||0:(Z=[_t[Le]],z=1);while((Le++<ut||Z[0]!==void 0)&&le--)}return X[0]||X.shift(),V.e=v,xt(V,c?s+zt(V)+1:s)}}();function Sl(n,e){var t,r,i,s,c,u,v=0,g=0,p=n.constructor,y=p.precision;if(zt(n)>16)throw Error(Ma+zt(n));if(!n.s)return new p(Dn);for(e==null?(Pt=!1,u=y):u=e,c=new p(.03125);n.abs().gte(.1);)n=n.times(c),g+=5;for(r=Math.log(li(2,g))/Math.LN10*2+5|0,u+=r,t=i=s=new p(Dn),p.precision=u;;){if(i=xt(i.times(n),u),t=t.times(++v),c=s.plus(Ir(i,t,u)),lr(c.d).slice(0,u)===lr(s.d).slice(0,u)){for(;g--;)s=xt(s.times(s),u);return p.precision=y,e==null?(Pt=!0,xt(s,y)):s}s=c}}function zt(n){for(var e=n.e*Nt,t=n.d[0];t>=10;t/=10)e++;return e}function ea(n,e,t){if(e>n.LN10.sd())throw Pt=!0,t&&(n.precision=t),Error(Vn+"LN10 precision limit exceeded");return xt(new n(n.LN10),e)}function jr(n){for(var e="";n--;)e+="0";return e}function qi(n,e){var t,r,i,s,c,u,v,g,p,y=1,O=10,V=n,X=V.d,Z=V.constructor,z=Z.precision;if(V.s<1)throw Error(Vn+(V.s?"NaN":"-Infinity"));if(V.eq(Dn))return new Z(0);if(e==null?(Pt=!1,g=z):g=e,V.eq(10))return e==null&&(Pt=!0),ea(Z,g);if(g+=O,Z.precision=g,t=lr(X),r=t.charAt(0),s=zt(V),Math.abs(s)<15e14){for(;r<7&&r!=1||r==1&&t.charAt(1)>3;)V=V.times(n),t=lr(V.d),r=t.charAt(0),y++;s=zt(V),r>1?(V=new Z("0."+t),s++):V=new Z(r+"."+t.slice(1))}else return v=ea(Z,g+2,z).times(s+""),V=qi(new Z(r+"."+t.slice(1)),g-O).plus(v),Z.precision=z,e==null?(Pt=!0,xt(V,z)):V;for(u=c=V=Ir(V.minus(Dn),V.plus(Dn),g),p=xt(V.times(V),g),i=3;;){if(c=xt(c.times(p),g),v=u.plus(Ir(c,new Z(i),g)),lr(v.d).slice(0,g)===lr(u.d).slice(0,g))return u=u.times(2),s!==0&&(u=u.plus(ea(Z,g+2,z).times(s+""))),u=Ir(u,new Z(y),g),Z.precision=z,e==null?(Pt=!0,xt(u,z)):u;u=v,i+=2}}function fo(n,e){var t,r,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(t<0&&(t=r),t+=+e.slice(r+1),e=e.substring(0,r)):t<0&&(t=e.length),r=0;e.charCodeAt(r)===48;)++r;for(i=e.length;e.charCodeAt(i-1)===48;)--i;if(e=e.slice(r,i),e){if(i-=r,t=t-r-1,n.e=Di(t/Nt),n.d=[],r=(t+1)%Nt,t<0&&(r+=Nt),r<i){for(r&&n.d.push(+e.slice(0,r)),i-=Nt;r<i;)n.d.push(+e.slice(r,r+=Nt));e=e.slice(r),r=Nt-e.length}else r-=i;for(;r--;)e+="0";if(n.d.push(+e),Pt&&(n.e>Is||n.e<-Is))throw Error(Ma+t)}else n.s=0,n.e=0,n.d=[0];return n}function xt(n,e,t){var r,i,s,c,u,v,g,p,y=n.d;for(c=1,s=y[0];s>=10;s/=10)c++;if(r=e-c,r<0)r+=Nt,i=e,g=y[p=0];else{if(p=Math.ceil((r+1)/Nt),s=y.length,p>=s)return n;for(g=s=y[p],c=1;s>=10;s/=10)c++;r%=Nt,i=r-Nt+c}if(t!==void 0&&(s=li(10,c-i-1),u=g/s%10|0,v=e<0||y[p+1]!==void 0||g%s,v=t<4?(u||v)&&(t==0||t==(n.s<0?3:2)):u>5||u==5&&(t==4||v||t==6&&(r>0?i>0?g/li(10,c-i):0:y[p-1])%10&1||t==(n.s<0?8:7))),e<1||!y[0])return v?(s=zt(n),y.length=1,e=e-s-1,y[0]=li(10,(Nt-e%Nt)%Nt),n.e=Di(-e/Nt)||0):(y.length=1,y[0]=n.e=n.s=0),n;if(r==0?(y.length=p,s=1,p--):(y.length=p+1,s=li(10,Nt-r),y[p]=i>0?(g/li(10,c-i)%li(10,i)|0)*s:0),v)for(;;)if(p==0){(y[0]+=s)==tn&&(y[0]=1,++n.e);break}else{if(y[p]+=s,y[p]!=tn)break;y[p--]=0,s=1}for(r=y.length;y[--r]===0;)y.pop();if(Pt&&(n.e>Is||n.e<-Is))throw Error(Ma+zt(n));return n}function Al(n,e){var t,r,i,s,c,u,v,g,p,y,O=n.constructor,V=O.precision;if(!n.s||!e.s)return e.s?e.s=-e.s:e=new O(n),Pt?xt(e,V):e;if(v=n.d,y=e.d,r=e.e,g=n.e,v=v.slice(),c=g-r,c){for(p=c<0,p?(t=v,c=-c,u=y.length):(t=y,r=g,u=v.length),i=Math.max(Math.ceil(V/Nt),u)+2,c>i&&(c=i,t.length=1),t.reverse(),i=c;i--;)t.push(0);t.reverse()}else{for(i=v.length,u=y.length,p=i<u,p&&(u=i),i=0;i<u;i++)if(v[i]!=y[i]){p=v[i]<y[i];break}c=0}for(p&&(t=v,v=y,y=t,e.s=-e.s),u=v.length,i=y.length-u;i>0;--i)v[u++]=0;for(i=y.length;i>c;){if(v[--i]<y[i]){for(s=i;s&&v[--s]===0;)v[s]=tn-1;--v[s],v[i]+=tn}v[i]-=y[i]}for(;v[--u]===0;)v.pop();for(;v[0]===0;v.shift())--r;return v[0]?(e.d=v,e.e=r,Pt?xt(e,V):e):new O(0)}function di(n,e,t){var r,i=zt(n),s=lr(n.d),c=s.length;return e?(t&&(r=t-c)>0?s=s.charAt(0)+"."+s.slice(1)+jr(r):c>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(i<0?"e":"e+")+i):i<0?(s="0."+jr(-i-1)+s,t&&(r=t-c)>0&&(s+=jr(r))):i>=c?(s+=jr(i+1-c),t&&(r=t-i-1)>0&&(s=s+"."+jr(r))):((r=i+1)<c&&(s=s.slice(0,r)+"."+s.slice(r)),t&&(r=t-c)>0&&(i+1===c&&(s+="."),s+=jr(r))),n.s<0?"-"+s:s}function ho(n,e){if(n.length>e)return n.length=e,!0}function Il(n){var e,t,r;function i(s){var c=this;if(!(c instanceof i))return new i(s);if(c.constructor=i,s instanceof i){c.s=s.s,c.e=s.e,c.d=(s=s.d)?s.slice():s;return}if(typeof s=="number"){if(s*0!==0)throw Error(ui+s);if(s>0)c.s=1;else if(s<0)s=-s,c.s=-1;else{c.s=0,c.e=0,c.d=[0];return}if(s===~~s&&s<1e7){c.e=0,c.d=[s];return}return fo(c,s.toString())}else if(typeof s!="string")throw Error(ui+s);if(s.charCodeAt(0)===45?(s=s.slice(1),c.s=-1):c.s=1,bh.test(s))fo(c,s);else throw Error(ui+s)}if(i.prototype=be,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=Il,i.config=i.set=Eh,n===void 0&&(n={}),n)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<r.length;)n.hasOwnProperty(t=r[e++])||(n[t]=this[t]);return i.config(n),i}function Eh(n){if(!n||typeof n!="object")throw Error(Vn+"Object expected");var e,t,r,i=["precision",1,xi,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<i.length;e+=3)if((r=n[t=i[e]])!==void 0)if(Di(r)===r&&r>=i[e+1]&&r<=i[e+2])this[t]=r;else throw Error(ui+t+": "+r);if((r=n[t="LN10"])!==void 0)if(r==Math.LN10)this[t]=new this(r);else throw Error(ui+t+": "+r);return this}var Ol=Il(vh);Dn=new Ol(1);var k;(function(n){n.AED="aed",n.AFN="afn",n.ALL="all",n.AMD="amd",n.ANG="ang",n.AOA="aoa",n.ARS="ars",n.AUD="aud",n.AWG="awg",n.AZN="azn",n.BAM="bam",n.BBD="bbd",n.BDT="bdt",n.BGN="bgn",n.BHD="bhd",n.BIF="bif",n.BMD="bmd",n.BND="bnd",n.BOB="bob",n.BOV="bov",n.BRL="brl",n.BSD="bsd",n.BTN="btn",n.BWP="bwp",n.BYN="byn",n.BYR="byr",n.BZD="bzd",n.CAD="cad",n.CDF="cdf",n.CHE="che",n.CHF="chf",n.CHW="chw",n.CLF="clf",n.CLP="clp",n.CNY="cny",n.COP="cop",n.COU="cou",n.CRC="crc",n.CUC="cuc",n.CUP="cup",n.CVE="cve",n.CZK="czk",n.DJF="djf",n.DKK="dkk",n.DOP="dop",n.DZD="dzd",n.EGP="egp",n.ERN="ern",n.ETB="etb",n.EUR="eur",n.FJD="fjd",n.FKP="fkp",n.GBP="gbp",n.GEL="gel",n.GHS="ghs",n.GIP="gip",n.GMD="gmd",n.GNF="gnf",n.GTQ="gtq",n.GYD="gyd",n.HKD="hkd",n.HNL="hnl",n.HRK="hrk",n.HTG="htg",n.HUF="huf",n.IDR="idr",n.ILS="ils",n.INR="inr",n.IQD="iqd",n.IRR="irr",n.ISK="isk",n.JMD="jmd",n.JOD="jod",n.JPY="jpy",n.KES="kes",n.KGS="kgs",n.KHR="khr",n.KMF="kmf",n.KPW="kpw",n.KRW="krw",n.KWD="kwd",n.KYD="kyd",n.KZT="kzt",n.LAK="lak",n.LBP="lbp",n.LKR="lkr",n.LRD="lrd",n.LSL="lsl",n.LTL="ltl",n.LVL="lvl",n.LYD="lyd",n.MAD="mad",n.MDL="mdl",n.MGA="mga",n.MKD="mkd",n.MMK="mmk",n.MNT="mnt",n.MOP="mop",n.MRO="mro",n.MUR="mur",n.MVR="mvr",n.MWK="mwk",n.MXN="mxn",n.MXV="mxv",n.MYR="myr",n.MZN="mzn",n.NAD="nad",n.NGN="ngn",n.NIO="nio",n.NOK="nok",n.NPR="npr",n.NZD="nzd",n.OMR="omr",n.PAB="pab",n.PEN="pen",n.PGK="pgk",n.PHP="php",n.PKR="pkr",n.PLN="pln",n.PYG="pyg",n.QAR="qar",n.RON="ron",n.RSD="rsd",n.RUB="rub",n.RWF="rwf",n.SAR="sar",n.SBD="sbd",n.SCR="scr",n.SDG="sdg",n.SEK="sek",n.SGD="sgd",n.SHP="shp",n.SLL="sll",n.SOS="sos",n.SRD="srd",n.SSP="ssp",n.STD="std",n.SVC="svc",n.SYP="syp",n.SZL="szl",n.THB="thb",n.TJS="tjs",n.TMT="tmt",n.TND="tnd",n.TOP="top",n.TRY="try",n.TTD="ttd",n.TWD="twd",n.TZS="tzs",n.UAH="uah",n.UGX="ugx",n.USD="usd",n.USN="usn",n.USS="uss",n.UYI="uyi",n.UYU="uyu",n.UZS="uzs",n.VEF="vef",n.VND="vnd",n.VUV="vuv",n.WST="wst",n.XAF="xaf",n.XAG="xag",n.XAU="xau",n.XBA="xba",n.XBB="xbb",n.XBC="xbc",n.XBD="xbd",n.XCD="xcd",n.XDR="xdr",n.XFU="xfu",n.XOF="xof",n.XPD="xpd",n.XPF="xpf",n.XPT="xpt",n.XSU="xsu",n.XTS="xts",n.XUA="xua",n.YER="yer",n.ZAR="zar",n.ZMW="zmw",n.ZWL="zwl"})(k||(k={}));k.AED+"",k.AFN+"",k.ALL+"",k.AMD+"",k.ANG+"",k.AOA+"",k.ARS+"",k.AUD+"",k.AWG+"",k.AZN+"",k.BAM+"",k.BBD+"",k.BDT+"",k.BGN+"",k.BHD+"",k.BIF+"",k.BMD+"",k.BND+"",k.BOB+"",k.BOV+"",k.BRL+"",k.BSD+"",k.BTN+"",k.BWP+"",k.BYR+"",k.BYN+"",k.BZD+"",k.CAD+"",k.CDF+"",k.CHE+"",k.CHF+"",k.CHW+"",k.CLF+"",k.CLP+"",k.CNY+"",k.COP+"",k.COU+"",k.CRC+"",k.CUC+"",k.CUP+"",k.CVE+"",k.CZK+"",k.DJF+"",k.DKK+"",k.DOP+"",k.DZD+"",k.EGP+"",k.ERN+"",k.ETB+"",k.EUR+"",k.FJD+"",k.FKP+"",k.GBP+"",k.GEL+"",k.GHS+"",k.GIP+"",k.GMD+"",k.GNF+"",k.GTQ+"",k.GYD+"",k.HKD+"",k.HNL+"",k.HRK+"",k.HTG+"",k.HUF+"",k.IDR+"",k.ILS+"",k.INR+"",k.IQD+"",k.IRR+"",k.ISK+"",k.JMD+"",k.JOD+"",k.JPY+"",k.KES+"",k.KGS+"",k.KHR+"",k.KMF+"",k.KPW+"",k.KRW+"",k.KWD+"",k.KYD+"",k.KZT+"",k.LAK+"",k.LBP+"",k.LKR+"",k.LRD+"",k.LSL+"",k.LTL+"",k.LVL+"",k.LYD+"",k.MAD+"",k.MDL+"",k.MGA+"",k.MKD+"",k.MMK+"",k.MNT+"",k.MOP+"",k.MRO+"",k.MUR+"",k.MVR+"",k.MWK+"",k.MXN+"",k.MXV+"",k.MYR+"",k.MZN+"",k.NAD+"",k.NGN+"",k.NIO+"",k.NOK+"",k.NPR+"",k.NZD+"",k.OMR+"",k.PAB+"",k.PEN+"",k.PGK+"",k.PHP+"",k.PKR+"",k.PLN+"",k.PYG+"",k.QAR+"",k.RON+"",k.RSD+"",k.RUB+"",k.RWF+"",k.SAR+"",k.SBD+"",k.SCR+"",k.SDG+"",k.SEK+"",k.SGD+"",k.SHP+"",k.SLL+"",k.SOS+"",k.SRD+"",k.SSP+"",k.STD+"",k.SVC+"",k.SYP+"",k.SZL+"",k.THB+"",k.TJS+"",k.TMT+"",k.TND+"",k.TOP+"",k.TRY+"",k.TTD+"",k.TWD+"",k.TZS+"",k.UAH+"",k.UGX+"",k.USD+"",k.USN+"",k.USS+"",k.UYI+"",k.UYU+"",k.UZS+"",k.VEF+"",k.VND+"",k.VUV+"",k.WST+"",k.XAF+"",k.XAG+"",k.XAU+"",k.XBA+"",k.XBB+"",k.XBC+"",k.XBD+"",k.XCD+"",k.XDR+"",k.XFU+"",k.XOF+"",k.XPD+"",k.XPF+"",k.XPT+"",k.XSU+"",k.XTS+"",k.XUA+"",k.YER+"",k.ZAR+"",k.ZMW+"",k.ZWL+"";var Os={exports:{}};Os.exports;(function(n,e){var t=200,r="Expected a function",i="__lodash_hash_undefined__",s=1,c=2,u=1/0,v=9007199254740991,g="[object Arguments]",p="[object Array]",y="[object Boolean]",O="[object Date]",V="[object Error]",X="[object Function]",Z="[object GeneratorFunction]",z="[object Map]",me="[object Number]",le="[object Object]",ve="[object Promise]",Le="[object RegExp]",ut="[object Set]",St="[object String]",yt="[object Symbol]",Rt="[object WeakMap]",tt="[object ArrayBuffer]",bt="[object DataView]",_t="[object Float32Array]",ot="[object Float64Array]",M="[object Int8Array]",oe="[object Int16Array]",se="[object Int32Array]",te="[object Uint8Array]",Q="[object Uint8ClampedArray]",we="[object Uint16Array]",Ce="[object Uint32Array]",Ae=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,We=/^\w*$/,nt=/^\./,wt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mt=/[\\^$.*+?()[\]{}|]/g,Wt=/\\(\\)?/g,Nn=/^\[object .+?Constructor\]$/,jn=/^(?:0|[1-9]\d*)$/,Ge={};Ge[_t]=Ge[ot]=Ge[M]=Ge[oe]=Ge[se]=Ge[te]=Ge[Q]=Ge[we]=Ge[Ce]=!0,Ge[g]=Ge[p]=Ge[tt]=Ge[y]=Ge[bt]=Ge[O]=Ge[V]=Ge[X]=Ge[z]=Ge[me]=Ge[le]=Ge[Le]=Ge[ut]=Ge[St]=Ge[Rt]=!1;var An=typeof ls=="object"&&ls&&ls.Object===Object&&ls,Xt=typeof self=="object"&&self&&self.Object===Object&&self,pn=An||Xt||Function("return this")(),Pn=e&&!e.nodeType&&e,kt=Pn&&!0&&n&&!n.nodeType&&n,Jn=kt&&kt.exports===Pn,pr=Jn&&An.process,Qn=function(){try{return pr&&pr.binding("util")}catch{}}(),an=Qn&&Qn.isTypedArray;function er(E,I){for(var H=-1,ce=E?E.length:0;++H<ce&&I(E[H],H,E)!==!1;);return E}function In(E,I){for(var H=-1,ce=E?E.length:0;++H<ce;)if(I(E[H],H,E))return!0;return!1}function At(E){return function(I){return I==null?void 0:I[E]}}function Jt(E,I){for(var H=-1,ce=Array(E);++H<E;)ce[H]=I(H);return ce}function gr(E){return function(I){return E(I)}}function Dr(E,I){return E==null?void 0:E[I]}function ke(E){var I=!1;if(E!=null&&typeof E.toString!="function")try{I=!!(E+"")}catch{}return I}function gn(E){var I=-1,H=Array(E.size);return E.forEach(function(ce,ze){H[++I]=[ze,ce]}),H}function m(E,I){return function(H){return E(I(H))}}function T(E){var I=-1,H=Array(E.size);return E.forEach(function(ce){H[++I]=ce}),H}var x=Array.prototype,N=Function.prototype,j=Object.prototype,U=pn["__core-js_shared__"],G=function(){var E=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||"");return E?"Symbol(src)_1."+E:""}(),W=N.toString,Y=j.hasOwnProperty,Ee=j.toString,Ze=RegExp("^"+W.call(Y).replace(Mt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Be=pn.Symbol,Ve=pn.Uint8Array,Ct=m(Object.getPrototypeOf,Object),rt=Object.create,kn=j.propertyIsEnumerable,Ut=x.splice,Rr=m(Object.keys,Object),Ft=C(pn,"DataView"),mn=C(pn,"Map"),mr=C(pn,"Promise"),Nr=C(pn,"Set"),Vt=C(pn,"WeakMap"),tr=C(Object,"create"),$n=Et(Ft),yr=Et(mn),Pr=Et(mr),kr=Et(Nr),d=Et(Vt),o=Be?Be.prototype:void 0,h=o?o.valueOf:void 0,w=o?o.toString:void 0;function R(E){var I=-1,H=E?E.length:0;for(this.clear();++I<H;){var ce=E[I];this.set(ce[0],ce[1])}}function q(){this.__data__=tr?tr(null):{}}function Ie(E){return this.has(E)&&delete this.__data__[E]}function de(E){var I=this.__data__;if(tr){var H=I[E];return H===i?void 0:H}return Y.call(I,E)?I[E]:void 0}function Qe(E){var I=this.__data__;return tr?I[E]!==void 0:Y.call(I,E)}function Ye(E,I){var H=this.__data__;return H[E]=tr&&I===void 0?i:I,this}R.prototype.clear=q,R.prototype.delete=Ie,R.prototype.get=de,R.prototype.has=Qe,R.prototype.set=Ye;function pe(E){var I=-1,H=E?E.length:0;for(this.clear();++I<H;){var ce=E[I];this.set(ce[0],ce[1])}}function Me(){this.__data__=[]}function Oe(E){var I=this.__data__,H=br(I,E);if(H<0)return!1;var ce=I.length-1;return H==ce?I.pop():Ut.call(I,H,1),!0}function Ke(E){var I=this.__data__,H=br(I,E);return H<0?void 0:I[H][1]}function De(E){return br(this.__data__,E)>-1}function je(E,I){var H=this.__data__,ce=br(H,E);return ce<0?H.push([E,I]):H[ce][1]=I,this}pe.prototype.clear=Me,pe.prototype.delete=Oe,pe.prototype.get=Ke,pe.prototype.has=De,pe.prototype.set=je;function re(E){var I=-1,H=E?E.length:0;for(this.clear();++I<H;){var ce=E[I];this.set(ce[0],ce[1])}}function it(){this.__data__={hash:new R,map:new(mn||pe),string:new R}}function Kt(E){return S(this,E).delete(E)}function Tt(E){return S(this,E).get(E)}function Je(E){return S(this,E).has(E)}function st(E,I){return S(this,E).set(E,I),this}re.prototype.clear=it,re.prototype.delete=Kt,re.prototype.get=Tt,re.prototype.has=Je,re.prototype.set=st;function on(E){var I=-1,H=E?E.length:0;for(this.__data__=new re;++I<H;)this.add(E[I])}function gt(E){return this.__data__.set(E,i),this}function ln(E){return this.__data__.has(E)}on.prototype.add=on.prototype.push=gt,on.prototype.has=ln;function vt(E){this.__data__=new pe(E)}function It(){this.__data__=new pe}function vr(E){return this.__data__.delete(E)}function _n(E){return this.__data__.get(E)}function Hn(E){return this.__data__.has(E)}function qt(E,I){var H=this.__data__;if(H instanceof pe){var ce=H.__data__;if(!mn||ce.length<t-1)return ce.push([E,I]),this;H=this.__data__=new re(ce)}return H.set(E,I),this}vt.prototype.clear=It,vt.prototype.delete=vr,vt.prototype.get=_n,vt.prototype.has=Hn,vt.prototype.set=qt;function $r(E,I){var H=Er(E)||Gn(E)?Jt(E.length,String):[],ce=H.length,ze=!!ce;for(var Re in E)Y.call(E,Re)&&!(ze&&(Re=="length"||J(Re,ce)))&&H.push(Re);return H}function br(E,I){for(var H=E.length;H--;)if(Zt(E[H][0],I))return H;return-1}function ts(E){return mi(E)?rt(E):{}}var ns=a();function Zs(E,I){return E&&ns(E,I,is)}function pi(E,I){I=ae(I,E)?[I]:_(I);for(var H=0,ce=I.length;E!=null&&H<ce;)E=E[ft(I[H++])];return H&&H==ce?E:void 0}function Lr(E){return Ee.call(E)}function Cr(E,I){return E!=null&&I in Object(E)}function nr(E,I,H,ce,ze){return E===I?!0:E==null||I==null||!mi(E)&&!rs(I)?E!==E&&I!==I:zs(E,I,nr,H,ce,ze)}function zs(E,I,H,ce,ze,Re){var at=Er(E),jt=Er(I),Bt=p,cn=p;at||(Bt=B(E),Bt=Bt==g?le:Bt),jt||(cn=B(I),cn=cn==g?le:cn);var wn=Bt==le&&!ke(E),Tn=cn==le&&!ke(I),yn=Bt==cn;if(yn&&!wn)return Re||(Re=new vt),at||to(E)?l(E,I,H,ce,ze,Re):f(E,I,Bt,H,ce,ze,Re);if(!(ze&c)){var Cn=wn&&Y.call(E,"__wrapped__"),Bn=Tn&&Y.call(I,"__wrapped__");if(Cn||Bn){var Ur=Cn?E.value():E,_r=Bn?I.value():I;return Re||(Re=new vt),H(Ur,_r,ce,ze,Re)}}return yn?(Re||(Re=new vt),b(E,I,H,ce,ze,Re)):!1}function Ws(E,I,H,ce){var ze=H.length,Re=ze;if(E==null)return!Re;for(E=Object(E);ze--;){var at=H[ze];if(at[2]?at[1]!==E[at[0]]:!(at[0]in E))return!1}for(;++ze<Re;){at=H[ze];var jt=at[0],Bt=E[jt],cn=at[1];if(at[2]){if(Bt===void 0&&!(jt in E))return!1}else{var wn=new vt,Tn;if(!(Tn===void 0?nr(cn,Bt,ce,s|c,wn):Tn))return!1}}return!0}function Ks(E){if(!mi(E)||Se(E))return!1;var I=qs(E)||ke(E)?Ze:Nn;return I.test(Et(E))}function Ln(E){return rs(E)&&Ys(E.length)&&!!Ge[Ee.call(E)]}function On(E){return typeof E=="function"?E:E==null?Rc:typeof E=="object"?Er(E)?Br(E[0],E[1]):ni(E):Nc(E)}function rr(E){if(!_e(E))return Rr(E);var I=[];for(var H in Object(E))Y.call(E,H)&&H!="constructor"&&I.push(H);return I}function ni(E){var I=D(E);return I.length==1&&I[0][2]?ne(I[0][0],I[0][1]):function(H){return H===E||Ws(H,E,I)}}function Br(E,I){return ae(E)&&fe(I)?ne(ft(E),I):function(H){var ce=Oc(H,E);return ce===void 0&&ce===I?xc(H,E):nr(I,ce,void 0,s|c)}}function Mr(E){return function(I){return pi(I,E)}}function gi(E){if(typeof E=="string")return E;if(Xs(E))return w?w.call(E):"";var I=E+"";return I=="0"&&1/E==-u?"-0":I}function _(E){return Er(E)?E:Te(E)}function a(E){return function(I,H,ce){for(var ze=-1,Re=Object(I),at=ce(I),jt=at.length;jt--;){var Bt=at[++ze];if(H(Re[Bt],Bt,Re)===!1)break}return I}}function l(E,I,H,ce,ze,Re){var at=ze&c,jt=E.length,Bt=I.length;if(jt!=Bt&&!(at&&Bt>jt))return!1;var cn=Re.get(E);if(cn&&Re.get(I))return cn==I;var wn=-1,Tn=!0,yn=ze&s?new on:void 0;for(Re.set(E,I),Re.set(I,E);++wn<jt;){var Cn=E[wn],Bn=I[wn];if(ce)var Ur=at?ce(Bn,Cn,wn,I,E,Re):ce(Cn,Bn,wn,E,I,Re);if(Ur!==void 0){if(Ur)continue;Tn=!1;break}if(yn){if(!In(I,function(_r,ri){if(!yn.has(ri)&&(Cn===_r||H(Cn,_r,ce,ze,Re)))return yn.add(ri)})){Tn=!1;break}}else if(!(Cn===Bn||H(Cn,Bn,ce,ze,Re))){Tn=!1;break}}return Re.delete(E),Re.delete(I),Tn}function f(E,I,H,ce,ze,Re,at){switch(H){case bt:if(E.byteLength!=I.byteLength||E.byteOffset!=I.byteOffset)return!1;E=E.buffer,I=I.buffer;case tt:return!(E.byteLength!=I.byteLength||!ce(new Ve(E),new Ve(I)));case y:case O:case me:return Zt(+E,+I);case V:return E.name==I.name&&E.message==I.message;case Le:case St:return E==I+"";case z:var jt=gn;case ut:var Bt=Re&c;if(jt||(jt=T),E.size!=I.size&&!Bt)return!1;var cn=at.get(E);if(cn)return cn==I;Re|=s,at.set(E,I);var wn=l(jt(E),jt(I),ce,ze,Re,at);return at.delete(E),wn;case yt:if(h)return h.call(E)==h.call(I)}return!1}function b(E,I,H,ce,ze,Re){var at=ze&c,jt=is(E),Bt=jt.length,cn=is(I),wn=cn.length;if(Bt!=wn&&!at)return!1;for(var Tn=Bt;Tn--;){var yn=jt[Tn];if(!(at?yn in I:Y.call(I,yn)))return!1}var Cn=Re.get(E);if(Cn&&Re.get(I))return Cn==I;var Bn=!0;Re.set(E,I),Re.set(I,E);for(var Ur=at;++Tn<Bt;){yn=jt[Tn];var _r=E[yn],ri=I[yn];if(ce)var no=at?ce(ri,_r,yn,I,E,Re):ce(_r,ri,yn,E,I,Re);if(!(no===void 0?_r===ri||H(_r,ri,ce,ze,Re):no)){Bn=!1;break}Ur||(Ur=yn=="constructor")}if(Bn&&!Ur){var ss=E.constructor,as=I.constructor;ss!=as&&"constructor"in E&&"constructor"in I&&!(typeof ss=="function"&&ss instanceof ss&&typeof as=="function"&&as instanceof as)&&(Bn=!1)}return Re.delete(E),Re.delete(I),Bn}function S(E,I){var H=E.__data__;return ee(I)?H[typeof I=="string"?"string":"hash"]:H.map}function D(E){for(var I=is(E),H=I.length;H--;){var ce=I[H],ze=E[ce];I[H]=[ce,ze,fe(ze)]}return I}function C(E,I){var H=Dr(E,I);return Ks(H)?H:void 0}var B=Lr;(Ft&&B(new Ft(new ArrayBuffer(1)))!=bt||mn&&B(new mn)!=z||mr&&B(mr.resolve())!=ve||Nr&&B(new Nr)!=ut||Vt&&B(new Vt)!=Rt)&&(B=function(E){var I=Ee.call(E),H=I==le?E.constructor:void 0,ce=H?Et(H):void 0;if(ce)switch(ce){case $n:return bt;case yr:return z;case Pr:return ve;case kr:return ut;case d:return Rt}return I});function K(E,I,H){I=ae(I,E)?[I]:_(I);for(var ce,ze=-1,at=I.length;++ze<at;){var Re=ft(I[ze]);if(!(ce=E!=null&&H(E,Re)))break;E=E[Re]}if(ce)return ce;var at=E?E.length:0;return!!at&&Ys(at)&&J(Re,at)&&(Er(E)||Gn(E))}function J(E,I){return I=I??v,!!I&&(typeof E=="number"||jn.test(E))&&E>-1&&E%1==0&&E<I}function ae(E,I){if(Er(E))return!1;var H=typeof E;return H=="number"||H=="symbol"||H=="boolean"||E==null||Xs(E)?!0:We.test(E)||!Ae.test(E)||I!=null&&E in Object(I)}function ee(E){var I=typeof E;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?E!=="__proto__":E===null}function Se(E){return!!G&&G in E}function _e(E){var I=E&&E.constructor,H=typeof I=="function"&&I.prototype||j;return E===H}function fe(E){return E===E&&!mi(E)}function ne(E,I){return function(H){return H==null?!1:H[E]===I&&(I!==void 0||E in Object(H))}}var Te=Gt(function(E){E=Ic(E);var I=[];return nt.test(E)&&I.push(""),E.replace(wt,function(H,ce,ze,Re){I.push(ze?Re.replace(Wt,"$1"):ce||H)}),I});function ft(E){if(typeof E=="string"||Xs(E))return E;var I=E+"";return I=="0"&&1/E==-u?"-0":I}function Et(E){if(E!=null){try{return W.call(E)}catch{}try{return E+""}catch{}}return""}function Gt(E,I){if(typeof E!="function"||I&&typeof I!="function")throw new TypeError(r);var H=function(){var ce=arguments,ze=I?I.apply(this,ce):ce[0],Re=H.cache;if(Re.has(ze))return Re.get(ze);var at=E.apply(this,ce);return H.cache=Re.set(ze,at),at};return H.cache=new(Gt.Cache||re),H}Gt.Cache=re;function Zt(E,I){return E===I||E!==E&&I!==I}function Gn(E){return Ac(E)&&Y.call(E,"callee")&&(!kn.call(E,"callee")||Ee.call(E)==g)}var Er=Array.isArray;function eo(E){return E!=null&&Ys(E.length)&&!qs(E)}function Ac(E){return rs(E)&&eo(E)}function qs(E){var I=mi(E)?Ee.call(E):"";return I==X||I==Z}function Ys(E){return typeof E=="number"&&E>-1&&E%1==0&&E<=v}function mi(E){var I=typeof E;return!!E&&(I=="object"||I=="function")}function rs(E){return!!E&&typeof E=="object"}function Xs(E){return typeof E=="symbol"||rs(E)&&Ee.call(E)==yt}var to=an?gr(an):Ln;function Ic(E){return E==null?"":gi(E)}function Oc(E,I,H){var ce=E==null?void 0:pi(E,I);return ce===void 0?H:ce}function xc(E,I){return E!=null&&K(E,I,Cr)}function is(E){return eo(E)?$r(E):rr(E)}function Dc(E,I,H){var ce=Er(E)||to(E);if(I=On(I),H==null)if(ce||mi(E)){var ze=E.constructor;ce?H=Er(E)?new ze:[]:H=qs(ze)?ts(Ct(E)):{}}else H={};return(ce?er:Zs)(E,function(Re,at,jt){return I(H,Re,at,jt)}),H}function Rc(E){return E}function Nc(E){return ae(E)?At(ft(E)):Mr(E)}n.exports=Dc})(Os,Os.exports);var _h=Os.exports,wh=Oa(_h);class xl{constructor(e,t,r){this.platform=Ar.DESKTOP,this.instanceId="123456789012345678",this.configuration=_l(),this.source=null,this.sourceOrigin="",this.frameId="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",this.eventBus=new Uo,this.clientId=e,this.commands=this._updateCommandMocks({}),this.guildId=t,this.channelId=r}_updateCommandMocks(e){return this.commands=wh(Object.assign({},Th,e),(t,r,i)=>{t[i]=async(...s)=>(console.info(`DiscordSDKMock: ${String(i)}(${JSON.stringify(s)})`),await r(...s))}),this.commands}emitReady(){this.emitEvent("READY",void 0)}close(...e){console.info(`DiscordSDKMock: close(${JSON.stringify(e)})`)}ready(){return Promise.resolve()}async subscribe(e,t,...r){return await this.eventBus.on(e,t)}async unsubscribe(e,t,...r){return await this.eventBus.off(e,t)}emitEvent(e,t){this.eventBus.emit(e,t)}}const Th={authorize:()=>Promise.resolve({code:"mock_code"}),authenticate:()=>Promise.resolve({access_token:"mock_token",user:{username:"mock_user_username",discriminator:"mock_user_discriminator",id:"mock_user_id",avatar:null,public_flags:1},scopes:[],expires:new Date(2121,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}}),setActivity:()=>Promise.resolve({name:"mock_activity_name",type:0}),getChannel:()=>Promise.resolve({id:"mock_channel_id",name:"mock_channel_name",type:La.GUILD_TEXT,voice_states:[],messages:[]}),getSkus:()=>Promise.resolve({skus:[]}),getEntitlements:()=>Promise.resolve({entitlements:[]}),startPurchase:()=>Promise.resolve([]),setConfig:()=>Promise.resolve({use_interactive_pip:!1}),userSettingsGetLocale:()=>Promise.resolve({locale:""}),openExternalLink:()=>Promise.resolve(null),encourageHardwareAcceleration:()=>Promise.resolve({enabled:!0}),captureLog:()=>Promise.resolve(null),setOrientationLockState:()=>Promise.resolve(null),openInviteDialog:()=>Promise.resolve(null),getPlatformBehaviors:()=>Promise.resolve({iosKeyboardResizesView:!0}),getChannelPermissions:()=>Promise.resolve({permissions:Yo(1234567890)}),openShareMomentDialog:()=>Promise.resolve(null),initiateImageUpload:()=>Promise.resolve({image_url:"https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0b52aa9e99b832574a53_full_logo_blurple_RGB.png"}),getInstanceConnectedParticipants:()=>Promise.resolve({participants:[]})};var qn={};ArrayBuffer.isView||(ArrayBuffer.isView=n=>n!==null&&typeof n=="object"&&n.buffer instanceof ArrayBuffer);typeof FormData>"u"&&(Aa.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var Ua={},Ea=function(n,e){return Ea=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Ea(n,e)};function Dl(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ea(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var xs=function(){return xs=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},xs.apply(this,arguments)};function Rl(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Nl(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var u=n.length-1;u>=0;u--)(c=n[u])&&(s=(i<3?c(s):i>3?c(e,t,s):c(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function Pl(n,e){return function(t,r){e(t,r,n)}}function Sh(n,e,t,r,i,s){function c(me){if(me!==void 0&&typeof me!="function")throw new TypeError("Function expected");return me}for(var u=r.kind,v=u==="getter"?"get":u==="setter"?"set":"value",g=!e&&n?r.static?n:n.prototype:null,p=e||(g?Object.getOwnPropertyDescriptor(g,r.name):{}),y,O=!1,V=t.length-1;V>=0;V--){var X={};for(var Z in r)X[Z]=Z==="access"?{}:r[Z];for(var Z in r.access)X.access[Z]=r.access[Z];X.addInitializer=function(me){if(O)throw new TypeError("Cannot add initializers after decoration has completed");s.push(c(me||null))};var z=(0,t[V])(u==="accessor"?{get:p.get,set:p.set}:p[v],X);if(u==="accessor"){if(z===void 0)continue;if(z===null||typeof z!="object")throw new TypeError("Object expected");(y=c(z.get))&&(p.get=y),(y=c(z.set))&&(p.set=y),(y=c(z.init))&&i.unshift(y)}else(y=c(z))&&(u==="field"?i.unshift(y):p[v]=y)}g&&Object.defineProperty(g,r.name,p),O=!0}function Ah(n,e,t){for(var r=arguments.length>2,i=0;i<e.length;i++)t=r?e[i].call(n,t):e[i].call(n);return r?t:void 0}function Ih(n){return typeof n=="symbol"?n:"".concat(n)}function Oh(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function kl(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function $l(n,e,t,r){function i(s){return s instanceof t?s:new t(function(c){c(s)})}return new(t||(t=Promise))(function(s,c){function u(p){try{g(r.next(p))}catch(y){c(y)}}function v(p){try{g(r.throw(p))}catch(y){c(y)}}function g(p){p.done?s(p.value):i(p.value).then(u,v)}g((r=r.apply(n,e||[])).next())})}function Ll(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(g){return function(p){return v([g,p])}}function v(g){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,g[0]&&(t=0)),t;)try{if(r=1,i&&(s=g[0]&2?i.return:g[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,g[1])).done)return s;switch(i=0,s&&(g=[g[0]&2,s.value]),g[0]){case 0:case 1:s=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,i=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!s||g[1]>s[0]&&g[1]<s[3])){t.label=g[1];break}if(g[0]===6&&t.label<s[1]){t.label=s[1],s=g;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(g);break}s[2]&&t.ops.pop(),t.trys.pop();continue}g=e.call(n,t)}catch(p){g=[6,p],i=0}finally{r=s=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}var Ls=Object.create?function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]};function Cl(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Ls(e,n,t)}function Ds(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fa(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],c;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(u){c={error:u}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(c)throw c.error}}return s}function Bl(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Fa(arguments[e]));return n}function Ml(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],c=0,u=s.length;c<u;c++,i++)r[i]=s[c];return r}function Ul(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function Ai(n){return this instanceof Ai?(this.v=n,this):new Ai(n)}function Fl(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i;function c(O){r[O]&&(i[O]=function(V){return new Promise(function(X,Z){s.push([O,V,X,Z])>1||u(O,V)})})}function u(O,V){try{v(r[O](V))}catch(X){y(s[0][3],X)}}function v(O){O.value instanceof Ai?Promise.resolve(O.value.v).then(g,p):y(s[0][2],O)}function g(O){u("next",O)}function p(O){u("throw",O)}function y(O,V){O(V),s.shift(),s.length&&u(s[0][0],s[0][1])}}function Vl(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(c){return(t=!t)?{value:Ai(n[i](c)),done:!1}:s?s(c):c}:s}}function jl(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Ds=="function"?Ds(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(c){return new Promise(function(u,v){c=n[s](c),i(u,v,c.done,c.value)})}}function i(s,c,u,v){Promise.resolve(v).then(function(g){s({value:g,done:u})},c)}}function Hl(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var xh=Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e};function Gl(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Ls(e,n,t);return xh(e,n),e}function Zl(n){return n&&n.__esModule?n:{default:n}}function zl(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function Wl(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t}function Kl(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function ql(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose]}if(typeof r!="function")throw new TypeError("Object not disposable.");n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e}var Dh=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r};function Yl(n){function e(r){n.error=n.hasError?new Dh(r,n.error,"An error was suppressed during disposal."):r,n.hasError=!0}function t(){for(;n.stack.length;){var r=n.stack.pop();try{var i=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(i).then(t,function(s){return e(s),t()})}catch(s){e(s)}}if(n.hasError)throw n.error}return t()}const Rh={__extends:Dl,__assign:xs,__rest:Rl,__decorate:Nl,__param:Pl,__metadata:kl,__awaiter:$l,__generator:Ll,__createBinding:Ls,__exportStar:Cl,__values:Ds,__read:Fa,__spread:Bl,__spreadArrays:Ml,__spreadArray:Ul,__await:Ai,__asyncGenerator:Fl,__asyncDelegator:Vl,__asyncValues:jl,__makeTemplateObject:Hl,__importStar:Gl,__importDefault:Zl,__classPrivateFieldGet:zl,__classPrivateFieldSet:Wl,__classPrivateFieldIn:Kl,__addDisposableResource:ql,__disposeResources:Yl},Nh=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:ql,get __assign(){return xs},__asyncDelegator:Vl,__asyncGenerator:Fl,__asyncValues:jl,__await:Ai,__awaiter:$l,__classPrivateFieldGet:zl,__classPrivateFieldIn:Kl,__classPrivateFieldSet:Wl,__createBinding:Ls,__decorate:Nl,__disposeResources:Yl,__esDecorate:Sh,__exportStar:Cl,__extends:Dl,__generator:Ll,__importDefault:Zl,__importStar:Gl,__makeTemplateObject:Hl,__metadata:kl,__param:Pl,__propKey:Ih,__read:Fa,__rest:Rl,__runInitializers:Ah,__setFunctionName:Oh,__spread:Bl,__spreadArray:Ul,__spreadArrays:Ml,__values:Ds,default:Rh},Symbol.toStringTag,{value:"Module"})),Cs=Ia(Nh);var Ji={};(function(n){n.CloseCode=void 0,function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(n.CloseCode||(n.CloseCode={}));class e extends Error{constructor(r,i){super(i),this.name="ServerError",this.code=r}}n.ServerError=e})(Ji);var Va={},Xl={},Jl={},_a={exports:{}};(function(n,e){(function(t,r){r(e)})(Aa,function(t){t.OPERATION=void 0,function(_){_[_.ADD=128]="ADD",_[_.REPLACE=0]="REPLACE",_[_.DELETE=64]="DELETE",_[_.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",_[_.MOVE_AND_ADD=160]="MOVE_AND_ADD",_[_.DELETE_AND_ADD=192]="DELETE_AND_ADD",_[_.CLEAR=10]="CLEAR",_[_.REVERSE=15]="REVERSE",_[_.MOVE=32]="MOVE",_[_.DELETE_BY_REFID=33]="DELETE_BY_REFID",_[_.ADD_BY_REFID=129]="ADD_BY_REFID"}(t.OPERATION||(t.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const s=Symbol("$track"),c=Symbol("$encoder"),u=Symbol("$decoder"),v=Symbol("$filter"),g=Symbol("$getByIndex"),p=Symbol("$deleteByIndex"),y=Symbol("$changes"),O=Symbol("$childType"),V=Symbol("$onEncodeEnd"),X=Symbol("$onDecodeEnd"),Z=Symbol("$descriptors"),z="$__numFields",me="$__refTypeFieldIndexes",le="$__viewFieldIndexes",ve="$__fieldIndexesByViewTag";let Le;try{Le=new TextEncoder}catch{}const ut=new ArrayBuffer(8),St=new Int32Array(ut),yt=new Float32Array(ut),Rt=new Float64Array(ut),tt=new BigInt64Array(ut),_t=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(_,a){for(var l=0,f=0,b=0,S=_.length;b<S;b++)l=_.charCodeAt(b),l<128?f+=1:l<2048?f+=2:l<55296||l>=57344?f+=3:(b++,f+=4);return f};function ot(_,a,l){for(var f=0,b=0,S=a.length;b<S;b++)f=a.charCodeAt(b),f<128?_[l.offset++]=f:f<2048?(_[l.offset]=192|f>>6,_[l.offset+1]=128|f&63,l.offset+=2):f<55296||f>=57344?(_[l.offset]=224|f>>12,_[l.offset+1]=128|f>>6&63,_[l.offset+2]=128|f&63,l.offset+=3):(b++,f=65536+((f&1023)<<10|a.charCodeAt(b)&1023),_[l.offset]=240|f>>18,_[l.offset+1]=128|f>>12&63,_[l.offset+2]=128|f>>6&63,_[l.offset+3]=128|f&63,l.offset+=4)}function M(_,a,l){_[l.offset++]=a&255}function oe(_,a,l){_[l.offset++]=a&255}function se(_,a,l){_[l.offset++]=a&255,_[l.offset++]=a>>8&255}function te(_,a,l){_[l.offset++]=a&255,_[l.offset++]=a>>8&255}function Q(_,a,l){_[l.offset++]=a&255,_[l.offset++]=a>>8&255,_[l.offset++]=a>>16&255,_[l.offset++]=a>>24&255}function we(_,a,l){const f=a>>24,b=a>>16,S=a>>8,D=a;_[l.offset++]=D&255,_[l.offset++]=S&255,_[l.offset++]=b&255,_[l.offset++]=f&255}function Ce(_,a,l){const f=Math.floor(a/Math.pow(2,32)),b=a>>>0;we(_,b,l),we(_,f,l)}function Ae(_,a,l){const f=a/Math.pow(2,32)>>0,b=a>>>0;we(_,b,l),we(_,f,l)}function We(_,a,l){tt[0]=BigInt.asIntN(64,a),Q(_,St[0],l),Q(_,St[1],l)}function nt(_,a,l){tt[0]=BigInt.asIntN(64,a),Q(_,St[0],l),Q(_,St[1],l)}function wt(_,a,l){yt[0]=a,Q(_,St[0],l)}function Mt(_,a,l){Rt[0]=a,Q(_,St[0],l),Q(_,St[1],l)}function Wt(_,a,l){_[l.offset++]=a?1:0}function Nn(_,a,l){a||(a="");let f=_t(a,"utf8"),b=0;if(f<32)_[l.offset++]=f|160,b=1;else if(f<256)_[l.offset++]=217,_[l.offset++]=f%255,b=2;else if(f<65536)_[l.offset++]=218,te(_,f,l),b=3;else if(f<4294967296)_[l.offset++]=219,we(_,f,l),b=5;else throw new Error("String too long");return ot(_,a,l),b+f}function jn(_,a,l){if(isNaN(a))return jn(_,0,l);if(isFinite(a)){if(a!==(a|0))return Math.abs(a)<=34028235e31&&(yt[0]=a,Math.abs(Math.abs(yt[0])-Math.abs(a))<1e-4)?(_[l.offset++]=202,wt(_,a,l),5):(_[l.offset++]=203,Mt(_,a,l),9)}else return jn(_,a>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,l);return a>=0?a<128?(_[l.offset++]=a&255,1):a<256?(_[l.offset++]=204,_[l.offset++]=a&255,2):a<65536?(_[l.offset++]=205,te(_,a,l),3):a<4294967296?(_[l.offset++]=206,we(_,a,l),5):(_[l.offset++]=207,Ae(_,a,l),9):a>=-32?(_[l.offset++]=224|a+32,1):a>=-128?(_[l.offset++]=208,M(_,a,l),2):a>=-32768?(_[l.offset++]=209,se(_,a,l),3):a>=-2147483648?(_[l.offset++]=210,Q(_,a,l),5):(_[l.offset++]=211,Ce(_,a,l),9)}const Ge={int8:M,uint8:oe,int16:se,uint16:te,int32:Q,uint32:we,int64:Ce,uint64:Ae,bigint64:We,biguint64:nt,float32:wt,float64:Mt,boolean:Wt,string:Nn,number:jn,utf8Write:ot,utf8Length:_t},An=new ArrayBuffer(8),Xt=new Int32Array(An),pn=new Float32Array(An),Pn=new Float64Array(An),kt=new BigUint64Array(An),Jn=new BigInt64Array(An);function pr(_,a,l){for(var f="",b=0,S=a.offset,D=a.offset+l;S<D;S++){var C=_[S];if(!(C&128)){f+=String.fromCharCode(C);continue}if((C&224)===192){f+=String.fromCharCode((C&31)<<6|_[++S]&63);continue}if((C&240)===224){f+=String.fromCharCode((C&15)<<12|(_[++S]&63)<<6|(_[++S]&63)<<0);continue}if((C&248)===240){b=(C&7)<<18|(_[++S]&63)<<12|(_[++S]&63)<<6|(_[++S]&63)<<0,b>=65536?(b-=65536,f+=String.fromCharCode((b>>>10)+55296,(b&1023)+56320)):f+=String.fromCharCode(b);continue}console.error("Invalid byte "+C.toString(16))}return a.offset+=l,f}function Qn(_,a){return an(_,a)<<24>>24}function an(_,a){return _[a.offset++]}function er(_,a){return In(_,a)<<16>>16}function In(_,a){return _[a.offset++]|_[a.offset++]<<8}function At(_,a){return _[a.offset++]|_[a.offset++]<<8|_[a.offset++]<<16|_[a.offset++]<<24}function Jt(_,a){return At(_,a)>>>0}function gr(_,a){return Xt[0]=At(_,a),pn[0]}function Dr(_,a){return Xt[0]=At(_,a),Xt[1]=At(_,a),Pn[0]}function ke(_,a){const l=Jt(_,a);return At(_,a)*Math.pow(2,32)+l}function gn(_,a){const l=Jt(_,a);return Jt(_,a)*Math.pow(2,32)+l}function m(_,a){return Xt[0]=At(_,a),Xt[1]=At(_,a),Jn[0]}function T(_,a){return Xt[0]=At(_,a),Xt[1]=At(_,a),kt[0]}function x(_,a){return an(_,a)>0}function N(_,a){const l=_[a.offset++];let f;return l<192?f=l&31:l===217?f=an(_,a):l===218?f=In(_,a):l===219&&(f=Jt(_,a)),pr(_,a,f)}function j(_,a){const l=_[a.offset++];if(l<128)return l;if(l===202)return gr(_,a);if(l===203)return Dr(_,a);if(l===204)return an(_,a);if(l===205)return In(_,a);if(l===206)return Jt(_,a);if(l===207)return gn(_,a);if(l===208)return Qn(_,a);if(l===209)return er(_,a);if(l===210)return At(_,a);if(l===211)return ke(_,a);if(l>223)return(255-l+1)*-1}function U(_,a){const l=_[a.offset];return l<192&&l>160||l===217||l===218||l===219}const G={utf8Read:pr,int8:Qn,uint8:an,int16:er,uint16:In,int32:At,uint32:Jt,float32:gr,float64:Dr,int64:ke,uint64:gn,bigint64:m,biguint64:T,boolean:x,string:N,number:j,stringCheck:U},W={},Y=new Map;function Ee(_,a){a.constructor&&(Y.set(a.constructor,_),W[_]=a),a.encode&&(Ge[_]=a.encode),a.decode&&(G[_]=a.decode)}function Ze(_){return W[_]}function Be(_){for(const a in _)Ee(a,_[a]);return a=>De(a)}const Ln=class Ln{static register(a){const l=Object.getPrototypeOf(a);if(l!==gt){let f=Ln.inheritedTypes.get(l);f||(f=new Set,Ln.inheritedTypes.set(l,f)),f.add(a)}}static cache(a){let l=Ln.cachedContexts.get(a);return l||(l=new Ln(a),Ln.cachedContexts.set(a,l)),l}constructor(a){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},a&&this.discoverTypes(a)}has(a){return this.schemas.has(a)}get(a){return this.types[a]}add(a,l=this.schemas.size){return this.schemas.has(a)?!1:(this.types[l]=a,a[Symbol.metadata]===void 0&&rt.initialize(a),this.schemas.set(a,l),!0)}getTypeId(a){return this.schemas.get(a)}discoverTypes(a,l,f,b){var C,B;if(b&&this.registerFilteredByParent(a,l,f),!this.add(a))return;(C=Ln.inheritedTypes.get(a))==null||C.forEach(K=>{this.discoverTypes(K,l,f,b)});let S=a;for(;(S=Object.getPrototypeOf(S))&&S!==gt&&S!==Function.prototype;)this.discoverTypes(S);const D=a[B=Symbol.metadata]??(a[B]={});D[le]&&(this.hasFilters=!0);for(const K in D){const J=K,ae=D[J].type,ee=D[J].tag!==void 0;if(typeof ae!="string")if(Array.isArray(ae)){const Se=ae[0];if(Se==="string")continue;this.discoverTypes(Se,a,J,b||ee)}else if(typeof ae=="function")this.discoverTypes(ae,a,J,b||ee);else{const Se=Object.values(ae)[0];if(typeof Se=="string")continue;this.discoverTypes(Se,a,J,b||ee)}}}registerFilteredByParent(a,l,f){let S=`${this.schemas.get(a)??this.schemas.size}`;l&&(S+=`-${this.schemas.get(l)}`),S+=`-${f}`,this.parentFiltered[S]=!0}debug(){let a="";for(const l in this.parentFiltered){const f=l.split("-").map(Number),b=f.pop();a+=`
		`,a+=`${l}: ${f.reverse().map((S,D)=>{const C=this.types[S],B=C[Symbol.metadata];let K=C.name;return D===0&&(K+=`[${B[b].name}]`),`${K}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${a}`}};Ln.inheritedTypes=new Map,Ln.cachedContexts=new Map;let Ve=Ln;function Ct(_){return Array.isArray(_)?{array:_[0]}:typeof _.type<"u"?_.type:_}const rt={addField(_,a,l,f,b){if(a>64)throw new Error(`Can't define field '${l}'.
Schema instances may only have up to 64 fields.`);_[a]=Object.assign(_[a]||{},{type:Ct(f),index:a,name:l}),Object.defineProperty(_,Z,{value:_[Z]||{},enumerable:!1,configurable:!0}),b?(_[Z][l]=b,_[Z][`_${l}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):_[Z][l]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(_,z,{value:a,enumerable:!1,configurable:!0}),Object.defineProperty(_,l,{value:a,enumerable:!1,configurable:!0}),typeof _[a].type!="string"&&(_[me]===void 0&&Object.defineProperty(_,me,{value:[],enumerable:!1,configurable:!0}),_[me].push(a))},setTag(_,a,l){const f=_[a],b=_[f];b.tag=l,_[le]||(Object.defineProperty(_,le,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(_,ve,{value:{},enumerable:!1,configurable:!0})),_[le].push(f),_[ve][l]||(_[ve][l]=[]),_[ve][l].push(f)},setFields(_,a){const l=_.prototype.constructor;Ve.register(l);const f=Object.getPrototypeOf(l),b=f&&f[Symbol.metadata],S=rt.initialize(l);l[s]||(l[s]=gt[s]),l[c]||(l[c]=gt[c]),l[u]||(l[u]=gt[u]),l.prototype.toJSON||(l.prototype.toJSON=gt.prototype.toJSON);let D=S[z]??(b&&b[z])??-1;D++;for(const C in a){const B=a[C],K=Array.isArray(B)?Ze("array"):typeof Object.keys(B)[0]=="string"&&Ze(Object.keys(B)[0]),J=K?Object.values(B)[0]:Ct(B);rt.addField(S,D,C,B,je(`_${C}`,D,J,K)),D++}return _},isDeprecated(_,a){return _[a].deprecated===!0},init(_){const a={};_[Symbol.metadata]=a,Object.defineProperty(a,z,{value:0,enumerable:!1,configurable:!0})},initialize(_){const a=Object.getPrototypeOf(_),l=a[Symbol.metadata];let f=_[Symbol.metadata]??Object.create(null);return a!==gt&&f===l&&(f=Object.create(null),l&&(Object.setPrototypeOf(f,l),Object.defineProperty(f,z,{value:l[z],enumerable:!1,configurable:!0,writable:!0}),l[le]!==void 0&&(Object.defineProperty(f,le,{value:[...l[le]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(f,ve,{value:{...l[ve]},enumerable:!1,configurable:!0,writable:!0})),l[me]!==void 0&&Object.defineProperty(f,me,{value:[...l[me]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(f,Z,{value:{...l[Z]},enumerable:!1,configurable:!0,writable:!0}))),_[Symbol.metadata]=f,f},isValidInstance(_){return _.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(_.constructor[Symbol.metadata],z)},getFields(_){const a=_[Symbol.metadata],l={};for(let f=0;f<=a[z];f++)l[a[f].name]=a[f].type;return l},hasViewTagAtIndex(_,a){var l;return(l=_==null?void 0:_[le])==null?void 0:l.includes(a)}};function kn(){return{indexes:{},operations:[]}}function Ut(_,a){const l=_.indexes[a];l===void 0?_.indexes[a]=_.operations.push(a)-1:_.operations[l]=a}function Rr(_,a){var f;let l=_.indexes[a];l===void 0&&(l=Object.values(_.indexes).at(-1),a=(f=Object.entries(_.indexes).find(([b,S])=>S===l))==null?void 0:f[0]),_.operations[l]=void 0,delete _.indexes[a]}function Ft(_,a,l,f=a[l].queueRootIndex){if(_)_[l][f]!==a&&(a[l].queueRootIndex=_[l].push(a)-1);else return}class mn{constructor(a){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=a;const l=a.constructor[Symbol.metadata];l!=null&&l[le]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(a){var f;this.root=a,this.checkIsFiltered(this.parent,this.parentIndex);const l=this.ref.constructor[Symbol.metadata];l?(f=l[me])==null||f.forEach(b=>{const S=l[b],D=this.ref[S.name];D==null||D[y].setRoot(a)}):this.ref[O]&&typeof this.ref[O]!="string"&&this.ref.forEach((b,S)=>{b[y].setRoot(a)})}setParent(a,l,f){var S;if(this.parent=a,this.parentIndex=f,!l)return;l!==this.root?(this.root=l,this.checkIsFiltered(a,f)):l.add(this);const b=this.ref.constructor[Symbol.metadata];b?(S=b[me])==null||S.forEach(D=>{const C=b[D],B=this.ref[C.name];B==null||B[y].setParent(this.ref,l,D)}):this.ref[O]&&typeof this.ref[O]!="string"&&this.ref.forEach((D,C)=>{D[y].setParent(this.ref,l,this.indexes[C]??C)})}forEachChild(a){var f;const l=this.ref.constructor[Symbol.metadata];l?(f=l[me])==null||f.forEach(b=>{const S=l[b],D=this.ref[S.name];D&&a(D[y],b)}):this.ref[O]&&typeof this.ref[O]!="string"&&this.ref.forEach((b,S)=>{a(b[y],this.indexes[S]??S)})}operation(a){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-a),Ft(this.root,this,"filteredChanges")):(this.changes.operations.push(-a),Ft(this.root,this,"changes"))}change(a,l=t.OPERATION.ADD){var C;const f=this.ref.constructor[Symbol.metadata],b=this.isFiltered||((C=f==null?void 0:f[a])==null?void 0:C.tag)!==void 0,S=b?this.filteredChanges:this.changes,D=this.indexedOperations[a];if(!D||D===t.OPERATION.DELETE){const B=D&&D===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:l;this.indexedOperations[a]=B}Ut(S,a),b?(Ut(this.allFilteredChanges,a),this.root&&(Ft(this.root,this,"filteredChanges"),Ft(this.root,this,"allFilteredChanges"))):(Ut(this.allChanges,a),Ft(this.root,this,"changes"))}shiftChangeIndexes(a){const l=this.isFiltered?this.filteredChanges:this.changes,f={},b={};for(const S in this.indexedOperations)f[Number(S)+a]=this.indexedOperations[S],b[Number(S)+a]=l.indexes[S];this.indexedOperations=f,l.indexes=b,l.operations=l.operations.map(S=>S+a)}shiftAllChangeIndexes(a,l=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(a,l,this.allFilteredChanges),this._shiftAllChangeIndexes(a,l,this.allChanges)):this._shiftAllChangeIndexes(a,l,this.allChanges)}_shiftAllChangeIndexes(a,l=0,f){const b={};let S=0;for(const D in f.indexes)b[S++]=f.indexes[D];f.indexes=b;for(let D=0;D<f.operations.length;D++){const C=f.operations[D];C>l&&(f.operations[D]=C+a)}}indexedOperation(a,l,f=a){this.indexedOperations[a]=l,this.filteredChanges!==void 0?(Ut(this.allFilteredChanges,f),Ut(this.filteredChanges,a),Ft(this.root,this,"filteredChanges")):(Ut(this.allChanges,f),Ut(this.changes,a),Ft(this.root,this,"changes"))}getType(a){return rt.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][a].type:this.ref[O]}getChange(a){return this.indexedOperations[a]}getValue(a,l=!1){return this.ref[g](a,l)}delete(a,l,f=a){var D;if(a===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${a}'`)}catch(C){console.warn(C)}return}const b=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[a]=l??t.OPERATION.DELETE,Ut(b,a),Rr(this.allChanges,f);const S=this.getValue(a);return S&&S[y]&&((D=this.root)==null||D.remove(S[y])),this.filteredChanges!==void 0?(Rr(this.allFilteredChanges,f),Ft(this.root,this,"filteredChanges")):Ft(this.root,this,"changes"),S}endEncode(a){var l,f;this.indexedOperations={},this[a].indexes={},this[a].operations.length=0,this[a].queueRootIndex=void 0,(f=(l=this.ref)[V])==null||f.call(l),this.isNew=!1}discard(a=!1){var l,f;(f=(l=this.ref)[V])==null||f.call(l),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),a&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((b,S)=>{var D;return(D=this.root)==null?void 0:D.remove(b)}))}discardAll(){const a=Object.keys(this.indexedOperations);for(let l=0,f=a.length;l<f;l++){const b=this.getValue(Number(a[l]));b&&b[y]&&b[y].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(a,l){const f=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(a,l),this.filteredChanges!==void 0&&(Ft(this.root,this,"filteredChanges"),f&&this.root.allFilteredChanges.push(this))),this.isFiltered||(Ft(this.root,this,"changes"),f&&this.root.allChanges.push(this))}_checkFilteredByParent(a,l){if(!a)return;const f=rt.isValidInstance(this.ref)?this.ref.constructor:this.ref[O];let b,S=!rt.isValidInstance(a);S?(b=a[y],a=b.parent,l=b.parentIndex):b=a[y];const D=a.constructor;let C=`${this.root.types.getTypeId(f)}`;D&&(C+=`-${this.root.types.schemas.get(D)}`),C+=`-${l}`;const B=rt.hasViewTagAtIndex(D==null?void 0:D[Symbol.metadata],l);this.isFiltered=a[y].isFiltered||this.root.types.parentFiltered[C]||B,this.isFiltered&&(this.isVisibilitySharedWithParent=b.isFiltered&&typeof f!="string"&&!B&&S,this.filteredChanges||(this.filteredChanges=kn(),this.allFilteredChanges=kn()),this.changes.operations.length>0&&(this.changes.operations.forEach(K=>Ut(this.filteredChanges,K)),this.allChanges.operations.forEach(K=>Ut(this.allFilteredChanges,K)),this.changes=kn(),this.allChanges=kn()))}}function mr(_,a,l,f,b,S){var D;typeof l=="string"?(D=Ge[l])==null||D.call(Ge,a,f,S):l[Symbol.metadata]!==void 0?(Ge.number(a,f[y].refId,S),(b&t.OPERATION.ADD)===t.OPERATION.ADD&&_.tryEncodeTypeId(a,l,f.constructor,S)):Ge.number(a,f[y].refId,S)}const Nr=function(_,a,l,f,b,S,D,C,B){if(a[S.offset++]=(f|b)&255,b===t.OPERATION.DELETE)return;const K=l.ref,J=B[f];mr(_,a,B[f].type,K[J.name],b,S)},Vt=function(_,a,l,f,b,S){if(a[S.offset++]=b&255,b===t.OPERATION.CLEAR||(Ge.number(a,f,S),b===t.OPERATION.DELETE))return;const D=l.ref;if((b&t.OPERATION.ADD)===t.OPERATION.ADD&&typeof D.set=="function"){const K=l.ref.$indexes.get(f);Ge.string(a,K,S)}const C=D[O],B=D[g](f);mr(_,a,C,B,b,S)},tr=function(_,a,l,f,b,S,D,C){const B=l.ref,K=C&&l.isFiltered&&typeof l.getType(f)!="string";let J;if(K?(J=B.tmpItems[f][y].refId,b===t.OPERATION.DELETE?b=t.OPERATION.DELETE_BY_REFID:b===t.OPERATION.ADD&&(b=t.OPERATION.ADD_BY_REFID)):J=f,a[S.offset++]=b&255,b===t.OPERATION.CLEAR||b===t.OPERATION.REVERSE||(Ge.number(a,J,S),b===t.OPERATION.DELETE||b===t.OPERATION.DELETE_BY_REFID))return;const ae=l.getType(f),ee=l.getValue(f,D);mr(_,a,ae,ee,b,S)},$n=-1;function yr(_,a,l,f,b,S,D,C){const B=_.root,K=l[g](f);let J;if((a&t.OPERATION.DELETE)===t.OPERATION.DELETE){const ae=B.refIds.get(K);ae!==void 0&&B.removeRef(ae),a!==t.OPERATION.DELETE_AND_ADD&&l[p](f),J=void 0}if(a!==t.OPERATION.DELETE)if(gt.is(b)){const ae=G.number(S,D);if(J=B.refs.get(ae),(a&t.OPERATION.ADD)===t.OPERATION.ADD){const ee=_.getInstanceType(S,D,b);J||(J=_.createInstanceOfType(ee)),B.addRef(ae,J,J!==K||a===t.OPERATION.DELETE_AND_ADD&&J===K)}}else if(typeof b=="string")J=G[b](S,D);else{const ae=Ze(Object.keys(b)[0]),ee=G.number(S,D),Se=B.refs.has(ee)?K||B.refs.get(ee):new ae.constructor;if(J=Se.clone(!0),J[O]=Object.values(b)[0],K){let _e=B.refIds.get(K);if(_e!==void 0&&ee!==_e){const fe=K.entries();let ne;for(;(ne=fe.next())&&!ne.done;){const[Te,ft]=ne.value;typeof ft=="object"&&(_e=B.refIds.get(ft),B.removeRef(_e)),C.push({ref:K,refId:_e,op:t.OPERATION.DELETE,field:Te,value:void 0,previousValue:ft})}}}B.addRef(ee,J,Se!==K||a===t.OPERATION.DELETE_AND_ADD&&Se===K)}return{value:J,previousValue:K}}const Pr=function(_,a,l,f,b){const S=a[l.offset++],D=f.constructor[Symbol.metadata],C=S>>6<<6,B=S%(C||255),K=D[B];if(K===void 0)return console.warn("@colyseus/schema: field not defined at",{index:B,ref:f.constructor.name,metadata:D}),$n;const{value:J,previousValue:ae}=yr(_,C,f,B,K.type,a,l,b);J!=null&&(f[K.name]=J),ae!==J&&b.push({ref:f,refId:_.currentRefId,op:C,field:K.name,value:J,previousValue:ae})},kr=function(_,a,l,f,b){const S=a[l.offset++];if(S===t.OPERATION.CLEAR){_.removeChildRefs(f,b),f.clear();return}const D=G.number(a,l),C=f[O];let B;(S&t.OPERATION.ADD)===t.OPERATION.ADD?typeof f.set=="function"?(B=G.string(a,l),f.setIndex(D,B)):B=D:B=f.getIndex(D);const{value:K,previousValue:J}=yr(_,S,f,D,C,a,l,b);if(K!=null){if(typeof f.set=="function")f.$items.set(B,K);else if(typeof f.$setAt=="function")f.$setAt(D,K,S);else if(typeof f.add=="function"){const ae=f.add(K);typeof ae=="number"&&f.setIndex(ae,ae)}}J!==K&&b.push({ref:f,refId:_.currentRefId,op:S,field:"",dynamicIndex:B,value:K,previousValue:J})},d=function(_,a,l,f,b){let S=a[l.offset++],D;if(S===t.OPERATION.CLEAR){_.removeChildRefs(f,b),f.clear();return}else if(S===t.OPERATION.REVERSE){f.reverse();return}else if(S===t.OPERATION.DELETE_BY_REFID){const ae=G.number(a,l),ee=_.root.refs.get(ae);D=f.findIndex(Se=>Se===ee),f[p](D),b.push({ref:f,refId:_.currentRefId,op:t.OPERATION.DELETE,field:"",dynamicIndex:D,value:void 0,previousValue:ee});return}else if(S===t.OPERATION.ADD_BY_REFID){const ae=G.number(a,l),ee=_.root.refs.get(ae);ee&&(D=f.findIndex(Se=>Se===ee)),(D===-1||D===void 0)&&(D=f.length)}else D=G.number(a,l);const C=f[O];let B=D;const{value:K,previousValue:J}=yr(_,S,f,D,C,a,l,b);K!=null&&K!==J&&f.$setAt(D,K,S),J!==K&&b.push({ref:f,refId:_.currentRefId,op:S,field:"",dynamicIndex:B,value:K,previousValue:J})};class o extends Error{}function h(_,a,l,f){let b,S=!1;switch(a){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":b="number",isNaN(_)&&console.log(`trying to encode "NaN" in ${l.constructor.name}#${f}`);break;case"bigint64":case"biguint64":b="bigint";break;case"string":b="string",S=!0;break;case"boolean":return;default:return}if(typeof _!==b&&(!S||S&&_!==null)){let D=`'${JSON.stringify(_)}'${_&&_.constructor&&` (${_.constructor.name})`||""}`;throw new o(`a '${b}' was expected, but ${D} was provided in ${l.constructor.name}#${f}`)}}function w(_,a,l,f){if(!(_ instanceof a))throw new o(`a '${a.name}' was expected, but '${_&&_.constructor.name}' was provided in ${l.constructor.name}#${f}`)}var R,q;const Ie=(_,a)=>{const l=_.toString(),f=a.toString();return l<f?-1:l>f?1:0},On=class On{static[(R=c,q=u,v)](a,l,f){var b;return!f||typeof a[O]=="string"||f.isChangeTreeVisible((b=a.tmpItems[l])==null?void 0:b[y])}static is(a){return Array.isArray(a)||a.array!==void 0}static from(a){return new On(...Array.from(a))}constructor(...a){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,O,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const l=new Proxy(this,{get:(f,b)=>typeof b!="symbol"&&!isNaN(b)?this.items[b]:Reflect.get(f,b),set:(f,b,S)=>{var D;if(typeof b!="symbol"&&!isNaN(b)){if(S==null)f.$deleteAt(b);else{if(S[y]){w(S,f[O],f,b);const C=f.items[b];f.isMovingItems?(C!==void 0?S[y].isNew?f[y].indexedOperation(Number(b),t.OPERATION.MOVE_AND_ADD):(f[y].getChange(Number(b))&t.OPERATION.DELETE)===t.OPERATION.DELETE?f[y].indexedOperation(Number(b),t.OPERATION.DELETE_AND_MOVE):f[y].indexedOperation(Number(b),t.OPERATION.MOVE):S[y].isNew&&f[y].indexedOperation(Number(b),t.OPERATION.ADD),S[y].setParent(this,f[y].root,b)):f.$changeAt(Number(b),S),C!==void 0&&((D=C[y].root)==null||D.remove(C[y]))}else f.$changeAt(Number(b),S);f.items[b]=S,f.tmpItems[b]=S}return!0}else return Reflect.set(f,b,S)},deleteProperty:(f,b)=>(typeof b=="number"?f.$deleteAt(b):delete f[b],!0),has:(f,b)=>typeof b!="symbol"&&!isNaN(Number(b))?Reflect.has(this.items,b):Reflect.has(f,b)});return this[y]=new mn(l),this[y].indexes={},a.length>0&&this.push(...a),l}set length(a){a===0?this.clear():a<this.items.length?this.splice(a,this.length-a):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...a){var b;let l=this.tmpItems.length;const f=this[y];for(let S=0,D=a.length;S<a.length;S++,l++){const C=a[S];if(C==null)return;typeof C=="object"&&this[O]&&w(C,this[O],this,S),f.indexedOperation(l,t.OPERATION.ADD,this.items.length),this.items.push(C),this.tmpItems.push(C),(b=C[y])==null||b.setParent(this,f.root,l)}return l}pop(){let a=-1;for(let l=this.tmpItems.length-1;l>=0;l--)if(this.deletedIndexes[l]!==!0){a=l;break}if(!(a<0))return this[y].delete(a,void 0,this.items.length-1),this.deletedIndexes[a]=!0,this.items.pop()}at(a){return a<0&&(a+=this.length),this.items[a]}$changeAt(a,l){var S;if(l==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[a]===l)return;const f=this.items[a]!==void 0?typeof l=="object"?t.OPERATION.DELETE_AND_ADD:t.OPERATION.REPLACE:t.OPERATION.ADD,b=this[y];b.change(a,f),(S=l[y])==null||S.setParent(this,b.root,a)}$deleteAt(a,l){this[y].delete(a,l)}$setAt(a,l,f){a===0&&f===t.OPERATION.ADD&&this.items[a]!==void 0?this.items.unshift(l):f===t.OPERATION.DELETE_AND_MOVE?(this.items.splice(a,1),this.items[a]=l):this.items[a]=l}clear(){if(this.items.length===0)return;const a=this[y];a.forEachChild((l,f)=>{l.discard(!0);const b=l.root;b!==void 0&&(b.removeChangeFromChangeSet("changes",l),b.removeChangeFromChangeSet("allChanges",l),b.removeChangeFromChangeSet("allFilteredChanges",l))}),a.discard(!0),a.operation(t.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...a){return new On(...this.items.concat(...a))}join(a){return this.items.join(a)}reverse(){return this[y].operation(t.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const a=this[y],l=this.tmpItems.findIndex(b=>b===this.items[0]),f=this.items.findIndex(b=>b===this.items[0]);return a.delete(l,t.OPERATION.DELETE,f),a.shiftAllChangeIndexes(-1,f),this.items.shift()}slice(a,l){const f=new On;return f.push(...this.items.slice(a,l)),f}sort(a=Ie){this.isMovingItems=!0;const l=this[y];return this.items.sort(a).forEach((b,S)=>l.change(S,t.OPERATION.REPLACE)),this.tmpItems.sort(a),this.isMovingItems=!1,this}splice(a,l,...f){var K;const b=this[y],S=this.items.length,D=this.tmpItems.length,C=f.length,B=[];for(let J=0;J<D;J++)this.deletedIndexes[J]!==!0&&B.push(J);if(S>a){l===void 0&&(l=S-a);for(let J=a;J<a+l;J++){const ae=B[J];b.delete(ae,t.OPERATION.DELETE),this.deletedIndexes[ae]=!0}}else l=0;if(C>0){if(C>l)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let J=0;J<C;J++){const ae=(B[a]??S)+J;b.indexedOperation(ae,this.deletedIndexes[ae]?t.OPERATION.DELETE_AND_ADD:t.OPERATION.ADD),(K=f[J][y])==null||K.setParent(this,b.root,ae)}}return l>C&&b.shiftAllChangeIndexes(-(l-C),B[a+C]),b.filteredChanges!==void 0?Ft(b.root,b,"filteredChanges"):Ft(b.root,b,"changes"),this.items.splice(a,l,...f)}unshift(...a){const l=this[y];return l.shiftChangeIndexes(a.length),l.isFiltered?Ut(l.filteredChanges,this.items.length):Ut(l.allChanges,this.items.length),a.forEach((f,b)=>{l.change(b,t.OPERATION.ADD)}),this.tmpItems.unshift(...a),this.items.unshift(...a)}indexOf(a,l){return this.items.indexOf(a,l)}lastIndexOf(a,l=this.length-1){return this.items.lastIndexOf(a,l)}every(a,l){return this.items.every(a,l)}some(a,l){return this.items.some(a,l)}forEach(a,l){return this.items.forEach(a,l)}map(a,l){return this.items.map(a,l)}filter(a,l){return this.items.filter(a,l)}reduce(a,l){return this.items.reduce(a,l)}reduceRight(a,l){return this.items.reduceRight(a,l)}find(a,l){return this.items.find(a,l)}findIndex(a,l){return this.items.findIndex(a,l)}fill(a,l,f){throw new Error("ArraySchema#fill() not implemented")}copyWithin(a,l,f){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return On}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(a,l){return this.items.includes(a,l)}flatMap(a,l){throw new Error("ArraySchema#flatMap() is not supported.")}flat(a){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...a){return this.items.findLastIndex.apply(this.items,arguments)}with(a,l){const f=this.items.slice();return a<0&&(a+=this.length),f[a]=l,new On(...f)}toReversed(){return this.items.slice().reverse()}toSorted(a){return this.items.slice().sort(a)}toSpliced(a,l,...f){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(a=>{let l=this.items.length;for(;l!=0;){let f=Math.floor(Math.random()*l);l--,[this[l],this[f]]=[this[f],this[l]]}})}move(a){return this.isMovingItems=!0,a(this),this.isMovingItems=!1,this}[g](a,l=!1){return l?this.items[a]:this.deletedIndexes[a]?this.items[a]:this.tmpItems[a]||this.items[a]}[p](a){this.items[a]=void 0,this.tmpItems[a]=void 0}[V](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[X](){this.items=this.items.filter(a=>a!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(a=>typeof a.toJSON=="function"?a.toJSON():a)}clone(a){let l;return a?(l=new On,l.push(...this.items)):l=new On(...this.map(f=>f[y]?f.clone():f)),l}};On[R]=tr,On[q]=d;let de=On;Ee("array",{constructor:de});var Qe,Ye;const rr=class rr{static[(Qe=c,Ye=u,v)](a,l,f){return!f||typeof a[O]=="string"||f.isChangeTreeVisible((a[g](l)??a.deletedItems[l])[y])}static is(a){return a.map!==void 0}constructor(a){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[y]=new mn(this),this[y].indexes={},a)if(a instanceof Map||a instanceof rr)a.forEach((l,f)=>this.set(f,l));else for(const l in a)this.set(l,a[l]);Object.defineProperty(this,O,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return rr}set(a,l){var C;if(l==null)throw new Error(`MapSchema#set('${a}', ${l}): trying to set ${l} value on '${a}'.`);typeof l=="object"&&this[O]&&w(l,this[O],this,a),a=a.toString();const f=this[y],b=l[y]!==void 0;let S,D;if(typeof f.indexes[a]<"u"){S=f.indexes[a],D=t.OPERATION.REPLACE;const B=this.$items.get(a);if(B===l)return;b&&(D=t.OPERATION.DELETE_AND_ADD,B!==void 0&&((C=B[y].root)==null||C.remove(B[y])))}else S=f.indexes[z]??0,D=t.OPERATION.ADD,this.$indexes.set(S,a),f.indexes[a]=S,f.indexes[z]=S+1;return this.$items.set(a,l),f.change(S,D),b&&l[y].setParent(this,f.root,S),this}get(a){return this.$items.get(a)}delete(a){const l=this[y].indexes[a];return this.deletedItems[l]=this[y].delete(l),this.$items.delete(a)}clear(){const a=this[y];a.discard(!0),a.indexes={},this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){return this.$items.has(a)}forEach(a){this.$items.forEach(a)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(a,l){this.$indexes.set(a,l)}getIndex(a){return this.$indexes.get(a)}[g](a){return this.$items.get(this.$indexes.get(a))}[p](a){const l=this.$indexes.get(a);this.$items.delete(l),this.$indexes.delete(a)}[V](){this.deletedItems={}}toJSON(){const a={};return this.forEach((l,f)=>{a[f]=typeof l.toJSON=="function"?l.toJSON():l}),a}clone(a){let l;return a?l=Object.assign(new rr,this):(l=new rr,this.forEach((f,b)=>{f[y]?l.set(b,f.clone()):l.set(b,f)})),l}};rr[Qe]=Vt,rr[Ye]=kr;let pe=rr;Ee("map",{constructor:pe});const Me=-1;function Oe(_){return Ve.register(_),_}function Ke(_=Me){return function(a,l){var C;const f=a.constructor,S=Object.getPrototypeOf(f)[Symbol.metadata],D=f[C=Symbol.metadata]??(f[C]=Object.assign({},f[Symbol.metadata],S??Object.create(null)));rt.setTag(D,l,_)}}function De(_,a){return function(l,f){const b=l.constructor;if(!_)throw new Error(`${b.name}: @type() reference provided for "${f}" is undefined. Make sure you don't have any circular dependencies.`);Ve.register(b);const D=Object.getPrototypeOf(b)[Symbol.metadata],C=rt.initialize(b);let B=C[f];if(C[B]!==void 0){if(C[B].deprecated)return;if(C[B].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${f}' definition on '${b.name}'.
Check @type() annotation`)}catch(K){const J=K.stack.split(`
`)[4].trim();throw new Error(`${K.message} ${J}`)}}else B=C[z]??(D&&D[z])??-1,B++;if(a&&a.manual)rt.addField(C,B,f,_,{enumerable:!0,configurable:!0,writable:!0});else{const K=Array.isArray(_)?Ze("array"):typeof Object.keys(_)[0]=="string"&&Ze(Object.keys(_)[0]),J=K?Object.values(_)[0]:_;rt.addField(C,B,f,_,je(`_${f}`,B,J,K))}}}function je(_,a,l,f){return{get:function(){return this[_]},set:function(b){var D,C;const S=this[_]??void 0;if(b!==S){if(b!=null){f?(f.constructor===de&&!(b instanceof de)&&(b=new de(...b)),f.constructor===pe&&!(b instanceof pe)&&(b=new pe(b)),b[O]=l):typeof l!="string"?w(b,l,this,_.substring(1)):h(b,l,this,_.substring(1));const B=this[y];S!==void 0&&S[y]?((D=B.root)==null||D.remove(S[y]),this.constructor[s](B,a,t.OPERATION.DELETE_AND_ADD)):this.constructor[s](B,a,t.OPERATION.ADD),(C=b[y])==null||C.setParent(this,B.root,a)}else S!==void 0&&this[y].delete(a);this[_]=b}},enumerable:!0,configurable:!0}}function re(_=!0){return function(a,l){var B;const f=a.constructor,S=Object.getPrototypeOf(f)[Symbol.metadata],D=f[B=Symbol.metadata]??(f[B]=Object.assign({},f[Symbol.metadata],S??Object.create(null))),C=D[l];D[C].deprecated=!0,_&&(D[Z]??(D[Z]={}),D[Z][l]={get:function(){throw new Error(`${l} is deprecated.`)},set:function(K){},enumerable:!1,configurable:!0}),Object.defineProperty(D,C,{value:D[C],enumerable:!1,configurable:!0})}}function it(_,a,l){for(let f in a)De(a[f],l)(_.prototype,f);return _}function Kt(_,a,l=gt){const f={},b={};for(let D in _){const C=_[D];typeof C=="object"&&(C.default!==void 0&&(f[D]=C.default),C.view!==void 0&&(b[D]=typeof C.view=="boolean"?Me:C.view))}const S=rt.setFields(class extends l{constructor(...D){D[0]=Object.assign({},f,D[0]),super(...D)}},_);for(let D in b)Ke(b[D])(S.prototype,D);return a&&Object.defineProperty(S,"name",{value:a}),S.extends=(D,C)=>Kt(D,C,S),S}function Tt(_){return new Array(_).fill(0).map((a,l)=>l===_-1?" ":"   ").join("")}function Je(_){const a=_[y].root,l={ops:{},refs:[]};return a.changes.forEach(f=>{if(f===void 0)return;const b=f.indexedOperations;l.refs.push(`refId#${f.refId}`);for(const S in b){const D=b[S],C=t.OPERATION[D];l.ops[C]||(l.ops[C]=0),l.ops[t.OPERATION[D]]++}}),l}var st,on;const ni=class ni{static initialize(a){var l;Object.defineProperty(a,y,{value:new mn(a),enumerable:!1,writable:!0}),Object.defineProperties(a,((l=a.constructor[Symbol.metadata])==null?void 0:l[Z])||{})}static is(a){return typeof a[Symbol.metadata]=="object"}static[(st=c,on=u,s)](a,l,f=t.OPERATION.ADD){a.change(l,f)}static[v](a,l,f){var D,C;const S=(D=a.constructor[Symbol.metadata][l])==null?void 0:D.tag;if(f===void 0)return S===void 0;if(S===void 0)return!0;if(S===Me)return f.isChangeTreeVisible(a[y]);{const B=(C=f.tags)==null?void 0:C.get(a[y]);return B&&B.has(S)}}constructor(...a){ni.initialize(this),a[0]&&Object.assign(this,a[0])}assign(a){return Object.assign(this,a),this}setDirty(a,l){const f=this.constructor[Symbol.metadata];this[y].change(f[f[a]].index,l)}clone(){var f;const a=new this.constructor,l=this.constructor[Symbol.metadata];for(const b in l){const S=l[b].name;typeof this[S]=="object"&&typeof((f=this[S])==null?void 0:f.clone)=="function"?a[S]=this[S].clone():a[S]=this[S]}return a}toJSON(){const a={},l=this.constructor[Symbol.metadata];for(const f in l){const b=l[f],S=b.name;!b.deprecated&&this[S]!==null&&typeof this[S]<"u"&&(a[S]=typeof this[S].toJSON=="function"?this[S].toJSON():this[S])}return a}discardAllChanges(){this[y].discardAll()}[g](a){const l=this.constructor[Symbol.metadata];return this[l[a].name]}[p](a){const l=this.constructor[Symbol.metadata];this[l[a].name]=void 0}static debugRefIds(a,l=!1,f=0){const b=l?` - ${JSON.stringify(a.toJSON())}`:"",S=a[y],D=S.refId;let C="";return C+=`${Tt(f)}${a.constructor.name} (refId: ${D})${b}
`,S.forEachChild(B=>C+=this.debugRefIds(B.ref,l,f+1)),C}static debugChanges(a,l=!1){const f=a[y],b=l?f.allChanges:f.changes,S=l?"allChanges":"changes";let D=`${a.constructor.name} (${f.refId}) -> .${S}:
`;function C(B){B.operations.filter(K=>K).forEach(K=>{const J=f.indexedOperations[K];console.log({index:K,operation:J}),D+=`- [${K}]: ${t.OPERATION[J]} (${JSON.stringify(f.getValue(Number(K),l))})
`})}return C(b),!l&&f.filteredChanges&&f.filteredChanges.operations.filter(B=>B).length>0&&(D+=`${a.constructor.name} (${f.refId}) -> .filteredChanges:
`,C(f.filteredChanges)),l&&f.allFilteredChanges&&f.allFilteredChanges.operations.filter(B=>B).length>0&&(D+=`${a.constructor.name} (${f.refId}) -> .allFilteredChanges:
`,C(f.allFilteredChanges)),D}static debugChangesDeep(a,l="changes"){var J,ae;let f="";const b=a[y],S=b.root,D=new Map,C=[];let B=0;for(const[ee,Se]of Object.entries(S[l])){const _e=S.changeTrees[ee];let fe=!1,ne=[],Te=(J=_e.parent)==null?void 0:J[y];if(_e===b)fe=!0;else for(;Te!==void 0;){if(ne.push(Te),Te.ref===a){fe=!0;break}Te=(ae=Te.parent)==null?void 0:ae[y]}fe&&(C.push(_e.refId),B+=Object.keys(Se).length,D.set(_e,ne.reverse()))}f+=`---
`,f+=`root refId: ${b.refId}
`,f+=`Total instances: ${C.length} (refIds: ${C.join(", ")})
`,f+=`Total changes: ${B}
`,f+=`---
`;const K=new WeakSet;for(const[ee,Se]of D.entries()){Se.forEach((ft,Et)=>{K.has(ft)||(f+=`${Tt(Et)}${ft.ref.constructor.name} (refId: ${ft.refId})
`,K.add(ft))});const _e=ee.indexedOperations,fe=Se.length,ne=Tt(fe),Te=fe>0?`(${ee.parentIndex}) `:"";f+=`${ne}${Te}${ee.ref.constructor.name} (refId: ${ee.refId}) - changes: ${Object.keys(_e).length}
`;for(const ft in _e){const Et=_e[ft];f+=`${Tt(fe+1)}${t.OPERATION[Et]}: ${ft}
`}}return`${f}`}};ni[st]=Nr,ni[on]=Pr;let gt=ni;var ln,vt;const Br=class Br{static[(ln=c,vt=u,v)](a,l,f){return!f||typeof a[O]=="string"||f.isChangeTreeVisible((a[g](l)??a.deletedItems[l])[y])}static is(a){return a.collection!==void 0}constructor(a){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[y]=new mn(this),this[y].indexes={},a&&a.forEach(l=>this.add(l)),Object.defineProperty(this,O,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(a){const l=this.$refId++;return a[y]!==void 0&&a[y].setParent(this,this[y].root,l),this[y].indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,a),this[y].change(l),l}at(a){const l=Array.from(this.$items.keys())[a];return this.$items.get(l)}entries(){return this.$items.entries()}delete(a){const l=this.$items.entries();let f,b;for(;(b=l.next())&&!b.done;)if(a===b.value[1]){f=b.value[0];break}return f===void 0?!1:(this.deletedItems[f]=this[y].delete(f),this.$indexes.delete(f),this.$items.delete(f))}clear(){const a=this[y];a.discard(!0),a.indexes={},this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){return Array.from(this.$items.values()).some(l=>l===a)}forEach(a){this.$items.forEach((l,f,b)=>a(l,f,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(a,l){this.$indexes.set(a,l)}getIndex(a){return this.$indexes.get(a)}[g](a){return this.$items.get(this.$indexes.get(a))}[p](a){const l=this.$indexes.get(a);this.$items.delete(l),this.$indexes.delete(a)}[V](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const a=[];return this.forEach((l,f)=>{a.push(typeof l.toJSON=="function"?l.toJSON():l)}),a}clone(a){let l;return a?l=Object.assign(new Br,this):(l=new Br,this.forEach(f=>{f[y]?l.add(f.clone()):l.add(f)})),l}};Br[ln]=Vt,Br[vt]=kr;let It=Br;Ee("collection",{constructor:It});var vr,_n;const Mr=class Mr{static[(vr=c,_n=u,v)](a,l,f){return!f||typeof a[O]=="string"||f.visible.has((a[g](l)??a.deletedItems[l])[y])}static is(a){return a.set!==void 0}constructor(a){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[y]=new mn(this),this[y].indexes={},a&&a.forEach(l=>this.add(l)),Object.defineProperty(this,O,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(a){var b;if(this.has(a))return!1;const l=this.$refId++;a[y]!==void 0&&a[y].setParent(this,this[y].root,l);const f=((b=this[y].indexes[l])==null?void 0:b.op)??t.OPERATION.ADD;return this[y].indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,a),this[y].change(l,f),l}entries(){return this.$items.entries()}delete(a){const l=this.$items.entries();let f,b;for(;(b=l.next())&&!b.done;)if(a===b.value[1]){f=b.value[0];break}return f===void 0?!1:(this.deletedItems[f]=this[y].delete(f),this.$indexes.delete(f),this.$items.delete(f))}clear(){const a=this[y];a.discard(!0),a.indexes={},this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){const l=this.$items.values();let f=!1,b;for(;(b=l.next())&&!b.done;)if(a===b.value){f=!0;break}return f}forEach(a){this.$items.forEach((l,f,b)=>a(l,f,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(a,l){this.$indexes.set(a,l)}getIndex(a){return this.$indexes.get(a)}[g](a){return this.$items.get(this.$indexes.get(a))}[p](a){const l=this.$indexes.get(a);this.$items.delete(l),this.$indexes.delete(a)}[V](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const a=[];return this.forEach((l,f)=>{a.push(typeof l.toJSON=="function"?l.toJSON():l)}),a}clone(a){let l;return a?l=Object.assign(new Mr,this):(l=new Mr,this.forEach(f=>{f[y]?l.add(f.clone()):l.add(f)})),l}};Mr[vr]=Vt,Mr[_n]=kr;let Hn=Mr;Ee("set",{constructor:Hn});function qt(_,a,l,f){var b=arguments.length,S=b<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,l):f,D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(_,a,l,f);else for(var C=_.length-1;C>=0;C--)(D=_[C])&&(S=(b<3?D(S):b>3?D(a,l,S):D(a,l))||S);return b>3&&S&&Object.defineProperty(a,l,S),S}typeof SuppressedError=="function"&&SuppressedError;class $r{constructor(a){this.types=a,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(a){a.ensureRefId();const l=this.changeTrees[a.refId]===void 0;l&&(this.changeTrees[a.refId]=a);const f=this.refCount[a.refId];if(f===0){const b=a.allChanges.operations;let S=b.length;for(;S--;)a.indexedOperations[b[S]]=t.OPERATION.ADD,Ut(a.changes,S)}return this.refCount[a.refId]=(f||0)+1,l}remove(a){const l=this.refCount[a.refId]-1;return l<=0?(a.root=void 0,delete this.changeTrees[a.refId],this.removeChangeFromChangeSet("allChanges",a),this.removeChangeFromChangeSet("changes",a),a.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",a),this.removeChangeFromChangeSet("filteredChanges",a)),this.refCount[a.refId]=0):(this.refCount[a.refId]=l,a.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",a),Ft(this,a,"filteredChanges")):(this.removeChangeFromChangeSet("changes",a),Ft(this,a,"changes"))),a.forEachChild((f,b)=>this.remove(f)),l}removeChangeFromChangeSet(a,l){const f=this[a],b=f.indexOf(l);if(b!==-1)return l[a].queueRootIndex=-1,f[b]=void 0,!0}clear(){this.changes.length=0}}const gi=class gi{constructor(a){this.sharedBuffer=Buffer.allocUnsafe(gi.BUFFER_SIZE),this.context=Ve.cache(a.constructor),this.root=new $r(this.context),this.setState(a)}setState(a){this.state=a,this.state[y].setRoot(this.root)}encode(a={offset:0},l,f=this.sharedBuffer,b="changes",S=b==="allChanges",D=a.offset){const C=l!==void 0,B=this.state[y],K=this.root[b];for(let J=0,ae=K.length;J<ae;J++){const ee=K[J];if(!ee)continue;if(C){if(!l.isChangeTreeVisible(ee)){l.invisible.add(ee);continue}l.invisible.delete(ee)}const Se=ee[b],_e=ee.ref,fe=Se.operations.length;if(fe===0)continue;const ne=_e.constructor,Te=ne[c],ft=ne[v],Et=ne[Symbol.metadata];(C||a.offset>D||ee!==B)&&(f[a.offset++]=255,Ge.number(f,ee.refId,a));for(let Gt=0;Gt<fe;Gt++){const Zt=Se.operations[Gt],Gn=Zt<0?Math.abs(Zt):S?t.OPERATION.ADD:ee.indexedOperations[Zt];Zt===void 0||Gn===void 0||ft&&!ft(_e,Zt,l)||Te(this,f,ee,Zt,Gn,a,S,C,Et)}}if(a.offset>f.byteLength){const J=Math.ceil(a.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(J/1024)} * 1024; // ${Math.round(J/1024)} KB
`),f=Buffer.alloc(J,f),f===this.sharedBuffer&&(this.sharedBuffer=f),this.encode({offset:D},l,f,b,S)}else return f.subarray(0,a.offset)}encodeAll(a={offset:0},l=this.sharedBuffer){return this.encode(a,void 0,l,"allChanges",!0)}encodeAllView(a,l,f,b=this.sharedBuffer){const S=f.offset;return this.encode(f,a,b,"allFilteredChanges",!0,S),Buffer.concat([b.subarray(0,l),b.subarray(S,f.offset)])}debugChanges(a){(typeof a=="string"?this.root[a]:a).forEach(f=>{const b=f[a],S=f.ref.constructor[Symbol.metadata];console.log("->",{ref:f.ref.constructor.name,refId:f.refId,changes:Object.keys(b).length});for(const D in b){const C=b[D];console.log("  ->",{index:D,field:S==null?void 0:S[D],op:t.OPERATION[C]})}})}encodeView(a,l,f,b=this.sharedBuffer){const S=f.offset;for(const[D,C]of a.changes){const B=this.root.changeTrees[D];if(B===void 0){a.changes.delete(D);continue}const K=Object.keys(C);if(K.length===0)continue;const ae=B.ref.constructor,ee=ae[c],Se=ae[Symbol.metadata];b[f.offset++]=255,Ge.number(b,B.refId,f);for(let _e=0,fe=K.length;_e<fe;_e++){const ne=Number(K[_e]),ft=B.ref[g](ne)!==void 0&&C[ne]||t.OPERATION.DELETE;ee(this,b,B,ne,ft,f,!1,!0,Se)}}return a.changes.clear(),this.encode(f,a,b,"filteredChanges",!1,S),Buffer.concat([b.subarray(0,l),b.subarray(S,f.offset)])}discardChanges(){var l,f;let a=this.root.changes.length;if(a>0){for(;a--;)(l=this.root.changes[a])==null||l.endEncode("changes");this.root.changes.length=0}if(a=this.root.filteredChanges.length,a>0){for(;a--;)(f=this.root.filteredChanges[a])==null||f.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(a,l,f,b){const S=this.context.getTypeId(l),D=this.context.getTypeId(f);if(D===void 0){console.warn(`@colyseus/schema WARNING: Class "${f.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}S!==D&&(a[b.offset++]=213,Ge.number(a,D,b))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};gi.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let br=gi;function ts(_,a){if(a===-1||a>=_.length)return!1;const l=_.length-1;for(let f=a;f<l;f++)_[f]=_[f+1];return _.length=l,!0}class ns extends Error{constructor(a){super(a),this.name="DecodingWarning"}}class Zs{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(a,l,f=!0){this.refs.set(a,l),this.refIds.set(l,a),f&&(this.refCounts[a]=(this.refCounts[a]||0)+1),this.deletedRefs.has(a)&&this.deletedRefs.delete(a)}removeRef(a){const l=this.refCounts[a];if(l===void 0){try{throw new ns("trying to remove refId that doesn't exist: "+a)}catch(f){console.warn(f)}return}if(l===0){try{const f=this.refs.get(a);throw new ns(`trying to remove refId '${a}' with 0 refCount (${f.constructor.name}: ${JSON.stringify(f)})`)}catch(f){console.warn(f)}return}(this.refCounts[a]=l-1)<=0&&this.deletedRefs.add(a)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(a=>{if(this.refCounts[a]>0)return;const l=this.refs.get(a);if(l.constructor[Symbol.metadata]!==void 0){const f=l.constructor[Symbol.metadata];for(const b in f){const S=f[b].name,D=typeof l[S]=="object"&&this.refIds.get(l[S]);D&&!this.deletedRefs.has(D)&&this.removeRef(D)}}else typeof l[O]=="function"&&Array.from(l.values()).forEach(f=>{const b=this.refIds.get(f);this.deletedRefs.has(b)||this.removeRef(b)});this.refs.delete(a),delete this.refCounts[a],delete this.callbacks[a]}),this.deletedRefs.clear()}addCallback(a,l,f){if(a===void 0){const b=typeof l=="number"?t.OPERATION[l]:l;throw new Error(`Can't addCallback on '${b}' (refId is undefined)`)}return this.callbacks[a]||(this.callbacks[a]={}),this.callbacks[a][l]||(this.callbacks[a][l]=[]),this.callbacks[a][l].push(f),()=>this.removeCallback(a,l,f)}removeCallback(a,l,f){var S,D,C;const b=(C=(D=(S=this.callbacks)==null?void 0:S[a])==null?void 0:D[l])==null?void 0:C.indexOf(f);b!==-1&&ts(this.callbacks[a][l],b)}}class pi{constructor(a,l){this.currentRefId=0,this.setState(a),this.context=l||new Ve(a.constructor)}setState(a){this.state=a,this.root=new Zs,this.root.addRef(0,a)}decode(a,l={offset:0},f=this.state){var B,K,J;const b=[],S=this.root,D=a.byteLength;let C=f.constructor[u];for(this.currentRefId=0;l.offset<D;){if(a[l.offset]==255){l.offset++,this.currentRefId=G.number(a,l);const ee=S.refs.get(this.currentRefId);if(!ee)throw new Error(`"refId" not found: ${this.currentRefId}`);(B=f[X])==null||B.call(f),f=ee,C=f.constructor[u];continue}if(C(this,a,l,f,b)===$n){console.warn("@colyseus/schema: definition mismatch");const ee={offset:l.offset};for(;l.offset<D&&!(a[l.offset]===255&&(ee.offset=l.offset+1,S.refs.has(G.number(a,ee))));)l.offset++;continue}}return(K=f[X])==null||K.call(f),(J=this.triggerChanges)==null||J.call(this,b),S.garbageCollectDeletedRefs(),b}getInstanceType(a,l,f){let b;if(a[l.offset]===213){l.offset++;const S=G.number(a,l);b=this.context.get(S)}return b||f}createInstanceOfType(a){return new a}removeChildRefs(a,l){const f=typeof a[O]!="string",b=this.root.refIds.get(a);a.forEach((S,D)=>{l.push({ref:a,refId:b,op:t.OPERATION.DELETE,field:D,value:void 0,previousValue:S}),f&&this.root.removeRef(this.root.refIds.get(S))})}}class Lr extends gt{}qt([De("string")],Lr.prototype,"name",void 0),qt([De("string")],Lr.prototype,"type",void 0),qt([De("number")],Lr.prototype,"referencedType",void 0);class Cr extends gt{constructor(){super(...arguments),this.fields=new de}}qt([De("number")],Cr.prototype,"id",void 0),qt([De("number")],Cr.prototype,"extendsId",void 0),qt([De([Lr])],Cr.prototype,"fields",void 0);class nr extends gt{constructor(){super(...arguments),this.types=new de}static encode(a,l={offset:0}){const f=a.context,b=new nr,S=new br(b),D=f.schemas.get(a.state.constructor);D>0&&(b.rootType=D);const C=new Set,B={},K=ae=>{if(ae.extendsId===void 0||C.has(ae.extendsId)){C.add(ae.id),b.types.push(ae);const ee=B[ae.id];ee!==void 0&&(delete B[ae.id],ee.forEach(Se=>K(Se)))}else B[ae.extendsId]===void 0&&(B[ae.extendsId]=[]),B[ae.extendsId].push(ae)};f.schemas.forEach((ae,ee)=>{const Se=new Cr;Se.id=Number(ae);const _e=Object.getPrototypeOf(ee);_e!==gt&&(Se.extendsId=f.schemas.get(_e));const fe=ee[Symbol.metadata];if(fe!==_e[Symbol.metadata])for(const ne in fe){const Te=Number(ne),ft=fe[Te].name;if(!Object.prototype.hasOwnProperty.call(fe,ft))continue;const Et=new Lr;Et.name=ft;let Gt;const Zt=fe[Te];if(typeof Zt.type=="string")Gt=Zt.type;else{let Gn;gt.is(Zt.type)?(Gt="ref",Gn=Zt.type):(Gt=Object.keys(Zt.type)[0],typeof Zt.type[Gt]=="string"?Gt+=":"+Zt.type[Gt]:Gn=Zt.type[Gt]),Et.referencedType=Gn?f.getTypeId(Gn):-1}Et.type=Gt,Se.fields.push(Et)}K(Se)});for(const ae in B)B[ae].forEach(ee=>b.types.push(ee));const J=S.encodeAll(l);return Buffer.from(J,0,l.offset)}static decode(a,l){const f=new nr;new pi(f).decode(a,l);const S=new Ve;f.types.forEach(B=>{const K=S.get(B.extendsId)??gt,J=class extends K{};Ve.register(J),S.add(J,B.id)},{});const D=(B,K,J)=>{K.fields.forEach((ae,ee)=>{const Se=J+ee;if(ae.referencedType!==void 0){let _e=ae.type,fe=S.get(ae.referencedType);if(!fe){const ne=ae.type.split(":");_e=ne[0],fe=ne[1]}_e==="ref"?rt.addField(B,Se,ae.name,fe):rt.addField(B,Se,ae.name,{[_e]:fe})}else rt.addField(B,Se,ae.name,ae.type)})};f.types.forEach(B=>{const K=S.get(B.id),J=rt.initialize(K),ae=[];let ee=B;do ae.push(ee),ee=f.types.find(_e=>_e.id===ee.extendsId);while(ee);let Se=0;ae.reverse().forEach(_e=>{D(J,_e,Se),Se+=_e.fields.length})});const C=new(S.get(f.rootType||0));return new pi(C,S)}}qt([De([Cr])],nr.prototype,"types",void 0),qt([De("number")],nr.prototype,"rootType",void 0);function zs(_){const a=_.root,l=a.callbacks,f=new WeakMap;let b;_.triggerChanges=function(C){var K;const B=new Set;for(let J=0,ae=C.length;J<ae;J++){const ee=C[J],Se=ee.refId,_e=ee.ref,fe=l[Se];if(fe){if((ee.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&ee.previousValue instanceof gt){const ne=(K=l[a.refIds.get(ee.previousValue)])==null?void 0:K[t.OPERATION.DELETE];for(let Te=(ne==null?void 0:ne.length)-1;Te>=0;Te--)ne[Te]()}if(_e instanceof gt){if(!B.has(Se)){const ne=fe==null?void 0:fe[t.OPERATION.REPLACE];for(let Te=(ne==null?void 0:ne.length)-1;Te>=0;Te--)ne[Te]()}if(fe.hasOwnProperty(ee.field)){const ne=fe[ee.field];for(let Te=(ne==null?void 0:ne.length)-1;Te>=0;Te--)ne[Te](ee.value,ee.previousValue)}}else{if((ee.op&t.OPERATION.DELETE)===t.OPERATION.DELETE){if(ee.previousValue!==void 0){const ne=fe[t.OPERATION.DELETE];for(let Te=(ne==null?void 0:ne.length)-1;Te>=0;Te--)ne[Te](ee.previousValue,ee.dynamicIndex??ee.field)}if((ee.op&t.OPERATION.ADD)===t.OPERATION.ADD){const ne=fe[t.OPERATION.ADD];for(let Te=(ne==null?void 0:ne.length)-1;Te>=0;Te--)ne[Te](ee.value,ee.dynamicIndex??ee.field)}}else if((ee.op&t.OPERATION.ADD)===t.OPERATION.ADD&&ee.previousValue!==ee.value){const ne=fe[t.OPERATION.ADD];for(let Te=(ne==null?void 0:ne.length)-1;Te>=0;Te--)ne[Te](ee.value,ee.dynamicIndex??ee.field)}if(ee.value!==ee.previousValue&&(ee.value!==void 0||ee.previousValue!==void 0)){const ne=fe[t.OPERATION.REPLACE];for(let Te=(ne==null?void 0:ne.length)-1;Te>=0;Te--)ne[Te](ee.value,ee.dynamicIndex??ee.field)}}B.add(Se)}}};function S(C,B){var ae;let K=((ae=B.instance)==null?void 0:ae.constructor[Symbol.metadata])||C,J=B.instance&&typeof B.instance.forEach=="function"||C&&typeof C[Symbol.metadata]>"u";if(K&&!J){const ee=function(Se,_e,fe,ne){return ne&&B.instance[_e]!==void 0&&!f.has(b)&&fe(B.instance[_e],void 0),a.addCallback(a.refIds.get(Se),_e,fe)};return new Proxy({listen:function(_e,fe,ne=!0){if(B.instance)return ee(B.instance,_e,fe,ne);{let Te=()=>{};return B.onInstanceAvailable((ft,Et)=>{Te=ee(ft,_e,fe,ne&&Et&&!f.has(b))}),()=>Te()}},onChange:function(_e){return a.addCallback(a.refIds.get(B.instance),t.OPERATION.REPLACE,_e)},bindTo:function(_e,fe){return fe||(fe=Object.keys(K).map(ne=>K[ne].name)),a.addCallback(a.refIds.get(B.instance),t.OPERATION.REPLACE,()=>{fe.forEach(ne=>_e[ne]=B.instance[ne])})}},{get(Se,_e){var ne;const fe=K[K[_e]];if(fe){const Te=(ne=B.instance)==null?void 0:ne[_e],ft=Et=>{const Gt=D(B.instance).listen(_e,(Zt,Gn)=>{Et(Zt,!1),Gt==null||Gt()},!1);a.refIds.get(Te)!==void 0&&Et(Te,!0)};return S(fe.type,{instance:a.refIds.get(Te)&&Te,parentInstance:B.instance,onInstanceAvailable:ft})}else return Se[_e]},has(Se,_e){return K[_e]!==void 0},set(Se,_e,fe){throw new Error("not allowed")},deleteProperty(Se,_e){throw new Error("not allowed")}})}else{const ee=function(fe,ne,Te){return Te&&fe.forEach((ft,Et)=>ne(ft,Et)),a.addCallback(a.refIds.get(fe),t.OPERATION.ADD,(ft,Et)=>{f.set(ne,!0),b=ne,ne(ft,Et),f.delete(ne),b=void 0})},Se=function(fe,ne){return a.addCallback(a.refIds.get(fe),t.OPERATION.DELETE,ne)},_e=function(fe,ne){return a.addCallback(a.refIds.get(fe),t.OPERATION.REPLACE,ne)};return new Proxy({onAdd:function(fe,ne=!0){if(B.instance)return ee(B.instance,fe,ne&&!f.has(b));if(B.onInstanceAvailable){let Te=()=>{};return B.onInstanceAvailable((ft,Et)=>{Te=ee(ft,fe,ne&&Et&&!f.has(b))}),()=>Te()}},onRemove:function(fe){if(B.instance)return Se(B.instance,fe);if(B.onInstanceAvailable){let ne=()=>{};return B.onInstanceAvailable(Te=>{ne=Se(Te,fe)}),()=>ne()}},onChange:function(fe){if(B.instance)return _e(B.instance,fe);if(B.onInstanceAvailable){let ne=()=>{};return B.onInstanceAvailable(Te=>{ne=_e(Te,fe)}),()=>ne()}}},{get(fe,ne){if(!fe[ne])throw new Error(`Can't access '${ne}' through callback proxy. access the instance directly.`);return fe[ne]},has(fe,ne){return fe[ne]!==void 0},set(fe,ne,Te){throw new Error("not allowed")},deleteProperty(fe,ne){throw new Error("not allowed")}})}}function D(C){return S(void 0,{instance:C})}return D}function Ws(_,a){_.triggerChanges=a}class Ks{constructor(a=!1){this.iterable=a,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,a&&(this.items=[])}add(a,l=Me,f=!0){var C,B;const b=a==null?void 0:a[y];if(b){if(!b.parent&&b.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${b.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",a),this;const S=a.constructor[Symbol.metadata];this.visible.add(b),this.iterable&&f&&this.items.push(a),f&&b.parent&&this.addParentOf(b,l);let D=this.changes.get(b.refId);if(D===void 0&&(D={},this.changes.set(b.refId,D)),l!==Me){this.tags||(this.tags=new WeakMap);let K;this.tags.has(b)?K=this.tags.get(b):(K=new Set,this.tags.set(b,K)),K.add(l),(B=(C=S==null?void 0:S[ve])==null?void 0:C[l])==null||B.forEach(J=>{b.getChange(J)!==t.OPERATION.DELETE&&(D[J]=t.OPERATION.ADD)})}else{const K=this.invisible.has(b),J=b.filteredChanges!==void 0?b.allFilteredChanges:b.allChanges;for(let ae=0,ee=J.operations.length;ae<ee;ae++){const Se=J.operations[ae];if(Se===void 0)continue;const _e=b.indexedOperations[Se]??t.OPERATION.ADD,fe=S==null?void 0:S[Se].tag;!b.isNew&&(K||fe===void 0||fe===l)&&_e!==t.OPERATION.DELETE&&(D[Se]=_e)}}return b.forEachChild((K,J)=>{S&&S[J].tag!==void 0&&S[J].tag!==l||this.add(K.ref,l,!1)}),this}addParentOf(a,l){var S;const f=a.parent[y],b=a.parentIndex;if(!this.visible.has(f)){this.visible.add(f);const D=(S=f.parent)==null?void 0:S[y];D&&D.filteredChanges!==void 0&&this.addParentOf(f,l)}if(f.getChange(b)!==t.OPERATION.DELETE){let D=this.changes.get(f.refId);D===void 0&&(D={},this.changes.set(f.refId,D)),this.tags||(this.tags=new WeakMap);let C;this.tags.has(f)?C=this.tags.get(f):(C=new Set,this.tags.set(f,C)),C.add(l),D[b]=t.OPERATION.ADD}}remove(a,l=Me,f=!1){var B;const b=a[y];if(!b)return console.warn("StateView#remove(), invalid object:",a),this;this.visible.delete(b),this.iterable&&!f&&ts(this.items,this.items.indexOf(a));const D=b.ref.constructor[Symbol.metadata];let C=this.changes.get(b.refId);if(C===void 0&&(C={},this.changes.set(b.refId,C)),l===Me){const K=b.parent;if(!rt.isValidInstance(K)&&b.isFiltered){const J=K[y];let ae=this.changes.get(J.refId);ae===void 0&&(ae={},this.changes.set(J.refId,ae)),ae[b.parentIndex]=t.OPERATION.DELETE}else(B=D==null?void 0:D[le])==null||B.forEach(J=>C[J]=t.OPERATION.DELETE)}else D==null||D[ve][l].forEach(K=>C[K]=t.OPERATION.DELETE);if(this.tags&&this.tags.has(b)){const K=this.tags.get(b);l===void 0?this.tags.delete(b):(K.delete(l),K.size===0&&this.tags.delete(b))}return this}has(a){return this.visible.has(a[y])}hasTag(a,l=Me){var b;const f=(b=this.tags)==null?void 0:b.get(a[y]);return(f==null?void 0:f.has(l))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let a=0,l=this.items.length;a<l;a++)this.remove(this.items[a],Me,!0);this.items.length=0}isChangeTreeVisible(a){let l=this.visible.has(a);return!l&&a.isVisibilitySharedWithParent&&this.visible.has(a.parent[y])&&(this.visible.add(a),l=!0),l}}Ee("map",{constructor:pe}),Ee("array",{constructor:de}),Ee("set",{constructor:Hn}),Ee("collection",{constructor:It}),t.$changes=y,t.$childType=O,t.$decoder=u,t.$deleteByIndex=p,t.$encoder=c,t.$filter=v,t.$getByIndex=g,t.$track=s,t.ArraySchema=de,t.ChangeTree=mn,t.CollectionSchema=It,t.Decoder=pi,t.Encoder=br,t.MapSchema=pe,t.Metadata=rt,t.Reflection=nr,t.ReflectionField=Lr,t.ReflectionType=Cr,t.Schema=gt,t.SetSchema=Hn,t.StateView=Ks,t.TypeContext=Ve,t.decode=G,t.decodeKeyValueOperation=kr,t.decodeSchemaOperation=Pr,t.defineCustomTypes=Be,t.defineTypes=it,t.deprecated=re,t.dumpChanges=Je,t.encode=Ge,t.encodeArray=tr,t.encodeKeyValueOperation=Vt,t.encodeSchemaOperation=Nr,t.entity=Oe,t.getDecoderStateCallbacks=zs,t.getRawChangesCallback=Ws,t.registerType=Ee,t.schema=Kt,t.type=De,t.view=Ke})})(_a,_a.exports);var ja=_a.exports,po=Cs,ii=ja;class Ph{constructor(e){this.events=e,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(e,t={}){const r=t.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(t.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(e,r),this.wt.ready.then(i=>{console.log("WebTransport ready!",i),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(c=>{this.reader=c.value.readable.getReader(),this.writer=c.value.writable.getWriter(),this.sendSeatReservation(t.room.roomId,t.sessionId,t.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(c=>{console.error("failed to read incoming stream",c),console.error("TODO: close the connection")})}).catch(i=>{console.log("WebTransport not ready!",i),this._close()}),this.wt.closed.then(i=>{console.log("WebTransport closed w/ success",i),this.events.onclose({code:i.closeCode,reason:i.reason})}).catch(i=>{console.log("WebTransport closed w/ error",i),this.events.onerror(i),this.events.onclose({code:i.closeCode,reason:i.reason})}).finally(()=>{this._close()})}send(e){const t=ii.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),r=new Uint8Array(t+e.length);r.set(this.lengthPrefixBuffer.subarray(0,t),0),r.set(e,t),this.writer.write(r)}sendUnreliable(e){const t=ii.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),r=new Uint8Array(t+e.length);r.set(this.lengthPrefixBuffer.subarray(0,t),0),r.set(e,t),this.unreliableWriter.write(r)}close(e,t){try{this.wt.close({closeCode:e,reason:t})}catch(r){console.error(r)}}readIncomingData(){return po.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.reader.read();const t=e.value,r={offset:0};do{const i=ii.decode.number(t,r);this.events.onmessage({data:t.subarray(r.offset,r.offset+i)}),r.offset+=i}while(r.offset<t.length)}catch(t){t.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",t);break}if(e.done)break}})}readIncomingUnreliableData(){return po.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.unreliableReader.read();const t=e.value,r={offset:0};do{const i=ii.decode.number(t,r);this.events.onmessage({data:t.subarray(r.offset,r.offset+i)}),r.offset+=i}while(r.offset<t.length)}catch(t){t.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",t);break}if(e.done)break}})}sendSeatReservation(e,t,r){const i={offset:0},s=[];ii.encode.string(s,e,i),ii.encode.string(s,t,i),r&&ii.encode.string(s,r,i),this.writer.write(new Uint8Array(s).buffer)}_close(){this.isOpen=!1}}Jl.H3TransportTransport=Ph;var Ql={},kh=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},$h=kh;const ta=globalThis.WebSocket||$h;let Lh=class{constructor(e){this.events=e}send(e){this.ws.send(e)}sendUnreliable(e){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(e,t){try{this.ws=new ta(e,{headers:t,protocols:this.protocols})}catch{this.ws=new ta(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,t){this.ws.close(e,t)}get isOpen(){return this.ws.readyState===ta.OPEN}};Ql.WebSocketTransport=Lh;var Ch=Jl,Bh=Ql;let Mh=class{constructor(e){switch(this.events={},e){case"h3":this.transport=new Ch.H3TransportTransport(this.events);break;default:this.transport=new Bh.WebSocketTransport(this.events);break}}connect(e,t){this.transport.connect.call(this.transport,e,t)}send(e){this.transport.send(e)}sendUnreliable(e){this.transport.sendUnreliable(e)}close(e,t){this.transport.close(e,t)}get isOpen(){return this.transport.isOpen}};Xl.Connection=Mh;var Ha={};(function(n){n.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(n.Protocol||(n.Protocol={})),n.ErrorCode=void 0,function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(n.ErrorCode||(n.ErrorCode={}))})(Ha);var Bs={};const ec={};function Uh(n,e){ec[n]=e}function Fh(n){const e=ec[n];if(!e)throw new Error("missing serializer: "+n);return e}Bs.getSerializer=Fh;Bs.registerSerializer=Uh;var Ga={};const Vh=()=>({emit(n,...e){let t=this.events[n]||[];for(let r=0,i=t.length;r<i;r++)t[r](...e)},events:{},on(n,e){var t;return!((t=this.events[n])===null||t===void 0)&&t.push(e)||(this.events[n]=[e]),()=>{var r;this.events[n]=(r=this.events[n])===null||r===void 0?void 0:r.filter(i=>e!==i)}}});Ga.createNanoEvents=Vh;var Za={};class tc{constructor(){this.handlers=[]}register(e,t=!1){return this.handlers.push(e),this}invoke(...e){this.handlers.forEach(t=>t.apply(this,e))}invokeAsync(...e){return Promise.all(this.handlers.map(t=>t.apply(this,e)))}remove(e){const t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function jh(){const n=new tc;function e(t){return n.register(t,this===null)}return e.once=t=>{const r=function(...i){t.apply(this,i),n.remove(r)};n.register(r)},e.remove=t=>n.remove(t),e.invoke=(...t)=>n.invoke(...t),e.invokeAsync=(...t)=>n.invokeAsync(...t),e.clear=()=>n.clear(),e}Za.EventEmitter=tc;Za.createSignal=jh;var Ms={},gs=ja;function Hh(n){try{return gs.getDecoderStateCallbacks(n.serializer.decoder)}catch{return}}let Gh=class{setState(e,t){this.decoder.decode(e,t)}getState(){return this.state}patch(e,t){return this.decoder.decode(e,t)}teardown(){this.decoder.root.clearRefs()}handshake(e,t){this.state?(gs.Reflection.decode(e,t),this.decoder=new gs.Decoder(this.state)):(this.decoder=gs.Reflection.decode(e,t),this.state=this.decoder.state)}};Ms.SchemaSerializer=Gh;Ms.getStateCallbacks=Hh;var wa;try{wa=new TextDecoder}catch{}var he,Fn,$=0,Ot={},ct,Zr,Un=0,ar=0,nn,Or,dn=[],lt,go={useRecords:!1,mapsAsObjects:!0};class nc{}const za=new nc;za.name="MessagePack 0xC1";var Kr=!1,rc=2,mo;try{new Function("")}catch{rc=1/0}class ei{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(he)return uc(()=>(Rs(),this?this.unpack(e,t):ei.prototype.unpack.call(go,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof t=="object"?(Fn=t.end||e.length,$=t.start||0):($=0,Fn=t>-1?t:e.length),ar=0,Zr=null,nn=null,he=e;try{lt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw he=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof ei){if(Ot=this,this.structures)return ct=this.structures,hs(t);(!ct||ct.length>0)&&(ct=[])}else Ot=go,(!ct||ct.length>0)&&(ct=[]);return hs(t)}unpackMultiple(e,t){let r,i=0;try{Kr=!0;let s=e.length,c=this?this.unpack(e,s):Fs.unpack(e,s);if(t){if(t(c,i,$)===!1)return;for(;$<s;)if(i=$,t(hs(),i,$)===!1)return}else{for(r=[c];$<s;)i=$,r.push(hs());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Kr=!1,Rs()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let i=e[r],s=t[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function hs(n){try{if(!Ot.trusted&&!Kr){let t=ct.sharedLength||0;t<ct.length&&(ct.length=t)}let e;if(Ot.randomAccessStructure&&he[$]<64&&he[$]>=32&&mo?(e=mo(he,$,Fn,Ot),he=null,!(n&&n.lazy)&&e&&(e=e.toJSON()),$=Fn):e=Ht(),nn&&($=nn.postBundlePosition,nn=null),Kr&&(ct.restoreStructures=null),$==Fn)ct&&ct.restoreStructures&&yo(),ct=null,he=null,Or&&(Or=null);else{if($>Fn)throw new Error("Unexpected end of MessagePack data");if(!Kr){let t;try{t=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){t="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw ct&&ct.restoreStructures&&yo(),Rs(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||$>Fn)&&(e.incomplete=!0),e}}function yo(){for(let n in ct.restoreStructures)ct[n]=ct.restoreStructures[n];ct.restoreStructures=null}function Ht(){let n=he[$++];if(n<160)if(n<128){if(n<64)return n;{let e=ct[n&63]||Ot.getStructures&&ic()[n&63];return e?(e.read||(e.read=Wa(e,n&63)),e.read()):n}}else if(n<144)if(n-=128,Ot.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=ac();r==="__proto__"&&(r="__proto_"),e[r]=Ht()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(Ht(),Ht());return e}else{n-=144;let e=new Array(n);for(let t=0;t<n;t++)e[t]=Ht();return Ot.freezeData?Object.freeze(e):e}else if(n<192){let e=n-160;if(ar>=$)return Zr.slice($-Un,($+=e)-Un);if(ar==0&&Fn<140){let t=e<16?Ka(e):sc(e);if(t!=null)return t}return Ta(e)}else{let e;switch(n){case 192:return null;case 193:return nn?(e=Ht(),e>0?nn[1].slice(nn.position1,nn.position1+=e):nn[0].slice(nn.position0,nn.position0-=e)):za;case 194:return!1;case 195:return!0;case 196:if(e=he[$++],e===void 0)throw new Error("Unexpected end of buffer");return na(e);case 197:return e=lt.getUint16($),$+=2,na(e);case 198:return e=lt.getUint32($),$+=4,na(e);case 199:return si(he[$++]);case 200:return e=lt.getUint16($),$+=2,si(e);case 201:return e=lt.getUint32($),$+=4,si(e);case 202:if(e=lt.getFloat32($),Ot.useFloat32>2){let t=Us[(he[$]&127)<<1|he[$+1]>>7];return $+=4,(t*e+(e>0?.5:-.5)>>0)/t}return $+=4,e;case 203:return e=lt.getFloat64($),$+=8,e;case 204:return he[$++];case 205:return e=lt.getUint16($),$+=2,e;case 206:return e=lt.getUint32($),$+=4,e;case 207:return Ot.int64AsType==="number"?(e=lt.getUint32($)*4294967296,e+=lt.getUint32($+4)):Ot.int64AsType==="string"?e=lt.getBigUint64($).toString():Ot.int64AsType==="auto"?(e=lt.getBigUint64($),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=lt.getBigUint64($),$+=8,e;case 208:return lt.getInt8($++);case 209:return e=lt.getInt16($),$+=2,e;case 210:return e=lt.getInt32($),$+=4,e;case 211:return Ot.int64AsType==="number"?(e=lt.getInt32($)*4294967296,e+=lt.getUint32($+4)):Ot.int64AsType==="string"?e=lt.getBigInt64($).toString():Ot.int64AsType==="auto"?(e=lt.getBigInt64($),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=lt.getBigInt64($),$+=8,e;case 212:if(e=he[$++],e==114)return To(he[$++]&63);{let t=dn[e];if(t)return t.read?($++,t.read(Ht())):t.noBuffer?($++,t()):t(he.subarray($,++$));throw new Error("Unknown extension "+e)}case 213:return e=he[$],e==114?($++,To(he[$++]&63,he[$++])):si(2);case 214:return si(4);case 215:return si(8);case 216:return si(16);case 217:return e=he[$++],ar>=$?Zr.slice($-Un,($+=e)-Un):zh(e);case 218:return e=lt.getUint16($),$+=2,ar>=$?Zr.slice($-Un,($+=e)-Un):Wh(e);case 219:return e=lt.getUint32($),$+=4,ar>=$?Zr.slice($-Un,($+=e)-Un):Kh(e);case 220:return e=lt.getUint16($),$+=2,bo(e);case 221:return e=lt.getUint32($),$+=4,bo(e);case 222:return e=lt.getUint16($),$+=2,Eo(e);case 223:return e=lt.getUint32($),$+=4,Eo(e);default:if(n>=224)return n-256;if(n===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+n)}}}const Zh=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Wa(n,e){function t(){if(t.count++>rc){let i=n.read=new Function("r","return function(){return "+(Ot.freezeData?"Object.freeze":"")+"({"+n.map(s=>s==="__proto__"?"__proto_:r()":Zh.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ht);return n.highByte===0&&(n.read=vo(e,n.read)),i()}let r={};for(let i=0,s=n.length;i<s;i++){let c=n[i];c==="__proto__"&&(c="__proto_"),r[c]=Ht()}return Ot.freezeData?Object.freeze(r):r}return t.count=0,n.highByte===0?vo(e,t):t}const vo=(n,e)=>function(){let t=he[$++];if(t===0)return e();let r=n<32?-(n+(t<<5)):n+(t<<5),i=ct[r]||ic()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Wa(i,n)),i.read()};function ic(){let n=uc(()=>(he=null,Ot.getStructures()));return ct=Ot._mergeStructures(n,ct)}var Ta=Qi,zh=Qi,Wh=Qi,Kh=Qi;let qh=!1;function Qi(n){let e;if(n<16&&(e=Ka(n)))return e;if(n>64&&wa)return wa.decode(he.subarray($,$+=n));const t=$+n,r=[];for(e="";$<t;){const i=he[$++];if(!(i&128))r.push(i);else if((i&224)===192){const s=he[$++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=he[$++]&63,c=he[$++]&63;r.push((i&31)<<12|s<<6|c)}else if((i&248)===240){const s=he[$++]&63,c=he[$++]&63,u=he[$++]&63;let v=(i&7)<<18|s<<12|c<<6|u;v>65535&&(v-=65536,r.push(v>>>10&1023|55296),v=56320|v&1023),r.push(v)}else r.push(i);r.length>=4096&&(e+=en.apply(String,r),r.length=0)}return r.length>0&&(e+=en.apply(String,r)),e}function bo(n){let e=new Array(n);for(let t=0;t<n;t++)e[t]=Ht();return Ot.freezeData?Object.freeze(e):e}function Eo(n){if(Ot.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=ac();r==="__proto__"&&(r="__proto_"),e[r]=Ht()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(Ht(),Ht());return e}}var en=String.fromCharCode;function sc(n){let e=$,t=new Array(n);for(let r=0;r<n;r++){const i=he[$++];if((i&128)>0){$=e;return}t[r]=i}return en.apply(String,t)}function Ka(n){if(n<4)if(n<2){if(n===0)return"";{let e=he[$++];if((e&128)>1){$-=1;return}return en(e)}}else{let e=he[$++],t=he[$++];if((e&128)>0||(t&128)>0){$-=2;return}if(n<3)return en(e,t);let r=he[$++];if((r&128)>0){$-=3;return}return en(e,t,r)}else{let e=he[$++],t=he[$++],r=he[$++],i=he[$++];if((e&128)>0||(t&128)>0||(r&128)>0||(i&128)>0){$-=4;return}if(n<6){if(n===4)return en(e,t,r,i);{let s=he[$++];if((s&128)>0){$-=5;return}return en(e,t,r,i,s)}}else if(n<8){let s=he[$++],c=he[$++];if((s&128)>0||(c&128)>0){$-=6;return}if(n<7)return en(e,t,r,i,s,c);let u=he[$++];if((u&128)>0){$-=7;return}return en(e,t,r,i,s,c,u)}else{let s=he[$++],c=he[$++],u=he[$++],v=he[$++];if((s&128)>0||(c&128)>0||(u&128)>0||(v&128)>0){$-=8;return}if(n<10){if(n===8)return en(e,t,r,i,s,c,u,v);{let g=he[$++];if((g&128)>0){$-=9;return}return en(e,t,r,i,s,c,u,v,g)}}else if(n<12){let g=he[$++],p=he[$++];if((g&128)>0||(p&128)>0){$-=10;return}if(n<11)return en(e,t,r,i,s,c,u,v,g,p);let y=he[$++];if((y&128)>0){$-=11;return}return en(e,t,r,i,s,c,u,v,g,p,y)}else{let g=he[$++],p=he[$++],y=he[$++],O=he[$++];if((g&128)>0||(p&128)>0||(y&128)>0||(O&128)>0){$-=12;return}if(n<14){if(n===12)return en(e,t,r,i,s,c,u,v,g,p,y,O);{let V=he[$++];if((V&128)>0){$-=13;return}return en(e,t,r,i,s,c,u,v,g,p,y,O,V)}}else{let V=he[$++],X=he[$++];if((V&128)>0||(X&128)>0){$-=14;return}if(n<15)return en(e,t,r,i,s,c,u,v,g,p,y,O,V,X);let Z=he[$++];if((Z&128)>0){$-=15;return}return en(e,t,r,i,s,c,u,v,g,p,y,O,V,X,Z)}}}}}function _o(){let n=he[$++],e;if(n<192)e=n-160;else switch(n){case 217:e=he[$++];break;case 218:e=lt.getUint16($),$+=2;break;case 219:e=lt.getUint32($),$+=4;break;default:throw new Error("Expected string")}return Qi(e)}function na(n){return Ot.copyBuffers?Uint8Array.prototype.slice.call(he,$,$+=n):he.subarray($,$+=n)}function si(n){let e=he[$++];if(dn[e]){let t;return dn[e](he.subarray($,t=$+=n),r=>{$=r;try{return Ht()}finally{$=t}})}else throw new Error("Unknown extension type "+e)}var wo=new Array(4096);function ac(){let n=he[$++];if(n>=160&&n<192){if(n=n-160,ar>=$)return Zr.slice($-Un,($+=n)-Un);if(!(ar==0&&Fn<180))return Ta(n)}else return $--,oc(Ht());let e=(n<<5^(n>1?lt.getUint16($):n>0?he[$]:0))&4095,t=wo[e],r=$,i=$+n-3,s,c=0;if(t&&t.bytes==n){for(;r<i;){if(s=lt.getUint32(r),s!=t[c++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=he[r++],s!=t[c++]){r=1879048192;break}if(r===i)return $=r,t.string;i-=3,r=$}for(t=[],wo[e]=t,t.bytes=n;r<i;)s=lt.getUint32(r),t.push(s),r+=4;for(i+=3;r<i;)s=he[r++],t.push(s);let u=n<16?Ka(n):sc(n);return u!=null?t.string=u:t.string=Ta(n)}function oc(n){if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";if(Ot.allowArraysInMapKeys&&Array.isArray(n)&&n.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return n.flat().toString();throw new Error(`Invalid property type for record: ${typeof n}`)}const To=(n,e)=>{let t=Ht().map(oc),r=n;e!==void 0&&(n=n<32?-((e<<5)+n):(e<<5)+n,t.highByte=e);let i=ct[n];return i&&(i.isShared||Kr)&&((ct.restoreStructures||(ct.restoreStructures=[]))[n]=i),ct[n]=t,t.read=Wa(t,r),t.read()};dn[0]=()=>{};dn[0].noBuffer=!0;dn[66]=n=>{let e=n.length,t=BigInt(n[0]&128?n[0]-256:n[0]);for(let r=1;r<e;r++)t<<=BigInt(8),t+=BigInt(n[r]);return t};let Yh={Error,TypeError,ReferenceError};dn[101]=()=>{let n=Ht();return(Yh[n[0]]||Error)(n[1],{cause:n[2]})};dn[105]=n=>{if(Ot.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=lt.getUint32($-4);Or||(Or=new Map);let t=he[$],r;t>=144&&t<160||t==220||t==221?r=[]:r={};let i={target:r};Or.set(e,i);let s=Ht();return i.used?Object.assign(r,s):(i.target=s,s)};dn[112]=n=>{if(Ot.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=lt.getUint32($-4),t=Or.get(e);return t.used=!0,t.target};dn[115]=()=>new Set(Ht());const lc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(n=>n+"Array");let Xh=typeof globalThis=="object"?globalThis:window;dn[116]=n=>{let e=n[0],t=lc[e];if(!t){if(e===16){let r=new ArrayBuffer(n.length-1);return new Uint8Array(r).set(n.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new Xh[t](Uint8Array.prototype.slice.call(n,1).buffer)};dn[120]=()=>{let n=Ht();return new RegExp(n[0],n[1])};const Jh=[];dn[98]=n=>{let e=(n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3],t=$;return $+=e-n.length,nn=Jh,nn=[_o(),_o()],nn.position0=0,nn.position1=0,nn.postBundlePosition=$,$=t,Ht()};dn[255]=n=>n.length==4?new Date((n[0]*16777216+(n[1]<<16)+(n[2]<<8)+n[3])*1e3):n.length==8?new Date(((n[0]<<22)+(n[1]<<14)+(n[2]<<6)+(n[3]>>2))/1e6+((n[3]&3)*4294967296+n[4]*16777216+(n[5]<<16)+(n[6]<<8)+n[7])*1e3):n.length==12?new Date(((n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3])/1e6+((n[4]&128?-281474976710656:0)+n[6]*1099511627776+n[7]*4294967296+n[8]*16777216+(n[9]<<16)+(n[10]<<8)+n[11])*1e3):new Date("invalid");function uc(n){let e=Fn,t=$,r=Un,i=ar,s=Zr,c=Or,u=nn,v=new Uint8Array(he.slice(0,Fn)),g=ct,p=ct.slice(0,ct.length),y=Ot,O=Kr,V=n();return Fn=e,$=t,Un=r,ar=i,Zr=s,Or=c,nn=u,he=v,Kr=O,ct=g,ct.splice(0,ct.length,...p),Ot=y,lt=new DataView(he.buffer,he.byteOffset,he.byteLength),V}function Rs(){he=null,Or=null,ct=null}function Qh(n){n.unpack?dn[n.type]=n.unpack:dn[n.type]=n}const Us=new Array(147);for(let n=0;n<256;n++)Us[n]=+("1e"+Math.floor(45.15-n*.30103));const ed=ei;var Fs=new ei({useRecords:!1});const td=Fs.unpack,nd=Fs.unpackMultiple,rd=Fs.unpack,fc={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let hc=new Float32Array(1),So=new Uint8Array(hc.buffer,0,4);function id(n){hc[0]=n;let e=Us[(So[3]&127)<<1|So[2]>>7];return(e*n+(n>0?.5:-.5)>>0)/e}let ms;try{ms=new TextEncoder}catch{}let Ns,qa;const Vs=typeof Buffer<"u",ds=Vs?function(n){return Buffer.allocUnsafeSlow(n)}:Uint8Array,dc=Vs?Buffer:Uint8Array,Ao=Vs?4294967296:2144337920;let F,Ri,Dt,L=0,vn,$t=null,sd;const ad=21760,od=/[\u0080-\uFFFF]/,yi=Symbol("record-id");class es extends ei{constructor(e){super(e),this.offset=0;let t,r,i,s,c=dc.prototype.utf8Write?function(M,oe){return F.utf8Write(M,oe,F.byteLength-oe)}:ms&&ms.encodeInto?function(M,oe){return ms.encodeInto(M,F.subarray(oe)).written}:!1,u=this;e||(e={});let v=e&&e.sequential,g=e.structures||e.saveStructures,p=e.maxSharedStructures;if(p==null&&(p=g?32:0),p>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let y=e.maxOwnStructures;y==null&&(y=g?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let O=p>32||y+p>64,V=p+64,X=p+y+64;if(X>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let Z=[],z=0,me=0;this.pack=this.encode=function(M,oe){if(F||(F=new ds(8192),Dt=F.dataView||(F.dataView=new DataView(F.buffer,0,8192)),L=0),vn=F.length-10,vn-L<2048?(F=new ds(F.length),Dt=F.dataView||(F.dataView=new DataView(F.buffer,0,F.length)),vn=F.length-10,L=0):L=L+7&2147483640,t=L,oe&yc&&(L+=oe&255),s=u.structuredClone?new Map:null,u.bundleStrings&&typeof M!="string"?($t=[],$t.size=1/0):$t=null,i=u.structures,i){i.uninitialized&&(i=u._mergeStructures(u.getStructures()));let te=i.sharedLength||0;if(te>p)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let Q=0;Q<te;Q++){let we=i[Q];if(!we)continue;let Ce,Ae=i.transitions;for(let We=0,nt=we.length;We<nt;We++){let wt=we[We];Ce=Ae[wt],Ce||(Ce=Ae[wt]=Object.create(null)),Ae=Ce}Ae[yi]=Q+64}this.lastNamedStructuresLength=te}v||(i.nextId=te+64)}r&&(r=!1);let se;try{u.randomAccessStructure&&M&&M.constructor&&M.constructor===Object?ot(M):Le(M);let te=$t;if($t&&xo(t,Le,0),s&&s.idsToInsert){let Q=s.idsToInsert.sort((We,nt)=>We.offset>nt.offset?1:-1),we=Q.length,Ce=-1;for(;te&&we>0;){let We=Q[--we].offset+t;We<te.stringsPosition+t&&Ce===-1&&(Ce=0),We>te.position+t?Ce>=0&&(Ce+=6):(Ce>=0&&(Dt.setUint32(te.position+t,Dt.getUint32(te.position+t)+Ce),Ce=-1),te=te.previous,we++)}Ce>=0&&te&&Dt.setUint32(te.position+t,Dt.getUint32(te.position+t)+Ce),L+=Q.length*6,L>vn&&tt(L),u.offset=L;let Ae=cd(F.subarray(t,L),Q);return s=null,Ae}return u.offset=L,oe&gc?(F.start=t,F.end=L,F):F.subarray(t,L)}catch(te){throw se=te,te}finally{if(i&&(le(),r&&u.saveStructures)){let te=i.sharedLength||0,Q=F.subarray(t,L),we=fd(i,u);if(!se)return u.saveStructures(we,we.isCompatible)===!1?u.pack(M,oe):(u.lastNamedStructuresLength=te,F.length>1073741824&&(F=null),Q)}F.length>1073741824&&(F=null),oe&mc&&(L=t)}};const le=()=>{me<10&&me++;let M=i.sharedLength||0;if(i.length>M&&!v&&(i.length=M),z>1e4)i.transitions=null,me=0,z=0,Z.length>0&&(Z=[]);else if(Z.length>0&&!v){for(let oe=0,se=Z.length;oe<se;oe++)Z[oe][yi]=0;Z=[]}},ve=M=>{var oe=M.length;oe<16?F[L++]=144|oe:oe<65536?(F[L++]=220,F[L++]=oe>>8,F[L++]=oe&255):(F[L++]=221,Dt.setUint32(L,oe),L+=4);for(let se=0;se<oe;se++)Le(M[se])},Le=M=>{L>vn&&(F=tt(L));var oe=typeof M,se;if(oe==="string"){let te=M.length;if($t&&te>=4&&te<4096){if(($t.size+=te)>ad){let Ae,We=($t[0]?$t[0].length*3+$t[1].length:0)+10;L+We>vn&&(F=tt(L+We));let nt;$t.position?(nt=$t,F[L]=200,L+=3,F[L++]=98,Ae=L-t,L+=4,xo(t,Le,0),Dt.setUint16(Ae+t-3,L-t-Ae)):(F[L++]=214,F[L++]=98,Ae=L-t,L+=4),$t=["",""],$t.previous=nt,$t.size=0,$t.position=Ae}let Ce=od.test(M);$t[Ce?0:1]+=M,F[L++]=193,Le(Ce?-te:te);return}let Q;te<32?Q=1:te<256?Q=2:te<65536?Q=3:Q=5;let we=te*3;if(L+we>vn&&(F=tt(L+we)),te<64||!c){let Ce,Ae,We,nt=L+Q;for(Ce=0;Ce<te;Ce++)Ae=M.charCodeAt(Ce),Ae<128?F[nt++]=Ae:Ae<2048?(F[nt++]=Ae>>6|192,F[nt++]=Ae&63|128):(Ae&64512)===55296&&((We=M.charCodeAt(Ce+1))&64512)===56320?(Ae=65536+((Ae&1023)<<10)+(We&1023),Ce++,F[nt++]=Ae>>18|240,F[nt++]=Ae>>12&63|128,F[nt++]=Ae>>6&63|128,F[nt++]=Ae&63|128):(F[nt++]=Ae>>12|224,F[nt++]=Ae>>6&63|128,F[nt++]=Ae&63|128);se=nt-L-Q}else se=c(M,L+Q);se<32?F[L++]=160|se:se<256?(Q<2&&F.copyWithin(L+2,L+1,L+1+se),F[L++]=217,F[L++]=se):se<65536?(Q<3&&F.copyWithin(L+3,L+2,L+2+se),F[L++]=218,F[L++]=se>>8,F[L++]=se&255):(Q<5&&F.copyWithin(L+5,L+3,L+3+se),F[L++]=219,Dt.setUint32(L,se),L+=4),L+=se}else if(oe==="number")if(M>>>0===M)M<32||M<128&&this.useRecords===!1||M<64&&!this.randomAccessStructure?F[L++]=M:M<256?(F[L++]=204,F[L++]=M):M<65536?(F[L++]=205,F[L++]=M>>8,F[L++]=M&255):(F[L++]=206,Dt.setUint32(L,M),L+=4);else if(M>>0===M)M>=-32?F[L++]=256+M:M>=-128?(F[L++]=208,F[L++]=M+256):M>=-32768?(F[L++]=209,Dt.setInt16(L,M),L+=2):(F[L++]=210,Dt.setInt32(L,M),L+=4);else{let te;if((te=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){F[L++]=202,Dt.setFloat32(L,M);let Q;if(te<4||(Q=M*Us[(F[L]&127)<<1|F[L+1]>>7])>>0===Q){L+=4;return}else L--}F[L++]=203,Dt.setFloat64(L,M),L+=8}else if(oe==="object"||oe==="function")if(!M)F[L++]=192;else{if(s){let Q=s.get(M);if(Q){if(!Q.id){let we=s.idsToInsert||(s.idsToInsert=[]);Q.id=we.push(Q)}F[L++]=214,F[L++]=112,Dt.setUint32(L,Q.id),L+=4;return}else s.set(M,{offset:L-t})}let te=M.constructor;if(te===Object)Rt(M);else if(te===Array)ve(M);else if(te===Map)if(this.mapAsEmptyObject)F[L++]=128;else{se=M.size,se<16?F[L++]=128|se:se<65536?(F[L++]=222,F[L++]=se>>8,F[L++]=se&255):(F[L++]=223,Dt.setUint32(L,se),L+=4);for(let[Q,we]of M)Le(Q),Le(we)}else{for(let Q=0,we=Ns.length;Q<we;Q++){let Ce=qa[Q];if(M instanceof Ce){let Ae=Ns[Q];if(Ae.write){Ae.type&&(F[L++]=212,F[L++]=Ae.type,F[L++]=0);let Wt=Ae.write.call(this,M);Wt===M?Array.isArray(M)?ve(M):Rt(M):Le(Wt);return}let We=F,nt=Dt,wt=L;F=null;let Mt;try{Mt=Ae.pack.call(this,M,Wt=>(F=We,We=null,L+=Wt,L>vn&&tt(L),{target:F,targetView:Dt,position:L-Wt}),Le)}finally{We&&(F=We,Dt=nt,L=wt,vn=F.length-10)}Mt&&(Mt.length+L>vn&&tt(Mt.length+L),L=ld(Mt,F,L,Ae.type));return}}if(Array.isArray(M))ve(M);else{if(M.toJSON){const Q=M.toJSON();if(Q!==M)return Le(Q)}if(oe==="function")return Le(this.writeFunction&&this.writeFunction(M));Rt(M)}}}else if(oe==="boolean")F[L++]=M?195:194;else if(oe==="bigint"){if(M<BigInt(1)<<BigInt(63)&&M>=-(BigInt(1)<<BigInt(63)))F[L++]=211,Dt.setBigInt64(L,M);else if(M<BigInt(1)<<BigInt(64)&&M>0)F[L++]=207,Dt.setBigUint64(L,M);else if(this.largeBigIntToFloat)F[L++]=203,Dt.setFloat64(L,Number(M));else{if(this.largeBigIntToString)return Le(M.toString());if(this.useBigIntExtension&&M<BigInt(2)**BigInt(1023)&&M>-(BigInt(2)**BigInt(1023))){F[L++]=199,L++,F[L++]=66;let te=[],Q;do{let we=M&BigInt(255);Q=(we&BigInt(128))===(M<BigInt(0)?BigInt(128):BigInt(0)),te.push(we),M>>=BigInt(8)}while(!((M===BigInt(0)||M===BigInt(-1))&&Q));F[L-2]=te.length;for(let we=te.length;we>0;)F[L++]=Number(te[--we]);return}else throw new RangeError(M+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}L+=8}else if(oe==="undefined")this.encodeUndefinedAsNil?F[L++]=192:(F[L++]=212,F[L++]=0,F[L++]=0);else throw new Error("Unknown type: "+oe)},ut=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?M=>{let oe;if(this.skipValues){oe=[];for(let Q in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(Q))&&!this.skipValues.includes(M[Q])&&oe.push(Q)}else oe=Object.keys(M);let se=oe.length;se<16?F[L++]=128|se:se<65536?(F[L++]=222,F[L++]=se>>8,F[L++]=se&255):(F[L++]=223,Dt.setUint32(L,se),L+=4);let te;if(this.coercibleKeyAsNumber)for(let Q=0;Q<se;Q++){te=oe[Q];let we=Number(te);Le(isNaN(we)?te:we),Le(M[te])}else for(let Q=0;Q<se;Q++)Le(te=oe[Q]),Le(M[te])}:M=>{F[L++]=222;let oe=L-t;L+=2;let se=0;for(let te in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(te))&&(Le(te),Le(M[te]),se++);if(se>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');F[oe+++t]=se>>8,F[oe+t]=se&255},St=this.useRecords===!1?ut:e.progressiveRecords&&!O?M=>{let oe,se=i.transitions||(i.transitions=Object.create(null)),te=L++-t,Q;for(let we in M)if(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(we)){if(oe=se[we],oe)se=oe;else{let Ce=Object.keys(M),Ae=se;se=i.transitions;let We=0;for(let nt=0,wt=Ce.length;nt<wt;nt++){let Mt=Ce[nt];oe=se[Mt],oe||(oe=se[Mt]=Object.create(null),We++),se=oe}te+t+1==L?(L--,bt(se,Ce,We)):_t(se,Ce,te,We),Q=!0,se=Ae[we]}Le(M[we])}if(!Q){let we=se[yi];we?F[te+t]=we:_t(se,Object.keys(M),te,0)}}:M=>{let oe,se=i.transitions||(i.transitions=Object.create(null)),te=0;for(let we in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(we))&&(oe=se[we],oe||(oe=se[we]=Object.create(null),te++),se=oe);let Q=se[yi];Q?Q>=96&&O?(F[L++]=((Q-=96)&31)+96,F[L++]=Q>>5):F[L++]=Q:bt(se,se.__keys__||Object.keys(M),te);for(let we in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(we))&&Le(M[we])},yt=typeof this.useRecords=="function"&&this.useRecords,Rt=yt?M=>{yt(M)?St(M):ut(M)}:St,tt=M=>{let oe;if(M>16777216){if(M-t>Ao)throw new Error("Packed buffer would be larger than maximum buffer size");oe=Math.min(Ao,Math.round(Math.max((M-t)*(M>67108864?1.25:2),4194304)/4096)*4096)}else oe=(Math.max(M-t<<2,F.length-1)>>12)+1<<12;let se=new ds(oe);return Dt=se.dataView||(se.dataView=new DataView(se.buffer,0,oe)),M=Math.min(M,F.length),F.copy?F.copy(se,0,t,M):se.set(F.slice(t,M)),L-=t,t=0,vn=se.length-10,F=se},bt=(M,oe,se)=>{let te=i.nextId;te||(te=64),te<V&&this.shouldShareStructure&&!this.shouldShareStructure(oe)?(te=i.nextOwnId,te<X||(te=V),i.nextOwnId=te+1):(te>=X&&(te=V),i.nextId=te+1);let Q=oe.highByte=te>=96&&O?te-96>>5:-1;M[yi]=te,M.__keys__=oe,i[te-64]=oe,te<V?(oe.isShared=!0,i.sharedLength=te-63,r=!0,Q>=0?(F[L++]=(te&31)+96,F[L++]=Q):F[L++]=te):(Q>=0?(F[L++]=213,F[L++]=114,F[L++]=(te&31)+96,F[L++]=Q):(F[L++]=212,F[L++]=114,F[L++]=te),se&&(z+=me*se),Z.length>=y&&(Z.shift()[yi]=0),Z.push(M),Le(oe))},_t=(M,oe,se,te)=>{let Q=F,we=L,Ce=vn,Ae=t;F=Ri,L=0,t=0,F||(Ri=F=new ds(8192)),vn=F.length-10,bt(M,oe,te),Ri=F;let We=L;if(F=Q,L=we,vn=Ce,t=Ae,We>1){let nt=L+We-1;nt>vn&&tt(nt);let wt=se+t;F.copyWithin(wt+We,wt+1,L),F.set(Ri.slice(0,We),wt),L=nt}else F[se+t]=Ri[0]},ot=M=>{let oe=sd(M,F,t,L,i,tt,(se,te,Q)=>{if(Q)return r=!0;L=te;let we=F;return Le(se),le(),we!==F?{position:L,targetView:Dt,target:F}:L},this);if(oe===0)return Rt(M);L=oe}}useBuffer(e){F=e,F.dataView||(F.dataView=new DataView(F.buffer,F.byteOffset,F.byteLength)),L=0}set position(e){L=e}get position(){return L}set buffer(e){F=e}get buffer(){return F}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}qa=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,nc];Ns=[{pack(n,e,t){let r=n.getTime()/1e3;if((this.useTimestamp32||n.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:c}=e(6);i[c++]=214,i[c++]=255,s.setUint32(c,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:c}=e(10);i[c++]=215,i[c++]=255,s.setUint32(c,n.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(c+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:i,targetView:s,position:c}=e(3);i[c++]=212,i[c++]=255,i[c++]=255}else{let{target:i,targetView:s,position:c}=e(15);i[c++]=199,i[c++]=12,i[c++]=255,s.setUint32(c,n.getMilliseconds()*1e6),s.setBigInt64(c+4,BigInt(Math.floor(r)))}}},{pack(n,e,t){if(this.setAsEmptyObject)return e(0),t({});let r=Array.from(n),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),t(r)}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),t([n.name,n.message,n.cause])}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),t([n.source,n.flags])}},{pack(n,e){this.moreTypes?Io(n,16,e):Oo(Vs?Buffer.from(n):new Uint8Array(n),e)}},{pack(n,e){let t=n.constructor;t!==dc&&this.moreTypes?Io(n,lc.indexOf(t.name),e):Oo(n,e)}},{pack(n,e){let{target:t,position:r}=e(1);t[r]=193}}];function Io(n,e,t,r){let i=n.byteLength;if(i+1<256){var{target:s,position:c}=t(4+i);s[c++]=199,s[c++]=i+1}else if(i+1<65536){var{target:s,position:c}=t(5+i);s[c++]=200,s[c++]=i+1>>8,s[c++]=i+1&255}else{var{target:s,position:c,targetView:u}=t(7+i);s[c++]=201,u.setUint32(c,i+1),c+=4}s[c++]=116,s[c++]=e,n.buffer||(n=new Uint8Array(n)),s.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),c)}function Oo(n,e){let t=n.byteLength;var r,i;if(t<256){var{target:r,position:i}=e(t+2);r[i++]=196,r[i++]=t}else if(t<65536){var{target:r,position:i}=e(t+3);r[i++]=197,r[i++]=t>>8,r[i++]=t&255}else{var{target:r,position:i,targetView:s}=e(t+5);r[i++]=198,s.setUint32(i,t),i+=4}r.set(n,i)}function ld(n,e,t,r){let i=n.length;switch(i){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:i<256?(e[t++]=199,e[t++]=i):i<65536?(e[t++]=200,e[t++]=i>>8,e[t++]=i&255):(e[t++]=201,e[t++]=i>>24,e[t++]=i>>16&255,e[t++]=i>>8&255,e[t++]=i&255)}return e[t++]=r,e.set(n,t),t+=i,t}function cd(n,e){let t,r=e.length*6,i=n.length-r;for(;t=e.pop();){let s=t.offset,c=t.id;n.copyWithin(s+r,s,i),r-=6;let u=s+r;n[u++]=214,n[u++]=105,n[u++]=c>>24,n[u++]=c>>16&255,n[u++]=c>>8&255,n[u++]=c&255,i=s}return n}function xo(n,e,t){if($t.length>0){Dt.setUint32($t.position+n,L+t-$t.position-n),$t.stringsPosition=L-n;let r=$t;$t=null,e(r[0]),e(r[1])}}function ud(n){if(n.Class){if(!n.pack&&!n.write)throw new Error("Extension has no pack or write function");if(n.pack&&!n.type)throw new Error("Extension has no type (numeric code to identify the extension)");qa.unshift(n.Class),Ns.unshift(n)}Qh(n)}function fd(n,e){return n.isCompatible=t=>{let r=!t||(e.lastNamedStructuresLength||0)===t.length;return r||e._mergeStructures(t),r},n}let pc=new es({useRecords:!1});const hd=pc.pack,dd=pc.pack,pd=es,{NEVER:gd,ALWAYS:md,DECIMAL_ROUND:yd,DECIMAL_FIT:vd}=fc,gc=512,mc=1024,yc=2048;function bd(n,e={}){if(!n||typeof n!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof n[Symbol.iterator]=="function")return Ed(n,e);if(typeof n.then=="function"||typeof n[Symbol.asyncIterator]=="function")return _d(n,e);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Ed(n,e){const t=new es(e);for(const r of n)yield t.pack(r)}async function*_d(n,e){const t=new es(e);for await(const r of n)yield t.pack(r)}function wd(n,e={}){if(!n||typeof n!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const t=new ei(e);let r;const i=s=>{let c;r&&(s=Buffer.concat([r,s]),r=void 0);try{c=t.unpackMultiple(s)}catch(u){if(u.incomplete)r=s.slice(u.lastPosition),c=u.values;else throw u}return c};if(typeof n[Symbol.iterator]=="function")return function*(){for(const c of n)yield*i(c)}();if(typeof n[Symbol.asyncIterator]=="function")return async function*(){for await(const c of n)yield*i(c)}()}const Td=wd,Sd=bd,Ad=!1,Id=!0,Od=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:md,C1:za,DECIMAL_FIT:vd,DECIMAL_ROUND:yd,Decoder:ed,Encoder:pd,FLOAT32_OPTIONS:fc,NEVER:gd,Packr:es,RESERVE_START_SPACE:yc,RESET_BUFFER_MODE:mc,REUSE_BUFFER_MODE:gc,Unpackr:ei,addExtension:ud,clearSource:Rs,decode:rd,decodeIter:Td,encode:dd,encodeIter:Sd,isNativeAccelerationEnabled:qh,mapsAsObjects:Id,pack:hd,roundFloat32:id,unpack:td,unpackMultiple:nd,useRecords:Ad},Symbol.toStringTag,{value:"Module"})),xd=Ia(Od);var Dd=Xl,Mn=Ha,Do=Bs,Rd=Ga,ps=Za,un=ja,Nd=Ms,Ro=Ji,No=xd;let Pd=class vc{constructor(e,t){this.onStateChange=ps.createSignal(),this.onError=ps.createSignal(),this.onLeave=ps.createSignal(),this.onJoin=ps.createSignal(),this.hasJoined=!1,this.onMessageHandlers=Rd.createNanoEvents(),this.roomId=null,this.name=e,this.packr=new No.Packr,this.packr.encode(void 0),t&&(this.serializer=new(Do.getSerializer("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError((r,i)=>{var s;return(s=console.warn)===null||s===void 0?void 0:s.call(console,`colyseus.js - onError => (${r}) ${i}`)}),this.onLeave(()=>this.removeAllListeners())}connect(e,t,r=this,i,s){const c=new Dd.Connection(i.protocol);if(r.connection=c,c.events.onmessage=vc.prototype.onMessageCallback.bind(r),c.events.onclose=function(u){var v;if(!r.hasJoined){(v=console.warn)===null||v===void 0||v.call(console,`Room connection was closed unexpectedly (${u.code}): ${u.reason}`),r.onError.invoke(u.code,u.reason);return}u.code===Ro.CloseCode.DEVMODE_RESTART&&t?t():(r.onLeave.invoke(u.code,u.reason),r.destroy())},c.events.onerror=function(u){var v;(v=console.warn)===null||v===void 0||v.call(console,`Room, onError (${u.code}): ${u.reason}`),r.onError.invoke(u.code,u.reason)},i.protocol==="h3"){const u=new URL(e);c.connect(u.origin,i)}else c.connect(e,s)}leave(e=!0){return new Promise(t=>{this.onLeave(r=>t(r)),this.connection?e?(this.packr.buffer[0]=Mn.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(Ro.CloseCode.CONSENTED)})}onMessage(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)}send(e,t){const r={offset:1};this.packr.buffer[0]=Mn.Protocol.ROOM_DATA,typeof e=="string"?un.encode.string(this.packr.buffer,e,r):un.encode.number(this.packr.buffer,e,r),this.packr.position=0;const i=t!==void 0?this.packr.pack(t,2048+r.offset):this.packr.buffer.subarray(0,r.offset);this.connection.send(i)}sendUnreliable(e,t){const r={offset:1};this.packr.buffer[0]=Mn.Protocol.ROOM_DATA,typeof e=="string"?un.encode.string(this.packr.buffer,e,r):un.encode.number(this.packr.buffer,e,r),this.packr.position=0;const i=t!==void 0?this.packr.pack(t,2048+r.offset):this.packr.buffer.subarray(0,r.offset);this.connection.sendUnreliable(i)}sendBytes(e,t){const r={offset:1};if(this.packr.buffer[0]=Mn.Protocol.ROOM_DATA_BYTES,typeof e=="string"?un.encode.string(this.packr.buffer,e,r):un.encode.number(this.packr.buffer,e,r),t.byteLength+r.offset>this.packr.buffer.byteLength){const i=new Uint8Array(r.offset+t.byteLength);i.set(this.packr.buffer),this.packr.useBuffer(i)}this.packr.buffer.set(t,r.offset),this.connection.send(this.packr.buffer.subarray(0,r.offset+t.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof Nd.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(e){const t=new Uint8Array(e.data),r={offset:1},i=t[0];if(i===Mn.Protocol.JOIN_ROOM){const s=un.decode.utf8Read(t,r,t[r.offset++]);if(this.serializerId=un.decode.utf8Read(t,r,t[r.offset++]),!this.serializer){const c=Do.getSerializer(this.serializerId);this.serializer=new c}t.byteLength>r.offset&&this.serializer.handshake&&this.serializer.handshake(t,r),this.reconnectionToken=`${this.roomId}:${s}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=Mn.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(i===Mn.Protocol.ERROR){const s=un.decode.number(t,r),c=un.decode.string(t,r);this.onError.invoke(s,c)}else if(i===Mn.Protocol.LEAVE_ROOM)this.leave();else if(i===Mn.Protocol.ROOM_STATE)this.serializer.setState(t,r),this.onStateChange.invoke(this.serializer.getState());else if(i===Mn.Protocol.ROOM_STATE_PATCH)this.serializer.patch(t,r),this.onStateChange.invoke(this.serializer.getState());else if(i===Mn.Protocol.ROOM_DATA){const s=un.decode.stringCheck(t,r)?un.decode.string(t,r):un.decode.number(t,r),c=t.byteLength>r.offset?No.unpack(t,{start:r.offset}):void 0;this.dispatchMessage(s,c)}else if(i===Mn.Protocol.ROOM_DATA_BYTES){const s=un.decode.stringCheck(t,r)?un.decode.string(t,r):un.decode.number(t,r);this.dispatchMessage(s,t.subarray(r.offset))}}dispatchMessage(e,t){var r;const i=this.getMessageHandlerKey(e);this.onMessageHandlers.events[i]?this.onMessageHandlers.emit(i,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):(r=console.warn)===null||r===void 0||r.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}};Va.Room=Pd;var bc={};function Po(n,e){e.headers=n.headers||{},e.statusMessage=n.statusText,e.statusCode=n.status,e.data=n.response}function Xn(n,e,t){return new Promise(function(r,i){t=t||{};var s=new XMLHttpRequest,c,u,v,g=t.body,p=t.headers||{};t.timeout&&(s.timeout=t.timeout),s.ontimeout=s.onerror=function(y){y.timeout=y.type=="timeout",i(y)},s.open(n,e.href||e),s.onload=function(){for(v=s.getAllResponseHeaders().trim().split(/[\r\n]+/),Po(s,s);u=v.shift();)u=u.split(": "),s.headers[u.shift().toLowerCase()]=u.join(": ");if(u=s.headers["content-type"],u&&~u.indexOf("application/json"))try{s.data=JSON.parse(s.data,t.reviver)}catch(y){return Po(s,y),i(y)}(s.status>=400?i:r)(s)},typeof FormData<"u"&&g instanceof FormData||g&&typeof g=="object"&&(p["content-type"]="application/json",g=JSON.stringify(g)),s.withCredentials=!!t.withCredentials;for(c in p)s.setRequestHeader(c,p[c]);s.send(g)})}var kd=Xn.bind(Xn,"GET"),$d=Xn.bind(Xn,"POST"),Ld=Xn.bind(Xn,"PATCH"),Cd=Xn.bind(Xn,"DELETE"),Bd=Xn.bind(Xn,"PUT");const Md=Object.freeze(Object.defineProperty({__proto__:null,del:Cd,get:kd,patch:Ld,post:$d,put:Bd,send:Xn},Symbol.toStringTag,{value:"Module"})),Ud=Ia(Md);var Fd=Ji,Vd=Ud;function jd(n){var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,Object.freeze(e)}var Hd=jd(Vd);let Gd=class{constructor(e,t={}){this.client=e,this.headers=t}get(e,t={}){return this.request("get",e,t)}post(e,t={}){return this.request("post",e,t)}del(e,t={}){return this.request("del",e,t)}put(e,t={}){return this.request("put",e,t)}request(e,t,r={}){return Hd[e](this.client.getHttpEndpoint(t),this.getOptions(r)).catch(i=>{var s;const c=i.statusCode,u=((s=i.data)===null||s===void 0?void 0:s.error)||i.statusMessage||i.message;throw!c&&!u?i:new Fd.ServerError(c,u)})}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}};bc.HTTP=Gd;var Ya={},js={},ko=Cs;let ai;function Xa(){if(!ai)try{ai=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!ai&&typeof globalThis.indexedDB<"u"&&(ai=new Kd),ai||(ai={cache:{},setItem:function(n,e){this.cache[n]=e},getItem:function(n){this.cache[n]},removeItem:function(n){delete this.cache[n]}}),ai}function Zd(n,e){Xa().setItem(n,e)}function zd(n){Xa().removeItem(n)}function Wd(n,e){const t=Xa().getItem(n);typeof Promise>"u"||!(t instanceof Promise)?e(t):t.then(r=>e(r))}class Kd{constructor(){this.dbPromise=new Promise(e=>{const t=indexedDB.open("_colyseus_storage",1);t.onupgradeneeded=()=>t.result.createObjectStore("store"),t.onsuccess=()=>e(t.result)})}tx(e,t){return ko.__awaiter(this,void 0,void 0,function*(){const i=(yield this.dbPromise).transaction("store",e).objectStore("store");return t(i)})}setItem(e,t){return this.tx("readwrite",r=>r.put(t,e)).then()}getItem(e){return ko.__awaiter(this,void 0,void 0,function*(){const t=yield this.tx("readonly",r=>r.get(e));return new Promise(r=>{t.onsuccess=()=>r(t.result)})})}removeItem(e){return this.tx("readwrite",t=>t.delete(e)).then()}}js.getItem=Wd;js.removeItem=zd;js.setItem=Zd;var Qt=Cs,ra=js,qd=Ga,ys,Sa,Vr,vs;let Yd=class{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},ys.set(this,!1),Sa.set(this,void 0),Vr.set(this,void 0),vs.set(this,qd.createNanoEvents()),ra.getItem(this.settings.key,t=>this.token=t)}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){const t=Qt.__classPrivateFieldGet(this,vs,"f").on("change",e);return Qt.__classPrivateFieldGet(this,ys,"f")||Qt.__classPrivateFieldSet(this,Sa,new Promise((r,i)=>{this.getUserData().then(s=>{this.emitChange(Object.assign(Object.assign({},s),{token:this.token}))}).catch(s=>{this.emitChange({user:null,token:void 0})}).finally(()=>{r()})}),"f"),Qt.__classPrivateFieldSet(this,ys,!0,"f"),t}getUserData(){return Qt.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(e,t,r){return Qt.__awaiter(this,void 0,void 0,function*(){const i=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:t,options:r}})).data;return this.emitChange(i),i})}signInWithEmailAndPassword(e,t){return Qt.__awaiter(this,void 0,void 0,function*(){const r=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:t}})).data;return this.emitChange(r),r})}signInAnonymously(e){return Qt.__awaiter(this,void 0,void 0,function*(){const t=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(t),t})}sendPasswordResetEmail(e){return Qt.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data})}signInWithProvider(e){return Qt.__awaiter(this,arguments,void 0,function*(t,r={}){return new Promise((i,s)=>{const c=r.width||480,u=r.height||768,v=this.token?`?token=${this.token}`:"",g=`Login with ${t[0].toUpperCase()+t.substring(1)}`,p=this.http.client.getHttpEndpoint(`${r.prefix||`${this.settings.path}/provider`}/${t}${v}`),y=screen.width/2-c/2,O=screen.height/2-u/2;Qt.__classPrivateFieldSet(this,Vr,window.open(p,g,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+c+", height="+u+", top="+O+", left="+y),"f");const V=Z=>{Z.data.user===void 0&&Z.data.token===void 0||(clearInterval(X),Qt.__classPrivateFieldGet(this,Vr,"f").close(),Qt.__classPrivateFieldSet(this,Vr,void 0,"f"),window.removeEventListener("message",V),Z.data.error!==void 0?s(Z.data.error):(i(Z.data),this.emitChange(Z.data)))},X=setInterval(()=>{(!Qt.__classPrivateFieldGet(this,Vr,"f")||Qt.__classPrivateFieldGet(this,Vr,"f").closed)&&(Qt.__classPrivateFieldSet(this,Vr,void 0,"f"),s("cancelled"),window.removeEventListener("message",V))},200);window.addEventListener("message",V)})})}signOut(){return Qt.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(e){e.token!==void 0&&(this.token=e.token,e.token===null?ra.removeItem(this.settings.key):ra.setItem(this.settings.key,e.token)),Qt.__classPrivateFieldGet(this,vs,"f").emit("change",e)}};ys=new WeakMap,Sa=new WeakMap,Vr=new WeakMap,vs=new WeakMap;Ya.Auth=Yd;var Ec={};function Xd(n){var e;const t=((e=window==null?void 0:window.location)===null||e===void 0?void 0:e.hostname)||"localhost",r=n.hostname.split("."),i=!n.hostname.includes("trycloudflare.com")&&!n.hostname.includes("discordsays.com")&&r.length>2?`/${r[0]}`:"";return n.pathname.startsWith("/.proxy")?`${n.protocol}//${t}${i}${n.pathname}${n.search}`:`${n.protocol}//${t}/.proxy/colyseus${i}${n.pathname}${n.search}`}Ec.discordURLBuilder=Xd;var wr=Cs,Jd=Ji,Qd=Va,ep=bc,tp=Ya,np=Ec,ia;class Hs extends Error{constructor(e,t){super(e),this.code=t,this.name="MatchMakeError",Object.setPrototypeOf(this,Hs.prototype)}}const $o=typeof window<"u"&&typeof((ia=window==null?void 0:window.location)===null||ia===void 0?void 0:ia.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class _c{constructor(e=$o,t){var r,i;if(typeof e=="string"){const s=e.startsWith("/")?new URL(e,$o):new URL(e),c=s.protocol==="https:"||s.protocol==="wss:",u=Number(s.port||(c?443:80));this.settings={hostname:s.hostname,pathname:s.pathname,port:u,secure:c}}else e.port===void 0&&(e.port=e.secure?443:80),e.pathname===void 0&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new ep.HTTP(this,(t==null?void 0:t.headers)||{}),this.auth=new tp.Auth(this.http),this.urlBuilder=t==null?void 0:t.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((i=(r=window==null?void 0:window.location)===null||r===void 0?void 0:r.hostname)===null||i===void 0)&&i.includes("discordsays.com"))&&(this.urlBuilder=np.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e){return wr.__awaiter(this,arguments,void 0,function*(t,r={},i){return yield this.createMatchMakeRequest("joinOrCreate",t,r,i)})}create(e){return wr.__awaiter(this,arguments,void 0,function*(t,r={},i){return yield this.createMatchMakeRequest("create",t,r,i)})}join(e){return wr.__awaiter(this,arguments,void 0,function*(t,r={},i){return yield this.createMatchMakeRequest("join",t,r,i)})}joinById(e){return wr.__awaiter(this,arguments,void 0,function*(t,r={},i){return yield this.createMatchMakeRequest("joinById",t,r,i)})}reconnect(e,t){return wr.__awaiter(this,void 0,void 0,function*(){if(typeof e=="string"&&typeof t=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[r,i]=e.split(":");if(!r||!i)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",r,{reconnectionToken:i},t)})}consumeSeatReservation(e,t,r){return wr.__awaiter(this,void 0,void 0,function*(){const i=this.createRoom(e.room.name,t);i.roomId=e.room.roomId,i.sessionId=e.sessionId;const s={sessionId:i.sessionId};e.reconnectionToken&&(s.reconnectionToken=e.reconnectionToken);const c=r||i;return i.connect(this.buildEndpoint(e.room,s,e.protocol),e.devMode&&(()=>wr.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${i.roomId}'...`);let u=0,v=8;const g=()=>wr.__awaiter(this,void 0,void 0,function*(){u++;try{yield this.consumeSeatReservation(e,t,c),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${i.roomId}'`)}catch{u<v?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${u} out of ${v})`),setTimeout(g,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(g,2e3)})),c,e,this.http.headers),new Promise((u,v)=>{const g=(p,y)=>v(new Jd.ServerError(p,y));c.onError.once(g),c.onJoin.once(()=>{c.onError.remove(g),u(c)})})})}createMatchMakeRequest(e,t){return wr.__awaiter(this,arguments,void 0,function*(r,i,s={},c,u){const v=(yield this.http.post(`matchmake/${r}/${i}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).data;if(v.error)throw new Hs(v.error,v.code);return r==="reconnect"&&(v.reconnectionToken=s.reconnectionToken),yield this.consumeSeatReservation(v,c,u)})}createRoom(e,t){return new Qd.Room(e,t)}buildEndpoint(e,t={},r="ws"){const i=[];this.http.authToken&&(t._authToken=this.http.authToken);for(const u in t)t.hasOwnProperty(u)&&i.push(`${u}=${t[u]}`);r==="h3"&&(r="http");let s=this.settings.secure?`${r}s://`:`${r}://`;e.publicAddress?s+=`${e.publicAddress}`:s+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const c=`${s}/${e.processId}/${e.roomId}?${i.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(c)):c}getHttpEndpoint(e=""){const t=e.startsWith("/")?e:`/${e}`,r=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${t}`;return this.urlBuilder?this.urlBuilder(new URL(r)):r}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}_c.VERSION="0.16.16";Ua.Client=_c;Ua.MatchMakeError=Hs;var wc={};class rp{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}}wc.NoneSerializer=rp;(function(n){var e=Ua,t=Ha,r=Va,i=Ya,s=Ji,c=Ms,u=wc,v=Bs;v.registerSerializer("schema",c.SchemaSerializer),v.registerSerializer("none",u.NoneSerializer),n.Client=e.Client,n.MatchMakeError=e.MatchMakeError,Object.defineProperty(n,"ErrorCode",{enumerable:!0,get:function(){return t.ErrorCode}}),Object.defineProperty(n,"Protocol",{enumerable:!0,get:function(){return t.Protocol}}),n.Room=r.Room,n.Auth=i.Auth,n.ServerError=s.ServerError,n.SchemaSerializer=c.SchemaSerializer,n.getStateCallbacks=c.getStateCallbacks,n.registerSerializer=v.registerSerializer})(qn);let A=null,Lo=null,zr=new Map;async function Ja(){return A?new Promise(n=>{const e=setTimeout(()=>{console.error("loadAllCardData: Timeout while waiting for card data"),n(!1)},5e3);A.send("getAllCards"),A.onMessage("allCards",t=>{clearTimeout(e),console.log(`Received ${t.length} cards from server`),zr.clear(),t.forEach(r=>{zr.set(r.id,r)}),n(!0)})}):!1}async function Tc(n,e){const t=location.host.includes("localhost")?"ws://localhost:4001":`wss://${location.host}/.proxy/api`;Lo=new qn.Client(t);try{console.log("Attempting to join or create Colyseus room..."),A=await Lo.joinOrCreate("game",{accessToken:n,username:e}),console.log("Successfully joined room:",A.roomId),console.log("Session ID:",A.sessionId),console.log("Initial room state:",A.state.toJSON()),console.log("Loading all card data..."),await Ja(),console.log("Card data loaded, cache size:",zr.size),A.onStateChange(r=>{}),A.onError((r,i)=>{console.error("Colyseus room error:",r,i),A=null}),A.onLeave(r=>{console.log("Left Colyseus room, code:",r),A=null})}catch(r){throw console.error("Failed to connect to Colyseus:",r),r instanceof ProgressEvent?(console.error("Connection failed: Network error (ProgressEvent). Potential causes:"),console.error("- Colyseus server might not be running or accessible at the target URL:",t),console.error("- WebSocket connection blocked by firewall or proxy."),console.error("- Incorrect WebSocket proxy configuration on the deployment server (if applicable)."),alert("Failed to connect to game server: Network Error. Please ensure the server is running and accessible.")):r instanceof Error?(console.error("Connection failed due to error:",r.message),alert(`Failed to connect to game server: ${r.message}`)):(console.error("Connection failed due to unknown error:",r),alert("Failed to connect to game server: An unknown error occurred.")),A=null,r}}let bn;const Sc=new URLSearchParams(window.location.search),Qa=Sc.get("frame_id")!=null;let Wr;const sa=Gs("user_id"),ip=Gs("guild_id"),sp=Gs("channel_id"),ap=async()=>{if(Qa){const n="1363939642289946886";console.log("Discord SDK: Using embedded client ID:",n),Wr=new yh(n),await Wr.ready()}else{Wr=new xl("1363939642289946886",ip,sp);const n=String(sa.charCodeAt(0)%5),e={access_token:"mock_token",user:{username:sa,discriminator:n,id:sa,avatar:null,public_flags:1},scopes:[],expires:new Date(2112,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}};Wr._updateCommandMocks({authenticate:async()=>(bn=e,console.log("Mock Authentication successful:",bn),await Tc(bn.access_token,bn.user.username),e),authorize:async()=>(console.log("Mock Authorize called"),{code:"mock_code"})})}},op=async()=>{if(!Qa){console.log("Running locally, attempting mock authentication...");try{return await Wr.commands.authenticate(),!0}catch(e){return console.error("Mock authentication failed:",e),!1}}let n="authorize";try{console.log("Requesting Discord authorization...");const{code:e}=await Wr.commands.authorize({client_id:"1363939642289946886",response_type:"code",state:"",prompt:"none",scope:["identify","guilds"]});console.log("Authorization code received:",e),n="fetchToken",console.log("Fetching access token from /.proxy/api/token...");const t=await fetch("/.proxy/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(console.log("Token fetch response received. Status:",t.status),!t.ok){const i=await t.text();throw console.error("Token fetch failed:",t.status,t.statusText,i),new Error(`Token fetch failed: ${t.status} ${t.statusText} - ${i}`)}const{access_token:r}=await t.json();if(console.log("Access token received successfully."),n="discordAuthenticate",console.log("Authenticating with Discord SDK..."),bn=await Wr.commands.authenticate({access_token:r}),!(bn!=null&&bn.user))throw console.error("Discord SDK Authentication failed: No user data received.",bn),new Error("Discord SDK Authentication failed to return user data.");console.log("Discord SDK Authentication successful:",bn.user.username),n="connectColyseus",console.log("Connecting to Colyseus...");try{await Tc(bn.access_token,bn.user.username),console.log("Colyseus connection successful.")}catch(i){throw console.error("Colyseus connection failed:",i),i}return!0}catch(e){return console.error(`Error during step: ${n}`),console.error("Discord authorization or Colyseus connection failed:",e),e instanceof ProgressEvent?console.error("Network error (ProgressEvent) occurred, likely during fetch."):e.message&&e.message.includes("Token fetch failed")?console.error("Error specifically during token fetch step."):n==="connectColyseus"&&console.error("Error specifically during Colyseus connection step."),bn=null,!1}},lp=()=>bn?bn.user.username:!Qa&&Wr instanceof xl?Gs("user_id")||"MockUser":"User";function Gs(n){const e=Sc.get(n);if(e!=null)return e;const t=sessionStorage.getItem(n);if(t!=null)return t;const r=Math.random().toString(36).slice(2,10);return sessionStorage.setItem(n,r),r}class cp extends dr.Scene{constructor(){super("Boot")}preload(){this.load.setPath("assets/")}create(){this.scene.start("Preloader")}}class up extends dr.Scene{constructor(){super("Game")}async create(){this.scene.launch("background"),this.add.image(this.cameras.main.width*.5,this.cameras.main.height*.4,"grid").setScale(.6),await this.connect(),this.room.state.draggables.onAdd((t,r)=>{const i=this.add.image(t.x,t.y,r).setInteractive();i.name=r,i.setScale(.8),this.input.setDraggable(i),i.on("drag",(s,c,u)=>{this.room&&(i.x=Phaser.Math.Clamp(c,i.displayWidth/2,Number(this.game.config.width)-i.displayWidth/2),i.y=Phaser.Math.Clamp(u,i.displayHeight/2,Number(this.game.config.height)-i.displayHeight/2),this.room.send("move",{imageId:r,x:i.x,y:i.y}))})}),this.add.text(this.cameras.main.width*.5,this.cameras.main.height*.95,`Connected as: ${lp()}`,{font:"14px Arial",color:"#000000"}).setOrigin(.5)}async connect(){const e=location.host==="localhost:3000"?"ws://localhost:3001":`wss://${location.host}/.proxy/api/colyseus`,t=new qn.Client(`${e}`);try{this.room=await t.joinOrCreate("some_other_room",{screenWidth:this.game.config.width,screenHeight:this.game.config.height}),this.room.onMessage("move",r=>{}),console.log("Successfully connected!")}catch(r){console.log(`Could not connect with the server: ${r}`)}}}class fp extends dr.Scene{constructor(){super("MainMenu")}create(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let t=this.cameras.main.width/e.width+.2,r=this.cameras.main.height/e.height+.2,i=Math.max(t,r);e.setScale(i).setScrollFactor(0),this.add.text(Number(this.game.config.width)*.5,300,"Legends of the Friendgroup",{fontFamily:"Arial Black",fontSize:58,color:"#ffff00",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(Number(this.game.config.width)*.5,460,"Click to Start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,520,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.input.once("pointerdown",async()=>{this.statusText.setText("Authorizing with Discord..."),await op()?(this.statusText.setText("Connecting to server..."),await new Promise(c=>setTimeout(c,1e3)),A?(this.statusText.setText("Loading game data..."),await Ja()?(this.statusText.setText("Connected! Entering Lobby..."),this.scene.start("Lobby")):this.statusText.setText("Failed to load game data. Please try again.")):this.statusText.setText("Failed to connect to server. Please try again.")):this.statusText.setText("Discord authorization failed. Please try again.")})}}class hp extends dr.Scene{constructor(){super("Preloader")}init(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let t=this.cameras.main.width/e.width+.2,r=this.cameras.main.height/e.height+.2,i=Math.max(t,r);e.setScale(i).setScrollFactor(0),this.add.rectangle(Number(this.game.config.width)*.5,Number(this.game.config.height)*.5,468,32).setStrokeStyle(1,16777215);const s=this.add.rectangle(Number(this.game.config.width)*.5-230,Number(this.game.config.height)*.5,4,28,16777215);this.load.on("progress",c=>{s.width=4+460*c})}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("cardFullTier1","CardFullTier1.png"),this.load.image("cardMinionTier1","CardMinionTier1.png")}create(){this.scene.start("MainMenu")}}class dp extends dr.Scene{constructor(){super("background")}create(){this.cameras.main.setBackgroundColor(11393254),this.scene.sendToBack()}}var Co={exports:{}};(function(n,e){(function(t,r){r(e)})(Aa,function(t){var r=function(d,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,w){h.__proto__=w}||function(h,w){for(var R in w)Object.prototype.hasOwnProperty.call(w,R)&&(h[R]=w[R])},r(d,o)};function i(d,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");r(d,o);function h(){this.constructor=d}d.prototype=o===null?Object.create(o):(h.prototype=o.prototype,new h)}function s(d,o,h,w){var R=arguments.length,q=R<3?o:w===null?w=Object.getOwnPropertyDescriptor(o,h):w,Ie;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")q=Reflect.decorate(d,o,h,w);else for(var de=d.length-1;de>=0;de--)(Ie=d[de])&&(q=(R<3?Ie(q):R>3?Ie(o,h,q):Ie(o,h))||q);return R>3&&q&&Object.defineProperty(o,h,q),q}function c(d,o,h){if(h||arguments.length===2)for(var w=0,R=o.length,q;w<R;w++)(q||!(w in o))&&(q||(q=Array.prototype.slice.call(o,0,w)),q[w]=o[w]);return d.concat(q||Array.prototype.slice.call(o))}typeof SuppressedError=="function"&&SuppressedError;var u=255,v=213;t.OPERATION=void 0,function(d){d[d.ADD=128]="ADD",d[d.REPLACE=0]="REPLACE",d[d.DELETE=64]="DELETE",d[d.DELETE_AND_ADD=192]="DELETE_AND_ADD",d[d.TOUCH=1]="TOUCH",d[d.CLEAR=10]="CLEAR"}(t.OPERATION||(t.OPERATION={}));var g=function(){function d(o,h,w){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=o,this.setParent(h,w)}return d.prototype.setParent=function(o,h,w){var R=this;if(this.indexes||(this.indexes=this.ref instanceof Vt?this.ref._definition.indexes:{}),this.parent=o,this.parentIndex=w,!!h)if(this.root=h,this.ref instanceof Vt){var q=this.ref._definition;for(var Ie in q.schema){var de=this.ref[Ie];if(de&&de.$changes){var Qe=q.indexes[Ie];de.$changes.setParent(this.ref,h,Qe)}}}else typeof this.ref=="object"&&this.ref.forEach(function(Ye,pe){if(Ye instanceof Vt){var Me=Ye.$changes,Oe=R.ref.$changes.indexes[pe];Me.setParent(R.ref,R.root,Oe)}})},d.prototype.operation=function(o){this.changes.set(--this.currentCustomOperation,o)},d.prototype.change=function(o,h){h===void 0&&(h=t.OPERATION.ADD);var w=typeof o=="number"?o:this.indexes[o];this.assertValidIndex(w,o);var R=this.changes.get(w);(!R||R.op===t.OPERATION.DELETE||R.op===t.OPERATION.TOUCH)&&this.changes.set(w,{op:R&&R.op===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:h,index:w}),this.allChanges.add(w),this.changed=!0,this.touchParents()},d.prototype.touch=function(o){var h=typeof o=="number"?o:this.indexes[o];this.assertValidIndex(h,o),this.changes.has(h)||this.changes.set(h,{op:t.OPERATION.TOUCH,index:h}),this.allChanges.add(h),this.touchParents()},d.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},d.prototype.getType=function(o){if(this.ref._definition){var h=this.ref._definition;return h.schema[h.fieldsByIndex[o]]}else{var h=this.parent._definition,w=h.schema[h.fieldsByIndex[this.parentIndex]];return Object.values(w)[0]}},d.prototype.getChildrenFilter=function(){var o=this.parent._definition.childFilters;return o&&o[this.parentIndex]},d.prototype.getValue=function(o){return this.ref.getByIndex(o)},d.prototype.delete=function(o){var h=typeof o=="number"?o:this.indexes[o];if(h===void 0){console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(o," (").concat(h,")"));return}var w=this.getValue(h);this.changes.set(h,{op:t.OPERATION.DELETE,index:h}),this.allChanges.delete(h),delete this.caches[h],w&&w.$changes&&(w.$changes.parent=void 0),this.changed=!0,this.touchParents()},d.prototype.discard=function(o,h){var w=this;o===void 0&&(o=!1),h===void 0&&(h=!1),this.ref instanceof Vt||this.changes.forEach(function(R){if(R.op===t.OPERATION.DELETE){var q=w.ref.getIndex(R.index);delete w.indexes[q]}}),this.changes.clear(),this.changed=o,h&&this.allChanges.clear(),this.currentCustomOperation=0},d.prototype.discardAll=function(){var o=this;this.changes.forEach(function(h){var w=o.getValue(h.index);w&&w.$changes&&w.$changes.discardAll()}),this.discard()},d.prototype.cache=function(o,h){this.caches[o]=h},d.prototype.clone=function(){return new d(this.ref,this.parent,this.root)},d.prototype.ensureRefId=function(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())},d.prototype.assertValidIndex=function(o,h){if(o===void 0)throw new Error('ChangeTree: missing index for field "'.concat(h,'"'))},d}();function p(d,o,h,w){return d[o]||(d[o]=[]),d[o].push(h),w==null||w.forEach(function(R,q){return h(R,q)}),function(){return O(d[o],d[o].indexOf(h))}}function y(d){var o=this,h=typeof this.$changes.getType()!="string";this.$items.forEach(function(w,R){d.push({refId:o.$changes.refId,op:t.OPERATION.DELETE,field:R,value:void 0,previousValue:w}),h&&o.$changes.root.removeRef(w.$changes.refId)})}function O(d,o){if(o===-1||o>=d.length)return!1;for(var h=d.length-1,w=o;w<h;w++)d[w]=d[w+1];return d.length=h,!0}var V=function(d,o){var h=d.toString(),w=o.toString();return h<w?-1:h>w?1:0};function X(d){return d.$proxy=!0,d=new Proxy(d,{get:function(o,h){return typeof h!="symbol"&&!isNaN(h)?o.at(h):o[h]},set:function(o,h,w){if(typeof h!="symbol"&&!isNaN(h)){var R=Array.from(o.$items.keys()),q=parseInt(R[h]||h);w==null?o.deleteAt(q):o.setAt(q,w)}else o[h]=w;return!0},deleteProperty:function(o,h){return typeof h=="number"?o.deleteAt(h):delete o[h],!0},has:function(o,h){return typeof h!="symbol"&&!isNaN(Number(h))?o.$items.has(Number(h)):Reflect.has(o,h)}}),d}var Z=function(){function d(){for(var o=[],h=0;h<arguments.length;h++)o[h]=arguments[h];this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,o)}return d.prototype.onAdd=function(o,h){return h===void 0&&(h=!0),p(this.$callbacks||(this.$callbacks={}),t.OPERATION.ADD,o,h?this.$items:void 0)},d.prototype.onRemove=function(o){return p(this.$callbacks||(this.$callbacks={}),t.OPERATION.DELETE,o)},d.prototype.onChange=function(o){return p(this.$callbacks||(this.$callbacks={}),t.OPERATION.REPLACE,o)},d.is=function(o){return Array.isArray(o)||o.array!==void 0},Object.defineProperty(d.prototype,"length",{get:function(){return this.$items.size},set:function(o){o===0?this.clear():this.splice(o,this.length-o)},enumerable:!1,configurable:!0}),d.prototype.push=function(){for(var o=this,h=[],w=0;w<arguments.length;w++)h[w]=arguments[w];var R;return h.forEach(function(q){R=o.$refId++,o.setAt(R,q)}),R},d.prototype.pop=function(){var o=Array.from(this.$indexes.values()).pop();if(o!==void 0){this.$changes.delete(o),this.$indexes.delete(o);var h=this.$items.get(o);return this.$items.delete(o),h}},d.prototype.at=function(o){if(o=Math.trunc(o)||0,o<0&&(o+=this.length),!(o<0||o>=this.length)){var h=Array.from(this.$items.keys())[o];return this.$items.get(h)}},d.prototype.setAt=function(o,h){var w,R;if(h==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.$items.get(o)!==h){h.$changes!==void 0&&h.$changes.setParent(this,this.$changes.root,o);var q=(R=(w=this.$changes.indexes[o])===null||w===void 0?void 0:w.op)!==null&&R!==void 0?R:t.OPERATION.ADD;this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,h),this.$changes.change(o,q)}},d.prototype.deleteAt=function(o){var h=Array.from(this.$items.keys())[o];return h===void 0?!1:this.$deleteAt(h)},d.prototype.$deleteAt=function(o){return this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o)},d.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&y.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.concat=function(){for(var o,h=[],w=0;w<arguments.length;w++)h[w]=arguments[w];return new(d.bind.apply(d,c([void 0],(o=Array.from(this.$items.values())).concat.apply(o,h),!1)))},d.prototype.join=function(o){return Array.from(this.$items.values()).join(o)},d.prototype.reverse=function(){var o=this,h=Array.from(this.$items.keys()),w=Array.from(this.$items.values()).reverse();return w.forEach(function(R,q){o.setAt(h[q],R)}),this},d.prototype.shift=function(){var o=Array.from(this.$items.keys()),h=o.shift();if(h!==void 0){var w=this.$items.get(h);return this.$deleteAt(h),w}},d.prototype.slice=function(o,h){var w=new d;return w.push.apply(w,Array.from(this.$items.values()).slice(o,h)),w},d.prototype.sort=function(o){var h=this;o===void 0&&(o=V);var w=Array.from(this.$items.keys()),R=Array.from(this.$items.values()).sort(o);return R.forEach(function(q,Ie){h.setAt(w[Ie],q)}),this},d.prototype.splice=function(o,h){h===void 0&&(h=this.length-o);for(var w=[],R=2;R<arguments.length;R++)w[R-2]=arguments[R];for(var q=Array.from(this.$items.keys()),Ie=[],de=o;de<o+h;de++)Ie.push(this.$items.get(q[de])),this.$deleteAt(q[de]);for(var de=0;de<w.length;de++)this.setAt(o+de,w[de]);return Ie},d.prototype.unshift=function(){for(var o=this,h=[],w=0;w<arguments.length;w++)h[w]=arguments[w];var R=this.length,q=h.length,Ie=Array.from(this.$items.values());return h.forEach(function(de,Qe){o.setAt(Qe,de)}),Ie.forEach(function(de,Qe){o.setAt(q+Qe,de)}),R+q},d.prototype.indexOf=function(o,h){return Array.from(this.$items.values()).indexOf(o,h)},d.prototype.lastIndexOf=function(o,h){return h===void 0&&(h=this.length-1),Array.from(this.$items.values()).lastIndexOf(o,h)},d.prototype.every=function(o,h){return Array.from(this.$items.values()).every(o,h)},d.prototype.some=function(o,h){return Array.from(this.$items.values()).some(o,h)},d.prototype.forEach=function(o,h){Array.from(this.$items.values()).forEach(o,h)},d.prototype.map=function(o,h){return Array.from(this.$items.values()).map(o,h)},d.prototype.filter=function(o,h){return Array.from(this.$items.values()).filter(o,h)},d.prototype.reduce=function(o,h){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},d.prototype.reduceRight=function(o,h){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},d.prototype.find=function(o,h){return Array.from(this.$items.values()).find(o,h)},d.prototype.findIndex=function(o,h){return Array.from(this.$items.values()).findIndex(o,h)},d.prototype.fill=function(o,h,w){throw new Error("ArraySchema#fill() not implemented")},d.prototype.copyWithin=function(o,h,w){throw new Error("ArraySchema#copyWithin() not implemented")},d.prototype.toString=function(){return this.$items.toString()},d.prototype.toLocaleString=function(){return this.$items.toLocaleString()},d.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},d.prototype.includes=function(o,h){return Array.from(this.$items.values()).includes(o,h)},d.prototype.flatMap=function(o,h){throw new Error("ArraySchema#flatMap() is not supported.")},d.prototype.flat=function(o){throw new Error("ArraySchema#flat() is not supported.")},d.prototype.findLast=function(){var o=Array.from(this.$items.values());return o.findLast.apply(o,arguments)},d.prototype.findLastIndex=function(){var o=Array.from(this.$items.values());return o.findLastIndex.apply(o,arguments)},d.prototype.with=function(o,h){var w=Array.from(this.$items.values());return w[o]=h,new(d.bind.apply(d,c([void 0],w,!1)))},d.prototype.toReversed=function(){return Array.from(this.$items.values()).reverse()},d.prototype.toSorted=function(o){return Array.from(this.$items.values()).sort(o)},d.prototype.toSpliced=function(o,h){var w=Array.from(this.$items.values());return w.toSpliced.apply(w,arguments)},d.prototype.setIndex=function(o,h){this.$indexes.set(o,h)},d.prototype.getIndex=function(o){return this.$indexes.get(o)},d.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},d.prototype.deleteByIndex=function(o){var h=this.$indexes.get(o);this.$items.delete(h),this.$indexes.delete(o)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){return this.toArray().map(function(o){return typeof o.toJSON=="function"?o.toJSON():o})},d.prototype.clone=function(o){var h;return o?h=new(d.bind.apply(d,c([void 0],Array.from(this.$items.values()),!1))):h=new(d.bind.apply(d,c([void 0],this.map(function(w){return w.$changes?w.clone():w}),!1))),h},d}();function z(d){return d.$proxy=!0,d=new Proxy(d,{get:function(o,h){return typeof h!="symbol"&&typeof o[h]>"u"?o.get(h):o[h]},set:function(o,h,w){return typeof h!="symbol"&&h.indexOf("$")===-1&&h!=="onAdd"&&h!=="onRemove"&&h!=="onChange"?o.set(h,w):o[h]=w,!0},deleteProperty:function(o,h){return o.delete(h),!0}}),d}var me=function(){function d(o){var h=this;if(this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o)if(o instanceof Map||o instanceof d)o.forEach(function(R,q){return h.set(q,R)});else for(var w in o)this.set(w,o[w])}return d.prototype.onAdd=function(o,h){return h===void 0&&(h=!0),p(this.$callbacks||(this.$callbacks={}),t.OPERATION.ADD,o,h?this.$items:void 0)},d.prototype.onRemove=function(o){return p(this.$callbacks||(this.$callbacks={}),t.OPERATION.DELETE,o)},d.prototype.onChange=function(o){return p(this.$callbacks||(this.$callbacks={}),t.OPERATION.REPLACE,o)},d.is=function(o){return o.map!==void 0},d.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(d.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.set=function(o,h){if(h==null)throw new Error("MapSchema#set('".concat(o,"', ").concat(h,"): trying to set ").concat(h," value on '").concat(o,"'."));o=o.toString();var w=typeof this.$changes.indexes[o]<"u",R=w?this.$changes.indexes[o]:this.$refId++,q=w?t.OPERATION.REPLACE:t.OPERATION.ADD,Ie=h.$changes!==void 0;if(Ie&&h.$changes.setParent(this,this.$changes.root,R),!w)this.$changes.indexes[o]=R,this.$indexes.set(R,o);else{if(!Ie&&this.$items.get(o)===h)return;Ie&&this.$items.get(o)!==h&&(q=t.OPERATION.ADD)}return this.$items.set(o,h),this.$changes.change(o,q),this},d.prototype.get=function(o){return this.$items.get(o)},d.prototype.delete=function(o){return this.$changes.delete(o.toString()),this.$items.delete(o)},d.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&y.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(o){return this.$items.has(o)},d.prototype.forEach=function(o){this.$items.forEach(o)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(o,h){this.$indexes.set(o,h)},d.prototype.getIndex=function(o){return this.$indexes.get(o)},d.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},d.prototype.deleteByIndex=function(o){var h=this.$indexes.get(o);this.$items.delete(h),this.$indexes.delete(o)},d.prototype.toJSON=function(){var o={};return this.forEach(function(h,w){o[w]=typeof h.toJSON=="function"?h.toJSON():h}),o},d.prototype.clone=function(o){var h;return o?h=Object.assign(new d,this):(h=new d,this.forEach(function(w,R){w.$changes?h.set(R,w.clone()):h.set(R,w)})),h},d}(),le={};function ve(d,o){le[d]=o}function Le(d){return le[d]}var ut=function(){function d(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return d.create=function(o){var h=new d;return h.schema=Object.assign({},o&&o.schema||{}),h.indexes=Object.assign({},o&&o.indexes||{}),h.fieldsByIndex=Object.assign({},o&&o.fieldsByIndex||{}),h.descriptors=Object.assign({},o&&o.descriptors||{}),h.deprecated=Object.assign({},o&&o.deprecated||{}),h},d.prototype.addField=function(o,h){var w=this.getNextFieldIndex();this.fieldsByIndex[w]=o,this.indexes[o]=w,this.schema[o]=Array.isArray(h)?{array:h[0]}:h},d.prototype.hasField=function(o){return this.indexes[o]!==void 0},d.prototype.addFilter=function(o,h){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[o]]=h,this.indexesWithFilters.push(this.indexes[o]),!0},d.prototype.addChildrenFilter=function(o,h){var w=this.indexes[o],R=this.schema[o];if(Le(Object.keys(R)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[w]=h,!0;console.warn("@filterChildren: field '".concat(o,"' can't have children. Ignoring filter."))},d.prototype.getChildrenFilter=function(o){return this.childFilters&&this.childFilters[this.indexes[o]]},d.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},d}();function St(d){return d._context&&d._context.useFilters}var yt=function(){function d(){this.types={},this.schemas=new Map,this.useFilters=!1}return d.prototype.has=function(o){return this.schemas.has(o)},d.prototype.get=function(o){return this.types[o]},d.prototype.add=function(o,h){h===void 0&&(h=this.schemas.size),o._definition=ut.create(o._definition),o._typeid=h,this.types[h]=o,this.schemas.set(o,h)},d.create=function(o){return o===void 0&&(o={}),function(h){return o.context||(o.context=new d),tt(h,o)}},d}(),Rt=new yt;function tt(d,o){return o===void 0&&(o={}),function(h,w){var R=o.context||Rt,q=h.constructor;if(q._context=R,!d)throw new Error("".concat(q.name,': @type() reference provided for "').concat(w,`" is undefined. Make sure you don't have any circular dependencies.`));R.has(q)||R.add(q);var Ie=q._definition;if(Ie.addField(w,d),Ie.descriptors[w]){if(Ie.deprecated[w])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(w,"' definition on '").concat(q.name,`'.
Check @type() annotation`))}catch(Oe){var de=Oe.stack.split(`
`)[4].trim();throw new Error("".concat(Oe.message," ").concat(de))}}var Qe=Z.is(d),Ye=!Qe&&me.is(d);if(typeof d!="string"&&!Vt.is(d)){var pe=Object.values(d)[0];typeof pe!="string"&&!R.has(pe)&&R.add(pe)}if(o.manual){Ie.descriptors[w]={enumerable:!0,configurable:!0,writable:!0};return}var Me="_".concat(w);Ie.descriptors[Me]={enumerable:!1,configurable:!1,writable:!0},Ie.descriptors[w]={get:function(){return this[Me]},set:function(Oe){Oe!==this[Me]&&(Oe!=null?(Qe&&!(Oe instanceof Z)&&(Oe=new(Z.bind.apply(Z,c([void 0],Oe,!1)))),Ye&&!(Oe instanceof me)&&(Oe=new me(Oe)),Oe.$proxy===void 0&&(Ye?Oe=z(Oe):Qe&&(Oe=X(Oe))),this.$changes.change(w),Oe.$changes&&Oe.$changes.setParent(this,this.$changes.root,this._definition.indexes[w])):this[Me]!==void 0&&this.$changes.delete(w),this[Me]=Oe)},enumerable:!0,configurable:!0}}}function bt(d){return function(o,h){var w=o.constructor,R=w._definition;R.addFilter(h,d)&&(w._context.useFilters=!0)}}function _t(d){return function(o,h){var w=o.constructor,R=w._definition;R.addChildrenFilter(h,d)&&(w._context.useFilters=!0)}}function ot(d){return d===void 0&&(d=!0),function(o,h){var w=o.constructor,R=w._definition;R.deprecated[h]=!0,d&&(R.descriptors[h]={get:function(){throw new Error("".concat(h," is deprecated."))},set:function(q){},enumerable:!1,configurable:!0})}}function M(d,o,h){h===void 0&&(h={}),h.context||(h.context=d._context||h.context||Rt);for(var w in o)tt(o[w],h)(d.prototype,w);return d}function oe(d){for(var o=0,h=0,w=0,R=d.length;w<R;w++)o=d.charCodeAt(w),o<128?h+=1:o<2048?h+=2:o<55296||o>=57344?h+=3:(w++,h+=4);return h}function se(d,o,h){for(var w=0,R=0,q=h.length;R<q;R++)w=h.charCodeAt(R),w<128?d[o++]=w:w<2048?(d[o++]=192|w>>6,d[o++]=128|w&63):w<55296||w>=57344?(d[o++]=224|w>>12,d[o++]=128|w>>6&63,d[o++]=128|w&63):(R++,w=65536+((w&1023)<<10|h.charCodeAt(R)&1023),d[o++]=240|w>>18,d[o++]=128|w>>12&63,d[o++]=128|w>>6&63,d[o++]=128|w&63)}function te(d,o){d.push(o&255)}function Q(d,o){d.push(o&255)}function we(d,o){d.push(o&255),d.push(o>>8&255)}function Ce(d,o){d.push(o&255),d.push(o>>8&255)}function Ae(d,o){d.push(o&255),d.push(o>>8&255),d.push(o>>16&255),d.push(o>>24&255)}function We(d,o){var h=o>>24,w=o>>16,R=o>>8,q=o;d.push(q&255),d.push(R&255),d.push(w&255),d.push(h&255)}function nt(d,o){var h=Math.floor(o/Math.pow(2,32)),w=o>>>0;We(d,w),We(d,h)}function wt(d,o){var h=o/Math.pow(2,32)>>0,w=o>>>0;We(d,w),We(d,h)}function Mt(d,o){An(d,o)}function Wt(d,o){Xt(d,o)}var Nn=new Int32Array(2),jn=new Float32Array(Nn.buffer),Ge=new Float64Array(Nn.buffer);function An(d,o){jn[0]=o,Ae(d,Nn[0])}function Xt(d,o){Ge[0]=o,Ae(d,Nn[0]),Ae(d,Nn[1])}function pn(d,o){return Q(d,o?1:0)}function Pn(d,o){o||(o="");var h=oe(o),w=0;if(h<32)d.push(h|160),w=1;else if(h<256)d.push(217),Q(d,h),w=2;else if(h<65536)d.push(218),Ce(d,h),w=3;else if(h<4294967296)d.push(219),We(d,h),w=5;else throw new Error("String too long");return se(d,d.length,o),w+h}function kt(d,o){if(isNaN(o))return kt(d,0);if(isFinite(o)){if(o!==(o|0))return d.push(203),Xt(d,o),9}else return kt(d,o>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER);return o>=0?o<128?(Q(d,o),1):o<256?(d.push(204),Q(d,o),2):o<65536?(d.push(205),Ce(d,o),3):o<4294967296?(d.push(206),We(d,o),5):(d.push(207),wt(d,o),9):o>=-32?(d.push(224|o+32),1):o>=-128?(d.push(208),te(d,o),2):o>=-32768?(d.push(209),we(d,o),3):o>=-2147483648?(d.push(210),Ae(d,o),5):(d.push(211),nt(d,o),9)}var Jn=Object.freeze({__proto__:null,boolean:pn,float32:Mt,float64:Wt,int16:we,int32:Ae,int64:nt,int8:te,number:kt,string:Pn,uint16:Ce,uint32:We,uint64:wt,uint8:Q,utf8Write:se,writeFloat32:An,writeFloat64:Xt});function pr(d,o,h){for(var w="",R=0,q=o,Ie=o+h;q<Ie;q++){var de=d[q];if(!(de&128)){w+=String.fromCharCode(de);continue}if((de&224)===192){w+=String.fromCharCode((de&31)<<6|d[++q]&63);continue}if((de&240)===224){w+=String.fromCharCode((de&15)<<12|(d[++q]&63)<<6|(d[++q]&63)<<0);continue}if((de&248)===240){R=(de&7)<<18|(d[++q]&63)<<12|(d[++q]&63)<<6|(d[++q]&63)<<0,R>=65536?(R-=65536,w+=String.fromCharCode((R>>>10)+55296,(R&1023)+56320)):w+=String.fromCharCode(R);continue}console.error("Invalid byte "+de.toString(16))}return w}function Qn(d,o){return an(d,o)<<24>>24}function an(d,o){return d[o.offset++]}function er(d,o){return In(d,o)<<16>>16}function In(d,o){return d[o.offset++]|d[o.offset++]<<8}function At(d,o){return d[o.offset++]|d[o.offset++]<<8|d[o.offset++]<<16|d[o.offset++]<<24}function Jt(d,o){return At(d,o)>>>0}function gr(d,o){return N(d,o)}function Dr(d,o){return j(d,o)}function ke(d,o){var h=Jt(d,o),w=At(d,o)*Math.pow(2,32);return w+h}function gn(d,o){var h=Jt(d,o),w=Jt(d,o)*Math.pow(2,32);return w+h}var m=new Int32Array(2),T=new Float32Array(m.buffer),x=new Float64Array(m.buffer);function N(d,o){return m[0]=At(d,o),T[0]}function j(d,o){return m[0]=At(d,o),m[1]=At(d,o),x[0]}function U(d,o){return an(d,o)>0}function G(d,o){var h=d[o.offset++],w;h<192?w=h&31:h===217?w=an(d,o):h===218?w=In(d,o):h===219&&(w=Jt(d,o));var R=pr(d,o.offset,w);return o.offset+=w,R}function W(d,o){var h=d[o.offset];return h<192&&h>160||h===217||h===218||h===219}function Y(d,o){var h=d[o.offset++];if(h<128)return h;if(h===202)return N(d,o);if(h===203)return j(d,o);if(h===204)return an(d,o);if(h===205)return In(d,o);if(h===206)return Jt(d,o);if(h===207)return gn(d,o);if(h===208)return Qn(d,o);if(h===209)return er(d,o);if(h===210)return At(d,o);if(h===211)return ke(d,o);if(h>223)return(255-h+1)*-1}function Ee(d,o){var h=d[o.offset];return h<128||h>=202&&h<=211}function Ze(d,o){return d[o.offset]<160}function Be(d,o){return d[o.offset-1]===u&&(d[o.offset]<128||d[o.offset]>=202&&d[o.offset]<=211)}var Ve=Object.freeze({__proto__:null,arrayCheck:Ze,boolean:U,float32:gr,float64:Dr,int16:er,int32:At,int64:ke,int8:Qn,number:Y,numberCheck:Ee,readFloat32:N,readFloat64:j,string:G,stringCheck:W,switchStructureCheck:Be,uint16:In,uint32:Jt,uint64:gn,uint8:an}),Ct=function(){function d(o){var h=this;this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o&&o.forEach(function(w){return h.add(w)})}return d.prototype.onAdd=function(o,h){return h===void 0&&(h=!0),p(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,o,h?this.$items:void 0)},d.prototype.onRemove=function(o){return p(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,o)},d.prototype.onChange=function(o){return p(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,o)},d.is=function(o){return o.collection!==void 0},d.prototype.add=function(o){var h=this.$refId++,w=o.$changes!==void 0;return w&&o.$changes.setParent(this,this.$changes.root,h),this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,o),this.$changes.change(h),h},d.prototype.at=function(o){var h=Array.from(this.$items.keys())[o];return this.$items.get(h)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(o){for(var h=this.$items.entries(),w,R;(R=h.next())&&!R.done;)if(o===R.value[1]){w=R.value[0];break}return w===void 0?!1:(this.$changes.delete(w),this.$indexes.delete(w),this.$items.delete(w))},d.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&y.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(o){return Array.from(this.$items.values()).some(function(h){return h===o})},d.prototype.forEach=function(o){var h=this;this.$items.forEach(function(w,R,q){return o(w,R,h)})},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(o,h){this.$indexes.set(o,h)},d.prototype.getIndex=function(o){return this.$indexes.get(o)},d.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},d.prototype.deleteByIndex=function(o){var h=this.$indexes.get(o);this.$items.delete(h),this.$indexes.delete(o)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var o=[];return this.forEach(function(h,w){o.push(typeof h.toJSON=="function"?h.toJSON():h)}),o},d.prototype.clone=function(o){var h;return o?h=Object.assign(new d,this):(h=new d,this.forEach(function(w){w.$changes?h.add(w.clone()):h.add(w)})),h},d}(),rt=function(){function d(o){var h=this;this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o&&o.forEach(function(w){return h.add(w)})}return d.prototype.onAdd=function(o,h){return h===void 0&&(h=!0),p(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,o,h?this.$items:void 0)},d.prototype.onRemove=function(o){return p(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,o)},d.prototype.onChange=function(o){return p(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,o)},d.is=function(o){return o.set!==void 0},d.prototype.add=function(o){var h,w;if(this.has(o))return!1;var R=this.$refId++;o.$changes!==void 0&&o.$changes.setParent(this,this.$changes.root,R);var q=(w=(h=this.$changes.indexes[R])===null||h===void 0?void 0:h.op)!==null&&w!==void 0?w:t.OPERATION.ADD;return this.$changes.indexes[R]=R,this.$indexes.set(R,R),this.$items.set(R,o),this.$changes.change(R,q),R},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(o){for(var h=this.$items.entries(),w,R;(R=h.next())&&!R.done;)if(o===R.value[1]){w=R.value[0];break}return w===void 0?!1:(this.$changes.delete(w),this.$indexes.delete(w),this.$items.delete(w))},d.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&y.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(o){for(var h=this.$items.values(),w=!1,R;(R=h.next())&&!R.done;)if(o===R.value){w=!0;break}return w},d.prototype.forEach=function(o){var h=this;this.$items.forEach(function(w,R,q){return o(w,R,h)})},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(o,h){this.$indexes.set(o,h)},d.prototype.getIndex=function(o){return this.$indexes.get(o)},d.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},d.prototype.deleteByIndex=function(o){var h=this.$indexes.get(o);this.$items.delete(h),this.$indexes.delete(o)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var o=[];return this.forEach(function(h,w){o.push(typeof h.toJSON=="function"?h.toJSON():h)}),o},d.prototype.clone=function(o){var h;return o?h=Object.assign(new d,this):(h=new d,this.forEach(function(w){w.$changes?h.add(w.clone()):h.add(w)})),h},d}(),kn=function(){function d(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return d.prototype.addRefId=function(o){this.refIds.has(o)||(this.refIds.add(o),this.containerIndexes.set(o,new Set))},d.get=function(o){return o.$filterState===void 0&&(o.$filterState=new d),o.$filterState},d}(),Ut=function(){function d(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return d.prototype.getNextUniqueId=function(){return this.nextUniqueId++},d.prototype.addRef=function(o,h,w){w===void 0&&(w=!0),this.refs.set(o,h),w&&(this.refCounts[o]=(this.refCounts[o]||0)+1)},d.prototype.removeRef=function(o){var h=this.refCounts[o];if(h===void 0){console.warn("trying to remove reference ".concat(o," that doesn't exist"));return}if(h===0){console.warn("trying to remove reference ".concat(o," with 0 refCount"));return}this.refCounts[o]=h-1,this.deletedRefs.add(o)},d.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},d.prototype.garbageCollectDeletedRefs=function(){var o=this;this.deletedRefs.forEach(function(h){if(!(o.refCounts[h]>0)){var w=o.refs.get(h);if(w instanceof Vt)for(var R in w._definition.schema)typeof w._definition.schema[R]!="string"&&w[R]&&w[R].$changes&&o.removeRef(w[R].$changes.refId);else{var q=w.$changes.parent._definition,Ie=q.schema[q.fieldsByIndex[w.$changes.parentIndex]];typeof Object.values(Ie)[0]=="function"&&Array.from(w.values()).forEach(function(de){return o.removeRef(de.$changes.refId)})}o.refs.delete(h),delete o.refCounts[h]}}),this.deletedRefs.clear()},d}(),Rr=function(d){i(o,d);function o(){return d!==null&&d.apply(this,arguments)||this}return o}(Error);function Ft(d,o,h,w){var R,q=!1;switch(o){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":R="number",isNaN(d)&&console.log('trying to encode "NaN" in '.concat(h.constructor.name,"#").concat(w));break;case"string":R="string",q=!0;break;case"boolean":return}if(typeof d!==R&&(!q||q&&d!==null)){var Ie="'".concat(JSON.stringify(d),"'").concat(d&&d.constructor&&" (".concat(d.constructor.name,")")||"");throw new Rr("a '".concat(R,"' was expected, but ").concat(Ie," was provided in ").concat(h.constructor.name,"#").concat(w))}}function mn(d,o,h,w){if(!(d instanceof o))throw new Rr("a '".concat(o.name,"' was expected, but '").concat(d.constructor.name,"' was provided in ").concat(h.constructor.name,"#").concat(w))}function mr(d,o,h,w,R){Ft(h,d,w,R);var q=Jn[d];if(q)q(o,h);else throw new Rr("a '".concat(d,"' was expected, but ").concat(h," was provided in ").concat(w.constructor.name,"#").concat(R))}function Nr(d,o,h){return Ve[d](o,h)}var Vt=function(){function d(){for(var o=[],h=0;h<arguments.length;h++)o[h]=arguments[h];Object.defineProperties(this,{$changes:{value:new g(this,void 0,new Ut),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var w=this._definition.descriptors;w&&Object.defineProperties(this,w),o[0]&&this.assign(o[0])}return d.onError=function(o){console.error(o)},d.is=function(o){return o._definition&&o._definition.schema!==void 0},d.prototype.onChange=function(o){return p(this.$callbacks||(this.$callbacks={}),t.OPERATION.REPLACE,o)},d.prototype.onRemove=function(o){return p(this.$callbacks||(this.$callbacks={}),t.OPERATION.DELETE,o)},d.prototype.assign=function(o){return Object.assign(this,o),this},Object.defineProperty(d.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),d.prototype.setDirty=function(o,h){this.$changes.change(o,h)},d.prototype.listen=function(o,h,w){var R=this;return w===void 0&&(w=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[o]||(this.$callbacks[o]=[]),this.$callbacks[o].push(h),w&&this[o]!==void 0&&h(this[o],void 0),function(){return O(R.$callbacks[o],R.$callbacks[o].indexOf(h))}},d.prototype.decode=function(o,h,w){h===void 0&&(h={offset:0}),w===void 0&&(w=this);var R=[],q=this.$changes.root,Ie=o.length,de=0;for(q.refs.set(de,this);h.offset<Ie;){var Qe=o[h.offset++];if(Qe==u){de=Y(o,h);var Ye=q.refs.get(de);if(!Ye)throw new Error('"refId" not found: '.concat(de));w=Ye;continue}var pe=w.$changes,Me=w._definition!==void 0,Oe=Me?Qe>>6<<6:Qe;if(Oe===t.OPERATION.CLEAR){w.clear(R);continue}var Ke=Me?Qe%(Oe||255):Y(o,h),De=Me?w._definition.fieldsByIndex[Ke]:"",je=pe.getType(Ke),re=void 0,it=void 0,Kt=void 0;if(Me?it=w["_".concat(De)]:(it=w.getByIndex(Ke),(Oe&t.OPERATION.ADD)===t.OPERATION.ADD?(Kt=w instanceof me?G(o,h):Ke,w.setIndex(Ke,Kt)):Kt=w.getIndex(Ke)),(Oe&t.OPERATION.DELETE)===t.OPERATION.DELETE&&(Oe!==t.OPERATION.DELETE_AND_ADD&&w.deleteByIndex(Ke),it&&it.$changes&&q.removeRef(it.$changes.refId),re=null),De===void 0){console.warn("@colyseus/schema: definition mismatch");for(var Tt={offset:h.offset};h.offset<Ie&&!(Be(o,h)&&(Tt.offset=h.offset+1,q.refs.has(Y(o,Tt))));)h.offset++;continue}else if(Oe!==t.OPERATION.DELETE)if(d.is(je)){var Je=Y(o,h);if(re=q.refs.get(Je),Oe!==t.OPERATION.REPLACE){var st=this.getSchemaType(o,h,je);re||(re=this.createTypeInstance(st),re.$changes.refId=Je,it&&(re.$callbacks=it.$callbacks,it.$changes.refId&&Je!==it.$changes.refId&&q.removeRef(it.$changes.refId))),q.addRef(Je,re,re!==it)}}else if(typeof je=="string")re=Nr(je,o,h);else{var on=Le(Object.keys(je)[0]),gt=Y(o,h),ln=q.refs.has(gt)?it||q.refs.get(gt):new on.constructor;if(re=ln.clone(!0),re.$changes.refId=gt,it&&(re.$callbacks=it.$callbacks,it.$changes.refId&&gt!==it.$changes.refId)){q.removeRef(it.$changes.refId);for(var vt=it.entries(),It=void 0;(It=vt.next())&&!It.done;){var vr=It.value,_n=vr[0],Hn=vr[1];R.push({refId:gt,op:t.OPERATION.DELETE,field:_n,value:void 0,previousValue:Hn})}}q.addRef(gt,re,ln!==it)}if(re!=null){if(re.$changes&&re.$changes.setParent(pe.ref,pe.root,Ke),w instanceof d)w[De]=re;else if(w instanceof me){var _n=Kt;w.$items.set(_n,re),w.$changes.allChanges.add(Ke)}else if(w instanceof Z)w.setAt(Ke,re);else if(w instanceof Ct){var qt=w.add(re);w.setIndex(Ke,qt)}else if(w instanceof rt){var qt=w.add(re);qt!==!1&&w.setIndex(Ke,qt)}}it!==re&&R.push({refId:de,op:Oe,field:De,dynamicIndex:Kt,value:re,previousValue:it})}return this._triggerChanges(R),q.garbageCollectDeletedRefs(),R},d.prototype.encode=function(o,h,w){o===void 0&&(o=!1),h===void 0&&(h=[]),w===void 0&&(w=!1);for(var R=this.$changes,q=new WeakSet,Ie=[R],de=1,Qe=0;Qe<de;Qe++){var Ye=Ie[Qe],pe=Ye.ref,Me=pe instanceof d;Ye.ensureRefId(),q.add(Ye),Ye!==R&&(Ye.changed||o)&&(Q(h,u),kt(h,Ye.refId));for(var Oe=o?Array.from(Ye.allChanges):Array.from(Ye.changes.values()),Ke=0,De=Oe.length;Ke<De;Ke++){var je=o?{op:t.OPERATION.ADD,index:Oe[Ke]}:Oe[Ke],re=je.index,it=Me?pe._definition.fieldsByIndex&&pe._definition.fieldsByIndex[re]:re,Kt=h.length;if(je.op!==t.OPERATION.TOUCH)if(Me)Q(h,re|je.op);else{if(Q(h,je.op),je.op===t.OPERATION.CLEAR)continue;kt(h,re)}if(!Me&&(je.op&t.OPERATION.ADD)==t.OPERATION.ADD&&pe instanceof me){var Tt=Ye.ref.$indexes.get(re);Pn(h,Tt)}if(je.op!==t.OPERATION.DELETE){var Je=Ye.getType(re),st=Ye.getValue(re);if(st&&st.$changes&&!q.has(st.$changes)&&(Ie.push(st.$changes),st.$changes.ensureRefId(),de++),je.op!==t.OPERATION.TOUCH){if(d.is(Je))mn(st,Je,pe,it),kt(h,st.$changes.refId),(je.op&t.OPERATION.ADD)===t.OPERATION.ADD&&this.tryEncodeTypeId(h,Je,st.constructor);else if(typeof Je=="string")mr(Je,h,st,pe,it);else{var on=Le(Object.keys(Je)[0]);mn(pe["_".concat(it)],on.constructor,pe,it),kt(h,st.$changes.refId)}w&&Ye.cache(re,h.slice(Kt))}}}!o&&!w&&Ye.discard()}return h},d.prototype.encodeAll=function(o){return this.encode(!0,[],o)},d.prototype.applyFilters=function(o,h){var w,R;h===void 0&&(h=!1);for(var q=this,Ie=new Set,de=kn.get(o),Qe=[this.$changes],Ye=1,pe=[],Me=function(Ke){var De=Qe[Ke];if(Ie.has(De.refId))return"continue";var je=De.ref,re=je instanceof d;Q(pe,u),kt(pe,De.refId);var it=de.refIds.has(De),Kt=h||!it;de.addRefId(De);var Tt=de.containerIndexes.get(De),Je=Kt?Array.from(De.allChanges):Array.from(De.changes.values());if(!h&&re&&je._definition.indexesWithFilters){var st=je._definition.indexesWithFilters;st.forEach(function($r){!Tt.has($r)&&De.allChanges.has($r)&&(Kt?Je.push($r):Je.push({op:t.OPERATION.ADD,index:$r}))})}for(var on=0,gt=Je.length;on<gt;on++){var ln=Kt?{op:t.OPERATION.ADD,index:Je[on]}:Je[on];if(ln.op===t.OPERATION.CLEAR){Q(pe,ln.op);continue}var vt=ln.index;if(ln.op===t.OPERATION.DELETE){re?Q(pe,ln.op|vt):(Q(pe,ln.op),kt(pe,vt));continue}var It=De.getValue(vt),vr=De.getType(vt);if(re){var _n=je._definition.filters&&je._definition.filters[vt];if(_n&&!_n.call(je,o,It,q)){It&&It.$changes&&Ie.add(It.$changes.refId);continue}}else{var Hn=De.parent,_n=De.getChildrenFilter();if(_n&&!_n.call(Hn,o,je.$indexes.get(vt),It,q)){It&&It.$changes&&Ie.add(It.$changes.refId);continue}}if(It.$changes&&(Qe.push(It.$changes),Ye++),ln.op!==t.OPERATION.TOUCH)if(ln.op===t.OPERATION.ADD||re)pe.push.apply(pe,(w=De.caches[vt])!==null&&w!==void 0?w:[]),Tt.add(vt);else if(Tt.has(vt))pe.push.apply(pe,(R=De.caches[vt])!==null&&R!==void 0?R:[]);else{if(Tt.add(vt),Q(pe,t.OPERATION.ADD),kt(pe,vt),je instanceof me){var qt=De.ref.$indexes.get(vt);Pn(pe,qt)}It.$changes?kt(pe,It.$changes.refId):Jn[vr](pe,It)}else if(It.$changes&&!re){if(Q(pe,t.OPERATION.ADD),kt(pe,vt),je instanceof me){var qt=De.ref.$indexes.get(vt);Pn(pe,qt)}kt(pe,It.$changes.refId)}}},Oe=0;Oe<Ye;Oe++)Me(Oe);return pe},d.prototype.clone=function(){var o,h=new this.constructor,w=this._definition.schema;for(var R in w)typeof this[R]=="object"&&typeof((o=this[R])===null||o===void 0?void 0:o.clone)=="function"?h[R]=this[R].clone():h[R]=this[R];return h},d.prototype.toJSON=function(){var o=this._definition.schema,h=this._definition.deprecated,w={};for(var R in o)!h[R]&&this[R]!==null&&typeof this[R]<"u"&&(w[R]=typeof this[R].toJSON=="function"?this[R].toJSON():this["_".concat(R)]);return w},d.prototype.discardAllChanges=function(){this.$changes.discardAll()},d.prototype.getByIndex=function(o){return this[this._definition.fieldsByIndex[o]]},d.prototype.deleteByIndex=function(o){this[this._definition.fieldsByIndex[o]]=void 0},d.prototype.tryEncodeTypeId=function(o,h,w){h._typeid!==w._typeid&&(Q(o,v),kt(o,w._typeid))},d.prototype.getSchemaType=function(o,h,w){var R;return o[h.offset]===v&&(h.offset++,R=this.constructor._context.get(Y(o,h))),R||w},d.prototype.createTypeInstance=function(o){var h=new o;return h.$changes.root=this.$changes.root,h},d.prototype._triggerChanges=function(o){for(var h,w,R,q,Ie,de,Qe,Ye,pe,Me=new Set,Oe=this.$changes.root.refs,Ke=function(je){var re=o[je],it=re.refId,Kt=Oe.get(it),Tt=Kt.$callbacks;if((re.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&re.previousValue instanceof d&&((w=(h=re.previousValue.$callbacks)===null||h===void 0?void 0:h[t.OPERATION.DELETE])===null||w===void 0||w.forEach(function(Je){return Je()})),!Tt)return"continue";if(Kt instanceof d){if(!Me.has(it))try{(R=Tt==null?void 0:Tt[t.OPERATION.REPLACE])===null||R===void 0||R.forEach(function(Je){return Je()})}catch(Je){d.onError(Je)}try{Tt.hasOwnProperty(re.field)&&((q=Tt[re.field])===null||q===void 0||q.forEach(function(Je){return Je(re.value,re.previousValue)}))}catch(Je){d.onError(Je)}}else re.op===t.OPERATION.ADD&&re.previousValue===void 0?(Ie=Tt[t.OPERATION.ADD])===null||Ie===void 0||Ie.forEach(function(Je){var st;return Je(re.value,(st=re.dynamicIndex)!==null&&st!==void 0?st:re.field)}):re.op===t.OPERATION.DELETE?re.previousValue!==void 0&&((de=Tt[t.OPERATION.DELETE])===null||de===void 0||de.forEach(function(Je){var st;return Je(re.previousValue,(st=re.dynamicIndex)!==null&&st!==void 0?st:re.field)})):re.op===t.OPERATION.DELETE_AND_ADD&&(re.previousValue!==void 0&&((Qe=Tt[t.OPERATION.DELETE])===null||Qe===void 0||Qe.forEach(function(Je){var st;return Je(re.previousValue,(st=re.dynamicIndex)!==null&&st!==void 0?st:re.field)})),(Ye=Tt[t.OPERATION.ADD])===null||Ye===void 0||Ye.forEach(function(Je){var st;return Je(re.value,(st=re.dynamicIndex)!==null&&st!==void 0?st:re.field)})),re.value!==re.previousValue&&((pe=Tt[t.OPERATION.REPLACE])===null||pe===void 0||pe.forEach(function(Je){var st;return Je(re.value,(st=re.dynamicIndex)!==null&&st!==void 0?st:re.field)}));Me.add(it)},De=0;De<o.length;De++)Ke(De)},d._definition=ut.create(),d}();function tr(d){for(var o=[d.$changes],h=1,w={},R=w,q=function(de){var Qe=o[de];Qe.changes.forEach(function(Ye){var pe=Qe.ref,Me=Ye.index,Oe=pe._definition?pe._definition.fieldsByIndex[Me]:pe.$indexes.get(Me);R[Oe]=Qe.getValue(Me)})},Ie=0;Ie<h;Ie++)q(Ie);return w}var $n={context:new yt},yr=function(d){i(o,d);function o(){return d!==null&&d.apply(this,arguments)||this}return s([tt("string",$n)],o.prototype,"name",void 0),s([tt("string",$n)],o.prototype,"type",void 0),s([tt("number",$n)],o.prototype,"referencedType",void 0),o}(Vt),Pr=function(d){i(o,d);function o(){var h=d!==null&&d.apply(this,arguments)||this;return h.fields=new Z,h}return s([tt("number",$n)],o.prototype,"id",void 0),s([tt([yr],$n)],o.prototype,"fields",void 0),o}(Vt),kr=function(d){i(o,d);function o(){var h=d!==null&&d.apply(this,arguments)||this;return h.types=new Z,h}return o.encode=function(h){var w,R=h.constructor,q=new o;q.rootType=R._typeid;var Ie=function(pe,Me){for(var Oe in Me){var Ke=new yr;Ke.name=Oe;var De=void 0;if(typeof Me[Oe]=="string")De=Me[Oe];else{var je=Me[Oe],re=void 0;Vt.is(je)?(De="ref",re=Me[Oe]):(De=Object.keys(je)[0],typeof je[De]=="string"?De+=":"+je[De]:re=je[De]),Ke.referencedType=re?re._typeid:-1}Ke.type=De,pe.fields.push(Ke)}q.types.push(pe)},de=(w=R._context)===null||w===void 0?void 0:w.types;for(var Qe in de){var Ye=new Pr;Ye.id=Number(Qe),Ie(Ye,de[Qe]._definition.schema)}return q.encodeAll()},o.decode=function(h,w){var R=new yt,q=new o;q.decode(h,w);var Ie=q.types.reduce(function(Me,Oe){var Ke=function(je){i(re,je);function re(){return je!==null&&je.apply(this,arguments)||this}return re}(Vt),De=Oe.id;return Me[De]=Ke,R.add(Ke,De),Me},{});q.types.forEach(function(Me){var Oe=Ie[Me.id];Me.fields.forEach(function(Ke){var De;if(Ke.referencedType!==void 0){var je=Ke.type,re=Ie[Ke.referencedType];if(!re){var it=Ke.type.split(":");je=it[0],re=it[1]}je==="ref"?tt(re,{context:R})(Oe.prototype,Ke.name):tt((De={},De[je]=re,De),{context:R})(Oe.prototype,Ke.name)}else tt(Ke.type,{context:R})(Oe.prototype,Ke.name)})});var de=Ie[q.rootType],Qe=new de;for(var Ye in de._definition.schema){var pe=de._definition.schema[Ye];typeof pe!="string"&&(Qe[Ye]=typeof pe=="function"?new pe:new(Le(Object.keys(pe)[0])).constructor)}return Qe},s([tt([Pr],$n)],o.prototype,"types",void 0),s([tt("number",$n)],o.prototype,"rootType",void 0),o}(Vt);ve("map",{constructor:me}),ve("array",{constructor:Z}),ve("set",{constructor:rt}),ve("collection",{constructor:Ct}),t.ArraySchema=Z,t.CollectionSchema=Ct,t.Context=yt,t.MapSchema=me,t.Reflection=kr,t.ReflectionField=yr,t.ReflectionType=Pr,t.Schema=Vt,t.SchemaDefinition=ut,t.SetSchema=rt,t.decode=Ve,t.defineTypes=M,t.deprecated=ot,t.dumpChanges=tr,t.encode=Jn,t.filter=bt,t.filterChildren=_t,t.hasFilter=St,t.registerType=ve,t.type=tt})})(Co,Co.exports);var qe=(n=>(n.Lobby="Lobby",n.Shop="Shop",n.Preparation="Preparation",n.Battle="Battle",n.BattleEnd="BattleEnd",n.GameOver="GameOver",n))(qe||{});class pp extends dr.Scene{constructor(){super("Lobby"),this.playerTextObjects=new Map,this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerStateListeners=new Map,this.listenersAttached=!1}create(){if(this.scene.launch("background"),this.listenersAttached=!1,!A||!A.sessionId){console.error("Lobby Scene: Not connected to Colyseus room or no session ID!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Not connected to server.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{A==null||A.leave()}catch{}this.scene.start("MainMenu")});return}this.add.text(this.cameras.main.centerX,100,"Lobby",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,200,"Players in Lobby:",{fontFamily:"Arial",fontSize:32,color:"#dddddd",align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-100,"Connecting to lobby...",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.readyButton=this.add.text(this.cameras.main.centerX,this.cameras.main.height-150,"Ready Up",{fontFamily:"Arial Black",fontSize:40,color:"#888888",backgroundColor:"#333333",padding:{x:20,y:10},stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setVisible(!1).disableInteractive(),this.waitingText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-110,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.readyButton.on("pointerdown",()=>{var e;A&&((e=this.readyButton.input)!=null&&e.enabled)&&(console.log("Lobby: Sending playerReady message."),A.send("playerReady"))}),this.readyButton.on("pointerover",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled&&this.readyButton.setColor("#55ff55")}),this.readyButton.on("pointerout",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled?this.readyButton.setColor("#00ff00"):this.readyButton.setColor("#888888")}),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}attachMainListenersAndUI(){if(this.listenersAttached){console.log("Lobby: Main listeners and UI setup already performed, skipping.");return}if(!this.scene.isActive()){console.warn("Lobby: attachMainListenersAndUI called but scene is not active. Aborting.");return}if(!A||!A.state){console.warn("Lobby: attachMainListenersAndUI called but Colyseus room or state is not ready. Aborting.");return}console.log("Lobby: Attaching main Colyseus listeners and performing initial UI update."),this.attachMainListeners(),this.updateLobbyUI(),this.listenersAttached=!0}setupColyseusListeners(){if(!A){console.error("Lobby: setupColyseusListeners called but colyseusRoom is null.");return}console.log("Lobby: Setting up Colyseus general listeners."),A.state&&!this.listenersAttached&&(console.log("Lobby: State already available on setup. Scheduling attachMainListenersAndUI."),this.time.delayedCall(1,this.attachMainListenersAndUI,[],this)),A.onStateChange.once(e=>{if(console.log("Lobby: Initial state received via onStateChange.once."),!this.scene.isActive()){console.log("Lobby: Scene became inactive before onStateChange.once processing could complete.");return}this.attachMainListenersAndUI()})}attachMainListeners(){if(!A||!A.state){console.error("Lobby: attachMainListeners - colyseusRoom or state is null.");return}const e=qn.getStateCallbacks(A);this.phaseListenerUnsub&&this.phaseListenerUnsub(),this.phaseListenerUnsub=e(A.state).listen("currentPhase",(t,r)=>{this.scene.isActive()&&(console.log(`Lobby: Phase changed from ${r} to: ${t}`),t===qe.Shop?(this.statusText.setText("Starting Game!"),this.time.delayedCall(500,()=>{this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"))})):t===qe.Lobby?this.updateLobbyUI():t===qe.GameOver&&(this.statusText.setText("Game Over. Returning to Main Menu."),this.time.delayedCall(1500,()=>{if(this.scene.isActive()){try{A==null||A.leave()}catch{}this.scene.stop(),this.scene.start("MainMenu")}})))}),this.playerAddListenerUnsub&&this.playerAddListenerUnsub(),this.playerAddListenerUnsub=e(A.state.players).onAdd((t,r)=>{this.scene.isActive()&&(console.log(`Lobby: Player joined: ${t.username} (${r})`),this.addPlayerStateListener(t,r),this.updateLobbyUI())}),this.playerRemoveListenerUnsub&&this.playerRemoveListenerUnsub(),this.playerRemoveListenerUnsub=e(A.state.players).onRemove((t,r)=>{this.scene.isActive()&&(console.log(`Lobby: Player left: ${t.username} (${r})`),this.removePlayerStateListener(r),this.updateLobbyUI())}),A.state.players.forEach((t,r)=>{this.addPlayerStateListener(t,r)})}addPlayerStateListener(e,t){var s;if(!A)return;const r=qn.getStateCallbacks(A);(s=this.playerStateListeners.get(t))==null||s(),console.log(`Lobby: Adding 'isReady' listener for player ${t}`);const i=r(e).listen("isReady",(c,u)=>{console.log(`Lobby: isReady changed for player ${t}: ${u} -> ${c}`),this.scene.isActive()&&this.updateLobbyUI()});this.playerStateListeners.set(t,i)}removePlayerStateListener(e){const t=this.playerStateListeners.get(e);t&&(console.log(`Lobby: Removing 'isReady' listener for player ${e}`),t(),this.playerStateListeners.delete(e))}updateLobbyUI(){if(!this.scene.isActive()){console.warn("Lobby: updateLobbyUI called but scene is NOT ACTIVE. Aborting UI update.");return}if(!A){console.warn("Lobby: updateLobbyUI called but colyseusRoom is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Connection lost.");return}if(!A.state){console.warn("Lobby: updateLobbyUI called but colyseusRoom.state is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Game state unavailable.");return}zr.size===0&&(console.log("Lobby: Card data not loaded yet. Loading..."),Ja().then(p=>{p?console.log("Lobby: Card data loaded successfully"):console.warn("Lobby: Failed to load card data")}));const e=A.state.players,t=A.sessionId,r=e.size,i=250,s=40;this.playerTextObjects.forEach(p=>p.destroy()),this.playerTextObjects.clear();let c=0,u=r>0,v=!1;const g=e.get(t);g&&(v=g.isReady),e.forEach((p,y)=>{const O=y===t,V=p.isReady?" [Ready]":" [Not Ready]",X=`${p.username||"Joining..."}${O?" (You)":""}${V}`,Z=this.add.text(this.cameras.main.centerX,i+c*s,X,{fontFamily:"Arial",fontSize:24,color:p.isReady?"#00ff00":"#ffffff",align:"center"}).setOrigin(.5);this.playerTextObjects.set(y,Z),c++,p.isReady||(u=!1)}),r<2?(this.statusText.setText("Waiting for opponent..."),this.readyButton.setVisible(!1).disableInteractive(),this.waitingText.setVisible(!1)):(this.readyButton.setVisible(!0),v?(this.statusText.setText("Waiting for opponent to ready up..."),this.readyButton.setText("Waiting...").setColor("#888888").disableInteractive(),this.waitingText.setText(u?"Starting game...":"Waiting for opponent...").setVisible(!0)):(this.statusText.setText("Lobby full. Ready up!"),this.readyButton.setText("Ready Up").setColor("#00ff00").setInteractive({useHandCursor:!0}),this.waitingText.setVisible(!1)),u&&(this.statusText.setText("Starting game..."),this.readyButton.setVisible(!1),this.waitingText.setVisible(!1)))}shutdown(){var e,t,r,i,s,c,u,v,g;console.log("Lobby scene shutting down."),this.listenersAttached=!1,(e=this.phaseListenerUnsub)==null||e.call(this),(t=this.playerAddListenerUnsub)==null||t.call(this),(r=this.playerRemoveListenerUnsub)==null||r.call(this),this.playerStateListeners.forEach(p=>p()),this.playerStateListeners.clear(),this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerTextObjects.forEach(p=>p.destroy()),this.playerTextObjects.clear(),(i=this.statusText)==null||i.destroy(),(s=this.readyButton)==null||s.destroy(),(c=this.waitingText)==null||c.destroy(),(u=this.readyButton)==null||u.off("pointerdown"),(v=this.readyButton)==null||v.off("pointerover"),(g=this.readyButton)==null||g.off("pointerout"),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const ir=120,oi=168;class gp extends dr.Scene{constructor(){super("Shop"),this.shopCardObjects=[],this.cardDataCache=new Map,this.shopOffersVisible=!0,this.phaseListenerUnsub=null,this.playerStateListenersUnsub=new Map,this.shopOfferListenersUnsub=[],this.listeners=[]}create(){var u;if(this.scene.launch("background"),(u=this.scene.get("BoardView"))!=null&&u.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!A||!A.state||!A.sessionId){console.error("Shop Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{A==null||A.leave(!0)}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,t=this.cameras.main.centerY,r=this.cameras.main.width,i=this.cameras.main.height;this.createShopCardsDisplay(e,t,r),this.setupDragAndDrop(),this.requestMissingCardData();const s=A.state.players.get(A.sessionId),c=(s==null?void 0:s.shopRefreshCost)||2;this.refreshButton=this.add.text(r-150,180,`Refresh: ${c} `,{fontFamily:"Arial",fontSize:18,color:"#FFFFFF",backgroundColor:"#4444AA",padding:{x:10,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.refreshButton.on("pointerdown",()=>{const v=A==null?void 0:A.state.players.get(A.sessionId);A&&v&&v.brews>=v.shopRefreshCost&&A.send("refreshShop")}),this.refreshButton.on("pointerover",()=>{var v;(v=this.refreshButton.input)!=null&&v.enabled&&this.refreshButton.setBackgroundColor("#6666CC")}),this.refreshButton.on("pointerout",()=>{var v;(v=this.refreshButton.input)!=null&&v.enabled&&this.refreshButton.setBackgroundColor("#4444AA")}),this.updateRefreshButtonState(),this.continueButton=this.add.text(e,i-50,"Continue",{fontFamily:"Arial Black",fontSize:40,color:"#00ff00",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.continueButton.on("pointerdown",()=>{const v=A==null?void 0:A.state.players.get(A.sessionId);A&&v&&!v.isReady&&A.state.currentPhase===qe.Shop&&A.send("playerReady")}),this.continueButton.on("pointerover",()=>{var v;(v=this.continueButton.input)!=null&&v.enabled&&this.continueButton.setColor("#55ff55")}),this.continueButton.on("pointerout",()=>{var v;(v=this.continueButton.input)!=null&&v.enabled?this.continueButton.setColor("#00ff00"):this.continueButton.setColor("#888888")}),this.waitingText=this.add.text(e,i-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(50,()=>this.createShopCardsDisplay(e,t,r)),this.toggleShopButton=this.add.text(r-100,t-250,"Toggle Shop",{fontFamily:"Arial",fontSize:16,color:"#FFFFFF",backgroundColor:"#555555",padding:{x:5,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.toggleShopButton.on("pointerdown",()=>{this.shopOffersVisible=!this.shopOffersVisible,this.shopOffersContainer.setVisible(this.shopOffersVisible),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop")}),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop"),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createShopCardsDisplay(e,t,r){var V;(V=this.shopOffersContainer)==null||V.destroy(),this.shopOffersContainer=this.add.container(0,0),this.shopOffersContainer.setVisible(this.shopOffersVisible),this.shopCardObjects.forEach(X=>X.destroy()),this.shopCardObjects=[];const i=A==null?void 0:A.state.players.get(A.sessionId),s=i==null?void 0:i.shopOfferIds;if(!s||s.length===0){console.log("Shop: No shop offers from server."),this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.setVisible(!1);return}const c=20,u=s.length>0?s.length:4,v=t,g=u*ir+(u-1)*c,p=e-g/2+ir/2,y=g+c*2,O=oi+c*2;this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.destroy(),this.shopOffersBackground=this.add.rectangle(e,v,y,O,51,.6),this.shopOffersContainer.add(this.shopOffersBackground),s.forEach((X,Z)=>{const z=this.getCardDataFromServer(X);if(!z){console.warn(`Shop: Card data not found for ID: ${X}`);return}const me=p+Z*(ir+c),le=this.add.container(me,v),ve=this.add.image(0,0,"cardFullTier1").setOrigin(.5).setDisplaySize(ir,oi);le.add(ve);const Le=this.add.text(0,-20,z.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:ir-20}}).setOrigin(.5,.5);le.add(Le);const ut=this.add.text(-ir/2+32,oi*.03,`${z.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(0,.5);le.add(ut);const St=this.add.text(ir/2-18,6,`${z.health}/${z.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,.5);le.add(St);const yt=this.add.text(0,oi/2-50,`${z.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);le.add(yt);const Rt=this.add.text(ir/2-8,-oi/2+8,`${z.brewCost}B`,{fontFamily:"Arial",fontSize:14,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"right"}).setOrigin(1,0);le.add(Rt),le.setSize(ir,oi),le.setSize(ir,oi),le.setInteractive({useHandCursor:!0}),le.setData("cardId",z.id),le.setData("cardData",z),this.input.setDraggable(le),le.off("pointerdown").on("pointerdown",tt=>{var bt;(bt=le.input)!=null&&bt.enabled&&le.setData("isBeingDragged",!1)}),le.off("pointerup").on("pointerup",tt=>{var ot;if(!((ot=le.input)!=null&&ot.enabled)||!A||!A.sessionId)return;if(le.getData("isBeingDragged")===!0){le.setData("isBeingDragged",!1);return}const bt=A.state.players.get(A.sessionId);if(!bt)return;let _t=-1;for(let M=0;M<5;M++)if(!bt.hand.has(String(M))){_t=M;break}if(_t!==-1){const M=le.getData("cardId"),oe=le.getData("cardData");M&&oe&&bt.brews>=oe.brewCost?(console.log(`Shop: Click-to-buy card ${M} (Cost: ${oe.brewCost}) into hand slot ${_t}. Brews: ${bt.brews}`),A.send("buyCard",{cardId:M,handSlotIndex:_t})):oe&&bt.brews<oe.brewCost?console.log(`Shop: Not enough brews (${bt.brews}) to click-buy card ${M} (Cost: ${oe.brewCost}).`):console.log(`Shop: Click-to-buy failed for card ${M}. CardData: ${!!oe}`)}else console.log("Shop: Hand is full, cannot click-buy.")}),this.shopCardObjects.push(le),this.shopOffersContainer.add(le)})}requestMissingCardData(){if(!A||!A.state||!A.sessionId)return;const e=A.state.players.get(A.sessionId);if(!e)return;const t=e.shopOfferIds;if(t&&t.length>0){const r=[];t.forEach(i=>{zr.has(i)||r.push(i)}),r.length>0&&(console.log("Requesting missing cards from server:",r),A.send("getCardsByIds",{cardIds:r}))}}getCardDataFromServer(e){if(zr.has(e))return zr.get(e);if(!A||!A.state)return;let t;return A.state.players.forEach(r=>{r.hand.forEach(i=>{i.cardId===e&&(t={id:i.cardId,name:i.name,attack:i.attack,speed:i.speed,health:i.health,brewCost:i.brewCost,description:i.description,isLegend:i.isLegend})}),r.battlefield.forEach(i=>{i.cardId===e&&(t={id:i.cardId,name:i.name,attack:i.attack,speed:i.speed,health:i.health,brewCost:i.brewCost,description:i.description,isLegend:i.isLegend})})}),t||(t={id:e,name:`Card ${e.split("_").pop()}`,attack:1,speed:1,health:1,brewCost:1,description:"Loading card details...",isLegend:!1},console.warn(`Shop: Card data not found for ID: ${e} in global cache or state`)),t}setupDragAndDrop(){this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),this.input.off("pointerdown"),this.input.off("pointerup"),this.shopCardObjects.forEach(e=>{e.off("pointerdown"),e.off("pointerup")}),this.input.on("dragstart",(e,t)=>{var r;!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)||(r=t.input)!=null&&r.enabled&&(this.children.bringToTop(t),t.setAlpha(.7),t.setData("startX",t.x),t.setData("startY",t.y),t.setData("isBeingDragged",!0))}),this.input.on("drag",(e,t,r,i)=>{var s;!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)||(s=t.input)!=null&&s.enabled&&t.getData("isBeingDragged")===!0&&(t.x=r,t.y=i)}),this.input.on("dragend",(e,t)=>{if(!A||!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)){t instanceof Phaser.GameObjects.Container&&t.setData("isBeingDragged",!1);return}t.setAlpha(1);let r=!1;if(t.getData("isBeingDragged")===!0){const i=t.x,s=t.y,c=this.scene.get("BoardView");for(let u=0;u<5;u++){const v=c==null?void 0:c.getSlotPixelPosition(!0,"hand",u);if(v){const g=new Phaser.Geom.Rectangle(v.x-50,v.y-70,100,140);if(Phaser.Geom.Rectangle.Contains(g,i,s)){const p=A.state.players.get(A.sessionId);if(p&&!p.hand.has(String(u))){const y=t.getData("cardId"),O=t.getData("cardData");y&&O&&p.brews>=O.brewCost?(A.send("buyCard",{cardId:y,handSlotIndex:u}),r=!0):console.log("Shop: Drag-to-buy failed (not enough brews or card data missing).")}break}}}r||t.active&&(t.x=t.getData("startX"),t.y=t.getData("startY"))}t.setData("isBeingDragged",!1)})}updateRefreshButtonState(){if(!A||!this.refreshButton||!this.refreshButton.active)return;const e=A.state.players.get(A.sessionId);if(!e)return;this.refreshButton.setText(`Refresh: ${e.shopRefreshCost} `),e.brews>=e.shopRefreshCost&&A.state.currentPhase===qe.Shop?(this.refreshButton.setColor("#FFFFFF"),this.refreshButton.setBackgroundColor("#4444AA"),this.refreshButton.setInteractive({useHandCursor:!0})):(this.refreshButton.setColor("#AAAAAA"),this.refreshButton.setBackgroundColor("#555555"),this.refreshButton.disableInteractive())}setupColyseusListeners(){if(!A||!A.sessionId)return;const e=qn.getStateCallbacks(A),t=A.sessionId;this.phaseListenerUnsub=e(A.state).listen("currentPhase",i=>{this.scene.isActive()&&(i===qe.Preparation?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Preparation")):i!==qe.Shop&&this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby")),this.updateWaitingStatus())}),A.state.players.forEach((i,s)=>{const c=e(i).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(s,c)}),this.listeners.push(e(A.state.players).onAdd((i,s)=>{var u;this.playerStateListenersUnsub.has(s)&&((u=this.playerStateListenersUnsub.get(s))==null||u());const c=e(i).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(s,c),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(e(A.state.players).onRemove((i,s)=>{var c;(c=this.playerStateListenersUnsub.get(s))==null||c(),this.playerStateListenersUnsub.delete(s),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(A.onMessage("cardsByIds",i=>{if(this.scene.isActive()){Object.entries(i).forEach(([v,g])=>{zr.set(v,g)});const s=this.cameras.main.centerX,c=this.cameras.main.centerY,u=this.cameras.main.width;this.createShopCardsDisplay(s,c,u)}}));const r=A.state.players.get(t);if(r){const i=()=>{if(!this.scene.isActive())return;this.requestMissingCardData();const s=this.cameras.main.centerX,c=this.cameras.main.centerY,u=this.cameras.main.width;this.createShopCardsDisplay(s,c,u)};this.shopOfferListenersUnsub.push(e(r.shopOfferIds).onAdd(i)),this.shopOfferListenersUnsub.push(e(r.shopOfferIds).onRemove(i)),i(),this.listeners.push(e(r).listen("brews",()=>{this.scene.isActive()&&this.updateRefreshButtonState()})),this.listeners.push(e(r).listen("shopRefreshCost",()=>{this.scene.isActive()&&this.updateRefreshButtonState()}))}}cleanupListeners(){var e,t,r,i;console.log("Shop Scene: Cleaning up listeners."),(e=this.phaseListenerUnsub)==null||e.call(this),this.phaseListenerUnsub=null,this.playerStateListenersUnsub.forEach(s=>s()),this.playerStateListenersUnsub.clear(),this.shopOfferListenersUnsub.forEach(s=>s()),this.shopOfferListenersUnsub=[],this.listeners.forEach(s=>s()),this.listeners=[],this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(t=this.continueButton)==null||t.off("pointerdown"),(r=this.continueButton)==null||r.off("pointerover"),(i=this.continueButton)==null||i.off("pointerout")}updateWaitingStatus(){if(!A||!A.sessionId||!this.continueButton||!this.waitingText||!this.scene.isActive())return;const e=A.state.players.get(A.sessionId);if(!e)return;let t=!0;A.state.players.forEach(c=>{c.isReady||(t=!1)});const r=e.isReady,i=A.state.currentPhase===qe.Shop,s=!r&&i;this.continueButton.setInteractive(s),this.continueButton.input&&(this.continueButton.input.useHandCursor=s),this.continueButton.setColor(s?"#00ff00":"#888888"),r&&!t&&i?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.continueButton.setText("Waiting...")):i?(this.waitingText.setVisible(!1),this.continueButton.setText("Continue")):(this.waitingText.setText(`Waiting for ${A.state.currentPhase} phase...`).setVisible(!0),this.continueButton.setText("Continue")),this.shopCardObjects.forEach(c=>{c.input&&(c.input.enabled=s)})}shutdown(){var e,t,r,i,s,c,u,v;console.log("Shop scene shutting down."),this.cleanupListeners(),this.shopCardObjects.forEach(g=>g.destroy()),this.shopCardObjects=[],(e=this.continueButton)==null||e.destroy(),(t=this.waitingText)==null||t.destroy(),(r=this.refreshButton)==null||r.off("pointerdown"),(i=this.refreshButton)==null||i.off("pointerover"),(s=this.refreshButton)==null||s.off("pointerout"),(c=this.refreshButton)==null||c.destroy(),(u=this.toggleShopButton)==null||u.destroy(),(v=this.shopOffersContainer)==null||v.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class mp extends dr.Scene{constructor(){super("Preparation"),this.playerStateListener=null,this.handListener=null,this.battlefieldListener=null,this.phaseListener=null,this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerChangeListeners=new Map,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.clientSideCardLayout=new Map}create(){var i;if(this.scene.launch("background"),(i=this.scene.get("BoardView"))!=null&&i.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!A||!A.state||!A.sessionId){console.error("Preparation Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>this.scene.start("MainMenu"));return}const e=this.cameras.main.centerX;this.cameras.main.centerY;const t=this.cameras.main.height;this.cameras.main.width;const r=A.state.players.get(A.sessionId);r?console.log("Preparation Create: Initial myPlayerState.hand contents:",JSON.stringify(Object.fromEntries(r.hand.entries()))):console.log("Preparation Create: myPlayerState not found initially."),this.add.text(e,80,"Preparation Phase",{fontFamily:"Arial Black",fontSize:48,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.startBattleButton=this.add.text(e,t-50,"Start Battle",{fontFamily:"Arial Black",fontSize:40,color:"#888888",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.startBattleButton.setColor("#888888").disableInteractive(),this.waitingText=this.add.text(e,t-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(100,this.updateStartButtonState,[],this),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!A||!A.sessionId)return;const e=A.sessionId,t=qn.getStateCallbacks(A),r=A.state.players.get(e);r?(this.playerStateListenerUnsub=t(r).onChange(()=>{this.scene.isActive()&&this.updateWaitingStatus()}),this.handAddUnsub=t(r.hand).onAdd((i,s)=>{console.log(`Preparation Scene: player.hand.onAdd triggered for key: ${s}, card: ${i==null?void 0:i.name}. Scene active: ${this.scene.isActive()}`),this.scene.isActive()&&this.updateStartButtonState()}),this.handRemoveUnsub=t(r.hand).onRemove((i,s)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldAddUnsub=t(r.battlefield).onAdd((i,s)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldRemoveUnsub=t(r.battlefield).onRemove((i,s)=>{this.scene.isActive()&&this.updateStartButtonState()})):console.error("Preparation Scene: My player state not found on init."),this.phaseListenerUnsub=t(A.state).listen("currentPhase",i=>{this.scene.isActive()&&(console.log(`Preparation Scene: Phase changed to ${i}`),i===qe.Battle?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Battle")):i!==qe.Preparation&&(console.warn(`Preparation Scene: Unexpected phase change to ${i}. Returning to Lobby.`),this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby"))),this.updateWaitingStatus())}),this.otherPlayerAddUnsub=t(A.state.players).onAdd((i,s)=>{if(this.scene.isActive()){if(s!==e){const c=t(i).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(s,c)}this.updateWaitingStatus()}}),this.otherPlayerRemoveUnsub=t(A.state.players).onRemove((i,s)=>{if(this.scene.isActive()){const c=this.otherPlayerChangeListeners.get(s);c==null||c(),this.otherPlayerChangeListeners.delete(s),this.updateWaitingStatus()}}),A.state.players.forEach((i,s)=>{if(s!==e){const c=t(i).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(s,c)}})}cleanupListeners(){var e,t,r,i,s,c,u,v,g,p,y,O,V;console.log("Preparation Scene: Cleaning up listeners."),(e=this.playerStateListenerUnsub)==null||e.call(this),(t=this.handAddUnsub)==null||t.call(this),(r=this.handRemoveUnsub)==null||r.call(this),(i=this.handChangeUnsub)==null||i.call(this),(s=this.battlefieldAddUnsub)==null||s.call(this),(c=this.battlefieldRemoveUnsub)==null||c.call(this),(u=this.battlefieldChangeUnsub)==null||u.call(this),(v=this.phaseListenerUnsub)==null||v.call(this),(g=this.otherPlayerAddUnsub)==null||g.call(this),(p=this.otherPlayerRemoveUnsub)==null||p.call(this),this.otherPlayerChangeListeners.forEach(X=>X()),this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.otherPlayerChangeListeners.clear(),this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(y=this.startBattleButton)==null||y.off("pointerdown"),(O=this.startBattleButton)==null||O.off("pointerover"),(V=this.startBattleButton)==null||V.off("pointerout")}makeLocalPlayerCardsDraggable(){if(!A||!A.sessionId||!this.scene.isActive()){console.warn("Preparation: Cannot make cards draggable, room/session/scene inactive.");return}const e=A.sessionId,t=A.state.players.get(e),r=this.scene.get("BoardView");if(!t||!r){console.warn("Preparation: Player state or BoardView not found for making cards draggable.");return}this.clientSideCardLayout.forEach(s=>{s.gameObject&&s.gameObject.input&&this.input.disable(s.gameObject)}),this.clientSideCardLayout.clear();const i=(s,c)=>{s.forEach((u,v)=>{const g=r.getCardGameObjectByInstanceId(u.instanceId);g?(g.setInteractive({useHandCursor:!0}),this.input.setDraggable(g),this.clientSideCardLayout.set(u.instanceId,{area:c,slotKey:v,gameObject:g})):console.warn(`Preparation: Could not find GameObject in BoardView for card instance ${u.instanceId}`)})};i(t.hand,"hand"),i(t.battlefield,"battlefield"),console.log("Preparation: Made local player cards draggable and initialized clientSideCardLayout.",this.clientSideCardLayout),this.updateStartButtonState()}updateWaitingStatus(){if(!A||!A.sessionId||!this.startBattleButton||!this.waitingText)return;const e=A.state.players.get(A.sessionId);if(!e)return;let t=!0;A.state.players.forEach(i=>{i.isReady||(t=!1)});const r=e.isReady;!r&&(A.state.currentPhase,qe.Preparation),this.updateStartButtonState(),r&&!t?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.startBattleButton.setText("Waiting..."),this.startBattleButton.disableInteractive().setColor("#888888")):(this.waitingText.setVisible(!1),this.startBattleButton.setText("Start Battle"),this.updateStartButtonState())}updateStartButtonState(){if(!this.startBattleButton||!this.startBattleButton.active){console.warn("updateStartButtonState called but button is null or inactive.");return}let e=0;const t=this.scene.get("BoardView");t&&t.scene.isActive()&&t.getLocalPlayerLayoutData().forEach(g=>{g.area==="battlefield"&&e++});const r=e>0,i=A==null?void 0:A.state.players.get(A==null?void 0:A.sessionId),s=(i==null?void 0:i.isReady)??!1,c=(A==null?void 0:A.state.currentPhase)===qe.Preparation;r&&!s&&c?(this.startBattleButton.setColor("#00ff00"),this.startBattleButton.setInteractive({useHandCursor:!0}),this.startBattleButton.off("pointerdown"),this.startBattleButton.once("pointerdown",this.confirmPreparation,this),this.startBattleButton.on("pointerover",()=>this.startBattleButton.setColor("#55ff55")),this.startBattleButton.on("pointerout",()=>this.startBattleButton.setColor("#00ff00"))):(this.waitingText&&!this.waitingText.visible&&this.startBattleButton.setColor("#888888"),this.startBattleButton.disableInteractive(),this.startBattleButton.off("pointerdown"),this.startBattleButton.off("pointerover"),this.startBattleButton.off("pointerout"))}confirmPreparation(){if(!A)return;console.log("Confirming preparation layout...");const e=this.scene.get("BoardView");if(!e||!e.scene.isActive()){console.error("Preparation: BoardView not available to get layout data.");return}const{handLayout:t,battlefieldLayout:r}=e.getCardLayouts();console.log("Sending preparation layout to server:",{handLayout:t,battlefieldLayout:r}),A.send("setPreparation",{handLayout:t,battlefieldLayout:r}),this.updateWaitingStatus()}shutdown(){var e,t;console.log("Preparation scene shutting down explicitly."),this.cleanupListeners(),(e=this.startBattleButton)==null||e.destroy(),(t=this.waitingText)==null||t.destroy(),this.clientSideCardLayout.clear(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class yp extends dr.Scene{constructor(){super("Battle"),this.handCardDisplayObjects=new Map,this.battleOver=!1,this.phaseListenerUnsubscribe=null}create(){if(this.scene.launch("background"),this.battleOver=!1,!A||!A.state||!A.sessionId){console.error("Battle Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{A==null||A.leave()}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,t=this.cameras.main.centerY,r=this.cameras.main.height;this.cameras.main.width,this.resultText=this.add.text(e,t,"",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setAlpha(0),this.statusText=this.add.text(e,r-50,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5).setAlpha(0),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!A||!A.state)return;const e=qn.getStateCallbacks(A);this.phaseListenerUnsubscribe=e(A.state).listen("currentPhase",t=>{if(this.scene.isActive()){if(console.log(`Battle Scene: Phase changed to ${t}`),t===qe.BattleEnd)this.handleBattleEnd();else if(t===qe.Shop)this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"));else if(t===qe.GameOver)this.handleGameOver();else if(t!==qe.Battle&&(console.warn(`Battle Scene: Unexpected phase change to ${t}. Returning to Lobby.`),this.scene.isActive())){try{A==null||A.leave()}catch{}this.scene.stop(),this.scene.start("Lobby")}}})}cleanupListeners(){var e;console.log("Battle Scene: Cleaning up listeners."),(e=this.phaseListenerUnsubscribe)==null||e.call(this),this.phaseListenerUnsubscribe=null}handleBattleEnd(){var s,c;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Battle ended (server signal received). Displaying results.");const e=A==null?void 0:A.state.players.get(A.sessionId);let t;A==null||A.state.players.forEach((u,v)=>{v!==(A==null?void 0:A.sessionId)&&(t=u)});let r="Battle Ended",i="#ffffff";e&&t?e.health>t.health?(r="Victory!",i="#88ff88"):t.health>e.health?(r="Defeat!",i="#ff8888"):(r="Draw!",i="#ffff88"):(r="Battle Ended (Opponent Left?)",i="#ffffff"),(s=this.resultText)!=null&&s.active&&this.resultText.setText(r).setColor(i).setAlpha(1),(c=this.statusText)!=null&&c.active&&this.statusText.setText("Waiting for next round...").setAlpha(1)}handleGameOver(){var s,c;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Game Over signal received.");const e=A==null?void 0:A.state.players.get(A.sessionId);let t;A==null||A.state.players.forEach((u,v)=>{v!==(A==null?void 0:A.sessionId)&&(t=u)});let r="Game Over!",i="#ffffff";e&&t?e.health>t.health?(r="You Win!",i="#00ff00"):t.health>e.health?(r="You Lose!",i="#ff0000"):(r="Draw!",i="#ffff00"):e?(r="You Win! (Opponent Left)",i="#00ff00"):(r="Game Over (Error?)",i="#ff0000"),(s=this.resultText)!=null&&s.active&&this.resultText.setText(r).setColor(i).setAlpha(1),(c=this.statusText)!=null&&c.active&&this.statusText.setText("Click to return to Main Menu").setAlpha(1),this.input.once("pointerdown",()=>{try{A==null||A.leave()}catch{}this.scene.stop("Background"),this.scene.start("MainMenu")})}shutdown(){var e,t;console.log("Battle scene shutting down explicitly."),this.cleanupListeners(),this.handCardDisplayObjects.forEach(r=>{r==null||r.forEach(i=>i==null?void 0:i.destroy())}),this.handCardDisplayObjects.clear(),(e=this.resultText)==null||e.destroy(),(t=this.statusText)==null||t.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const Fr=100,aa=140,Zn=120,zn=168,Bo=15,oa=580,la=420,ca=100,ua=260;class vp extends dr.Scene{constructor(){super("BoardView"),this.playerVisuals=new Map,this.currentPhase=qe.Lobby,this.listeners=[],this.cardSchemaListeners=new Map}updateCardHpVisuals(e,t,r){if(!e||!e.active)return;const i=e.getData("hpTextObject"),s=e.getData("mainCardImage");if(i&&i.active){i.setText(`${t}/${r}`);const u=r>0?t/r:0;t<=0?i.setColor("#ff0000"):u<.3?i.setColor("#ff8888"):u<.6?i.setColor("#ffff88"):i.setColor("#88ff88")}const c=e.alpha<1;t<=0?c||(e.setAlpha(.6),s&&s.active&&typeof s.setTint=="function"&&s.setTint(7829367)):c&&(e.setAlpha(1),s&&s.active&&typeof s.clearTint=="function"?s.clearTint():s&&s.active&&console.warn("BoardView: updateCardHpVisuals - clearTint method not found on mainCardImage for card.",e.getData("instanceId"),s))}preload(){if(!this.textures.exists("cardBack")){const e=this.make.graphics({x:0,y:0});e.fillStyle(5253758),e.fillRect(0,0,Zn,zn),e.lineStyle(2,12428501),e.strokeRect(0,0,Zn,zn),e.generateTexture("cardBack",Zn,zn),e.destroy()}}create(){console.log("BoardView creating..."),this.createNavbar(),this.createSellZone(),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createNavbar(){const e=this.cameras.main.centerX,t=this.cameras.main.width,r=30;this.add.rectangle(e,r,t,50,0,.7).setDepth(1e3);const s={fontFamily:"Arial",fontSize:16,color:"#ffffff",align:"left"};this.playerHealthText=this.add.text(t*.05,r,"You: -- HP",{...s,color:"#00ff00"}).setOrigin(0,.5).setDepth(1001),this.playerBrewsText=this.add.text(t*.95,r,"Brews: --",{...s,color:"#ffff00",align:"right"}).setOrigin(1,.5).setDepth(1001),this.opponentUsernameText=this.add.text(t*.25,r-10,"Opponent: --",{...s,fontSize:14}).setOrigin(0,.5).setDepth(1001),this.opponentHealthText=this.add.text(t*.25,r+10,"-- HP",{...s,color:"#ff0000"}).setOrigin(0,.5).setDepth(1001),this.dayPhaseText=this.add.text(e,r,"Day -- - Phase --",{...s,fontSize:20,align:"center"}).setOrigin(.5).setDepth(1001)}showAttackAnimation(e){const t=this.getCardGameObjectByInstanceId(e);if(t&&t.active){const r=t.scaleX,i=t.scaleY;this.tweens.add({targets:t,scaleX:r*1.15,scaleY:i*1.15,duration:100,yoyo:!0,ease:"Sine.easeInOut"})}}showDamageNumber(e,t){const r=this.getCardGameObjectByInstanceId(e);if(r&&r.active&&t>0){const i=this.add.text(r.x+Phaser.Math.Between(-10,10),r.y-zn/2-10,`-${t}`,{fontFamily:"Arial Black",fontSize:24,color:"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(r.depth+1);this.tweens.add({targets:i,y:i.y-50,alpha:0,duration:1e3,ease:"Power1",onComplete:()=>{i.destroy()}})}}drawAttackLine(e,t){const r=this.getCardGameObjectByInstanceId(e),i=this.getCardGameObjectByInstanceId(t);if(r&&r.active&&i&&i.active){const s=this.add.line(0,0,r.x,r.y,i.x,i.y,16724787,.7).setOrigin(0,0).setLineWidth(2).setDepth(r.depth);this.time.delayedCall(250,()=>{s.destroy()})}}setupColyseusListeners(){if(!A||!A.state){console.error("BoardView: Colyseus room or state not available!"),this.time.delayedCall(100,this.setupColyseusListeners,[],this);return}const e=qn.getStateCallbacks(A);this.listeners.push(e(A.state).listen("currentDay",()=>this.updateNavbarText())),this.listeners.push(e(A.state).listen("currentPhase",(t,r)=>{this.currentPhase=t,this.updateNavbarText(),t===qe.Shop||t===qe.Preparation?this.sellZone.setVisible(!0):this.sellZone.setVisible(!1);const i=(s,c,u,v)=>{if(!s.active)return;const g=s.getData("cooldownBarBg"),p=s.getData("cooldownBarFill");if(t===qe.Battle){if(s.getData("area")==="battlefield")if(c)if(g&&p){g.setVisible(!0),p.setVisible(!0);const O=s.getData("cooldownBarBaseWidth"),V=typeof O=="number"?O:Fr-10;p.setSize(V,6);const X=(c.speed>0?c.speed:1.5)*1e3;s.setData("maxAttackCooldown",X),s.setData("attackCooldownTimer",X)}else console.warn(`BoardView: Battle Phase - Card ${c.instanceId} (Owner: ${u}, Slot: ${v}) missing cooldown bar elements in data. Bg: ${!!g}, Fill: ${!!p}`);else console.warn(`BoardView: Battle Phase - Battlefield card container (Owner: ${u}, Slot: ${v}) has no cardSchema. No cooldown bar shown.`)}else g&&g.setVisible(!1),p&&p.setVisible(!1);if((r===qe.Battle||r===qe.BattleEnd)&&t!==qe.Battle&&t!==qe.BattleEnd&&c&&c.currentHp>0){s.setAlpha(1);const y=s.getData("backgroundRectangle");y&&y.active&&typeof y.clearTint=="function"&&y.clearTint()}};this.playerVisuals.forEach((s,c)=>{s.battlefield.forEach((u,v)=>{var p;const g=(p=A==null?void 0:A.state.players.get(c))==null?void 0:p.battlefield.get(v);i(u,g,c,v)}),s.hand.forEach((u,v)=>{var p;const g=(p=A==null?void 0:A.state.players.get(c))==null?void 0:p.hand.get(v);if((r===qe.Battle||r===qe.BattleEnd)&&t!==qe.Battle&&t!==qe.BattleEnd&&g&&g.currentHp>0){u.setAlpha(1);const y=u.getData("backgroundRectangle");y&&y.active&&typeof y.clearTint=="function"&&y.clearTint()}})})})),this.listeners.push(e(A.state.players).onAdd((t,r)=>{console.log(`BoardView: Player added ${r}`),this.addPlayerVisuals(r),this.addPlayerListeners(t,r),this.updatePlayerSlots(t,r),this.updateNavbarText()})),this.listeners.push(e(A.state.players).onRemove((t,r)=>{console.log(`BoardView: Player removed ${r}`),this.removePlayerVisuals(r),this.updateNavbarText()})),this.listeners.push(A.onMessage("battleAttackEvent",t=>{if(this.currentPhase!==qe.Battle||!this.scene.isActive())return;console.log("BoardView: Received battleAttackEvent",t);const r=this.getCardGameObjectByInstanceId(t.attackerInstanceId),i=this.getCardGameObjectByInstanceId(t.targetInstanceId);if(r&&r.active&&i&&i.active){this.drawAttackLine(t.attackerInstanceId,t.targetInstanceId),this.showAttackAnimation(t.attackerInstanceId),this.showDamageNumber(t.targetInstanceId,t.damageDealt);const s=r.getData("maxAttackCooldown");if(s>0){r.setData("attackCooldownTimer",s);const g=r.getData("cooldownBarFill"),p=r.getData("cooldownBarBaseWidth")||Fr-10;g&&g.setSize(p,6)}const c=i.getData("ownerSessionId"),u=i.getData("slotKey"),v=i.getData("area");if(c===t.targetPlayerId&&v==="battlefield"&&u){const g=A.state.players.get(t.targetPlayerId),p=g==null?void 0:g.battlefield.get(u);if(p&&p.instanceId===t.targetInstanceId){const y=Math.max(0,p.currentHp-t.damageDealt);this.updateCardHpVisuals(i,y,p.health)}else console.warn(`BoardView: battleAttackEvent - Target card schema not found or instanceId mismatch for player ${t.targetPlayerId}, slot ${u}, instance ${t.targetInstanceId}.`)}else console.warn(`BoardView: battleAttackEvent - Target card container data inconsistent or not on battlefield. Owner: ${c}, Area: ${v}, Slot: ${u}`)}else console.warn("BoardView: Attacker or target not found/active for battleAttackEvent",t)})),A.state.players.forEach((t,r)=>{this.addPlayerVisuals(r),this.addPlayerListeners(t,r),this.updatePlayerSlots(t,r)}),this.updateNavbarText()}update(e,t){!this.scene.isActive()||this.currentPhase!==qe.Battle||!A||!A.state||this.playerVisuals.forEach(r=>{r.battlefield.forEach(i=>{if(!i.active)return;const s=i.getData("maxAttackCooldown");let c=i.getData("attackCooldownTimer");const u=i.getData("cooldownBarBaseWidth")||Fr-10;if(s>0){c-=t,c<0&&(c=0),i.setData("attackCooldownTimer",c);const v=i.getData("cooldownBarFill");if(v&&v.visible){const g=c/s;v.setSize(u*Math.max(0,g),6)}}})})}addPlayerListeners(e,t){const r=qn.getStateCallbacks(A),i=[];i.push(r(e).listen("health",()=>this.updateNavbarText())),i.push(r(e).listen("brews",()=>this.updateNavbarText())),i.push(r(e).listen("username",()=>this.updateNavbarText())),i.push(r(e.hand).onAdd((s,c)=>{this.updateCardVisual(t,"hand",c,s),this.addCardSchemaListeners(s)})),i.push(r(e.hand).onRemove((s,c)=>{this.removeCardVisual(t,"hand",c)})),e.hand.forEach((s,c)=>{this.addCardSchemaListeners(s)}),i.push(r(e.battlefield).onAdd((s,c)=>{this.updateCardVisual(t,"battlefield",c,s),this.addCardSchemaListeners(s)})),i.push(r(e.battlefield).onRemove((s,c)=>{this.removeCardVisual(t,"battlefield",c)})),e.battlefield.forEach((s,c)=>{this.addCardSchemaListeners(s)}),this.listeners.push(...i)}addCardSchemaListeners(e){if(!e||!e.instanceId)return;const t=qn.getStateCallbacks(A),r=this.cardSchemaListeners.get(e.instanceId);r&&(r.forEach(c=>c()),this.cardSchemaListeners.delete(e.instanceId));const i=[],s=t(e).listen("currentHp",(c,u)=>{const v=this.getCardGameObjectByInstanceId(e.instanceId);v&&this.updateCardHpVisuals(v,c,e.health)});i.push(s),i.length>0&&this.cardSchemaListeners.set(e.instanceId,i)}updatePlayerSlots(e,t){e.hand.forEach((r,i)=>this.updateCardVisual(t,"hand",i,r)),e.battlefield.forEach((r,i)=>this.updateCardVisual(t,"battlefield",i,r))}addPlayerVisuals(e){if(!this.playerVisuals.has(e)){const t=[],r=[],i=e===(A==null?void 0:A.sessionId);for(let s=0;s<5;s++){const c=this.calculateSlotX(s,"hand"),u=i?oa:ca,v=this.add.rectangle(c,u,Zn,zn).setStrokeStyle(2,i?11184810:7829367,.8).setDepth(0);t.push(v);const g=this.calculateSlotX(s,"battlefield"),p=i?la:ua,y=this.add.rectangle(g,p,Fr,aa).setStrokeStyle(2,i?16777215:11184810,1).setDepth(0);r.push(y)}this.playerVisuals.set(e,{hand:new Map,battlefield:new Map,handSlotOutlines:t,battlefieldSlotOutlines:r})}}removePlayerVisuals(e){const t=this.playerVisuals.get(e);t&&(t.hand.forEach(r=>r.destroy()),t.battlefield.forEach(r=>r.destroy()),t.handSlotOutlines.forEach(r=>r.destroy()),t.battlefieldSlotOutlines.forEach(r=>r.destroy())),this.playerVisuals.delete(e)}updateCardVisual(e,t,r,i){if(!this.scene.isActive()||!A||!A.state)return;this.removeCardVisual(e,t,r);const s=this.playerVisuals.get(e);if(!s)return;const c=e===(A==null?void 0:A.sessionId),u=this.calculateSlotX(parseInt(r,10),t);let v,g=!1;t==="hand"?(v=c?oa:ca,c||(g=!0)):v=c?la:ua;const p=this.createCardGameObject(i,u,v,g,c,t);if(p.setData("instanceId",i.instanceId),p.setData("slotKey",r),p.setData("area",t),p.setData("ownerSessionId",e),p.setDepth(1),i.currentHp<=0){p.setAlpha(.6);const y=p.getData("mainCardImage");y&&y.active&&typeof y.setTint=="function"&&y.setTint(7829367);const O=p.getData("hpTextObject");O&&O.active&&O.setColor("#ff0000")}t==="hand"?s.hand.set(r,p):s.battlefield.set(r,p),this.addCardSchemaListeners(i),c&&this.makeCardInteractive(p)}removeCardVisual(e,t,r){const i=this.playerVisuals.get(e);if(i){const s=t==="hand"?i.hand:i.battlefield,c=s.get(r);if(c){const u=c.getData("instanceId");if(u){const v=this.cardSchemaListeners.get(u);v&&(console.log(`BoardView: Cleaning up ${v.length} listeners for card instance ${u} during removeCardVisual.`),v.forEach(g=>{if(typeof g=="function")try{g()}catch(p){console.warn(`BoardView: Error unsubscribing card listener for ${u}`,p)}}),this.cardSchemaListeners.delete(u))}c.input&&c.input.enabled&&this.input.disable(c),this.time.delayedCall(1,()=>{c.active&&c.destroy()}),s.delete(r)}}}calculateSlotX(e,t){const r=t==="hand"?Zn:Fr,i=5*r+4*Bo;return(this.cameras.main.width-i)/2+r/2+e*(r+Bo)}createCardGameObject(e,t,r,i,s,c){const u=this.add.container(t,r),v=c==="hand"?Zn:Fr,g=c==="hand"?zn:aa;if(u.setData("displayCardWidth",v),u.setData("displayCardHeight",g),i){const O=this.add.image(0,0,"cardBack").setOrigin(.5).setDisplaySize(Zn,zn);return u.add(O),u}const p=c==="hand"?"cardFullTier1":"cardMinionTier1",y=this.add.image(0,0,p).setOrigin(.5);if(y.setDisplaySize(v,g),u.add(y),u.setData("mainCardImage",y),c==="hand"){const O=this.add.text(0,-20,e.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:v-20}}).setOrigin(.5,.5);u.add(O);const V=this.add.text(-Fr/2+32,aa*.03,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);u.add(V);const X=this.add.text(Fr/2-18,6,`${e.currentHp}  ${e.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(1,.5);u.add(X),u.setData("hpTextObject",X);const Z=this.add.text(0,g/2-50,`${e.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);u.add(Z)}else{const O=this.add.text(0,-g/2+5,e.name,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:v}}).setOrigin(.5,0);u.add(O);const V=this.add.text(-v/2+32,32,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);u.add(V);const X=this.add.text(0,43,`${e.speed}`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(1,0);u.add(X);const Z=this.add.text(v/2-10,g/2-30,`${e.currentHp}/${e.health}`,{fontFamily:"Arial",fontSize:14,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,1);u.add(Z),u.setData("hpTextObject",Z);const z=g/2-15,me=v-10,le=this.add.rectangle(0,z,me,6,0,.5).setVisible(!1),ve=this.add.rectangle(-me/2,z,me,6,4521796).setOrigin(0,.5).setVisible(!1);u.add(le),u.add(ve),u.setData("cooldownBarBg",le),u.setData("cooldownBarFill",ve),u.setData("attackCooldownTimer",0),u.setData("maxAttackCooldown",0),u.setData("cooldownBarBaseWidth",me)}return u}getCardGameObjectByInstanceId(e){for(const[t,r]of this.playerVisuals){for(const[i,s]of r.hand)if(s.getData("instanceId")===e)return s;for(const[i,s]of r.battlefield)if(s.getData("instanceId")===e)return s}}getSlotPixelPosition(e,t,r){if(r<0||r>4)return;const i=this.calculateSlotX(r,t);let s;return t==="hand"?s=e?oa:ca:s=e?la:ua,{x:i,y:s}}makeCardInteractive(e){const t=e.getData("displayCardWidth"),r=e.getData("displayCardHeight");if(!t||!r){console.warn("BoardView: makeCardInteractive - displayCardWidth/Height not found on container.",e.getData("instanceId"));return}const i=new Phaser.Geom.Rectangle(-t/2,-r/2,t,r);e.setInteractive({hitArea:i,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}),this.input.setDraggable(e),e.input&&(e.input.enabled=!0),e.on("dragstart",s=>{this.currentPhase!==qe.Shop&&this.currentPhase!==qe.Preparation||!e.input||!e.input.enabled||(this.children.bringToTop(e),e.setAlpha(.7),e.setData("isDragging",!0),e.setData("originalX",e.x),e.setData("originalY",e.y),e.setData("originalAreaOnDragStart",e.getData("area")),e.setData("originalSlotKeyOnDragStart",e.getData("slotKey")))}),e.on("drag",(s,c,u)=>{if(e.getData("isDragging"))if(e.x=c,e.y=u,(this.currentPhase===qe.Shop||this.currentPhase===qe.Preparation)&&this.sellZone.visible)if(this.isDroppedOnSellZone(e)){const v=e.getData("instanceId"),g=e.getData("originalAreaOnDragStart"),p=e.getData("originalSlotKeyOnDragStart"),y=e.getData("ownerSessionId"),O=A==null?void 0:A.state.players.get(y);let V;if(O&&(g==="hand"?V=O.hand.get(p):V=O.battlefield.get(p)),V&&V.instanceId===v){const X=Math.max(1,Math.floor(V.brewCost/2));this.brewGainText.setText(`Sell: +${X} `),this.brewGainText.setAlpha(1)}else this.brewGainText.setAlpha(0)}else this.brewGainText.setAlpha(0);else this.brewGainText.setAlpha(0)}),e.on("dragend",s=>{if(!e.getData("isDragging"))return;e.setAlpha(1),e.setData("isDragging",!1),this.brewGainText.setAlpha(0);const c=e.getData("instanceId"),u=e.getData("originalAreaOnDragStart"),v=e.getData("originalSlotKeyOnDragStart"),g=e.getData("ownerSessionId");if((this.currentPhase===qe.Shop||this.currentPhase===qe.Preparation)&&this.sellZone.visible&&this.isDroppedOnSellZone(e)){const V=A==null?void 0:A.state.players.get(A==null?void 0:A.sessionId);let X;if(u==="hand"&&(V!=null&&V.hand.has(v))?X=V.hand.get(v):u==="battlefield"&&(V!=null&&V.battlefield.has(v))&&(X=V.battlefield.get(v)),X&&X.instanceId===c){const Z=Math.max(1,Math.floor(X.brewCost/2));A==null||A.send("sellCard",{instanceId:c,area:u,slotKey:v}),this.showBrewGain(Z);return}}let p=!1,y,O;for(let V=0;V<5;V++){const X=String(V),Z=this.getSlotPixelPosition(!0,"hand",V);if(Z){const z=new Phaser.Geom.Rectangle(Z.x-Zn/2,Z.y-zn/2,Zn,zn);if(Phaser.Geom.Rectangle.Contains(z,e.x,e.y)){if(this.isSlotEmpty(g,"hand",X,c)){let me=!1;if(this.currentPhase===qe.Shop?u==="hand"&&(me=!0):this.currentPhase===qe.Preparation&&u==="hand"&&(me=!0),me){e.x=Z.x,e.y=Z.y;const le=u!=="hand";if(e.setData("area","hand"),e.setData("slotKey",X),this.updateVisualMaps(g,u,v,"hand",X,e),le){const ve=A==null?void 0:A.state.players.get(g),Le=(ve==null?void 0:ve.hand.get(X))||(u==="battlefield"?ve==null?void 0:ve.battlefield.get(v):void 0)||(u==="hand"?ve==null?void 0:ve.hand.get(v):void 0);Le&&Le.instanceId===c&&this.updateCardVisual(g,"hand",X,Le)}p=!0,y="hand",O=X,this.currentPhase===qe.Shop&&(u!=="hand"||v!==X)&&(A==null||A.send("moveCardInHand",{instanceId:c,fromSlotKey:v,toSlotKey:X}))}}if(p)break}}}if(!p&&this.currentPhase===qe.Preparation)for(let V=0;V<5;V++){const X=String(V),Z=this.getSlotPixelPosition(!0,"battlefield",V);if(Z){const z=new Phaser.Geom.Rectangle(Z.x-Zn/2,Z.y-zn/2,Zn,zn);if(Phaser.Geom.Rectangle.Contains(z,e.x,e.y)){if(this.isSlotEmpty(g,"battlefield",X,c)){e.x=Z.x,e.y=Z.y;const me=u!=="battlefield";if(e.setData("area","battlefield"),e.setData("slotKey",X),this.updateVisualMaps(g,u,v,"battlefield",X,e),me){const le=A==null?void 0:A.state.players.get(g),ve=(le==null?void 0:le.battlefield.get(X))||(le==null?void 0:le.hand.get(v));ve&&ve.instanceId===c&&this.updateCardVisual(g,"battlefield",X,ve)}p=!0,y="battlefield",O=X}break}}}if(p?this.currentPhase===qe.Preparation&&y&&O&&(u!==y||v!==O)&&(A==null||A.send("updatePrepLayout",{instanceId:c,newArea:y,newSlotKey:O})):(e.x=e.getData("originalX"),e.y=e.getData("originalY"),e.setData("area",u),e.setData("slotKey",v)),this.currentPhase===qe.Preparation){const V=this.scene.get("Preparation");V&&V.scene.isActive()&&V.updateStartButtonState&&V.updateStartButtonState()}})}getCardLayouts(){const e={},t={};if(!A||!A.sessionId){for(let s=0;s<5;s++)e[String(s)]=null,t[String(s)]=null;return{handLayout:e,battlefieldLayout:t}}const r=A.sessionId,i=this.playerVisuals.get(r);for(let s=0;s<5;s++){const c=String(s);if(i&&i.hand.has(c)){const u=i.hand.get(c);e[c]=(u==null?void 0:u.getData("instanceId"))||null}else e[c]=null;if(i&&i.battlefield.has(c)){const u=i.battlefield.get(c);t[c]=(u==null?void 0:u.getData("instanceId"))||null}else t[c]=null}return{handLayout:e,battlefieldLayout:t}}isSlotEmpty(e,t,r,i){const s=this.playerVisuals.get(e);if(!s)return!1;const u=(t==="hand"?s.hand:s.battlefield).get(r);return u?u.getData("instanceId")===i:!0}isDroppedOnSellZone(e){return this.sellZone.visible?new Phaser.Geom.Rectangle(this.sellZone.x-this.sellZoneRect.width/2-20,this.sellZone.y-this.sellZoneRect.height/2-20,this.sellZoneRect.width+40,this.sellZoneRect.height+40).contains(e.x,e.y):!1}showBrewGain(e){this.brewGainText.setText(`+${e} `),this.brewGainText.setAlpha(1),this.brewGainText.y=-50,this.brewGainText.x=0,this.tweens.add({targets:this.brewGainText,scaleX:1.5,scaleY:1.5,duration:100,yoyo:!0,ease:"Cubic.easeOut",onComplete:()=>{this.tweens.add({targets:this.brewGainText,y:this.brewGainText.y-80,alpha:0,duration:1500,ease:"Power2"})}}),this.tweens.add({targets:this.sellZoneRect,fillAlpha:.7,duration:200,yoyo:!0,repeat:1,ease:"Cubic.easeOut"})}updateVisualMaps(e,t,r,i,s,c){const u=this.playerVisuals.get(e);if(!u)return;const v=t==="hand"?u.hand:u.battlefield;v.get(r)===c&&v.delete(r),(i==="hand"?u.hand:u.battlefield).set(s,c)}getPlayerCardGameObjects(e){const t=[],r=this.playerVisuals.get(e);return r&&(r.hand.forEach(i=>t.push(i)),r.battlefield.forEach(i=>t.push(i))),t}getLocalPlayerLayoutData(){const e=[];if(!A||!A.sessionId)return e;const t=A.sessionId,r=this.playerVisuals.get(t);return r&&(r.hand.forEach((i,s)=>{e.push({instanceId:i.getData("instanceId"),area:"hand",slotKey:i.getData("slotKey")})}),r.battlefield.forEach((i,s)=>{e.push({instanceId:i.getData("instanceId"),area:"battlefield",slotKey:i.getData("slotKey")})})),e}createSellZone(){this.sellZone=this.add.container(this.cameras.main.width-80,this.cameras.main.height/2),this.sellZone.setDepth(1e3),this.sellZoneRect=this.add.rectangle(0,0,120,160,16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1),this.sellZone.add(this.sellZoneRect),this.sellZoneText=this.add.text(0,0,"SELL",{fontFamily:"Arial Black",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.sellZone.add(this.sellZoneText),this.brewGainText=this.add.text(0,-50,"",{fontFamily:"Arial Black",fontSize:20,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setAlpha(0),this.sellZone.add(this.brewGainText);const e=this.add.text(0,50,`Drag cards here
to sell`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5);this.sellZone.add(e),this.input.on("dragenter",(t,r,i)=>{r instanceof Phaser.GameObjects.Container&&this.sellZone.visible&&this.isDroppedOnSellZone(r)&&(this.sellZoneRect.setFillStyle(16711680,.5),this.sellZoneRect.setStrokeStyle(3,16733525,1))}),this.input.on("dragleave",(t,r,i)=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.input.on("drop",()=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.sellZone.setVisible(!1)}updateNavbarText(){if(!A||!A.state||!this.playerHealthText||!this.playerHealthText.active)return;const e=A.sessionId,t=A.state.players.get(e);let r,i="Opponent: --";A.state.players.forEach((u,v)=>{v!==e&&(r=u,i=`Opponent: ${u.username||"Connecting..."}`)}),this.playerHealthText.setText(`You: ${(t==null?void 0:t.health)??"--"} HP`),this.playerBrewsText.setText(`Brews: ${(t==null?void 0:t.brews)??"--"}`),this.opponentUsernameText.setText(i),this.opponentHealthText.setText(`${(r==null?void 0:r.health)??"--"} HP`);const s=A.state.currentDay,c=A.state.currentPhase;this.dayPhaseText.setText(`Day ${s} - ${c}`)}cleanupListeners(){var e,t,r,i,s,c,u;console.log("BoardView: Cleaning up listeners."),this.listeners.forEach(v=>{if(typeof v=="function")try{v()}catch(g){console.warn("BoardView: Error cleaning up listener:",g)}}),this.listeners=[],this.cardSchemaListeners.forEach((v,g)=>{console.log(`BoardView cleanup: Cleaning up ${v.length} listeners for card instance ${g}`),v.forEach(p=>{if(typeof p=="function")try{p()}catch(y){console.warn(`BoardView: Error unsubscribing card listener for ${g}`,y)}})}),this.cardSchemaListeners.clear(),this.playerVisuals.forEach(v=>{v.hand.forEach(g=>g.destroy()),v.battlefield.forEach(g=>g.destroy())}),this.playerVisuals.clear(),(e=this.playerHealthText)==null||e.destroy(),(t=this.opponentHealthText)==null||t.destroy(),(r=this.playerBrewsText)==null||r.destroy(),(i=this.dayPhaseText)==null||i.destroy(),(s=this.opponentUsernameText)==null||s.destroy(),(c=this.sellZone)==null||c.destroy(),(u=this.brewGainText)==null||u.destroy(),this.input.off("dragenter"),this.input.off("dragleave"),this.input.off("drop")}shutdown(){console.log("BoardView shutting down..."),this.cleanupListeners(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}(async()=>(await ap(),new fa({type:Phaser.AUTO,parent:"gameParent",width:1280,height:720,backgroundColor:"#000000",roundPixels:!1,pixelArt:!1,scene:[cp,hp,fp,pp,gp,mp,yp,vp,up,dp]})))();
