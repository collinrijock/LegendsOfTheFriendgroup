import{P as gr,c as Na,g as Pa,p as cs}from"./phaser-B90dPXin.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();const et=class et{constructor(e){const t=e.width,i=e.height;et.width=t,et.height=i,et.center=new gr.Math.Vector2(t/2,i/2),et.isLandscape=et.width>et.height,et.gameZone=new gr.Geom.Rectangle(0,0,t,i),et.uiZone=new gr.Geom.Rectangle(0,0,t,i),et.cameras=new Set,e.callbacks={postBoot:()=>this.gameBootHandler()},this.game=new gr.Game(e)}gameBootHandler(){et.scaleManager=this.game.scale,et.scaleManager.on("resize",()=>this.onResizeHandler()),this.canvas=this.game.canvas,this.parent=this.canvas.parentElement,this.guide=document.getElementById("guide"),window.setTimeout(()=>this.onResizeHandler(),16)}onResizeHandler(){const e=this.parent.getBoundingClientRect(),t=this.canvas.getBoundingClientRect(),i=this.guide.getBoundingClientRect(),a=e.width/et.width,l=e.height/et.height,u=Math.max(a,l),d=e.width-a,E=e.height-l,g=d*(1/u),y=E*(1/u),p=et.width/2-g/2,I=et.width/2+g/2,F=et.height/2-y/2,J=et.height/2+y/2;et.uiZone.left=p,et.uiZone.right=I,et.uiZone.top=F,et.uiZone.bottom=J;const z=i.width/t.width,W=i.height/t.height,he=Math.min(z,W);et.scaleFactor=he,et.cameras.forEach(ne=>{ne.zoom=he}),this.game.events.emit(et.RESIZE)}static addCamera(e){this.cameras.add(e),e.zoom=et.scaleFactor}static removeCamera(e){this.cameras.delete(e)}static getX(e){if(typeof e=="number")return e;const t=this.scaleManager.width,i=parseInt(e,10);return t*(i/100)}static getY(e){if(typeof e=="number")return e;const t=this.scaleManager.height,i=parseInt(e,10);return t*(i/100)}static getUIX(e){if(typeof e=="number")return e;const t=et.uiZone.width,i=parseInt(e,10);return t*(i/100)}static getUIY(e){if(typeof e=="number")return e;const t=et.uiZone.height,i=parseInt(e,10);return t*(i/100)}};et.scaleFactor=1,et.scaleFactor2=1,et.RESIZE="scaleflowresize";let ma=et;var mr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ca(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ho={exports:{}};(function(s){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function a(E,g,y){this.fn=E,this.context=g,this.once=y||!1}function l(E,g,y,p,I){if(typeof y!="function")throw new TypeError("The listener must be a function");var F=new a(y,p||E,I),J=t?t+g:g;return E._events[J]?E._events[J].fn?E._events[J]=[E._events[J],F]:E._events[J].push(F):(E._events[J]=F,E._eventsCount++),E}function u(E,g){--E._eventsCount===0?E._events=new i:delete E._events[g]}function d(){this._events=new i,this._eventsCount=0}d.prototype.eventNames=function(){var g=[],y,p;if(this._eventsCount===0)return g;for(p in y=this._events)e.call(y,p)&&g.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(y)):g},d.prototype.listeners=function(g){var y=t?t+g:g,p=this._events[y];if(!p)return[];if(p.fn)return[p.fn];for(var I=0,F=p.length,J=new Array(F);I<F;I++)J[I]=p[I].fn;return J},d.prototype.listenerCount=function(g){var y=t?t+g:g,p=this._events[y];return p?p.fn?1:p.length:0},d.prototype.emit=function(g,y,p,I,F,J){var z=t?t+g:g;if(!this._events[z])return!1;var W=this._events[z],he=arguments.length,ne,ue;if(W.fn){switch(W.once&&this.removeListener(g,W.fn,void 0,!0),he){case 1:return W.fn.call(W.context),!0;case 2:return W.fn.call(W.context,y),!0;case 3:return W.fn.call(W.context,y,p),!0;case 4:return W.fn.call(W.context,y,p,I),!0;case 5:return W.fn.call(W.context,y,p,I,F),!0;case 6:return W.fn.call(W.context,y,p,I,F,J),!0}for(ue=1,ne=new Array(he-1);ue<he;ue++)ne[ue-1]=arguments[ue];W.fn.apply(W.context,ne)}else{var Pe=W.length,We;for(ue=0;ue<Pe;ue++)switch(W[ue].once&&this.removeListener(g,W[ue].fn,void 0,!0),he){case 1:W[ue].fn.call(W[ue].context);break;case 2:W[ue].fn.call(W[ue].context,y);break;case 3:W[ue].fn.call(W[ue].context,y,p);break;case 4:W[ue].fn.call(W[ue].context,y,p,I);break;default:if(!ne)for(We=1,ne=new Array(he-1);We<he;We++)ne[We-1]=arguments[We];W[ue].fn.apply(W[ue].context,ne)}}return!0},d.prototype.on=function(g,y,p){return l(this,g,y,p,!1)},d.prototype.once=function(g,y,p){return l(this,g,y,p,!0)},d.prototype.removeListener=function(g,y,p,I){var F=t?t+g:g;if(!this._events[F])return this;if(!y)return u(this,F),this;var J=this._events[F];if(J.fn)J.fn===y&&(!I||J.once)&&(!p||J.context===p)&&u(this,F);else{for(var z=0,W=[],he=J.length;z<he;z++)(J[z].fn!==y||I&&!J[z].once||p&&J[z].context!==p)&&W.push(J[z]);W.length?this._events[F]=W.length===1?W[0]:W:u(this,F)}return this},d.prototype.removeAllListeners=function(g){var y;return g?(y=t?t+g:g,this._events[y]&&u(this,y)):(this._events=new i,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=t,d.EventEmitter=d,s.exports=d})(Ho);var Uc=Ho.exports,Go=Ca(Uc),Xe;(function(s){s.assertEqual=a=>a;function e(a){}s.assertIs=e;function t(a){throw new Error}s.assertNever=t,s.arrayToEnum=a=>{const l={};for(const u of a)l[u]=u;return l},s.getValidEnumValues=a=>{const l=s.objectKeys(a).filter(d=>typeof a[a[d]]!="number"),u={};for(const d of l)u[d]=a[d];return s.objectValues(u)},s.objectValues=a=>s.objectKeys(a).map(function(l){return a[l]}),s.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const l=[];for(const u in a)Object.prototype.hasOwnProperty.call(a,u)&&l.push(u);return l},s.find=(a,l)=>{for(const u of a)if(l(u))return u},s.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function i(a,l=" | "){return a.map(u=>typeof u=="string"?`'${u}'`:u).join(l)}s.joinValues=i,s.jsonStringifyReplacer=(a,l)=>typeof l=="bigint"?l.toString():l})(Xe||(Xe={}));var ya;(function(s){s.mergeShapes=(e,t)=>({...e,...t})})(ya||(ya={}));const de=Xe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rs=s=>{switch(typeof s){case"undefined":return de.undefined;case"string":return de.string;case"number":return isNaN(s)?de.nan:de.number;case"boolean":return de.boolean;case"function":return de.function;case"bigint":return de.bigint;case"symbol":return de.symbol;case"object":return Array.isArray(s)?de.array:s===null?de.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?de.promise:typeof Map<"u"&&s instanceof Map?de.map:typeof Set<"u"&&s instanceof Set?de.set:typeof Date<"u"&&s instanceof Date?de.date:de.object;default:return de.unknown}},se=Xe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Fc=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:");class Sn extends Error{constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(l){return l.message},i={_errors:[]},a=l=>{for(const u of l.issues)if(u.code==="invalid_union")u.unionErrors.map(a);else if(u.code==="invalid_return_type")a(u.returnTypeError);else if(u.code==="invalid_arguments")a(u.argumentsError);else if(u.path.length===0)i._errors.push(t(u));else{let d=i,E=0;for(;E<u.path.length;){const g=u.path[E];E===u.path.length-1?(d[g]=d[g]||{_errors:[]},d[g]._errors.push(t(u))):d[g]=d[g]||{_errors:[]},d=d[g],E++}}};return a(this),i}static assert(e){if(!(e instanceof Sn))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Xe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},i=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):i.push(e(a));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}Sn.create=s=>new Sn(s);const _i=(s,e)=>{let t;switch(s.code){case se.invalid_type:s.received===de.undefined?t="Required":t=`Expected ${s.expected}, received ${s.received}`;break;case se.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(s.expected,Xe.jsonStringifyReplacer)}`;break;case se.unrecognized_keys:t=`Unrecognized key(s) in object: ${Xe.joinValues(s.keys,", ")}`;break;case se.invalid_union:t="Invalid input";break;case se.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Xe.joinValues(s.options)}`;break;case se.invalid_enum_value:t=`Invalid enum value. Expected ${Xe.joinValues(s.options)}, received '${s.received}'`;break;case se.invalid_arguments:t="Invalid function arguments";break;case se.invalid_return_type:t="Invalid function return type";break;case se.invalid_date:t="Invalid date";break;case se.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(t=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?t=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?t=`Invalid input: must end with "${s.validation.endsWith}"`:Xe.assertNever(s.validation):s.validation!=="regex"?t=`Invalid ${s.validation}`:t="Invalid";break;case se.too_small:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:t="Invalid input";break;case se.too_big:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?t=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:t="Invalid input";break;case se.custom:t="Invalid input";break;case se.invalid_intersection_types:t="Intersection results could not be merged";break;case se.not_multiple_of:t=`Number must be a multiple of ${s.multipleOf}`;break;case se.not_finite:t="Number must be finite";break;default:t=e.defaultError,Xe.assertNever(s)}return{message:t}};let Zo=_i;function Vc(s){Zo=s}function Or(){return Zo}const xr=s=>{const{data:e,path:t,errorMaps:i,issueData:a}=s,l=[...t,...a.path||[]],u={...a,path:l};if(a.message!==void 0)return{...a,path:l,message:a.message};let d="";const E=i.filter(g=>!!g).slice().reverse();for(const g of E)d=g(u,{data:e,defaultError:d}).message;return{...a,path:l,message:d}},jc=[];function fe(s,e){const t=Or(),i=xr({issueData:e,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,t,t===_i?void 0:_i].filter(a=>!!a)});s.common.issues.push(i)}class qt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const i=[];for(const a of t){if(a.status==="aborted")return Ce;a.status==="dirty"&&e.dirty(),i.push(a.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){const i=[];for(const a of t){const l=await a.key,u=await a.value;i.push({key:l,value:u})}return qt.mergeObjectSync(e,i)}static mergeObjectSync(e,t){const i={};for(const a of t){const{key:l,value:u}=a;if(l.status==="aborted"||u.status==="aborted")return Ce;l.status==="dirty"&&e.dirty(),u.status==="dirty"&&e.dirty(),l.value!=="__proto__"&&(typeof u.value<"u"||a.alwaysSet)&&(i[l.value]=u.value)}return{status:e.value,value:i}}}const Ce=Object.freeze({status:"aborted"}),Ei=s=>({status:"dirty",value:s}),fn=s=>({status:"valid",value:s}),ba=s=>s.status==="aborted",Ea=s=>s.status==="dirty",Gi=s=>s.status==="valid",Zi=s=>typeof Promise<"u"&&s instanceof Promise;function Dr(s,e,t,i){if(typeof e=="function"?s!==e||!i:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(s)}function zo(s,e,t,i,a){if(typeof e=="function"?s!==e||!a:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t}var ve;(function(s){s.errToObj=e=>typeof e=="string"?{message:e}:e||{},s.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ve||(ve={}));var Vi,ji;class as{constructor(e,t,i,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const co=(s,e)=>{if(Gi(e))return{success:!0,data:e.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Sn(s.common.issues);return this._error=t,this._error}}};function Me(s){if(!s)return{};const{errorMap:e,invalid_type_error:t,required_error:i,description:a}=s;if(e&&(t||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(u,d)=>{var E,g;const{message:y}=s;return u.code==="invalid_enum_value"?{message:y??d.defaultError}:typeof d.data>"u"?{message:(E=y??i)!==null&&E!==void 0?E:d.defaultError}:u.code!=="invalid_type"?{message:d.defaultError}:{message:(g=y??t)!==null&&g!==void 0?g:d.defaultError}},description:a}}class Ue{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Rs(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Rs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new qt,ctx:{common:e.parent.common,data:e.data,parsedType:Rs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Zi(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){var i;const a={common:{issues:[],async:(i=t==null?void 0:t.async)!==null&&i!==void 0?i:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rs(e)},l=this._parseSync({data:e,path:a.path,parent:a});return co(a,l)}async parseAsync(e,t){const i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){const i={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rs(e)},a=this._parse({data:e,path:i.path,parent:i}),l=await(Zi(a)?a:Promise.resolve(a));return co(i,l)}refine(e,t){const i=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,l)=>{const u=e(a),d=()=>l.addIssue({code:se.custom,...i(a)});return typeof Promise<"u"&&u instanceof Promise?u.then(E=>E?!0:(d(),!1)):u?!0:(d(),!1)})}refinement(e,t){return this._refinement((i,a)=>e(i)?!0:(a.addIssue(typeof t=="function"?t(i,a):t),!1))}_refinement(e){return new Hn({schema:this,typeName:Ne.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return rs.create(this,this._def)}nullable(){return Us.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Vn.create(this,this._def)}promise(){return Ti.create(this,this._def)}or(e){return qi.create([this,e],this._def)}and(e){return Yi.create(this,e,this._def)}transform(e){return new Hn({...Me(this._def),schema:this,typeName:Ne.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new tr({...Me(this._def),innerType:this,defaultValue:t,typeName:Ne.ZodDefault})}brand(){return new La({typeName:Ne.ZodBranded,type:this,...Me(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new nr({...Me(this._def),innerType:this,catchValue:t,typeName:Ne.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ar.create(this,e)}readonly(){return sr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Hc=/^c[^\s-]{8,}$/i,Gc=/^[0-9a-z]+$/,Zc=/^[0-9A-HJKMNP-TV-Z]{26}$/,zc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Wc=/^[a-z0-9_-]{21}$/i,Kc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,qc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Yc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let sa;const Xc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Jc=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Qc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Wo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ef=new RegExp(`^${Wo}$`);function Ko(s){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return s.precision?e=`${e}\\.\\d{${s.precision}}`:s.precision==null&&(e=`${e}(\\.\\d+)?`),e}function tf(s){return new RegExp(`^${Ko(s)}$`)}function qo(s){let e=`${Wo}T${Ko(s)}`;const t=[];return t.push(s.local?"Z?":"Z"),s.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function nf(s,e){return!!((e==="v4"||!e)&&Xc.test(s)||(e==="v6"||!e)&&Jc.test(s))}class Fn extends Ue{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==de.string){const l=this._getOrReturnCtx(e);return fe(l,{code:se.invalid_type,expected:de.string,received:l.parsedType}),Ce}const i=new qt;let a;for(const l of this._def.checks)if(l.kind==="min")e.data.length<l.value&&(a=this._getOrReturnCtx(e,a),fe(a,{code:se.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),i.dirty());else if(l.kind==="max")e.data.length>l.value&&(a=this._getOrReturnCtx(e,a),fe(a,{code:se.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),i.dirty());else if(l.kind==="length"){const u=e.data.length>l.value,d=e.data.length<l.value;(u||d)&&(a=this._getOrReturnCtx(e,a),u?fe(a,{code:se.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):d&&fe(a,{code:se.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),i.dirty())}else if(l.kind==="email")qc.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"email",code:se.invalid_string,message:l.message}),i.dirty());else if(l.kind==="emoji")sa||(sa=new RegExp(Yc,"u")),sa.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"emoji",code:se.invalid_string,message:l.message}),i.dirty());else if(l.kind==="uuid")zc.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"uuid",code:se.invalid_string,message:l.message}),i.dirty());else if(l.kind==="nanoid")Wc.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"nanoid",code:se.invalid_string,message:l.message}),i.dirty());else if(l.kind==="cuid")Hc.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"cuid",code:se.invalid_string,message:l.message}),i.dirty());else if(l.kind==="cuid2")Gc.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"cuid2",code:se.invalid_string,message:l.message}),i.dirty());else if(l.kind==="ulid")Zc.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"ulid",code:se.invalid_string,message:l.message}),i.dirty());else if(l.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),fe(a,{validation:"url",code:se.invalid_string,message:l.message}),i.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"regex",code:se.invalid_string,message:l.message}),i.dirty())):l.kind==="trim"?e.data=e.data.trim():l.kind==="includes"?e.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(e,a),fe(a,{code:se.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),i.dirty()):l.kind==="toLowerCase"?e.data=e.data.toLowerCase():l.kind==="toUpperCase"?e.data=e.data.toUpperCase():l.kind==="startsWith"?e.data.startsWith(l.value)||(a=this._getOrReturnCtx(e,a),fe(a,{code:se.invalid_string,validation:{startsWith:l.value},message:l.message}),i.dirty()):l.kind==="endsWith"?e.data.endsWith(l.value)||(a=this._getOrReturnCtx(e,a),fe(a,{code:se.invalid_string,validation:{endsWith:l.value},message:l.message}),i.dirty()):l.kind==="datetime"?qo(l).test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{code:se.invalid_string,validation:"datetime",message:l.message}),i.dirty()):l.kind==="date"?ef.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{code:se.invalid_string,validation:"date",message:l.message}),i.dirty()):l.kind==="time"?tf(l).test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{code:se.invalid_string,validation:"time",message:l.message}),i.dirty()):l.kind==="duration"?Kc.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"duration",code:se.invalid_string,message:l.message}),i.dirty()):l.kind==="ip"?nf(e.data,l.version)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"ip",code:se.invalid_string,message:l.message}),i.dirty()):l.kind==="base64"?Qc.test(e.data)||(a=this._getOrReturnCtx(e,a),fe(a,{validation:"base64",code:se.invalid_string,message:l.message}),i.dirty()):Xe.assertNever(l);return{status:i.value,value:e.data}}_regex(e,t,i){return this.refinement(a=>e.test(a),{validation:t,code:se.invalid_string,...ve.errToObj(i)})}_addCheck(e){return new Fn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ve.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ve.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ve.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ve.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ve.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ve.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ve.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ve.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ve.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ve.errToObj(e)})}datetime(e){var t,i;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(i=e==null?void 0:e.local)!==null&&i!==void 0?i:!1,...ve.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ve.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ve.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ve.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...ve.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ve.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ve.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ve.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ve.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ve.errToObj(t)})}nonempty(e){return this.min(1,ve.errToObj(e))}trim(){return new Fn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Fn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Fn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Fn.create=s=>{var e;return new Fn({checks:[],typeName:Ne.ZodString,coerce:(e=s==null?void 0:s.coerce)!==null&&e!==void 0?e:!1,...Me(s)})};function sf(s,e){const t=(s.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,a=t>i?t:i,l=parseInt(s.toFixed(a).replace(".","")),u=parseInt(e.toFixed(a).replace(".",""));return l%u/Math.pow(10,a)}class Bs extends Ue{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==de.number){const l=this._getOrReturnCtx(e);return fe(l,{code:se.invalid_type,expected:de.number,received:l.parsedType}),Ce}let i;const a=new qt;for(const l of this._def.checks)l.kind==="int"?Xe.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),fe(i,{code:se.invalid_type,expected:"integer",received:"float",message:l.message}),a.dirty()):l.kind==="min"?(l.inclusive?e.data<l.value:e.data<=l.value)&&(i=this._getOrReturnCtx(e,i),fe(i,{code:se.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?e.data>l.value:e.data>=l.value)&&(i=this._getOrReturnCtx(e,i),fe(i,{code:se.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="multipleOf"?sf(e.data,l.value)!==0&&(i=this._getOrReturnCtx(e,i),fe(i,{code:se.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):l.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),fe(i,{code:se.not_finite,message:l.message}),a.dirty()):Xe.assertNever(l);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ve.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ve.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ve.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ve.toString(t))}setLimit(e,t,i,a){return new Bs({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:ve.toString(a)}]})}_addCheck(e){return new Bs({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ve.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ve.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ve.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ve.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ve.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ve.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ve.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ve.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ve.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Xe.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(t===null||i.value>t)&&(t=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Bs.create=s=>new Bs({checks:[],typeName:Ne.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...Me(s)});class $s extends Ue{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==de.bigint){const l=this._getOrReturnCtx(e);return fe(l,{code:se.invalid_type,expected:de.bigint,received:l.parsedType}),Ce}let i;const a=new qt;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?e.data<l.value:e.data<=l.value)&&(i=this._getOrReturnCtx(e,i),fe(i,{code:se.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?e.data>l.value:e.data>=l.value)&&(i=this._getOrReturnCtx(e,i),fe(i,{code:se.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="multipleOf"?e.data%l.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),fe(i,{code:se.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):Xe.assertNever(l);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ve.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ve.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ve.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ve.toString(t))}setLimit(e,t,i,a){return new $s({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:ve.toString(a)}]})}_addCheck(e){return new $s({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ve.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ve.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ve.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ve.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ve.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}$s.create=s=>{var e;return new $s({checks:[],typeName:Ne.ZodBigInt,coerce:(e=s==null?void 0:s.coerce)!==null&&e!==void 0?e:!1,...Me(s)})};class zi extends Ue{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==de.boolean){const i=this._getOrReturnCtx(e);return fe(i,{code:se.invalid_type,expected:de.boolean,received:i.parsedType}),Ce}return fn(e.data)}}zi.create=s=>new zi({typeName:Ne.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...Me(s)});class hi extends Ue{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==de.date){const l=this._getOrReturnCtx(e);return fe(l,{code:se.invalid_type,expected:de.date,received:l.parsedType}),Ce}if(isNaN(e.data.getTime())){const l=this._getOrReturnCtx(e);return fe(l,{code:se.invalid_date}),Ce}const i=new qt;let a;for(const l of this._def.checks)l.kind==="min"?e.data.getTime()<l.value&&(a=this._getOrReturnCtx(e,a),fe(a,{code:se.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),i.dirty()):l.kind==="max"?e.data.getTime()>l.value&&(a=this._getOrReturnCtx(e,a),fe(a,{code:se.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),i.dirty()):Xe.assertNever(l);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new hi({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ve.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ve.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}hi.create=s=>new hi({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:Ne.ZodDate,...Me(s)});class Rr extends Ue{_parse(e){if(this._getType(e)!==de.symbol){const i=this._getOrReturnCtx(e);return fe(i,{code:se.invalid_type,expected:de.symbol,received:i.parsedType}),Ce}return fn(e.data)}}Rr.create=s=>new Rr({typeName:Ne.ZodSymbol,...Me(s)});class Wi extends Ue{_parse(e){if(this._getType(e)!==de.undefined){const i=this._getOrReturnCtx(e);return fe(i,{code:se.invalid_type,expected:de.undefined,received:i.parsedType}),Ce}return fn(e.data)}}Wi.create=s=>new Wi({typeName:Ne.ZodUndefined,...Me(s)});class Ki extends Ue{_parse(e){if(this._getType(e)!==de.null){const i=this._getOrReturnCtx(e);return fe(i,{code:se.invalid_type,expected:de.null,received:i.parsedType}),Ce}return fn(e.data)}}Ki.create=s=>new Ki({typeName:Ne.ZodNull,...Me(s)});class wi extends Ue{constructor(){super(...arguments),this._any=!0}_parse(e){return fn(e.data)}}wi.create=s=>new wi({typeName:Ne.ZodAny,...Me(s)});class ui extends Ue{constructor(){super(...arguments),this._unknown=!0}_parse(e){return fn(e.data)}}ui.create=s=>new ui({typeName:Ne.ZodUnknown,...Me(s)});class Ts extends Ue{_parse(e){const t=this._getOrReturnCtx(e);return fe(t,{code:se.invalid_type,expected:de.never,received:t.parsedType}),Ce}}Ts.create=s=>new Ts({typeName:Ne.ZodNever,...Me(s)});class Nr extends Ue{_parse(e){if(this._getType(e)!==de.undefined){const i=this._getOrReturnCtx(e);return fe(i,{code:se.invalid_type,expected:de.void,received:i.parsedType}),Ce}return fn(e.data)}}Nr.create=s=>new Nr({typeName:Ne.ZodVoid,...Me(s)});class Vn extends Ue{_parse(e){const{ctx:t,status:i}=this._processInputParams(e),a=this._def;if(t.parsedType!==de.array)return fe(t,{code:se.invalid_type,expected:de.array,received:t.parsedType}),Ce;if(a.exactLength!==null){const u=t.data.length>a.exactLength.value,d=t.data.length<a.exactLength.value;(u||d)&&(fe(t,{code:u?se.too_big:se.too_small,minimum:d?a.exactLength.value:void 0,maximum:u?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),i.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(fe(t,{code:se.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),i.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(fe(t,{code:se.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),i.dirty()),t.common.async)return Promise.all([...t.data].map((u,d)=>a.type._parseAsync(new as(t,u,t.path,d)))).then(u=>qt.mergeArray(i,u));const l=[...t.data].map((u,d)=>a.type._parseSync(new as(t,u,t.path,d)));return qt.mergeArray(i,l)}get element(){return this._def.type}min(e,t){return new Vn({...this._def,minLength:{value:e,message:ve.toString(t)}})}max(e,t){return new Vn({...this._def,maxLength:{value:e,message:ve.toString(t)}})}length(e,t){return new Vn({...this._def,exactLength:{value:e,message:ve.toString(t)}})}nonempty(e){return this.min(1,e)}}Vn.create=(s,e)=>new Vn({type:s,minLength:null,maxLength:null,exactLength:null,typeName:Ne.ZodArray,...Me(e)});function bi(s){if(s instanceof _t){const e={};for(const t in s.shape){const i=s.shape[t];e[t]=rs.create(bi(i))}return new _t({...s._def,shape:()=>e})}else return s instanceof Vn?new Vn({...s._def,type:bi(s.element)}):s instanceof rs?rs.create(bi(s.unwrap())):s instanceof Us?Us.create(bi(s.unwrap())):s instanceof os?os.create(s.items.map(e=>bi(e))):s}class _t extends Ue{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Xe.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==de.object){const g=this._getOrReturnCtx(e);return fe(g,{code:se.invalid_type,expected:de.object,received:g.parsedType}),Ce}const{status:i,ctx:a}=this._processInputParams(e),{shape:l,keys:u}=this._getCached(),d=[];if(!(this._def.catchall instanceof Ts&&this._def.unknownKeys==="strip"))for(const g in a.data)u.includes(g)||d.push(g);const E=[];for(const g of u){const y=l[g],p=a.data[g];E.push({key:{status:"valid",value:g},value:y._parse(new as(a,p,a.path,g)),alwaysSet:g in a.data})}if(this._def.catchall instanceof Ts){const g=this._def.unknownKeys;if(g==="passthrough")for(const y of d)E.push({key:{status:"valid",value:y},value:{status:"valid",value:a.data[y]}});else if(g==="strict")d.length>0&&(fe(a,{code:se.unrecognized_keys,keys:d}),i.dirty());else if(g!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const g=this._def.catchall;for(const y of d){const p=a.data[y];E.push({key:{status:"valid",value:y},value:g._parse(new as(a,p,a.path,y)),alwaysSet:y in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const g=[];for(const y of E){const p=await y.key,I=await y.value;g.push({key:p,value:I,alwaysSet:y.alwaysSet})}return g}).then(g=>qt.mergeObjectSync(i,g)):qt.mergeObjectSync(i,E)}get shape(){return this._def.shape()}strict(e){return ve.errToObj,new _t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,i)=>{var a,l,u,d;const E=(u=(l=(a=this._def).errorMap)===null||l===void 0?void 0:l.call(a,t,i).message)!==null&&u!==void 0?u:i.defaultError;return t.code==="unrecognized_keys"?{message:(d=ve.errToObj(e).message)!==null&&d!==void 0?d:E}:{message:E}}}:{}})}strip(){return new _t({...this._def,unknownKeys:"strip"})}passthrough(){return new _t({...this._def,unknownKeys:"passthrough"})}extend(e){return new _t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new _t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ne.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new _t({...this._def,catchall:e})}pick(e){const t={};return Xe.objectKeys(e).forEach(i=>{e[i]&&this.shape[i]&&(t[i]=this.shape[i])}),new _t({...this._def,shape:()=>t})}omit(e){const t={};return Xe.objectKeys(this.shape).forEach(i=>{e[i]||(t[i]=this.shape[i])}),new _t({...this._def,shape:()=>t})}deepPartial(){return bi(this)}partial(e){const t={};return Xe.objectKeys(this.shape).forEach(i=>{const a=this.shape[i];e&&!e[i]?t[i]=a:t[i]=a.optional()}),new _t({...this._def,shape:()=>t})}required(e){const t={};return Xe.objectKeys(this.shape).forEach(i=>{if(e&&!e[i])t[i]=this.shape[i];else{let l=this.shape[i];for(;l instanceof rs;)l=l._def.innerType;t[i]=l}}),new _t({...this._def,shape:()=>t})}keyof(){return Yo(Xe.objectKeys(this.shape))}}_t.create=(s,e)=>new _t({shape:()=>s,unknownKeys:"strip",catchall:Ts.create(),typeName:Ne.ZodObject,...Me(e)});_t.strictCreate=(s,e)=>new _t({shape:()=>s,unknownKeys:"strict",catchall:Ts.create(),typeName:Ne.ZodObject,...Me(e)});_t.lazycreate=(s,e)=>new _t({shape:s,unknownKeys:"strip",catchall:Ts.create(),typeName:Ne.ZodObject,...Me(e)});class qi extends Ue{_parse(e){const{ctx:t}=this._processInputParams(e),i=this._def.options;function a(l){for(const d of l)if(d.result.status==="valid")return d.result;for(const d of l)if(d.result.status==="dirty")return t.common.issues.push(...d.ctx.common.issues),d.result;const u=l.map(d=>new Sn(d.ctx.common.issues));return fe(t,{code:se.invalid_union,unionErrors:u}),Ce}if(t.common.async)return Promise.all(i.map(async l=>{const u={...t,common:{...t.common,issues:[]},parent:null};return{result:await l._parseAsync({data:t.data,path:t.path,parent:u}),ctx:u}})).then(a);{let l;const u=[];for(const E of i){const g={...t,common:{...t.common,issues:[]},parent:null},y=E._parseSync({data:t.data,path:t.path,parent:g});if(y.status==="valid")return y;y.status==="dirty"&&!l&&(l={result:y,ctx:g}),g.common.issues.length&&u.push(g.common.issues)}if(l)return t.common.issues.push(...l.ctx.common.issues),l.result;const d=u.map(E=>new Sn(E));return fe(t,{code:se.invalid_union,unionErrors:d}),Ce}}get options(){return this._def.options}}qi.create=(s,e)=>new qi({options:s,typeName:Ne.ZodUnion,...Me(e)});const bs=s=>s instanceof Ji?bs(s.schema):s instanceof Hn?bs(s.innerType()):s instanceof Qi?[s.value]:s instanceof Ms?s.options:s instanceof er?Xe.objectValues(s.enum):s instanceof tr?bs(s._def.innerType):s instanceof Wi?[void 0]:s instanceof Ki?[null]:s instanceof rs?[void 0,...bs(s.unwrap())]:s instanceof Us?[null,...bs(s.unwrap())]:s instanceof La||s instanceof sr?bs(s.unwrap()):s instanceof nr?bs(s._def.innerType):[];class Fr extends Ue{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==de.object)return fe(t,{code:se.invalid_type,expected:de.object,received:t.parsedType}),Ce;const i=this.discriminator,a=t.data[i],l=this.optionsMap.get(a);return l?t.common.async?l._parseAsync({data:t.data,path:t.path,parent:t}):l._parseSync({data:t.data,path:t.path,parent:t}):(fe(t,{code:se.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),Ce)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,i){const a=new Map;for(const l of t){const u=bs(l.shape[e]);if(!u.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const d of u){if(a.has(d))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(d)}`);a.set(d,l)}}return new Fr({typeName:Ne.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...Me(i)})}}function va(s,e){const t=Rs(s),i=Rs(e);if(s===e)return{valid:!0,data:s};if(t===de.object&&i===de.object){const a=Xe.objectKeys(e),l=Xe.objectKeys(s).filter(d=>a.indexOf(d)!==-1),u={...s,...e};for(const d of l){const E=va(s[d],e[d]);if(!E.valid)return{valid:!1};u[d]=E.data}return{valid:!0,data:u}}else if(t===de.array&&i===de.array){if(s.length!==e.length)return{valid:!1};const a=[];for(let l=0;l<s.length;l++){const u=s[l],d=e[l],E=va(u,d);if(!E.valid)return{valid:!1};a.push(E.data)}return{valid:!0,data:a}}else return t===de.date&&i===de.date&&+s==+e?{valid:!0,data:s}:{valid:!1}}class Yi extends Ue{_parse(e){const{status:t,ctx:i}=this._processInputParams(e),a=(l,u)=>{if(ba(l)||ba(u))return Ce;const d=va(l.value,u.value);return d.valid?((Ea(l)||Ea(u))&&t.dirty(),{status:t.value,value:d.data}):(fe(i,{code:se.invalid_intersection_types}),Ce)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([l,u])=>a(l,u)):a(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}Yi.create=(s,e,t)=>new Yi({left:s,right:e,typeName:Ne.ZodIntersection,...Me(t)});class os extends Ue{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==de.array)return fe(i,{code:se.invalid_type,expected:de.array,received:i.parsedType}),Ce;if(i.data.length<this._def.items.length)return fe(i,{code:se.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ce;!this._def.rest&&i.data.length>this._def.items.length&&(fe(i,{code:se.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const l=[...i.data].map((u,d)=>{const E=this._def.items[d]||this._def.rest;return E?E._parse(new as(i,u,i.path,d)):null}).filter(u=>!!u);return i.common.async?Promise.all(l).then(u=>qt.mergeArray(t,u)):qt.mergeArray(t,l)}get items(){return this._def.items}rest(e){return new os({...this._def,rest:e})}}os.create=(s,e)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new os({items:s,typeName:Ne.ZodTuple,rest:null,...Me(e)})};class Xi extends Ue{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==de.object)return fe(i,{code:se.invalid_type,expected:de.object,received:i.parsedType}),Ce;const a=[],l=this._def.keyType,u=this._def.valueType;for(const d in i.data)a.push({key:l._parse(new as(i,d,i.path,d)),value:u._parse(new as(i,i.data[d],i.path,d)),alwaysSet:d in i.data});return i.common.async?qt.mergeObjectAsync(t,a):qt.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,i){return t instanceof Ue?new Xi({keyType:e,valueType:t,typeName:Ne.ZodRecord,...Me(i)}):new Xi({keyType:Fn.create(),valueType:e,typeName:Ne.ZodRecord,...Me(t)})}}class Pr extends Ue{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==de.map)return fe(i,{code:se.invalid_type,expected:de.map,received:i.parsedType}),Ce;const a=this._def.keyType,l=this._def.valueType,u=[...i.data.entries()].map(([d,E],g)=>({key:a._parse(new as(i,d,i.path,[g,"key"])),value:l._parse(new as(i,E,i.path,[g,"value"]))}));if(i.common.async){const d=new Map;return Promise.resolve().then(async()=>{for(const E of u){const g=await E.key,y=await E.value;if(g.status==="aborted"||y.status==="aborted")return Ce;(g.status==="dirty"||y.status==="dirty")&&t.dirty(),d.set(g.value,y.value)}return{status:t.value,value:d}})}else{const d=new Map;for(const E of u){const g=E.key,y=E.value;if(g.status==="aborted"||y.status==="aborted")return Ce;(g.status==="dirty"||y.status==="dirty")&&t.dirty(),d.set(g.value,y.value)}return{status:t.value,value:d}}}}Pr.create=(s,e,t)=>new Pr({valueType:e,keyType:s,typeName:Ne.ZodMap,...Me(t)});class pi extends Ue{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==de.set)return fe(i,{code:se.invalid_type,expected:de.set,received:i.parsedType}),Ce;const a=this._def;a.minSize!==null&&i.data.size<a.minSize.value&&(fe(i,{code:se.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&i.data.size>a.maxSize.value&&(fe(i,{code:se.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const l=this._def.valueType;function u(E){const g=new Set;for(const y of E){if(y.status==="aborted")return Ce;y.status==="dirty"&&t.dirty(),g.add(y.value)}return{status:t.value,value:g}}const d=[...i.data.values()].map((E,g)=>l._parse(new as(i,E,i.path,g)));return i.common.async?Promise.all(d).then(E=>u(E)):u(d)}min(e,t){return new pi({...this._def,minSize:{value:e,message:ve.toString(t)}})}max(e,t){return new pi({...this._def,maxSize:{value:e,message:ve.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}pi.create=(s,e)=>new pi({valueType:s,minSize:null,maxSize:null,typeName:Ne.ZodSet,...Me(e)});class vi extends Ue{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==de.function)return fe(t,{code:se.invalid_type,expected:de.function,received:t.parsedType}),Ce;function i(d,E){return xr({data:d,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Or(),_i].filter(g=>!!g),issueData:{code:se.invalid_arguments,argumentsError:E}})}function a(d,E){return xr({data:d,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Or(),_i].filter(g=>!!g),issueData:{code:se.invalid_return_type,returnTypeError:E}})}const l={errorMap:t.common.contextualErrorMap},u=t.data;if(this._def.returns instanceof Ti){const d=this;return fn(async function(...E){const g=new Sn([]),y=await d._def.args.parseAsync(E,l).catch(F=>{throw g.addIssue(i(E,F)),g}),p=await Reflect.apply(u,this,y);return await d._def.returns._def.type.parseAsync(p,l).catch(F=>{throw g.addIssue(a(p,F)),g})})}else{const d=this;return fn(function(...E){const g=d._def.args.safeParse(E,l);if(!g.success)throw new Sn([i(E,g.error)]);const y=Reflect.apply(u,this,g.data),p=d._def.returns.safeParse(y,l);if(!p.success)throw new Sn([a(y,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new vi({...this._def,args:os.create(e).rest(ui.create())})}returns(e){return new vi({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,i){return new vi({args:e||os.create([]).rest(ui.create()),returns:t||ui.create(),typeName:Ne.ZodFunction,...Me(i)})}}class Ji extends Ue{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ji.create=(s,e)=>new Ji({getter:s,typeName:Ne.ZodLazy,...Me(e)});class Qi extends Ue{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return fe(t,{received:t.data,code:se.invalid_literal,expected:this._def.value}),Ce}return{status:"valid",value:e.data}}get value(){return this._def.value}}Qi.create=(s,e)=>new Qi({value:s,typeName:Ne.ZodLiteral,...Me(e)});function Yo(s,e){return new Ms({values:s,typeName:Ne.ZodEnum,...Me(e)})}class Ms extends Ue{constructor(){super(...arguments),Vi.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),i=this._def.values;return fe(t,{expected:Xe.joinValues(i),received:t.parsedType,code:se.invalid_type}),Ce}if(Dr(this,Vi)||zo(this,Vi,new Set(this._def.values)),!Dr(this,Vi).has(e.data)){const t=this._getOrReturnCtx(e),i=this._def.values;return fe(t,{received:t.data,code:se.invalid_enum_value,options:i}),Ce}return fn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ms.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ms.create(this.options.filter(i=>!e.includes(i)),{...this._def,...t})}}Vi=new WeakMap;Ms.create=Yo;class er extends Ue{constructor(){super(...arguments),ji.set(this,void 0)}_parse(e){const t=Xe.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==de.string&&i.parsedType!==de.number){const a=Xe.objectValues(t);return fe(i,{expected:Xe.joinValues(a),received:i.parsedType,code:se.invalid_type}),Ce}if(Dr(this,ji)||zo(this,ji,new Set(Xe.getValidEnumValues(this._def.values))),!Dr(this,ji).has(e.data)){const a=Xe.objectValues(t);return fe(i,{received:i.data,code:se.invalid_enum_value,options:a}),Ce}return fn(e.data)}get enum(){return this._def.values}}ji=new WeakMap;er.create=(s,e)=>new er({values:s,typeName:Ne.ZodNativeEnum,...Me(e)});class Ti extends Ue{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==de.promise&&t.common.async===!1)return fe(t,{code:se.invalid_type,expected:de.promise,received:t.parsedType}),Ce;const i=t.parsedType===de.promise?t.data:Promise.resolve(t.data);return fn(i.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ti.create=(s,e)=>new Ti({type:s,typeName:Ne.ZodPromise,...Me(e)});class Hn extends Ue{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ne.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:i}=this._processInputParams(e),a=this._def.effect||null,l={addIssue:u=>{fe(i,u),u.fatal?t.abort():t.dirty()},get path(){return i.path}};if(l.addIssue=l.addIssue.bind(l),a.type==="preprocess"){const u=a.transform(i.data,l);if(i.common.async)return Promise.resolve(u).then(async d=>{if(t.value==="aborted")return Ce;const E=await this._def.schema._parseAsync({data:d,path:i.path,parent:i});return E.status==="aborted"?Ce:E.status==="dirty"||t.value==="dirty"?Ei(E.value):E});{if(t.value==="aborted")return Ce;const d=this._def.schema._parseSync({data:u,path:i.path,parent:i});return d.status==="aborted"?Ce:d.status==="dirty"||t.value==="dirty"?Ei(d.value):d}}if(a.type==="refinement"){const u=d=>{const E=a.refinement(d,l);if(i.common.async)return Promise.resolve(E);if(E instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return d};if(i.common.async===!1){const d=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return d.status==="aborted"?Ce:(d.status==="dirty"&&t.dirty(),u(d.value),{status:t.value,value:d.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(d=>d.status==="aborted"?Ce:(d.status==="dirty"&&t.dirty(),u(d.value).then(()=>({status:t.value,value:d.value}))))}if(a.type==="transform")if(i.common.async===!1){const u=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Gi(u))return u;const d=a.transform(u.value,l);if(d instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:d}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(u=>Gi(u)?Promise.resolve(a.transform(u.value,l)).then(d=>({status:t.value,value:d})):u);Xe.assertNever(a)}}Hn.create=(s,e,t)=>new Hn({schema:s,typeName:Ne.ZodEffects,effect:e,...Me(t)});Hn.createWithPreprocess=(s,e,t)=>new Hn({schema:e,effect:{type:"preprocess",transform:s},typeName:Ne.ZodEffects,...Me(t)});class rs extends Ue{_parse(e){return this._getType(e)===de.undefined?fn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rs.create=(s,e)=>new rs({innerType:s,typeName:Ne.ZodOptional,...Me(e)});class Us extends Ue{_parse(e){return this._getType(e)===de.null?fn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Us.create=(s,e)=>new Us({innerType:s,typeName:Ne.ZodNullable,...Me(e)});class tr extends Ue{_parse(e){const{ctx:t}=this._processInputParams(e);let i=t.data;return t.parsedType===de.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}tr.create=(s,e)=>new tr({innerType:s,typeName:Ne.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Me(e)});class nr extends Ue{_parse(e){const{ctx:t}=this._processInputParams(e),i={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return Zi(a)?a.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new Sn(i.common.issues)},input:i.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Sn(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}nr.create=(s,e)=>new nr({innerType:s,typeName:Ne.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Me(e)});class Cr extends Ue{_parse(e){if(this._getType(e)!==de.nan){const i=this._getOrReturnCtx(e);return fe(i,{code:se.invalid_type,expected:de.nan,received:i.parsedType}),Ce}return{status:"valid",value:e.data}}}Cr.create=s=>new Cr({typeName:Ne.ZodNaN,...Me(s)});const rf=Symbol("zod_brand");class La extends Ue{_parse(e){const{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class ar extends Ue{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return l.status==="aborted"?Ce:l.status==="dirty"?(t.dirty(),Ei(l.value)):this._def.out._parseAsync({data:l.value,path:i.path,parent:i})})();{const a=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return a.status==="aborted"?Ce:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:i.path,parent:i})}}static create(e,t){return new ar({in:e,out:t,typeName:Ne.ZodPipeline})}}class sr extends Ue{_parse(e){const t=this._def.innerType._parse(e),i=a=>(Gi(a)&&(a.value=Object.freeze(a.value)),a);return Zi(t)?t.then(a=>i(a)):i(t)}unwrap(){return this._def.innerType}}sr.create=(s,e)=>new sr({innerType:s,typeName:Ne.ZodReadonly,...Me(e)});function ka(s,e={},t){return s?wi.create().superRefine((i,a)=>{var l,u;if(!s(i)){const d=typeof e=="function"?e(i):typeof e=="string"?{message:e}:e,E=(u=(l=d.fatal)!==null&&l!==void 0?l:t)!==null&&u!==void 0?u:!0,g=typeof d=="string"?{message:d}:d;a.addIssue({code:"custom",...g,fatal:E})}}):wi.create()}const af={object:_t.lazycreate};var Ne;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(Ne||(Ne={}));const of=(s,e={message:`Input not instance of ${s.name}`})=>ka(t=>t instanceof s,e),P=Fn.create,_e=Bs.create,lf=Cr.create,Xo=$s.create,Le=zi.create,cf=hi.create,ff=Rr.create,uf=Wi.create,Ba=Ki.create,df=wi.create,ir=ui.create,hf=Ts.create,pf=Nr.create,Ye=Vn.create,oe=_t.create,gf=_t.strictCreate,$a=qi.create,mf=Fr.create,yf=Yi.create,bf=os.create,Ef=Xi.create,vf=Pr.create,_f=pi.create,wf=vi.create,Tf=Ji.create,Bt=Qi.create,If=Ms.create,Ai=er.create,Sf=Ti.create,fo=Hn.create,Jo=rs.create,Af=Us.create,Qo=Hn.createWithPreprocess,Of=ar.create,xf=()=>P().optional(),Df=()=>_e().optional(),Rf=()=>Le().optional(),Nf={string:s=>Fn.create({...s,coerce:!0}),number:s=>Bs.create({...s,coerce:!0}),boolean:s=>zi.create({...s,coerce:!0}),bigint:s=>$s.create({...s,coerce:!0}),date:s=>hi.create({...s,coerce:!0})},Pf=Ce;var ye=Object.freeze({__proto__:null,defaultErrorMap:_i,setErrorMap:Vc,getErrorMap:Or,makeIssue:xr,EMPTY_PATH:jc,addIssueToContext:fe,ParseStatus:qt,INVALID:Ce,DIRTY:Ei,OK:fn,isAborted:ba,isDirty:Ea,isValid:Gi,isAsync:Zi,get util(){return Xe},get objectUtil(){return ya},ZodParsedType:de,getParsedType:Rs,ZodType:Ue,datetimeRegex:qo,ZodString:Fn,ZodNumber:Bs,ZodBigInt:$s,ZodBoolean:zi,ZodDate:hi,ZodSymbol:Rr,ZodUndefined:Wi,ZodNull:Ki,ZodAny:wi,ZodUnknown:ui,ZodNever:Ts,ZodVoid:Nr,ZodArray:Vn,ZodObject:_t,ZodUnion:qi,ZodDiscriminatedUnion:Fr,ZodIntersection:Yi,ZodTuple:os,ZodRecord:Xi,ZodMap:Pr,ZodSet:pi,ZodFunction:vi,ZodLazy:Ji,ZodLiteral:Qi,ZodEnum:Ms,ZodNativeEnum:er,ZodPromise:Ti,ZodEffects:Hn,ZodTransformer:Hn,ZodOptional:rs,ZodNullable:Us,ZodDefault:tr,ZodCatch:nr,ZodNaN:Cr,BRAND:rf,ZodBranded:La,ZodPipeline:ar,ZodReadonly:sr,custom:ka,Schema:Ue,ZodSchema:Ue,late:af,get ZodFirstPartyTypeKind(){return Ne},coerce:Nf,any:df,array:Ye,bigint:Xo,boolean:Le,date:cf,discriminatedUnion:mf,effect:fo,enum:If,function:wf,instanceof:of,intersection:yf,lazy:Tf,literal:Bt,map:vf,nan:lf,nativeEnum:Ai,never:hf,null:Ba,nullable:Af,number:_e,object:oe,oboolean:Rf,onumber:Df,optional:Jo,ostring:xf,pipeline:Of,preprocess:Qo,promise:Sf,record:Ef,set:_f,strictObject:gf,string:P,symbol:ff,transformer:fo,tuple:bf,undefined:uf,union:$a,unknown:ir,void:pf,NEVER:Pf,ZodIssueCode:se,quotelessJson:Fc,ZodError:Sn}),el={exports:{}};(function(s){var e=function(t){var i=1e7,a=7,l=9007199254740992,u=J(l),d="0123456789abcdefghijklmnopqrstuvwxyz",E=typeof BigInt=="function";function g(b,T,x,C){return typeof b>"u"?g[0]:typeof T<"u"?+T==10&&!x?Te(b):zt(b,T,x,C):Te(b)}function y(b,T){this.value=b,this.sign=T,this.isSmall=!1}y.prototype=Object.create(g.prototype);function p(b){this.value=b,this.sign=b<0,this.isSmall=!0}p.prototype=Object.create(g.prototype);function I(b){this.value=b}I.prototype=Object.create(g.prototype);function F(b){return-l<b&&b<l}function J(b){return b<1e7?[b]:b<1e14?[b%1e7,Math.floor(b/1e7)]:[b%1e7,Math.floor(b/1e7)%1e7,Math.floor(b/1e14)]}function z(b){W(b);var T=b.length;if(T<4&&we(b,u)<0)switch(T){case 0:return 0;case 1:return b[0];case 2:return b[0]+b[1]*i;default:return b[0]+(b[1]+b[2]*i)*i}return b}function W(b){for(var T=b.length;b[--T]===0;);b.length=T+1}function he(b){for(var T=new Array(b),x=-1;++x<b;)T[x]=0;return T}function ne(b){return b>0?Math.floor(b):Math.ceil(b)}function ue(b,T){var x=b.length,C=T.length,G=new Array(x),U=0,H=i,Y,Q;for(Q=0;Q<C;Q++)Y=b[Q]+T[Q]+U,U=Y>=H?1:0,G[Q]=Y-U*H;for(;Q<x;)Y=b[Q]+U,U=Y===H?1:0,G[Q++]=Y-U*H;return U>0&&G.push(U),G}function Pe(b,T){return b.length>=T.length?ue(b,T):ue(T,b)}function We(b,T){var x=b.length,C=new Array(x),G=i,U,H;for(H=0;H<x;H++)U=b[H]-G+T,T=Math.floor(U/G),C[H]=U-T*G,T+=1;for(;T>0;)C[H++]=T%G,T=Math.floor(T/G);return C}y.prototype.add=function(b){var T=Te(b);if(this.sign!==T.sign)return this.subtract(T.negate());var x=this.value,C=T.value;return T.isSmall?new y(We(x,Math.abs(C)),this.sign):new y(Pe(x,C),this.sign)},y.prototype.plus=y.prototype.add,p.prototype.add=function(b){var T=Te(b),x=this.value;if(x<0!==T.sign)return this.subtract(T.negate());var C=T.value;if(T.isSmall){if(F(x+C))return new p(x+C);C=J(Math.abs(C))}return new y(We(C,Math.abs(x)),x<0)},p.prototype.plus=p.prototype.add,I.prototype.add=function(b){return new I(this.value+Te(b).value)},I.prototype.plus=I.prototype.add;function Je(b,T){var x=b.length,C=T.length,G=new Array(x),U=0,H=i,Y,Q;for(Y=0;Y<C;Y++)Q=b[Y]-U-T[Y],Q<0?(Q+=H,U=1):U=0,G[Y]=Q;for(Y=C;Y<x;Y++){if(Q=b[Y]-U,Q<0)Q+=H;else{G[Y++]=Q;break}G[Y]=Q}for(;Y<x;Y++)G[Y]=b[Y];return W(G),G}function it(b,T,x){var C;return we(b,T)>=0?C=Je(b,T):(C=Je(T,b),x=!x),C=z(C),typeof C=="number"?(x&&(C=-C),new p(C)):new y(C,x)}function mt(b,T,x){var C=b.length,G=new Array(C),U=-T,H=i,Y,Q;for(Y=0;Y<C;Y++)Q=b[Y]+U,U=Math.floor(Q/H),Q%=H,G[Y]=Q<0?Q+H:Q;return G=z(G),typeof G=="number"?(x&&(G=-G),new p(G)):new y(G,x)}y.prototype.subtract=function(b){var T=Te(b);if(this.sign!==T.sign)return this.add(T.negate());var x=this.value,C=T.value;return T.isSmall?mt(x,Math.abs(C),this.sign):it(x,C,this.sign)},y.prototype.minus=y.prototype.subtract,p.prototype.subtract=function(b){var T=Te(b),x=this.value;if(x<0!==T.sign)return this.add(T.negate());var C=T.value;return T.isSmall?new p(x-C):mt(C,Math.abs(x),x>=0)},p.prototype.minus=p.prototype.subtract,I.prototype.subtract=function(b){return new I(this.value-Te(b).value)},I.prototype.minus=I.prototype.subtract,y.prototype.negate=function(){return new y(this.value,!this.sign)},p.prototype.negate=function(){var b=this.sign,T=new p(-this.value);return T.sign=!b,T},I.prototype.negate=function(){return new I(-this.value)},y.prototype.abs=function(){return new y(this.value,!1)},p.prototype.abs=function(){return new p(Math.abs(this.value))},I.prototype.abs=function(){return new I(this.value>=0?this.value:-this.value)};function at(b,T){var x=b.length,C=T.length,G=x+C,U=he(G),H=i,Y,Q,ce,De,Re;for(ce=0;ce<x;++ce){De=b[ce];for(var Ie=0;Ie<C;++Ie)Re=T[Ie],Y=De*Re+U[ce+Ie],Q=Math.floor(Y/H),U[ce+Ie]=Y-Q*H,U[ce+Ie+1]+=Q}return W(U),U}function ot(b,T){var x=b.length,C=new Array(x),G=i,U=0,H,Y;for(Y=0;Y<x;Y++)H=b[Y]*T+U,U=Math.floor(H/G),C[Y]=H-U*G;for(;U>0;)C[Y++]=U%G,U=Math.floor(U/G);return C}function rt(b,T){for(var x=[];T-- >0;)x.push(0);return x.concat(b)}function Fe(b,T){var x=Math.max(b.length,T.length);if(x<=30)return at(b,T);x=Math.ceil(x/2);var C=b.slice(x),G=b.slice(0,x),U=T.slice(x),H=T.slice(0,x),Y=Fe(G,H),Q=Fe(C,U),ce=Fe(Pe(G,C),Pe(H,U)),De=Pe(Pe(Y,rt(Je(Je(ce,Y),Q),x)),rt(Q,2*x));return W(De),De}function M(b,T){return-.012*b-.012*T+15e-6*b*T>0}y.prototype.multiply=function(b){var T=Te(b),x=this.value,C=T.value,G=this.sign!==T.sign,U;if(T.isSmall){if(C===0)return g[0];if(C===1)return this;if(C===-1)return this.negate();if(U=Math.abs(C),U<i)return new y(ot(x,U),G);C=J(U)}return M(x.length,C.length)?new y(Fe(x,C),G):new y(at(x,C),G)},y.prototype.times=y.prototype.multiply;function re(b,T,x){return b<i?new y(ot(T,b),x):new y(at(T,J(b)),x)}p.prototype._multiplyBySmall=function(b){return F(b.value*this.value)?new p(b.value*this.value):re(Math.abs(b.value),J(Math.abs(this.value)),this.sign!==b.sign)},y.prototype._multiplyBySmall=function(b){return b.value===0?g[0]:b.value===1?this:b.value===-1?this.negate():re(Math.abs(b.value),this.value,this.sign!==b.sign)},p.prototype.multiply=function(b){return Te(b)._multiplyBySmall(this)},p.prototype.times=p.prototype.multiply,I.prototype.multiply=function(b){return new I(this.value*Te(b).value)},I.prototype.times=I.prototype.multiply;function ie(b){var T=b.length,x=he(T+T),C=i,G,U,H,Y,Q;for(H=0;H<T;H++){Y=b[H],U=0-Y*Y;for(var ce=H;ce<T;ce++)Q=b[ce],G=2*(Y*Q)+x[H+ce]+U,U=Math.floor(G/C),x[H+ce]=G-U*C;x[H+T]=U}return W(x),x}y.prototype.square=function(){return new y(ie(this.value),!1)},p.prototype.square=function(){var b=this.value*this.value;return F(b)?new p(b):new y(ie(J(Math.abs(this.value))),!1)},I.prototype.square=function(b){return new I(this.value*this.value)};function ee(b,T){var x=b.length,C=T.length,G=i,U=he(T.length),H=T[C-1],Y=Math.ceil(G/(2*H)),Q=ot(b,Y),ce=ot(T,Y),De,Re,Ie,At,Ae,en,Qe;for(Q.length<=x&&Q.push(0),ce.push(0),H=ce[C-1],Re=x-C;Re>=0;Re--){for(De=G-1,Q[Re+C]!==H&&(De=Math.floor((Q[Re+C]*G+Q[Re+C-1])/H)),Ie=0,At=0,en=ce.length,Ae=0;Ae<en;Ae++)Ie+=De*ce[Ae],Qe=Math.floor(Ie/G),At+=Q[Re+Ae]-(Ie-Qe*G),Ie=Qe,At<0?(Q[Re+Ae]=At+G,At=-1):(Q[Re+Ae]=At,At=0);for(;At!==0;){for(De-=1,Ie=0,Ae=0;Ae<en;Ae++)Ie+=Q[Re+Ae]-G+ce[Ae],Ie<0?(Q[Re+Ae]=Ie+G,Ie=0):(Q[Re+Ae]=Ie,Ie=1);At+=Ie}U[Re]=De}return Q=pe(Q,Y)[0],[z(U),z(Q)]}function te(b,T){for(var x=b.length,C=T.length,G=[],U=[],H=i,Y,Q,ce,De,Re;x;){if(U.unshift(b[--x]),W(U),we(U,T)<0){G.push(0);continue}Q=U.length,ce=U[Q-1]*H+U[Q-2],De=T[C-1]*H+T[C-2],Q>C&&(ce=(ce+1)*H),Y=Math.ceil(ce/De);do{if(Re=ot(T,Y),we(Re,U)<=0)break;Y--}while(Y);G.push(Y),U=Je(U,Re)}return G.reverse(),[z(G),z(U)]}function pe(b,T){var x=b.length,C=he(x),G=i,U,H,Y,Q;for(Y=0,U=x-1;U>=0;--U)Q=Y*G+b[U],H=ne(Q/T),Y=Q-H*T,C[U]=H|0;return[C,Y|0]}function xe(b,T){var x,C=Te(T);if(E)return[new I(b.value/C.value),new I(b.value%C.value)];var G=b.value,U=C.value,H;if(U===0)throw new Error("Cannot divide by zero");if(b.isSmall)return C.isSmall?[new p(ne(G/U)),new p(G%U)]:[g[0],b];if(C.isSmall){if(U===1)return[b,g[0]];if(U==-1)return[b.negate(),g[0]];var Y=Math.abs(U);if(Y<i){x=pe(G,Y),H=z(x[0]);var Q=x[1];return b.sign&&(Q=-Q),typeof H=="number"?(b.sign!==C.sign&&(H=-H),[new p(H),new p(Q)]):[new y(H,b.sign!==C.sign),new p(Q)]}U=J(Y)}var ce=we(G,U);if(ce===-1)return[g[0],b];if(ce===0)return[g[b.sign===C.sign?1:-1],g[0]];G.length+U.length<=200?x=ee(G,U):x=te(G,U),H=x[0];var De=b.sign!==C.sign,Re=x[1],Ie=b.sign;return typeof H=="number"?(De&&(H=-H),H=new p(H)):H=new y(H,De),typeof Re=="number"?(Ie&&(Re=-Re),Re=new p(Re)):Re=new y(Re,Ie),[H,Re]}y.prototype.divmod=function(b){var T=xe(this,b);return{quotient:T[0],remainder:T[1]}},I.prototype.divmod=p.prototype.divmod=y.prototype.divmod,y.prototype.divide=function(b){return xe(this,b)[0]},I.prototype.over=I.prototype.divide=function(b){return new I(this.value/Te(b).value)},p.prototype.over=p.prototype.divide=y.prototype.over=y.prototype.divide,y.prototype.mod=function(b){return xe(this,b)[1]},I.prototype.mod=I.prototype.remainder=function(b){return new I(this.value%Te(b).value)},p.prototype.remainder=p.prototype.mod=y.prototype.remainder=y.prototype.mod,y.prototype.pow=function(b){var T=Te(b),x=this.value,C=T.value,G,U,H;if(C===0)return g[1];if(x===0)return g[0];if(x===1)return g[1];if(x===-1)return T.isEven()?g[1]:g[-1];if(T.sign)return g[0];if(!T.isSmall)throw new Error("The exponent "+T.toString()+" is too large.");if(this.isSmall&&F(G=Math.pow(x,C)))return new p(ne(G));for(U=this,H=g[1];C&!0&&(H=H.times(U),--C),C!==0;)C/=2,U=U.square();return H},p.prototype.pow=y.prototype.pow,I.prototype.pow=function(b){var T=Te(b),x=this.value,C=T.value,G=BigInt(0),U=BigInt(1),H=BigInt(2);if(C===G)return g[1];if(x===G)return g[0];if(x===U)return g[1];if(x===BigInt(-1))return T.isEven()?g[1]:g[-1];if(T.isNegative())return new I(G);for(var Y=this,Q=g[1];(C&U)===U&&(Q=Q.times(Y),--C),C!==G;)C/=H,Y=Y.square();return Q},y.prototype.modPow=function(b,T){if(b=Te(b),T=Te(T),T.isZero())throw new Error("Cannot take modPow with modulus 0");var x=g[1],C=this.mod(T);for(b.isNegative()&&(b=b.multiply(g[-1]),C=C.modInv(T));b.isPositive();){if(C.isZero())return g[0];b.isOdd()&&(x=x.multiply(C).mod(T)),b=b.divide(2),C=C.square().mod(T)}return x},I.prototype.modPow=p.prototype.modPow=y.prototype.modPow;function we(b,T){if(b.length!==T.length)return b.length>T.length?1:-1;for(var x=b.length-1;x>=0;x--)if(b[x]!==T[x])return b[x]>T[x]?1:-1;return 0}y.prototype.compareAbs=function(b){var T=Te(b),x=this.value,C=T.value;return T.isSmall?1:we(x,C)},p.prototype.compareAbs=function(b){var T=Te(b),x=Math.abs(this.value),C=T.value;return T.isSmall?(C=Math.abs(C),x===C?0:x>C?1:-1):-1},I.prototype.compareAbs=function(b){var T=this.value,x=Te(b).value;return T=T>=0?T:-T,x=x>=0?x:-x,T===x?0:T>x?1:-1},y.prototype.compare=function(b){if(b===1/0)return-1;if(b===-1/0)return 1;var T=Te(b),x=this.value,C=T.value;return this.sign!==T.sign?T.sign?1:-1:T.isSmall?this.sign?-1:1:we(x,C)*(this.sign?-1:1)},y.prototype.compareTo=y.prototype.compare,p.prototype.compare=function(b){if(b===1/0)return-1;if(b===-1/0)return 1;var T=Te(b),x=this.value,C=T.value;return T.isSmall?x==C?0:x>C?1:-1:x<0!==T.sign?x<0?-1:1:x<0?1:-1},p.prototype.compareTo=p.prototype.compare,I.prototype.compare=function(b){if(b===1/0)return-1;if(b===-1/0)return 1;var T=this.value,x=Te(b).value;return T===x?0:T>x?1:-1},I.prototype.compareTo=I.prototype.compare,y.prototype.equals=function(b){return this.compare(b)===0},I.prototype.eq=I.prototype.equals=p.prototype.eq=p.prototype.equals=y.prototype.eq=y.prototype.equals,y.prototype.notEquals=function(b){return this.compare(b)!==0},I.prototype.neq=I.prototype.notEquals=p.prototype.neq=p.prototype.notEquals=y.prototype.neq=y.prototype.notEquals,y.prototype.greater=function(b){return this.compare(b)>0},I.prototype.gt=I.prototype.greater=p.prototype.gt=p.prototype.greater=y.prototype.gt=y.prototype.greater,y.prototype.lesser=function(b){return this.compare(b)<0},I.prototype.lt=I.prototype.lesser=p.prototype.lt=p.prototype.lesser=y.prototype.lt=y.prototype.lesser,y.prototype.greaterOrEquals=function(b){return this.compare(b)>=0},I.prototype.geq=I.prototype.greaterOrEquals=p.prototype.geq=p.prototype.greaterOrEquals=y.prototype.geq=y.prototype.greaterOrEquals,y.prototype.lesserOrEquals=function(b){return this.compare(b)<=0},I.prototype.leq=I.prototype.lesserOrEquals=p.prototype.leq=p.prototype.lesserOrEquals=y.prototype.leq=y.prototype.lesserOrEquals,y.prototype.isEven=function(){return(this.value[0]&1)===0},p.prototype.isEven=function(){return(this.value&1)===0},I.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},y.prototype.isOdd=function(){return(this.value[0]&1)===1},p.prototype.isOdd=function(){return(this.value&1)===1},I.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},y.prototype.isPositive=function(){return!this.sign},p.prototype.isPositive=function(){return this.value>0},I.prototype.isPositive=p.prototype.isPositive,y.prototype.isNegative=function(){return this.sign},p.prototype.isNegative=function(){return this.value<0},I.prototype.isNegative=p.prototype.isNegative,y.prototype.isUnit=function(){return!1},p.prototype.isUnit=function(){return Math.abs(this.value)===1},I.prototype.isUnit=function(){return this.abs().value===BigInt(1)},y.prototype.isZero=function(){return!1},p.prototype.isZero=function(){return this.value===0},I.prototype.isZero=function(){return this.value===BigInt(0)},y.prototype.isDivisibleBy=function(b){var T=Te(b);return T.isZero()?!1:T.isUnit()?!0:T.compareAbs(2)===0?this.isEven():this.mod(T).isZero()},I.prototype.isDivisibleBy=p.prototype.isDivisibleBy=y.prototype.isDivisibleBy;function Ge(b){var T=b.abs();if(T.isUnit())return!1;if(T.equals(2)||T.equals(3)||T.equals(5))return!0;if(T.isEven()||T.isDivisibleBy(3)||T.isDivisibleBy(5))return!1;if(T.lesser(49))return!0}function Ve(b,T){for(var x=b.prev(),C=x,G=0,U,H,Y;C.isEven();)C=C.divide(2),G++;e:for(H=0;H<T.length;H++)if(!b.lesser(T[H])&&(Y=e(T[H]).modPow(C,b),!(Y.isUnit()||Y.equals(x)))){for(U=G-1;U!=0;U--){if(Y=Y.square().mod(b),Y.isUnit())return!1;if(Y.equals(x))continue e}return!1}return!0}y.prototype.isPrime=function(b){var T=Ge(this);if(T!==t)return T;var x=this.abs(),C=x.bitLength();if(C<=64)return Ve(x,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var G=Math.log(2)*C.toJSNumber(),U=Math.ceil(b===!0?2*Math.pow(G,2):G),H=[],Y=0;Y<U;Y++)H.push(e(Y+2));return Ve(x,H)},I.prototype.isPrime=p.prototype.isPrime=y.prototype.isPrime,y.prototype.isProbablePrime=function(b,T){var x=Ge(this);if(x!==t)return x;for(var C=this.abs(),G=b===t?5:b,U=[],H=0;H<G;H++)U.push(e.randBetween(2,C.minus(2),T));return Ve(C,U)},I.prototype.isProbablePrime=p.prototype.isProbablePrime=y.prototype.isProbablePrime,y.prototype.modInv=function(b){for(var T=e.zero,x=e.one,C=Te(b),G=this.abs(),U,H,Y;!G.isZero();)U=C.divide(G),H=T,Y=C,T=x,C=G,x=H.subtract(U.multiply(x)),G=Y.subtract(U.multiply(G));if(!C.isUnit())throw new Error(this.toString()+" and "+b.toString()+" are not co-prime");return T.compare(0)===-1&&(T=T.add(b)),this.isNegative()?T.negate():T},I.prototype.modInv=p.prototype.modInv=y.prototype.modInv,y.prototype.next=function(){var b=this.value;return this.sign?mt(b,1,this.sign):new y(We(b,1),this.sign)},p.prototype.next=function(){var b=this.value;return b+1<l?new p(b+1):new y(u,!1)},I.prototype.next=function(){return new I(this.value+BigInt(1))},y.prototype.prev=function(){var b=this.value;return this.sign?new y(We(b,1),!0):mt(b,1,this.sign)},p.prototype.prev=function(){var b=this.value;return b-1>-l?new p(b-1):new y(u,!0)},I.prototype.prev=function(){return new I(this.value-BigInt(1))};for(var lt=[1];2*lt[lt.length-1]<=i;)lt.push(2*lt[lt.length-1]);var Tt=lt.length,Pt=lt[Tt-1];function Is(b){return Math.abs(b)<=i}y.prototype.shiftLeft=function(b){var T=Te(b).toJSNumber();if(!Is(T))throw new Error(String(T)+" is too large for shifting.");if(T<0)return this.shiftRight(-T);var x=this;if(x.isZero())return x;for(;T>=Tt;)x=x.multiply(Pt),T-=Tt-1;return x.multiply(lt[T])},I.prototype.shiftLeft=p.prototype.shiftLeft=y.prototype.shiftLeft,y.prototype.shiftRight=function(b){var T,x=Te(b).toJSNumber();if(!Is(x))throw new Error(String(x)+" is too large for shifting.");if(x<0)return this.shiftLeft(-x);for(var C=this;x>=Tt;){if(C.isZero()||C.isNegative()&&C.isUnit())return C;T=xe(C,Pt),C=T[1].isNegative()?T[0].prev():T[0],x-=Tt-1}return T=xe(C,lt[x]),T[1].isNegative()?T[0].prev():T[0]},I.prototype.shiftRight=p.prototype.shiftRight=y.prototype.shiftRight;function gn(b,T,x){T=Te(T);for(var C=b.isNegative(),G=T.isNegative(),U=C?b.not():b,H=G?T.not():T,Y=0,Q=0,ce=null,De=null,Re=[];!U.isZero()||!H.isZero();)ce=xe(U,Pt),Y=ce[1].toJSNumber(),C&&(Y=Pt-1-Y),De=xe(H,Pt),Q=De[1].toJSNumber(),G&&(Q=Pt-1-Q),U=ce[0],H=De[0],Re.push(x(Y,Q));for(var Ie=x(C?1:0,G?1:0)!==0?e(-1):e(0),At=Re.length-1;At>=0;At-=1)Ie=Ie.multiply(Pt).add(e(Re[At]));return Ie}y.prototype.not=function(){return this.negate().prev()},I.prototype.not=p.prototype.not=y.prototype.not,y.prototype.and=function(b){return gn(this,b,function(T,x){return T&x})},I.prototype.and=p.prototype.and=y.prototype.and,y.prototype.or=function(b){return gn(this,b,function(T,x){return T|x})},I.prototype.or=p.prototype.or=y.prototype.or,y.prototype.xor=function(b){return gn(this,b,function(T,x){return T^x})},I.prototype.xor=p.prototype.xor=y.prototype.xor;var Ee=1<<30,Zt=(i&-i)*(i&-i)|Ee;function It(b){var T=b.value,x=typeof T=="number"?T|Ee:typeof T=="bigint"?T|BigInt(Ee):T[0]+T[1]*i|Zt;return x&-x}function Jt(b,T){if(T.compareTo(b)<=0){var x=Jt(b,T.square(T)),C=x.p,G=x.e,U=C.multiply(T);return U.compareTo(b)<=0?{p:U,e:G*2+1}:{p:C,e:G*2}}return{p:e(1),e:0}}y.prototype.bitLength=function(){var b=this;return b.compareTo(e(0))<0&&(b=b.negate().subtract(e(1))),b.compareTo(e(0))===0?e(0):e(Jt(b,e(2)).e).add(e(1))},I.prototype.bitLength=p.prototype.bitLength=y.prototype.bitLength;function us(b,T){return b=Te(b),T=Te(T),b.greater(T)?b:T}function zn(b,T){return b=Te(b),T=Te(T),b.lesser(T)?b:T}function Ss(b,T){if(b=Te(b).abs(),T=Te(T).abs(),b.equals(T))return b;if(b.isZero())return T;if(T.isZero())return b;for(var x=g[1],C,G;b.isEven()&&T.isEven();)C=zn(It(b),It(T)),b=b.divide(C),T=T.divide(C),x=x.multiply(C);for(;b.isEven();)b=b.divide(It(b));do{for(;T.isEven();)T=T.divide(It(T));b.greater(T)&&(G=T,T=b,b=G),T=T.subtract(b)}while(!T.isZero());return x.isUnit()?b:b.multiply(x)}function Wn(b,T){return b=Te(b).abs(),T=Te(T).abs(),b.divide(Ss(b,T)).multiply(T)}function Kn(b,T,x){b=Te(b),T=Te(T);var C=x||Math.random,G=zn(b,T),U=us(b,T),H=U.subtract(G).add(1);if(H.isSmall)return G.add(Math.floor(C()*H));for(var Y=tt(H,i).value,Q=[],ce=!0,De=0;De<Y.length;De++){var Re=ce?Y[De]+(De+1<Y.length?Y[De+1]/i:0):i,Ie=ne(C()*Re);Q.push(Ie),Ie<Y[De]&&(ce=!1)}return G.add(g.fromArray(Q,i,!1))}var zt=function(b,T,x,C){x=x||d,b=String(b),C||(b=b.toLowerCase(),x=x.toLowerCase());var G=b.length,U,H=Math.abs(T),Y={};for(U=0;U<x.length;U++)Y[x[U]]=U;for(U=0;U<G;U++){var Q=b[U];if(Q!=="-"&&Q in Y&&Y[Q]>=H){if(Q==="1"&&H===1)continue;throw new Error(Q+" is not a valid digit in base "+T+".")}}T=Te(T);var ce=[],De=b[0]==="-";for(U=De?1:0;U<b.length;U++){var Q=b[U];if(Q in Y)ce.push(Te(Y[Q]));else if(Q==="<"){var Re=U;do U++;while(b[U]!==">"&&U<b.length);ce.push(Te(b.slice(Re+1,U)))}else throw new Error(Q+" is not a valid character")}return qn(ce,T,De)};function qn(b,T,x){var C=g[0],G=g[1],U;for(U=b.length-1;U>=0;U--)C=C.add(b[U].times(G)),G=G.times(T);return x?C.negate():C}function mn(b,T){return T=T||d,b<T.length?T[b]:"<"+b+">"}function tt(b,T){if(T=e(T),T.isZero()){if(b.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(T.equals(-1)){if(b.isZero())return{value:[0],isNegative:!1};if(b.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-b.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var x=Array.apply(null,Array(b.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return x.unshift([1]),{value:[].concat.apply([],x),isNegative:!1}}var C=!1;if(b.isNegative()&&T.isPositive()&&(C=!0,b=b.abs()),T.isUnit())return b.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(b.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:C};for(var G=[],U=b,H;U.isNegative()||U.compareAbs(T)>=0;){H=U.divmod(T),U=H.quotient;var Y=H.remainder;Y.isNegative()&&(Y=T.minus(Y).abs(),U=U.next()),G.push(Y.toJSNumber())}return G.push(U.toJSNumber()),{value:G.reverse(),isNegative:C}}function $t(b,T,x){var C=tt(b,T);return(C.isNegative?"-":"")+C.value.map(function(G){return mn(G,x)}).join("")}y.prototype.toArray=function(b){return tt(this,b)},p.prototype.toArray=function(b){return tt(this,b)},I.prototype.toArray=function(b){return tt(this,b)},y.prototype.toString=function(b,T){if(b===t&&(b=10),b!==10||T)return $t(this,b,T);for(var x=this.value,C=x.length,G=String(x[--C]),U="0000000",H;--C>=0;)H=String(x[C]),G+=U.slice(H.length)+H;var Y=this.sign?"-":"";return Y+G},p.prototype.toString=function(b,T){return b===t&&(b=10),b!=10||T?$t(this,b,T):String(this.value)},I.prototype.toString=p.prototype.toString,I.prototype.toJSON=y.prototype.toJSON=p.prototype.toJSON=function(){return this.toString()},y.prototype.valueOf=function(){return parseInt(this.toString(),10)},y.prototype.toJSNumber=y.prototype.valueOf,p.prototype.valueOf=function(){return this.value},p.prototype.toJSNumber=p.prototype.valueOf,I.prototype.valueOf=I.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function Yn(b){if(F(+b)){var T=+b;if(T===ne(T))return E?new I(BigInt(T)):new p(T);throw new Error("Invalid integer: "+b)}var x=b[0]==="-";x&&(b=b.slice(1));var C=b.split(/e/i);if(C.length>2)throw new Error("Invalid integer: "+C.join("e"));if(C.length===2){var G=C[1];if(G[0]==="+"&&(G=G.slice(1)),G=+G,G!==ne(G)||!F(G))throw new Error("Invalid integer: "+G+" is not a valid exponent.");var U=C[0],H=U.indexOf(".");if(H>=0&&(G-=U.length-H-1,U=U.slice(0,H)+U.slice(H+1)),G<0)throw new Error("Cannot include negative exponent part for integers");U+=new Array(G+1).join("0"),b=U}var Y=/^([0-9][0-9]*)$/.test(b);if(!Y)throw new Error("Invalid integer: "+b);if(E)return new I(BigInt(x?"-"+b:b));for(var Q=[],ce=b.length,De=a,Re=ce-De;ce>0;)Q.push(+b.slice(Re,ce)),Re-=De,Re<0&&(Re=0),ce-=De;return W(Q),new y(Q,x)}function ds(b){if(E)return new I(BigInt(b));if(F(b)){if(b!==ne(b))throw new Error(b+" is not an integer.");return new p(b)}return Yn(b.toString())}function Te(b){return typeof b=="number"?ds(b):typeof b=="string"?Yn(b):typeof b=="bigint"?new I(b):b}for(var Qt=0;Qt<1e3;Qt++)g[Qt]=Te(Qt),Qt>0&&(g[-Qt]=Te(-Qt));return g.one=g[1],g.zero=g[0],g.minusOne=g[-1],g.max=us,g.min=zn,g.gcd=Ss,g.lcm=Wn,g.isInstance=function(b){return b instanceof y||b instanceof p||b instanceof I},g.randBetween=Kn,g.fromArray=function(b,T,x){return qn(b.map(Te),Te(T||10),x)},g}();s.hasOwnProperty("exports")&&(s.exports=e)})(el);var Cf=el.exports,tl=Ca(Cf);const nl=64,_a=16,Ns=nl/_a;function Lf(){try{return!0}catch{return!1}}function kf(s,e,t){let i=0;for(let a=0;a<t;a++){const l=s[e+a];if(l===void 0)break;i+=l*16**a}return i}function sl(s){const e=[];for(let t=0;t<s.length;t++){let i=Number(s[t]);for(let a=0;i||a<e.length;a++)i+=(e[a]||0)*10,e[a]=i%16,i=(i-e[a])/16}return e}function Bf(s){const e=sl(s),t=Array(Ns);for(let i=0;i<Ns;i++)t[Ns-1-i]=kf(e,i*Ns,Ns);return t}class ts{static fromString(e){return new ts(Bf(e),e)}static fromBit(e){const t=Array(Ns),i=Math.floor(e/_a);for(let a=0;a<Ns;a++)t[Ns-1-a]=a===i?1<<e-i*_a:0;return new ts(t)}constructor(e,t){this.parts=e,this.str=t}and({parts:e}){return new ts(this.parts.map((t,i)=>t&e[i]))}or({parts:e}){return new ts(this.parts.map((t,i)=>t|e[i]))}xor({parts:e}){return new ts(this.parts.map((t,i)=>t^e[i]))}not(){return new ts(this.parts.map(e=>~e))}equals({parts:e}){return this.parts.every((t,i)=>t===e[i])}toString(){if(this.str!=null)return this.str;const e=new Array(nl/4);return this.parts.forEach((t,i)=>{const a=sl(t.toString());for(let l=0;l<4;l++)e[l+i*4]=a[3-l]||0}),this.str=tl.fromArray(e,16).toString()}toJSON(){return this.toString()}}const js=Lf();js&&BigInt.prototype.toJSON==null&&(BigInt.prototype.toJSON=function(){return this.toString()});const yr={},il=js?function(e){return BigInt(e)}:function(e){return e instanceof ts?e:(typeof e=="number"&&(e=e.toString()),yr[e]!=null||(yr[e]=ts.fromString(e)),yr[e])},Gt=il(0),Vr=js?function(e=Gt,t=Gt){return e&t}:function(e=Gt,t=Gt){return e.and(t)},rl=js?function(e=Gt,t=Gt){return e|t}:function(e=Gt,t=Gt){return e.or(t)},$f=js?function(e=Gt,t=Gt){return e^t}:function(e=Gt,t=Gt){return e.xor(t)},Mf=js?function(e=Gt){return~e}:function(e=Gt){return e.not()},Ma=js?function(e,t){return e===t}:function(e,t){return e==null||t==null?e==t:e.equals(t)};function Uf(...s){let e=s[0];for(let t=1;t<s.length;t++)e=rl(e,s[t]);return e}function Ff(s,e){return Ma(Vr(s,e),e)}function Vf(s,e){return!Ma(Vr(s,e),Gt)}function jf(s,e){return e===Gt?s:rl(s,e)}function Hf(s,e){return e===Gt?s:$f(s,Vr(s,e))}const Gf=js?function(e){return BigInt(1)<<BigInt(e)}:function(e){return ts.fromBit(e)};var uo={combine:Uf,add:jf,remove:Hf,filter:Vr,invert:Mf,has:Ff,hasAny:Vf,equals:Ma,deserialize:il,getFlag:Gf},ho;(function(s){s[s.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",s[s.CLOSE_UNSUPPORTED=1003]="CLOSE_UNSUPPORTED",s[s.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",s[s.INVALID_CLIENTID=4e3]="INVALID_CLIENTID",s[s.INVALID_ORIGIN=4001]="INVALID_ORIGIN",s[s.RATELIMITED=4002]="RATELIMITED",s[s.TOKEN_REVOKED=4003]="TOKEN_REVOKED",s[s.INVALID_VERSION=4004]="INVALID_VERSION",s[s.INVALID_ENCODING=4005]="INVALID_ENCODING"})(ho||(ho={}));var wa;(function(s){s[s.INVALID_PAYLOAD=4e3]="INVALID_PAYLOAD",s[s.INVALID_COMMAND=4002]="INVALID_COMMAND",s[s.INVALID_EVENT=4004]="INVALID_EVENT",s[s.INVALID_PERMISSIONS=4006]="INVALID_PERMISSIONS"})(wa||(wa={}));var Ta;(function(s){s.LANDSCAPE="landscape",s.PORTRAIT="portrait"})(Ta||(Ta={}));var vs;(function(s){s.MOBILE="mobile",s.DESKTOP="desktop"})(vs||(vs={}));Object.freeze({CREATE_INSTANT_INVITE:uo.getFlag(0),ADMINISTRATOR:uo.getFlag(3)});function Yt(s){return Qo(e=>{var t;const[i]=(t=Object.entries(s).find(([,a])=>a===e))!==null&&t!==void 0?t:[];return e!=null&&i===void 0?s.UNHANDLED:e},P().or(_e()))}function Zf(s){const e=ka().transform(t=>{const i=s.safeParse(t);return i.success?i.data:s._def.defaultValue()});return e.overlayType=s,e}const zf=ye.object({image_url:ye.string()}),Wf=ye.object({mediaUrl:ye.string().max(1024)}),Kf=ye.object({access_token:ye.union([ye.string(),ye.null()]).optional()}),al=ye.object({access_token:ye.string(),user:ye.object({username:ye.string(),discriminator:ye.string(),id:ye.string(),avatar:ye.union([ye.string(),ye.null()]).optional(),public_flags:ye.number(),global_name:ye.union([ye.string(),ye.null()]).optional()}),scopes:ye.array(Zf(ye.enum(["identify","email","connections","guilds","guilds.join","guilds.members.read","guilds.channels.read","gdm.join","bot","rpc","rpc.notifications.read","rpc.voice.read","rpc.voice.write","rpc.video.read","rpc.video.write","rpc.screenshare.read","rpc.screenshare.write","rpc.activities.write","webhook.incoming","messages.read","applications.builds.upload","applications.builds.read","applications.commands","applications.commands.permissions.update","applications.commands.update","applications.store.update","applications.entitlements","activities.read","activities.write","relationships.read","relationships.write","voice","dm_channels.read","role_connections.write","presences.read","presences.write","openid","dm_channels.messages.read","dm_channels.messages.write","gateway.connect","account.global_name.update","payment_sources.country_code","sdk.social_layer"]).or(ye.literal(-1)).default(-1))),expires:ye.string(),application:ye.object({description:ye.string(),icon:ye.union([ye.string(),ye.null()]).optional(),id:ye.string(),rpc_origins:ye.array(ye.string()).optional(),name:ye.string()})}),ol=ye.object({participants:ye.array(ye.object({id:ye.string(),username:ye.string(),global_name:ye.union([ye.string(),ye.null()]).optional(),discriminator:ye.string(),avatar:ye.union([ye.string(),ye.null()]).optional(),flags:ye.number(),bot:ye.boolean(),avatar_decoration_data:ye.union([ye.object({asset:ye.string(),skuId:ye.string().optional()}),ye.null()]).optional(),premium_type:ye.union([ye.number(),ye.null()]).optional(),nickname:ye.string().optional()}))});var ss;(function(s){s.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",s.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",s.AUTHENTICATE="AUTHENTICATE",s.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(ss||(ss={}));const qf=ye.object({}).optional().nullable(),po=ye.void(),ll={[ss.INITIATE_IMAGE_UPLOAD]:{request:po,response:zf},[ss.OPEN_SHARE_MOMENT_DIALOG]:{request:Wf,response:qf},[ss.AUTHENTICATE]:{request:Kf,response:al},[ss.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS]:{request:po,response:ol}},Yf="DISPATCH";var Se;(function(s){s.AUTHORIZE="AUTHORIZE",s.AUTHENTICATE="AUTHENTICATE",s.GET_GUILDS="GET_GUILDS",s.GET_GUILD="GET_GUILD",s.GET_CHANNEL="GET_CHANNEL",s.GET_CHANNELS="GET_CHANNELS",s.SELECT_VOICE_CHANNEL="SELECT_VOICE_CHANNEL",s.SELECT_TEXT_CHANNEL="SELECT_TEXT_CHANNEL",s.SUBSCRIBE="SUBSCRIBE",s.UNSUBSCRIBE="UNSUBSCRIBE",s.CAPTURE_SHORTCUT="CAPTURE_SHORTCUT",s.SET_CERTIFIED_DEVICES="SET_CERTIFIED_DEVICES",s.SET_ACTIVITY="SET_ACTIVITY",s.GET_SKUS="GET_SKUS",s.GET_ENTITLEMENTS="GET_ENTITLEMENTS",s.GET_SKUS_EMBEDDED="GET_SKUS_EMBEDDED",s.GET_ENTITLEMENTS_EMBEDDED="GET_ENTITLEMENTS_EMBEDDED",s.START_PURCHASE="START_PURCHASE",s.SET_CONFIG="SET_CONFIG",s.SEND_ANALYTICS_EVENT="SEND_ANALYTICS_EVENT",s.USER_SETTINGS_GET_LOCALE="USER_SETTINGS_GET_LOCALE",s.OPEN_EXTERNAL_LINK="OPEN_EXTERNAL_LINK",s.ENCOURAGE_HW_ACCELERATION="ENCOURAGE_HW_ACCELERATION",s.CAPTURE_LOG="CAPTURE_LOG",s.SET_ORIENTATION_LOCK_STATE="SET_ORIENTATION_LOCK_STATE",s.OPEN_INVITE_DIALOG="OPEN_INVITE_DIALOG",s.GET_PLATFORM_BEHAVIORS="GET_PLATFORM_BEHAVIORS",s.GET_CHANNEL_PERMISSIONS="GET_CHANNEL_PERMISSIONS",s.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",s.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",s.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(Se||(Se={}));const Oi=oe({cmd:P(),data:ir(),evt:Ba(),nonce:P()}).passthrough(),Xf=Object.assign(Object.assign({},al.shape.scopes.element.overlayType._def.innerType.options[0].Values),{UNHANDLED:-1});Yt(Xf);const Fs=oe({id:P(),username:P(),discriminator:P(),global_name:P().optional().nullable(),avatar:P().optional().nullable(),avatar_decoration_data:oe({asset:P(),sku_id:P().optional()}).nullable(),bot:Le(),flags:_e().optional().nullable(),premium_type:_e().optional().nullable()}),Ua=oe({user:Fs,nick:P().optional().nullable(),roles:Ye(P()),joined_at:P(),deaf:Le(),mute:Le()}),Jf=oe({user_id:P(),nick:P().optional().nullable(),guild_id:P(),avatar:P().optional().nullable(),avatar_decoration_data:oe({asset:P(),sku_id:P().optional().nullable()}).optional().nullable(),color_string:P().optional().nullable()}),Fa=oe({id:P(),name:P().optional().nullable(),roles:Ye(P()).optional().nullable(),user:Fs.optional().nullable(),require_colons:Le().optional().nullable(),managed:Le().optional().nullable(),animated:Le().optional().nullable(),available:Le().optional().nullable()}),cl=oe({mute:Le(),deaf:Le(),self_mute:Le(),self_deaf:Le(),suppress:Le()}),fl=oe({mute:Le(),nick:P(),user:Fs,voice_state:cl,volume:_e()}),Qf={UNHANDLED:-1,IDLE:"idle",DND:"dnd",ONLINE:"online",OFFLINE:"offline"},br=Yt(Qf),Hi=oe({name:P(),type:_e(),url:P().optional().nullable(),created_at:_e().optional().nullable(),timestamps:oe({start:_e(),end:_e()}).partial().optional().nullable(),application_id:P().optional().nullable(),details:P().optional().nullable(),state:P().optional().nullable(),emoji:Fa.optional().nullable(),party:oe({id:P().optional().nullable(),size:Ye(_e()).optional().nullable()}).optional().nullable(),assets:oe({large_image:P().nullable(),large_text:P().nullable(),small_image:P().nullable(),small_text:P().nullable()}).partial().optional().nullable(),secrets:oe({join:P(),match:P()}).partial().optional().nullable(),instance:Le().optional().nullable(),flags:_e().optional().nullable()}),eu={UNHANDLED:-1,ROLE:0,MEMBER:1},tu=oe({id:P(),type:Yt(eu),allow:P(),deny:P()}),Va={UNHANDLED:-1,DM:1,GROUP_DM:3,GUILD_TEXT:0,GUILD_VOICE:2,GUILD_CATEGORY:4,GUILD_ANNOUNCEMENT:5,GUILD_STORE:6,ANNOUNCEMENT_THREAD:10,PUBLIC_THREAD:11,PRIVATE_THREAD:12,GUILD_STAGE_VOICE:13,GUILD_DIRECTORY:14,GUILD_FORUM:15},ul=oe({id:P(),type:Yt(Va),guild_id:P().optional().nullable(),position:_e().optional().nullable(),permission_overwrites:Ye(tu).optional().nullable(),name:P().optional().nullable(),topic:P().optional().nullable(),nsfw:Le().optional().nullable(),last_message_id:P().optional().nullable(),bitrate:_e().optional().nullable(),user_limit:_e().optional().nullable(),rate_limit_per_user:_e().optional().nullable(),recipients:Ye(Fs).optional().nullable(),icon:P().optional().nullable(),owner_id:P().optional().nullable(),application_id:P().optional().nullable(),parent_id:P().optional().nullable(),last_pin_timestamp:P().optional().nullable()}),nu=oe({user:Fs,guild_id:P(),status:br,activities:Ye(Hi),client_status:oe({desktop:br,mobile:br,web:br}).partial()}),su=oe({id:P(),name:P(),color:_e(),hoist:Le(),position:_e(),permissions:P(),managed:Le(),mentionable:Le()});oe({id:P(),name:P(),owner_id:P(),icon:P().nullable(),icon_hash:P().optional().nullable(),splash:P().nullable(),discovery_splash:P().nullable(),owner:Le().optional().nullable(),permissions:P().optional().nullable(),region:P(),afk_channel_id:P().nullable(),afk_timeout:_e(),widget_enabled:Le().optional().nullable(),widget_channel_id:P().optional().nullable(),verification_level:_e(),default_message_notifications:_e(),explicit_content_filter:_e(),roles:Ye(su),emojis:Ye(Fa),features:Ye(P()),mfa_level:_e(),application_id:P().nullable(),system_channel_id:P().nullable(),system_channel_flags:_e(),rules_channel_id:P().nullable(),joined_at:P().optional().nullable(),large:Le().optional().nullable(),unavailable:Le().optional().nullable(),member_count:_e().optional().nullable(),voice_states:Ye(cl).optional().nullable(),members:Ye(Ua).optional().nullable(),channels:Ye(ul).optional().nullable(),presences:Ye(nu).optional().nullable(),max_presences:_e().optional().nullable(),max_members:_e().optional().nullable(),vanity_url_code:P().nullable(),description:P().nullable(),banner:P().nullable(),premium_tier:_e(),premium_subscription_count:_e().optional().nullable(),preferred_locale:P(),public_updates_channel_id:P().nullable(),max_video_channel_users:_e().optional().nullable(),approximate_member_count:_e().optional().nullable(),approximate_presence_count:_e().optional().nullable()});const iu=oe({id:P(),guild_id:P(),type:_e(),name:P()}),ru=oe({id:P(),filename:P(),size:_e(),url:P(),proxy_url:P(),height:_e().optional().nullable(),width:_e().optional().nullable()}),au=oe({text:P(),icon_url:P().optional().nullable(),proxy_icon_url:P().optional().nullable()}),Ia=oe({url:P().optional().nullable(),proxy_url:P().optional().nullable(),height:_e().optional().nullable(),width:_e().optional().nullable()}),ou=Ia.omit({proxy_url:!0}),lu=oe({name:P().optional().nullable(),url:P().optional().nullable()}),cu=oe({name:P().optional().nullable(),url:P().optional().nullable(),icon_url:P().optional().nullable(),proxy_icon_url:P().optional().nullable()}),fu=oe({name:P(),value:P(),inline:Le()}),uu=oe({title:P().optional().nullable(),type:P().optional().nullable(),description:P().optional().nullable(),url:P().optional().nullable(),timestamp:P().optional().nullable(),color:_e().optional().nullable(),footer:au.optional().nullable(),image:Ia.optional().nullable(),thumbnail:Ia.optional().nullable(),video:ou.optional().nullable(),provider:lu.optional().nullable(),author:cu.optional().nullable(),fields:Ye(fu).optional().nullable()}),du=oe({count:_e(),me:Le(),emoji:Fa}),hu=oe({type:_e(),party_id:P().optional().nullable()}),pu=oe({id:P(),cover_image:P().optional().nullable(),description:P(),icon:P().optional().nullable(),name:P()}),gu=oe({message_id:P().optional().nullable(),channel_id:P().optional().nullable(),guild_id:P().optional().nullable()}),mu=oe({id:P(),channel_id:P(),guild_id:P().optional().nullable(),author:Fs.optional().nullable(),member:Ua.optional().nullable(),content:P(),timestamp:P(),edited_timestamp:P().optional().nullable(),tts:Le(),mention_everyone:Le(),mentions:Ye(Fs),mention_roles:Ye(P()),mention_channels:Ye(iu),attachments:Ye(ru),embeds:Ye(uu),reactions:Ye(du).optional().nullable(),nonce:$a([P(),_e()]).optional().nullable(),pinned:Le(),webhook_id:P().optional().nullable(),type:_e(),activity:hu.optional().nullable(),application:pu.optional().nullable(),message_reference:gu.optional().nullable(),flags:_e().optional().nullable(),stickers:Ye(ir()).optional().nullable(),referenced_message:ir().optional().nullable()}),yu=oe({id:P(),name:P()}),bu={UNHANDLED:-1,KEYBOARD_KEY:0,MOUSE_BUTTON:1,KEYBOARD_MODIFIER_KEY:2,GAMEPAD_BUTTON:3},dl=oe({type:Yt(bu),code:_e(),name:P()}),Eu={UNHANDLED:-1,PUSH_TO_TALK:"PUSH_TO_TALK",VOICE_ACTIVITY:"VOICE_ACTIVITY"},vu=oe({type:Yt(Eu),auto_threshold:Le(),threshold:_e(),shortcut:Ye(dl),delay:_e()}),go=oe({device_id:P(),volume:_e(),available_devices:Ye(yu)}),_u={UNHANDLED:-1,AUDIO_INPUT:"AUDIO_INPUT",AUDIO_OUTPUT:"AUDIO_OUTPUT",VIDEO_INPUT:"VIDEO_INPUT"};oe({type:Yt(_u),id:P(),vendor:oe({name:P(),url:P()}),model:oe({name:P(),url:P()}),related:Ye(P()),echo_cancellation:Le().optional().nullable(),noise_suppression:Le().optional().nullable(),automatic_gain_control:Le().optional().nullable(),hardware_mute:Le().optional().nullable()});const wu={UNHANDLED:-1,APPLICATION:1,DLC:2,CONSUMABLE:3,BUNDLE:4,SUBSCRIPTION:5},Tu=oe({id:P(),name:P(),type:Yt(wu),price:oe({amount:_e(),currency:P()}),application_id:P(),flags:_e(),release_date:P().nullable()}),Iu={UNHANDLED:-1,PURCHASE:1,PREMIUM_SUBSCRIPTION:2,DEVELOPER_GIFT:3,TEST_MODE_PURCHASE:4,FREE_PURCHASE:5,USER_GIFT:6,PREMIUM_PURCHASE:7},ja=oe({id:P(),sku_id:P(),application_id:P(),user_id:P(),gift_code_flags:_e(),type:Yt(Iu),gifter_user_id:P().optional().nullable(),branches:Ye(P()).optional().nullable(),starts_at:P().optional().nullable(),ends_at:P().optional().nullable(),parent_id:P().optional().nullable(),consumed:Le().optional().nullable(),deleted:Le().optional().nullable(),gift_code_batch_id:P().optional().nullable()}),Su={UNHANDLED:-1,UNLOCKED:1,PORTRAIT:2,LANDSCAPE:3};Yt(Su);const Au={UNHANDLED:-1,NOMINAL:0,FAIR:1,SERIOUS:2,CRITICAL:3},Ou=Yt(Au),hl={UNHANDLED:-1,PORTRAIT:0,LANDSCAPE:1};Yt(hl);const pl={UNHANDLED:-1,FOCUSED:0,PIP:1,GRID:2};Yt(pl);const Ha="ERROR";var nt;(function(s){s.READY="READY",s.VOICE_STATE_UPDATE="VOICE_STATE_UPDATE",s.SPEAKING_START="SPEAKING_START",s.SPEAKING_STOP="SPEAKING_STOP",s.ACTIVITY_LAYOUT_MODE_UPDATE="ACTIVITY_LAYOUT_MODE_UPDATE",s.ORIENTATION_UPDATE="ORIENTATION_UPDATE",s.CURRENT_USER_UPDATE="CURRENT_USER_UPDATE",s.CURRENT_GUILD_MEMBER_UPDATE="CURRENT_GUILD_MEMBER_UPDATE",s.ENTITLEMENT_CREATE="ENTITLEMENT_CREATE",s.THERMAL_STATE_UPDATE="THERMAL_STATE_UPDATE",s.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE="ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE"})(nt||(nt={}));const Tn=Oi.extend({evt:Ai(nt),nonce:P().nullable(),cmd:Bt(Yf),data:oe({}).passthrough()}),gl=Oi.extend({evt:Bt(Ha),data:oe({code:_e(),message:P().optional()}).passthrough(),cmd:Ai(Se),nonce:P().nullable()}),xu=Tn.extend({evt:P()}),Du=$a([Tn,xu,gl]);function Ru(s){const e=s.evt;if(!(e in nt))throw new Error(`Unrecognized event type ${s.evt}`);return Nu[e].payload.parse(s)}const Nu={[nt.READY]:{payload:Tn.extend({evt:Bt(nt.READY),data:oe({v:_e(),config:oe({cdn_host:P().optional(),api_endpoint:P(),environment:P()}),user:oe({id:P(),username:P(),discriminator:P(),avatar:P().optional()}).optional()})})},[nt.VOICE_STATE_UPDATE]:{payload:Tn.extend({evt:Bt(nt.VOICE_STATE_UPDATE),data:fl}),subscribeArgs:oe({channel_id:P()})},[nt.SPEAKING_START]:{payload:Tn.extend({evt:Bt(nt.SPEAKING_START),data:oe({lobby_id:P().optional(),channel_id:P().optional(),user_id:P()})}),subscribeArgs:oe({lobby_id:P().nullable().optional(),channel_id:P().nullable().optional()})},[nt.SPEAKING_STOP]:{payload:Tn.extend({evt:Bt(nt.SPEAKING_STOP),data:oe({lobby_id:P().optional(),channel_id:P().optional(),user_id:P()})}),subscribeArgs:oe({lobby_id:P().nullable().optional(),channel_id:P().nullable().optional()})},[nt.ACTIVITY_LAYOUT_MODE_UPDATE]:{payload:Tn.extend({evt:Bt(nt.ACTIVITY_LAYOUT_MODE_UPDATE),data:oe({layout_mode:Yt(pl)})})},[nt.ORIENTATION_UPDATE]:{payload:Tn.extend({evt:Bt(nt.ORIENTATION_UPDATE),data:oe({screen_orientation:Yt(hl),orientation:Ai(Ta)})})},[nt.CURRENT_USER_UPDATE]:{payload:Tn.extend({evt:Bt(nt.CURRENT_USER_UPDATE),data:Fs})},[nt.CURRENT_GUILD_MEMBER_UPDATE]:{payload:Tn.extend({evt:Bt(nt.CURRENT_GUILD_MEMBER_UPDATE),data:Jf}),subscribeArgs:oe({guild_id:P()})},[nt.ENTITLEMENT_CREATE]:{payload:Tn.extend({evt:Bt(nt.ENTITLEMENT_CREATE),data:oe({entitlement:ja})})},[nt.THERMAL_STATE_UPDATE]:{payload:Tn.extend({evt:Bt(nt.THERMAL_STATE_UPDATE),data:oe({thermal_state:Ou})})},[nt.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE]:{payload:Tn.extend({evt:Bt(nt.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE),data:oe({participants:ol.shape.participants})})}};function Pu(s,e){throw e}const or=oe({}).nullable(),ml=oe({code:P()}),Cu=oe({guilds:Ye(oe({id:P(),name:P()}))}),Lu=oe({id:P(),name:P(),icon_url:P().optional(),members:Ye(Ua)}),Ii=oe({id:P(),type:Yt(Va),guild_id:P().optional().nullable(),name:P().optional().nullable(),topic:P().optional().nullable(),bitrate:_e().optional().nullable(),user_limit:_e().optional().nullable(),position:_e().optional().nullable(),voice_states:Ye(fl),messages:Ye(mu)}),ku=oe({channels:Ye(ul)});Ii.nullable();const Bu=Ii.nullable(),$u=Ii.nullable();oe({input:go,output:go,mode:vu,automatic_gain_control:Le(),echo_cancellation:Le(),noise_suppression:Le(),qos:Le(),silence_warning:Le(),deaf:Le(),mute:Le()});const Mu=oe({evt:P()}),Uu=oe({shortcut:dl}),yl=Hi,bl=oe({skus:Ye(Tu)}),El=oe({entitlements:Ye(ja)}),vl=Ye(ja).nullable(),_l=oe({use_interactive_pip:Le()}),wl=oe({locale:P()}),Tl=oe({enabled:Le()}),Il=oe({permissions:Xo().or(P())}),Sl=oe({iosKeyboardResizesView:Jo(Le())}),Fu=Oi.extend({cmd:Ai(Se),evt:Ba()});function Vu({cmd:s,data:e}){switch(s){case Se.AUTHORIZE:return ml.parse(e);case Se.CAPTURE_SHORTCUT:return Uu.parse(e);case Se.ENCOURAGE_HW_ACCELERATION:return Tl.parse(e);case Se.GET_CHANNEL:return Ii.parse(e);case Se.GET_CHANNELS:return ku.parse(e);case Se.GET_CHANNEL_PERMISSIONS:return Il.parse(e);case Se.GET_GUILD:return Lu.parse(e);case Se.GET_GUILDS:return Cu.parse(e);case Se.GET_PLATFORM_BEHAVIORS:return Sl.parse(e);case Se.GET_CHANNEL:return Ii.parse(e);case Se.SELECT_TEXT_CHANNEL:return $u.parse(e);case Se.SELECT_VOICE_CHANNEL:return Bu.parse(e);case Se.SET_ACTIVITY:return yl.parse(e);case Se.GET_SKUS_EMBEDDED:return bl.parse(e);case Se.GET_ENTITLEMENTS_EMBEDDED:return El.parse(e);case Se.SET_CONFIG:return _l.parse(e);case Se.START_PURCHASE:return vl.parse(e);case Se.SUBSCRIBE:case Se.UNSUBSCRIBE:return Mu.parse(e);case Se.USER_SETTINGS_GET_LOCALE:return wl.parse(e);case Se.OPEN_EXTERNAL_LINK:case Se.SET_ORIENTATION_LOCK_STATE:case Se.SET_CERTIFIED_DEVICES:case Se.SEND_ANALYTICS_EVENT:case Se.OPEN_INVITE_DIALOG:case Se.CAPTURE_LOG:case Se.GET_SKUS:case Se.GET_ENTITLEMENTS:return or.parse(e);case Se.AUTHENTICATE:case Se.INITIATE_IMAGE_UPLOAD:case Se.OPEN_SHARE_MOMENT_DIALOG:case Se.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS:const{response:t}=ll[s];return t.parse(e);default:Pu(s,new Error(`Unrecognized command ${s}`))}}function ju(s){return Object.assign(Object.assign({},s),{data:Vu(s)})}oe({frame_id:P(),platform:Ai(vs).optional().nullable()});oe({v:Bt(1),encoding:Bt("json").optional(),client_id:P(),frame_id:P()});const Hu=oe({code:_e(),message:P().optional()}),Gu=oe({evt:P().nullable(),nonce:P().nullable(),data:ir().nullable(),cmd:P()}).passthrough();function Zu(s){const e=Gu.parse(s);return e.evt!=null?e.evt===Ha?gl.parse(e):Ru(Du.parse(e)):ju(Fu.passthrough().parse(e))}function pn(s,e,t,i=()=>{}){const a=Oi.extend({cmd:Bt(e),data:t});return async l=>{const u=await s({cmd:e,args:l,transfer:i(l)});return a.parse(u).data}}function jr(s,e=()=>{}){const t=ll[s].response,i=Oi.extend({cmd:Bt(s),data:t});return a=>async l=>{const u=await a({cmd:s,args:l,transfer:e(l)});return i.parse(u).data}}const zu=jr(ss.AUTHENTICATE),Wu=s=>pn(s,Se.AUTHORIZE,ml),Ku=s=>pn(s,Se.CAPTURE_LOG,or),qu=s=>pn(s,Se.ENCOURAGE_HW_ACCELERATION,Tl),Yu=s=>pn(s,Se.GET_ENTITLEMENTS_EMBEDDED,El),Xu=s=>pn(s,Se.GET_SKUS_EMBEDDED,bl),Ju=s=>pn(s,Se.GET_CHANNEL_PERMISSIONS,Il),Qu=s=>pn(s,Se.GET_PLATFORM_BEHAVIORS,Sl),ed=s=>pn(s,Se.OPEN_EXTERNAL_LINK,or),td=s=>pn(s,Se.OPEN_INVITE_DIALOG,or),nd=jr(ss.OPEN_SHARE_MOMENT_DIALOG);Hi.pick({state:!0,details:!0,timestamps:!0,assets:!0,party:!0,secrets:!0,instance:!0,type:!0}).extend({type:Hi.shape.type.optional(),instance:Hi.shape.instance.optional()}).nullable();const sd=s=>pn(s,Se.SET_ACTIVITY,yl),id=s=>pn(s,Se.SET_CONFIG,_l);function rd({sendCommand:s,cmd:e,response:t,fallbackTransform:i,transferTransform:a=()=>{}}){const l=Oi.extend({cmd:Bt(e),data:t});return async u=>{try{const d=await s({cmd:e,args:u,transfer:a(u)});return l.parse(d).data}catch(d){if(d.code===wa.INVALID_PAYLOAD){const E=i(u),g=await s({cmd:e,args:E,transfer:a(E)});return l.parse(g).data}else throw d}}}const ad=s=>({lock_state:s.lock_state,picture_in_picture_lock_state:s.picture_in_picture_lock_state}),od=s=>rd({sendCommand:s,cmd:Se.SET_ORIENTATION_LOCK_STATE,response:or,fallbackTransform:ad}),ld=s=>pn(s,Se.START_PURCHASE,vl),cd=s=>pn(s,Se.USER_SETTINGS_GET_LOCALE,wl),fd=jr(ss.INITIATE_IMAGE_UPLOAD),ud=s=>pn(s,Se.GET_CHANNEL,Ii),dd=jr(ss.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS);function hd(s){return{authenticate:zu(s),authorize:Wu(s),captureLog:Ku(s),encourageHardwareAcceleration:qu(s),getChannel:ud(s),getChannelPermissions:Ju(s),getEntitlements:Yu(s),getPlatformBehaviors:Qu(s),getSkus:Xu(s),openExternalLink:ed(s),openInviteDialog:td(s),openShareMomentDialog:nd(s),setActivity:sd(s),setConfig:id(s),setOrientationLockState:od(s),startPurchase:ld(s),userSettingsGetLocale:cd(s),initiateImageUpload:fd(s),getInstanceConnectedParticipants:dd(s)}}class pd extends Error{constructor(e,t=""){super(t),this.code=e,this.message=t,this.name="Discord SDK Error"}}function Al(){return{disableConsoleLogOverride:!1}}const gd=["log","warn","debug","info","error"];function md(s,e,t){const i=s[e],a=s;i&&(s[e]=function(){const l=[].slice.call(arguments),u=""+l.join(" ");t(e,u),i.apply(a,l)})}var yd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),mo={randomUUID:yd},Er,bd=new Uint8Array(16);function Ed(){if(!Er&&(Er=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Er))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Er(bd)}var Ht=[];for(var ia=0;ia<256;++ia)Ht.push((ia+256).toString(16).slice(1));function vd(s,e=0){return(Ht[s[e+0]]+Ht[s[e+1]]+Ht[s[e+2]]+Ht[s[e+3]]+"-"+Ht[s[e+4]]+Ht[s[e+5]]+"-"+Ht[s[e+6]]+Ht[s[e+7]]+"-"+Ht[s[e+8]]+Ht[s[e+9]]+"-"+Ht[s[e+10]]+Ht[s[e+11]]+Ht[s[e+12]]+Ht[s[e+13]]+Ht[s[e+14]]+Ht[s[e+15]]).toLowerCase()}function yo(s,e,t){if(mo.randomUUID&&!e&&!s)return mo.randomUUID();s=s||{};var i=s.random||(s.rng||Ed)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,vd(i)}var Es;(function(s){s[s.HANDSHAKE=0]="HANDSHAKE",s[s.FRAME=1]="FRAME",s[s.CLOSE=2]="CLOSE",s[s.HELLO=3]="HELLO"})(Es||(Es={}));const _d=new Set(wd());function wd(){return typeof window>"u"?[]:[window.location.origin,"https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]}function Td(){var s;return[(s=window.parent.opener)!==null&&s!==void 0?s:window.parent,document.referrer?document.referrer:"*"]}class Id{getTransfer(e){var t;switch(e.cmd){case Se.SUBSCRIBE:case Se.UNSUBSCRIBE:return;default:return(t=e.transfer)!==null&&t!==void 0?t:void 0}}constructor(e,t){if(this.source=null,this.sourceOrigin="",this.eventBus=new Go,this.pendingCommands=new Map,this.sendCommand=d=>{var E;if(this.source==null)throw new Error("Attempting to send message before initialization");const g=yo();return(E=this.source)===null||E===void 0||E.postMessage([Es.FRAME,Object.assign(Object.assign({},d),{nonce:g})],this.sourceOrigin,this.getTransfer(d)),new Promise((p,I)=>{this.pendingCommands.set(g,{resolve:p,reject:I})})},this.commands=hd(this.sendCommand),this.handleMessage=d=>{if(!_d.has(d.origin))return;const E=d.data;if(!Array.isArray(E))return;const[g,y]=E;switch(g){case Es.HELLO:return;case Es.CLOSE:return this.handleClose(y);case Es.HANDSHAKE:return this.handleHandshake();case Es.FRAME:return this.handleFrame(y);default:throw new Error("Invalid message format")}},this.isReady=!1,this.clientId=e,this.configuration=t??Al(),typeof window<"u"&&window.addEventListener("message",this.handleMessage),typeof window>"u"){this.frameId="",this.instanceId="",this.platform=vs.DESKTOP,this.guildId=null,this.channelId=null;return}const i=new URLSearchParams(this._getSearch()),a=i.get("frame_id");if(!a)throw new Error("frame_id query param is not defined");this.frameId=a;const l=i.get("instance_id");if(!l)throw new Error("instance_id query param is not defined");this.instanceId=l;const u=i.get("platform");if(u){if(u!==vs.DESKTOP&&u!==vs.MOBILE)throw new Error(`Invalid query param "platform" of "${u}". Valid values are "${vs.DESKTOP}" or "${vs.MOBILE}"`)}else throw new Error("platform query param is not defined");this.platform=u,this.guildId=i.get("guild_id"),this.channelId=i.get("channel_id"),[this.source,this.sourceOrigin]=Td(),this.addOnReadyListener(),this.handshake()}close(e,t){var i;window.removeEventListener("message",this.handleMessage);const a=yo();(i=this.source)===null||i===void 0||i.postMessage([Es.CLOSE,{code:e,message:t,nonce:a}],this.sourceOrigin)}async subscribe(e,t,...i){const[a]=i,l=this.eventBus.listenerCount(e),u=this.eventBus.on(e,t);return Object.values(nt).includes(e)&&e!==nt.READY&&l===0&&await this.sendCommand({cmd:Se.SUBSCRIBE,args:a,evt:e}),u}async unsubscribe(e,t,...i){const[a]=i;return e!==nt.READY&&this.eventBus.listenerCount(e)===1&&await this.sendCommand({cmd:Se.UNSUBSCRIBE,evt:e,args:a}),this.eventBus.off(e,t)}async ready(){this.isReady||await new Promise(e=>{this.eventBus.once(nt.READY,e)})}handshake(){var e;(e=this.source)===null||e===void 0||e.postMessage([Es.HANDSHAKE,{v:1,encoding:"json",client_id:this.clientId,frame_id:this.frameId}],this.sourceOrigin)}addOnReadyListener(){this.eventBus.once(nt.READY,()=>{this.overrideConsoleLogging(),this.isReady=!0})}overrideConsoleLogging(){if(this.configuration.disableConsoleLogOverride)return;const e=(t,i)=>{this.commands.captureLog({level:t,message:i})};gd.forEach(t=>{md(console,t,e)})}handleClose(e){Hu.parse(e)}handleHandshake(){}handleFrame(e){var t,i;let a;try{a=Zu(e)}catch(l){console.error("Failed to parse",e),console.error(l);return}if(a.cmd==="DISPATCH")this.eventBus.emit(a.evt,a.data);else{if(a.evt===Ha){if(a.nonce!=null){(t=this.pendingCommands.get(a.nonce))===null||t===void 0||t.reject(a.data),this.pendingCommands.delete(a.nonce);return}this.eventBus.emit("error",new pd(a.data.code,a.data.message))}if(a.nonce==null){console.error("Missing nonce",e);return}(i=this.pendingCommands.get(a.nonce))===null||i===void 0||i.resolve(a),this.pendingCommands.delete(a.nonce)}}_getSearch(){return typeof window>"u"?"":window.location.search}}var xi=1e9,Sd={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Pl,yt=!0,Pn="[DecimalError] ",di=Pn+"Invalid argument: ",Ga=Pn+"Exponent out of range: ",Di=Math.floor,fi=Math.pow,Ad=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,In,Ft=1e7,gt=7,Ol=9007199254740991,Lr=Di(Ol/gt),ge={};ge.absoluteValue=ge.abs=function(){var s=new this.constructor(this);return s.s&&(s.s=1),s};ge.comparedTo=ge.cmp=function(s){var e,t,i,a,l=this;if(s=new l.constructor(s),l.s!==s.s)return l.s||-s.s;if(l.e!==s.e)return l.e>s.e^l.s<0?1:-1;for(i=l.d.length,a=s.d.length,e=0,t=i<a?i:a;e<t;++e)if(l.d[e]!==s.d[e])return l.d[e]>s.d[e]^l.s<0?1:-1;return i===a?0:i>a^l.s<0?1:-1};ge.decimalPlaces=ge.dp=function(){var s=this,e=s.d.length-1,t=(e-s.e)*gt;if(e=s.d[e],e)for(;e%10==0;e/=10)t--;return t<0?0:t};ge.dividedBy=ge.div=function(s){return _s(this,new this.constructor(s))};ge.dividedToIntegerBy=ge.idiv=function(s){var e=this,t=e.constructor;return ut(_s(e,new t(s),0,1),t.precision)};ge.equals=ge.eq=function(s){return!this.cmp(s)};ge.exponent=function(){return Nt(this)};ge.greaterThan=ge.gt=function(s){return this.cmp(s)>0};ge.greaterThanOrEqualTo=ge.gte=function(s){return this.cmp(s)>=0};ge.isInteger=ge.isint=function(){return this.e>this.d.length-2};ge.isNegative=ge.isneg=function(){return this.s<0};ge.isPositive=ge.ispos=function(){return this.s>0};ge.isZero=function(){return this.s===0};ge.lessThan=ge.lt=function(s){return this.cmp(s)<0};ge.lessThanOrEqualTo=ge.lte=function(s){return this.cmp(s)<1};ge.logarithm=ge.log=function(s){var e,t=this,i=t.constructor,a=i.precision,l=a+5;if(s===void 0)s=new i(10);else if(s=new i(s),s.s<1||s.eq(In))throw Error(Pn+"NaN");if(t.s<1)throw Error(Pn+(t.s?"NaN":"-Infinity"));return t.eq(In)?new i(0):(yt=!1,e=_s(rr(t,l),rr(s,l),l),yt=!0,ut(e,a))};ge.minus=ge.sub=function(s){var e=this;return s=new e.constructor(s),e.s==s.s?Rl(e,s):xl(e,(s.s=-s.s,s))};ge.modulo=ge.mod=function(s){var e,t=this,i=t.constructor,a=i.precision;if(s=new i(s),!s.s)throw Error(Pn+"NaN");return t.s?(yt=!1,e=_s(t,s,0,1).times(s),yt=!0,t.minus(e)):ut(new i(t),a)};ge.naturalExponential=ge.exp=function(){return Dl(this)};ge.naturalLogarithm=ge.ln=function(){return rr(this)};ge.negated=ge.neg=function(){var s=new this.constructor(this);return s.s=-s.s||0,s};ge.plus=ge.add=function(s){var e=this;return s=new e.constructor(s),e.s==s.s?xl(e,s):Rl(e,(s.s=-s.s,s))};ge.precision=ge.sd=function(s){var e,t,i,a=this;if(s!==void 0&&s!==!!s&&s!==1&&s!==0)throw Error(di+s);if(e=Nt(a)+1,i=a.d.length-1,t=i*gt+1,i=a.d[i],i){for(;i%10==0;i/=10)t--;for(i=a.d[0];i>=10;i/=10)t++}return s&&e>t?e:t};ge.squareRoot=ge.sqrt=function(){var s,e,t,i,a,l,u,d=this,E=d.constructor;if(d.s<1){if(!d.s)return new E(0);throw Error(Pn+"NaN")}for(s=Nt(d),yt=!1,a=Math.sqrt(+d),a==0||a==1/0?(e=is(d.d),(e.length+s)%2==0&&(e+="0"),a=Math.sqrt(e),s=Di((s+1)/2)-(s<0||s%2),a==1/0?e="5e"+s:(e=a.toExponential(),e=e.slice(0,e.indexOf("e")+1)+s),i=new E(e)):i=new E(a.toString()),t=E.precision,a=u=t+3;;)if(l=i,i=l.plus(_s(d,l,u+2)).times(.5),is(l.d).slice(0,u)===(e=is(i.d)).slice(0,u)){if(e=e.slice(u-3,u+1),a==u&&e=="4999"){if(ut(l,t+1,0),l.times(l).eq(d)){i=l;break}}else if(e!="9999")break;u+=4}return yt=!0,ut(i,t)};ge.times=ge.mul=function(s){var e,t,i,a,l,u,d,E,g,y=this,p=y.constructor,I=y.d,F=(s=new p(s)).d;if(!y.s||!s.s)return new p(0);for(s.s*=y.s,t=y.e+s.e,E=I.length,g=F.length,E<g&&(l=I,I=F,F=l,u=E,E=g,g=u),l=[],u=E+g,i=u;i--;)l.push(0);for(i=g;--i>=0;){for(e=0,a=E+i;a>i;)d=l[a]+F[i]*I[a-i-1]+e,l[a--]=d%Ft|0,e=d/Ft|0;l[a]=(l[a]+e)%Ft|0}for(;!l[--u];)l.pop();return e?++t:l.shift(),s.d=l,s.e=t,yt?ut(s,p.precision):s};ge.toDecimalPlaces=ge.todp=function(s,e){var t=this,i=t.constructor;return t=new i(t),s===void 0?t:(ls(s,0,xi),e===void 0?e=i.rounding:ls(e,0,8),ut(t,s+Nt(t)+1,e))};ge.toExponential=function(s,e){var t,i=this,a=i.constructor;return s===void 0?t=gi(i,!0):(ls(s,0,xi),e===void 0?e=a.rounding:ls(e,0,8),i=ut(new a(i),s+1,e),t=gi(i,!0,s+1)),t};ge.toFixed=function(s,e){var t,i,a=this,l=a.constructor;return s===void 0?gi(a):(ls(s,0,xi),e===void 0?e=l.rounding:ls(e,0,8),i=ut(new l(a),s+Nt(a)+1,e),t=gi(i.abs(),!1,s+Nt(i)+1),a.isneg()&&!a.isZero()?"-"+t:t)};ge.toInteger=ge.toint=function(){var s=this,e=s.constructor;return ut(new e(s),Nt(s)+1,e.rounding)};ge.toNumber=function(){return+this};ge.toPower=ge.pow=function(s){var e,t,i,a,l,u,d=this,E=d.constructor,g=12,y=+(s=new E(s));if(!s.s)return new E(In);if(d=new E(d),!d.s){if(s.s<1)throw Error(Pn+"Infinity");return d}if(d.eq(In))return d;if(i=E.precision,s.eq(In))return ut(d,i);if(e=s.e,t=s.d.length-1,u=e>=t,l=d.s,u){if((t=y<0?-y:y)<=Ol){for(a=new E(In),e=Math.ceil(i/gt+4),yt=!1;t%2&&(a=a.times(d),Eo(a.d,e)),t=Di(t/2),t!==0;)d=d.times(d),Eo(d.d,e);return yt=!0,s.s<0?new E(In).div(a):ut(a,i)}}else if(l<0)throw Error(Pn+"NaN");return l=l<0&&s.d[Math.max(e,t)]&1?-1:1,d.s=1,yt=!1,a=s.times(rr(d,i+g)),yt=!0,a=Dl(a),a.s=l,a};ge.toPrecision=function(s,e){var t,i,a=this,l=a.constructor;return s===void 0?(t=Nt(a),i=gi(a,t<=l.toExpNeg||t>=l.toExpPos)):(ls(s,1,xi),e===void 0?e=l.rounding:ls(e,0,8),a=ut(new l(a),s,e),t=Nt(a),i=gi(a,s<=t||t<=l.toExpNeg,s)),i};ge.toSignificantDigits=ge.tosd=function(s,e){var t=this,i=t.constructor;return s===void 0?(s=i.precision,e=i.rounding):(ls(s,1,xi),e===void 0?e=i.rounding:ls(e,0,8)),ut(new i(t),s,e)};ge.toString=ge.valueOf=ge.val=ge.toJSON=ge[Symbol.for("nodejs.util.inspect.custom")]=function(){var s=this,e=Nt(s),t=s.constructor;return gi(s,e<=t.toExpNeg||e>=t.toExpPos)};function xl(s,e){var t,i,a,l,u,d,E,g,y=s.constructor,p=y.precision;if(!s.s||!e.s)return e.s||(e=new y(s)),yt?ut(e,p):e;if(E=s.d,g=e.d,u=s.e,a=e.e,E=E.slice(),l=u-a,l){for(l<0?(i=E,l=-l,d=g.length):(i=g,a=u,d=E.length),u=Math.ceil(p/gt),d=u>d?u+1:d+1,l>d&&(l=d,i.length=1),i.reverse();l--;)i.push(0);i.reverse()}for(d=E.length,l=g.length,d-l<0&&(l=d,i=g,g=E,E=i),t=0;l;)t=(E[--l]=E[l]+g[l]+t)/Ft|0,E[l]%=Ft;for(t&&(E.unshift(t),++a),d=E.length;E[--d]==0;)E.pop();return e.d=E,e.e=a,yt?ut(e,p):e}function ls(s,e,t){if(s!==~~s||s<e||s>t)throw Error(di+s)}function is(s){var e,t,i,a=s.length-1,l="",u=s[0];if(a>0){for(l+=u,e=1;e<a;e++)i=s[e]+"",t=gt-i.length,t&&(l+=Ds(t)),l+=i;u=s[e],i=u+"",t=gt-i.length,t&&(l+=Ds(t))}else if(u===0)return"0";for(;u%10===0;)u/=10;return l+u}var _s=function(){function s(i,a){var l,u=0,d=i.length;for(i=i.slice();d--;)l=i[d]*a+u,i[d]=l%Ft|0,u=l/Ft|0;return u&&i.unshift(u),i}function e(i,a,l,u){var d,E;if(l!=u)E=l>u?1:-1;else for(d=E=0;d<l;d++)if(i[d]!=a[d]){E=i[d]>a[d]?1:-1;break}return E}function t(i,a,l){for(var u=0;l--;)i[l]-=u,u=i[l]<a[l]?1:0,i[l]=u*Ft+i[l]-a[l];for(;!i[0]&&i.length>1;)i.shift()}return function(i,a,l,u){var d,E,g,y,p,I,F,J,z,W,he,ne,ue,Pe,We,Je,it,mt,at=i.constructor,ot=i.s==a.s?1:-1,rt=i.d,Fe=a.d;if(!i.s)return new at(i);if(!a.s)throw Error(Pn+"Division by zero");for(E=i.e-a.e,it=Fe.length,We=rt.length,F=new at(ot),J=F.d=[],g=0;Fe[g]==(rt[g]||0);)++g;if(Fe[g]>(rt[g]||0)&&--E,l==null?ne=l=at.precision:u?ne=l+(Nt(i)-Nt(a))+1:ne=l,ne<0)return new at(0);if(ne=ne/gt+2|0,g=0,it==1)for(y=0,Fe=Fe[0],ne++;(g<We||y)&&ne--;g++)ue=y*Ft+(rt[g]||0),J[g]=ue/Fe|0,y=ue%Fe|0;else{for(y=Ft/(Fe[0]+1)|0,y>1&&(Fe=s(Fe,y),rt=s(rt,y),it=Fe.length,We=rt.length),Pe=it,z=rt.slice(0,it),W=z.length;W<it;)z[W++]=0;mt=Fe.slice(),mt.unshift(0),Je=Fe[0],Fe[1]>=Ft/2&&++Je;do y=0,d=e(Fe,z,it,W),d<0?(he=z[0],it!=W&&(he=he*Ft+(z[1]||0)),y=he/Je|0,y>1?(y>=Ft&&(y=Ft-1),p=s(Fe,y),I=p.length,W=z.length,d=e(p,z,I,W),d==1&&(y--,t(p,it<I?mt:Fe,I))):(y==0&&(d=y=1),p=Fe.slice()),I=p.length,I<W&&p.unshift(0),t(z,p,W),d==-1&&(W=z.length,d=e(Fe,z,it,W),d<1&&(y++,t(z,it<W?mt:Fe,W))),W=z.length):d===0&&(y++,z=[0]),J[g++]=y,d&&z[0]?z[W++]=rt[Pe]||0:(z=[rt[Pe]],W=1);while((Pe++<We||z[0]!==void 0)&&ne--)}return J[0]||J.shift(),F.e=E,ut(F,u?l+Nt(F)+1:l)}}();function Dl(s,e){var t,i,a,l,u,d,E=0,g=0,y=s.constructor,p=y.precision;if(Nt(s)>16)throw Error(Ga+Nt(s));if(!s.s)return new y(In);for(e==null?(yt=!1,d=p):d=e,u=new y(.03125);s.abs().gte(.1);)s=s.times(u),g+=5;for(i=Math.log(fi(2,g))/Math.LN10*2+5|0,d+=i,t=a=l=new y(In),y.precision=d;;){if(a=ut(a.times(s),d),t=t.times(++E),u=l.plus(_s(a,t,d)),is(u.d).slice(0,d)===is(l.d).slice(0,d)){for(;g--;)l=ut(l.times(l),d);return y.precision=p,e==null?(yt=!0,ut(l,p)):l}l=u}}function Nt(s){for(var e=s.e*gt,t=s.d[0];t>=10;t/=10)e++;return e}function ra(s,e,t){if(e>s.LN10.sd())throw yt=!0,t&&(s.precision=t),Error(Pn+"LN10 precision limit exceeded");return ut(new s(s.LN10),e)}function Ds(s){for(var e="";s--;)e+="0";return e}function rr(s,e){var t,i,a,l,u,d,E,g,y,p=1,I=10,F=s,J=F.d,z=F.constructor,W=z.precision;if(F.s<1)throw Error(Pn+(F.s?"NaN":"-Infinity"));if(F.eq(In))return new z(0);if(e==null?(yt=!1,g=W):g=e,F.eq(10))return e==null&&(yt=!0),ra(z,g);if(g+=I,z.precision=g,t=is(J),i=t.charAt(0),l=Nt(F),Math.abs(l)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)F=F.times(s),t=is(F.d),i=t.charAt(0),p++;l=Nt(F),i>1?(F=new z("0."+t),l++):F=new z(i+"."+t.slice(1))}else return E=ra(z,g+2,W).times(l+""),F=rr(new z(i+"."+t.slice(1)),g-I).plus(E),z.precision=W,e==null?(yt=!0,ut(F,W)):F;for(d=u=F=_s(F.minus(In),F.plus(In),g),y=ut(F.times(F),g),a=3;;){if(u=ut(u.times(y),g),E=d.plus(_s(u,new z(a),g)),is(E.d).slice(0,g)===is(d.d).slice(0,g))return d=d.times(2),l!==0&&(d=d.plus(ra(z,g+2,W).times(l+""))),d=_s(d,new z(p),g),z.precision=W,e==null?(yt=!0,ut(d,W)):d;d=E,a+=2}}function bo(s,e){var t,i,a;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;)++i;for(a=e.length;e.charCodeAt(a-1)===48;)--a;if(e=e.slice(i,a),e){if(a-=i,t=t-i-1,s.e=Di(t/gt),s.d=[],i=(t+1)%gt,t<0&&(i+=gt),i<a){for(i&&s.d.push(+e.slice(0,i)),a-=gt;i<a;)s.d.push(+e.slice(i,i+=gt));e=e.slice(i),i=gt-e.length}else i-=a;for(;i--;)e+="0";if(s.d.push(+e),yt&&(s.e>Lr||s.e<-Lr))throw Error(Ga+t)}else s.s=0,s.e=0,s.d=[0];return s}function ut(s,e,t){var i,a,l,u,d,E,g,y,p=s.d;for(u=1,l=p[0];l>=10;l/=10)u++;if(i=e-u,i<0)i+=gt,a=e,g=p[y=0];else{if(y=Math.ceil((i+1)/gt),l=p.length,y>=l)return s;for(g=l=p[y],u=1;l>=10;l/=10)u++;i%=gt,a=i-gt+u}if(t!==void 0&&(l=fi(10,u-a-1),d=g/l%10|0,E=e<0||p[y+1]!==void 0||g%l,E=t<4?(d||E)&&(t==0||t==(s.s<0?3:2)):d>5||d==5&&(t==4||E||t==6&&(i>0?a>0?g/fi(10,u-a):0:p[y-1])%10&1||t==(s.s<0?8:7))),e<1||!p[0])return E?(l=Nt(s),p.length=1,e=e-l-1,p[0]=fi(10,(gt-e%gt)%gt),s.e=Di(-e/gt)||0):(p.length=1,p[0]=s.e=s.s=0),s;if(i==0?(p.length=y,l=1,y--):(p.length=y+1,l=fi(10,gt-i),p[y]=a>0?(g/fi(10,u-a)%fi(10,a)|0)*l:0),E)for(;;)if(y==0){(p[0]+=l)==Ft&&(p[0]=1,++s.e);break}else{if(p[y]+=l,p[y]!=Ft)break;p[y--]=0,l=1}for(i=p.length;p[--i]===0;)p.pop();if(yt&&(s.e>Lr||s.e<-Lr))throw Error(Ga+Nt(s));return s}function Rl(s,e){var t,i,a,l,u,d,E,g,y,p,I=s.constructor,F=I.precision;if(!s.s||!e.s)return e.s?e.s=-e.s:e=new I(s),yt?ut(e,F):e;if(E=s.d,p=e.d,i=e.e,g=s.e,E=E.slice(),u=g-i,u){for(y=u<0,y?(t=E,u=-u,d=p.length):(t=p,i=g,d=E.length),a=Math.max(Math.ceil(F/gt),d)+2,u>a&&(u=a,t.length=1),t.reverse(),a=u;a--;)t.push(0);t.reverse()}else{for(a=E.length,d=p.length,y=a<d,y&&(d=a),a=0;a<d;a++)if(E[a]!=p[a]){y=E[a]<p[a];break}u=0}for(y&&(t=E,E=p,p=t,e.s=-e.s),d=E.length,a=p.length-d;a>0;--a)E[d++]=0;for(a=p.length;a>u;){if(E[--a]<p[a]){for(l=a;l&&E[--l]===0;)E[l]=Ft-1;--E[l],E[a]+=Ft}E[a]-=p[a]}for(;E[--d]===0;)E.pop();for(;E[0]===0;E.shift())--i;return E[0]?(e.d=E,e.e=i,yt?ut(e,F):e):new I(0)}function gi(s,e,t){var i,a=Nt(s),l=is(s.d),u=l.length;return e?(t&&(i=t-u)>0?l=l.charAt(0)+"."+l.slice(1)+Ds(i):u>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(a<0?"e":"e+")+a):a<0?(l="0."+Ds(-a-1)+l,t&&(i=t-u)>0&&(l+=Ds(i))):a>=u?(l+=Ds(a+1-u),t&&(i=t-a-1)>0&&(l=l+"."+Ds(i))):((i=a+1)<u&&(l=l.slice(0,i)+"."+l.slice(i)),t&&(i=t-u)>0&&(a+1===u&&(l+="."),l+=Ds(i))),s.s<0?"-"+l:l}function Eo(s,e){if(s.length>e)return s.length=e,!0}function Nl(s){var e,t,i;function a(l){var u=this;if(!(u instanceof a))return new a(l);if(u.constructor=a,l instanceof a){u.s=l.s,u.e=l.e,u.d=(l=l.d)?l.slice():l;return}if(typeof l=="number"){if(l*0!==0)throw Error(di+l);if(l>0)u.s=1;else if(l<0)l=-l,u.s=-1;else{u.s=0,u.e=0,u.d=[0];return}if(l===~~l&&l<1e7){u.e=0,u.d=[l];return}return bo(u,l.toString())}else if(typeof l!="string")throw Error(di+l);if(l.charCodeAt(0)===45?(l=l.slice(1),u.s=-1):u.s=1,Ad.test(l))bo(u,l);else throw Error(di+l)}if(a.prototype=ge,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=Nl,a.config=a.set=Od,s===void 0&&(s={}),s)for(i=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<i.length;)s.hasOwnProperty(t=i[e++])||(s[t]=this[t]);return a.config(s),a}function Od(s){if(!s||typeof s!="object")throw Error(Pn+"Object expected");var e,t,i,a=["precision",1,xi,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<a.length;e+=3)if((i=s[t=a[e]])!==void 0)if(Di(i)===i&&i>=a[e+1]&&i<=a[e+2])this[t]=i;else throw Error(di+t+": "+i);if((i=s[t="LN10"])!==void 0)if(i==Math.LN10)this[t]=new this(i);else throw Error(di+t+": "+i);return this}var Pl=Nl(Sd);In=new Pl(1);var L;(function(s){s.AED="aed",s.AFN="afn",s.ALL="all",s.AMD="amd",s.ANG="ang",s.AOA="aoa",s.ARS="ars",s.AUD="aud",s.AWG="awg",s.AZN="azn",s.BAM="bam",s.BBD="bbd",s.BDT="bdt",s.BGN="bgn",s.BHD="bhd",s.BIF="bif",s.BMD="bmd",s.BND="bnd",s.BOB="bob",s.BOV="bov",s.BRL="brl",s.BSD="bsd",s.BTN="btn",s.BWP="bwp",s.BYN="byn",s.BYR="byr",s.BZD="bzd",s.CAD="cad",s.CDF="cdf",s.CHE="che",s.CHF="chf",s.CHW="chw",s.CLF="clf",s.CLP="clp",s.CNY="cny",s.COP="cop",s.COU="cou",s.CRC="crc",s.CUC="cuc",s.CUP="cup",s.CVE="cve",s.CZK="czk",s.DJF="djf",s.DKK="dkk",s.DOP="dop",s.DZD="dzd",s.EGP="egp",s.ERN="ern",s.ETB="etb",s.EUR="eur",s.FJD="fjd",s.FKP="fkp",s.GBP="gbp",s.GEL="gel",s.GHS="ghs",s.GIP="gip",s.GMD="gmd",s.GNF="gnf",s.GTQ="gtq",s.GYD="gyd",s.HKD="hkd",s.HNL="hnl",s.HRK="hrk",s.HTG="htg",s.HUF="huf",s.IDR="idr",s.ILS="ils",s.INR="inr",s.IQD="iqd",s.IRR="irr",s.ISK="isk",s.JMD="jmd",s.JOD="jod",s.JPY="jpy",s.KES="kes",s.KGS="kgs",s.KHR="khr",s.KMF="kmf",s.KPW="kpw",s.KRW="krw",s.KWD="kwd",s.KYD="kyd",s.KZT="kzt",s.LAK="lak",s.LBP="lbp",s.LKR="lkr",s.LRD="lrd",s.LSL="lsl",s.LTL="ltl",s.LVL="lvl",s.LYD="lyd",s.MAD="mad",s.MDL="mdl",s.MGA="mga",s.MKD="mkd",s.MMK="mmk",s.MNT="mnt",s.MOP="mop",s.MRO="mro",s.MUR="mur",s.MVR="mvr",s.MWK="mwk",s.MXN="mxn",s.MXV="mxv",s.MYR="myr",s.MZN="mzn",s.NAD="nad",s.NGN="ngn",s.NIO="nio",s.NOK="nok",s.NPR="npr",s.NZD="nzd",s.OMR="omr",s.PAB="pab",s.PEN="pen",s.PGK="pgk",s.PHP="php",s.PKR="pkr",s.PLN="pln",s.PYG="pyg",s.QAR="qar",s.RON="ron",s.RSD="rsd",s.RUB="rub",s.RWF="rwf",s.SAR="sar",s.SBD="sbd",s.SCR="scr",s.SDG="sdg",s.SEK="sek",s.SGD="sgd",s.SHP="shp",s.SLL="sll",s.SOS="sos",s.SRD="srd",s.SSP="ssp",s.STD="std",s.SVC="svc",s.SYP="syp",s.SZL="szl",s.THB="thb",s.TJS="tjs",s.TMT="tmt",s.TND="tnd",s.TOP="top",s.TRY="try",s.TTD="ttd",s.TWD="twd",s.TZS="tzs",s.UAH="uah",s.UGX="ugx",s.USD="usd",s.USN="usn",s.USS="uss",s.UYI="uyi",s.UYU="uyu",s.UZS="uzs",s.VEF="vef",s.VND="vnd",s.VUV="vuv",s.WST="wst",s.XAF="xaf",s.XAG="xag",s.XAU="xau",s.XBA="xba",s.XBB="xbb",s.XBC="xbc",s.XBD="xbd",s.XCD="xcd",s.XDR="xdr",s.XFU="xfu",s.XOF="xof",s.XPD="xpd",s.XPF="xpf",s.XPT="xpt",s.XSU="xsu",s.XTS="xts",s.XUA="xua",s.YER="yer",s.ZAR="zar",s.ZMW="zmw",s.ZWL="zwl"})(L||(L={}));L.AED+"",L.AFN+"",L.ALL+"",L.AMD+"",L.ANG+"",L.AOA+"",L.ARS+"",L.AUD+"",L.AWG+"",L.AZN+"",L.BAM+"",L.BBD+"",L.BDT+"",L.BGN+"",L.BHD+"",L.BIF+"",L.BMD+"",L.BND+"",L.BOB+"",L.BOV+"",L.BRL+"",L.BSD+"",L.BTN+"",L.BWP+"",L.BYR+"",L.BYN+"",L.BZD+"",L.CAD+"",L.CDF+"",L.CHE+"",L.CHF+"",L.CHW+"",L.CLF+"",L.CLP+"",L.CNY+"",L.COP+"",L.COU+"",L.CRC+"",L.CUC+"",L.CUP+"",L.CVE+"",L.CZK+"",L.DJF+"",L.DKK+"",L.DOP+"",L.DZD+"",L.EGP+"",L.ERN+"",L.ETB+"",L.EUR+"",L.FJD+"",L.FKP+"",L.GBP+"",L.GEL+"",L.GHS+"",L.GIP+"",L.GMD+"",L.GNF+"",L.GTQ+"",L.GYD+"",L.HKD+"",L.HNL+"",L.HRK+"",L.HTG+"",L.HUF+"",L.IDR+"",L.ILS+"",L.INR+"",L.IQD+"",L.IRR+"",L.ISK+"",L.JMD+"",L.JOD+"",L.JPY+"",L.KES+"",L.KGS+"",L.KHR+"",L.KMF+"",L.KPW+"",L.KRW+"",L.KWD+"",L.KYD+"",L.KZT+"",L.LAK+"",L.LBP+"",L.LKR+"",L.LRD+"",L.LSL+"",L.LTL+"",L.LVL+"",L.LYD+"",L.MAD+"",L.MDL+"",L.MGA+"",L.MKD+"",L.MMK+"",L.MNT+"",L.MOP+"",L.MRO+"",L.MUR+"",L.MVR+"",L.MWK+"",L.MXN+"",L.MXV+"",L.MYR+"",L.MZN+"",L.NAD+"",L.NGN+"",L.NIO+"",L.NOK+"",L.NPR+"",L.NZD+"",L.OMR+"",L.PAB+"",L.PEN+"",L.PGK+"",L.PHP+"",L.PKR+"",L.PLN+"",L.PYG+"",L.QAR+"",L.RON+"",L.RSD+"",L.RUB+"",L.RWF+"",L.SAR+"",L.SBD+"",L.SCR+"",L.SDG+"",L.SEK+"",L.SGD+"",L.SHP+"",L.SLL+"",L.SOS+"",L.SRD+"",L.SSP+"",L.STD+"",L.SVC+"",L.SYP+"",L.SZL+"",L.THB+"",L.TJS+"",L.TMT+"",L.TND+"",L.TOP+"",L.TRY+"",L.TTD+"",L.TWD+"",L.TZS+"",L.UAH+"",L.UGX+"",L.USD+"",L.USN+"",L.USS+"",L.UYI+"",L.UYU+"",L.UZS+"",L.VEF+"",L.VND+"",L.VUV+"",L.WST+"",L.XAF+"",L.XAG+"",L.XAU+"",L.XBA+"",L.XBB+"",L.XBC+"",L.XBD+"",L.XCD+"",L.XDR+"",L.XFU+"",L.XOF+"",L.XPD+"",L.XPF+"",L.XPT+"",L.XSU+"",L.XTS+"",L.XUA+"",L.YER+"",L.ZAR+"",L.ZMW+"",L.ZWL+"";var kr={exports:{}};kr.exports;(function(s,e){var t=200,i="Expected a function",a="__lodash_hash_undefined__",l=1,u=2,d=1/0,E=9007199254740991,g="[object Arguments]",y="[object Array]",p="[object Boolean]",I="[object Date]",F="[object Error]",J="[object Function]",z="[object GeneratorFunction]",W="[object Map]",he="[object Number]",ne="[object Object]",ue="[object Promise]",Pe="[object RegExp]",We="[object Set]",Je="[object String]",it="[object Symbol]",mt="[object WeakMap]",at="[object ArrayBuffer]",ot="[object DataView]",rt="[object Float32Array]",Fe="[object Float64Array]",M="[object Int8Array]",re="[object Int16Array]",ie="[object Int32Array]",ee="[object Uint8Array]",te="[object Uint8ClampedArray]",pe="[object Uint16Array]",xe="[object Uint32Array]",we=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ge=/^\w*$/,Ve=/^\./,lt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Tt=/[\\^$.*+?()[\]{}|]/g,Pt=/\\(\\)?/g,Is=/^\[object .+?Constructor\]$/,gn=/^(?:0|[1-9]\d*)$/,Ee={};Ee[rt]=Ee[Fe]=Ee[M]=Ee[re]=Ee[ie]=Ee[ee]=Ee[te]=Ee[pe]=Ee[xe]=!0,Ee[g]=Ee[y]=Ee[at]=Ee[p]=Ee[ot]=Ee[I]=Ee[F]=Ee[J]=Ee[W]=Ee[he]=Ee[ne]=Ee[Pe]=Ee[We]=Ee[Je]=Ee[mt]=!1;var Zt=typeof mr=="object"&&mr&&mr.Object===Object&&mr,It=typeof self=="object"&&self&&self.Object===Object&&self,Jt=Zt||It||Function("return this")(),us=e&&!e.nodeType&&e,zn=us&&!0&&s&&!s.nodeType&&s,Ss=zn&&zn.exports===us,Wn=Ss&&Zt.process,Kn=function(){try{return Wn&&Wn.binding("util")}catch{}}(),zt=Kn&&Kn.isTypedArray;function qn(v,O){for(var Z=-1,ae=v?v.length:0;++Z<ae&&O(v[Z],Z,v)!==!1;);return v}function mn(v,O){for(var Z=-1,ae=v?v.length:0;++Z<ae;)if(O(v[Z],Z,v))return!0;return!1}function tt(v){return function(O){return O==null?void 0:O[v]}}function $t(v,O){for(var Z=-1,ae=Array(v);++Z<v;)ae[Z]=O(Z);return ae}function Yn(v){return function(O){return v(O)}}function ds(v,O){return v==null?void 0:v[O]}function Te(v){var O=!1;if(v!=null&&typeof v.toString!="function")try{O=!!(v+"")}catch{}return O}function Qt(v){var O=-1,Z=Array(v.size);return v.forEach(function(ae,ke){Z[++O]=[ke,ae]}),Z}function b(v,O){return function(Z){return v(O(Z))}}function T(v){var O=-1,Z=Array(v.size);return v.forEach(function(ae){Z[++O]=ae}),Z}var x=Array.prototype,C=Function.prototype,G=Object.prototype,U=Jt["__core-js_shared__"],H=function(){var v=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Y=C.toString,Q=G.hasOwnProperty,ce=G.toString,De=RegExp("^"+Y.call(Q).replace(Tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Re=Jt.Symbol,Ie=Jt.Uint8Array,At=b(Object.getPrototypeOf,Object),Ae=Object.create,en=G.propertyIsEnumerable,Qe=x.splice,Hs=b(Object.keys,Object),Ke=_(Jt,"DataView"),Ct=_(Jt,"Map"),Cn=_(Jt,"Promise"),hs=_(Jt,"Set"),yn=_(Jt,"WeakMap"),Ln=_(Object,"create"),Gs=Oe(Ke),ps=Oe(Ct),Zs=Oe(Cn),kn=Oe(hs),Ri=Oe(yn),Xn=Re?Re.prototype:void 0,zs=Xn?Xn.valueOf:void 0,An=Xn?Xn.toString:void 0;function bn(v){var O=-1,Z=v?v.length:0;for(this.clear();++O<Z;){var ae=v[O];this.set(ae[0],ae[1])}}function Ws(){this.__data__=Ln?Ln(null):{}}function Ni(v){return this.has(v)&&delete this.__data__[v]}function bt(v){var O=this.__data__;if(Ln){var Z=O[v];return Z===a?void 0:Z}return Q.call(O,v)?O[v]:void 0}function Ks(v){var O=this.__data__;return Ln?O[v]!==void 0:Q.call(O,v)}function qs(v,O){var Z=this.__data__;return Z[v]=Ln&&O===void 0?a:O,this}bn.prototype.clear=Ws,bn.prototype.delete=Ni,bn.prototype.get=bt,bn.prototype.has=Ks,bn.prototype.set=qs;function ct(v){var O=-1,Z=v?v.length:0;for(this.clear();++O<Z;){var ae=v[O];this.set(ae[0],ae[1])}}function Ot(){this.__data__=[]}function Pi(v){var O=this.__data__,Z=un(O,v);if(Z<0)return!1;var ae=O.length-1;return Z==ae?O.pop():Qe.call(O,Z,1),!0}function Ys(v){var O=this.__data__,Z=un(O,v);return Z<0?void 0:O[Z][1]}function ht(v){return un(this.__data__,v)>-1}function Xs(v,O){var Z=this.__data__,ae=un(Z,v);return ae<0?Z.push([v,O]):Z[ae][1]=O,this}ct.prototype.clear=Ot,ct.prototype.delete=Pi,ct.prototype.get=Ys,ct.prototype.has=ht,ct.prototype.set=Xs;function En(v){var O=-1,Z=v?v.length:0;for(this.clear();++O<Z;){var ae=v[O];this.set(ae[0],ae[1])}}function Ci(){this.__data__={hash:new bn,map:new(Ct||ct),string:new bn}}function Js(v){return h(this,v).delete(v)}function Bn(v){return h(this,v).get(v)}function Li(v){return h(this,v).has(v)}function Qs(v,O){return h(this,v).set(v,O),this}En.prototype.clear=Ci,En.prototype.delete=Js,En.prototype.get=Bn,En.prototype.has=Li,En.prototype.set=Qs;function Jn(v){var O=-1,Z=v?v.length:0;for(this.__data__=new En;++O<Z;)this.add(v[O])}function Be(v){return this.__data__.set(v,a),this}function ei(v){return this.__data__.has(v)}Jn.prototype.add=Jn.prototype.push=Be,Jn.prototype.has=ei;function tn(v){this.__data__=new ct(v)}function vn(){this.__data__=new ct}function ti(v){return this.__data__.delete(v)}function ni(v){return this.__data__.get(v)}function _n(v){return this.__data__.has(v)}function Lt(v,O){var Z=this.__data__;if(Z instanceof ct){var ae=Z.__data__;if(!Ct||ae.length<t-1)return ae.push([v,O]),this;Z=this.__data__=new En(ae)}return Z.set(v,O),this}tn.prototype.clear=vn,tn.prototype.delete=ti,tn.prototype.get=ni,tn.prototype.has=_n,tn.prototype.set=Lt;function ki(v,O){var Z=gs(v)||Rt(v)?$t(v.length,String):[],ae=Z.length,ke=!!ae;for(var be in v)Q.call(v,be)&&!(ke&&(be=="length"||D(be,ae)))&&Z.push(be);return Z}function un(v,O){for(var Z=v.length;Z--;)if(je(v[Z][0],O))return Z;return-1}function si(v){return mi(v)?Ae(v):{}}var ii=n();function Bi(v,O){return v&&ii(v,O,dr)}function Qn(v,O){O=$(O,v)?[O]:f(O);for(var Z=0,ae=O.length;v!=null&&Z<ae;)v=v[me(O[Z++])];return Z&&Z==ae?v:void 0}function nn(v){return ce.call(v)}function sn(v,O){return v!=null&&O in Object(v)}function jt(v,O,Z,ae,ke){return v===O?!0:v==null||O==null||!mi(v)&&!ur(O)?v!==v&&O!==O:$i(v,O,jt,Z,ae,ke)}function $i(v,O,Z,ae,ke,be){var He=gs(v),xt=gs(O),St=y,Wt=y;He||(St=w(v),St=St==g?ne:St),xt||(Wt=w(O),Wt=Wt==g?ne:Wt);var dn=St==ne&&!Te(v),hn=Wt==ne&&!Te(O),on=St==Wt;if(on&&!dn)return be||(be=new tn),He||oo(v)?r(v,O,Z,ae,ke,be):o(v,O,St,Z,ae,ke,be);if(!(ke&u)){var On=dn&&Q.call(v,"__wrapped__"),xn=hn&&Q.call(O,"__wrapped__");if(On||xn){var As=On?v.value():v,ms=xn?O.value():O;return be||(be=new tn),Z(As,ms,ae,ke,be)}}return on?(be||(be=new tn),c(v,O,Z,ae,ke,be)):!1}function Mi(v,O,Z,ae){var ke=Z.length,be=ke;if(v==null)return!be;for(v=Object(v);ke--;){var He=Z[ke];if(He[2]?He[1]!==v[He[0]]:!(He[0]in v))return!1}for(;++ke<be;){He=Z[ke];var xt=He[0],St=v[xt],Wt=He[1];if(He[2]){if(St===void 0&&!(xt in v))return!1}else{var dn=new tn,hn;if(!(hn===void 0?jt(Wt,St,ae,l|u,dn):hn))return!1}}return!0}function Ui(v){if(!mi(v)||X(v))return!1;var O=ea(v)||Te(v)?De:Is;return O.test(Oe(v))}function Et(v){return ur(v)&&ta(v.length)&&!!Ee[ce.call(v)]}function pt(v){return typeof v=="function"?v:v==null?$c:typeof v=="object"?gs(v)?rn(v[0],v[1]):wn(v):Mc(v)}function kt(v){if(!K(v))return Hs(v);var O=[];for(var Z in Object(v))Q.call(v,Z)&&Z!="constructor"&&O.push(Z);return O}function wn(v){var O=m(v);return O.length==1&&O[0][2]?N(O[0][0],O[0][1]):function(Z){return Z===v||Mi(Z,v,O)}}function rn(v,O){return $(v)&&V(O)?N(me(v),O):function(Z){var ae=Lc(Z,v);return ae===void 0&&ae===O?kc(Z,v):jt(O,ae,void 0,l|u)}}function an(v){return function(O){return Qn(O,v)}}function $n(v){if(typeof v=="string")return v;if(na(v))return An?An.call(v):"";var O=v+"";return O=="0"&&1/v==-d?"-0":O}function f(v){return gs(v)?v:q(v)}function n(v){return function(O,Z,ae){for(var ke=-1,be=Object(O),He=ae(O),xt=He.length;xt--;){var St=He[++ke];if(Z(be[St],St,be)===!1)break}return O}}function r(v,O,Z,ae,ke,be){var He=ke&u,xt=v.length,St=O.length;if(xt!=St&&!(He&&St>xt))return!1;var Wt=be.get(v);if(Wt&&be.get(O))return Wt==O;var dn=-1,hn=!0,on=ke&l?new Jn:void 0;for(be.set(v,O),be.set(O,v);++dn<xt;){var On=v[dn],xn=O[dn];if(ae)var As=He?ae(xn,On,dn,O,v,be):ae(On,xn,dn,v,O,be);if(As!==void 0){if(As)continue;hn=!1;break}if(on){if(!mn(O,function(ms,ri){if(!on.has(ri)&&(On===ms||Z(On,ms,ae,ke,be)))return on.add(ri)})){hn=!1;break}}else if(!(On===xn||Z(On,xn,ae,ke,be))){hn=!1;break}}return be.delete(v),be.delete(O),hn}function o(v,O,Z,ae,ke,be,He){switch(Z){case ot:if(v.byteLength!=O.byteLength||v.byteOffset!=O.byteOffset)return!1;v=v.buffer,O=O.buffer;case at:return!(v.byteLength!=O.byteLength||!ae(new Ie(v),new Ie(O)));case p:case I:case he:return je(+v,+O);case F:return v.name==O.name&&v.message==O.message;case Pe:case Je:return v==O+"";case W:var xt=Qt;case We:var St=be&u;if(xt||(xt=T),v.size!=O.size&&!St)return!1;var Wt=He.get(v);if(Wt)return Wt==O;be|=l,He.set(v,O);var dn=r(xt(v),xt(O),ae,ke,be,He);return He.delete(v),dn;case it:if(zs)return zs.call(v)==zs.call(O)}return!1}function c(v,O,Z,ae,ke,be){var He=ke&u,xt=dr(v),St=xt.length,Wt=dr(O),dn=Wt.length;if(St!=dn&&!He)return!1;for(var hn=St;hn--;){var on=xt[hn];if(!(He?on in O:Q.call(O,on)))return!1}var On=be.get(v);if(On&&be.get(O))return On==O;var xn=!0;be.set(v,O),be.set(O,v);for(var As=He;++hn<St;){on=xt[hn];var ms=v[on],ri=O[on];if(ae)var lo=He?ae(ri,ms,on,O,v,be):ae(ms,ri,on,v,O,be);if(!(lo===void 0?ms===ri||Z(ms,ri,ae,ke,be):lo)){xn=!1;break}As||(As=on=="constructor")}if(xn&&!As){var hr=v.constructor,pr=O.constructor;hr!=pr&&"constructor"in v&&"constructor"in O&&!(typeof hr=="function"&&hr instanceof hr&&typeof pr=="function"&&pr instanceof pr)&&(xn=!1)}return be.delete(v),be.delete(O),xn}function h(v,O){var Z=v.__data__;return R(O)?Z[typeof O=="string"?"string":"hash"]:Z.map}function m(v){for(var O=dr(v),Z=O.length;Z--;){var ae=O[Z],ke=v[ae];O[Z]=[ae,ke,V(ke)]}return O}function _(v,O){var Z=ds(v,O);return Ui(Z)?Z:void 0}var w=nn;(Ke&&w(new Ke(new ArrayBuffer(1)))!=ot||Ct&&w(new Ct)!=W||Cn&&w(Cn.resolve())!=ue||hs&&w(new hs)!=We||yn&&w(new yn)!=mt)&&(w=function(v){var O=ce.call(v),Z=O==ne?v.constructor:void 0,ae=Z?Oe(Z):void 0;if(ae)switch(ae){case Gs:return ot;case ps:return W;case Zs:return ue;case kn:return We;case Ri:return mt}return O});function A(v,O,Z){O=$(O,v)?[O]:f(O);for(var ae,ke=-1,He=O.length;++ke<He;){var be=me(O[ke]);if(!(ae=v!=null&&Z(v,be)))break;v=v[be]}if(ae)return ae;var He=v?v.length:0;return!!He&&ta(He)&&D(be,He)&&(gs(v)||Rt(v))}function D(v,O){return O=O??E,!!O&&(typeof v=="number"||gn.test(v))&&v>-1&&v%1==0&&v<O}function $(v,O){if(gs(v))return!1;var Z=typeof v;return Z=="number"||Z=="symbol"||Z=="boolean"||v==null||na(v)?!0:Ge.test(v)||!we.test(v)||O!=null&&v in Object(O)}function R(v){var O=typeof v;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?v!=="__proto__":v===null}function X(v){return!!H&&H in v}function K(v){var O=v&&v.constructor,Z=typeof O=="function"&&O.prototype||G;return v===Z}function V(v){return v===v&&!mi(v)}function N(v,O){return function(Z){return Z==null?!1:Z[v]===O&&(O!==void 0||v in Object(Z))}}var q=Ze(function(v){v=Cc(v);var O=[];return Ve.test(v)&&O.push(""),v.replace(lt,function(Z,ae,ke,be){O.push(ke?be.replace(Pt,"$1"):ae||Z)}),O});function me(v){if(typeof v=="string"||na(v))return v;var O=v+"";return O=="0"&&1/v==-d?"-0":O}function Oe(v){if(v!=null){try{return Y.call(v)}catch{}try{return v+""}catch{}}return""}function Ze(v,O){if(typeof v!="function"||O&&typeof O!="function")throw new TypeError(i);var Z=function(){var ae=arguments,ke=O?O.apply(this,ae):ae[0],be=Z.cache;if(be.has(ke))return be.get(ke);var He=v.apply(this,ae);return Z.cache=be.set(ke,He),He};return Z.cache=new(Ze.Cache||En),Z}Ze.Cache=En;function je(v,O){return v===O||v!==v&&O!==O}function Rt(v){return Pc(v)&&Q.call(v,"callee")&&(!en.call(v,"callee")||ce.call(v)==g)}var gs=Array.isArray;function ao(v){return v!=null&&ta(v.length)&&!ea(v)}function Pc(v){return ur(v)&&ao(v)}function ea(v){var O=mi(v)?ce.call(v):"";return O==J||O==z}function ta(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=E}function mi(v){var O=typeof v;return!!v&&(O=="object"||O=="function")}function ur(v){return!!v&&typeof v=="object"}function na(v){return typeof v=="symbol"||ur(v)&&ce.call(v)==it}var oo=zt?Yn(zt):Et;function Cc(v){return v==null?"":$n(v)}function Lc(v,O,Z){var ae=v==null?void 0:Qn(v,O);return ae===void 0?Z:ae}function kc(v,O){return v!=null&&A(v,O,sn)}function dr(v){return ao(v)?ki(v):kt(v)}function Bc(v,O,Z){var ae=gs(v)||oo(v);if(O=pt(O),Z==null)if(ae||mi(v)){var ke=v.constructor;ae?Z=gs(v)?new ke:[]:Z=ea(ke)?si(At(v)):{}}else Z={};return(ae?qn:Bi)(v,function(be,He,xt){return O(Z,be,He,xt)}),Z}function $c(v){return v}function Mc(v){return $(v)?tt(me(v)):an(v)}s.exports=Bc})(kr,kr.exports);var xd=kr.exports,Dd=Ca(xd);class Cl{constructor(e,t,i){this.platform=vs.DESKTOP,this.instanceId="123456789012345678",this.configuration=Al(),this.source=null,this.sourceOrigin="",this.frameId="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",this.eventBus=new Go,this.clientId=e,this.commands=this._updateCommandMocks({}),this.guildId=t,this.channelId=i}_updateCommandMocks(e){return this.commands=Dd(Object.assign({},Rd,e),(t,i,a)=>{t[a]=async(...l)=>(console.info(`DiscordSDKMock: ${String(a)}(${JSON.stringify(l)})`),await i(...l))}),this.commands}emitReady(){this.emitEvent("READY",void 0)}close(...e){console.info(`DiscordSDKMock: close(${JSON.stringify(e)})`)}ready(){return Promise.resolve()}async subscribe(e,t,...i){return await this.eventBus.on(e,t)}async unsubscribe(e,t,...i){return await this.eventBus.off(e,t)}emitEvent(e,t){this.eventBus.emit(e,t)}}const Rd={authorize:()=>Promise.resolve({code:"mock_code"}),authenticate:()=>Promise.resolve({access_token:"mock_token",user:{username:"mock_user_username",discriminator:"mock_user_discriminator",id:"mock_user_id",avatar:null,public_flags:1},scopes:[],expires:new Date(2121,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}}),setActivity:()=>Promise.resolve({name:"mock_activity_name",type:0}),getChannel:()=>Promise.resolve({id:"mock_channel_id",name:"mock_channel_name",type:Va.GUILD_TEXT,voice_states:[],messages:[]}),getSkus:()=>Promise.resolve({skus:[]}),getEntitlements:()=>Promise.resolve({entitlements:[]}),startPurchase:()=>Promise.resolve([]),setConfig:()=>Promise.resolve({use_interactive_pip:!1}),userSettingsGetLocale:()=>Promise.resolve({locale:""}),openExternalLink:()=>Promise.resolve(null),encourageHardwareAcceleration:()=>Promise.resolve({enabled:!0}),captureLog:()=>Promise.resolve(null),setOrientationLockState:()=>Promise.resolve(null),openInviteDialog:()=>Promise.resolve(null),getPlatformBehaviors:()=>Promise.resolve({iosKeyboardResizesView:!0}),getChannelPermissions:()=>Promise.resolve({permissions:tl(1234567890)}),openShareMomentDialog:()=>Promise.resolve(null),initiateImageUpload:()=>Promise.resolve({image_url:"https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0b52aa9e99b832574a53_full_logo_blurple_RGB.png"}),getInstanceConnectedParticipants:()=>Promise.resolve({participants:[]})};var jn={};ArrayBuffer.isView||(ArrayBuffer.isView=s=>s!==null&&typeof s=="object"&&s.buffer instanceof ArrayBuffer);typeof FormData>"u"&&(Na.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var Za={},Sa=function(s,e){return Sa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])},Sa(s,e)};function Ll(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Sa(s,e);function t(){this.constructor=s}s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Br=function(){return Br=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++){t=arguments[i];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},Br.apply(this,arguments)};function kl(s,e){var t={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&e.indexOf(i)<0&&(t[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(s);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(s,i[a])&&(t[i[a]]=s[i[a]]);return t}function Bl(s,e,t,i){var a=arguments.length,l=a<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(s,e,t,i);else for(var d=s.length-1;d>=0;d--)(u=s[d])&&(l=(a<3?u(l):a>3?u(e,t,l):u(e,t))||l);return a>3&&l&&Object.defineProperty(e,t,l),l}function $l(s,e){return function(t,i){e(t,i,s)}}function Nd(s,e,t,i,a,l){function u(he){if(he!==void 0&&typeof he!="function")throw new TypeError("Function expected");return he}for(var d=i.kind,E=d==="getter"?"get":d==="setter"?"set":"value",g=!e&&s?i.static?s:s.prototype:null,y=e||(g?Object.getOwnPropertyDescriptor(g,i.name):{}),p,I=!1,F=t.length-1;F>=0;F--){var J={};for(var z in i)J[z]=z==="access"?{}:i[z];for(var z in i.access)J.access[z]=i.access[z];J.addInitializer=function(he){if(I)throw new TypeError("Cannot add initializers after decoration has completed");l.push(u(he||null))};var W=(0,t[F])(d==="accessor"?{get:y.get,set:y.set}:y[E],J);if(d==="accessor"){if(W===void 0)continue;if(W===null||typeof W!="object")throw new TypeError("Object expected");(p=u(W.get))&&(y.get=p),(p=u(W.set))&&(y.set=p),(p=u(W.init))&&a.unshift(p)}else(p=u(W))&&(d==="field"?a.unshift(p):y[E]=p)}g&&Object.defineProperty(g,i.name,y),I=!0}function Pd(s,e,t){for(var i=arguments.length>2,a=0;a<e.length;a++)t=i?e[a].call(s,t):e[a].call(s);return i?t:void 0}function Cd(s){return typeof s=="symbol"?s:"".concat(s)}function Ld(s,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function Ml(s,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,e)}function Ul(s,e,t,i){function a(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function d(y){try{g(i.next(y))}catch(p){u(p)}}function E(y){try{g(i.throw(y))}catch(p){u(p)}}function g(y){y.done?l(y.value):a(y.value).then(d,E)}g((i=i.apply(s,e||[])).next())})}function Fl(s,e){var t={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},i,a,l,u;return u={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function d(g){return function(y){return E([g,y])}}function E(g){if(i)throw new TypeError("Generator is already executing.");for(;u&&(u=0,g[0]&&(t=0)),t;)try{if(i=1,a&&(l=g[0]&2?a.return:g[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,g[1])).done)return l;switch(a=0,l&&(g=[g[0]&2,l.value]),g[0]){case 0:case 1:l=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,a=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(l=t.trys,!(l=l.length>0&&l[l.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!l||g[1]>l[0]&&g[1]<l[3])){t.label=g[1];break}if(g[0]===6&&t.label<l[1]){t.label=l[1],l=g;break}if(l&&t.label<l[2]){t.label=l[2],t.ops.push(g);break}l[2]&&t.ops.pop(),t.trys.pop();continue}g=e.call(s,t)}catch(y){g=[6,y],a=0}finally{i=l=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}var Hr=Object.create?function(s,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(s,i,a)}:function(s,e,t,i){i===void 0&&(i=t),s[i]=e[t]};function Vl(s,e){for(var t in s)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Hr(e,s,t)}function $r(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function za(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),a,l=[],u;try{for(;(e===void 0||e-- >0)&&!(a=i.next()).done;)l.push(a.value)}catch(d){u={error:d}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(u)throw u.error}}return l}function jl(){for(var s=[],e=0;e<arguments.length;e++)s=s.concat(za(arguments[e]));return s}function Hl(){for(var s=0,e=0,t=arguments.length;e<t;e++)s+=arguments[e].length;for(var i=Array(s),a=0,e=0;e<t;e++)for(var l=arguments[e],u=0,d=l.length;u<d;u++,a++)i[a]=l[u];return i}function Gl(s,e,t){if(t||arguments.length===2)for(var i=0,a=e.length,l;i<a;i++)(l||!(i in e))&&(l||(l=Array.prototype.slice.call(e,0,i)),l[i]=e[i]);return s.concat(l||Array.prototype.slice.call(e))}function Si(s){return this instanceof Si?(this.v=s,this):new Si(s)}function Zl(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(s,e||[]),a,l=[];return a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a;function u(I){i[I]&&(a[I]=function(F){return new Promise(function(J,z){l.push([I,F,J,z])>1||d(I,F)})})}function d(I,F){try{E(i[I](F))}catch(J){p(l[0][3],J)}}function E(I){I.value instanceof Si?Promise.resolve(I.value.v).then(g,y):p(l[0][2],I)}function g(I){d("next",I)}function y(I){d("throw",I)}function p(I,F){I(F),l.shift(),l.length&&d(l[0][0],l[0][1])}}function zl(s){var e,t;return e={},i("next"),i("throw",function(a){throw a}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(a,l){e[a]=s[a]?function(u){return(t=!t)?{value:Si(s[a](u)),done:!1}:l?l(u):u}:l}}function Wl(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],t;return e?e.call(s):(s=typeof $r=="function"?$r(s):s[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(l){t[l]=s[l]&&function(u){return new Promise(function(d,E){u=s[l](u),a(d,E,u.done,u.value)})}}function a(l,u,d,E){Promise.resolve(E).then(function(g){l({value:g,done:d})},u)}}function Kl(s,e){return Object.defineProperty?Object.defineProperty(s,"raw",{value:e}):s.raw=e,s}var kd=Object.create?function(s,e){Object.defineProperty(s,"default",{enumerable:!0,value:e})}:function(s,e){s.default=e};function ql(s){if(s&&s.__esModule)return s;var e={};if(s!=null)for(var t in s)t!=="default"&&Object.prototype.hasOwnProperty.call(s,t)&&Hr(e,s,t);return kd(e,s),e}function Yl(s){return s&&s.__esModule?s:{default:s}}function Xl(s,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!i:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(s):i?i.value:e.get(s)}function Jl(s,e,t,i,a){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!a:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?a.call(s,t):a?a.value=t:e.set(s,t),t}function Ql(s,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof s=="function"?e===s:s.has(e)}function ec(s,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=e[Symbol.asyncDispose]}if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=e[Symbol.dispose]}if(typeof i!="function")throw new TypeError("Object not disposable.");s.stack.push({value:e,dispose:i,async:t})}else t&&s.stack.push({async:!0});return e}var Bd=typeof SuppressedError=="function"?SuppressedError:function(s,e,t){var i=new Error(t);return i.name="SuppressedError",i.error=s,i.suppressed=e,i};function tc(s){function e(i){s.error=s.hasError?new Bd(i,s.error,"An error was suppressed during disposal."):i,s.hasError=!0}function t(){for(;s.stack.length;){var i=s.stack.pop();try{var a=i.dispose&&i.dispose.call(i.value);if(i.async)return Promise.resolve(a).then(t,function(l){return e(l),t()})}catch(l){e(l)}}if(s.hasError)throw s.error}return t()}const $d={__extends:Ll,__assign:Br,__rest:kl,__decorate:Bl,__param:$l,__metadata:Ml,__awaiter:Ul,__generator:Fl,__createBinding:Hr,__exportStar:Vl,__values:$r,__read:za,__spread:jl,__spreadArrays:Hl,__spreadArray:Gl,__await:Si,__asyncGenerator:Zl,__asyncDelegator:zl,__asyncValues:Wl,__makeTemplateObject:Kl,__importStar:ql,__importDefault:Yl,__classPrivateFieldGet:Xl,__classPrivateFieldSet:Jl,__classPrivateFieldIn:Ql,__addDisposableResource:ec,__disposeResources:tc},Md=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:ec,get __assign(){return Br},__asyncDelegator:zl,__asyncGenerator:Zl,__asyncValues:Wl,__await:Si,__awaiter:Ul,__classPrivateFieldGet:Xl,__classPrivateFieldIn:Ql,__classPrivateFieldSet:Jl,__createBinding:Hr,__decorate:Bl,__disposeResources:tc,__esDecorate:Nd,__exportStar:Vl,__extends:Ll,__generator:Fl,__importDefault:Yl,__importStar:ql,__makeTemplateObject:Kl,__metadata:Ml,__param:$l,__propKey:Cd,__read:za,__rest:kl,__runInitializers:Pd,__setFunctionName:Ld,__spread:jl,__spreadArray:Gl,__spreadArrays:Hl,__values:$r,default:$d},Symbol.toStringTag,{value:"Module"})),Gr=Pa(Md);var lr={};(function(s){s.CloseCode=void 0,function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(s.CloseCode||(s.CloseCode={}));class e extends Error{constructor(i,a){super(a),this.name="ServerError",this.code=i}}s.ServerError=e})(lr);var Wa={},nc={},sc={},Aa={exports:{}};(function(s,e){(function(t,i){i(e)})(Na,function(t){t.OPERATION=void 0,function(f){f[f.ADD=128]="ADD",f[f.REPLACE=0]="REPLACE",f[f.DELETE=64]="DELETE",f[f.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",f[f.MOVE_AND_ADD=160]="MOVE_AND_ADD",f[f.DELETE_AND_ADD=192]="DELETE_AND_ADD",f[f.CLEAR=10]="CLEAR",f[f.REVERSE=15]="REVERSE",f[f.MOVE=32]="MOVE",f[f.DELETE_BY_REFID=33]="DELETE_BY_REFID",f[f.ADD_BY_REFID=129]="ADD_BY_REFID"}(t.OPERATION||(t.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const l=Symbol("$track"),u=Symbol("$encoder"),d=Symbol("$decoder"),E=Symbol("$filter"),g=Symbol("$getByIndex"),y=Symbol("$deleteByIndex"),p=Symbol("$changes"),I=Symbol("$childType"),F=Symbol("$onEncodeEnd"),J=Symbol("$onDecodeEnd"),z=Symbol("$descriptors"),W="$__numFields",he="$__refTypeFieldIndexes",ne="$__viewFieldIndexes",ue="$__fieldIndexesByViewTag";let Pe;try{Pe=new TextEncoder}catch{}const We=new ArrayBuffer(8),Je=new Int32Array(We),it=new Float32Array(We),mt=new Float64Array(We),at=new BigInt64Array(We),rt=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(f,n){for(var r=0,o=0,c=0,h=f.length;c<h;c++)r=f.charCodeAt(c),r<128?o+=1:r<2048?o+=2:r<55296||r>=57344?o+=3:(c++,o+=4);return o};function Fe(f,n,r){for(var o=0,c=0,h=n.length;c<h;c++)o=n.charCodeAt(c),o<128?f[r.offset++]=o:o<2048?(f[r.offset]=192|o>>6,f[r.offset+1]=128|o&63,r.offset+=2):o<55296||o>=57344?(f[r.offset]=224|o>>12,f[r.offset+1]=128|o>>6&63,f[r.offset+2]=128|o&63,r.offset+=3):(c++,o=65536+((o&1023)<<10|n.charCodeAt(c)&1023),f[r.offset]=240|o>>18,f[r.offset+1]=128|o>>12&63,f[r.offset+2]=128|o>>6&63,f[r.offset+3]=128|o&63,r.offset+=4)}function M(f,n,r){f[r.offset++]=n&255}function re(f,n,r){f[r.offset++]=n&255}function ie(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255}function ee(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255}function te(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255,f[r.offset++]=n>>16&255,f[r.offset++]=n>>24&255}function pe(f,n,r){const o=n>>24,c=n>>16,h=n>>8,m=n;f[r.offset++]=m&255,f[r.offset++]=h&255,f[r.offset++]=c&255,f[r.offset++]=o&255}function xe(f,n,r){const o=Math.floor(n/Math.pow(2,32)),c=n>>>0;pe(f,c,r),pe(f,o,r)}function we(f,n,r){const o=n/Math.pow(2,32)>>0,c=n>>>0;pe(f,c,r),pe(f,o,r)}function Ge(f,n,r){at[0]=BigInt.asIntN(64,n),te(f,Je[0],r),te(f,Je[1],r)}function Ve(f,n,r){at[0]=BigInt.asIntN(64,n),te(f,Je[0],r),te(f,Je[1],r)}function lt(f,n,r){it[0]=n,te(f,Je[0],r)}function Tt(f,n,r){mt[0]=n,te(f,Je[0],r),te(f,Je[1],r)}function Pt(f,n,r){f[r.offset++]=n?1:0}function Is(f,n,r){n||(n="");let o=rt(n,"utf8"),c=0;if(o<32)f[r.offset++]=o|160,c=1;else if(o<256)f[r.offset++]=217,f[r.offset++]=o%255,c=2;else if(o<65536)f[r.offset++]=218,ee(f,o,r),c=3;else if(o<4294967296)f[r.offset++]=219,pe(f,o,r),c=5;else throw new Error("String too long");return Fe(f,n,r),c+o}function gn(f,n,r){if(isNaN(n))return gn(f,0,r);if(isFinite(n)){if(n!==(n|0))return Math.abs(n)<=34028235e31&&(it[0]=n,Math.abs(Math.abs(it[0])-Math.abs(n))<1e-4)?(f[r.offset++]=202,lt(f,n,r),5):(f[r.offset++]=203,Tt(f,n,r),9)}else return gn(f,n>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,r);return n>=0?n<128?(f[r.offset++]=n&255,1):n<256?(f[r.offset++]=204,f[r.offset++]=n&255,2):n<65536?(f[r.offset++]=205,ee(f,n,r),3):n<4294967296?(f[r.offset++]=206,pe(f,n,r),5):(f[r.offset++]=207,we(f,n,r),9):n>=-32?(f[r.offset++]=224|n+32,1):n>=-128?(f[r.offset++]=208,M(f,n,r),2):n>=-32768?(f[r.offset++]=209,ie(f,n,r),3):n>=-2147483648?(f[r.offset++]=210,te(f,n,r),5):(f[r.offset++]=211,xe(f,n,r),9)}const Ee={int8:M,uint8:re,int16:ie,uint16:ee,int32:te,uint32:pe,int64:xe,uint64:we,bigint64:Ge,biguint64:Ve,float32:lt,float64:Tt,boolean:Pt,string:Is,number:gn,utf8Write:Fe,utf8Length:rt},Zt=new ArrayBuffer(8),It=new Int32Array(Zt),Jt=new Float32Array(Zt),us=new Float64Array(Zt),zn=new BigUint64Array(Zt),Ss=new BigInt64Array(Zt);function Wn(f,n,r){for(var o="",c=0,h=n.offset,m=n.offset+r;h<m;h++){var _=f[h];if(!(_&128)){o+=String.fromCharCode(_);continue}if((_&224)===192){o+=String.fromCharCode((_&31)<<6|f[++h]&63);continue}if((_&240)===224){o+=String.fromCharCode((_&15)<<12|(f[++h]&63)<<6|(f[++h]&63)<<0);continue}if((_&248)===240){c=(_&7)<<18|(f[++h]&63)<<12|(f[++h]&63)<<6|(f[++h]&63)<<0,c>=65536?(c-=65536,o+=String.fromCharCode((c>>>10)+55296,(c&1023)+56320)):o+=String.fromCharCode(c);continue}console.error("Invalid byte "+_.toString(16))}return n.offset+=r,o}function Kn(f,n){return zt(f,n)<<24>>24}function zt(f,n){return f[n.offset++]}function qn(f,n){return mn(f,n)<<16>>16}function mn(f,n){return f[n.offset++]|f[n.offset++]<<8}function tt(f,n){return f[n.offset++]|f[n.offset++]<<8|f[n.offset++]<<16|f[n.offset++]<<24}function $t(f,n){return tt(f,n)>>>0}function Yn(f,n){return It[0]=tt(f,n),Jt[0]}function ds(f,n){return It[0]=tt(f,n),It[1]=tt(f,n),us[0]}function Te(f,n){const r=$t(f,n);return tt(f,n)*Math.pow(2,32)+r}function Qt(f,n){const r=$t(f,n);return $t(f,n)*Math.pow(2,32)+r}function b(f,n){return It[0]=tt(f,n),It[1]=tt(f,n),Ss[0]}function T(f,n){return It[0]=tt(f,n),It[1]=tt(f,n),zn[0]}function x(f,n){return zt(f,n)>0}function C(f,n){const r=f[n.offset++];let o;return r<192?o=r&31:r===217?o=zt(f,n):r===218?o=mn(f,n):r===219&&(o=$t(f,n)),Wn(f,n,o)}function G(f,n){const r=f[n.offset++];if(r<128)return r;if(r===202)return Yn(f,n);if(r===203)return ds(f,n);if(r===204)return zt(f,n);if(r===205)return mn(f,n);if(r===206)return $t(f,n);if(r===207)return Qt(f,n);if(r===208)return Kn(f,n);if(r===209)return qn(f,n);if(r===210)return tt(f,n);if(r===211)return Te(f,n);if(r>223)return(255-r+1)*-1}function U(f,n){const r=f[n.offset];return r<192&&r>160||r===217||r===218||r===219}const H={utf8Read:Wn,int8:Kn,uint8:zt,int16:qn,uint16:mn,int32:tt,uint32:$t,float32:Yn,float64:ds,int64:Te,uint64:Qt,bigint64:b,biguint64:T,boolean:x,string:C,number:G,stringCheck:U},Y={},Q=new Map;function ce(f,n){n.constructor&&(Q.set(n.constructor,f),Y[f]=n),n.encode&&(Ee[f]=n.encode),n.decode&&(H[f]=n.decode)}function De(f){return Y[f]}function Re(f){for(const n in f)ce(n,f[n]);return n=>ht(n)}const Et=class Et{static register(n){const r=Object.getPrototypeOf(n);if(r!==Be){let o=Et.inheritedTypes.get(r);o||(o=new Set,Et.inheritedTypes.set(r,o)),o.add(n)}}static cache(n){let r=Et.cachedContexts.get(n);return r||(r=new Et(n),Et.cachedContexts.set(n,r)),r}constructor(n){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},n&&this.discoverTypes(n)}has(n){return this.schemas.has(n)}get(n){return this.types[n]}add(n,r=this.schemas.size){return this.schemas.has(n)?!1:(this.types[r]=n,n[Symbol.metadata]===void 0&&Ae.initialize(n),this.schemas.set(n,r),!0)}getTypeId(n){return this.schemas.get(n)}discoverTypes(n,r,o,c){var _,w;if(c&&this.registerFilteredByParent(n,r,o),!this.add(n))return;(_=Et.inheritedTypes.get(n))==null||_.forEach(A=>{this.discoverTypes(A,r,o,c)});let h=n;for(;(h=Object.getPrototypeOf(h))&&h!==Be&&h!==Function.prototype;)this.discoverTypes(h);const m=n[w=Symbol.metadata]??(n[w]={});m[ne]&&(this.hasFilters=!0);for(const A in m){const D=A,$=m[D].type,R=m[D].tag!==void 0;if(typeof $!="string")if(Array.isArray($)){const X=$[0];if(X==="string")continue;this.discoverTypes(X,n,D,c||R)}else if(typeof $=="function")this.discoverTypes($,n,D,c||R);else{const X=Object.values($)[0];if(typeof X=="string")continue;this.discoverTypes(X,n,D,c||R)}}}registerFilteredByParent(n,r,o){let h=`${this.schemas.get(n)??this.schemas.size}`;r&&(h+=`-${this.schemas.get(r)}`),h+=`-${o}`,this.parentFiltered[h]=!0}debug(){let n="";for(const r in this.parentFiltered){const o=r.split("-").map(Number),c=o.pop();n+=`
		`,n+=`${r}: ${o.reverse().map((h,m)=>{const _=this.types[h],w=_[Symbol.metadata];let A=_.name;return m===0&&(A+=`[${w[c].name}]`),`${A}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${n}`}};Et.inheritedTypes=new Map,Et.cachedContexts=new Map;let Ie=Et;function At(f){return Array.isArray(f)?{array:f[0]}:typeof f.type<"u"?f.type:f}const Ae={addField(f,n,r,o,c){if(n>64)throw new Error(`Can't define field '${r}'.
Schema instances may only have up to 64 fields.`);f[n]=Object.assign(f[n]||{},{type:At(o),index:n,name:r}),Object.defineProperty(f,z,{value:f[z]||{},enumerable:!1,configurable:!0}),c?(f[z][r]=c,f[z][`_${r}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):f[z][r]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(f,W,{value:n,enumerable:!1,configurable:!0}),Object.defineProperty(f,r,{value:n,enumerable:!1,configurable:!0}),typeof f[n].type!="string"&&(f[he]===void 0&&Object.defineProperty(f,he,{value:[],enumerable:!1,configurable:!0}),f[he].push(n))},setTag(f,n,r){const o=f[n],c=f[o];c.tag=r,f[ne]||(Object.defineProperty(f,ne,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(f,ue,{value:{},enumerable:!1,configurable:!0})),f[ne].push(o),f[ue][r]||(f[ue][r]=[]),f[ue][r].push(o)},setFields(f,n){const r=f.prototype.constructor;Ie.register(r);const o=Object.getPrototypeOf(r),c=o&&o[Symbol.metadata],h=Ae.initialize(r);r[l]||(r[l]=Be[l]),r[u]||(r[u]=Be[u]),r[d]||(r[d]=Be[d]),r.prototype.toJSON||(r.prototype.toJSON=Be.prototype.toJSON);let m=h[W]??(c&&c[W])??-1;m++;for(const _ in n){const w=n[_],A=Array.isArray(w)?De("array"):typeof Object.keys(w)[0]=="string"&&De(Object.keys(w)[0]),D=A?Object.values(w)[0]:At(w);Ae.addField(h,m,_,w,Xs(`_${_}`,m,D,A)),m++}return f},isDeprecated(f,n){return f[n].deprecated===!0},init(f){const n={};f[Symbol.metadata]=n,Object.defineProperty(n,W,{value:0,enumerable:!1,configurable:!0})},initialize(f){const n=Object.getPrototypeOf(f),r=n[Symbol.metadata];let o=f[Symbol.metadata]??Object.create(null);return n!==Be&&o===r&&(o=Object.create(null),r&&(Object.setPrototypeOf(o,r),Object.defineProperty(o,W,{value:r[W],enumerable:!1,configurable:!0,writable:!0}),r[ne]!==void 0&&(Object.defineProperty(o,ne,{value:[...r[ne]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,ue,{value:{...r[ue]},enumerable:!1,configurable:!0,writable:!0})),r[he]!==void 0&&Object.defineProperty(o,he,{value:[...r[he]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,z,{value:{...r[z]},enumerable:!1,configurable:!0,writable:!0}))),f[Symbol.metadata]=o,o},isValidInstance(f){return f.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(f.constructor[Symbol.metadata],W)},getFields(f){const n=f[Symbol.metadata],r={};for(let o=0;o<=n[W];o++)r[n[o].name]=n[o].type;return r},hasViewTagAtIndex(f,n){var r;return(r=f==null?void 0:f[ne])==null?void 0:r.includes(n)}};function en(){return{indexes:{},operations:[]}}function Qe(f,n){const r=f.indexes[n];r===void 0?f.indexes[n]=f.operations.push(n)-1:f.operations[r]=n}function Hs(f,n){var o;let r=f.indexes[n];r===void 0&&(r=Object.values(f.indexes).at(-1),n=(o=Object.entries(f.indexes).find(([c,h])=>h===r))==null?void 0:o[0]),f.operations[r]=void 0,delete f.indexes[n]}function Ke(f,n,r,o=n[r].queueRootIndex){if(f)f[r][o]!==n&&(n[r].queueRootIndex=f[r].push(n)-1);else return}class Ct{constructor(n){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=n;const r=n.constructor[Symbol.metadata];r!=null&&r[ne]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(n){var o;this.root=n,this.checkIsFiltered(this.parent,this.parentIndex);const r=this.ref.constructor[Symbol.metadata];r?(o=r[he])==null||o.forEach(c=>{const h=r[c],m=this.ref[h.name];m==null||m[p].setRoot(n)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((c,h)=>{c[p].setRoot(n)})}setParent(n,r,o){var h;if(this.parent=n,this.parentIndex=o,!r)return;r!==this.root?(this.root=r,this.checkIsFiltered(n,o)):r.add(this);const c=this.ref.constructor[Symbol.metadata];c?(h=c[he])==null||h.forEach(m=>{const _=c[m],w=this.ref[_.name];w==null||w[p].setParent(this.ref,r,m)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((m,_)=>{m[p].setParent(this.ref,r,this.indexes[_]??_)})}forEachChild(n){var o;const r=this.ref.constructor[Symbol.metadata];r?(o=r[he])==null||o.forEach(c=>{const h=r[c],m=this.ref[h.name];m&&n(m[p],c)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((c,h)=>{n(c[p],this.indexes[h]??h)})}operation(n){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-n),Ke(this.root,this,"filteredChanges")):(this.changes.operations.push(-n),Ke(this.root,this,"changes"))}change(n,r=t.OPERATION.ADD){var _;const o=this.ref.constructor[Symbol.metadata],c=this.isFiltered||((_=o==null?void 0:o[n])==null?void 0:_.tag)!==void 0,h=c?this.filteredChanges:this.changes,m=this.indexedOperations[n];if(!m||m===t.OPERATION.DELETE){const w=m&&m===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:r;this.indexedOperations[n]=w}Qe(h,n),c?(Qe(this.allFilteredChanges,n),this.root&&(Ke(this.root,this,"filteredChanges"),Ke(this.root,this,"allFilteredChanges"))):(Qe(this.allChanges,n),Ke(this.root,this,"changes"))}shiftChangeIndexes(n){const r=this.isFiltered?this.filteredChanges:this.changes,o={},c={};for(const h in this.indexedOperations)o[Number(h)+n]=this.indexedOperations[h],c[Number(h)+n]=r.indexes[h];this.indexedOperations=o,r.indexes=c,r.operations=r.operations.map(h=>h+n)}shiftAllChangeIndexes(n,r=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(n,r,this.allFilteredChanges),this._shiftAllChangeIndexes(n,r,this.allChanges)):this._shiftAllChangeIndexes(n,r,this.allChanges)}_shiftAllChangeIndexes(n,r=0,o){const c={};let h=0;for(const m in o.indexes)c[h++]=o.indexes[m];o.indexes=c;for(let m=0;m<o.operations.length;m++){const _=o.operations[m];_>r&&(o.operations[m]=_+n)}}indexedOperation(n,r,o=n){this.indexedOperations[n]=r,this.filteredChanges!==void 0?(Qe(this.allFilteredChanges,o),Qe(this.filteredChanges,n),Ke(this.root,this,"filteredChanges")):(Qe(this.allChanges,o),Qe(this.changes,n),Ke(this.root,this,"changes"))}getType(n){return Ae.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][n].type:this.ref[I]}getChange(n){return this.indexedOperations[n]}getValue(n,r=!1){return this.ref[g](n,r)}delete(n,r,o=n){var m;if(n===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${n}'`)}catch(_){console.warn(_)}return}const c=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[n]=r??t.OPERATION.DELETE,Qe(c,n),Hs(this.allChanges,o);const h=this.getValue(n);return h&&h[p]&&((m=this.root)==null||m.remove(h[p])),this.filteredChanges!==void 0?(Hs(this.allFilteredChanges,o),Ke(this.root,this,"filteredChanges")):Ke(this.root,this,"changes"),h}endEncode(n){var r,o;this.indexedOperations={},this[n].indexes={},this[n].operations.length=0,this[n].queueRootIndex=void 0,(o=(r=this.ref)[F])==null||o.call(r),this.isNew=!1}discard(n=!1){var r,o;(o=(r=this.ref)[F])==null||o.call(r),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),n&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((c,h)=>{var m;return(m=this.root)==null?void 0:m.remove(c)}))}discardAll(){const n=Object.keys(this.indexedOperations);for(let r=0,o=n.length;r<o;r++){const c=this.getValue(Number(n[r]));c&&c[p]&&c[p].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(n,r){const o=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(n,r),this.filteredChanges!==void 0&&(Ke(this.root,this,"filteredChanges"),o&&this.root.allFilteredChanges.push(this))),this.isFiltered||(Ke(this.root,this,"changes"),o&&this.root.allChanges.push(this))}_checkFilteredByParent(n,r){if(!n)return;const o=Ae.isValidInstance(this.ref)?this.ref.constructor:this.ref[I];let c,h=!Ae.isValidInstance(n);h?(c=n[p],n=c.parent,r=c.parentIndex):c=n[p];const m=n.constructor;let _=`${this.root.types.getTypeId(o)}`;m&&(_+=`-${this.root.types.schemas.get(m)}`),_+=`-${r}`;const w=Ae.hasViewTagAtIndex(m==null?void 0:m[Symbol.metadata],r);this.isFiltered=n[p].isFiltered||this.root.types.parentFiltered[_]||w,this.isFiltered&&(this.isVisibilitySharedWithParent=c.isFiltered&&typeof o!="string"&&!w&&h,this.filteredChanges||(this.filteredChanges=en(),this.allFilteredChanges=en()),this.changes.operations.length>0&&(this.changes.operations.forEach(A=>Qe(this.filteredChanges,A)),this.allChanges.operations.forEach(A=>Qe(this.allFilteredChanges,A)),this.changes=en(),this.allChanges=en()))}}function Cn(f,n,r,o,c,h){var m;typeof r=="string"?(m=Ee[r])==null||m.call(Ee,n,o,h):r[Symbol.metadata]!==void 0?(Ee.number(n,o[p].refId,h),(c&t.OPERATION.ADD)===t.OPERATION.ADD&&f.tryEncodeTypeId(n,r,o.constructor,h)):Ee.number(n,o[p].refId,h)}const hs=function(f,n,r,o,c,h,m,_,w){if(n[h.offset++]=(o|c)&255,c===t.OPERATION.DELETE)return;const A=r.ref,D=w[o];Cn(f,n,w[o].type,A[D.name],c,h)},yn=function(f,n,r,o,c,h){if(n[h.offset++]=c&255,c===t.OPERATION.CLEAR||(Ee.number(n,o,h),c===t.OPERATION.DELETE))return;const m=r.ref;if((c&t.OPERATION.ADD)===t.OPERATION.ADD&&typeof m.set=="function"){const A=r.ref.$indexes.get(o);Ee.string(n,A,h)}const _=m[I],w=m[g](o);Cn(f,n,_,w,c,h)},Ln=function(f,n,r,o,c,h,m,_){const w=r.ref,A=_&&r.isFiltered&&typeof r.getType(o)!="string";let D;if(A?(D=w.tmpItems[o][p].refId,c===t.OPERATION.DELETE?c=t.OPERATION.DELETE_BY_REFID:c===t.OPERATION.ADD&&(c=t.OPERATION.ADD_BY_REFID)):D=o,n[h.offset++]=c&255,c===t.OPERATION.CLEAR||c===t.OPERATION.REVERSE||(Ee.number(n,D,h),c===t.OPERATION.DELETE||c===t.OPERATION.DELETE_BY_REFID))return;const $=r.getType(o),R=r.getValue(o,m);Cn(f,n,$,R,c,h)},Gs=-1;function ps(f,n,r,o,c,h,m,_){const w=f.root,A=r[g](o);let D;if((n&t.OPERATION.DELETE)===t.OPERATION.DELETE){const $=w.refIds.get(A);$!==void 0&&w.removeRef($),n!==t.OPERATION.DELETE_AND_ADD&&r[y](o),D=void 0}if(n!==t.OPERATION.DELETE)if(Be.is(c)){const $=H.number(h,m);if(D=w.refs.get($),(n&t.OPERATION.ADD)===t.OPERATION.ADD){const R=f.getInstanceType(h,m,c);D||(D=f.createInstanceOfType(R)),w.addRef($,D,D!==A||n===t.OPERATION.DELETE_AND_ADD&&D===A)}}else if(typeof c=="string")D=H[c](h,m);else{const $=De(Object.keys(c)[0]),R=H.number(h,m),X=w.refs.has(R)?A||w.refs.get(R):new $.constructor;if(D=X.clone(!0),D[I]=Object.values(c)[0],A){let K=w.refIds.get(A);if(K!==void 0&&R!==K){const V=A.entries();let N;for(;(N=V.next())&&!N.done;){const[q,me]=N.value;typeof me=="object"&&(K=w.refIds.get(me),w.removeRef(K)),_.push({ref:A,refId:K,op:t.OPERATION.DELETE,field:q,value:void 0,previousValue:me})}}}w.addRef(R,D,X!==A||n===t.OPERATION.DELETE_AND_ADD&&X===A)}return{value:D,previousValue:A}}const Zs=function(f,n,r,o,c){const h=n[r.offset++],m=o.constructor[Symbol.metadata],_=h>>6<<6,w=h%(_||255),A=m[w];if(A===void 0)return console.warn("@colyseus/schema: field not defined at",{index:w,ref:o.constructor.name,metadata:m}),Gs;const{value:D,previousValue:$}=ps(f,_,o,w,A.type,n,r,c);D!=null&&(o[A.name]=D),$!==D&&c.push({ref:o,refId:f.currentRefId,op:_,field:A.name,value:D,previousValue:$})},kn=function(f,n,r,o,c){const h=n[r.offset++];if(h===t.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}const m=H.number(n,r),_=o[I];let w;(h&t.OPERATION.ADD)===t.OPERATION.ADD?typeof o.set=="function"?(w=H.string(n,r),o.setIndex(m,w)):w=m:w=o.getIndex(m);const{value:A,previousValue:D}=ps(f,h,o,m,_,n,r,c);if(A!=null){if(typeof o.set=="function")o.$items.set(w,A);else if(typeof o.$setAt=="function")o.$setAt(m,A,h);else if(typeof o.add=="function"){const $=o.add(A);typeof $=="number"&&o.setIndex($,$)}}D!==A&&c.push({ref:o,refId:f.currentRefId,op:h,field:"",dynamicIndex:w,value:A,previousValue:D})},Ri=function(f,n,r,o,c){let h=n[r.offset++],m;if(h===t.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}else if(h===t.OPERATION.REVERSE){o.reverse();return}else if(h===t.OPERATION.DELETE_BY_REFID){const $=H.number(n,r),R=f.root.refs.get($);m=o.findIndex(X=>X===R),o[y](m),c.push({ref:o,refId:f.currentRefId,op:t.OPERATION.DELETE,field:"",dynamicIndex:m,value:void 0,previousValue:R});return}else if(h===t.OPERATION.ADD_BY_REFID){const $=H.number(n,r),R=f.root.refs.get($);R&&(m=o.findIndex(X=>X===R)),(m===-1||m===void 0)&&(m=o.length)}else m=H.number(n,r);const _=o[I];let w=m;const{value:A,previousValue:D}=ps(f,h,o,m,_,n,r,c);A!=null&&A!==D&&o.$setAt(m,A,h),D!==A&&c.push({ref:o,refId:f.currentRefId,op:h,field:"",dynamicIndex:w,value:A,previousValue:D})};class Xn extends Error{}function zs(f,n,r,o){let c,h=!1;switch(n){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(f)&&console.log(`trying to encode "NaN" in ${r.constructor.name}#${o}`);break;case"bigint64":case"biguint64":c="bigint";break;case"string":c="string",h=!0;break;case"boolean":return;default:return}if(typeof f!==c&&(!h||h&&f!==null)){let m=`'${JSON.stringify(f)}'${f&&f.constructor&&` (${f.constructor.name})`||""}`;throw new Xn(`a '${c}' was expected, but ${m} was provided in ${r.constructor.name}#${o}`)}}function An(f,n,r,o){if(!(f instanceof n))throw new Xn(`a '${n.name}' was expected, but '${f&&f.constructor.name}' was provided in ${r.constructor.name}#${o}`)}var bn,Ws;const Ni=(f,n)=>{const r=f.toString(),o=n.toString();return r<o?-1:r>o?1:0},pt=class pt{static[(bn=u,Ws=d,E)](n,r,o){var c;return!o||typeof n[I]=="string"||o.isChangeTreeVisible((c=n.tmpItems[r])==null?void 0:c[p])}static is(n){return Array.isArray(n)||n.array!==void 0}static from(n){return new pt(...Array.from(n))}constructor(...n){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const r=new Proxy(this,{get:(o,c)=>typeof c!="symbol"&&!isNaN(c)?this.items[c]:Reflect.get(o,c),set:(o,c,h)=>{var m;if(typeof c!="symbol"&&!isNaN(c)){if(h==null)o.$deleteAt(c);else{if(h[p]){An(h,o[I],o,c);const _=o.items[c];o.isMovingItems?(_!==void 0?h[p].isNew?o[p].indexedOperation(Number(c),t.OPERATION.MOVE_AND_ADD):(o[p].getChange(Number(c))&t.OPERATION.DELETE)===t.OPERATION.DELETE?o[p].indexedOperation(Number(c),t.OPERATION.DELETE_AND_MOVE):o[p].indexedOperation(Number(c),t.OPERATION.MOVE):h[p].isNew&&o[p].indexedOperation(Number(c),t.OPERATION.ADD),h[p].setParent(this,o[p].root,c)):o.$changeAt(Number(c),h),_!==void 0&&((m=_[p].root)==null||m.remove(_[p]))}else o.$changeAt(Number(c),h);o.items[c]=h,o.tmpItems[c]=h}return!0}else return Reflect.set(o,c,h)},deleteProperty:(o,c)=>(typeof c=="number"?o.$deleteAt(c):delete o[c],!0),has:(o,c)=>typeof c!="symbol"&&!isNaN(Number(c))?Reflect.has(this.items,c):Reflect.has(o,c)});return this[p]=new Ct(r),this[p].indexes={},n.length>0&&this.push(...n),r}set length(n){n===0?this.clear():n<this.items.length?this.splice(n,this.length-n):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...n){var c;let r=this.tmpItems.length;const o=this[p];for(let h=0,m=n.length;h<n.length;h++,r++){const _=n[h];if(_==null)return;typeof _=="object"&&this[I]&&An(_,this[I],this,h),o.indexedOperation(r,t.OPERATION.ADD,this.items.length),this.items.push(_),this.tmpItems.push(_),(c=_[p])==null||c.setParent(this,o.root,r)}return r}pop(){let n=-1;for(let r=this.tmpItems.length-1;r>=0;r--)if(this.deletedIndexes[r]!==!0){n=r;break}if(!(n<0))return this[p].delete(n,void 0,this.items.length-1),this.deletedIndexes[n]=!0,this.items.pop()}at(n){return n<0&&(n+=this.length),this.items[n]}$changeAt(n,r){var h;if(r==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[n]===r)return;const o=this.items[n]!==void 0?typeof r=="object"?t.OPERATION.DELETE_AND_ADD:t.OPERATION.REPLACE:t.OPERATION.ADD,c=this[p];c.change(n,o),(h=r[p])==null||h.setParent(this,c.root,n)}$deleteAt(n,r){this[p].delete(n,r)}$setAt(n,r,o){n===0&&o===t.OPERATION.ADD&&this.items[n]!==void 0?this.items.unshift(r):o===t.OPERATION.DELETE_AND_MOVE?(this.items.splice(n,1),this.items[n]=r):this.items[n]=r}clear(){if(this.items.length===0)return;const n=this[p];n.forEachChild((r,o)=>{r.discard(!0);const c=r.root;c!==void 0&&(c.removeChangeFromChangeSet("changes",r),c.removeChangeFromChangeSet("allChanges",r),c.removeChangeFromChangeSet("allFilteredChanges",r))}),n.discard(!0),n.operation(t.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...n){return new pt(...this.items.concat(...n))}join(n){return this.items.join(n)}reverse(){return this[p].operation(t.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const n=this[p],r=this.tmpItems.findIndex(c=>c===this.items[0]),o=this.items.findIndex(c=>c===this.items[0]);return n.delete(r,t.OPERATION.DELETE,o),n.shiftAllChangeIndexes(-1,o),this.items.shift()}slice(n,r){const o=new pt;return o.push(...this.items.slice(n,r)),o}sort(n=Ni){this.isMovingItems=!0;const r=this[p];return this.items.sort(n).forEach((c,h)=>r.change(h,t.OPERATION.REPLACE)),this.tmpItems.sort(n),this.isMovingItems=!1,this}splice(n,r,...o){var A;const c=this[p],h=this.items.length,m=this.tmpItems.length,_=o.length,w=[];for(let D=0;D<m;D++)this.deletedIndexes[D]!==!0&&w.push(D);if(h>n){r===void 0&&(r=h-n);for(let D=n;D<n+r;D++){const $=w[D];c.delete($,t.OPERATION.DELETE),this.deletedIndexes[$]=!0}}else r=0;if(_>0){if(_>r)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let D=0;D<_;D++){const $=(w[n]??h)+D;c.indexedOperation($,this.deletedIndexes[$]?t.OPERATION.DELETE_AND_ADD:t.OPERATION.ADD),(A=o[D][p])==null||A.setParent(this,c.root,$)}}return r>_&&c.shiftAllChangeIndexes(-(r-_),w[n+_]),c.filteredChanges!==void 0?Ke(c.root,c,"filteredChanges"):Ke(c.root,c,"changes"),this.items.splice(n,r,...o)}unshift(...n){const r=this[p];return r.shiftChangeIndexes(n.length),r.isFiltered?Qe(r.filteredChanges,this.items.length):Qe(r.allChanges,this.items.length),n.forEach((o,c)=>{r.change(c,t.OPERATION.ADD)}),this.tmpItems.unshift(...n),this.items.unshift(...n)}indexOf(n,r){return this.items.indexOf(n,r)}lastIndexOf(n,r=this.length-1){return this.items.lastIndexOf(n,r)}every(n,r){return this.items.every(n,r)}some(n,r){return this.items.some(n,r)}forEach(n,r){return this.items.forEach(n,r)}map(n,r){return this.items.map(n,r)}filter(n,r){return this.items.filter(n,r)}reduce(n,r){return this.items.reduce(n,r)}reduceRight(n,r){return this.items.reduceRight(n,r)}find(n,r){return this.items.find(n,r)}findIndex(n,r){return this.items.findIndex(n,r)}fill(n,r,o){throw new Error("ArraySchema#fill() not implemented")}copyWithin(n,r,o){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return pt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(n,r){return this.items.includes(n,r)}flatMap(n,r){throw new Error("ArraySchema#flatMap() is not supported.")}flat(n){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...n){return this.items.findLastIndex.apply(this.items,arguments)}with(n,r){const o=this.items.slice();return n<0&&(n+=this.length),o[n]=r,new pt(...o)}toReversed(){return this.items.slice().reverse()}toSorted(n){return this.items.slice().sort(n)}toSpliced(n,r,...o){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(n=>{let r=this.items.length;for(;r!=0;){let o=Math.floor(Math.random()*r);r--,[this[r],this[o]]=[this[o],this[r]]}})}move(n){return this.isMovingItems=!0,n(this),this.isMovingItems=!1,this}[g](n,r=!1){return r?this.items[n]:this.deletedIndexes[n]?this.items[n]:this.tmpItems[n]||this.items[n]}[y](n){this.items[n]=void 0,this.tmpItems[n]=void 0}[F](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[J](){this.items=this.items.filter(n=>n!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(n=>typeof n.toJSON=="function"?n.toJSON():n)}clone(n){let r;return n?(r=new pt,r.push(...this.items)):r=new pt(...this.map(o=>o[p]?o.clone():o)),r}};pt[bn]=Ln,pt[Ws]=Ri;let bt=pt;ce("array",{constructor:bt});var Ks,qs;const kt=class kt{static[(Ks=u,qs=d,E)](n,r,o){return!o||typeof n[I]=="string"||o.isChangeTreeVisible((n[g](r)??n.deletedItems[r])[p])}static is(n){return n.map!==void 0}constructor(n){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[p]=new Ct(this),this[p].indexes={},n)if(n instanceof Map||n instanceof kt)n.forEach((r,o)=>this.set(o,r));else for(const r in n)this.set(r,n[r]);Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return kt}set(n,r){var _;if(r==null)throw new Error(`MapSchema#set('${n}', ${r}): trying to set ${r} value on '${n}'.`);typeof r=="object"&&this[I]&&An(r,this[I],this,n),n=n.toString();const o=this[p],c=r[p]!==void 0;let h,m;if(typeof o.indexes[n]<"u"){h=o.indexes[n],m=t.OPERATION.REPLACE;const w=this.$items.get(n);if(w===r)return;c&&(m=t.OPERATION.DELETE_AND_ADD,w!==void 0&&((_=w[p].root)==null||_.remove(w[p])))}else h=o.indexes[W]??0,m=t.OPERATION.ADD,this.$indexes.set(h,n),o.indexes[n]=h,o.indexes[W]=h+1;return this.$items.set(n,r),o.change(h,m),c&&r[p].setParent(this,o.root,h),this}get(n){return this.$items.get(n)}delete(n){const r=this[p].indexes[n];return this.deletedItems[r]=this[p].delete(r),this.$items.delete(n)}clear(){const n=this[p];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(t.OPERATION.CLEAR)}has(n){return this.$items.has(n)}forEach(n){this.$items.forEach(n)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[F](){this.deletedItems={}}toJSON(){const n={};return this.forEach((r,o)=>{n[o]=typeof r.toJSON=="function"?r.toJSON():r}),n}clone(n){let r;return n?r=Object.assign(new kt,this):(r=new kt,this.forEach((o,c)=>{o[p]?r.set(c,o.clone()):r.set(c,o)})),r}};kt[Ks]=yn,kt[qs]=kn;let ct=kt;ce("map",{constructor:ct});const Ot=-1;function Pi(f){return Ie.register(f),f}function Ys(f=Ot){return function(n,r){var _;const o=n.constructor,h=Object.getPrototypeOf(o)[Symbol.metadata],m=o[_=Symbol.metadata]??(o[_]=Object.assign({},o[Symbol.metadata],h??Object.create(null)));Ae.setTag(m,r,f)}}function ht(f,n){return function(r,o){const c=r.constructor;if(!f)throw new Error(`${c.name}: @type() reference provided for "${o}" is undefined. Make sure you don't have any circular dependencies.`);Ie.register(c);const m=Object.getPrototypeOf(c)[Symbol.metadata],_=Ae.initialize(c);let w=_[o];if(_[w]!==void 0){if(_[w].deprecated)return;if(_[w].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${o}' definition on '${c.name}'.
Check @type() annotation`)}catch(A){const D=A.stack.split(`
`)[4].trim();throw new Error(`${A.message} ${D}`)}}else w=_[W]??(m&&m[W])??-1,w++;if(n&&n.manual)Ae.addField(_,w,o,f,{enumerable:!0,configurable:!0,writable:!0});else{const A=Array.isArray(f)?De("array"):typeof Object.keys(f)[0]=="string"&&De(Object.keys(f)[0]),D=A?Object.values(f)[0]:f;Ae.addField(_,w,o,f,Xs(`_${o}`,w,D,A))}}}function Xs(f,n,r,o){return{get:function(){return this[f]},set:function(c){var m,_;const h=this[f]??void 0;if(c!==h){if(c!=null){o?(o.constructor===bt&&!(c instanceof bt)&&(c=new bt(...c)),o.constructor===ct&&!(c instanceof ct)&&(c=new ct(c)),c[I]=r):typeof r!="string"?An(c,r,this,f.substring(1)):zs(c,r,this,f.substring(1));const w=this[p];h!==void 0&&h[p]?((m=w.root)==null||m.remove(h[p]),this.constructor[l](w,n,t.OPERATION.DELETE_AND_ADD)):this.constructor[l](w,n,t.OPERATION.ADD),(_=c[p])==null||_.setParent(this,w.root,n)}else h!==void 0&&this[p].delete(n);this[f]=c}},enumerable:!0,configurable:!0}}function En(f=!0){return function(n,r){var w;const o=n.constructor,h=Object.getPrototypeOf(o)[Symbol.metadata],m=o[w=Symbol.metadata]??(o[w]=Object.assign({},o[Symbol.metadata],h??Object.create(null))),_=m[r];m[_].deprecated=!0,f&&(m[z]??(m[z]={}),m[z][r]={get:function(){throw new Error(`${r} is deprecated.`)},set:function(A){},enumerable:!1,configurable:!0}),Object.defineProperty(m,_,{value:m[_],enumerable:!1,configurable:!0})}}function Ci(f,n,r){for(let o in n)ht(n[o],r)(f.prototype,o);return f}function Js(f,n,r=Be){const o={},c={};for(let m in f){const _=f[m];typeof _=="object"&&(_.default!==void 0&&(o[m]=_.default),_.view!==void 0&&(c[m]=typeof _.view=="boolean"?Ot:_.view))}const h=Ae.setFields(class extends r{constructor(...m){m[0]=Object.assign({},o,m[0]),super(...m)}},f);for(let m in c)Ys(c[m])(h.prototype,m);return n&&Object.defineProperty(h,"name",{value:n}),h.extends=(m,_)=>Js(m,_,h),h}function Bn(f){return new Array(f).fill(0).map((n,r)=>r===f-1?"└─ ":"   ").join("")}function Li(f){const n=f[p].root,r={ops:{},refs:[]};return n.changes.forEach(o=>{if(o===void 0)return;const c=o.indexedOperations;r.refs.push(`refId#${o.refId}`);for(const h in c){const m=c[h],_=t.OPERATION[m];r.ops[_]||(r.ops[_]=0),r.ops[t.OPERATION[m]]++}}),r}var Qs,Jn;const wn=class wn{static initialize(n){var r;Object.defineProperty(n,p,{value:new Ct(n),enumerable:!1,writable:!0}),Object.defineProperties(n,((r=n.constructor[Symbol.metadata])==null?void 0:r[z])||{})}static is(n){return typeof n[Symbol.metadata]=="object"}static[(Qs=u,Jn=d,l)](n,r,o=t.OPERATION.ADD){n.change(r,o)}static[E](n,r,o){var m,_;const h=(m=n.constructor[Symbol.metadata][r])==null?void 0:m.tag;if(o===void 0)return h===void 0;if(h===void 0)return!0;if(h===Ot)return o.isChangeTreeVisible(n[p]);{const w=(_=o.tags)==null?void 0:_.get(n[p]);return w&&w.has(h)}}constructor(...n){wn.initialize(this),n[0]&&Object.assign(this,n[0])}assign(n){return Object.assign(this,n),this}setDirty(n,r){const o=this.constructor[Symbol.metadata];this[p].change(o[o[n]].index,r)}clone(){var o;const n=new this.constructor,r=this.constructor[Symbol.metadata];for(const c in r){const h=r[c].name;typeof this[h]=="object"&&typeof((o=this[h])==null?void 0:o.clone)=="function"?n[h]=this[h].clone():n[h]=this[h]}return n}toJSON(){const n={},r=this.constructor[Symbol.metadata];for(const o in r){const c=r[o],h=c.name;!c.deprecated&&this[h]!==null&&typeof this[h]<"u"&&(n[h]=typeof this[h].toJSON=="function"?this[h].toJSON():this[h])}return n}discardAllChanges(){this[p].discardAll()}[g](n){const r=this.constructor[Symbol.metadata];return this[r[n].name]}[y](n){const r=this.constructor[Symbol.metadata];this[r[n].name]=void 0}static debugRefIds(n,r=!1,o=0){const c=r?` - ${JSON.stringify(n.toJSON())}`:"",h=n[p],m=h.refId;let _="";return _+=`${Bn(o)}${n.constructor.name} (refId: ${m})${c}
`,h.forEachChild(w=>_+=this.debugRefIds(w.ref,r,o+1)),_}static debugChanges(n,r=!1){const o=n[p],c=r?o.allChanges:o.changes,h=r?"allChanges":"changes";let m=`${n.constructor.name} (${o.refId}) -> .${h}:
`;function _(w){w.operations.filter(A=>A).forEach(A=>{const D=o.indexedOperations[A];console.log({index:A,operation:D}),m+=`- [${A}]: ${t.OPERATION[D]} (${JSON.stringify(o.getValue(Number(A),r))})
`})}return _(c),!r&&o.filteredChanges&&o.filteredChanges.operations.filter(w=>w).length>0&&(m+=`${n.constructor.name} (${o.refId}) -> .filteredChanges:
`,_(o.filteredChanges)),r&&o.allFilteredChanges&&o.allFilteredChanges.operations.filter(w=>w).length>0&&(m+=`${n.constructor.name} (${o.refId}) -> .allFilteredChanges:
`,_(o.allFilteredChanges)),m}static debugChangesDeep(n,r="changes"){var D,$;let o="";const c=n[p],h=c.root,m=new Map,_=[];let w=0;for(const[R,X]of Object.entries(h[r])){const K=h.changeTrees[R];let V=!1,N=[],q=(D=K.parent)==null?void 0:D[p];if(K===c)V=!0;else for(;q!==void 0;){if(N.push(q),q.ref===n){V=!0;break}q=($=q.parent)==null?void 0:$[p]}V&&(_.push(K.refId),w+=Object.keys(X).length,m.set(K,N.reverse()))}o+=`---
`,o+=`root refId: ${c.refId}
`,o+=`Total instances: ${_.length} (refIds: ${_.join(", ")})
`,o+=`Total changes: ${w}
`,o+=`---
`;const A=new WeakSet;for(const[R,X]of m.entries()){X.forEach((me,Oe)=>{A.has(me)||(o+=`${Bn(Oe)}${me.ref.constructor.name} (refId: ${me.refId})
`,A.add(me))});const K=R.indexedOperations,V=X.length,N=Bn(V),q=V>0?`(${R.parentIndex}) `:"";o+=`${N}${q}${R.ref.constructor.name} (refId: ${R.refId}) - changes: ${Object.keys(K).length}
`;for(const me in K){const Oe=K[me];o+=`${Bn(V+1)}${t.OPERATION[Oe]}: ${me}
`}}return`${o}`}};wn[Qs]=hs,wn[Jn]=Zs;let Be=wn;var ei,tn;const rn=class rn{static[(ei=u,tn=d,E)](n,r,o){return!o||typeof n[I]=="string"||o.isChangeTreeVisible((n[g](r)??n.deletedItems[r])[p])}static is(n){return n.collection!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[p]=new Ct(this),this[p].indexes={},n&&n.forEach(r=>this.add(r)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){const r=this.$refId++;return n[p]!==void 0&&n[p].setParent(this,this[p].root,r),this[p].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,n),this[p].change(r),r}at(n){const r=Array.from(this.$items.keys())[n];return this.$items.get(r)}entries(){return this.$items.entries()}delete(n){const r=this.$items.entries();let o,c;for(;(c=r.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[p].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[p];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(t.OPERATION.CLEAR)}has(n){return Array.from(this.$items.values()).some(r=>r===n)}forEach(n){this.$items.forEach((r,o,c)=>n(r,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[F](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((r,o)=>{n.push(typeof r.toJSON=="function"?r.toJSON():r)}),n}clone(n){let r;return n?r=Object.assign(new rn,this):(r=new rn,this.forEach(o=>{o[p]?r.add(o.clone()):r.add(o)})),r}};rn[ei]=yn,rn[tn]=kn;let vn=rn;ce("collection",{constructor:vn});var ti,ni;const an=class an{static[(ti=u,ni=d,E)](n,r,o){return!o||typeof n[I]=="string"||o.visible.has((n[g](r)??n.deletedItems[r])[p])}static is(n){return n.set!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[p]=new Ct(this),this[p].indexes={},n&&n.forEach(r=>this.add(r)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){var c;if(this.has(n))return!1;const r=this.$refId++;n[p]!==void 0&&n[p].setParent(this,this[p].root,r);const o=((c=this[p].indexes[r])==null?void 0:c.op)??t.OPERATION.ADD;return this[p].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,n),this[p].change(r,o),r}entries(){return this.$items.entries()}delete(n){const r=this.$items.entries();let o,c;for(;(c=r.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[p].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[p];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(t.OPERATION.CLEAR)}has(n){const r=this.$items.values();let o=!1,c;for(;(c=r.next())&&!c.done;)if(n===c.value){o=!0;break}return o}forEach(n){this.$items.forEach((r,o,c)=>n(r,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[F](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((r,o)=>{n.push(typeof r.toJSON=="function"?r.toJSON():r)}),n}clone(n){let r;return n?r=Object.assign(new an,this):(r=new an,this.forEach(o=>{o[p]?r.add(o.clone()):r.add(o)})),r}};an[ti]=yn,an[ni]=kn;let _n=an;ce("set",{constructor:_n});function Lt(f,n,r,o){var c=arguments.length,h=c<3?n:o===null?o=Object.getOwnPropertyDescriptor(n,r):o,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,n,r,o);else for(var _=f.length-1;_>=0;_--)(m=f[_])&&(h=(c<3?m(h):c>3?m(n,r,h):m(n,r))||h);return c>3&&h&&Object.defineProperty(n,r,h),h}typeof SuppressedError=="function"&&SuppressedError;class ki{constructor(n){this.types=n,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(n){n.ensureRefId();const r=this.changeTrees[n.refId]===void 0;r&&(this.changeTrees[n.refId]=n);const o=this.refCount[n.refId];if(o===0){const c=n.allChanges.operations;let h=c.length;for(;h--;)n.indexedOperations[c[h]]=t.OPERATION.ADD,Qe(n.changes,h)}return this.refCount[n.refId]=(o||0)+1,r}remove(n){const r=this.refCount[n.refId]-1;return r<=0?(n.root=void 0,delete this.changeTrees[n.refId],this.removeChangeFromChangeSet("allChanges",n),this.removeChangeFromChangeSet("changes",n),n.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",n),this.removeChangeFromChangeSet("filteredChanges",n)),this.refCount[n.refId]=0):(this.refCount[n.refId]=r,n.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",n),Ke(this,n,"filteredChanges")):(this.removeChangeFromChangeSet("changes",n),Ke(this,n,"changes"))),n.forEachChild((o,c)=>this.remove(o)),r}removeChangeFromChangeSet(n,r){const o=this[n],c=o.indexOf(r);if(c!==-1)return r[n].queueRootIndex=-1,o[c]=void 0,!0}clear(){this.changes.length=0}}const $n=class $n{constructor(n){this.sharedBuffer=Buffer.allocUnsafe($n.BUFFER_SIZE),this.context=Ie.cache(n.constructor),this.root=new ki(this.context),this.setState(n)}setState(n){this.state=n,this.state[p].setRoot(this.root)}encode(n={offset:0},r,o=this.sharedBuffer,c="changes",h=c==="allChanges",m=n.offset){const _=r!==void 0,w=this.state[p],A=this.root[c];for(let D=0,$=A.length;D<$;D++){const R=A[D];if(!R)continue;if(_){if(!r.isChangeTreeVisible(R)){r.invisible.add(R);continue}r.invisible.delete(R)}const X=R[c],K=R.ref,V=X.operations.length;if(V===0)continue;const N=K.constructor,q=N[u],me=N[E],Oe=N[Symbol.metadata];(_||n.offset>m||R!==w)&&(o[n.offset++]=255,Ee.number(o,R.refId,n));for(let Ze=0;Ze<V;Ze++){const je=X.operations[Ze],Rt=je<0?Math.abs(je):h?t.OPERATION.ADD:R.indexedOperations[je];je===void 0||Rt===void 0||me&&!me(K,je,r)||q(this,o,R,je,Rt,n,h,_,Oe)}}if(n.offset>o.byteLength){const D=Math.ceil(n.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(D/1024)} * 1024; // ${Math.round(D/1024)} KB
`),o=Buffer.alloc(D,o),o===this.sharedBuffer&&(this.sharedBuffer=o),this.encode({offset:m},r,o,c,h)}else return o.subarray(0,n.offset)}encodeAll(n={offset:0},r=this.sharedBuffer){return this.encode(n,void 0,r,"allChanges",!0)}encodeAllView(n,r,o,c=this.sharedBuffer){const h=o.offset;return this.encode(o,n,c,"allFilteredChanges",!0,h),Buffer.concat([c.subarray(0,r),c.subarray(h,o.offset)])}debugChanges(n){(typeof n=="string"?this.root[n]:n).forEach(o=>{const c=o[n],h=o.ref.constructor[Symbol.metadata];console.log("->",{ref:o.ref.constructor.name,refId:o.refId,changes:Object.keys(c).length});for(const m in c){const _=c[m];console.log("  ->",{index:m,field:h==null?void 0:h[m],op:t.OPERATION[_]})}})}encodeView(n,r,o,c=this.sharedBuffer){const h=o.offset;for(const[m,_]of n.changes){const w=this.root.changeTrees[m];if(w===void 0){n.changes.delete(m);continue}const A=Object.keys(_);if(A.length===0)continue;const $=w.ref.constructor,R=$[u],X=$[Symbol.metadata];c[o.offset++]=255,Ee.number(c,w.refId,o);for(let K=0,V=A.length;K<V;K++){const N=Number(A[K]),me=w.ref[g](N)!==void 0&&_[N]||t.OPERATION.DELETE;R(this,c,w,N,me,o,!1,!0,X)}}return n.changes.clear(),this.encode(o,n,c,"filteredChanges",!1,h),Buffer.concat([c.subarray(0,r),c.subarray(h,o.offset)])}discardChanges(){var r,o;let n=this.root.changes.length;if(n>0){for(;n--;)(r=this.root.changes[n])==null||r.endEncode("changes");this.root.changes.length=0}if(n=this.root.filteredChanges.length,n>0){for(;n--;)(o=this.root.filteredChanges[n])==null||o.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(n,r,o,c){const h=this.context.getTypeId(r),m=this.context.getTypeId(o);if(m===void 0){console.warn(`@colyseus/schema WARNING: Class "${o.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}h!==m&&(n[c.offset++]=213,Ee.number(n,m,c))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};$n.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let un=$n;function si(f,n){if(n===-1||n>=f.length)return!1;const r=f.length-1;for(let o=n;o<r;o++)f[o]=f[o+1];return f.length=r,!0}class ii extends Error{constructor(n){super(n),this.name="DecodingWarning"}}class Bi{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(n,r,o=!0){this.refs.set(n,r),this.refIds.set(r,n),o&&(this.refCounts[n]=(this.refCounts[n]||0)+1),this.deletedRefs.has(n)&&this.deletedRefs.delete(n)}removeRef(n){const r=this.refCounts[n];if(r===void 0){try{throw new ii("trying to remove refId that doesn't exist: "+n)}catch(o){console.warn(o)}return}if(r===0){try{const o=this.refs.get(n);throw new ii(`trying to remove refId '${n}' with 0 refCount (${o.constructor.name}: ${JSON.stringify(o)})`)}catch(o){console.warn(o)}return}(this.refCounts[n]=r-1)<=0&&this.deletedRefs.add(n)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(n=>{if(this.refCounts[n]>0)return;const r=this.refs.get(n);if(r.constructor[Symbol.metadata]!==void 0){const o=r.constructor[Symbol.metadata];for(const c in o){const h=o[c].name,m=typeof r[h]=="object"&&this.refIds.get(r[h]);m&&!this.deletedRefs.has(m)&&this.removeRef(m)}}else typeof r[I]=="function"&&Array.from(r.values()).forEach(o=>{const c=this.refIds.get(o);this.deletedRefs.has(c)||this.removeRef(c)});this.refs.delete(n),delete this.refCounts[n],delete this.callbacks[n]}),this.deletedRefs.clear()}addCallback(n,r,o){if(n===void 0){const c=typeof r=="number"?t.OPERATION[r]:r;throw new Error(`Can't addCallback on '${c}' (refId is undefined)`)}return this.callbacks[n]||(this.callbacks[n]={}),this.callbacks[n][r]||(this.callbacks[n][r]=[]),this.callbacks[n][r].push(o),()=>this.removeCallback(n,r,o)}removeCallback(n,r,o){var h,m,_;const c=(_=(m=(h=this.callbacks)==null?void 0:h[n])==null?void 0:m[r])==null?void 0:_.indexOf(o);c!==-1&&si(this.callbacks[n][r],c)}}class Qn{constructor(n,r){this.currentRefId=0,this.setState(n),this.context=r||new Ie(n.constructor)}setState(n){this.state=n,this.root=new Bi,this.root.addRef(0,n)}decode(n,r={offset:0},o=this.state){var w,A,D;const c=[],h=this.root,m=n.byteLength;let _=o.constructor[d];for(this.currentRefId=0;r.offset<m;){if(n[r.offset]==255){r.offset++,this.currentRefId=H.number(n,r);const R=h.refs.get(this.currentRefId);if(!R)throw new Error(`"refId" not found: ${this.currentRefId}`);(w=o[J])==null||w.call(o),o=R,_=o.constructor[d];continue}if(_(this,n,r,o,c)===Gs){console.warn("@colyseus/schema: definition mismatch");const R={offset:r.offset};for(;r.offset<m&&!(n[r.offset]===255&&(R.offset=r.offset+1,h.refs.has(H.number(n,R))));)r.offset++;continue}}return(A=o[J])==null||A.call(o),(D=this.triggerChanges)==null||D.call(this,c),h.garbageCollectDeletedRefs(),c}getInstanceType(n,r,o){let c;if(n[r.offset]===213){r.offset++;const h=H.number(n,r);c=this.context.get(h)}return c||o}createInstanceOfType(n){return new n}removeChildRefs(n,r){const o=typeof n[I]!="string",c=this.root.refIds.get(n);n.forEach((h,m)=>{r.push({ref:n,refId:c,op:t.OPERATION.DELETE,field:m,value:void 0,previousValue:h}),o&&this.root.removeRef(this.root.refIds.get(h))})}}class nn extends Be{}Lt([ht("string")],nn.prototype,"name",void 0),Lt([ht("string")],nn.prototype,"type",void 0),Lt([ht("number")],nn.prototype,"referencedType",void 0);class sn extends Be{constructor(){super(...arguments),this.fields=new bt}}Lt([ht("number")],sn.prototype,"id",void 0),Lt([ht("number")],sn.prototype,"extendsId",void 0),Lt([ht([nn])],sn.prototype,"fields",void 0);class jt extends Be{constructor(){super(...arguments),this.types=new bt}static encode(n,r={offset:0}){const o=n.context,c=new jt,h=new un(c),m=o.schemas.get(n.state.constructor);m>0&&(c.rootType=m);const _=new Set,w={},A=$=>{if($.extendsId===void 0||_.has($.extendsId)){_.add($.id),c.types.push($);const R=w[$.id];R!==void 0&&(delete w[$.id],R.forEach(X=>A(X)))}else w[$.extendsId]===void 0&&(w[$.extendsId]=[]),w[$.extendsId].push($)};o.schemas.forEach(($,R)=>{const X=new sn;X.id=Number($);const K=Object.getPrototypeOf(R);K!==Be&&(X.extendsId=o.schemas.get(K));const V=R[Symbol.metadata];if(V!==K[Symbol.metadata])for(const N in V){const q=Number(N),me=V[q].name;if(!Object.prototype.hasOwnProperty.call(V,me))continue;const Oe=new nn;Oe.name=me;let Ze;const je=V[q];if(typeof je.type=="string")Ze=je.type;else{let Rt;Be.is(je.type)?(Ze="ref",Rt=je.type):(Ze=Object.keys(je.type)[0],typeof je.type[Ze]=="string"?Ze+=":"+je.type[Ze]:Rt=je.type[Ze]),Oe.referencedType=Rt?o.getTypeId(Rt):-1}Oe.type=Ze,X.fields.push(Oe)}A(X)});for(const $ in w)w[$].forEach(R=>c.types.push(R));const D=h.encodeAll(r);return Buffer.from(D,0,r.offset)}static decode(n,r){const o=new jt;new Qn(o).decode(n,r);const h=new Ie;o.types.forEach(w=>{const A=h.get(w.extendsId)??Be,D=class extends A{};Ie.register(D),h.add(D,w.id)},{});const m=(w,A,D)=>{A.fields.forEach(($,R)=>{const X=D+R;if($.referencedType!==void 0){let K=$.type,V=h.get($.referencedType);if(!V){const N=$.type.split(":");K=N[0],V=N[1]}K==="ref"?Ae.addField(w,X,$.name,V):Ae.addField(w,X,$.name,{[K]:V})}else Ae.addField(w,X,$.name,$.type)})};o.types.forEach(w=>{const A=h.get(w.id),D=Ae.initialize(A),$=[];let R=w;do $.push(R),R=o.types.find(K=>K.id===R.extendsId);while(R);let X=0;$.reverse().forEach(K=>{m(D,K,X),X+=K.fields.length})});const _=new(h.get(o.rootType||0));return new Qn(_,h)}}Lt([ht([sn])],jt.prototype,"types",void 0),Lt([ht("number")],jt.prototype,"rootType",void 0);function $i(f){const n=f.root,r=n.callbacks,o=new WeakMap;let c;f.triggerChanges=function(_){var A;const w=new Set;for(let D=0,$=_.length;D<$;D++){const R=_[D],X=R.refId,K=R.ref,V=r[X];if(V){if((R.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&R.previousValue instanceof Be){const N=(A=r[n.refIds.get(R.previousValue)])==null?void 0:A[t.OPERATION.DELETE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q]()}if(K instanceof Be){if(!w.has(X)){const N=V==null?void 0:V[t.OPERATION.REPLACE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q]()}if(V.hasOwnProperty(R.field)){const N=V[R.field];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.previousValue)}}else{if((R.op&t.OPERATION.DELETE)===t.OPERATION.DELETE){if(R.previousValue!==void 0){const N=V[t.OPERATION.DELETE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.previousValue,R.dynamicIndex??R.field)}if((R.op&t.OPERATION.ADD)===t.OPERATION.ADD){const N=V[t.OPERATION.ADD];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}}else if((R.op&t.OPERATION.ADD)===t.OPERATION.ADD&&R.previousValue!==R.value){const N=V[t.OPERATION.ADD];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}if(R.value!==R.previousValue&&(R.value!==void 0||R.previousValue!==void 0)){const N=V[t.OPERATION.REPLACE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}}w.add(X)}}};function h(_,w){var $;let A=(($=w.instance)==null?void 0:$.constructor[Symbol.metadata])||_,D=w.instance&&typeof w.instance.forEach=="function"||_&&typeof _[Symbol.metadata]>"u";if(A&&!D){const R=function(X,K,V,N){return N&&w.instance[K]!==void 0&&!o.has(c)&&V(w.instance[K],void 0),n.addCallback(n.refIds.get(X),K,V)};return new Proxy({listen:function(K,V,N=!0){if(w.instance)return R(w.instance,K,V,N);{let q=()=>{};return w.onInstanceAvailable((me,Oe)=>{q=R(me,K,V,N&&Oe&&!o.has(c))}),()=>q()}},onChange:function(K){return n.addCallback(n.refIds.get(w.instance),t.OPERATION.REPLACE,K)},bindTo:function(K,V){return V||(V=Object.keys(A).map(N=>A[N].name)),n.addCallback(n.refIds.get(w.instance),t.OPERATION.REPLACE,()=>{V.forEach(N=>K[N]=w.instance[N])})}},{get(X,K){var N;const V=A[A[K]];if(V){const q=(N=w.instance)==null?void 0:N[K],me=Oe=>{const Ze=m(w.instance).listen(K,(je,Rt)=>{Oe(je,!1),Ze==null||Ze()},!1);n.refIds.get(q)!==void 0&&Oe(q,!0)};return h(V.type,{instance:n.refIds.get(q)&&q,parentInstance:w.instance,onInstanceAvailable:me})}else return X[K]},has(X,K){return A[K]!==void 0},set(X,K,V){throw new Error("not allowed")},deleteProperty(X,K){throw new Error("not allowed")}})}else{const R=function(V,N,q){return q&&V.forEach((me,Oe)=>N(me,Oe)),n.addCallback(n.refIds.get(V),t.OPERATION.ADD,(me,Oe)=>{o.set(N,!0),c=N,N(me,Oe),o.delete(N),c=void 0})},X=function(V,N){return n.addCallback(n.refIds.get(V),t.OPERATION.DELETE,N)},K=function(V,N){return n.addCallback(n.refIds.get(V),t.OPERATION.REPLACE,N)};return new Proxy({onAdd:function(V,N=!0){if(w.instance)return R(w.instance,V,N&&!o.has(c));if(w.onInstanceAvailable){let q=()=>{};return w.onInstanceAvailable((me,Oe)=>{q=R(me,V,N&&Oe&&!o.has(c))}),()=>q()}},onRemove:function(V){if(w.instance)return X(w.instance,V);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(q=>{N=X(q,V)}),()=>N()}},onChange:function(V){if(w.instance)return K(w.instance,V);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(q=>{N=K(q,V)}),()=>N()}}},{get(V,N){if(!V[N])throw new Error(`Can't access '${N}' through callback proxy. access the instance directly.`);return V[N]},has(V,N){return V[N]!==void 0},set(V,N,q){throw new Error("not allowed")},deleteProperty(V,N){throw new Error("not allowed")}})}}function m(_){return h(void 0,{instance:_})}return m}function Mi(f,n){f.triggerChanges=n}class Ui{constructor(n=!1){this.iterable=n,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,n&&(this.items=[])}add(n,r=Ot,o=!0){var _,w;const c=n==null?void 0:n[p];if(c){if(!c.parent&&c.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${c.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",n),this;const h=n.constructor[Symbol.metadata];this.visible.add(c),this.iterable&&o&&this.items.push(n),o&&c.parent&&this.addParentOf(c,r);let m=this.changes.get(c.refId);if(m===void 0&&(m={},this.changes.set(c.refId,m)),r!==Ot){this.tags||(this.tags=new WeakMap);let A;this.tags.has(c)?A=this.tags.get(c):(A=new Set,this.tags.set(c,A)),A.add(r),(w=(_=h==null?void 0:h[ue])==null?void 0:_[r])==null||w.forEach(D=>{c.getChange(D)!==t.OPERATION.DELETE&&(m[D]=t.OPERATION.ADD)})}else{const A=this.invisible.has(c),D=c.filteredChanges!==void 0?c.allFilteredChanges:c.allChanges;for(let $=0,R=D.operations.length;$<R;$++){const X=D.operations[$];if(X===void 0)continue;const K=c.indexedOperations[X]??t.OPERATION.ADD,V=h==null?void 0:h[X].tag;!c.isNew&&(A||V===void 0||V===r)&&K!==t.OPERATION.DELETE&&(m[X]=K)}}return c.forEachChild((A,D)=>{h&&h[D].tag!==void 0&&h[D].tag!==r||this.add(A.ref,r,!1)}),this}addParentOf(n,r){var h;const o=n.parent[p],c=n.parentIndex;if(!this.visible.has(o)){this.visible.add(o);const m=(h=o.parent)==null?void 0:h[p];m&&m.filteredChanges!==void 0&&this.addParentOf(o,r)}if(o.getChange(c)!==t.OPERATION.DELETE){let m=this.changes.get(o.refId);m===void 0&&(m={},this.changes.set(o.refId,m)),this.tags||(this.tags=new WeakMap);let _;this.tags.has(o)?_=this.tags.get(o):(_=new Set,this.tags.set(o,_)),_.add(r),m[c]=t.OPERATION.ADD}}remove(n,r=Ot,o=!1){var w;const c=n[p];if(!c)return console.warn("StateView#remove(), invalid object:",n),this;this.visible.delete(c),this.iterable&&!o&&si(this.items,this.items.indexOf(n));const m=c.ref.constructor[Symbol.metadata];let _=this.changes.get(c.refId);if(_===void 0&&(_={},this.changes.set(c.refId,_)),r===Ot){const A=c.parent;if(!Ae.isValidInstance(A)&&c.isFiltered){const D=A[p];let $=this.changes.get(D.refId);$===void 0&&($={},this.changes.set(D.refId,$)),$[c.parentIndex]=t.OPERATION.DELETE}else(w=m==null?void 0:m[ne])==null||w.forEach(D=>_[D]=t.OPERATION.DELETE)}else m==null||m[ue][r].forEach(A=>_[A]=t.OPERATION.DELETE);if(this.tags&&this.tags.has(c)){const A=this.tags.get(c);r===void 0?this.tags.delete(c):(A.delete(r),A.size===0&&this.tags.delete(c))}return this}has(n){return this.visible.has(n[p])}hasTag(n,r=Ot){var c;const o=(c=this.tags)==null?void 0:c.get(n[p]);return(o==null?void 0:o.has(r))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let n=0,r=this.items.length;n<r;n++)this.remove(this.items[n],Ot,!0);this.items.length=0}isChangeTreeVisible(n){let r=this.visible.has(n);return!r&&n.isVisibilitySharedWithParent&&this.visible.has(n.parent[p])&&(this.visible.add(n),r=!0),r}}ce("map",{constructor:ct}),ce("array",{constructor:bt}),ce("set",{constructor:_n}),ce("collection",{constructor:vn}),t.$changes=p,t.$childType=I,t.$decoder=d,t.$deleteByIndex=y,t.$encoder=u,t.$filter=E,t.$getByIndex=g,t.$track=l,t.ArraySchema=bt,t.ChangeTree=Ct,t.CollectionSchema=vn,t.Decoder=Qn,t.Encoder=un,t.MapSchema=ct,t.Metadata=Ae,t.Reflection=jt,t.ReflectionField=nn,t.ReflectionType=sn,t.Schema=Be,t.SetSchema=_n,t.StateView=Ui,t.TypeContext=Ie,t.decode=H,t.decodeKeyValueOperation=kn,t.decodeSchemaOperation=Zs,t.defineCustomTypes=Re,t.defineTypes=Ci,t.deprecated=En,t.dumpChanges=Li,t.encode=Ee,t.encodeArray=Ln,t.encodeKeyValueOperation=yn,t.encodeSchemaOperation=hs,t.entity=Pi,t.getDecoderStateCallbacks=$i,t.getRawChangesCallback=Mi,t.registerType=ce,t.schema=Js,t.type=ht,t.view=Ys})})(Aa,Aa.exports);var Ka=Aa.exports,vo=Gr,ai=Ka;class Ud{constructor(e){this.events=e,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(e,t={}){const i=t.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(t.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(e,i),this.wt.ready.then(a=>{console.log("WebTransport ready!",a),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(u=>{this.reader=u.value.readable.getReader(),this.writer=u.value.writable.getWriter(),this.sendSeatReservation(t.room.roomId,t.sessionId,t.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(u=>{console.error("failed to read incoming stream",u),console.error("TODO: close the connection")})}).catch(a=>{console.log("WebTransport not ready!",a),this._close()}),this.wt.closed.then(a=>{console.log("WebTransport closed w/ success",a),this.events.onclose({code:a.closeCode,reason:a.reason})}).catch(a=>{console.log("WebTransport closed w/ error",a),this.events.onerror(a),this.events.onclose({code:a.closeCode,reason:a.reason})}).finally(()=>{this._close()})}send(e){const t=ai.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),i=new Uint8Array(t+e.length);i.set(this.lengthPrefixBuffer.subarray(0,t),0),i.set(e,t),this.writer.write(i)}sendUnreliable(e){const t=ai.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),i=new Uint8Array(t+e.length);i.set(this.lengthPrefixBuffer.subarray(0,t),0),i.set(e,t),this.unreliableWriter.write(i)}close(e,t){try{this.wt.close({closeCode:e,reason:t})}catch(i){console.error(i)}}readIncomingData(){return vo.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.reader.read();const t=e.value,i={offset:0};do{const a=ai.decode.number(t,i);this.events.onmessage({data:t.subarray(i.offset,i.offset+a)}),i.offset+=a}while(i.offset<t.length)}catch(t){t.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",t);break}if(e.done)break}})}readIncomingUnreliableData(){return vo.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.unreliableReader.read();const t=e.value,i={offset:0};do{const a=ai.decode.number(t,i);this.events.onmessage({data:t.subarray(i.offset,i.offset+a)}),i.offset+=a}while(i.offset<t.length)}catch(t){t.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",t);break}if(e.done)break}})}sendSeatReservation(e,t,i){const a={offset:0},l=[];ai.encode.string(l,e,a),ai.encode.string(l,t,a),i&&ai.encode.string(l,i,a),this.writer.write(new Uint8Array(l).buffer)}_close(){this.isOpen=!1}}sc.H3TransportTransport=Ud;var ic={},Fd=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},Vd=Fd;const aa=globalThis.WebSocket||Vd;let jd=class{constructor(e){this.events=e}send(e){this.ws.send(e)}sendUnreliable(e){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(e,t){try{this.ws=new aa(e,{headers:t,protocols:this.protocols})}catch{this.ws=new aa(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,t){this.ws.close(e,t)}get isOpen(){return this.ws.readyState===aa.OPEN}};ic.WebSocketTransport=jd;var Hd=sc,Gd=ic;let Zd=class{constructor(e){switch(this.events={},e){case"h3":this.transport=new Hd.H3TransportTransport(this.events);break;default:this.transport=new Gd.WebSocketTransport(this.events);break}}connect(e,t){this.transport.connect.call(this.transport,e,t)}send(e){this.transport.send(e)}sendUnreliable(e){this.transport.sendUnreliable(e)}close(e,t){this.transport.close(e,t)}get isOpen(){return this.transport.isOpen}};nc.Connection=Zd;var qa={};(function(s){s.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(s.Protocol||(s.Protocol={})),s.ErrorCode=void 0,function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(s.ErrorCode||(s.ErrorCode={}))})(qa);var Zr={};const rc={};function zd(s,e){rc[s]=e}function Wd(s){const e=rc[s];if(!e)throw new Error("missing serializer: "+s);return e}Zr.getSerializer=Wd;Zr.registerSerializer=zd;var Ya={};const Kd=()=>({emit(s,...e){let t=this.events[s]||[];for(let i=0,a=t.length;i<a;i++)t[i](...e)},events:{},on(s,e){var t;return!((t=this.events[s])===null||t===void 0)&&t.push(e)||(this.events[s]=[e]),()=>{var i;this.events[s]=(i=this.events[s])===null||i===void 0?void 0:i.filter(a=>e!==a)}}});Ya.createNanoEvents=Kd;var Xa={};class ac{constructor(){this.handlers=[]}register(e,t=!1){return this.handlers.push(e),this}invoke(...e){this.handlers.forEach(t=>t.apply(this,e))}invokeAsync(...e){return Promise.all(this.handlers.map(t=>t.apply(this,e)))}remove(e){const t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function qd(){const s=new ac;function e(t){return s.register(t,this===null)}return e.once=t=>{const i=function(...a){t.apply(this,a),s.remove(i)};s.register(i)},e.remove=t=>s.remove(t),e.invoke=(...t)=>s.invoke(...t),e.invokeAsync=(...t)=>s.invokeAsync(...t),e.clear=()=>s.clear(),e}Xa.EventEmitter=ac;Xa.createSignal=qd;var zr={},Tr=Ka;function Yd(s){try{return Tr.getDecoderStateCallbacks(s.serializer.decoder)}catch{return}}let Xd=class{setState(e,t){this.decoder.decode(e,t)}getState(){return this.state}patch(e,t){return this.decoder.decode(e,t)}teardown(){this.decoder.root.clearRefs()}handshake(e,t){this.state?(Tr.Reflection.decode(e,t),this.decoder=new Tr.Decoder(this.state)):(this.decoder=Tr.Reflection.decode(e,t),this.state=this.decoder.state)}};zr.SchemaSerializer=Xd;zr.getStateCallbacks=Yd;var Oa;try{Oa=new TextDecoder}catch{}var le,Nn,k=0,ft={},qe,Ps,Rn=0,ns=0,Vt,ws,Xt=[],ze,_o={useRecords:!1,mapsAsObjects:!0};class oc{}const Ja=new oc;Ja.name="MessagePack 0xC1";var ks=!1,lc=2,wo;try{new Function("")}catch{lc=1/0}class Vs{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(le)return gc(()=>(Mr(),this?this.unpack(e,t):Vs.prototype.unpack.call(_o,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof t=="object"?(Nn=t.end||e.length,k=t.start||0):(k=0,Nn=t>-1?t:e.length),ns=0,Ps=null,Vt=null,le=e;try{ze=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw le=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Vs){if(ft=this,this.structures)return qe=this.structures,vr(t);(!qe||qe.length>0)&&(qe=[])}else ft=_o,(!qe||qe.length>0)&&(qe=[]);return vr(t)}unpackMultiple(e,t){let i,a=0;try{ks=!0;let l=e.length,u=this?this.unpack(e,l):Kr.unpack(e,l);if(t){if(t(u,a,k)===!1)return;for(;k<l;)if(a=k,t(vr(),a,k)===!1)return}else{for(i=[u];k<l;)a=k,i.push(vr());return i}}catch(l){throw l.lastPosition=a,l.values=i,l}finally{ks=!1,Mr()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(i=>i.slice(0)));for(let i=0,a=e.length;i<a;i++){let l=e[i];l&&(l.isShared=!0,i>=32&&(l.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let a=e[i],l=t[i];l&&(a&&((e.restoreStructures||(e.restoreStructures=[]))[i]=a),e[i]=l)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function vr(s){try{if(!ft.trusted&&!ks){let t=qe.sharedLength||0;t<qe.length&&(qe.length=t)}let e;if(ft.randomAccessStructure&&le[k]<64&&le[k]>=32&&wo?(e=wo(le,k,Nn,ft),le=null,!(s&&s.lazy)&&e&&(e=e.toJSON()),k=Nn):e=Dt(),Vt&&(k=Vt.postBundlePosition,Vt=null),ks&&(qe.restoreStructures=null),k==Nn)qe&&qe.restoreStructures&&To(),qe=null,le=null,ws&&(ws=null);else{if(k>Nn)throw new Error("Unexpected end of MessagePack data");if(!ks){let t;try{t=JSON.stringify(e,(i,a)=>typeof a=="bigint"?`${a}n`:a).slice(0,100)}catch(i){t="(JSON view not available "+i+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw qe&&qe.restoreStructures&&To(),Mr(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||k>Nn)&&(e.incomplete=!0),e}}function To(){for(let s in qe.restoreStructures)qe[s]=qe.restoreStructures[s];qe.restoreStructures=null}function Dt(){let s=le[k++];if(s<160)if(s<128){if(s<64)return s;{let e=qe[s&63]||ft.getStructures&&fc()[s&63];return e?(e.read||(e.read=Qa(e,s&63)),e.read()):s}}else if(s<144)if(s-=128,ft.mapsAsObjects){let e={};for(let t=0;t<s;t++){let i=dc();i==="__proto__"&&(i="__proto_"),e[i]=Dt()}return e}else{let e=new Map;for(let t=0;t<s;t++)e.set(Dt(),Dt());return e}else{s-=144;let e=new Array(s);for(let t=0;t<s;t++)e[t]=Dt();return ft.freezeData?Object.freeze(e):e}else if(s<192){let e=s-160;if(ns>=k)return Ps.slice(k-Rn,(k+=e)-Rn);if(ns==0&&Nn<140){let t=e<16?eo(e):uc(e);if(t!=null)return t}return xa(e)}else{let e;switch(s){case 192:return null;case 193:return Vt?(e=Dt(),e>0?Vt[1].slice(Vt.position1,Vt.position1+=e):Vt[0].slice(Vt.position0,Vt.position0-=e)):Ja;case 194:return!1;case 195:return!0;case 196:if(e=le[k++],e===void 0)throw new Error("Unexpected end of buffer");return oa(e);case 197:return e=ze.getUint16(k),k+=2,oa(e);case 198:return e=ze.getUint32(k),k+=4,oa(e);case 199:return oi(le[k++]);case 200:return e=ze.getUint16(k),k+=2,oi(e);case 201:return e=ze.getUint32(k),k+=4,oi(e);case 202:if(e=ze.getFloat32(k),ft.useFloat32>2){let t=Wr[(le[k]&127)<<1|le[k+1]>>7];return k+=4,(t*e+(e>0?.5:-.5)>>0)/t}return k+=4,e;case 203:return e=ze.getFloat64(k),k+=8,e;case 204:return le[k++];case 205:return e=ze.getUint16(k),k+=2,e;case 206:return e=ze.getUint32(k),k+=4,e;case 207:return ft.int64AsType==="number"?(e=ze.getUint32(k)*4294967296,e+=ze.getUint32(k+4)):ft.int64AsType==="string"?e=ze.getBigUint64(k).toString():ft.int64AsType==="auto"?(e=ze.getBigUint64(k),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=ze.getBigUint64(k),k+=8,e;case 208:return ze.getInt8(k++);case 209:return e=ze.getInt16(k),k+=2,e;case 210:return e=ze.getInt32(k),k+=4,e;case 211:return ft.int64AsType==="number"?(e=ze.getInt32(k)*4294967296,e+=ze.getUint32(k+4)):ft.int64AsType==="string"?e=ze.getBigInt64(k).toString():ft.int64AsType==="auto"?(e=ze.getBigInt64(k),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=ze.getBigInt64(k),k+=8,e;case 212:if(e=le[k++],e==114)return Do(le[k++]&63);{let t=Xt[e];if(t)return t.read?(k++,t.read(Dt())):t.noBuffer?(k++,t()):t(le.subarray(k,++k));throw new Error("Unknown extension "+e)}case 213:return e=le[k],e==114?(k++,Do(le[k++]&63,le[k++])):oi(2);case 214:return oi(4);case 215:return oi(8);case 216:return oi(16);case 217:return e=le[k++],ns>=k?Ps.slice(k-Rn,(k+=e)-Rn):Qd(e);case 218:return e=ze.getUint16(k),k+=2,ns>=k?Ps.slice(k-Rn,(k+=e)-Rn):eh(e);case 219:return e=ze.getUint32(k),k+=4,ns>=k?Ps.slice(k-Rn,(k+=e)-Rn):th(e);case 220:return e=ze.getUint16(k),k+=2,So(e);case 221:return e=ze.getUint32(k),k+=4,So(e);case 222:return e=ze.getUint16(k),k+=2,Ao(e);case 223:return e=ze.getUint32(k),k+=4,Ao(e);default:if(s>=224)return s-256;if(s===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+s)}}}const Jd=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Qa(s,e){function t(){if(t.count++>lc){let a=s.read=new Function("r","return function(){return "+(ft.freezeData?"Object.freeze":"")+"({"+s.map(l=>l==="__proto__"?"__proto_:r()":Jd.test(l)?l+":r()":"["+JSON.stringify(l)+"]:r()").join(",")+"})}")(Dt);return s.highByte===0&&(s.read=Io(e,s.read)),a()}let i={};for(let a=0,l=s.length;a<l;a++){let u=s[a];u==="__proto__"&&(u="__proto_"),i[u]=Dt()}return ft.freezeData?Object.freeze(i):i}return t.count=0,s.highByte===0?Io(e,t):t}const Io=(s,e)=>function(){let t=le[k++];if(t===0)return e();let i=s<32?-(s+(t<<5)):s+(t<<5),a=qe[i]||fc()[i];if(!a)throw new Error("Record id is not defined for "+i);return a.read||(a.read=Qa(a,s)),a.read()};function fc(){let s=gc(()=>(le=null,ft.getStructures()));return qe=ft._mergeStructures(s,qe)}var xa=cr,Qd=cr,eh=cr,th=cr;let nh=!1;function cr(s){let e;if(s<16&&(e=eo(s)))return e;if(s>64&&Oa)return Oa.decode(le.subarray(k,k+=s));const t=k+s,i=[];for(e="";k<t;){const a=le[k++];if(!(a&128))i.push(a);else if((a&224)===192){const l=le[k++]&63;i.push((a&31)<<6|l)}else if((a&240)===224){const l=le[k++]&63,u=le[k++]&63;i.push((a&31)<<12|l<<6|u)}else if((a&248)===240){const l=le[k++]&63,u=le[k++]&63,d=le[k++]&63;let E=(a&7)<<18|l<<12|u<<6|d;E>65535&&(E-=65536,i.push(E>>>10&1023|55296),E=56320|E&1023),i.push(E)}else i.push(a);i.length>=4096&&(e+=Ut.apply(String,i),i.length=0)}return i.length>0&&(e+=Ut.apply(String,i)),e}function So(s){let e=new Array(s);for(let t=0;t<s;t++)e[t]=Dt();return ft.freezeData?Object.freeze(e):e}function Ao(s){if(ft.mapsAsObjects){let e={};for(let t=0;t<s;t++){let i=dc();i==="__proto__"&&(i="__proto_"),e[i]=Dt()}return e}else{let e=new Map;for(let t=0;t<s;t++)e.set(Dt(),Dt());return e}}var Ut=String.fromCharCode;function uc(s){let e=k,t=new Array(s);for(let i=0;i<s;i++){const a=le[k++];if((a&128)>0){k=e;return}t[i]=a}return Ut.apply(String,t)}function eo(s){if(s<4)if(s<2){if(s===0)return"";{let e=le[k++];if((e&128)>1){k-=1;return}return Ut(e)}}else{let e=le[k++],t=le[k++];if((e&128)>0||(t&128)>0){k-=2;return}if(s<3)return Ut(e,t);let i=le[k++];if((i&128)>0){k-=3;return}return Ut(e,t,i)}else{let e=le[k++],t=le[k++],i=le[k++],a=le[k++];if((e&128)>0||(t&128)>0||(i&128)>0||(a&128)>0){k-=4;return}if(s<6){if(s===4)return Ut(e,t,i,a);{let l=le[k++];if((l&128)>0){k-=5;return}return Ut(e,t,i,a,l)}}else if(s<8){let l=le[k++],u=le[k++];if((l&128)>0||(u&128)>0){k-=6;return}if(s<7)return Ut(e,t,i,a,l,u);let d=le[k++];if((d&128)>0){k-=7;return}return Ut(e,t,i,a,l,u,d)}else{let l=le[k++],u=le[k++],d=le[k++],E=le[k++];if((l&128)>0||(u&128)>0||(d&128)>0||(E&128)>0){k-=8;return}if(s<10){if(s===8)return Ut(e,t,i,a,l,u,d,E);{let g=le[k++];if((g&128)>0){k-=9;return}return Ut(e,t,i,a,l,u,d,E,g)}}else if(s<12){let g=le[k++],y=le[k++];if((g&128)>0||(y&128)>0){k-=10;return}if(s<11)return Ut(e,t,i,a,l,u,d,E,g,y);let p=le[k++];if((p&128)>0){k-=11;return}return Ut(e,t,i,a,l,u,d,E,g,y,p)}else{let g=le[k++],y=le[k++],p=le[k++],I=le[k++];if((g&128)>0||(y&128)>0||(p&128)>0||(I&128)>0){k-=12;return}if(s<14){if(s===12)return Ut(e,t,i,a,l,u,d,E,g,y,p,I);{let F=le[k++];if((F&128)>0){k-=13;return}return Ut(e,t,i,a,l,u,d,E,g,y,p,I,F)}}else{let F=le[k++],J=le[k++];if((F&128)>0||(J&128)>0){k-=14;return}if(s<15)return Ut(e,t,i,a,l,u,d,E,g,y,p,I,F,J);let z=le[k++];if((z&128)>0){k-=15;return}return Ut(e,t,i,a,l,u,d,E,g,y,p,I,F,J,z)}}}}}function Oo(){let s=le[k++],e;if(s<192)e=s-160;else switch(s){case 217:e=le[k++];break;case 218:e=ze.getUint16(k),k+=2;break;case 219:e=ze.getUint32(k),k+=4;break;default:throw new Error("Expected string")}return cr(e)}function oa(s){return ft.copyBuffers?Uint8Array.prototype.slice.call(le,k,k+=s):le.subarray(k,k+=s)}function oi(s){let e=le[k++];if(Xt[e]){let t;return Xt[e](le.subarray(k,t=k+=s),i=>{k=i;try{return Dt()}finally{k=t}})}else throw new Error("Unknown extension type "+e)}var xo=new Array(4096);function dc(){let s=le[k++];if(s>=160&&s<192){if(s=s-160,ns>=k)return Ps.slice(k-Rn,(k+=s)-Rn);if(!(ns==0&&Nn<180))return xa(s)}else return k--,hc(Dt());let e=(s<<5^(s>1?ze.getUint16(k):s>0?le[k]:0))&4095,t=xo[e],i=k,a=k+s-3,l,u=0;if(t&&t.bytes==s){for(;i<a;){if(l=ze.getUint32(i),l!=t[u++]){i=1879048192;break}i+=4}for(a+=3;i<a;)if(l=le[i++],l!=t[u++]){i=1879048192;break}if(i===a)return k=i,t.string;a-=3,i=k}for(t=[],xo[e]=t,t.bytes=s;i<a;)l=ze.getUint32(i),t.push(l),i+=4;for(a+=3;i<a;)l=le[i++],t.push(l);let d=s<16?eo(s):uc(s);return d!=null?t.string=d:t.string=xa(s)}function hc(s){if(typeof s=="string")return s;if(typeof s=="number"||typeof s=="boolean"||typeof s=="bigint")return s.toString();if(s==null)return s+"";if(ft.allowArraysInMapKeys&&Array.isArray(s)&&s.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return s.flat().toString();throw new Error(`Invalid property type for record: ${typeof s}`)}const Do=(s,e)=>{let t=Dt().map(hc),i=s;e!==void 0&&(s=s<32?-((e<<5)+s):(e<<5)+s,t.highByte=e);let a=qe[s];return a&&(a.isShared||ks)&&((qe.restoreStructures||(qe.restoreStructures=[]))[s]=a),qe[s]=t,t.read=Qa(t,i),t.read()};Xt[0]=()=>{};Xt[0].noBuffer=!0;Xt[66]=s=>{let e=s.length,t=BigInt(s[0]&128?s[0]-256:s[0]);for(let i=1;i<e;i++)t<<=BigInt(8),t+=BigInt(s[i]);return t};let sh={Error,TypeError,ReferenceError};Xt[101]=()=>{let s=Dt();return(sh[s[0]]||Error)(s[1],{cause:s[2]})};Xt[105]=s=>{if(ft.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=ze.getUint32(k-4);ws||(ws=new Map);let t=le[k],i;t>=144&&t<160||t==220||t==221?i=[]:i={};let a={target:i};ws.set(e,a);let l=Dt();return a.used?Object.assign(i,l):(a.target=l,l)};Xt[112]=s=>{if(ft.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=ze.getUint32(k-4),t=ws.get(e);return t.used=!0,t.target};Xt[115]=()=>new Set(Dt());const pc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(s=>s+"Array");let ih=typeof globalThis=="object"?globalThis:window;Xt[116]=s=>{let e=s[0],t=pc[e];if(!t){if(e===16){let i=new ArrayBuffer(s.length-1);return new Uint8Array(i).set(s.subarray(1)),i}throw new Error("Could not find typed array for code "+e)}return new ih[t](Uint8Array.prototype.slice.call(s,1).buffer)};Xt[120]=()=>{let s=Dt();return new RegExp(s[0],s[1])};const rh=[];Xt[98]=s=>{let e=(s[0]<<24)+(s[1]<<16)+(s[2]<<8)+s[3],t=k;return k+=e-s.length,Vt=rh,Vt=[Oo(),Oo()],Vt.position0=0,Vt.position1=0,Vt.postBundlePosition=k,k=t,Dt()};Xt[255]=s=>s.length==4?new Date((s[0]*16777216+(s[1]<<16)+(s[2]<<8)+s[3])*1e3):s.length==8?new Date(((s[0]<<22)+(s[1]<<14)+(s[2]<<6)+(s[3]>>2))/1e6+((s[3]&3)*4294967296+s[4]*16777216+(s[5]<<16)+(s[6]<<8)+s[7])*1e3):s.length==12?new Date(((s[0]<<24)+(s[1]<<16)+(s[2]<<8)+s[3])/1e6+((s[4]&128?-281474976710656:0)+s[6]*1099511627776+s[7]*4294967296+s[8]*16777216+(s[9]<<16)+(s[10]<<8)+s[11])*1e3):new Date("invalid");function gc(s){let e=Nn,t=k,i=Rn,a=ns,l=Ps,u=ws,d=Vt,E=new Uint8Array(le.slice(0,Nn)),g=qe,y=qe.slice(0,qe.length),p=ft,I=ks,F=s();return Nn=e,k=t,Rn=i,ns=a,Ps=l,ws=u,Vt=d,le=E,ks=I,qe=g,qe.splice(0,qe.length,...y),ft=p,ze=new DataView(le.buffer,le.byteOffset,le.byteLength),F}function Mr(){le=null,ws=null,qe=null}function ah(s){s.unpack?Xt[s.type]=s.unpack:Xt[s.type]=s}const Wr=new Array(147);for(let s=0;s<256;s++)Wr[s]=+("1e"+Math.floor(45.15-s*.30103));const oh=Vs;var Kr=new Vs({useRecords:!1});const lh=Kr.unpack,ch=Kr.unpackMultiple,fh=Kr.unpack,mc={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let yc=new Float32Array(1),Ro=new Uint8Array(yc.buffer,0,4);function uh(s){yc[0]=s;let e=Wr[(Ro[3]&127)<<1|Ro[2]>>7];return(e*s+(s>0?.5:-.5)>>0)/e}let Ir;try{Ir=new TextEncoder}catch{}let Ur,to;const qr=typeof Buffer<"u",_r=qr?function(s){return Buffer.allocUnsafeSlow(s)}:Uint8Array,bc=qr?Buffer:Uint8Array,No=qr?4294967296:2144337920;let j,Fi,dt,B=0,ln,vt=null,dh;const hh=21760,ph=/[\u0080-\uFFFF]/,yi=Symbol("record-id");class fr extends Vs{constructor(e){super(e),this.offset=0;let t,i,a,l,u=bc.prototype.utf8Write?function(M,re){return j.utf8Write(M,re,j.byteLength-re)}:Ir&&Ir.encodeInto?function(M,re){return Ir.encodeInto(M,j.subarray(re)).written}:!1,d=this;e||(e={});let E=e&&e.sequential,g=e.structures||e.saveStructures,y=e.maxSharedStructures;if(y==null&&(y=g?32:0),y>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let p=e.maxOwnStructures;p==null&&(p=g?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let I=y>32||p+y>64,F=y+64,J=y+p+64;if(J>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let z=[],W=0,he=0;this.pack=this.encode=function(M,re){if(j||(j=new _r(8192),dt=j.dataView||(j.dataView=new DataView(j.buffer,0,8192)),B=0),ln=j.length-10,ln-B<2048?(j=new _r(j.length),dt=j.dataView||(j.dataView=new DataView(j.buffer,0,j.length)),ln=j.length-10,B=0):B=B+7&2147483640,t=B,re&wc&&(B+=re&255),l=d.structuredClone?new Map:null,d.bundleStrings&&typeof M!="string"?(vt=[],vt.size=1/0):vt=null,a=d.structures,a){a.uninitialized&&(a=d._mergeStructures(d.getStructures()));let ee=a.sharedLength||0;if(ee>y)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+a.sharedLength);if(!a.transitions){a.transitions=Object.create(null);for(let te=0;te<ee;te++){let pe=a[te];if(!pe)continue;let xe,we=a.transitions;for(let Ge=0,Ve=pe.length;Ge<Ve;Ge++){let lt=pe[Ge];xe=we[lt],xe||(xe=we[lt]=Object.create(null)),we=xe}we[yi]=te+64}this.lastNamedStructuresLength=ee}E||(a.nextId=ee+64)}i&&(i=!1);let ie;try{d.randomAccessStructure&&M&&M.constructor&&M.constructor===Object?Fe(M):Pe(M);let ee=vt;if(vt&&Lo(t,Pe,0),l&&l.idsToInsert){let te=l.idsToInsert.sort((Ge,Ve)=>Ge.offset>Ve.offset?1:-1),pe=te.length,xe=-1;for(;ee&&pe>0;){let Ge=te[--pe].offset+t;Ge<ee.stringsPosition+t&&xe===-1&&(xe=0),Ge>ee.position+t?xe>=0&&(xe+=6):(xe>=0&&(dt.setUint32(ee.position+t,dt.getUint32(ee.position+t)+xe),xe=-1),ee=ee.previous,pe++)}xe>=0&&ee&&dt.setUint32(ee.position+t,dt.getUint32(ee.position+t)+xe),B+=te.length*6,B>ln&&at(B),d.offset=B;let we=mh(j.subarray(t,B),te);return l=null,we}return d.offset=B,re&vc?(j.start=t,j.end=B,j):j.subarray(t,B)}catch(ee){throw ie=ee,ee}finally{if(a&&(ne(),i&&d.saveStructures)){let ee=a.sharedLength||0,te=j.subarray(t,B),pe=bh(a,d);if(!ie)return d.saveStructures(pe,pe.isCompatible)===!1?d.pack(M,re):(d.lastNamedStructuresLength=ee,j.length>1073741824&&(j=null),te)}j.length>1073741824&&(j=null),re&_c&&(B=t)}};const ne=()=>{he<10&&he++;let M=a.sharedLength||0;if(a.length>M&&!E&&(a.length=M),W>1e4)a.transitions=null,he=0,W=0,z.length>0&&(z=[]);else if(z.length>0&&!E){for(let re=0,ie=z.length;re<ie;re++)z[re][yi]=0;z=[]}},ue=M=>{var re=M.length;re<16?j[B++]=144|re:re<65536?(j[B++]=220,j[B++]=re>>8,j[B++]=re&255):(j[B++]=221,dt.setUint32(B,re),B+=4);for(let ie=0;ie<re;ie++)Pe(M[ie])},Pe=M=>{B>ln&&(j=at(B));var re=typeof M,ie;if(re==="string"){let ee=M.length;if(vt&&ee>=4&&ee<4096){if((vt.size+=ee)>hh){let we,Ge=(vt[0]?vt[0].length*3+vt[1].length:0)+10;B+Ge>ln&&(j=at(B+Ge));let Ve;vt.position?(Ve=vt,j[B]=200,B+=3,j[B++]=98,we=B-t,B+=4,Lo(t,Pe,0),dt.setUint16(we+t-3,B-t-we)):(j[B++]=214,j[B++]=98,we=B-t,B+=4),vt=["",""],vt.previous=Ve,vt.size=0,vt.position=we}let xe=ph.test(M);vt[xe?0:1]+=M,j[B++]=193,Pe(xe?-ee:ee);return}let te;ee<32?te=1:ee<256?te=2:ee<65536?te=3:te=5;let pe=ee*3;if(B+pe>ln&&(j=at(B+pe)),ee<64||!u){let xe,we,Ge,Ve=B+te;for(xe=0;xe<ee;xe++)we=M.charCodeAt(xe),we<128?j[Ve++]=we:we<2048?(j[Ve++]=we>>6|192,j[Ve++]=we&63|128):(we&64512)===55296&&((Ge=M.charCodeAt(xe+1))&64512)===56320?(we=65536+((we&1023)<<10)+(Ge&1023),xe++,j[Ve++]=we>>18|240,j[Ve++]=we>>12&63|128,j[Ve++]=we>>6&63|128,j[Ve++]=we&63|128):(j[Ve++]=we>>12|224,j[Ve++]=we>>6&63|128,j[Ve++]=we&63|128);ie=Ve-B-te}else ie=u(M,B+te);ie<32?j[B++]=160|ie:ie<256?(te<2&&j.copyWithin(B+2,B+1,B+1+ie),j[B++]=217,j[B++]=ie):ie<65536?(te<3&&j.copyWithin(B+3,B+2,B+2+ie),j[B++]=218,j[B++]=ie>>8,j[B++]=ie&255):(te<5&&j.copyWithin(B+5,B+3,B+3+ie),j[B++]=219,dt.setUint32(B,ie),B+=4),B+=ie}else if(re==="number")if(M>>>0===M)M<32||M<128&&this.useRecords===!1||M<64&&!this.randomAccessStructure?j[B++]=M:M<256?(j[B++]=204,j[B++]=M):M<65536?(j[B++]=205,j[B++]=M>>8,j[B++]=M&255):(j[B++]=206,dt.setUint32(B,M),B+=4);else if(M>>0===M)M>=-32?j[B++]=256+M:M>=-128?(j[B++]=208,j[B++]=M+256):M>=-32768?(j[B++]=209,dt.setInt16(B,M),B+=2):(j[B++]=210,dt.setInt32(B,M),B+=4);else{let ee;if((ee=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){j[B++]=202,dt.setFloat32(B,M);let te;if(ee<4||(te=M*Wr[(j[B]&127)<<1|j[B+1]>>7])>>0===te){B+=4;return}else B--}j[B++]=203,dt.setFloat64(B,M),B+=8}else if(re==="object"||re==="function")if(!M)j[B++]=192;else{if(l){let te=l.get(M);if(te){if(!te.id){let pe=l.idsToInsert||(l.idsToInsert=[]);te.id=pe.push(te)}j[B++]=214,j[B++]=112,dt.setUint32(B,te.id),B+=4;return}else l.set(M,{offset:B-t})}let ee=M.constructor;if(ee===Object)mt(M);else if(ee===Array)ue(M);else if(ee===Map)if(this.mapAsEmptyObject)j[B++]=128;else{ie=M.size,ie<16?j[B++]=128|ie:ie<65536?(j[B++]=222,j[B++]=ie>>8,j[B++]=ie&255):(j[B++]=223,dt.setUint32(B,ie),B+=4);for(let[te,pe]of M)Pe(te),Pe(pe)}else{for(let te=0,pe=Ur.length;te<pe;te++){let xe=to[te];if(M instanceof xe){let we=Ur[te];if(we.write){we.type&&(j[B++]=212,j[B++]=we.type,j[B++]=0);let Pt=we.write.call(this,M);Pt===M?Array.isArray(M)?ue(M):mt(M):Pe(Pt);return}let Ge=j,Ve=dt,lt=B;j=null;let Tt;try{Tt=we.pack.call(this,M,Pt=>(j=Ge,Ge=null,B+=Pt,B>ln&&at(B),{target:j,targetView:dt,position:B-Pt}),Pe)}finally{Ge&&(j=Ge,dt=Ve,B=lt,ln=j.length-10)}Tt&&(Tt.length+B>ln&&at(Tt.length+B),B=gh(Tt,j,B,we.type));return}}if(Array.isArray(M))ue(M);else{if(M.toJSON){const te=M.toJSON();if(te!==M)return Pe(te)}if(re==="function")return Pe(this.writeFunction&&this.writeFunction(M));mt(M)}}}else if(re==="boolean")j[B++]=M?195:194;else if(re==="bigint"){if(M<BigInt(1)<<BigInt(63)&&M>=-(BigInt(1)<<BigInt(63)))j[B++]=211,dt.setBigInt64(B,M);else if(M<BigInt(1)<<BigInt(64)&&M>0)j[B++]=207,dt.setBigUint64(B,M);else if(this.largeBigIntToFloat)j[B++]=203,dt.setFloat64(B,Number(M));else{if(this.largeBigIntToString)return Pe(M.toString());if(this.useBigIntExtension&&M<BigInt(2)**BigInt(1023)&&M>-(BigInt(2)**BigInt(1023))){j[B++]=199,B++,j[B++]=66;let ee=[],te;do{let pe=M&BigInt(255);te=(pe&BigInt(128))===(M<BigInt(0)?BigInt(128):BigInt(0)),ee.push(pe),M>>=BigInt(8)}while(!((M===BigInt(0)||M===BigInt(-1))&&te));j[B-2]=ee.length;for(let pe=ee.length;pe>0;)j[B++]=Number(ee[--pe]);return}else throw new RangeError(M+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}B+=8}else if(re==="undefined")this.encodeUndefinedAsNil?j[B++]=192:(j[B++]=212,j[B++]=0,j[B++]=0);else throw new Error("Unknown type: "+re)},We=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?M=>{let re;if(this.skipValues){re=[];for(let te in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(te))&&!this.skipValues.includes(M[te])&&re.push(te)}else re=Object.keys(M);let ie=re.length;ie<16?j[B++]=128|ie:ie<65536?(j[B++]=222,j[B++]=ie>>8,j[B++]=ie&255):(j[B++]=223,dt.setUint32(B,ie),B+=4);let ee;if(this.coercibleKeyAsNumber)for(let te=0;te<ie;te++){ee=re[te];let pe=Number(ee);Pe(isNaN(pe)?ee:pe),Pe(M[ee])}else for(let te=0;te<ie;te++)Pe(ee=re[te]),Pe(M[ee])}:M=>{j[B++]=222;let re=B-t;B+=2;let ie=0;for(let ee in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(ee))&&(Pe(ee),Pe(M[ee]),ie++);if(ie>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');j[re+++t]=ie>>8,j[re+t]=ie&255},Je=this.useRecords===!1?We:e.progressiveRecords&&!I?M=>{let re,ie=a.transitions||(a.transitions=Object.create(null)),ee=B++-t,te;for(let pe in M)if(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(pe)){if(re=ie[pe],re)ie=re;else{let xe=Object.keys(M),we=ie;ie=a.transitions;let Ge=0;for(let Ve=0,lt=xe.length;Ve<lt;Ve++){let Tt=xe[Ve];re=ie[Tt],re||(re=ie[Tt]=Object.create(null),Ge++),ie=re}ee+t+1==B?(B--,ot(ie,xe,Ge)):rt(ie,xe,ee,Ge),te=!0,ie=we[pe]}Pe(M[pe])}if(!te){let pe=ie[yi];pe?j[ee+t]=pe:rt(ie,Object.keys(M),ee,0)}}:M=>{let re,ie=a.transitions||(a.transitions=Object.create(null)),ee=0;for(let pe in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(pe))&&(re=ie[pe],re||(re=ie[pe]=Object.create(null),ee++),ie=re);let te=ie[yi];te?te>=96&&I?(j[B++]=((te-=96)&31)+96,j[B++]=te>>5):j[B++]=te:ot(ie,ie.__keys__||Object.keys(M),ee);for(let pe in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(pe))&&Pe(M[pe])},it=typeof this.useRecords=="function"&&this.useRecords,mt=it?M=>{it(M)?Je(M):We(M)}:Je,at=M=>{let re;if(M>16777216){if(M-t>No)throw new Error("Packed buffer would be larger than maximum buffer size");re=Math.min(No,Math.round(Math.max((M-t)*(M>67108864?1.25:2),4194304)/4096)*4096)}else re=(Math.max(M-t<<2,j.length-1)>>12)+1<<12;let ie=new _r(re);return dt=ie.dataView||(ie.dataView=new DataView(ie.buffer,0,re)),M=Math.min(M,j.length),j.copy?j.copy(ie,0,t,M):ie.set(j.slice(t,M)),B-=t,t=0,ln=ie.length-10,j=ie},ot=(M,re,ie)=>{let ee=a.nextId;ee||(ee=64),ee<F&&this.shouldShareStructure&&!this.shouldShareStructure(re)?(ee=a.nextOwnId,ee<J||(ee=F),a.nextOwnId=ee+1):(ee>=J&&(ee=F),a.nextId=ee+1);let te=re.highByte=ee>=96&&I?ee-96>>5:-1;M[yi]=ee,M.__keys__=re,a[ee-64]=re,ee<F?(re.isShared=!0,a.sharedLength=ee-63,i=!0,te>=0?(j[B++]=(ee&31)+96,j[B++]=te):j[B++]=ee):(te>=0?(j[B++]=213,j[B++]=114,j[B++]=(ee&31)+96,j[B++]=te):(j[B++]=212,j[B++]=114,j[B++]=ee),ie&&(W+=he*ie),z.length>=p&&(z.shift()[yi]=0),z.push(M),Pe(re))},rt=(M,re,ie,ee)=>{let te=j,pe=B,xe=ln,we=t;j=Fi,B=0,t=0,j||(Fi=j=new _r(8192)),ln=j.length-10,ot(M,re,ee),Fi=j;let Ge=B;if(j=te,B=pe,ln=xe,t=we,Ge>1){let Ve=B+Ge-1;Ve>ln&&at(Ve);let lt=ie+t;j.copyWithin(lt+Ge,lt+1,B),j.set(Fi.slice(0,Ge),lt),B=Ve}else j[ie+t]=Fi[0]},Fe=M=>{let re=dh(M,j,t,B,a,at,(ie,ee,te)=>{if(te)return i=!0;B=ee;let pe=j;return Pe(ie),ne(),pe!==j?{position:B,targetView:dt,target:j}:B},this);if(re===0)return mt(M);B=re}}useBuffer(e){j=e,j.dataView||(j.dataView=new DataView(j.buffer,j.byteOffset,j.byteLength)),B=0}set position(e){B=e}get position(){return B}set buffer(e){j=e}get buffer(){return j}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}to=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,oc];Ur=[{pack(s,e,t){let i=s.getTime()/1e3;if((this.useTimestamp32||s.getMilliseconds()===0)&&i>=0&&i<4294967296){let{target:a,targetView:l,position:u}=e(6);a[u++]=214,a[u++]=255,l.setUint32(u,i)}else if(i>0&&i<4294967296){let{target:a,targetView:l,position:u}=e(10);a[u++]=215,a[u++]=255,l.setUint32(u,s.getMilliseconds()*4e6+(i/1e3/4294967296>>0)),l.setUint32(u+4,i)}else if(isNaN(i)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:a,targetView:l,position:u}=e(3);a[u++]=212,a[u++]=255,a[u++]=255}else{let{target:a,targetView:l,position:u}=e(15);a[u++]=199,a[u++]=12,a[u++]=255,l.setUint32(u,s.getMilliseconds()*1e6),l.setBigInt64(u+4,BigInt(Math.floor(i)))}}},{pack(s,e,t){if(this.setAsEmptyObject)return e(0),t({});let i=Array.from(s),{target:a,position:l}=e(this.moreTypes?3:0);this.moreTypes&&(a[l++]=212,a[l++]=115,a[l++]=0),t(i)}},{pack(s,e,t){let{target:i,position:a}=e(this.moreTypes?3:0);this.moreTypes&&(i[a++]=212,i[a++]=101,i[a++]=0),t([s.name,s.message,s.cause])}},{pack(s,e,t){let{target:i,position:a}=e(this.moreTypes?3:0);this.moreTypes&&(i[a++]=212,i[a++]=120,i[a++]=0),t([s.source,s.flags])}},{pack(s,e){this.moreTypes?Po(s,16,e):Co(qr?Buffer.from(s):new Uint8Array(s),e)}},{pack(s,e){let t=s.constructor;t!==bc&&this.moreTypes?Po(s,pc.indexOf(t.name),e):Co(s,e)}},{pack(s,e){let{target:t,position:i}=e(1);t[i]=193}}];function Po(s,e,t,i){let a=s.byteLength;if(a+1<256){var{target:l,position:u}=t(4+a);l[u++]=199,l[u++]=a+1}else if(a+1<65536){var{target:l,position:u}=t(5+a);l[u++]=200,l[u++]=a+1>>8,l[u++]=a+1&255}else{var{target:l,position:u,targetView:d}=t(7+a);l[u++]=201,d.setUint32(u,a+1),u+=4}l[u++]=116,l[u++]=e,s.buffer||(s=new Uint8Array(s)),l.set(new Uint8Array(s.buffer,s.byteOffset,s.byteLength),u)}function Co(s,e){let t=s.byteLength;var i,a;if(t<256){var{target:i,position:a}=e(t+2);i[a++]=196,i[a++]=t}else if(t<65536){var{target:i,position:a}=e(t+3);i[a++]=197,i[a++]=t>>8,i[a++]=t&255}else{var{target:i,position:a,targetView:l}=e(t+5);i[a++]=198,l.setUint32(a,t),a+=4}i.set(s,a)}function gh(s,e,t,i){let a=s.length;switch(a){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:a<256?(e[t++]=199,e[t++]=a):a<65536?(e[t++]=200,e[t++]=a>>8,e[t++]=a&255):(e[t++]=201,e[t++]=a>>24,e[t++]=a>>16&255,e[t++]=a>>8&255,e[t++]=a&255)}return e[t++]=i,e.set(s,t),t+=a,t}function mh(s,e){let t,i=e.length*6,a=s.length-i;for(;t=e.pop();){let l=t.offset,u=t.id;s.copyWithin(l+i,l,a),i-=6;let d=l+i;s[d++]=214,s[d++]=105,s[d++]=u>>24,s[d++]=u>>16&255,s[d++]=u>>8&255,s[d++]=u&255,a=l}return s}function Lo(s,e,t){if(vt.length>0){dt.setUint32(vt.position+s,B+t-vt.position-s),vt.stringsPosition=B-s;let i=vt;vt=null,e(i[0]),e(i[1])}}function yh(s){if(s.Class){if(!s.pack&&!s.write)throw new Error("Extension has no pack or write function");if(s.pack&&!s.type)throw new Error("Extension has no type (numeric code to identify the extension)");to.unshift(s.Class),Ur.unshift(s)}ah(s)}function bh(s,e){return s.isCompatible=t=>{let i=!t||(e.lastNamedStructuresLength||0)===t.length;return i||e._mergeStructures(t),i},s}let Ec=new fr({useRecords:!1});const Eh=Ec.pack,vh=Ec.pack,_h=fr,{NEVER:wh,ALWAYS:Th,DECIMAL_ROUND:Ih,DECIMAL_FIT:Sh}=mc,vc=512,_c=1024,wc=2048;function Ah(s,e={}){if(!s||typeof s!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof s[Symbol.iterator]=="function")return Oh(s,e);if(typeof s.then=="function"||typeof s[Symbol.asyncIterator]=="function")return xh(s,e);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Oh(s,e){const t=new fr(e);for(const i of s)yield t.pack(i)}async function*xh(s,e){const t=new fr(e);for await(const i of s)yield t.pack(i)}function Dh(s,e={}){if(!s||typeof s!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const t=new Vs(e);let i;const a=l=>{let u;i&&(l=Buffer.concat([i,l]),i=void 0);try{u=t.unpackMultiple(l)}catch(d){if(d.incomplete)i=l.slice(d.lastPosition),u=d.values;else throw d}return u};if(typeof s[Symbol.iterator]=="function")return function*(){for(const u of s)yield*a(u)}();if(typeof s[Symbol.asyncIterator]=="function")return async function*(){for await(const u of s)yield*a(u)}()}const Rh=Dh,Nh=Ah,Ph=!1,Ch=!0,Lh=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:Th,C1:Ja,DECIMAL_FIT:Sh,DECIMAL_ROUND:Ih,Decoder:oh,Encoder:_h,FLOAT32_OPTIONS:mc,NEVER:wh,Packr:fr,RESERVE_START_SPACE:wc,RESET_BUFFER_MODE:_c,REUSE_BUFFER_MODE:vc,Unpackr:Vs,addExtension:yh,clearSource:Mr,decode:fh,decodeIter:Rh,encode:vh,encodeIter:Nh,isNativeAccelerationEnabled:nh,mapsAsObjects:Ch,pack:Eh,roundFloat32:uh,unpack:lh,unpackMultiple:ch,useRecords:Ph},Symbol.toStringTag,{value:"Module"})),kh=Pa(Lh);var Bh=nc,Dn=qa,ko=Zr,$h=Ya,wr=Xa,Kt=Ka,Mh=zr,Bo=lr,$o=kh;let Uh=class Tc{constructor(e,t){this.onStateChange=wr.createSignal(),this.onError=wr.createSignal(),this.onLeave=wr.createSignal(),this.onJoin=wr.createSignal(),this.hasJoined=!1,this.onMessageHandlers=$h.createNanoEvents(),this.roomId=null,this.name=e,this.packr=new $o.Packr,this.packr.encode(void 0),t&&(this.serializer=new(ko.getSerializer("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError((i,a)=>{var l;return(l=console.warn)===null||l===void 0?void 0:l.call(console,`colyseus.js - onError => (${i}) ${a}`)}),this.onLeave(()=>this.removeAllListeners())}connect(e,t,i=this,a,l){const u=new Bh.Connection(a.protocol);if(i.connection=u,u.events.onmessage=Tc.prototype.onMessageCallback.bind(i),u.events.onclose=function(d){var E;if(!i.hasJoined){(E=console.warn)===null||E===void 0||E.call(console,`Room connection was closed unexpectedly (${d.code}): ${d.reason}`),i.onError.invoke(d.code,d.reason);return}d.code===Bo.CloseCode.DEVMODE_RESTART&&t?t():(i.onLeave.invoke(d.code,d.reason),i.destroy())},u.events.onerror=function(d){var E;(E=console.warn)===null||E===void 0||E.call(console,`Room, onError (${d.code}): ${d.reason}`),i.onError.invoke(d.code,d.reason)},a.protocol==="h3"){const d=new URL(e);u.connect(d.origin,a)}else u.connect(e,l)}leave(e=!0){return new Promise(t=>{this.onLeave(i=>t(i)),this.connection?e?(this.packr.buffer[0]=Dn.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(Bo.CloseCode.CONSENTED)})}onMessage(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)}send(e,t){const i={offset:1};this.packr.buffer[0]=Dn.Protocol.ROOM_DATA,typeof e=="string"?Kt.encode.string(this.packr.buffer,e,i):Kt.encode.number(this.packr.buffer,e,i),this.packr.position=0;const a=t!==void 0?this.packr.pack(t,2048+i.offset):this.packr.buffer.subarray(0,i.offset);this.connection.send(a)}sendUnreliable(e,t){const i={offset:1};this.packr.buffer[0]=Dn.Protocol.ROOM_DATA,typeof e=="string"?Kt.encode.string(this.packr.buffer,e,i):Kt.encode.number(this.packr.buffer,e,i),this.packr.position=0;const a=t!==void 0?this.packr.pack(t,2048+i.offset):this.packr.buffer.subarray(0,i.offset);this.connection.sendUnreliable(a)}sendBytes(e,t){const i={offset:1};if(this.packr.buffer[0]=Dn.Protocol.ROOM_DATA_BYTES,typeof e=="string"?Kt.encode.string(this.packr.buffer,e,i):Kt.encode.number(this.packr.buffer,e,i),t.byteLength+i.offset>this.packr.buffer.byteLength){const a=new Uint8Array(i.offset+t.byteLength);a.set(this.packr.buffer),this.packr.useBuffer(a)}this.packr.buffer.set(t,i.offset),this.connection.send(this.packr.buffer.subarray(0,i.offset+t.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof Mh.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(e){const t=new Uint8Array(e.data),i={offset:1},a=t[0];if(a===Dn.Protocol.JOIN_ROOM){const l=Kt.decode.utf8Read(t,i,t[i.offset++]);if(this.serializerId=Kt.decode.utf8Read(t,i,t[i.offset++]),!this.serializer){const u=ko.getSerializer(this.serializerId);this.serializer=new u}t.byteLength>i.offset&&this.serializer.handshake&&this.serializer.handshake(t,i),this.reconnectionToken=`${this.roomId}:${l}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=Dn.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(a===Dn.Protocol.ERROR){const l=Kt.decode.number(t,i),u=Kt.decode.string(t,i);this.onError.invoke(l,u)}else if(a===Dn.Protocol.LEAVE_ROOM)this.leave();else if(a===Dn.Protocol.ROOM_STATE)this.serializer.setState(t,i),this.onStateChange.invoke(this.serializer.getState());else if(a===Dn.Protocol.ROOM_STATE_PATCH)this.serializer.patch(t,i),this.onStateChange.invoke(this.serializer.getState());else if(a===Dn.Protocol.ROOM_DATA){const l=Kt.decode.stringCheck(t,i)?Kt.decode.string(t,i):Kt.decode.number(t,i),u=t.byteLength>i.offset?$o.unpack(t,{start:i.offset}):void 0;this.dispatchMessage(l,u)}else if(a===Dn.Protocol.ROOM_DATA_BYTES){const l=Kt.decode.stringCheck(t,i)?Kt.decode.string(t,i):Kt.decode.number(t,i);this.dispatchMessage(l,t.subarray(i.offset))}}dispatchMessage(e,t){var i;const a=this.getMessageHandlerKey(e);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):(i=console.warn)===null||i===void 0||i.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}};Wa.Room=Uh;var Ic={};function Mo(s,e){e.headers=s.headers||{},e.statusMessage=s.statusText,e.statusCode=s.status,e.data=s.response}function Gn(s,e,t){return new Promise(function(i,a){t=t||{};var l=new XMLHttpRequest,u,d,E,g=t.body,y=t.headers||{};t.timeout&&(l.timeout=t.timeout),l.ontimeout=l.onerror=function(p){p.timeout=p.type=="timeout",a(p)},l.open(s,e.href||e),l.onload=function(){for(E=l.getAllResponseHeaders().trim().split(/[\r\n]+/),Mo(l,l);d=E.shift();)d=d.split(": "),l.headers[d.shift().toLowerCase()]=d.join(": ");if(d=l.headers["content-type"],d&&~d.indexOf("application/json"))try{l.data=JSON.parse(l.data,t.reviver)}catch(p){return Mo(l,p),a(p)}(l.status>=400?a:i)(l)},typeof FormData<"u"&&g instanceof FormData||g&&typeof g=="object"&&(y["content-type"]="application/json",g=JSON.stringify(g)),l.withCredentials=!!t.withCredentials;for(u in y)l.setRequestHeader(u,y[u]);l.send(g)})}var Fh=Gn.bind(Gn,"GET"),Vh=Gn.bind(Gn,"POST"),jh=Gn.bind(Gn,"PATCH"),Hh=Gn.bind(Gn,"DELETE"),Gh=Gn.bind(Gn,"PUT");const Zh=Object.freeze(Object.defineProperty({__proto__:null,del:Hh,get:Fh,patch:jh,post:Vh,put:Gh,send:Gn},Symbol.toStringTag,{value:"Module"})),zh=Pa(Zh);var Wh=lr,Kh=zh;function qh(s){var e=Object.create(null);return s&&Object.keys(s).forEach(function(t){if(t!=="default"){var i=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return s[t]}})}}),e.default=s,Object.freeze(e)}var Yh=qh(Kh);let Xh=class{constructor(e,t={}){this.client=e,this.headers=t}get(e,t={}){return this.request("get",e,t)}post(e,t={}){return this.request("post",e,t)}del(e,t={}){return this.request("del",e,t)}put(e,t={}){return this.request("put",e,t)}request(e,t,i={}){return Yh[e](this.client.getHttpEndpoint(t),this.getOptions(i)).catch(a=>{var l;const u=a.statusCode,d=((l=a.data)===null||l===void 0?void 0:l.error)||a.statusMessage||a.message;throw!u&&!d?a:new Wh.ServerError(u,d)})}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}};Ic.HTTP=Xh;var no={},Yr={},Uo=Gr;let li;function so(){if(!li)try{li=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!li&&typeof globalThis.indexedDB<"u"&&(li=new tp),li||(li={cache:{},setItem:function(s,e){this.cache[s]=e},getItem:function(s){this.cache[s]},removeItem:function(s){delete this.cache[s]}}),li}function Jh(s,e){so().setItem(s,e)}function Qh(s){so().removeItem(s)}function ep(s,e){const t=so().getItem(s);typeof Promise>"u"||!(t instanceof Promise)?e(t):t.then(i=>e(i))}class tp{constructor(){this.dbPromise=new Promise(e=>{const t=indexedDB.open("_colyseus_storage",1);t.onupgradeneeded=()=>t.result.createObjectStore("store"),t.onsuccess=()=>e(t.result)})}tx(e,t){return Uo.__awaiter(this,void 0,void 0,function*(){const a=(yield this.dbPromise).transaction("store",e).objectStore("store");return t(a)})}setItem(e,t){return this.tx("readwrite",i=>i.put(t,e)).then()}getItem(e){return Uo.__awaiter(this,void 0,void 0,function*(){const t=yield this.tx("readonly",i=>i.get(e));return new Promise(i=>{t.onsuccess=()=>i(t.result)})})}removeItem(e){return this.tx("readwrite",t=>t.delete(e)).then()}}Yr.getItem=ep;Yr.removeItem=Qh;Yr.setItem=Jh;var Mt=Gr,la=Yr,np=Ya,Sr,Da,xs,Ar;let sp=class{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},Sr.set(this,!1),Da.set(this,void 0),xs.set(this,void 0),Ar.set(this,np.createNanoEvents()),la.getItem(this.settings.key,t=>this.token=t)}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){const t=Mt.__classPrivateFieldGet(this,Ar,"f").on("change",e);return Mt.__classPrivateFieldGet(this,Sr,"f")||Mt.__classPrivateFieldSet(this,Da,new Promise((i,a)=>{this.getUserData().then(l=>{this.emitChange(Object.assign(Object.assign({},l),{token:this.token}))}).catch(l=>{this.emitChange({user:null,token:void 0})}).finally(()=>{i()})}),"f"),Mt.__classPrivateFieldSet(this,Sr,!0,"f"),t}getUserData(){return Mt.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(e,t,i){return Mt.__awaiter(this,void 0,void 0,function*(){const a=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:t,options:i}})).data;return this.emitChange(a),a})}signInWithEmailAndPassword(e,t){return Mt.__awaiter(this,void 0,void 0,function*(){const i=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:t}})).data;return this.emitChange(i),i})}signInAnonymously(e){return Mt.__awaiter(this,void 0,void 0,function*(){const t=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(t),t})}sendPasswordResetEmail(e){return Mt.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data})}signInWithProvider(e){return Mt.__awaiter(this,arguments,void 0,function*(t,i={}){return new Promise((a,l)=>{const u=i.width||480,d=i.height||768,E=this.token?`?token=${this.token}`:"",g=`Login with ${t[0].toUpperCase()+t.substring(1)}`,y=this.http.client.getHttpEndpoint(`${i.prefix||`${this.settings.path}/provider`}/${t}${E}`),p=screen.width/2-u/2,I=screen.height/2-d/2;Mt.__classPrivateFieldSet(this,xs,window.open(y,g,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+u+", height="+d+", top="+I+", left="+p),"f");const F=z=>{z.data.user===void 0&&z.data.token===void 0||(clearInterval(J),Mt.__classPrivateFieldGet(this,xs,"f").close(),Mt.__classPrivateFieldSet(this,xs,void 0,"f"),window.removeEventListener("message",F),z.data.error!==void 0?l(z.data.error):(a(z.data),this.emitChange(z.data)))},J=setInterval(()=>{(!Mt.__classPrivateFieldGet(this,xs,"f")||Mt.__classPrivateFieldGet(this,xs,"f").closed)&&(Mt.__classPrivateFieldSet(this,xs,void 0,"f"),l("cancelled"),window.removeEventListener("message",F))},200);window.addEventListener("message",F)})})}signOut(){return Mt.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(e){e.token!==void 0&&(this.token=e.token,e.token===null?la.removeItem(this.settings.key):la.setItem(this.settings.key,e.token)),Mt.__classPrivateFieldGet(this,Ar,"f").emit("change",e)}};Sr=new WeakMap,Da=new WeakMap,xs=new WeakMap,Ar=new WeakMap;no.Auth=sp;var Sc={};function ip(s){var e;const t=((e=window==null?void 0:window.location)===null||e===void 0?void 0:e.hostname)||"localhost",i=s.hostname.split("."),a=!s.hostname.includes("trycloudflare.com")&&!s.hostname.includes("discordsays.com")&&i.length>2?`/${i[0]}`:"";return s.pathname.startsWith("/.proxy")?`${s.protocol}//${t}${a}${s.pathname}${s.search}`:`${s.protocol}//${t}/.proxy/colyseus${a}${s.pathname}${s.search}`}Sc.discordURLBuilder=ip;var ys=Gr,rp=lr,ap=Wa,op=Ic,lp=no,cp=Sc,ca;class Xr extends Error{constructor(e,t){super(e),this.code=t,this.name="MatchMakeError",Object.setPrototypeOf(this,Xr.prototype)}}const Fo=typeof window<"u"&&typeof((ca=window==null?void 0:window.location)===null||ca===void 0?void 0:ca.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class Ac{constructor(e=Fo,t){var i,a;if(typeof e=="string"){const l=e.startsWith("/")?new URL(e,Fo):new URL(e),u=l.protocol==="https:"||l.protocol==="wss:",d=Number(l.port||(u?443:80));this.settings={hostname:l.hostname,pathname:l.pathname,port:d,secure:u}}else e.port===void 0&&(e.port=e.secure?443:80),e.pathname===void 0&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new op.HTTP(this,(t==null?void 0:t.headers)||{}),this.auth=new lp.Auth(this.http),this.urlBuilder=t==null?void 0:t.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((a=(i=window==null?void 0:window.location)===null||i===void 0?void 0:i.hostname)===null||a===void 0)&&a.includes("discordsays.com"))&&(this.urlBuilder=cp.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e){return ys.__awaiter(this,arguments,void 0,function*(t,i={},a){return yield this.createMatchMakeRequest("joinOrCreate",t,i,a)})}create(e){return ys.__awaiter(this,arguments,void 0,function*(t,i={},a){return yield this.createMatchMakeRequest("create",t,i,a)})}join(e){return ys.__awaiter(this,arguments,void 0,function*(t,i={},a){return yield this.createMatchMakeRequest("join",t,i,a)})}joinById(e){return ys.__awaiter(this,arguments,void 0,function*(t,i={},a){return yield this.createMatchMakeRequest("joinById",t,i,a)})}reconnect(e,t){return ys.__awaiter(this,void 0,void 0,function*(){if(typeof e=="string"&&typeof t=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[i,a]=e.split(":");if(!i||!a)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",i,{reconnectionToken:a},t)})}consumeSeatReservation(e,t,i){return ys.__awaiter(this,void 0,void 0,function*(){const a=this.createRoom(e.room.name,t);a.roomId=e.room.roomId,a.sessionId=e.sessionId;const l={sessionId:a.sessionId};e.reconnectionToken&&(l.reconnectionToken=e.reconnectionToken);const u=i||a;return a.connect(this.buildEndpoint(e.room,l,e.protocol),e.devMode&&(()=>ys.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${a.roomId}'...`);let d=0,E=8;const g=()=>ys.__awaiter(this,void 0,void 0,function*(){d++;try{yield this.consumeSeatReservation(e,t,u),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${a.roomId}'`)}catch{d<E?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${d} out of ${E})`),setTimeout(g,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(g,2e3)})),u,e,this.http.headers),new Promise((d,E)=>{const g=(y,p)=>E(new rp.ServerError(y,p));u.onError.once(g),u.onJoin.once(()=>{u.onError.remove(g),d(u)})})})}createMatchMakeRequest(e,t){return ys.__awaiter(this,arguments,void 0,function*(i,a,l={},u,d){const E=(yield this.http.post(`matchmake/${i}/${a}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)})).data;if(E.error)throw new Xr(E.error,E.code);return i==="reconnect"&&(E.reconnectionToken=l.reconnectionToken),yield this.consumeSeatReservation(E,u,d)})}createRoom(e,t){return new ap.Room(e,t)}buildEndpoint(e,t={},i="ws"){const a=[];this.http.authToken&&(t._authToken=this.http.authToken);for(const d in t)t.hasOwnProperty(d)&&a.push(`${d}=${t[d]}`);i==="h3"&&(i="http");let l=this.settings.secure?`${i}s://`:`${i}://`;e.publicAddress?l+=`${e.publicAddress}`:l+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const u=`${l}/${e.processId}/${e.roomId}?${a.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(u)):u}getHttpEndpoint(e=""){const t=e.startsWith("/")?e:`/${e}`,i=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${t}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}Ac.VERSION="0.16.16";Za.Client=Ac;Za.MatchMakeError=Xr;var Oc={};class fp{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}}Oc.NoneSerializer=fp;(function(s){var e=Za,t=qa,i=Wa,a=no,l=lr,u=zr,d=Oc,E=Zr;E.registerSerializer("schema",u.SchemaSerializer),E.registerSerializer("none",d.NoneSerializer),s.Client=e.Client,s.MatchMakeError=e.MatchMakeError,Object.defineProperty(s,"ErrorCode",{enumerable:!0,get:function(){return t.ErrorCode}}),Object.defineProperty(s,"Protocol",{enumerable:!0,get:function(){return t.Protocol}}),s.Room=i.Room,s.Auth=a.Auth,s.ServerError=l.ServerError,s.SchemaSerializer=u.SchemaSerializer,s.getStateCallbacks=u.getStateCallbacks,s.registerSerializer=E.registerSerializer})(jn);let S=null,Vo=null,Cs=new Map;async function io(){return S?new Promise(s=>{const e=setTimeout(()=>{console.error("loadAllCardData: Timeout while waiting for card data"),s(!1)},5e3);S.send("getAllCards"),S.onMessage("allCards",t=>{clearTimeout(e),console.log(`Received ${t.length} cards from server`),Cs.clear(),t.forEach(i=>{Cs.set(i.id,i)}),s(!0)})}):!1}async function xc(s,e){const t=location.host.includes("localhost")?"ws://localhost:4001":`wss://${location.host}/.proxy/api`;Vo=new jn.Client(t);try{console.log("Attempting to join or create Colyseus room..."),S=await Vo.joinOrCreate("game",{accessToken:s,username:e}),console.log("Successfully joined room:",S.roomId),console.log("Session ID:",S.sessionId),console.log("Initial room state:",S.state.toJSON()),console.log("Loading all card data..."),await io(),console.log("Card data loaded, cache size:",Cs.size),S.onStateChange(i=>{}),S.onError((i,a)=>{console.error("Colyseus room error:",i,a),S=null}),S.onLeave(i=>{console.log("Left Colyseus room, code:",i),S=null})}catch(i){throw console.error("Failed to connect to Colyseus:",i),i instanceof ProgressEvent?(console.error("Connection failed: Network error (ProgressEvent). Potential causes:"),console.error("- Colyseus server might not be running or accessible at the target URL:",t),console.error("- WebSocket connection blocked by firewall or proxy."),console.error("- Incorrect WebSocket proxy configuration on the deployment server (if applicable)."),alert("Failed to connect to game server: Network Error. Please ensure the server is running and accessible.")):i instanceof Error?(console.error("Connection failed due to error:",i.message),alert(`Failed to connect to game server: ${i.message}`)):(console.error("Connection failed due to unknown error:",i),alert("Failed to connect to game server: An unknown error occurred.")),S=null,i}}let cn;const Dc=new URLSearchParams(window.location.search),ro=Dc.get("frame_id")!=null;let Ls;const fa=Jr("user_id"),up=Jr("guild_id"),dp=Jr("channel_id"),hp=async()=>{if(ro){const s="1363939642289946886";console.log("Discord SDK: Using embedded client ID:",s),Ls=new Id(s),await Ls.ready()}else{Ls=new Cl("1363939642289946886",up,dp);const s=String(fa.charCodeAt(0)%5),e={access_token:"mock_token",user:{username:fa,discriminator:s,id:fa,avatar:null,public_flags:1},scopes:[],expires:new Date(2112,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}};Ls._updateCommandMocks({authenticate:async()=>(cn=e,console.log("Mock Authentication successful:",cn),await xc(cn.access_token,cn.user.username),e),authorize:async()=>(console.log("Mock Authorize called"),{code:"mock_code"})})}},pp=async()=>{if(!ro){console.log("Running locally, attempting mock authentication...");try{return await Ls.commands.authenticate(),!0}catch(e){return console.error("Mock authentication failed:",e),!1}}let s="authorize";try{console.log("Requesting Discord authorization...");const{code:e}=await Ls.commands.authorize({client_id:"1363939642289946886",response_type:"code",state:"",prompt:"none",scope:["identify","guilds"]});console.log("Authorization code received:",e),s="fetchToken",console.log("Fetching access token from /.proxy/api/token...");const t=await fetch("/.proxy/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(console.log("Token fetch response received. Status:",t.status),!t.ok){const a=await t.text();throw console.error("Token fetch failed:",t.status,t.statusText,a),new Error(`Token fetch failed: ${t.status} ${t.statusText} - ${a}`)}const{access_token:i}=await t.json();if(console.log("Access token received successfully."),s="discordAuthenticate",console.log("Authenticating with Discord SDK..."),cn=await Ls.commands.authenticate({access_token:i}),!(cn!=null&&cn.user))throw console.error("Discord SDK Authentication failed: No user data received.",cn),new Error("Discord SDK Authentication failed to return user data.");console.log("Discord SDK Authentication successful:",cn.user.username),s="connectColyseus",console.log("Connecting to Colyseus...");try{await xc(cn.access_token,cn.user.username),console.log("Colyseus connection successful.")}catch(a){throw console.error("Colyseus connection failed:",a),a}return!0}catch(e){return console.error(`Error during step: ${s}`),console.error("Discord authorization or Colyseus connection failed:",e),e instanceof ProgressEvent?console.error("Network error (ProgressEvent) occurred, likely during fetch."):e.message&&e.message.includes("Token fetch failed")?console.error("Error specifically during token fetch step."):s==="connectColyseus"&&console.error("Error specifically during Colyseus connection step."),cn=null,!1}},gp=()=>cn?cn.user.username:!ro&&Ls instanceof Cl?Jr("user_id")||"MockUser":"User";function Jr(s){const e=Dc.get(s);if(e!=null)return e;const t=sessionStorage.getItem(s);if(t!=null)return t;const i=Math.random().toString(36).slice(2,10);return sessionStorage.setItem(s,i),i}class mp extends cs.Scene{constructor(){super("Boot")}preload(){this.load.setPath("/assets"),this.load.image("background","bg.png"),this.load.image("fridge_bg","fridge_bg.png")}create(){this.scene.start("Preloader")}}class yp extends cs.Scene{constructor(){super("Game")}async create(){this.scene.launch("background"),this.add.image(this.cameras.main.width*.5,this.cameras.main.height*.4,"grid").setScale(.6),await this.connect(),this.room.state.draggables.onAdd((t,i)=>{const a=this.add.image(t.x,t.y,i).setInteractive();a.name=i,a.setScale(.8),this.input.setDraggable(a),a.on("drag",(l,u,d)=>{this.room&&(a.x=Phaser.Math.Clamp(u,a.displayWidth/2,Number(this.game.config.width)-a.displayWidth/2),a.y=Phaser.Math.Clamp(d,a.displayHeight/2,Number(this.game.config.height)-a.displayHeight/2),this.room.send("move",{imageId:i,x:a.x,y:a.y}))})}),this.add.text(this.cameras.main.width*.5,this.cameras.main.height*.95,`Connected as: ${gp()}`,{font:"14px Arial",color:"#000000"}).setOrigin(.5)}async connect(){const e=location.host==="localhost:3000"?"ws://localhost:3001":`wss://${location.host}/.proxy/api/colyseus`,t=new jn.Client(`${e}`);try{this.room=await t.joinOrCreate("some_other_room",{screenWidth:this.game.config.width,screenHeight:this.game.config.height}),this.room.onMessage("move",i=>{}),console.log("Successfully connected!")}catch(i){console.log(`Could not connect with the server: ${i}`)}}}class bp extends cs.Scene{constructor(){super("MainMenu")}create(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let t=this.cameras.main.width/e.width+.2,i=this.cameras.main.height/e.height+.2,a=Math.max(t,i);e.setScale(a).setScrollFactor(0),this.add.text(Number(this.game.config.width)*.5,300,"Legends of the Friend",{fontFamily:"Arial Black",fontSize:58,color:"#ffff00",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(Number(this.game.config.width)*.5,460,"Click to Start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,520,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.input.once("pointerdown",async()=>{this.statusText.setText("Authorizing with Discord..."),await pp()?(this.statusText.setText("Connecting to server..."),await new Promise(u=>setTimeout(u,1e3)),S?(this.statusText.setText("Loading game data..."),await io()?(this.statusText.setText("Connected! Entering Lobby..."),this.scene.start("Lobby")):this.statusText.setText("Failed to load game data. Please try again.")):this.statusText.setText("Failed to connect to server. Please try again.")):this.statusText.setText("Discord authorization failed. Please try again.")})}}class Ep extends cs.Scene{constructor(){super("Preloader")}init(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let t=this.cameras.main.width/e.width+.2,i=this.cameras.main.height/e.height+.2,a=Math.max(t,i);e.setScale(a).setScrollFactor(0),this.add.rectangle(Number(this.game.config.width)*.5,Number(this.game.config.height)*.5,468,32).setStrokeStyle(1,16777215);const l=this.add.rectangle(Number(this.game.config.width)*.5-230,Number(this.game.config.height)*.5,4,28,16777215);this.load.on("progress",u=>{l.width=4+460*u})}preload(){this.load.setPath("/assets"),this.load.image("logo","logo.png"),this.load.image("cardFullTier1","CardFullTier1.png"),this.load.image("cardMinionTier1","CardMinionTier1.png")}create(){this.scene.start("MainMenu")}}class vp extends cs.Scene{constructor(){super("background")}create(){this.cameras.main.setBackgroundColor(11393254),this.scene.sendToBack()}}var Ra={exports:{}};(function(s,e){(function(t,i){i(e)})(Na,function(t){t.OPERATION=void 0,function(f){f[f.ADD=128]="ADD",f[f.REPLACE=0]="REPLACE",f[f.DELETE=64]="DELETE",f[f.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",f[f.MOVE_AND_ADD=160]="MOVE_AND_ADD",f[f.DELETE_AND_ADD=192]="DELETE_AND_ADD",f[f.CLEAR=10]="CLEAR",f[f.REVERSE=15]="REVERSE",f[f.MOVE=32]="MOVE",f[f.DELETE_BY_REFID=33]="DELETE_BY_REFID",f[f.ADD_BY_REFID=129]="ADD_BY_REFID"}(t.OPERATION||(t.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const l=Symbol("$track"),u=Symbol("$encoder"),d=Symbol("$decoder"),E=Symbol("$filter"),g=Symbol("$getByIndex"),y=Symbol("$deleteByIndex"),p=Symbol("$changes"),I=Symbol("$childType"),F=Symbol("$onEncodeEnd"),J=Symbol("$onDecodeEnd"),z=Symbol("$descriptors"),W="$__numFields",he="$__refTypeFieldIndexes",ne="$__viewFieldIndexes",ue="$__fieldIndexesByViewTag";let Pe;try{Pe=new TextEncoder}catch{}const We=new ArrayBuffer(8),Je=new Int32Array(We),it=new Float32Array(We),mt=new Float64Array(We),at=new BigInt64Array(We),rt=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(f,n){for(var r=0,o=0,c=0,h=f.length;c<h;c++)r=f.charCodeAt(c),r<128?o+=1:r<2048?o+=2:r<55296||r>=57344?o+=3:(c++,o+=4);return o};function Fe(f,n,r){for(var o=0,c=0,h=n.length;c<h;c++)o=n.charCodeAt(c),o<128?f[r.offset++]=o:o<2048?(f[r.offset]=192|o>>6,f[r.offset+1]=128|o&63,r.offset+=2):o<55296||o>=57344?(f[r.offset]=224|o>>12,f[r.offset+1]=128|o>>6&63,f[r.offset+2]=128|o&63,r.offset+=3):(c++,o=65536+((o&1023)<<10|n.charCodeAt(c)&1023),f[r.offset]=240|o>>18,f[r.offset+1]=128|o>>12&63,f[r.offset+2]=128|o>>6&63,f[r.offset+3]=128|o&63,r.offset+=4)}function M(f,n,r){f[r.offset++]=n&255}function re(f,n,r){f[r.offset++]=n&255}function ie(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255}function ee(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255}function te(f,n,r){f[r.offset++]=n&255,f[r.offset++]=n>>8&255,f[r.offset++]=n>>16&255,f[r.offset++]=n>>24&255}function pe(f,n,r){const o=n>>24,c=n>>16,h=n>>8,m=n;f[r.offset++]=m&255,f[r.offset++]=h&255,f[r.offset++]=c&255,f[r.offset++]=o&255}function xe(f,n,r){const o=Math.floor(n/Math.pow(2,32)),c=n>>>0;pe(f,c,r),pe(f,o,r)}function we(f,n,r){const o=n/Math.pow(2,32)>>0,c=n>>>0;pe(f,c,r),pe(f,o,r)}function Ge(f,n,r){at[0]=BigInt.asIntN(64,n),te(f,Je[0],r),te(f,Je[1],r)}function Ve(f,n,r){at[0]=BigInt.asIntN(64,n),te(f,Je[0],r),te(f,Je[1],r)}function lt(f,n,r){it[0]=n,te(f,Je[0],r)}function Tt(f,n,r){mt[0]=n,te(f,Je[0],r),te(f,Je[1],r)}function Pt(f,n,r){f[r.offset++]=n?1:0}function Is(f,n,r){n||(n="");let o=rt(n,"utf8"),c=0;if(o<32)f[r.offset++]=o|160,c=1;else if(o<256)f[r.offset++]=217,f[r.offset++]=o%255,c=2;else if(o<65536)f[r.offset++]=218,ee(f,o,r),c=3;else if(o<4294967296)f[r.offset++]=219,pe(f,o,r),c=5;else throw new Error("String too long");return Fe(f,n,r),c+o}function gn(f,n,r){if(isNaN(n))return gn(f,0,r);if(isFinite(n)){if(n!==(n|0))return Math.abs(n)<=34028235e31&&(it[0]=n,Math.abs(Math.abs(it[0])-Math.abs(n))<1e-4)?(f[r.offset++]=202,lt(f,n,r),5):(f[r.offset++]=203,Tt(f,n,r),9)}else return gn(f,n>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,r);return n>=0?n<128?(f[r.offset++]=n&255,1):n<256?(f[r.offset++]=204,f[r.offset++]=n&255,2):n<65536?(f[r.offset++]=205,ee(f,n,r),3):n<4294967296?(f[r.offset++]=206,pe(f,n,r),5):(f[r.offset++]=207,we(f,n,r),9):n>=-32?(f[r.offset++]=224|n+32,1):n>=-128?(f[r.offset++]=208,M(f,n,r),2):n>=-32768?(f[r.offset++]=209,ie(f,n,r),3):n>=-2147483648?(f[r.offset++]=210,te(f,n,r),5):(f[r.offset++]=211,xe(f,n,r),9)}const Ee={int8:M,uint8:re,int16:ie,uint16:ee,int32:te,uint32:pe,int64:xe,uint64:we,bigint64:Ge,biguint64:Ve,float32:lt,float64:Tt,boolean:Pt,string:Is,number:gn,utf8Write:Fe,utf8Length:rt},Zt=new ArrayBuffer(8),It=new Int32Array(Zt),Jt=new Float32Array(Zt),us=new Float64Array(Zt),zn=new BigUint64Array(Zt),Ss=new BigInt64Array(Zt);function Wn(f,n,r){for(var o="",c=0,h=n.offset,m=n.offset+r;h<m;h++){var _=f[h];if(!(_&128)){o+=String.fromCharCode(_);continue}if((_&224)===192){o+=String.fromCharCode((_&31)<<6|f[++h]&63);continue}if((_&240)===224){o+=String.fromCharCode((_&15)<<12|(f[++h]&63)<<6|(f[++h]&63)<<0);continue}if((_&248)===240){c=(_&7)<<18|(f[++h]&63)<<12|(f[++h]&63)<<6|(f[++h]&63)<<0,c>=65536?(c-=65536,o+=String.fromCharCode((c>>>10)+55296,(c&1023)+56320)):o+=String.fromCharCode(c);continue}console.error("Invalid byte "+_.toString(16))}return n.offset+=r,o}function Kn(f,n){return zt(f,n)<<24>>24}function zt(f,n){return f[n.offset++]}function qn(f,n){return mn(f,n)<<16>>16}function mn(f,n){return f[n.offset++]|f[n.offset++]<<8}function tt(f,n){return f[n.offset++]|f[n.offset++]<<8|f[n.offset++]<<16|f[n.offset++]<<24}function $t(f,n){return tt(f,n)>>>0}function Yn(f,n){return It[0]=tt(f,n),Jt[0]}function ds(f,n){return It[0]=tt(f,n),It[1]=tt(f,n),us[0]}function Te(f,n){const r=$t(f,n);return tt(f,n)*Math.pow(2,32)+r}function Qt(f,n){const r=$t(f,n);return $t(f,n)*Math.pow(2,32)+r}function b(f,n){return It[0]=tt(f,n),It[1]=tt(f,n),Ss[0]}function T(f,n){return It[0]=tt(f,n),It[1]=tt(f,n),zn[0]}function x(f,n){return zt(f,n)>0}function C(f,n){const r=f[n.offset++];let o;return r<192?o=r&31:r===217?o=zt(f,n):r===218?o=mn(f,n):r===219&&(o=$t(f,n)),Wn(f,n,o)}function G(f,n){const r=f[n.offset++];if(r<128)return r;if(r===202)return Yn(f,n);if(r===203)return ds(f,n);if(r===204)return zt(f,n);if(r===205)return mn(f,n);if(r===206)return $t(f,n);if(r===207)return Qt(f,n);if(r===208)return Kn(f,n);if(r===209)return qn(f,n);if(r===210)return tt(f,n);if(r===211)return Te(f,n);if(r>223)return(255-r+1)*-1}function U(f,n){const r=f[n.offset];return r<192&&r>160||r===217||r===218||r===219}const H={utf8Read:Wn,int8:Kn,uint8:zt,int16:qn,uint16:mn,int32:tt,uint32:$t,float32:Yn,float64:ds,int64:Te,uint64:Qt,bigint64:b,biguint64:T,boolean:x,string:C,number:G,stringCheck:U},Y={},Q=new Map;function ce(f,n){n.constructor&&(Q.set(n.constructor,f),Y[f]=n),n.encode&&(Ee[f]=n.encode),n.decode&&(H[f]=n.decode)}function De(f){return Y[f]}function Re(f){for(const n in f)ce(n,f[n]);return n=>ht(n)}const Et=class Et{static register(n){const r=Object.getPrototypeOf(n);if(r!==Be){let o=Et.inheritedTypes.get(r);o||(o=new Set,Et.inheritedTypes.set(r,o)),o.add(n)}}static cache(n){let r=Et.cachedContexts.get(n);return r||(r=new Et(n),Et.cachedContexts.set(n,r)),r}constructor(n){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},n&&this.discoverTypes(n)}has(n){return this.schemas.has(n)}get(n){return this.types[n]}add(n,r=this.schemas.size){return this.schemas.has(n)?!1:(this.types[r]=n,n[Symbol.metadata]===void 0&&Ae.initialize(n),this.schemas.set(n,r),!0)}getTypeId(n){return this.schemas.get(n)}discoverTypes(n,r,o,c){var _,w;if(c&&this.registerFilteredByParent(n,r,o),!this.add(n))return;(_=Et.inheritedTypes.get(n))==null||_.forEach(A=>{this.discoverTypes(A,r,o,c)});let h=n;for(;(h=Object.getPrototypeOf(h))&&h!==Be&&h!==Function.prototype;)this.discoverTypes(h);const m=n[w=Symbol.metadata]??(n[w]={});m[ne]&&(this.hasFilters=!0);for(const A in m){const D=A,$=m[D].type,R=m[D].tag!==void 0;if(typeof $!="string")if(Array.isArray($)){const X=$[0];if(X==="string")continue;this.discoverTypes(X,n,D,c||R)}else if(typeof $=="function")this.discoverTypes($,n,D,c||R);else{const X=Object.values($)[0];if(typeof X=="string")continue;this.discoverTypes(X,n,D,c||R)}}}registerFilteredByParent(n,r,o){let h=`${this.schemas.get(n)??this.schemas.size}`;r&&(h+=`-${this.schemas.get(r)}`),h+=`-${o}`,this.parentFiltered[h]=!0}debug(){let n="";for(const r in this.parentFiltered){const o=r.split("-").map(Number),c=o.pop();n+=`
		`,n+=`${r}: ${o.reverse().map((h,m)=>{const _=this.types[h],w=_[Symbol.metadata];let A=_.name;return m===0&&(A+=`[${w[c].name}]`),`${A}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${n}`}};Et.inheritedTypes=new Map,Et.cachedContexts=new Map;let Ie=Et;function At(f){return Array.isArray(f)?{array:f[0]}:typeof f.type<"u"?f.type:f}const Ae={addField(f,n,r,o,c){if(n>64)throw new Error(`Can't define field '${r}'.
Schema instances may only have up to 64 fields.`);f[n]=Object.assign(f[n]||{},{type:At(o),index:n,name:r}),Object.defineProperty(f,z,{value:f[z]||{},enumerable:!1,configurable:!0}),c?(f[z][r]=c,f[z][`_${r}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):f[z][r]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(f,W,{value:n,enumerable:!1,configurable:!0}),Object.defineProperty(f,r,{value:n,enumerable:!1,configurable:!0}),typeof f[n].type!="string"&&(f[he]===void 0&&Object.defineProperty(f,he,{value:[],enumerable:!1,configurable:!0}),f[he].push(n))},setTag(f,n,r){const o=f[n],c=f[o];c.tag=r,f[ne]||(Object.defineProperty(f,ne,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(f,ue,{value:{},enumerable:!1,configurable:!0})),f[ne].push(o),f[ue][r]||(f[ue][r]=[]),f[ue][r].push(o)},setFields(f,n){const r=f.prototype.constructor;Ie.register(r);const o=Object.getPrototypeOf(r),c=o&&o[Symbol.metadata],h=Ae.initialize(r);r[l]||(r[l]=Be[l]),r[u]||(r[u]=Be[u]),r[d]||(r[d]=Be[d]),r.prototype.toJSON||(r.prototype.toJSON=Be.prototype.toJSON);let m=h[W]??(c&&c[W])??-1;m++;for(const _ in n){const w=n[_],A=Array.isArray(w)?De("array"):typeof Object.keys(w)[0]=="string"&&De(Object.keys(w)[0]),D=A?Object.values(w)[0]:At(w);Ae.addField(h,m,_,w,Xs(`_${_}`,m,D,A)),m++}return f},isDeprecated(f,n){return f[n].deprecated===!0},init(f){const n={};f[Symbol.metadata]=n,Object.defineProperty(n,W,{value:0,enumerable:!1,configurable:!0})},initialize(f){const n=Object.getPrototypeOf(f),r=n[Symbol.metadata];let o=f[Symbol.metadata]??Object.create(null);return n!==Be&&o===r&&(o=Object.create(null),r&&(Object.setPrototypeOf(o,r),Object.defineProperty(o,W,{value:r[W],enumerable:!1,configurable:!0,writable:!0}),r[ne]!==void 0&&(Object.defineProperty(o,ne,{value:[...r[ne]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,ue,{value:{...r[ue]},enumerable:!1,configurable:!0,writable:!0})),r[he]!==void 0&&Object.defineProperty(o,he,{value:[...r[he]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(o,z,{value:{...r[z]},enumerable:!1,configurable:!0,writable:!0}))),f[Symbol.metadata]=o,o},isValidInstance(f){return f.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(f.constructor[Symbol.metadata],W)},getFields(f){const n=f[Symbol.metadata],r={};for(let o=0;o<=n[W];o++)r[n[o].name]=n[o].type;return r},hasViewTagAtIndex(f,n){var r;return(r=f==null?void 0:f[ne])==null?void 0:r.includes(n)}};function en(){return{indexes:{},operations:[]}}function Qe(f,n){const r=f.indexes[n];r===void 0?f.indexes[n]=f.operations.push(n)-1:f.operations[r]=n}function Hs(f,n){var o;let r=f.indexes[n];r===void 0&&(r=Object.values(f.indexes).at(-1),n=(o=Object.entries(f.indexes).find(([c,h])=>h===r))==null?void 0:o[0]),f.operations[r]=void 0,delete f.indexes[n]}function Ke(f,n,r,o=n[r].queueRootIndex){if(f)f[r][o]!==n&&(n[r].queueRootIndex=f[r].push(n)-1);else return}class Ct{constructor(n){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=n;const r=n.constructor[Symbol.metadata];r!=null&&r[ne]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(n){var o;this.root=n,this.checkIsFiltered(this.parent,this.parentIndex);const r=this.ref.constructor[Symbol.metadata];r?(o=r[he])==null||o.forEach(c=>{const h=r[c],m=this.ref[h.name];m==null||m[p].setRoot(n)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((c,h)=>{c[p].setRoot(n)})}setParent(n,r,o){var h;if(this.parent=n,this.parentIndex=o,!r)return;r!==this.root?(this.root=r,this.checkIsFiltered(n,o)):r.add(this);const c=this.ref.constructor[Symbol.metadata];c?(h=c[he])==null||h.forEach(m=>{const _=c[m],w=this.ref[_.name];w==null||w[p].setParent(this.ref,r,m)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((m,_)=>{m[p].setParent(this.ref,r,this.indexes[_]??_)})}forEachChild(n){var o;const r=this.ref.constructor[Symbol.metadata];r?(o=r[he])==null||o.forEach(c=>{const h=r[c],m=this.ref[h.name];m&&n(m[p],c)}):this.ref[I]&&typeof this.ref[I]!="string"&&this.ref.forEach((c,h)=>{n(c[p],this.indexes[h]??h)})}operation(n){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-n),Ke(this.root,this,"filteredChanges")):(this.changes.operations.push(-n),Ke(this.root,this,"changes"))}change(n,r=t.OPERATION.ADD){var _;const o=this.ref.constructor[Symbol.metadata],c=this.isFiltered||((_=o==null?void 0:o[n])==null?void 0:_.tag)!==void 0,h=c?this.filteredChanges:this.changes,m=this.indexedOperations[n];if(!m||m===t.OPERATION.DELETE){const w=m&&m===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:r;this.indexedOperations[n]=w}Qe(h,n),c?(Qe(this.allFilteredChanges,n),this.root&&(Ke(this.root,this,"filteredChanges"),Ke(this.root,this,"allFilteredChanges"))):(Qe(this.allChanges,n),Ke(this.root,this,"changes"))}shiftChangeIndexes(n){const r=this.isFiltered?this.filteredChanges:this.changes,o={},c={};for(const h in this.indexedOperations)o[Number(h)+n]=this.indexedOperations[h],c[Number(h)+n]=r.indexes[h];this.indexedOperations=o,r.indexes=c,r.operations=r.operations.map(h=>h+n)}shiftAllChangeIndexes(n,r=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(n,r,this.allFilteredChanges),this._shiftAllChangeIndexes(n,r,this.allChanges)):this._shiftAllChangeIndexes(n,r,this.allChanges)}_shiftAllChangeIndexes(n,r=0,o){const c={};let h=0;for(const m in o.indexes)c[h++]=o.indexes[m];o.indexes=c;for(let m=0;m<o.operations.length;m++){const _=o.operations[m];_>r&&(o.operations[m]=_+n)}}indexedOperation(n,r,o=n){this.indexedOperations[n]=r,this.filteredChanges!==void 0?(Qe(this.allFilteredChanges,o),Qe(this.filteredChanges,n),Ke(this.root,this,"filteredChanges")):(Qe(this.allChanges,o),Qe(this.changes,n),Ke(this.root,this,"changes"))}getType(n){return Ae.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][n].type:this.ref[I]}getChange(n){return this.indexedOperations[n]}getValue(n,r=!1){return this.ref[g](n,r)}delete(n,r,o=n){var m;if(n===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${n}'`)}catch(_){console.warn(_)}return}const c=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[n]=r??t.OPERATION.DELETE,Qe(c,n),Hs(this.allChanges,o);const h=this.getValue(n);return h&&h[p]&&((m=this.root)==null||m.remove(h[p])),this.filteredChanges!==void 0?(Hs(this.allFilteredChanges,o),Ke(this.root,this,"filteredChanges")):Ke(this.root,this,"changes"),h}endEncode(n){var r,o;this.indexedOperations={},this[n].indexes={},this[n].operations.length=0,this[n].queueRootIndex=void 0,(o=(r=this.ref)[F])==null||o.call(r),this.isNew=!1}discard(n=!1){var r,o;(o=(r=this.ref)[F])==null||o.call(r),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),n&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((c,h)=>{var m;return(m=this.root)==null?void 0:m.remove(c)}))}discardAll(){const n=Object.keys(this.indexedOperations);for(let r=0,o=n.length;r<o;r++){const c=this.getValue(Number(n[r]));c&&c[p]&&c[p].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(n,r){const o=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(n,r),this.filteredChanges!==void 0&&(Ke(this.root,this,"filteredChanges"),o&&this.root.allFilteredChanges.push(this))),this.isFiltered||(Ke(this.root,this,"changes"),o&&this.root.allChanges.push(this))}_checkFilteredByParent(n,r){if(!n)return;const o=Ae.isValidInstance(this.ref)?this.ref.constructor:this.ref[I];let c,h=!Ae.isValidInstance(n);h?(c=n[p],n=c.parent,r=c.parentIndex):c=n[p];const m=n.constructor;let _=`${this.root.types.getTypeId(o)}`;m&&(_+=`-${this.root.types.schemas.get(m)}`),_+=`-${r}`;const w=Ae.hasViewTagAtIndex(m==null?void 0:m[Symbol.metadata],r);this.isFiltered=n[p].isFiltered||this.root.types.parentFiltered[_]||w,this.isFiltered&&(this.isVisibilitySharedWithParent=c.isFiltered&&typeof o!="string"&&!w&&h,this.filteredChanges||(this.filteredChanges=en(),this.allFilteredChanges=en()),this.changes.operations.length>0&&(this.changes.operations.forEach(A=>Qe(this.filteredChanges,A)),this.allChanges.operations.forEach(A=>Qe(this.allFilteredChanges,A)),this.changes=en(),this.allChanges=en()))}}function Cn(f,n,r,o,c,h){var m;typeof r=="string"?(m=Ee[r])==null||m.call(Ee,n,o,h):r[Symbol.metadata]!==void 0?(Ee.number(n,o[p].refId,h),(c&t.OPERATION.ADD)===t.OPERATION.ADD&&f.tryEncodeTypeId(n,r,o.constructor,h)):Ee.number(n,o[p].refId,h)}const hs=function(f,n,r,o,c,h,m,_,w){if(n[h.offset++]=(o|c)&255,c===t.OPERATION.DELETE)return;const A=r.ref,D=w[o];Cn(f,n,w[o].type,A[D.name],c,h)},yn=function(f,n,r,o,c,h){if(n[h.offset++]=c&255,c===t.OPERATION.CLEAR||(Ee.number(n,o,h),c===t.OPERATION.DELETE))return;const m=r.ref;if((c&t.OPERATION.ADD)===t.OPERATION.ADD&&typeof m.set=="function"){const A=r.ref.$indexes.get(o);Ee.string(n,A,h)}const _=m[I],w=m[g](o);Cn(f,n,_,w,c,h)},Ln=function(f,n,r,o,c,h,m,_){const w=r.ref,A=_&&r.isFiltered&&typeof r.getType(o)!="string";let D;if(A?(D=w.tmpItems[o][p].refId,c===t.OPERATION.DELETE?c=t.OPERATION.DELETE_BY_REFID:c===t.OPERATION.ADD&&(c=t.OPERATION.ADD_BY_REFID)):D=o,n[h.offset++]=c&255,c===t.OPERATION.CLEAR||c===t.OPERATION.REVERSE||(Ee.number(n,D,h),c===t.OPERATION.DELETE||c===t.OPERATION.DELETE_BY_REFID))return;const $=r.getType(o),R=r.getValue(o,m);Cn(f,n,$,R,c,h)},Gs=-1;function ps(f,n,r,o,c,h,m,_){const w=f.root,A=r[g](o);let D;if((n&t.OPERATION.DELETE)===t.OPERATION.DELETE){const $=w.refIds.get(A);$!==void 0&&w.removeRef($),n!==t.OPERATION.DELETE_AND_ADD&&r[y](o),D=void 0}if(n!==t.OPERATION.DELETE)if(Be.is(c)){const $=H.number(h,m);if(D=w.refs.get($),(n&t.OPERATION.ADD)===t.OPERATION.ADD){const R=f.getInstanceType(h,m,c);D||(D=f.createInstanceOfType(R)),w.addRef($,D,D!==A||n===t.OPERATION.DELETE_AND_ADD&&D===A)}}else if(typeof c=="string")D=H[c](h,m);else{const $=De(Object.keys(c)[0]),R=H.number(h,m),X=w.refs.has(R)?A||w.refs.get(R):new $.constructor;if(D=X.clone(!0),D[I]=Object.values(c)[0],A){let K=w.refIds.get(A);if(K!==void 0&&R!==K){const V=A.entries();let N;for(;(N=V.next())&&!N.done;){const[q,me]=N.value;typeof me=="object"&&(K=w.refIds.get(me),w.removeRef(K)),_.push({ref:A,refId:K,op:t.OPERATION.DELETE,field:q,value:void 0,previousValue:me})}}}w.addRef(R,D,X!==A||n===t.OPERATION.DELETE_AND_ADD&&X===A)}return{value:D,previousValue:A}}const Zs=function(f,n,r,o,c){const h=n[r.offset++],m=o.constructor[Symbol.metadata],_=h>>6<<6,w=h%(_||255),A=m[w];if(A===void 0)return console.warn("@colyseus/schema: field not defined at",{index:w,ref:o.constructor.name,metadata:m}),Gs;const{value:D,previousValue:$}=ps(f,_,o,w,A.type,n,r,c);D!=null&&(o[A.name]=D),$!==D&&c.push({ref:o,refId:f.currentRefId,op:_,field:A.name,value:D,previousValue:$})},kn=function(f,n,r,o,c){const h=n[r.offset++];if(h===t.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}const m=H.number(n,r),_=o[I];let w;(h&t.OPERATION.ADD)===t.OPERATION.ADD?typeof o.set=="function"?(w=H.string(n,r),o.setIndex(m,w)):w=m:w=o.getIndex(m);const{value:A,previousValue:D}=ps(f,h,o,m,_,n,r,c);if(A!=null){if(typeof o.set=="function")o.$items.set(w,A);else if(typeof o.$setAt=="function")o.$setAt(m,A,h);else if(typeof o.add=="function"){const $=o.add(A);typeof $=="number"&&o.setIndex($,$)}}D!==A&&c.push({ref:o,refId:f.currentRefId,op:h,field:"",dynamicIndex:w,value:A,previousValue:D})},Ri=function(f,n,r,o,c){let h=n[r.offset++],m;if(h===t.OPERATION.CLEAR){f.removeChildRefs(o,c),o.clear();return}else if(h===t.OPERATION.REVERSE){o.reverse();return}else if(h===t.OPERATION.DELETE_BY_REFID){const $=H.number(n,r),R=f.root.refs.get($);m=o.findIndex(X=>X===R),o[y](m),c.push({ref:o,refId:f.currentRefId,op:t.OPERATION.DELETE,field:"",dynamicIndex:m,value:void 0,previousValue:R});return}else if(h===t.OPERATION.ADD_BY_REFID){const $=H.number(n,r),R=f.root.refs.get($);R&&(m=o.findIndex(X=>X===R)),(m===-1||m===void 0)&&(m=o.length)}else m=H.number(n,r);const _=o[I];let w=m;const{value:A,previousValue:D}=ps(f,h,o,m,_,n,r,c);A!=null&&A!==D&&o.$setAt(m,A,h),D!==A&&c.push({ref:o,refId:f.currentRefId,op:h,field:"",dynamicIndex:w,value:A,previousValue:D})};class Xn extends Error{}function zs(f,n,r,o){let c,h=!1;switch(n){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(f)&&console.log(`trying to encode "NaN" in ${r.constructor.name}#${o}`);break;case"bigint64":case"biguint64":c="bigint";break;case"string":c="string",h=!0;break;case"boolean":return;default:return}if(typeof f!==c&&(!h||h&&f!==null)){let m=`'${JSON.stringify(f)}'${f&&f.constructor&&` (${f.constructor.name})`||""}`;throw new Xn(`a '${c}' was expected, but ${m} was provided in ${r.constructor.name}#${o}`)}}function An(f,n,r,o){if(!(f instanceof n))throw new Xn(`a '${n.name}' was expected, but '${f&&f.constructor.name}' was provided in ${r.constructor.name}#${o}`)}var bn,Ws;const Ni=(f,n)=>{const r=f.toString(),o=n.toString();return r<o?-1:r>o?1:0},pt=class pt{static[(bn=u,Ws=d,E)](n,r,o){var c;return!o||typeof n[I]=="string"||o.isChangeTreeVisible((c=n.tmpItems[r])==null?void 0:c[p])}static is(n){return Array.isArray(n)||n.array!==void 0}static from(n){return new pt(...Array.from(n))}constructor(...n){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const r=new Proxy(this,{get:(o,c)=>typeof c!="symbol"&&!isNaN(c)?this.items[c]:Reflect.get(o,c),set:(o,c,h)=>{var m;if(typeof c!="symbol"&&!isNaN(c)){if(h==null)o.$deleteAt(c);else{if(h[p]){An(h,o[I],o,c);const _=o.items[c];o.isMovingItems?(_!==void 0?h[p].isNew?o[p].indexedOperation(Number(c),t.OPERATION.MOVE_AND_ADD):(o[p].getChange(Number(c))&t.OPERATION.DELETE)===t.OPERATION.DELETE?o[p].indexedOperation(Number(c),t.OPERATION.DELETE_AND_MOVE):o[p].indexedOperation(Number(c),t.OPERATION.MOVE):h[p].isNew&&o[p].indexedOperation(Number(c),t.OPERATION.ADD),h[p].setParent(this,o[p].root,c)):o.$changeAt(Number(c),h),_!==void 0&&((m=_[p].root)==null||m.remove(_[p]))}else o.$changeAt(Number(c),h);o.items[c]=h,o.tmpItems[c]=h}return!0}else return Reflect.set(o,c,h)},deleteProperty:(o,c)=>(typeof c=="number"?o.$deleteAt(c):delete o[c],!0),has:(o,c)=>typeof c!="symbol"&&!isNaN(Number(c))?Reflect.has(this.items,c):Reflect.has(o,c)});return this[p]=new Ct(r),this[p].indexes={},n.length>0&&this.push(...n),r}set length(n){n===0?this.clear():n<this.items.length?this.splice(n,this.length-n):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...n){var c;let r=this.tmpItems.length;const o=this[p];for(let h=0,m=n.length;h<n.length;h++,r++){const _=n[h];if(_==null)return;typeof _=="object"&&this[I]&&An(_,this[I],this,h),o.indexedOperation(r,t.OPERATION.ADD,this.items.length),this.items.push(_),this.tmpItems.push(_),(c=_[p])==null||c.setParent(this,o.root,r)}return r}pop(){let n=-1;for(let r=this.tmpItems.length-1;r>=0;r--)if(this.deletedIndexes[r]!==!0){n=r;break}if(!(n<0))return this[p].delete(n,void 0,this.items.length-1),this.deletedIndexes[n]=!0,this.items.pop()}at(n){return n<0&&(n+=this.length),this.items[n]}$changeAt(n,r){var h;if(r==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[n]===r)return;const o=this.items[n]!==void 0?typeof r=="object"?t.OPERATION.DELETE_AND_ADD:t.OPERATION.REPLACE:t.OPERATION.ADD,c=this[p];c.change(n,o),(h=r[p])==null||h.setParent(this,c.root,n)}$deleteAt(n,r){this[p].delete(n,r)}$setAt(n,r,o){n===0&&o===t.OPERATION.ADD&&this.items[n]!==void 0?this.items.unshift(r):o===t.OPERATION.DELETE_AND_MOVE?(this.items.splice(n,1),this.items[n]=r):this.items[n]=r}clear(){if(this.items.length===0)return;const n=this[p];n.forEachChild((r,o)=>{r.discard(!0);const c=r.root;c!==void 0&&(c.removeChangeFromChangeSet("changes",r),c.removeChangeFromChangeSet("allChanges",r),c.removeChangeFromChangeSet("allFilteredChanges",r))}),n.discard(!0),n.operation(t.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...n){return new pt(...this.items.concat(...n))}join(n){return this.items.join(n)}reverse(){return this[p].operation(t.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const n=this[p],r=this.tmpItems.findIndex(c=>c===this.items[0]),o=this.items.findIndex(c=>c===this.items[0]);return n.delete(r,t.OPERATION.DELETE,o),n.shiftAllChangeIndexes(-1,o),this.items.shift()}slice(n,r){const o=new pt;return o.push(...this.items.slice(n,r)),o}sort(n=Ni){this.isMovingItems=!0;const r=this[p];return this.items.sort(n).forEach((c,h)=>r.change(h,t.OPERATION.REPLACE)),this.tmpItems.sort(n),this.isMovingItems=!1,this}splice(n,r,...o){var A;const c=this[p],h=this.items.length,m=this.tmpItems.length,_=o.length,w=[];for(let D=0;D<m;D++)this.deletedIndexes[D]!==!0&&w.push(D);if(h>n){r===void 0&&(r=h-n);for(let D=n;D<n+r;D++){const $=w[D];c.delete($,t.OPERATION.DELETE),this.deletedIndexes[$]=!0}}else r=0;if(_>0){if(_>r)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let D=0;D<_;D++){const $=(w[n]??h)+D;c.indexedOperation($,this.deletedIndexes[$]?t.OPERATION.DELETE_AND_ADD:t.OPERATION.ADD),(A=o[D][p])==null||A.setParent(this,c.root,$)}}return r>_&&c.shiftAllChangeIndexes(-(r-_),w[n+_]),c.filteredChanges!==void 0?Ke(c.root,c,"filteredChanges"):Ke(c.root,c,"changes"),this.items.splice(n,r,...o)}unshift(...n){const r=this[p];return r.shiftChangeIndexes(n.length),r.isFiltered?Qe(r.filteredChanges,this.items.length):Qe(r.allChanges,this.items.length),n.forEach((o,c)=>{r.change(c,t.OPERATION.ADD)}),this.tmpItems.unshift(...n),this.items.unshift(...n)}indexOf(n,r){return this.items.indexOf(n,r)}lastIndexOf(n,r=this.length-1){return this.items.lastIndexOf(n,r)}every(n,r){return this.items.every(n,r)}some(n,r){return this.items.some(n,r)}forEach(n,r){return this.items.forEach(n,r)}map(n,r){return this.items.map(n,r)}filter(n,r){return this.items.filter(n,r)}reduce(n,r){return this.items.reduce(n,r)}reduceRight(n,r){return this.items.reduceRight(n,r)}find(n,r){return this.items.find(n,r)}findIndex(n,r){return this.items.findIndex(n,r)}fill(n,r,o){throw new Error("ArraySchema#fill() not implemented")}copyWithin(n,r,o){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return pt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(n,r){return this.items.includes(n,r)}flatMap(n,r){throw new Error("ArraySchema#flatMap() is not supported.")}flat(n){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...n){return this.items.findLastIndex.apply(this.items,arguments)}with(n,r){const o=this.items.slice();return n<0&&(n+=this.length),o[n]=r,new pt(...o)}toReversed(){return this.items.slice().reverse()}toSorted(n){return this.items.slice().sort(n)}toSpliced(n,r,...o){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(n=>{let r=this.items.length;for(;r!=0;){let o=Math.floor(Math.random()*r);r--,[this[r],this[o]]=[this[o],this[r]]}})}move(n){return this.isMovingItems=!0,n(this),this.isMovingItems=!1,this}[g](n,r=!1){return r?this.items[n]:this.deletedIndexes[n]?this.items[n]:this.tmpItems[n]||this.items[n]}[y](n){this.items[n]=void 0,this.tmpItems[n]=void 0}[F](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[J](){this.items=this.items.filter(n=>n!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(n=>typeof n.toJSON=="function"?n.toJSON():n)}clone(n){let r;return n?(r=new pt,r.push(...this.items)):r=new pt(...this.map(o=>o[p]?o.clone():o)),r}};pt[bn]=Ln,pt[Ws]=Ri;let bt=pt;ce("array",{constructor:bt});var Ks,qs;const kt=class kt{static[(Ks=u,qs=d,E)](n,r,o){return!o||typeof n[I]=="string"||o.isChangeTreeVisible((n[g](r)??n.deletedItems[r])[p])}static is(n){return n.map!==void 0}constructor(n){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[p]=new Ct(this),this[p].indexes={},n)if(n instanceof Map||n instanceof kt)n.forEach((r,o)=>this.set(o,r));else for(const r in n)this.set(r,n[r]);Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return kt}set(n,r){var _;if(r==null)throw new Error(`MapSchema#set('${n}', ${r}): trying to set ${r} value on '${n}'.`);typeof r=="object"&&this[I]&&An(r,this[I],this,n),n=n.toString();const o=this[p],c=r[p]!==void 0;let h,m;if(typeof o.indexes[n]<"u"){h=o.indexes[n],m=t.OPERATION.REPLACE;const w=this.$items.get(n);if(w===r)return;c&&(m=t.OPERATION.DELETE_AND_ADD,w!==void 0&&((_=w[p].root)==null||_.remove(w[p])))}else h=o.indexes[W]??0,m=t.OPERATION.ADD,this.$indexes.set(h,n),o.indexes[n]=h,o.indexes[W]=h+1;return this.$items.set(n,r),o.change(h,m),c&&r[p].setParent(this,o.root,h),this}get(n){return this.$items.get(n)}delete(n){const r=this[p].indexes[n];return this.deletedItems[r]=this[p].delete(r),this.$items.delete(n)}clear(){const n=this[p];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(t.OPERATION.CLEAR)}has(n){return this.$items.has(n)}forEach(n){this.$items.forEach(n)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[F](){this.deletedItems={}}toJSON(){const n={};return this.forEach((r,o)=>{n[o]=typeof r.toJSON=="function"?r.toJSON():r}),n}clone(n){let r;return n?r=Object.assign(new kt,this):(r=new kt,this.forEach((o,c)=>{o[p]?r.set(c,o.clone()):r.set(c,o)})),r}};kt[Ks]=yn,kt[qs]=kn;let ct=kt;ce("map",{constructor:ct});const Ot=-1;function Pi(f){return Ie.register(f),f}function Ys(f=Ot){return function(n,r){var _;const o=n.constructor,h=Object.getPrototypeOf(o)[Symbol.metadata],m=o[_=Symbol.metadata]??(o[_]=Object.assign({},o[Symbol.metadata],h??Object.create(null)));Ae.setTag(m,r,f)}}function ht(f,n){return function(r,o){const c=r.constructor;if(!f)throw new Error(`${c.name}: @type() reference provided for "${o}" is undefined. Make sure you don't have any circular dependencies.`);Ie.register(c);const m=Object.getPrototypeOf(c)[Symbol.metadata],_=Ae.initialize(c);let w=_[o];if(_[w]!==void 0){if(_[w].deprecated)return;if(_[w].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${o}' definition on '${c.name}'.
Check @type() annotation`)}catch(A){const D=A.stack.split(`
`)[4].trim();throw new Error(`${A.message} ${D}`)}}else w=_[W]??(m&&m[W])??-1,w++;if(n&&n.manual)Ae.addField(_,w,o,f,{enumerable:!0,configurable:!0,writable:!0});else{const A=Array.isArray(f)?De("array"):typeof Object.keys(f)[0]=="string"&&De(Object.keys(f)[0]),D=A?Object.values(f)[0]:f;Ae.addField(_,w,o,f,Xs(`_${o}`,w,D,A))}}}function Xs(f,n,r,o){return{get:function(){return this[f]},set:function(c){var m,_;const h=this[f]??void 0;if(c!==h){if(c!=null){o?(o.constructor===bt&&!(c instanceof bt)&&(c=new bt(...c)),o.constructor===ct&&!(c instanceof ct)&&(c=new ct(c)),c[I]=r):typeof r!="string"?An(c,r,this,f.substring(1)):zs(c,r,this,f.substring(1));const w=this[p];h!==void 0&&h[p]?((m=w.root)==null||m.remove(h[p]),this.constructor[l](w,n,t.OPERATION.DELETE_AND_ADD)):this.constructor[l](w,n,t.OPERATION.ADD),(_=c[p])==null||_.setParent(this,w.root,n)}else h!==void 0&&this[p].delete(n);this[f]=c}},enumerable:!0,configurable:!0}}function En(f=!0){return function(n,r){var w;const o=n.constructor,h=Object.getPrototypeOf(o)[Symbol.metadata],m=o[w=Symbol.metadata]??(o[w]=Object.assign({},o[Symbol.metadata],h??Object.create(null))),_=m[r];m[_].deprecated=!0,f&&(m[z]??(m[z]={}),m[z][r]={get:function(){throw new Error(`${r} is deprecated.`)},set:function(A){},enumerable:!1,configurable:!0}),Object.defineProperty(m,_,{value:m[_],enumerable:!1,configurable:!0})}}function Ci(f,n,r){for(let o in n)ht(n[o],r)(f.prototype,o);return f}function Js(f,n,r=Be){const o={},c={};for(let m in f){const _=f[m];typeof _=="object"&&(_.default!==void 0&&(o[m]=_.default),_.view!==void 0&&(c[m]=typeof _.view=="boolean"?Ot:_.view))}const h=Ae.setFields(class extends r{constructor(...m){m[0]=Object.assign({},o,m[0]),super(...m)}},f);for(let m in c)Ys(c[m])(h.prototype,m);return n&&Object.defineProperty(h,"name",{value:n}),h.extends=(m,_)=>Js(m,_,h),h}function Bn(f){return new Array(f).fill(0).map((n,r)=>r===f-1?"└─ ":"   ").join("")}function Li(f){const n=f[p].root,r={ops:{},refs:[]};return n.changes.forEach(o=>{if(o===void 0)return;const c=o.indexedOperations;r.refs.push(`refId#${o.refId}`);for(const h in c){const m=c[h],_=t.OPERATION[m];r.ops[_]||(r.ops[_]=0),r.ops[t.OPERATION[m]]++}}),r}var Qs,Jn;const wn=class wn{static initialize(n){var r;Object.defineProperty(n,p,{value:new Ct(n),enumerable:!1,writable:!0}),Object.defineProperties(n,((r=n.constructor[Symbol.metadata])==null?void 0:r[z])||{})}static is(n){return typeof n[Symbol.metadata]=="object"}static[(Qs=u,Jn=d,l)](n,r,o=t.OPERATION.ADD){n.change(r,o)}static[E](n,r,o){var m,_;const h=(m=n.constructor[Symbol.metadata][r])==null?void 0:m.tag;if(o===void 0)return h===void 0;if(h===void 0)return!0;if(h===Ot)return o.isChangeTreeVisible(n[p]);{const w=(_=o.tags)==null?void 0:_.get(n[p]);return w&&w.has(h)}}constructor(...n){wn.initialize(this),n[0]&&Object.assign(this,n[0])}assign(n){return Object.assign(this,n),this}setDirty(n,r){const o=this.constructor[Symbol.metadata];this[p].change(o[o[n]].index,r)}clone(){var o;const n=new this.constructor,r=this.constructor[Symbol.metadata];for(const c in r){const h=r[c].name;typeof this[h]=="object"&&typeof((o=this[h])==null?void 0:o.clone)=="function"?n[h]=this[h].clone():n[h]=this[h]}return n}toJSON(){const n={},r=this.constructor[Symbol.metadata];for(const o in r){const c=r[o],h=c.name;!c.deprecated&&this[h]!==null&&typeof this[h]<"u"&&(n[h]=typeof this[h].toJSON=="function"?this[h].toJSON():this[h])}return n}discardAllChanges(){this[p].discardAll()}[g](n){const r=this.constructor[Symbol.metadata];return this[r[n].name]}[y](n){const r=this.constructor[Symbol.metadata];this[r[n].name]=void 0}static debugRefIds(n,r=!1,o=0){const c=r?` - ${JSON.stringify(n.toJSON())}`:"",h=n[p],m=h.refId;let _="";return _+=`${Bn(o)}${n.constructor.name} (refId: ${m})${c}
`,h.forEachChild(w=>_+=this.debugRefIds(w.ref,r,o+1)),_}static debugChanges(n,r=!1){const o=n[p],c=r?o.allChanges:o.changes,h=r?"allChanges":"changes";let m=`${n.constructor.name} (${o.refId}) -> .${h}:
`;function _(w){w.operations.filter(A=>A).forEach(A=>{const D=o.indexedOperations[A];console.log({index:A,operation:D}),m+=`- [${A}]: ${t.OPERATION[D]} (${JSON.stringify(o.getValue(Number(A),r))})
`})}return _(c),!r&&o.filteredChanges&&o.filteredChanges.operations.filter(w=>w).length>0&&(m+=`${n.constructor.name} (${o.refId}) -> .filteredChanges:
`,_(o.filteredChanges)),r&&o.allFilteredChanges&&o.allFilteredChanges.operations.filter(w=>w).length>0&&(m+=`${n.constructor.name} (${o.refId}) -> .allFilteredChanges:
`,_(o.allFilteredChanges)),m}static debugChangesDeep(n,r="changes"){var D,$;let o="";const c=n[p],h=c.root,m=new Map,_=[];let w=0;for(const[R,X]of Object.entries(h[r])){const K=h.changeTrees[R];let V=!1,N=[],q=(D=K.parent)==null?void 0:D[p];if(K===c)V=!0;else for(;q!==void 0;){if(N.push(q),q.ref===n){V=!0;break}q=($=q.parent)==null?void 0:$[p]}V&&(_.push(K.refId),w+=Object.keys(X).length,m.set(K,N.reverse()))}o+=`---
`,o+=`root refId: ${c.refId}
`,o+=`Total instances: ${_.length} (refIds: ${_.join(", ")})
`,o+=`Total changes: ${w}
`,o+=`---
`;const A=new WeakSet;for(const[R,X]of m.entries()){X.forEach((me,Oe)=>{A.has(me)||(o+=`${Bn(Oe)}${me.ref.constructor.name} (refId: ${me.refId})
`,A.add(me))});const K=R.indexedOperations,V=X.length,N=Bn(V),q=V>0?`(${R.parentIndex}) `:"";o+=`${N}${q}${R.ref.constructor.name} (refId: ${R.refId}) - changes: ${Object.keys(K).length}
`;for(const me in K){const Oe=K[me];o+=`${Bn(V+1)}${t.OPERATION[Oe]}: ${me}
`}}return`${o}`}};wn[Qs]=hs,wn[Jn]=Zs;let Be=wn;var ei,tn;const rn=class rn{static[(ei=u,tn=d,E)](n,r,o){return!o||typeof n[I]=="string"||o.isChangeTreeVisible((n[g](r)??n.deletedItems[r])[p])}static is(n){return n.collection!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[p]=new Ct(this),this[p].indexes={},n&&n.forEach(r=>this.add(r)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){const r=this.$refId++;return n[p]!==void 0&&n[p].setParent(this,this[p].root,r),this[p].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,n),this[p].change(r),r}at(n){const r=Array.from(this.$items.keys())[n];return this.$items.get(r)}entries(){return this.$items.entries()}delete(n){const r=this.$items.entries();let o,c;for(;(c=r.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[p].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[p];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(t.OPERATION.CLEAR)}has(n){return Array.from(this.$items.values()).some(r=>r===n)}forEach(n){this.$items.forEach((r,o,c)=>n(r,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[F](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((r,o)=>{n.push(typeof r.toJSON=="function"?r.toJSON():r)}),n}clone(n){let r;return n?r=Object.assign(new rn,this):(r=new rn,this.forEach(o=>{o[p]?r.add(o.clone()):r.add(o)})),r}};rn[ei]=yn,rn[tn]=kn;let vn=rn;ce("collection",{constructor:vn});var ti,ni;const an=class an{static[(ti=u,ni=d,E)](n,r,o){return!o||typeof n[I]=="string"||o.visible.has((n[g](r)??n.deletedItems[r])[p])}static is(n){return n.set!==void 0}constructor(n){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[p]=new Ct(this),this[p].indexes={},n&&n.forEach(r=>this.add(r)),Object.defineProperty(this,I,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(n){var c;if(this.has(n))return!1;const r=this.$refId++;n[p]!==void 0&&n[p].setParent(this,this[p].root,r);const o=((c=this[p].indexes[r])==null?void 0:c.op)??t.OPERATION.ADD;return this[p].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,n),this[p].change(r,o),r}entries(){return this.$items.entries()}delete(n){const r=this.$items.entries();let o,c;for(;(c=r.next())&&!c.done;)if(n===c.value[1]){o=c.value[0];break}return o===void 0?!1:(this.deletedItems[o]=this[p].delete(o),this.$indexes.delete(o),this.$items.delete(o))}clear(){const n=this[p];n.discard(!0),n.indexes={},this.$indexes.clear(),this.$items.clear(),n.operation(t.OPERATION.CLEAR)}has(n){const r=this.$items.values();let o=!1,c;for(;(c=r.next())&&!c.done;)if(n===c.value){o=!0;break}return o}forEach(n){this.$items.forEach((r,o,c)=>n(r,o,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(n,r){this.$indexes.set(n,r)}getIndex(n){return this.$indexes.get(n)}[g](n){return this.$items.get(this.$indexes.get(n))}[y](n){const r=this.$indexes.get(n);this.$items.delete(r),this.$indexes.delete(n)}[F](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const n=[];return this.forEach((r,o)=>{n.push(typeof r.toJSON=="function"?r.toJSON():r)}),n}clone(n){let r;return n?r=Object.assign(new an,this):(r=new an,this.forEach(o=>{o[p]?r.add(o.clone()):r.add(o)})),r}};an[ti]=yn,an[ni]=kn;let _n=an;ce("set",{constructor:_n});function Lt(f,n,r,o){var c=arguments.length,h=c<3?n:o===null?o=Object.getOwnPropertyDescriptor(n,r):o,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,n,r,o);else for(var _=f.length-1;_>=0;_--)(m=f[_])&&(h=(c<3?m(h):c>3?m(n,r,h):m(n,r))||h);return c>3&&h&&Object.defineProperty(n,r,h),h}typeof SuppressedError=="function"&&SuppressedError;class ki{constructor(n){this.types=n,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(n){n.ensureRefId();const r=this.changeTrees[n.refId]===void 0;r&&(this.changeTrees[n.refId]=n);const o=this.refCount[n.refId];if(o===0){const c=n.allChanges.operations;let h=c.length;for(;h--;)n.indexedOperations[c[h]]=t.OPERATION.ADD,Qe(n.changes,h)}return this.refCount[n.refId]=(o||0)+1,r}remove(n){const r=this.refCount[n.refId]-1;return r<=0?(n.root=void 0,delete this.changeTrees[n.refId],this.removeChangeFromChangeSet("allChanges",n),this.removeChangeFromChangeSet("changes",n),n.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",n),this.removeChangeFromChangeSet("filteredChanges",n)),this.refCount[n.refId]=0):(this.refCount[n.refId]=r,n.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",n),Ke(this,n,"filteredChanges")):(this.removeChangeFromChangeSet("changes",n),Ke(this,n,"changes"))),n.forEachChild((o,c)=>this.remove(o)),r}removeChangeFromChangeSet(n,r){const o=this[n],c=o.indexOf(r);if(c!==-1)return r[n].queueRootIndex=-1,o[c]=void 0,!0}clear(){this.changes.length=0}}const $n=class $n{constructor(n){this.sharedBuffer=Buffer.allocUnsafe($n.BUFFER_SIZE),this.context=Ie.cache(n.constructor),this.root=new ki(this.context),this.setState(n)}setState(n){this.state=n,this.state[p].setRoot(this.root)}encode(n={offset:0},r,o=this.sharedBuffer,c="changes",h=c==="allChanges",m=n.offset){const _=r!==void 0,w=this.state[p],A=this.root[c];for(let D=0,$=A.length;D<$;D++){const R=A[D];if(!R)continue;if(_){if(!r.isChangeTreeVisible(R)){r.invisible.add(R);continue}r.invisible.delete(R)}const X=R[c],K=R.ref,V=X.operations.length;if(V===0)continue;const N=K.constructor,q=N[u],me=N[E],Oe=N[Symbol.metadata];(_||n.offset>m||R!==w)&&(o[n.offset++]=255,Ee.number(o,R.refId,n));for(let Ze=0;Ze<V;Ze++){const je=X.operations[Ze],Rt=je<0?Math.abs(je):h?t.OPERATION.ADD:R.indexedOperations[je];je===void 0||Rt===void 0||me&&!me(K,je,r)||q(this,o,R,je,Rt,n,h,_,Oe)}}if(n.offset>o.byteLength){const D=Math.ceil(n.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(D/1024)} * 1024; // ${Math.round(D/1024)} KB
`),o=Buffer.alloc(D,o),o===this.sharedBuffer&&(this.sharedBuffer=o),this.encode({offset:m},r,o,c,h)}else return o.subarray(0,n.offset)}encodeAll(n={offset:0},r=this.sharedBuffer){return this.encode(n,void 0,r,"allChanges",!0)}encodeAllView(n,r,o,c=this.sharedBuffer){const h=o.offset;return this.encode(o,n,c,"allFilteredChanges",!0,h),Buffer.concat([c.subarray(0,r),c.subarray(h,o.offset)])}debugChanges(n){(typeof n=="string"?this.root[n]:n).forEach(o=>{const c=o[n],h=o.ref.constructor[Symbol.metadata];console.log("->",{ref:o.ref.constructor.name,refId:o.refId,changes:Object.keys(c).length});for(const m in c){const _=c[m];console.log("  ->",{index:m,field:h==null?void 0:h[m],op:t.OPERATION[_]})}})}encodeView(n,r,o,c=this.sharedBuffer){const h=o.offset;for(const[m,_]of n.changes){const w=this.root.changeTrees[m];if(w===void 0){n.changes.delete(m);continue}const A=Object.keys(_);if(A.length===0)continue;const $=w.ref.constructor,R=$[u],X=$[Symbol.metadata];c[o.offset++]=255,Ee.number(c,w.refId,o);for(let K=0,V=A.length;K<V;K++){const N=Number(A[K]),me=w.ref[g](N)!==void 0&&_[N]||t.OPERATION.DELETE;R(this,c,w,N,me,o,!1,!0,X)}}return n.changes.clear(),this.encode(o,n,c,"filteredChanges",!1,h),Buffer.concat([c.subarray(0,r),c.subarray(h,o.offset)])}discardChanges(){var r,o;let n=this.root.changes.length;if(n>0){for(;n--;)(r=this.root.changes[n])==null||r.endEncode("changes");this.root.changes.length=0}if(n=this.root.filteredChanges.length,n>0){for(;n--;)(o=this.root.filteredChanges[n])==null||o.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(n,r,o,c){const h=this.context.getTypeId(r),m=this.context.getTypeId(o);if(m===void 0){console.warn(`@colyseus/schema WARNING: Class "${o.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}h!==m&&(n[c.offset++]=213,Ee.number(n,m,c))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};$n.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let un=$n;function si(f,n){if(n===-1||n>=f.length)return!1;const r=f.length-1;for(let o=n;o<r;o++)f[o]=f[o+1];return f.length=r,!0}class ii extends Error{constructor(n){super(n),this.name="DecodingWarning"}}class Bi{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(n,r,o=!0){this.refs.set(n,r),this.refIds.set(r,n),o&&(this.refCounts[n]=(this.refCounts[n]||0)+1),this.deletedRefs.has(n)&&this.deletedRefs.delete(n)}removeRef(n){const r=this.refCounts[n];if(r===void 0){try{throw new ii("trying to remove refId that doesn't exist: "+n)}catch(o){console.warn(o)}return}if(r===0){try{const o=this.refs.get(n);throw new ii(`trying to remove refId '${n}' with 0 refCount (${o.constructor.name}: ${JSON.stringify(o)})`)}catch(o){console.warn(o)}return}(this.refCounts[n]=r-1)<=0&&this.deletedRefs.add(n)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(n=>{if(this.refCounts[n]>0)return;const r=this.refs.get(n);if(r.constructor[Symbol.metadata]!==void 0){const o=r.constructor[Symbol.metadata];for(const c in o){const h=o[c].name,m=typeof r[h]=="object"&&this.refIds.get(r[h]);m&&!this.deletedRefs.has(m)&&this.removeRef(m)}}else typeof r[I]=="function"&&Array.from(r.values()).forEach(o=>{const c=this.refIds.get(o);this.deletedRefs.has(c)||this.removeRef(c)});this.refs.delete(n),delete this.refCounts[n],delete this.callbacks[n]}),this.deletedRefs.clear()}addCallback(n,r,o){if(n===void 0){const c=typeof r=="number"?t.OPERATION[r]:r;throw new Error(`Can't addCallback on '${c}' (refId is undefined)`)}return this.callbacks[n]||(this.callbacks[n]={}),this.callbacks[n][r]||(this.callbacks[n][r]=[]),this.callbacks[n][r].push(o),()=>this.removeCallback(n,r,o)}removeCallback(n,r,o){var h,m,_;const c=(_=(m=(h=this.callbacks)==null?void 0:h[n])==null?void 0:m[r])==null?void 0:_.indexOf(o);c!==-1&&si(this.callbacks[n][r],c)}}class Qn{constructor(n,r){this.currentRefId=0,this.setState(n),this.context=r||new Ie(n.constructor)}setState(n){this.state=n,this.root=new Bi,this.root.addRef(0,n)}decode(n,r={offset:0},o=this.state){var w,A,D;const c=[],h=this.root,m=n.byteLength;let _=o.constructor[d];for(this.currentRefId=0;r.offset<m;){if(n[r.offset]==255){r.offset++,this.currentRefId=H.number(n,r);const R=h.refs.get(this.currentRefId);if(!R)throw new Error(`"refId" not found: ${this.currentRefId}`);(w=o[J])==null||w.call(o),o=R,_=o.constructor[d];continue}if(_(this,n,r,o,c)===Gs){console.warn("@colyseus/schema: definition mismatch");const R={offset:r.offset};for(;r.offset<m&&!(n[r.offset]===255&&(R.offset=r.offset+1,h.refs.has(H.number(n,R))));)r.offset++;continue}}return(A=o[J])==null||A.call(o),(D=this.triggerChanges)==null||D.call(this,c),h.garbageCollectDeletedRefs(),c}getInstanceType(n,r,o){let c;if(n[r.offset]===213){r.offset++;const h=H.number(n,r);c=this.context.get(h)}return c||o}createInstanceOfType(n){return new n}removeChildRefs(n,r){const o=typeof n[I]!="string",c=this.root.refIds.get(n);n.forEach((h,m)=>{r.push({ref:n,refId:c,op:t.OPERATION.DELETE,field:m,value:void 0,previousValue:h}),o&&this.root.removeRef(this.root.refIds.get(h))})}}class nn extends Be{}Lt([ht("string")],nn.prototype,"name",void 0),Lt([ht("string")],nn.prototype,"type",void 0),Lt([ht("number")],nn.prototype,"referencedType",void 0);class sn extends Be{constructor(){super(...arguments),this.fields=new bt}}Lt([ht("number")],sn.prototype,"id",void 0),Lt([ht("number")],sn.prototype,"extendsId",void 0),Lt([ht([nn])],sn.prototype,"fields",void 0);class jt extends Be{constructor(){super(...arguments),this.types=new bt}static encode(n,r={offset:0}){const o=n.context,c=new jt,h=new un(c),m=o.schemas.get(n.state.constructor);m>0&&(c.rootType=m);const _=new Set,w={},A=$=>{if($.extendsId===void 0||_.has($.extendsId)){_.add($.id),c.types.push($);const R=w[$.id];R!==void 0&&(delete w[$.id],R.forEach(X=>A(X)))}else w[$.extendsId]===void 0&&(w[$.extendsId]=[]),w[$.extendsId].push($)};o.schemas.forEach(($,R)=>{const X=new sn;X.id=Number($);const K=Object.getPrototypeOf(R);K!==Be&&(X.extendsId=o.schemas.get(K));const V=R[Symbol.metadata];if(V!==K[Symbol.metadata])for(const N in V){const q=Number(N),me=V[q].name;if(!Object.prototype.hasOwnProperty.call(V,me))continue;const Oe=new nn;Oe.name=me;let Ze;const je=V[q];if(typeof je.type=="string")Ze=je.type;else{let Rt;Be.is(je.type)?(Ze="ref",Rt=je.type):(Ze=Object.keys(je.type)[0],typeof je.type[Ze]=="string"?Ze+=":"+je.type[Ze]:Rt=je.type[Ze]),Oe.referencedType=Rt?o.getTypeId(Rt):-1}Oe.type=Ze,X.fields.push(Oe)}A(X)});for(const $ in w)w[$].forEach(R=>c.types.push(R));const D=h.encodeAll(r);return Buffer.from(D,0,r.offset)}static decode(n,r){const o=new jt;new Qn(o).decode(n,r);const h=new Ie;o.types.forEach(w=>{const A=h.get(w.extendsId)??Be,D=class extends A{};Ie.register(D),h.add(D,w.id)},{});const m=(w,A,D)=>{A.fields.forEach(($,R)=>{const X=D+R;if($.referencedType!==void 0){let K=$.type,V=h.get($.referencedType);if(!V){const N=$.type.split(":");K=N[0],V=N[1]}K==="ref"?Ae.addField(w,X,$.name,V):Ae.addField(w,X,$.name,{[K]:V})}else Ae.addField(w,X,$.name,$.type)})};o.types.forEach(w=>{const A=h.get(w.id),D=Ae.initialize(A),$=[];let R=w;do $.push(R),R=o.types.find(K=>K.id===R.extendsId);while(R);let X=0;$.reverse().forEach(K=>{m(D,K,X),X+=K.fields.length})});const _=new(h.get(o.rootType||0));return new Qn(_,h)}}Lt([ht([sn])],jt.prototype,"types",void 0),Lt([ht("number")],jt.prototype,"rootType",void 0);function $i(f){const n=f.root,r=n.callbacks,o=new WeakMap;let c;f.triggerChanges=function(_){var A;const w=new Set;for(let D=0,$=_.length;D<$;D++){const R=_[D],X=R.refId,K=R.ref,V=r[X];if(V){if((R.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&R.previousValue instanceof Be){const N=(A=r[n.refIds.get(R.previousValue)])==null?void 0:A[t.OPERATION.DELETE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q]()}if(K instanceof Be){if(!w.has(X)){const N=V==null?void 0:V[t.OPERATION.REPLACE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q]()}if(V.hasOwnProperty(R.field)){const N=V[R.field];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.previousValue)}}else{if((R.op&t.OPERATION.DELETE)===t.OPERATION.DELETE){if(R.previousValue!==void 0){const N=V[t.OPERATION.DELETE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.previousValue,R.dynamicIndex??R.field)}if((R.op&t.OPERATION.ADD)===t.OPERATION.ADD){const N=V[t.OPERATION.ADD];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}}else if((R.op&t.OPERATION.ADD)===t.OPERATION.ADD&&R.previousValue!==R.value){const N=V[t.OPERATION.ADD];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}if(R.value!==R.previousValue&&(R.value!==void 0||R.previousValue!==void 0)){const N=V[t.OPERATION.REPLACE];for(let q=(N==null?void 0:N.length)-1;q>=0;q--)N[q](R.value,R.dynamicIndex??R.field)}}w.add(X)}}};function h(_,w){var $;let A=(($=w.instance)==null?void 0:$.constructor[Symbol.metadata])||_,D=w.instance&&typeof w.instance.forEach=="function"||_&&typeof _[Symbol.metadata]>"u";if(A&&!D){const R=function(X,K,V,N){return N&&w.instance[K]!==void 0&&!o.has(c)&&V(w.instance[K],void 0),n.addCallback(n.refIds.get(X),K,V)};return new Proxy({listen:function(K,V,N=!0){if(w.instance)return R(w.instance,K,V,N);{let q=()=>{};return w.onInstanceAvailable((me,Oe)=>{q=R(me,K,V,N&&Oe&&!o.has(c))}),()=>q()}},onChange:function(K){return n.addCallback(n.refIds.get(w.instance),t.OPERATION.REPLACE,K)},bindTo:function(K,V){return V||(V=Object.keys(A).map(N=>A[N].name)),n.addCallback(n.refIds.get(w.instance),t.OPERATION.REPLACE,()=>{V.forEach(N=>K[N]=w.instance[N])})}},{get(X,K){var N;const V=A[A[K]];if(V){const q=(N=w.instance)==null?void 0:N[K],me=Oe=>{const Ze=m(w.instance).listen(K,(je,Rt)=>{Oe(je,!1),Ze==null||Ze()},!1);n.refIds.get(q)!==void 0&&Oe(q,!0)};return h(V.type,{instance:n.refIds.get(q)&&q,parentInstance:w.instance,onInstanceAvailable:me})}else return X[K]},has(X,K){return A[K]!==void 0},set(X,K,V){throw new Error("not allowed")},deleteProperty(X,K){throw new Error("not allowed")}})}else{const R=function(V,N,q){return q&&V.forEach((me,Oe)=>N(me,Oe)),n.addCallback(n.refIds.get(V),t.OPERATION.ADD,(me,Oe)=>{o.set(N,!0),c=N,N(me,Oe),o.delete(N),c=void 0})},X=function(V,N){return n.addCallback(n.refIds.get(V),t.OPERATION.DELETE,N)},K=function(V,N){return n.addCallback(n.refIds.get(V),t.OPERATION.REPLACE,N)};return new Proxy({onAdd:function(V,N=!0){if(w.instance)return R(w.instance,V,N&&!o.has(c));if(w.onInstanceAvailable){let q=()=>{};return w.onInstanceAvailable((me,Oe)=>{q=R(me,V,N&&Oe&&!o.has(c))}),()=>q()}},onRemove:function(V){if(w.instance)return X(w.instance,V);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(q=>{N=X(q,V)}),()=>N()}},onChange:function(V){if(w.instance)return K(w.instance,V);if(w.onInstanceAvailable){let N=()=>{};return w.onInstanceAvailable(q=>{N=K(q,V)}),()=>N()}}},{get(V,N){if(!V[N])throw new Error(`Can't access '${N}' through callback proxy. access the instance directly.`);return V[N]},has(V,N){return V[N]!==void 0},set(V,N,q){throw new Error("not allowed")},deleteProperty(V,N){throw new Error("not allowed")}})}}function m(_){return h(void 0,{instance:_})}return m}function Mi(f,n){f.triggerChanges=n}class Ui{constructor(n=!1){this.iterable=n,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,n&&(this.items=[])}add(n,r=Ot,o=!0){var _,w;const c=n==null?void 0:n[p];if(c){if(!c.parent&&c.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${c.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",n),this;const h=n.constructor[Symbol.metadata];this.visible.add(c),this.iterable&&o&&this.items.push(n),o&&c.parent&&this.addParentOf(c,r);let m=this.changes.get(c.refId);if(m===void 0&&(m={},this.changes.set(c.refId,m)),r!==Ot){this.tags||(this.tags=new WeakMap);let A;this.tags.has(c)?A=this.tags.get(c):(A=new Set,this.tags.set(c,A)),A.add(r),(w=(_=h==null?void 0:h[ue])==null?void 0:_[r])==null||w.forEach(D=>{c.getChange(D)!==t.OPERATION.DELETE&&(m[D]=t.OPERATION.ADD)})}else{const A=this.invisible.has(c),D=c.filteredChanges!==void 0?c.allFilteredChanges:c.allChanges;for(let $=0,R=D.operations.length;$<R;$++){const X=D.operations[$];if(X===void 0)continue;const K=c.indexedOperations[X]??t.OPERATION.ADD,V=h==null?void 0:h[X].tag;!c.isNew&&(A||V===void 0||V===r)&&K!==t.OPERATION.DELETE&&(m[X]=K)}}return c.forEachChild((A,D)=>{h&&h[D].tag!==void 0&&h[D].tag!==r||this.add(A.ref,r,!1)}),this}addParentOf(n,r){var h;const o=n.parent[p],c=n.parentIndex;if(!this.visible.has(o)){this.visible.add(o);const m=(h=o.parent)==null?void 0:h[p];m&&m.filteredChanges!==void 0&&this.addParentOf(o,r)}if(o.getChange(c)!==t.OPERATION.DELETE){let m=this.changes.get(o.refId);m===void 0&&(m={},this.changes.set(o.refId,m)),this.tags||(this.tags=new WeakMap);let _;this.tags.has(o)?_=this.tags.get(o):(_=new Set,this.tags.set(o,_)),_.add(r),m[c]=t.OPERATION.ADD}}remove(n,r=Ot,o=!1){var w;const c=n[p];if(!c)return console.warn("StateView#remove(), invalid object:",n),this;this.visible.delete(c),this.iterable&&!o&&si(this.items,this.items.indexOf(n));const m=c.ref.constructor[Symbol.metadata];let _=this.changes.get(c.refId);if(_===void 0&&(_={},this.changes.set(c.refId,_)),r===Ot){const A=c.parent;if(!Ae.isValidInstance(A)&&c.isFiltered){const D=A[p];let $=this.changes.get(D.refId);$===void 0&&($={},this.changes.set(D.refId,$)),$[c.parentIndex]=t.OPERATION.DELETE}else(w=m==null?void 0:m[ne])==null||w.forEach(D=>_[D]=t.OPERATION.DELETE)}else m==null||m[ue][r].forEach(A=>_[A]=t.OPERATION.DELETE);if(this.tags&&this.tags.has(c)){const A=this.tags.get(c);r===void 0?this.tags.delete(c):(A.delete(r),A.size===0&&this.tags.delete(c))}return this}has(n){return this.visible.has(n[p])}hasTag(n,r=Ot){var c;const o=(c=this.tags)==null?void 0:c.get(n[p]);return(o==null?void 0:o.has(r))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let n=0,r=this.items.length;n<r;n++)this.remove(this.items[n],Ot,!0);this.items.length=0}isChangeTreeVisible(n){let r=this.visible.has(n);return!r&&n.isVisibilitySharedWithParent&&this.visible.has(n.parent[p])&&(this.visible.add(n),r=!0),r}}ce("map",{constructor:ct}),ce("array",{constructor:bt}),ce("set",{constructor:_n}),ce("collection",{constructor:vn}),t.$changes=p,t.$childType=I,t.$decoder=d,t.$deleteByIndex=y,t.$encoder=u,t.$filter=E,t.$getByIndex=g,t.$track=l,t.ArraySchema=bt,t.ChangeTree=Ct,t.CollectionSchema=vn,t.Decoder=Qn,t.Encoder=un,t.MapSchema=ct,t.Metadata=Ae,t.Reflection=jt,t.ReflectionField=nn,t.ReflectionType=sn,t.Schema=Be,t.SetSchema=_n,t.StateView=Ui,t.TypeContext=Ie,t.decode=H,t.decodeKeyValueOperation=kn,t.decodeSchemaOperation=Zs,t.defineCustomTypes=Re,t.defineTypes=Ci,t.deprecated=En,t.dumpChanges=Li,t.encode=Ee,t.encodeArray=Ln,t.encodeKeyValueOperation=yn,t.encodeSchemaOperation=hs,t.entity=Pi,t.getDecoderStateCallbacks=$i,t.getRawChangesCallback=Mi,t.registerType=ce,t.schema=Js,t.type=ht,t.view=Ys})})(Ra,Ra.exports);var st=Ra.exports,_p=Object.defineProperty,wp=Object.getOwnPropertyDescriptor,wt=(s,e,t,i)=>{for(var a=i>1?void 0:i?wp(e,t):e,l=s.length-1,u;l>=0;l--)(u=s[l])&&(a=(i?u(e,t,a):u(a))||a);return i&&a&&_p(e,t,a),a},$e=(s=>(s.Lobby="Lobby",s.Shop="Shop",s.Preparation="Preparation",s.Battle="Battle",s.BattleEnd="BattleEnd",s.GameOver="GameOver",s))($e||{});const Zn=class Rc extends st.Schema{constructor(){super(...arguments),this.instanceId="",this.cardId="",this.name="",this.attack=0,this.speed=0,this.health=0,this.currentHp=0,this.brewCost=0,this.description="",this.isLegend=!1}static fromCardData(e,t){const i=new Rc;return i.instanceId=t,i.cardId=e.id,i.name=e.name,i.attack=e.attack,i.speed=e.speed,i.health=e.health,i.currentHp=e.health,i.brewCost=e.brewCost,i.description=e.description,i.isLegend=e.isLegend,i}};wt([st.type("string")],Zn.prototype,"instanceId",2);wt([st.type("string")],Zn.prototype,"cardId",2);wt([st.type("string")],Zn.prototype,"name",2);wt([st.type("number")],Zn.prototype,"attack",2);wt([st.type("number")],Zn.prototype,"speed",2);wt([st.type("number")],Zn.prototype,"health",2);wt([st.type("number")],Zn.prototype,"currentHp",2);wt([st.type("number")],Zn.prototype,"brewCost",2);wt([st.type("string")],Zn.prototype,"description",2);wt([st.type("boolean")],Zn.prototype,"isLegend",2);let Nc=Zn;class fs extends st.Schema{constructor(){super(...arguments),this.sessionId="",this.username="Player",this.health=100,this.brews=5,this.shopRefreshCost=1,this.hand=new st.MapSchema,this.battlefield=new st.MapSchema,this.isReady=!1,this.shopOfferIds=new st.ArraySchema}}wt([st.type("string")],fs.prototype,"sessionId",2);wt([st.type("string")],fs.prototype,"username",2);wt([st.type("number")],fs.prototype,"health",2);wt([st.type("number")],fs.prototype,"brews",2);wt([st.type("number")],fs.prototype,"shopRefreshCost",2);wt([st.type({map:Nc})],fs.prototype,"hand",2);wt([st.type({map:Nc})],fs.prototype,"battlefield",2);wt([st.type("boolean")],fs.prototype,"isReady",2);wt([st.type(["string"])],fs.prototype,"shopOfferIds",2);class Qr extends st.Schema{constructor(){super(...arguments),this.players=new st.MapSchema,this.currentDay=0,this.currentPhase="Lobby",this.battleTimer=0}}wt([st.type({map:fs})],Qr.prototype,"players",2);wt([st.type("number")],Qr.prototype,"currentDay",2);wt([st.type("string")],Qr.prototype,"currentPhase",2);wt([st.type("number")],Qr.prototype,"battleTimer",2);class Tp extends cs.Scene{constructor(){super("Lobby"),this.playerTextObjects=new Map,this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerStateListeners=new Map,this.listenersAttached=!1}create(){if(this.scene.launch("background"),this.listenersAttached=!1,!S||!S.sessionId){console.error("Lobby Scene: Not connected to Colyseus room or no session ID!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Not connected to server.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{S==null||S.leave()}catch{}this.scene.start("MainMenu")});return}this.add.text(this.cameras.main.centerX,100,"Lobby",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,200,"Players in Lobby:",{fontFamily:"Arial",fontSize:32,color:"#dddddd",align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-100,"Connecting to lobby...",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.readyButton=this.add.text(this.cameras.main.centerX,this.cameras.main.height-150,"Ready Up",{fontFamily:"Arial Black",fontSize:40,color:"#888888",backgroundColor:"#333333",padding:{x:20,y:10},stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setVisible(!1).disableInteractive(),this.waitingText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-110,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.readyButton.on("pointerdown",()=>{var e;S&&((e=this.readyButton.input)!=null&&e.enabled)&&(console.log("Lobby: Sending playerReady message."),S.send("playerReady"))}),this.readyButton.on("pointerover",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled&&this.readyButton.setColor("#55ff55")}),this.readyButton.on("pointerout",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled?this.readyButton.setColor("#00ff00"):this.readyButton.setColor("#888888")}),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}attachMainListenersAndUI(){if(this.listenersAttached){console.log("Lobby: Main listeners and UI setup already performed, skipping.");return}if(!this.scene.isActive()){console.warn("Lobby: attachMainListenersAndUI called but scene is not active. Aborting.");return}if(!S||!S.state){console.warn("Lobby: attachMainListenersAndUI called but Colyseus room or state is not ready. Aborting.");return}console.log("Lobby: Attaching main Colyseus listeners and performing initial UI update."),this.attachMainListeners(),this.updateLobbyUI(),this.listenersAttached=!0}setupColyseusListeners(){if(!S){console.error("Lobby: setupColyseusListeners called but colyseusRoom is null.");return}console.log("Lobby: Setting up Colyseus general listeners."),S.state&&!this.listenersAttached&&(console.log("Lobby: State already available on setup. Scheduling attachMainListenersAndUI."),this.time.delayedCall(1,this.attachMainListenersAndUI,[],this)),S.onStateChange.once(e=>{if(console.log("Lobby: Initial state received via onStateChange.once."),!this.scene.isActive()){console.log("Lobby: Scene became inactive before onStateChange.once processing could complete.");return}this.attachMainListenersAndUI()})}attachMainListeners(){if(!S||!S.state){console.error("Lobby: attachMainListeners - colyseusRoom or state is null.");return}const e=jn.getStateCallbacks(S);this.phaseListenerUnsub&&this.phaseListenerUnsub(),this.phaseListenerUnsub=e(S.state).listen("currentPhase",(t,i)=>{this.scene.isActive()&&(console.log(`Lobby: Phase changed from ${i} to: ${t}`),t===$e.Shop?(this.statusText.setText("Starting Game!"),this.time.delayedCall(500,()=>{this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"))})):t===$e.Lobby?this.updateLobbyUI():t===$e.GameOver&&(this.statusText.setText("Game Over. Returning to Main Menu."),this.time.delayedCall(1500,()=>{if(this.scene.isActive()){try{S==null||S.leave()}catch{}this.scene.stop(),this.scene.start("MainMenu")}})))}),this.playerAddListenerUnsub&&this.playerAddListenerUnsub(),this.playerAddListenerUnsub=e(S.state.players).onAdd((t,i)=>{this.scene.isActive()&&(console.log(`Lobby: Player joined: ${t.username} (${i})`),this.addPlayerStateListener(t,i),this.updateLobbyUI())}),this.playerRemoveListenerUnsub&&this.playerRemoveListenerUnsub(),this.playerRemoveListenerUnsub=e(S.state.players).onRemove((t,i)=>{this.scene.isActive()&&(console.log(`Lobby: Player left: ${t.username} (${i})`),this.removePlayerStateListener(i),this.updateLobbyUI())}),S.state.players.forEach((t,i)=>{this.addPlayerStateListener(t,i)})}addPlayerStateListener(e,t){var l;if(!S)return;const i=jn.getStateCallbacks(S);(l=this.playerStateListeners.get(t))==null||l(),console.log(`Lobby: Adding 'isReady' listener for player ${t}`);const a=i(e).listen("isReady",(u,d)=>{console.log(`Lobby: isReady changed for player ${t}: ${d} -> ${u}`),this.scene.isActive()&&this.updateLobbyUI()});this.playerStateListeners.set(t,a)}removePlayerStateListener(e){const t=this.playerStateListeners.get(e);t&&(console.log(`Lobby: Removing 'isReady' listener for player ${e}`),t(),this.playerStateListeners.delete(e))}updateLobbyUI(){if(!this.scene.isActive()){console.warn("Lobby: updateLobbyUI called but scene is NOT ACTIVE. Aborting UI update.");return}if(!S){console.warn("Lobby: updateLobbyUI called but colyseusRoom is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Connection lost.");return}if(!S.state){console.warn("Lobby: updateLobbyUI called but colyseusRoom.state is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Game state unavailable.");return}Cs.size===0&&(console.log("Lobby: Card data not loaded yet. Loading..."),io().then(y=>{y?console.log("Lobby: Card data loaded successfully"):console.warn("Lobby: Failed to load card data")}));const e=S.state.players,t=S.sessionId,i=e.size,a=250,l=40;this.playerTextObjects.forEach(y=>y.destroy()),this.playerTextObjects.clear();let u=0,d=i>0,E=!1;const g=e.get(t);g&&(E=g.isReady),e.forEach((y,p)=>{const I=p===t,F=y.isReady?" [Ready]":" [Not Ready]",J=`${y.username||"Joining..."}${I?" (You)":""}${F}`,z=this.add.text(this.cameras.main.centerX,a+u*l,J,{fontFamily:"Arial",fontSize:24,color:y.isReady?"#00ff00":"#ffffff",align:"center"}).setOrigin(.5);this.playerTextObjects.set(p,z),u++,y.isReady||(d=!1)}),i<2?(this.statusText.setText("Waiting for opponent..."),this.readyButton.setVisible(!1).disableInteractive(),this.waitingText.setVisible(!1)):(this.readyButton.setVisible(!0),E?(this.statusText.setText("Waiting for opponent to ready up..."),this.readyButton.setText("Waiting...").setColor("#888888").disableInteractive(),this.waitingText.setText(d?"Starting game...":"Waiting for opponent...").setVisible(!0)):(this.statusText.setText("Lobby full. Ready up!"),this.readyButton.setText("Ready Up").setColor("#00ff00").setInteractive({useHandCursor:!0}),this.waitingText.setVisible(!1)),d&&(this.statusText.setText("Starting game..."),this.readyButton.setVisible(!1),this.waitingText.setVisible(!1)))}shutdown(){var e,t,i,a,l,u,d,E,g;console.log("Lobby scene shutting down."),this.listenersAttached=!1,(e=this.phaseListenerUnsub)==null||e.call(this),(t=this.playerAddListenerUnsub)==null||t.call(this),(i=this.playerRemoveListenerUnsub)==null||i.call(this),this.playerStateListeners.forEach(y=>y()),this.playerStateListeners.clear(),this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerTextObjects.forEach(y=>y.destroy()),this.playerTextObjects.clear(),(a=this.statusText)==null||a.destroy(),(l=this.readyButton)==null||l.destroy(),(u=this.waitingText)==null||u.destroy(),(d=this.readyButton)==null||d.off("pointerdown"),(E=this.readyButton)==null||E.off("pointerover"),(g=this.readyButton)==null||g.off("pointerout"),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const es=120,ci=168;class Ip extends cs.Scene{constructor(){super("Shop"),this.shopCardObjects=[],this.cardDataCache=new Map,this.shopOffersVisible=!0,this.phaseListenerUnsub=null,this.playerStateListenersUnsub=new Map,this.shopOfferListenersUnsub=[],this.listeners=[]}create(){var d;if(this.scene.launch("background"),(d=this.scene.get("BoardView"))!=null&&d.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!S||!S.state||!S.sessionId){console.error("Shop Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{S==null||S.leave(!0)}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,t=this.cameras.main.centerY,i=this.cameras.main.width,a=this.cameras.main.height;this.createShopCardsDisplay(e,t,i),this.setupDragAndDrop(),this.requestMissingCardData();const l=S.state.players.get(S.sessionId),u=(l==null?void 0:l.shopRefreshCost)||2;this.refreshButton=this.add.text(i-150,180,`Refresh: ${u} 🍺`,{fontFamily:"Arial",fontSize:18,color:"#FFFFFF",backgroundColor:"#4444AA",padding:{x:10,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.refreshButton.on("pointerdown",()=>{const E=S==null?void 0:S.state.players.get(S.sessionId);S&&E&&E.brews>=E.shopRefreshCost&&S.send("refreshShop")}),this.refreshButton.on("pointerover",()=>{var E;(E=this.refreshButton.input)!=null&&E.enabled&&this.refreshButton.setBackgroundColor("#6666CC")}),this.refreshButton.on("pointerout",()=>{var E;(E=this.refreshButton.input)!=null&&E.enabled&&this.refreshButton.setBackgroundColor("#4444AA")}),this.updateRefreshButtonState(),this.continueButton=this.add.text(e,a-50,"Continue",{fontFamily:"Arial Black",fontSize:40,color:"#00ff00",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.continueButton.on("pointerdown",()=>{const E=S==null?void 0:S.state.players.get(S.sessionId);S&&E&&!E.isReady&&S.state.currentPhase===$e.Shop&&S.send("playerReady")}),this.continueButton.on("pointerover",()=>{var E;(E=this.continueButton.input)!=null&&E.enabled&&this.continueButton.setColor("#55ff55")}),this.continueButton.on("pointerout",()=>{var E;(E=this.continueButton.input)!=null&&E.enabled?this.continueButton.setColor("#00ff00"):this.continueButton.setColor("#888888")}),this.waitingText=this.add.text(e,a-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(50,()=>this.createShopCardsDisplay(e,t,i)),this.toggleShopButton=this.add.text(i-100,t-250,"Toggle Shop",{fontFamily:"Arial",fontSize:16,color:"#FFFFFF",backgroundColor:"#555555",padding:{x:5,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.toggleShopButton.on("pointerdown",()=>{this.shopOffersVisible=!this.shopOffersVisible,this.shopOffersContainer.setVisible(this.shopOffersVisible),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop")}),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop"),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createShopCardsDisplay(e,t,i){var F;(F=this.shopOffersContainer)==null||F.destroy(),this.shopOffersContainer=this.add.container(0,0),this.shopOffersContainer.setVisible(this.shopOffersVisible),this.shopCardObjects.forEach(J=>J.destroy()),this.shopCardObjects=[];const a=S==null?void 0:S.state.players.get(S.sessionId),l=a==null?void 0:a.shopOfferIds;if(!l||l.length===0){console.log("Shop: No shop offers from server."),this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.setVisible(!1);return}const u=20,d=l.length>0?l.length:4,E=t,g=d*es+(d-1)*u,y=e-g/2+es/2,p=g+u*2,I=ci+u*2;this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.destroy(),this.shopOffersBackground=this.add.rectangle(e,E,p,I,51,.6),this.shopOffersContainer.add(this.shopOffersBackground),l.forEach((J,z)=>{const W=this.getCardDataFromServer(J);if(!W){console.warn(`Shop: Card data not found for ID: ${J}`);return}const he=y+z*(es+u),ne=this.add.container(he,E),ue=this.add.image(0,0,"cardFullTier1").setOrigin(.5).setDisplaySize(es,ci);ne.add(ue);const Pe=this.add.text(0,-20,W.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:es-20}}).setOrigin(.5,.5);ne.add(Pe);const We=this.add.text(-es/2+32,ci*.03,`${W.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(0,.5);ne.add(We);const Je=this.add.text(es/2-18,6,`${W.health}/${W.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,.5);ne.add(Je);const it=this.add.text(0,ci/2-50,`${W.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);ne.add(it);const mt=this.add.text(es/2-8,-ci/2+8,`${W.brewCost}B`,{fontFamily:"Arial",fontSize:14,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"right"}).setOrigin(1,0);ne.add(mt),ne.setSize(es,ci),ne.setSize(es,ci),ne.setInteractive({useHandCursor:!0}),ne.setData("cardId",W.id),ne.setData("cardData",W),this.input.setDraggable(ne),ne.off("pointerdown").on("pointerdown",at=>{var ot;(ot=ne.input)!=null&&ot.enabled&&ne.setData("isBeingDragged",!1)}),ne.off("pointerup").on("pointerup",at=>{var Fe;if(!((Fe=ne.input)!=null&&Fe.enabled)||!S||!S.sessionId)return;if(ne.getData("isBeingDragged")===!0){ne.setData("isBeingDragged",!1);return}const ot=S.state.players.get(S.sessionId);if(!ot)return;let rt=-1;for(let M=0;M<5;M++)if(!ot.hand.has(String(M))){rt=M;break}if(rt!==-1){const M=ne.getData("cardId"),re=ne.getData("cardData");M&&re&&ot.brews>=re.brewCost?(console.log(`Shop: Click-to-buy card ${M} (Cost: ${re.brewCost}) into hand slot ${rt}. Brews: ${ot.brews}`),S.send("buyCard",{cardId:M,handSlotIndex:rt})):re&&ot.brews<re.brewCost?console.log(`Shop: Not enough brews (${ot.brews}) to click-buy card ${M} (Cost: ${re.brewCost}).`):console.log(`Shop: Click-to-buy failed for card ${M}. CardData: ${!!re}`)}else console.log("Shop: Hand is full, cannot click-buy.")}),this.shopCardObjects.push(ne),this.shopOffersContainer.add(ne)})}requestMissingCardData(){if(!S||!S.state||!S.sessionId)return;const e=S.state.players.get(S.sessionId);if(!e)return;const t=e.shopOfferIds;if(t&&t.length>0){const i=[];t.forEach(a=>{Cs.has(a)||i.push(a)}),i.length>0&&(console.log("Requesting missing cards from server:",i),S.send("getCardsByIds",{cardIds:i}))}}getCardDataFromServer(e){if(Cs.has(e))return Cs.get(e);if(!S||!S.state)return;let t;return S.state.players.forEach(i=>{i.hand.forEach(a=>{a.cardId===e&&(t={id:a.cardId,name:a.name,attack:a.attack,speed:a.speed,health:a.health,brewCost:a.brewCost,description:a.description,isLegend:a.isLegend})}),i.battlefield.forEach(a=>{a.cardId===e&&(t={id:a.cardId,name:a.name,attack:a.attack,speed:a.speed,health:a.health,brewCost:a.brewCost,description:a.description,isLegend:a.isLegend})})}),t||(t={id:e,name:`Card ${e.split("_").pop()}`,attack:1,speed:1,health:1,brewCost:1,description:"Loading card details...",isLegend:!1},console.warn(`Shop: Card data not found for ID: ${e} in global cache or state`)),t}setupDragAndDrop(){this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),this.input.off("pointerdown"),this.input.off("pointerup"),this.shopCardObjects.forEach(e=>{e.off("pointerdown"),e.off("pointerup")}),this.input.on("dragstart",(e,t)=>{var i;!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)||(i=t.input)!=null&&i.enabled&&(this.children.bringToTop(t),t.setAlpha(.7),t.setData("startX",t.x),t.setData("startY",t.y),t.setData("isBeingDragged",!0))}),this.input.on("drag",(e,t,i,a)=>{var l;!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)||(l=t.input)!=null&&l.enabled&&t.getData("isBeingDragged")===!0&&(t.x=i,t.y=a)}),this.input.on("dragend",(e,t)=>{if(!S||!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)){t instanceof Phaser.GameObjects.Container&&t.setData("isBeingDragged",!1);return}t.setAlpha(1);let i=!1;if(t.getData("isBeingDragged")===!0){const a=t.x,l=t.y,u=this.scene.get("BoardView");for(let d=0;d<5;d++){const E=u==null?void 0:u.getSlotPixelPosition(!0,"hand",d);if(E){const g=new Phaser.Geom.Rectangle(E.x-50,E.y-70,100,140);if(Phaser.Geom.Rectangle.Contains(g,a,l)){const y=S.state.players.get(S.sessionId);if(y&&!y.hand.has(String(d))){const p=t.getData("cardId"),I=t.getData("cardData");p&&I&&y.brews>=I.brewCost?(S.send("buyCard",{cardId:p,handSlotIndex:d}),i=!0):console.log("Shop: Drag-to-buy failed (not enough brews or card data missing).")}break}}}i||t.active&&(t.x=t.getData("startX"),t.y=t.getData("startY"))}t.setData("isBeingDragged",!1)})}updateRefreshButtonState(){if(!S||!this.refreshButton||!this.refreshButton.active)return;const e=S.state.players.get(S.sessionId);if(!e)return;this.refreshButton.setText(`Refresh: ${e.shopRefreshCost} 🍺`),e.brews>=e.shopRefreshCost&&S.state.currentPhase===$e.Shop?(this.refreshButton.setColor("#FFFFFF"),this.refreshButton.setBackgroundColor("#4444AA"),this.refreshButton.setInteractive({useHandCursor:!0})):(this.refreshButton.setColor("#AAAAAA"),this.refreshButton.setBackgroundColor("#555555"),this.refreshButton.disableInteractive())}setupColyseusListeners(){if(!S||!S.sessionId)return;const e=jn.getStateCallbacks(S),t=S.sessionId;this.phaseListenerUnsub=e(S.state).listen("currentPhase",a=>{this.scene.isActive()&&(a===$e.Preparation?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Preparation")):a!==$e.Shop&&this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby")),this.updateWaitingStatus())}),S.state.players.forEach((a,l)=>{const u=e(a).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(l,u)}),this.listeners.push(e(S.state.players).onAdd((a,l)=>{var d;this.playerStateListenersUnsub.has(l)&&((d=this.playerStateListenersUnsub.get(l))==null||d());const u=e(a).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(l,u),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(e(S.state.players).onRemove((a,l)=>{var u;(u=this.playerStateListenersUnsub.get(l))==null||u(),this.playerStateListenersUnsub.delete(l),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(S.onMessage("cardsByIds",a=>{if(this.scene.isActive()){Object.entries(a).forEach(([E,g])=>{Cs.set(E,g)});const l=this.cameras.main.centerX,u=this.cameras.main.centerY,d=this.cameras.main.width;this.createShopCardsDisplay(l,u,d)}}));const i=S.state.players.get(t);if(i){const a=()=>{if(!this.scene.isActive())return;this.requestMissingCardData();const l=this.cameras.main.centerX,u=this.cameras.main.centerY,d=this.cameras.main.width;this.createShopCardsDisplay(l,u,d)};this.shopOfferListenersUnsub.push(e(i.shopOfferIds).onAdd(a)),this.shopOfferListenersUnsub.push(e(i.shopOfferIds).onRemove(a)),a(),this.listeners.push(e(i).listen("brews",()=>{this.scene.isActive()&&this.updateRefreshButtonState()})),this.listeners.push(e(i).listen("shopRefreshCost",()=>{this.scene.isActive()&&this.updateRefreshButtonState()}))}}cleanupListeners(){var e,t,i,a;console.log("Shop Scene: Cleaning up listeners."),(e=this.phaseListenerUnsub)==null||e.call(this),this.phaseListenerUnsub=null,this.playerStateListenersUnsub.forEach(l=>l()),this.playerStateListenersUnsub.clear(),this.shopOfferListenersUnsub.forEach(l=>l()),this.shopOfferListenersUnsub=[],this.listeners.forEach(l=>l()),this.listeners=[],this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(t=this.continueButton)==null||t.off("pointerdown"),(i=this.continueButton)==null||i.off("pointerover"),(a=this.continueButton)==null||a.off("pointerout")}updateWaitingStatus(){if(!S||!S.sessionId||!this.continueButton||!this.waitingText||!this.scene.isActive())return;const e=S.state.players.get(S.sessionId);if(!e)return;let t=!0;S.state.players.forEach(u=>{u.isReady||(t=!1)});const i=e.isReady,a=S.state.currentPhase===$e.Shop,l=!i&&a;this.continueButton.setInteractive(l),this.continueButton.input&&(this.continueButton.input.useHandCursor=l),this.continueButton.setColor(l?"#00ff00":"#888888"),i&&!t&&a?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.continueButton.setText("Waiting...")):a?(this.waitingText.setVisible(!1),this.continueButton.setText("Continue")):(this.waitingText.setText(`Waiting for ${S.state.currentPhase} phase...`).setVisible(!0),this.continueButton.setText("Continue")),this.shopCardObjects.forEach(u=>{u.input&&(u.input.enabled=l)})}shutdown(){var e,t,i,a,l,u,d,E;console.log("Shop scene shutting down."),this.cleanupListeners(),this.shopCardObjects.forEach(g=>g.destroy()),this.shopCardObjects=[],(e=this.continueButton)==null||e.destroy(),(t=this.waitingText)==null||t.destroy(),(i=this.refreshButton)==null||i.off("pointerdown"),(a=this.refreshButton)==null||a.off("pointerover"),(l=this.refreshButton)==null||l.off("pointerout"),(u=this.refreshButton)==null||u.destroy(),(d=this.toggleShopButton)==null||d.destroy(),(E=this.shopOffersContainer)==null||E.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class Sp extends cs.Scene{constructor(){super("Preparation"),this.playerStateListener=null,this.handListener=null,this.battlefieldListener=null,this.phaseListener=null,this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerChangeListeners=new Map,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.clientSideCardLayout=new Map}create(){var a;if(this.scene.launch("background"),(a=this.scene.get("BoardView"))!=null&&a.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!S||!S.state||!S.sessionId){console.error("Preparation Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>this.scene.start("MainMenu"));return}const e=this.cameras.main.centerX;this.cameras.main.centerY;const t=this.cameras.main.height;this.cameras.main.width;const i=S.state.players.get(S.sessionId);i?console.log("Preparation Create: Initial myPlayerState.hand contents:",JSON.stringify(Object.fromEntries(i.hand.entries()))):console.log("Preparation Create: myPlayerState not found initially."),this.add.text(e,80,"Preparation Phase",{fontFamily:"Arial Black",fontSize:48,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.startBattleButton=this.add.text(e,t-50,"Start Battle",{fontFamily:"Arial Black",fontSize:40,color:"#888888",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.startBattleButton.setColor("#888888").disableInteractive(),this.waitingText=this.add.text(e,t-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(100,this.updateStartButtonState,[],this),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!S||!S.sessionId)return;const e=S.sessionId,t=jn.getStateCallbacks(S),i=S.state.players.get(e);i?(this.playerStateListenerUnsub=t(i).onChange(()=>{this.scene.isActive()&&this.updateWaitingStatus()}),this.handAddUnsub=t(i.hand).onAdd((a,l)=>{console.log(`Preparation Scene: player.hand.onAdd triggered for key: ${l}, card: ${a==null?void 0:a.name}. Scene active: ${this.scene.isActive()}`),this.scene.isActive()&&this.updateStartButtonState()}),this.handRemoveUnsub=t(i.hand).onRemove((a,l)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldAddUnsub=t(i.battlefield).onAdd((a,l)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldRemoveUnsub=t(i.battlefield).onRemove((a,l)=>{this.scene.isActive()&&this.updateStartButtonState()})):console.error("Preparation Scene: My player state not found on init."),this.phaseListenerUnsub=t(S.state).listen("currentPhase",a=>{this.scene.isActive()&&(console.log(`Preparation Scene: Phase changed to ${a}`),a===$e.Battle?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Battle")):a!==$e.Preparation&&(console.warn(`Preparation Scene: Unexpected phase change to ${a}. Returning to Lobby.`),this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby"))),this.updateWaitingStatus())}),this.otherPlayerAddUnsub=t(S.state.players).onAdd((a,l)=>{if(this.scene.isActive()){if(l!==e){const u=t(a).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(l,u)}this.updateWaitingStatus()}}),this.otherPlayerRemoveUnsub=t(S.state.players).onRemove((a,l)=>{if(this.scene.isActive()){const u=this.otherPlayerChangeListeners.get(l);u==null||u(),this.otherPlayerChangeListeners.delete(l),this.updateWaitingStatus()}}),S.state.players.forEach((a,l)=>{if(l!==e){const u=t(a).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(l,u)}})}cleanupListeners(){var e,t,i,a,l,u,d,E,g,y,p,I,F;console.log("Preparation Scene: Cleaning up listeners."),(e=this.playerStateListenerUnsub)==null||e.call(this),(t=this.handAddUnsub)==null||t.call(this),(i=this.handRemoveUnsub)==null||i.call(this),(a=this.handChangeUnsub)==null||a.call(this),(l=this.battlefieldAddUnsub)==null||l.call(this),(u=this.battlefieldRemoveUnsub)==null||u.call(this),(d=this.battlefieldChangeUnsub)==null||d.call(this),(E=this.phaseListenerUnsub)==null||E.call(this),(g=this.otherPlayerAddUnsub)==null||g.call(this),(y=this.otherPlayerRemoveUnsub)==null||y.call(this),this.otherPlayerChangeListeners.forEach(J=>J()),this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.otherPlayerChangeListeners.clear(),this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(p=this.startBattleButton)==null||p.off("pointerdown"),(I=this.startBattleButton)==null||I.off("pointerover"),(F=this.startBattleButton)==null||F.off("pointerout")}makeLocalPlayerCardsDraggable(){if(!S||!S.sessionId||!this.scene.isActive()){console.warn("Preparation: Cannot make cards draggable, room/session/scene inactive.");return}const e=S.sessionId,t=S.state.players.get(e),i=this.scene.get("BoardView");if(!t||!i){console.warn("Preparation: Player state or BoardView not found for making cards draggable.");return}this.clientSideCardLayout.forEach(l=>{l.gameObject&&l.gameObject.input&&this.input.disable(l.gameObject)}),this.clientSideCardLayout.clear();const a=(l,u)=>{l.forEach((d,E)=>{const g=i.getCardGameObjectByInstanceId(d.instanceId);g?(g.setInteractive({useHandCursor:!0}),this.input.setDraggable(g),this.clientSideCardLayout.set(d.instanceId,{area:u,slotKey:E,gameObject:g})):console.warn(`Preparation: Could not find GameObject in BoardView for card instance ${d.instanceId}`)})};a(t.hand,"hand"),a(t.battlefield,"battlefield"),console.log("Preparation: Made local player cards draggable and initialized clientSideCardLayout.",this.clientSideCardLayout),this.updateStartButtonState()}updateWaitingStatus(){if(!S||!S.sessionId||!this.startBattleButton||!this.waitingText)return;const e=S.state.players.get(S.sessionId);if(!e)return;let t=!0;S.state.players.forEach(a=>{a.isReady||(t=!1)});const i=e.isReady;!i&&(S.state.currentPhase,$e.Preparation),this.updateStartButtonState(),i&&!t?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.startBattleButton.setText("Waiting..."),this.startBattleButton.disableInteractive().setColor("#888888")):(this.waitingText.setVisible(!1),this.startBattleButton.setText("Start Battle"),this.updateStartButtonState())}updateStartButtonState(){if(!this.startBattleButton||!this.startBattleButton.active){console.warn("updateStartButtonState called but button is null or inactive.");return}let e=0;const t=this.scene.get("BoardView");t&&t.scene.isActive()&&t.getLocalPlayerLayoutData().forEach(g=>{g.area==="battlefield"&&e++});const i=e>0,a=S==null?void 0:S.state.players.get(S==null?void 0:S.sessionId),l=(a==null?void 0:a.isReady)??!1,u=(S==null?void 0:S.state.currentPhase)===$e.Preparation;i&&!l&&u?(this.startBattleButton.setColor("#00ff00"),this.startBattleButton.setInteractive({useHandCursor:!0}),this.startBattleButton.off("pointerdown"),this.startBattleButton.once("pointerdown",this.confirmPreparation,this),this.startBattleButton.on("pointerover",()=>this.startBattleButton.setColor("#55ff55")),this.startBattleButton.on("pointerout",()=>this.startBattleButton.setColor("#00ff00"))):(this.waitingText&&!this.waitingText.visible&&this.startBattleButton.setColor("#888888"),this.startBattleButton.disableInteractive(),this.startBattleButton.off("pointerdown"),this.startBattleButton.off("pointerover"),this.startBattleButton.off("pointerout"))}confirmPreparation(){if(!S)return;console.log("Confirming preparation layout...");const e=this.scene.get("BoardView");if(!e||!e.scene.isActive()){console.error("Preparation: BoardView not available to get layout data.");return}const{handLayout:t,battlefieldLayout:i}=e.getCardLayouts();console.log("Sending preparation layout to server:",{handLayout:t,battlefieldLayout:i}),S.send("setPreparation",{handLayout:t,battlefieldLayout:i}),this.updateWaitingStatus()}shutdown(){var e,t;console.log("Preparation scene shutting down explicitly."),this.cleanupListeners(),(e=this.startBattleButton)==null||e.destroy(),(t=this.waitingText)==null||t.destroy(),this.clientSideCardLayout.clear(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class Ap extends cs.Scene{constructor(){super("Battle"),this.handCardDisplayObjects=new Map,this.battleOver=!1,this.phaseListenerUnsubscribe=null}create(){if(this.scene.launch("background"),this.battleOver=!1,!S||!S.state||!S.sessionId){console.error("Battle Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{S==null||S.leave()}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,t=this.cameras.main.centerY,i=this.cameras.main.height;this.cameras.main.width,this.resultText=this.add.text(e,t,"",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setAlpha(0),this.statusText=this.add.text(e,i-50,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5).setAlpha(0),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!S||!S.state)return;const e=jn.getStateCallbacks(S);this.phaseListenerUnsubscribe=e(S.state).listen("currentPhase",t=>{if(this.scene.isActive()){if(console.log(`Battle Scene: Phase changed to ${t}`),t===$e.BattleEnd)this.handleBattleEnd();else if(t===$e.Shop)this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"));else if(t===$e.GameOver)this.handleGameOver();else if(t!==$e.Battle&&(console.warn(`Battle Scene: Unexpected phase change to ${t}. Returning to Lobby.`),this.scene.isActive())){try{S==null||S.leave()}catch{}this.scene.stop(),this.scene.start("Lobby")}}})}cleanupListeners(){var e;console.log("Battle Scene: Cleaning up listeners."),(e=this.phaseListenerUnsubscribe)==null||e.call(this),this.phaseListenerUnsubscribe=null}handleBattleEnd(){var l,u;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Battle ended (server signal received). Displaying results.");const e=S==null?void 0:S.state.players.get(S.sessionId);let t;S==null||S.state.players.forEach((d,E)=>{E!==(S==null?void 0:S.sessionId)&&(t=d)});let i="Battle Ended",a="#ffffff";e&&t?e.health>t.health?(i="Victory!",a="#88ff88"):t.health>e.health?(i="Defeat!",a="#ff8888"):(i="Draw!",a="#ffff88"):(i="Battle Ended (Opponent Left?)",a="#ffffff"),(l=this.resultText)!=null&&l.active&&this.resultText.setText(i).setColor(a).setAlpha(1),(u=this.statusText)!=null&&u.active&&this.statusText.setText("Waiting for next round...").setAlpha(1)}handleGameOver(){var l,u;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Game Over signal received.");const e=S==null?void 0:S.state.players.get(S.sessionId);let t;S==null||S.state.players.forEach((d,E)=>{E!==(S==null?void 0:S.sessionId)&&(t=d)});let i="Game Over!",a="#ffffff";e&&t?e.health>t.health?(i="You Win!",a="#00ff00"):t.health>e.health?(i="You Lose!",a="#ff0000"):(i="Draw!",a="#ffff00"):e?(i="You Win! (Opponent Left)",a="#00ff00"):(i="Game Over (Error?)",a="#ff0000"),(l=this.resultText)!=null&&l.active&&this.resultText.setText(i).setColor(a).setAlpha(1),(u=this.statusText)!=null&&u.active&&this.statusText.setText("Click to return to Main Menu").setAlpha(1),this.input.once("pointerdown",()=>{try{S==null||S.leave()}catch{}this.scene.stop("Background"),this.scene.start("MainMenu")})}shutdown(){var e,t;console.log("Battle scene shutting down explicitly."),this.cleanupListeners(),this.handCardDisplayObjects.forEach(i=>{i==null||i.forEach(a=>a==null?void 0:a.destroy())}),this.handCardDisplayObjects.clear(),(e=this.resultText)==null||e.destroy(),(t=this.statusText)==null||t.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const Os=100,ua=140,Mn=120,Un=168,jo=15,da=580,ha=420,pa=100,ga=260;class Op extends cs.Scene{constructor(){super("BoardView"),this.playerVisuals=new Map,this.currentPhase=$e.Lobby,this.listeners=[],this.cardSchemaListeners=new Map}updateCardHpVisuals(e,t,i){if(!e||!e.active)return;const a=e.getData("hpTextObject"),l=e.getData("mainCardImage");if(a&&a.active){a.setText(`${t}/${i}`);const d=i>0?t/i:0;t<=0?a.setColor("#ff0000"):d<.3?a.setColor("#ff8888"):d<.6?a.setColor("#ffff88"):a.setColor("#88ff88")}const u=e.alpha<1;t<=0?u||(e.setAlpha(.6),l&&l.active&&typeof l.setTint=="function"&&l.setTint(7829367)):u&&(e.setAlpha(1),l&&l.active&&typeof l.clearTint=="function"?l.clearTint():l&&l.active&&console.warn("BoardView: updateCardHpVisuals - clearTint method not found on mainCardImage for card.",e.getData("instanceId"),l))}preload(){if(!this.textures.exists("cardBack")){const e=this.make.graphics({x:0,y:0});e.fillStyle(5253758),e.fillRect(0,0,Mn,Un),e.lineStyle(2,12428501),e.strokeRect(0,0,Mn,Un),e.generateTexture("cardBack",Mn,Un),e.destroy()}}create(){console.log("BoardView creating..."),this.createNavbar(),this.createSellZone(),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createNavbar(){const e=this.cameras.main.centerX,t=this.cameras.main.width,i=30;this.add.rectangle(e,i,t,50,0,.7).setDepth(1e3);const l={fontFamily:"Arial",fontSize:16,color:"#ffffff",align:"left"};this.playerHealthText=this.add.text(t*.05,i,"You: -- HP",{...l,color:"#00ff00"}).setOrigin(0,.5).setDepth(1001),this.playerBrewsText=this.add.text(t*.95,i,"Brews: --",{...l,color:"#ffff00",align:"right"}).setOrigin(1,.5).setDepth(1001),this.opponentUsernameText=this.add.text(t*.25,i-10,"Opponent: --",{...l,fontSize:14}).setOrigin(0,.5).setDepth(1001),this.opponentHealthText=this.add.text(t*.25,i+10,"-- HP",{...l,color:"#ff0000"}).setOrigin(0,.5).setDepth(1001),this.dayPhaseText=this.add.text(e,i,"Day -- - Phase --",{...l,fontSize:20,align:"center"}).setOrigin(.5).setDepth(1001)}showAttackAnimation(e){const t=this.getCardGameObjectByInstanceId(e);if(t&&t.active){const i=t.scaleX,a=t.scaleY;this.tweens.add({targets:t,scaleX:i*1.15,scaleY:a*1.15,duration:100,yoyo:!0,ease:"Sine.easeInOut"})}}showDamageNumber(e,t){const i=this.getCardGameObjectByInstanceId(e);if(i&&i.active&&t>0){const a=this.add.text(i.x+Phaser.Math.Between(-10,10),i.y-Un/2-10,`-${t}`,{fontFamily:"Arial Black",fontSize:24,color:"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(i.depth+1);this.tweens.add({targets:a,y:a.y-50,alpha:0,duration:1e3,ease:"Power1",onComplete:()=>{a.destroy()}})}}drawAttackLine(e,t){const i=this.getCardGameObjectByInstanceId(e),a=this.getCardGameObjectByInstanceId(t);if(i&&i.active&&a&&a.active){const l=this.add.line(0,0,i.x,i.y,a.x,a.y,16724787,.7).setOrigin(0,0).setLineWidth(2).setDepth(i.depth);this.time.delayedCall(250,()=>{l.destroy()})}}setupColyseusListeners(){if(!S||!S.state){console.error("BoardView: Colyseus room or state not available!"),this.time.delayedCall(100,this.setupColyseusListeners,[],this);return}const e=jn.getStateCallbacks(S);this.listeners.push(e(S.state).listen("currentDay",()=>this.updateNavbarText())),this.listeners.push(e(S.state).listen("currentPhase",(t,i)=>{this.currentPhase=t,this.updateNavbarText(),t===$e.Shop||t===$e.Preparation?this.sellZone.setVisible(!0):this.sellZone.setVisible(!1);const a=(l,u,d,E)=>{if(!l.active)return;const g=l.getData("cooldownBarBg"),y=l.getData("cooldownBarFill");if(t===$e.Battle){if(l.getData("area")==="battlefield")if(u)if(g&&y){g.setVisible(!0),y.setVisible(!0);const I=l.getData("cooldownBarBaseWidth"),F=typeof I=="number"?I:Os-10;y.setSize(F,6);const J=(u.speed>0?u.speed:1.5)*1e3;l.setData("maxAttackCooldown",J),l.setData("attackCooldownTimer",J)}else console.warn(`BoardView: Battle Phase - Card ${u.instanceId} (Owner: ${d}, Slot: ${E}) missing cooldown bar elements in data. Bg: ${!!g}, Fill: ${!!y}`);else console.warn(`BoardView: Battle Phase - Battlefield card container (Owner: ${d}, Slot: ${E}) has no cardSchema. No cooldown bar shown.`)}else g&&g.setVisible(!1),y&&y.setVisible(!1);if((i===$e.Battle||i===$e.BattleEnd)&&t!==$e.Battle&&t!==$e.BattleEnd&&u&&u.currentHp>0){l.setAlpha(1);const p=l.getData("backgroundRectangle");p&&p.active&&typeof p.clearTint=="function"&&p.clearTint()}};this.playerVisuals.forEach((l,u)=>{l.battlefield.forEach((d,E)=>{var y;const g=(y=S==null?void 0:S.state.players.get(u))==null?void 0:y.battlefield.get(E);a(d,g,u,E)}),l.hand.forEach((d,E)=>{var y;const g=(y=S==null?void 0:S.state.players.get(u))==null?void 0:y.hand.get(E);if((i===$e.Battle||i===$e.BattleEnd)&&t!==$e.Battle&&t!==$e.BattleEnd&&g&&g.currentHp>0){d.setAlpha(1);const p=d.getData("backgroundRectangle");p&&p.active&&typeof p.clearTint=="function"&&p.clearTint()}})})})),this.listeners.push(e(S.state.players).onAdd((t,i)=>{console.log(`BoardView: Player added ${i}`),this.addPlayerVisuals(i),this.addPlayerListeners(t,i),this.updatePlayerSlots(t,i),this.updateNavbarText()})),this.listeners.push(e(S.state.players).onRemove((t,i)=>{console.log(`BoardView: Player removed ${i}`),this.removePlayerVisuals(i),this.updateNavbarText()})),this.listeners.push(S.onMessage("battleAttackEvent",t=>{if(this.currentPhase!==$e.Battle||!this.scene.isActive())return;console.log("BoardView: Received battleAttackEvent",t);const i=this.getCardGameObjectByInstanceId(t.attackerInstanceId),a=this.getCardGameObjectByInstanceId(t.targetInstanceId);if(i&&i.active&&a&&a.active){this.drawAttackLine(t.attackerInstanceId,t.targetInstanceId),this.showAttackAnimation(t.attackerInstanceId),this.showDamageNumber(t.targetInstanceId,t.damageDealt);const l=i.getData("maxAttackCooldown");if(l>0){i.setData("attackCooldownTimer",l);const g=i.getData("cooldownBarFill"),y=i.getData("cooldownBarBaseWidth")||Os-10;g&&g.setSize(y,6)}const u=a.getData("ownerSessionId"),d=a.getData("slotKey"),E=a.getData("area");if(u===t.targetPlayerId&&E==="battlefield"&&d){const g=S.state.players.get(t.targetPlayerId),y=g==null?void 0:g.battlefield.get(d);if(y&&y.instanceId===t.targetInstanceId){const p=Math.max(0,y.currentHp-t.damageDealt);this.updateCardHpVisuals(a,p,y.health)}else console.warn(`BoardView: battleAttackEvent - Target card schema not found or instanceId mismatch for player ${t.targetPlayerId}, slot ${d}, instance ${t.targetInstanceId}.`)}else console.warn(`BoardView: battleAttackEvent - Target card container data inconsistent or not on battlefield. Owner: ${u}, Area: ${E}, Slot: ${d}`)}else console.warn("BoardView: Attacker or target not found/active for battleAttackEvent",t)})),S.state.players.forEach((t,i)=>{this.addPlayerVisuals(i),this.addPlayerListeners(t,i),this.updatePlayerSlots(t,i)}),this.updateNavbarText()}update(e,t){!this.scene.isActive()||this.currentPhase!==$e.Battle||!S||!S.state||this.playerVisuals.forEach(i=>{i.battlefield.forEach(a=>{if(!a.active)return;const l=a.getData("maxAttackCooldown");let u=a.getData("attackCooldownTimer");const d=a.getData("cooldownBarBaseWidth")||Os-10;if(l>0){u-=t,u<0&&(u=0),a.setData("attackCooldownTimer",u);const E=a.getData("cooldownBarFill");if(E&&E.visible){const g=u/l;E.setSize(d*Math.max(0,g),6)}}})})}addPlayerListeners(e,t){const i=jn.getStateCallbacks(S),a=[];a.push(i(e).listen("health",()=>this.updateNavbarText())),a.push(i(e).listen("brews",()=>this.updateNavbarText())),a.push(i(e).listen("username",()=>this.updateNavbarText())),a.push(i(e.hand).onAdd((l,u)=>{this.updateCardVisual(t,"hand",u,l),this.addCardSchemaListeners(l)})),a.push(i(e.hand).onRemove((l,u)=>{this.removeCardVisual(t,"hand",u)})),e.hand.forEach((l,u)=>{this.addCardSchemaListeners(l)}),a.push(i(e.battlefield).onAdd((l,u)=>{this.updateCardVisual(t,"battlefield",u,l),this.addCardSchemaListeners(l)})),a.push(i(e.battlefield).onRemove((l,u)=>{this.removeCardVisual(t,"battlefield",u)})),e.battlefield.forEach((l,u)=>{this.addCardSchemaListeners(l)}),this.listeners.push(...a)}addCardSchemaListeners(e){if(!e||!e.instanceId)return;const t=jn.getStateCallbacks(S),i=this.cardSchemaListeners.get(e.instanceId);i&&(i.forEach(u=>u()),this.cardSchemaListeners.delete(e.instanceId));const a=[],l=t(e).listen("currentHp",(u,d)=>{const E=this.getCardGameObjectByInstanceId(e.instanceId);E&&this.updateCardHpVisuals(E,u,e.health)});a.push(l),a.length>0&&this.cardSchemaListeners.set(e.instanceId,a)}updatePlayerSlots(e,t){e.hand.forEach((i,a)=>this.updateCardVisual(t,"hand",a,i)),e.battlefield.forEach((i,a)=>this.updateCardVisual(t,"battlefield",a,i))}addPlayerVisuals(e){if(!this.playerVisuals.has(e)){const t=[],i=[],a=e===(S==null?void 0:S.sessionId);for(let l=0;l<5;l++){const u=this.calculateSlotX(l,"hand"),d=a?da:pa,E=this.add.rectangle(u,d,Mn,Un).setStrokeStyle(2,a?11184810:7829367,.8).setDepth(0);t.push(E);const g=this.calculateSlotX(l,"battlefield"),y=a?ha:ga,p=this.add.rectangle(g,y,Os,ua).setStrokeStyle(2,a?16777215:11184810,1).setDepth(0);i.push(p)}this.playerVisuals.set(e,{hand:new Map,battlefield:new Map,handSlotOutlines:t,battlefieldSlotOutlines:i})}}removePlayerVisuals(e){const t=this.playerVisuals.get(e);t&&(t.hand.forEach(i=>i.destroy()),t.battlefield.forEach(i=>i.destroy()),t.handSlotOutlines.forEach(i=>i.destroy()),t.battlefieldSlotOutlines.forEach(i=>i.destroy())),this.playerVisuals.delete(e)}updateCardVisual(e,t,i,a){if(!this.scene.isActive()||!S||!S.state)return;this.removeCardVisual(e,t,i);const l=this.playerVisuals.get(e);if(!l)return;const u=e===(S==null?void 0:S.sessionId),d=this.calculateSlotX(parseInt(i,10),t);let E,g=!1;t==="hand"?(E=u?da:pa,u||(g=!0)):E=u?ha:ga;const y=this.createCardGameObject(a,d,E,g,u,t);if(y.setData("instanceId",a.instanceId),y.setData("slotKey",i),y.setData("area",t),y.setData("ownerSessionId",e),y.setDepth(1),a.currentHp<=0){y.setAlpha(.6);const p=y.getData("mainCardImage");p&&p.active&&typeof p.setTint=="function"&&p.setTint(7829367);const I=y.getData("hpTextObject");I&&I.active&&I.setColor("#ff0000")}t==="hand"?l.hand.set(i,y):l.battlefield.set(i,y),this.addCardSchemaListeners(a),u&&this.makeCardInteractive(y)}removeCardVisual(e,t,i){const a=this.playerVisuals.get(e);if(a){const l=t==="hand"?a.hand:a.battlefield,u=l.get(i);if(u){const d=u.getData("instanceId");if(d){const E=this.cardSchemaListeners.get(d);E&&(console.log(`BoardView: Cleaning up ${E.length} listeners for card instance ${d} during removeCardVisual.`),E.forEach(g=>{if(typeof g=="function")try{g()}catch(y){console.warn(`BoardView: Error unsubscribing card listener for ${d}`,y)}}),this.cardSchemaListeners.delete(d))}u.input&&u.input.enabled&&this.input.disable(u),this.time.delayedCall(1,()=>{u.active&&u.destroy()}),l.delete(i)}}}calculateSlotX(e,t){const i=t==="hand"?Mn:Os,a=5*i+4*jo;return(this.cameras.main.width-a)/2+i/2+e*(i+jo)}createCardGameObject(e,t,i,a,l,u){const d=this.add.container(t,i),E=u==="hand"?Mn:Os,g=u==="hand"?Un:ua;if(d.setData("displayCardWidth",E),d.setData("displayCardHeight",g),a){const I=this.add.image(0,0,"cardBack").setOrigin(.5).setDisplaySize(Mn,Un);return d.add(I),d}const y=u==="hand"?"cardFullTier1":"cardMinionTier1",p=this.add.image(0,0,y).setOrigin(.5);if(p.setDisplaySize(E,g),d.add(p),d.setData("mainCardImage",p),u==="hand"){const I=this.add.text(0,-20,e.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:E-20}}).setOrigin(.5,.5);d.add(I);const F=this.add.text(-Os/2+32,ua*.03,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);d.add(F);const J=this.add.text(Os/2-18,6,`${e.currentHp}  ${e.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(1,.5);d.add(J),d.setData("hpTextObject",J);const z=this.add.text(0,g/2-50,`${e.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);d.add(z)}else{const I=this.add.text(0,-g/2+5,e.name,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:E}}).setOrigin(.5,0);d.add(I);const F=this.add.text(-E/2+32,32,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);d.add(F);const J=this.add.text(0,43,`${e.speed}`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(1,0);d.add(J);const z=this.add.text(E/2-10,g/2-30,`${e.currentHp}/${e.health}`,{fontFamily:"Arial",fontSize:14,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,1);d.add(z),d.setData("hpTextObject",z);const W=g/2-15,he=E-10,ne=this.add.rectangle(0,W,he,6,0,.5).setVisible(!1),ue=this.add.rectangle(-he/2,W,he,6,4521796).setOrigin(0,.5).setVisible(!1);d.add(ne),d.add(ue),d.setData("cooldownBarBg",ne),d.setData("cooldownBarFill",ue),d.setData("attackCooldownTimer",0),d.setData("maxAttackCooldown",0),d.setData("cooldownBarBaseWidth",he)}return d}getCardGameObjectByInstanceId(e){for(const[t,i]of this.playerVisuals){for(const[a,l]of i.hand)if(l.getData("instanceId")===e)return l;for(const[a,l]of i.battlefield)if(l.getData("instanceId")===e)return l}}getSlotPixelPosition(e,t,i){if(i<0||i>4)return;const a=this.calculateSlotX(i,t);let l;return t==="hand"?l=e?da:pa:l=e?ha:ga,{x:a,y:l}}makeCardInteractive(e){const t=e.getData("displayCardWidth"),i=e.getData("displayCardHeight");if(!t||!i){console.warn("BoardView: makeCardInteractive - displayCardWidth/Height not found on container.",e.getData("instanceId"));return}const a=new Phaser.Geom.Rectangle(-t/2,-i/2,t,i);e.setInteractive({hitArea:a,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}),this.input.setDraggable(e),e.input&&(e.input.enabled=!0),e.on("dragstart",l=>{this.currentPhase!==$e.Shop&&this.currentPhase!==$e.Preparation||!e.input||!e.input.enabled||(this.children.bringToTop(e),e.setAlpha(.7),e.setData("isDragging",!0),e.setData("originalX",e.x),e.setData("originalY",e.y),e.setData("originalAreaOnDragStart",e.getData("area")),e.setData("originalSlotKeyOnDragStart",e.getData("slotKey")))}),e.on("drag",(l,u,d)=>{if(e.getData("isDragging"))if(e.x=u,e.y=d,(this.currentPhase===$e.Shop||this.currentPhase===$e.Preparation)&&this.sellZone.visible)if(this.isDroppedOnSellZone(e)){const E=e.getData("instanceId"),g=e.getData("originalAreaOnDragStart"),y=e.getData("originalSlotKeyOnDragStart"),p=e.getData("ownerSessionId"),I=S==null?void 0:S.state.players.get(p);let F;if(I&&(g==="hand"?F=I.hand.get(y):F=I.battlefield.get(y)),F&&F.instanceId===E){const J=Math.max(1,Math.floor(F.brewCost/2));this.brewGainText.setText(`Sell: +${J} 🍺`),this.brewGainText.setAlpha(1)}else this.brewGainText.setAlpha(0)}else this.brewGainText.setAlpha(0);else this.brewGainText.setAlpha(0)}),e.on("dragend",l=>{if(!e.getData("isDragging"))return;e.setAlpha(1),e.setData("isDragging",!1),this.brewGainText.setAlpha(0);const u=e.getData("instanceId"),d=e.getData("originalAreaOnDragStart"),E=e.getData("originalSlotKeyOnDragStart"),g=e.getData("ownerSessionId");if((this.currentPhase===$e.Shop||this.currentPhase===$e.Preparation)&&this.sellZone.visible&&this.isDroppedOnSellZone(e)){const F=S==null?void 0:S.state.players.get(S==null?void 0:S.sessionId);let J;if(d==="hand"&&(F!=null&&F.hand.has(E))?J=F.hand.get(E):d==="battlefield"&&(F!=null&&F.battlefield.has(E))&&(J=F.battlefield.get(E)),J&&J.instanceId===u){const z=Math.max(1,Math.floor(J.brewCost/2));S==null||S.send("sellCard",{instanceId:u,area:d,slotKey:E}),this.showBrewGain(z);return}}let y=!1,p,I;for(let F=0;F<5;F++){const J=String(F),z=this.getSlotPixelPosition(!0,"hand",F);if(z){const W=new Phaser.Geom.Rectangle(z.x-Mn/2,z.y-Un/2,Mn,Un);if(Phaser.Geom.Rectangle.Contains(W,e.x,e.y)){if(this.isSlotEmpty(g,"hand",J,u)){let he=!1;if(this.currentPhase===$e.Shop?d==="hand"&&(he=!0):this.currentPhase===$e.Preparation&&d==="hand"&&(he=!0),he){e.x=z.x,e.y=z.y;const ne=d!=="hand";if(e.setData("area","hand"),e.setData("slotKey",J),this.updateVisualMaps(g,d,E,"hand",J,e),ne){const ue=S==null?void 0:S.state.players.get(g),Pe=(ue==null?void 0:ue.hand.get(J))||(d==="battlefield"?ue==null?void 0:ue.battlefield.get(E):void 0)||(d==="hand"?ue==null?void 0:ue.hand.get(E):void 0);Pe&&Pe.instanceId===u&&this.updateCardVisual(g,"hand",J,Pe)}y=!0,p="hand",I=J,this.currentPhase===$e.Shop&&(d!=="hand"||E!==J)&&(S==null||S.send("moveCardInHand",{instanceId:u,fromSlotKey:E,toSlotKey:J}))}}if(y)break}}}if(!y&&this.currentPhase===$e.Preparation)for(let F=0;F<5;F++){const J=String(F),z=this.getSlotPixelPosition(!0,"battlefield",F);if(z){const W=new Phaser.Geom.Rectangle(z.x-Mn/2,z.y-Un/2,Mn,Un);if(Phaser.Geom.Rectangle.Contains(W,e.x,e.y)){if(this.isSlotEmpty(g,"battlefield",J,u)){e.x=z.x,e.y=z.y;const he=d!=="battlefield";if(e.setData("area","battlefield"),e.setData("slotKey",J),this.updateVisualMaps(g,d,E,"battlefield",J,e),he){const ne=S==null?void 0:S.state.players.get(g),ue=(ne==null?void 0:ne.battlefield.get(J))||(ne==null?void 0:ne.hand.get(E));ue&&ue.instanceId===u&&this.updateCardVisual(g,"battlefield",J,ue)}y=!0,p="battlefield",I=J}break}}}if(y?this.currentPhase===$e.Preparation&&p&&I&&(d!==p||E!==I)&&(S==null||S.send("updatePrepLayout",{instanceId:u,newArea:p,newSlotKey:I})):(e.x=e.getData("originalX"),e.y=e.getData("originalY"),e.setData("area",d),e.setData("slotKey",E)),this.currentPhase===$e.Preparation){const F=this.scene.get("Preparation");F&&F.scene.isActive()&&F.updateStartButtonState&&F.updateStartButtonState()}})}getCardLayouts(){const e={},t={};if(!S||!S.sessionId){for(let l=0;l<5;l++)e[String(l)]=null,t[String(l)]=null;return{handLayout:e,battlefieldLayout:t}}const i=S.sessionId,a=this.playerVisuals.get(i);for(let l=0;l<5;l++){const u=String(l);if(a&&a.hand.has(u)){const d=a.hand.get(u);e[u]=(d==null?void 0:d.getData("instanceId"))||null}else e[u]=null;if(a&&a.battlefield.has(u)){const d=a.battlefield.get(u);t[u]=(d==null?void 0:d.getData("instanceId"))||null}else t[u]=null}return{handLayout:e,battlefieldLayout:t}}isSlotEmpty(e,t,i,a){const l=this.playerVisuals.get(e);if(!l)return!1;const d=(t==="hand"?l.hand:l.battlefield).get(i);return d?d.getData("instanceId")===a:!0}isDroppedOnSellZone(e){return this.sellZone.visible?new Phaser.Geom.Rectangle(this.sellZone.x-this.sellZoneRect.width/2-20,this.sellZone.y-this.sellZoneRect.height/2-20,this.sellZoneRect.width+40,this.sellZoneRect.height+40).contains(e.x,e.y):!1}showBrewGain(e){this.brewGainText.setText(`+${e} 🍺`),this.brewGainText.setAlpha(1),this.brewGainText.y=-50,this.brewGainText.x=0,this.tweens.add({targets:this.brewGainText,scaleX:1.5,scaleY:1.5,duration:100,yoyo:!0,ease:"Cubic.easeOut",onComplete:()=>{this.tweens.add({targets:this.brewGainText,y:this.brewGainText.y-80,alpha:0,duration:1500,ease:"Power2"})}}),this.tweens.add({targets:this.sellZoneRect,fillAlpha:.7,duration:200,yoyo:!0,repeat:1,ease:"Cubic.easeOut"})}updateVisualMaps(e,t,i,a,l,u){const d=this.playerVisuals.get(e);if(!d)return;const E=t==="hand"?d.hand:d.battlefield;E.get(i)===u&&E.delete(i),(a==="hand"?d.hand:d.battlefield).set(l,u)}getPlayerCardGameObjects(e){const t=[],i=this.playerVisuals.get(e);return i&&(i.hand.forEach(a=>t.push(a)),i.battlefield.forEach(a=>t.push(a))),t}getLocalPlayerLayoutData(){const e=[];if(!S||!S.sessionId)return e;const t=S.sessionId,i=this.playerVisuals.get(t);return i&&(i.hand.forEach((a,l)=>{e.push({instanceId:a.getData("instanceId"),area:"hand",slotKey:a.getData("slotKey")})}),i.battlefield.forEach((a,l)=>{e.push({instanceId:a.getData("instanceId"),area:"battlefield",slotKey:a.getData("slotKey")})})),e}createSellZone(){this.sellZone=this.add.container(this.cameras.main.width-80,this.cameras.main.height/2),this.sellZone.setDepth(1e3),this.sellZoneRect=this.add.rectangle(0,0,120,160,16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1),this.sellZone.add(this.sellZoneRect),this.sellZoneText=this.add.text(0,0,"SELL",{fontFamily:"Arial Black",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.sellZone.add(this.sellZoneText),this.brewGainText=this.add.text(0,-50,"",{fontFamily:"Arial Black",fontSize:20,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setAlpha(0),this.sellZone.add(this.brewGainText);const e=this.add.text(0,50,`Drag cards here
to sell`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5);this.sellZone.add(e),this.input.on("dragenter",(t,i,a)=>{i instanceof Phaser.GameObjects.Container&&this.sellZone.visible&&this.isDroppedOnSellZone(i)&&(this.sellZoneRect.setFillStyle(16711680,.5),this.sellZoneRect.setStrokeStyle(3,16733525,1))}),this.input.on("dragleave",(t,i,a)=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.input.on("drop",()=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.sellZone.setVisible(!1)}updateNavbarText(){if(!S||!S.state||!this.playerHealthText||!this.playerHealthText.active)return;const e=S.sessionId,t=S.state.players.get(e);let i,a="Opponent: --";S.state.players.forEach((d,E)=>{E!==e&&(i=d,a=`Opponent: ${d.username||"Connecting..."}`)}),this.playerHealthText.setText(`You: ${(t==null?void 0:t.health)??"--"} HP`),this.playerBrewsText.setText(`Brews: ${(t==null?void 0:t.brews)??"--"}`),this.opponentUsernameText.setText(a),this.opponentHealthText.setText(`${(i==null?void 0:i.health)??"--"} HP`);const l=S.state.currentDay,u=S.state.currentPhase;this.dayPhaseText.setText(`Day ${l} - ${u}`)}cleanupListeners(){var e,t,i,a,l,u,d;console.log("BoardView: Cleaning up listeners."),this.listeners.forEach(E=>{if(typeof E=="function")try{E()}catch(g){console.warn("BoardView: Error cleaning up listener:",g)}}),this.listeners=[],this.cardSchemaListeners.forEach((E,g)=>{console.log(`BoardView cleanup: Cleaning up ${E.length} listeners for card instance ${g}`),E.forEach(y=>{if(typeof y=="function")try{y()}catch(p){console.warn(`BoardView: Error unsubscribing card listener for ${g}`,p)}})}),this.cardSchemaListeners.clear(),this.playerVisuals.forEach(E=>{E.hand.forEach(g=>g.destroy()),E.battlefield.forEach(g=>g.destroy())}),this.playerVisuals.clear(),(e=this.playerHealthText)==null||e.destroy(),(t=this.opponentHealthText)==null||t.destroy(),(i=this.playerBrewsText)==null||i.destroy(),(a=this.dayPhaseText)==null||a.destroy(),(l=this.opponentUsernameText)==null||l.destroy(),(u=this.sellZone)==null||u.destroy(),(d=this.brewGainText)==null||d.destroy(),this.input.off("dragenter"),this.input.off("dragleave"),this.input.off("drop")}shutdown(){console.log("BoardView shutting down..."),this.cleanupListeners(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}(async()=>(await hp(),new ma({type:Phaser.AUTO,parent:"gameParent",width:1280,height:720,backgroundColor:"#000000",roundPixels:!1,pixelArt:!1,scene:[mp,Ep,bp,Tp,Ip,Sp,Ap,Op,yp,vp]})))();
