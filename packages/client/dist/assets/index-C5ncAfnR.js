import{P as ti,c as Co,g as Ia,p as Bn}from"./phaser-B90dPXin.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const ze=class ze{constructor(e){const t=e.width,s=e.height;ze.width=t,ze.height=s,ze.center=new ti.Math.Vector2(t/2,s/2),ze.isLandscape=ze.width>ze.height,ze.gameZone=new ti.Geom.Rectangle(0,0,t,s),ze.uiZone=new ti.Geom.Rectangle(0,0,t,s),ze.cameras=new Set,e.callbacks={postBoot:()=>this.gameBootHandler()},this.game=new ti.Game(e)}gameBootHandler(){ze.scaleManager=this.game.scale,ze.scaleManager.on("resize",()=>this.onResizeHandler()),this.canvas=this.game.canvas,this.parent=this.canvas.parentElement,this.guide=document.getElementById("guide"),window.setTimeout(()=>this.onResizeHandler(),16)}onResizeHandler(){const e=this.parent.getBoundingClientRect(),t=this.canvas.getBoundingClientRect(),s=this.guide.getBoundingClientRect(),r=e.width/ze.width,i=e.height/ze.height,l=Math.max(r,i),c=e.width-r,g=e.height-i,f=c*(1/l),h=g*(1/l),p=ze.width/2-f/2,T=ze.width/2+f/2,C=ze.height/2-h/2,Z=ze.height/2+h/2;ze.uiZone.left=p,ze.uiZone.right=T,ze.uiZone.top=C,ze.uiZone.bottom=Z;const V=s.width/t.width,j=s.height/t.height,me=Math.min(V,j);ze.scaleFactor=me,ze.cameras.forEach(ne=>{ne.zoom=me}),this.game.events.emit(ze.RESIZE)}static addCamera(e){this.cameras.add(e),e.zoom=ze.scaleFactor}static removeCamera(e){this.cameras.delete(e)}static getX(e){if(typeof e=="number")return e;const t=this.scaleManager.width,s=parseInt(e,10);return t*(s/100)}static getY(e){if(typeof e=="number")return e;const t=this.scaleManager.height,s=parseInt(e,10);return t*(s/100)}static getUIX(e){if(typeof e=="number")return e;const t=ze.uiZone.width,s=parseInt(e,10);return t*(s/100)}static getUIY(e){if(typeof e=="number")return e;const t=ze.uiZone.height,s=parseInt(e,10);return t*(s/100)}};ze.scaleFactor=1,ze.scaleFactor2=1,ze.RESIZE="scaleflowresize";let fa=ze;var ni=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Aa(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Mo={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function r(g,f,h){this.fn=g,this.context=f,this.once=h||!1}function i(g,f,h,p,T){if(typeof h!="function")throw new TypeError("The listener must be a function");var C=new r(h,p||g,T),Z=t?t+f:f;return g._events[Z]?g._events[Z].fn?g._events[Z]=[g._events[Z],C]:g._events[Z].push(C):(g._events[Z]=C,g._eventsCount++),g}function l(g,f){--g._eventsCount===0?g._events=new s:delete g._events[f]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var f=[],h,p;if(this._eventsCount===0)return f;for(p in h=this._events)e.call(h,p)&&f.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(h)):f},c.prototype.listeners=function(f){var h=t?t+f:f,p=this._events[h];if(!p)return[];if(p.fn)return[p.fn];for(var T=0,C=p.length,Z=new Array(C);T<C;T++)Z[T]=p[T].fn;return Z},c.prototype.listenerCount=function(f){var h=t?t+f:f,p=this._events[h];return p?p.fn?1:p.length:0},c.prototype.emit=function(f,h,p,T,C,Z){var V=t?t+f:f;if(!this._events[V])return!1;var j=this._events[V],me=arguments.length,ne,de;if(j.fn){switch(j.once&&this.removeListener(f,j.fn,void 0,!0),me){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,h),!0;case 3:return j.fn.call(j.context,h,p),!0;case 4:return j.fn.call(j.context,h,p,T),!0;case 5:return j.fn.call(j.context,h,p,T,C),!0;case 6:return j.fn.call(j.context,h,p,T,C,Z),!0}for(de=1,ne=new Array(me-1);de<me;de++)ne[de-1]=arguments[de];j.fn.apply(j.context,ne)}else{var Ae=j.length,Ke;for(de=0;de<Ae;de++)switch(j[de].once&&this.removeListener(f,j[de].fn,void 0,!0),me){case 1:j[de].fn.call(j[de].context);break;case 2:j[de].fn.call(j[de].context,h);break;case 3:j[de].fn.call(j[de].context,h,p);break;case 4:j[de].fn.call(j[de].context,h,p,T);break;default:if(!ne)for(Ke=1,ne=new Array(me-1);Ke<me;Ke++)ne[Ke-1]=arguments[Ke];j[de].fn.apply(j[de].context,ne)}}return!0},c.prototype.on=function(f,h,p){return i(this,f,h,p,!1)},c.prototype.once=function(f,h,p){return i(this,f,h,p,!0)},c.prototype.removeListener=function(f,h,p,T){var C=t?t+f:f;if(!this._events[C])return this;if(!h)return l(this,C),this;var Z=this._events[C];if(Z.fn)Z.fn===h&&(!T||Z.once)&&(!p||Z.context===p)&&l(this,C);else{for(var V=0,j=[],me=Z.length;V<me;V++)(Z[V].fn!==h||T&&!Z[V].once||p&&Z[V].context!==p)&&j.push(Z[V]);j.length?this._events[C]=j.length===1?j[0]:j:l(this,C)}return this},c.prototype.removeAllListeners=function(f){var h;return f?(h=t?t+f:f,this._events[h]&&l(this,h)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,n.exports=c})(Mo);var Rc=Mo.exports,Uo=Aa(Rc),Ze;(function(n){n.assertEqual=r=>r;function e(r){}n.assertIs=e;function t(r){throw new Error}n.assertNever=t,n.arrayToEnum=r=>{const i={};for(const l of r)i[l]=l;return i},n.getValidEnumValues=r=>{const i=n.objectKeys(r).filter(c=>typeof r[r[c]]!="number"),l={};for(const c of i)l[c]=r[c];return n.objectValues(l)},n.objectValues=r=>n.objectKeys(r).map(function(i){return r[i]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const i=[];for(const l in r)Object.prototype.hasOwnProperty.call(r,l)&&i.push(l);return i},n.find=(r,i)=>{for(const l of r)if(i(l))return l},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function s(r,i=" | "){return r.map(l=>typeof l=="string"?`'${l}'`:l).join(i)}n.joinValues=s,n.jsonStringifyReplacer=(r,i)=>typeof i=="bigint"?i.toString():i})(Ze||(Ze={}));var da;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(da||(da={}));const oe=Ze.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),is=n=>{switch(typeof n){case"undefined":return oe.undefined;case"string":return oe.string;case"number":return isNaN(n)?oe.nan:oe.number;case"boolean":return oe.boolean;case"function":return oe.function;case"bigint":return oe.bigint;case"symbol":return oe.symbol;case"object":return Array.isArray(n)?oe.array:n===null?oe.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?oe.promise:typeof Map<"u"&&n instanceof Map?oe.map:typeof Set<"u"&&n instanceof Set?oe.set:typeof Date<"u"&&n instanceof Date?oe.date:oe.object;default:return oe.unknown}},Y=Ze.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Pc=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class qt extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},s={_errors:[]},r=i=>{for(const l of i.issues)if(l.code==="invalid_union")l.unionErrors.map(r);else if(l.code==="invalid_return_type")r(l.returnTypeError);else if(l.code==="invalid_arguments")r(l.argumentsError);else if(l.path.length===0)s._errors.push(t(l));else{let c=s,g=0;for(;g<l.path.length;){const f=l.path[g];g===l.path.length-1?(c[f]=c[f]||{_errors:[]},c[f]._errors.push(t(l))):c[f]=c[f]||{_errors:[]},c=c[f],g++}}};return r(this),s}static assert(e){if(!(e instanceof qt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ze.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}qt.create=n=>new qt(n);const er=(n,e)=>{let t;switch(n.code){case Y.invalid_type:n.received===oe.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case Y.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,Ze.jsonStringifyReplacer)}`;break;case Y.unrecognized_keys:t=`Unrecognized key(s) in object: ${Ze.joinValues(n.keys,", ")}`;break;case Y.invalid_union:t="Invalid input";break;case Y.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Ze.joinValues(n.options)}`;break;case Y.invalid_enum_value:t=`Invalid enum value. Expected ${Ze.joinValues(n.options)}, received '${n.received}'`;break;case Y.invalid_arguments:t="Invalid function arguments";break;case Y.invalid_return_type:t="Invalid function return type";break;case Y.invalid_date:t="Invalid date";break;case Y.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:Ze.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case Y.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case Y.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case Y.custom:t="Invalid input";break;case Y.invalid_intersection_types:t="Intersection results could not be merged";break;case Y.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case Y.not_finite:t="Number must be finite";break;default:t=e.defaultError,Ze.assertNever(n)}return{message:t}};let $o=er;function kc(n){$o=n}function hi(){return $o}const pi=n=>{const{data:e,path:t,errorMaps:s,issueData:r}=n,i=[...t,...r.path||[]],l={...r,path:i};if(r.message!==void 0)return{...r,path:i,message:r.message};let c="";const g=s.filter(f=>!!f).slice().reverse();for(const f of g)c=f(l,{data:e,defaultError:c}).message;return{...r,path:i,message:c}},Lc=[];function ae(n,e){const t=hi(),s=pi({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===er?void 0:er].filter(r=>!!r)});n.common.issues.push(s)}class kt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const r of t){if(r.status==="aborted")return Se;r.status==="dirty"&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const r of t){const i=await r.key,l=await r.value;s.push({key:i,value:l})}return kt.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const r of t){const{key:i,value:l}=r;if(i.status==="aborted"||l.status==="aborted")return Se;i.status==="dirty"&&e.dirty(),l.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof l.value<"u"||r.alwaysSet)&&(s[i.value]=l.value)}return{status:e.value,value:s}}}const Se=Object.freeze({status:"aborted"}),Js=n=>({status:"dirty",value:n}),$t=n=>({status:"valid",value:n}),ha=n=>n.status==="aborted",pa=n=>n.status==="dirty",gr=n=>n.status==="valid",mr=n=>typeof Promise<"u"&&n instanceof Promise;function gi(n,e,t,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function Vo(n,e,t,s,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var ve;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ve||(ve={}));var dr,hr;class Pn{constructor(e,t,s,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const no=(n,e)=>{if(gr(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new qt(n.common.issues);return this._error=t,this._error}}};function Le(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:r}=n;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(l,c)=>{var g,f;const{message:h}=n;return l.code==="invalid_enum_value"?{message:h??c.defaultError}:typeof c.data>"u"?{message:(g=h??s)!==null&&g!==void 0?g:c.defaultError}:l.code!=="invalid_type"?{message:c.defaultError}:{message:(f=h??t)!==null&&f!==void 0?f:c.defaultError}},description:r}}class Be{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return is(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:is(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new kt,ctx:{common:e.parent.common,data:e.data,parsedType:is(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(mr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const r={common:{issues:[],async:(s=t==null?void 0:t.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:is(e)},i=this._parseSync({data:e,path:r.path,parent:r});return no(r,i)}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:is(e)},r=this._parse({data:e,path:s.path,parent:s}),i=await(mr(r)?r:Promise.resolve(r));return no(s,i)}refine(e,t){const s=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,i)=>{const l=e(r),c=()=>i.addIssue({code:Y.custom,...s(r)});return typeof Promise<"u"&&l instanceof Promise?l.then(g=>g?!0:(c(),!1)):l?!0:(c(),!1)})}refinement(e,t){return this._refinement((s,r)=>e(s)?!0:(r.addIssue(typeof t=="function"?t(s,r):t),!1))}_refinement(e){return new yn({schema:this,typeName:Te.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Rn.create(this,this._def)}nullable(){return ps.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return gn.create(this,this._def)}promise(){return nr.create(this,this._def)}or(e){return _r.create([this,e],this._def)}and(e){return wr.create(this,e,this._def)}transform(e){return new yn({...Le(this._def),schema:this,typeName:Te.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Ar({...Le(this._def),innerType:this,defaultValue:t,typeName:Te.ZodDefault})}brand(){return new Oa({typeName:Te.ZodBranded,type:this,...Le(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Or({...Le(this._def),innerType:this,catchValue:t,typeName:Te.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Rr.create(this,e)}readonly(){return xr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Bc=/^c[^\s-]{8,}$/i,Cc=/^[0-9a-z]+$/,Mc=/^[0-9A-HJKMNP-TV-Z]{26}$/,Uc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,$c=/^[a-z0-9_-]{21}$/i,Vc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Fc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,jc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ji;const Hc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Gc=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Zc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Fo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",zc=new RegExp(`^${Fo}$`);function jo(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Wc(n){return new RegExp(`^${jo(n)}$`)}function Ho(n){let e=`${Fo}T${jo(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Kc(n,e){return!!((e==="v4"||!e)&&Hc.test(n)||(e==="v6"||!e)&&Gc.test(n))}class pn extends Be{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==oe.string){const i=this._getOrReturnCtx(e);return ae(i,{code:Y.invalid_type,expected:oe.string,received:i.parsedType}),Se}const s=new kt;let r;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const l=e.data.length>i.value,c=e.data.length<i.value;(l||c)&&(r=this._getOrReturnCtx(e,r),l?ae(r,{code:Y.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&ae(r,{code:Y.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")Fc.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"email",code:Y.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Ji||(Ji=new RegExp(jc,"u")),Ji.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"emoji",code:Y.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")Uc.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"uuid",code:Y.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")$c.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"nanoid",code:Y.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")Bc.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"cuid",code:Y.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")Cc.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"cuid2",code:Y.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Mc.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"ulid",code:Y.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),ae(r,{validation:"url",code:Y.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"regex",code:Y.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?Ho(i).test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?zc.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?Wc(i).test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?Vc.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"duration",code:Y.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?Kc(e.data,i.version)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"ip",code:Y.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Zc.test(e.data)||(r=this._getOrReturnCtx(e,r),ae(r,{validation:"base64",code:Y.invalid_string,message:i.message}),s.dirty()):Ze.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(r=>e.test(r),{validation:t,code:Y.invalid_string,...ve.errToObj(s)})}_addCheck(e){return new pn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ve.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ve.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ve.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ve.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ve.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ve.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ve.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ve.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ve.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ve.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,...ve.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ve.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ve.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ve.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...ve.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ve.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ve.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ve.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ve.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ve.errToObj(t)})}nonempty(e){return this.min(1,ve.errToObj(e))}trim(){return new pn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new pn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new pn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}pn.create=n=>{var e;return new pn({checks:[],typeName:Te.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Le(n)})};function qc(n,e){const t=(n.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,r=t>s?t:s,i=parseInt(n.toFixed(r).replace(".","")),l=parseInt(e.toFixed(r).replace(".",""));return i%l/Math.pow(10,r)}class fs extends Be{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==oe.number){const i=this._getOrReturnCtx(e);return ae(i,{code:Y.invalid_type,expected:oe.number,received:i.parsedType}),Se}let s;const r=new kt;for(const i of this._def.checks)i.kind==="int"?Ze.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),ae(s,{code:Y.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),ae(s,{code:Y.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),ae(s,{code:Y.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="multipleOf"?qc(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),ae(s,{code:Y.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),ae(s,{code:Y.not_finite,message:i.message}),r.dirty()):Ze.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ve.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ve.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ve.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ve.toString(t))}setLimit(e,t,s,r){return new fs({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:ve.toString(r)}]})}_addCheck(e){return new fs({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ve.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ve.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ve.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ve.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ve.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ve.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ve.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ve.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ve.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ze.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}fs.create=n=>new fs({checks:[],typeName:Te.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Le(n)});class ds extends Be{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==oe.bigint){const i=this._getOrReturnCtx(e);return ae(i,{code:Y.invalid_type,expected:oe.bigint,received:i.parsedType}),Se}let s;const r=new kt;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),ae(s,{code:Y.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),ae(s,{code:Y.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),ae(s,{code:Y.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):Ze.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ve.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ve.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ve.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ve.toString(t))}setLimit(e,t,s,r){return new ds({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:ve.toString(r)}]})}_addCheck(e){return new ds({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ve.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ve.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ve.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ve.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ve.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ds.create=n=>{var e;return new ds({checks:[],typeName:Te.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Le(n)})};class yr extends Be{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==oe.boolean){const s=this._getOrReturnCtx(e);return ae(s,{code:Y.invalid_type,expected:oe.boolean,received:s.parsedType}),Se}return $t(e.data)}}yr.create=n=>new yr({typeName:Te.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Le(n)});class Us extends Be{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==oe.date){const i=this._getOrReturnCtx(e);return ae(i,{code:Y.invalid_type,expected:oe.date,received:i.parsedType}),Se}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return ae(i,{code:Y.invalid_date}),Se}const s=new kt;let r;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(r=this._getOrReturnCtx(e,r),ae(r,{code:Y.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):Ze.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Us({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ve.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ve.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Us.create=n=>new Us({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Te.ZodDate,...Le(n)});class mi extends Be{_parse(e){if(this._getType(e)!==oe.symbol){const s=this._getOrReturnCtx(e);return ae(s,{code:Y.invalid_type,expected:oe.symbol,received:s.parsedType}),Se}return $t(e.data)}}mi.create=n=>new mi({typeName:Te.ZodSymbol,...Le(n)});class vr extends Be{_parse(e){if(this._getType(e)!==oe.undefined){const s=this._getOrReturnCtx(e);return ae(s,{code:Y.invalid_type,expected:oe.undefined,received:s.parsedType}),Se}return $t(e.data)}}vr.create=n=>new vr({typeName:Te.ZodUndefined,...Le(n)});class br extends Be{_parse(e){if(this._getType(e)!==oe.null){const s=this._getOrReturnCtx(e);return ae(s,{code:Y.invalid_type,expected:oe.null,received:s.parsedType}),Se}return $t(e.data)}}br.create=n=>new br({typeName:Te.ZodNull,...Le(n)});class tr extends Be{constructor(){super(...arguments),this._any=!0}_parse(e){return $t(e.data)}}tr.create=n=>new tr({typeName:Te.ZodAny,...Le(n)});class Cs extends Be{constructor(){super(...arguments),this._unknown=!0}_parse(e){return $t(e.data)}}Cs.create=n=>new Cs({typeName:Te.ZodUnknown,...Le(n)});class zn extends Be{_parse(e){const t=this._getOrReturnCtx(e);return ae(t,{code:Y.invalid_type,expected:oe.never,received:t.parsedType}),Se}}zn.create=n=>new zn({typeName:Te.ZodNever,...Le(n)});class yi extends Be{_parse(e){if(this._getType(e)!==oe.undefined){const s=this._getOrReturnCtx(e);return ae(s,{code:Y.invalid_type,expected:oe.void,received:s.parsedType}),Se}return $t(e.data)}}yi.create=n=>new yi({typeName:Te.ZodVoid,...Le(n)});class gn extends Be{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==oe.array)return ae(t,{code:Y.invalid_type,expected:oe.array,received:t.parsedType}),Se;if(r.exactLength!==null){const l=t.data.length>r.exactLength.value,c=t.data.length<r.exactLength.value;(l||c)&&(ae(t,{code:l?Y.too_big:Y.too_small,minimum:c?r.exactLength.value:void 0,maximum:l?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(ae(t,{code:Y.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(ae(t,{code:Y.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((l,c)=>r.type._parseAsync(new Pn(t,l,t.path,c)))).then(l=>kt.mergeArray(s,l));const i=[...t.data].map((l,c)=>r.type._parseSync(new Pn(t,l,t.path,c)));return kt.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new gn({...this._def,minLength:{value:e,message:ve.toString(t)}})}max(e,t){return new gn({...this._def,maxLength:{value:e,message:ve.toString(t)}})}length(e,t){return new gn({...this._def,exactLength:{value:e,message:ve.toString(t)}})}nonempty(e){return this.min(1,e)}}gn.create=(n,e)=>new gn({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Te.ZodArray,...Le(e)});function Xs(n){if(n instanceof lt){const e={};for(const t in n.shape){const s=n.shape[t];e[t]=Rn.create(Xs(s))}return new lt({...n._def,shape:()=>e})}else return n instanceof gn?new gn({...n._def,type:Xs(n.element)}):n instanceof Rn?Rn.create(Xs(n.unwrap())):n instanceof ps?ps.create(Xs(n.unwrap())):n instanceof kn?kn.create(n.items.map(e=>Xs(e))):n}class lt extends Be{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Ze.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==oe.object){const f=this._getOrReturnCtx(e);return ae(f,{code:Y.invalid_type,expected:oe.object,received:f.parsedType}),Se}const{status:s,ctx:r}=this._processInputParams(e),{shape:i,keys:l}=this._getCached(),c=[];if(!(this._def.catchall instanceof zn&&this._def.unknownKeys==="strip"))for(const f in r.data)l.includes(f)||c.push(f);const g=[];for(const f of l){const h=i[f],p=r.data[f];g.push({key:{status:"valid",value:f},value:h._parse(new Pn(r,p,r.path,f)),alwaysSet:f in r.data})}if(this._def.catchall instanceof zn){const f=this._def.unknownKeys;if(f==="passthrough")for(const h of c)g.push({key:{status:"valid",value:h},value:{status:"valid",value:r.data[h]}});else if(f==="strict")c.length>0&&(ae(r,{code:Y.unrecognized_keys,keys:c}),s.dirty());else if(f!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const f=this._def.catchall;for(const h of c){const p=r.data[h];g.push({key:{status:"valid",value:h},value:f._parse(new Pn(r,p,r.path,h)),alwaysSet:h in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const f=[];for(const h of g){const p=await h.key,T=await h.value;f.push({key:p,value:T,alwaysSet:h.alwaysSet})}return f}).then(f=>kt.mergeObjectSync(s,f)):kt.mergeObjectSync(s,g)}get shape(){return this._def.shape()}strict(e){return ve.errToObj,new lt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var r,i,l,c;const g=(l=(i=(r=this._def).errorMap)===null||i===void 0?void 0:i.call(r,t,s).message)!==null&&l!==void 0?l:s.defaultError;return t.code==="unrecognized_keys"?{message:(c=ve.errToObj(e).message)!==null&&c!==void 0?c:g}:{message:g}}}:{}})}strip(){return new lt({...this._def,unknownKeys:"strip"})}passthrough(){return new lt({...this._def,unknownKeys:"passthrough"})}extend(e){return new lt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new lt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Te.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new lt({...this._def,catchall:e})}pick(e){const t={};return Ze.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new lt({...this._def,shape:()=>t})}omit(e){const t={};return Ze.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new lt({...this._def,shape:()=>t})}deepPartial(){return Xs(this)}partial(e){const t={};return Ze.objectKeys(this.shape).forEach(s=>{const r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}),new lt({...this._def,shape:()=>t})}required(e){const t={};return Ze.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof Rn;)i=i._def.innerType;t[s]=i}}),new lt({...this._def,shape:()=>t})}keyof(){return Go(Ze.objectKeys(this.shape))}}lt.create=(n,e)=>new lt({shape:()=>n,unknownKeys:"strip",catchall:zn.create(),typeName:Te.ZodObject,...Le(e)});lt.strictCreate=(n,e)=>new lt({shape:()=>n,unknownKeys:"strict",catchall:zn.create(),typeName:Te.ZodObject,...Le(e)});lt.lazycreate=(n,e)=>new lt({shape:n,unknownKeys:"strip",catchall:zn.create(),typeName:Te.ZodObject,...Le(e)});class _r extends Be{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function r(i){for(const c of i)if(c.result.status==="valid")return c.result;for(const c of i)if(c.result.status==="dirty")return t.common.issues.push(...c.ctx.common.issues),c.result;const l=i.map(c=>new qt(c.ctx.common.issues));return ae(t,{code:Y.invalid_union,unionErrors:l}),Se}if(t.common.async)return Promise.all(s.map(async i=>{const l={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:l}),ctx:l}})).then(r);{let i;const l=[];for(const g of s){const f={...t,common:{...t.common,issues:[]},parent:null},h=g._parseSync({data:t.data,path:t.path,parent:f});if(h.status==="valid")return h;h.status==="dirty"&&!i&&(i={result:h,ctx:f}),f.common.issues.length&&l.push(f.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const c=l.map(g=>new qt(g));return ae(t,{code:Y.invalid_union,unionErrors:c}),Se}}get options(){return this._def.options}}_r.create=(n,e)=>new _r({options:n,typeName:Te.ZodUnion,...Le(e)});const Fn=n=>n instanceof Tr?Fn(n.schema):n instanceof yn?Fn(n.innerType()):n instanceof Sr?[n.value]:n instanceof hs?n.options:n instanceof Ir?Ze.objectValues(n.enum):n instanceof Ar?Fn(n._def.innerType):n instanceof vr?[void 0]:n instanceof br?[null]:n instanceof Rn?[void 0,...Fn(n.unwrap())]:n instanceof ps?[null,...Fn(n.unwrap())]:n instanceof Oa||n instanceof xr?Fn(n.unwrap()):n instanceof Or?Fn(n._def.innerType):[];class Ai extends Be{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==oe.object)return ae(t,{code:Y.invalid_type,expected:oe.object,received:t.parsedType}),Se;const s=this.discriminator,r=t.data[s],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(ae(t,{code:Y.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),Se)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const r=new Map;for(const i of t){const l=Fn(i.shape[e]);if(!l.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const c of l){if(r.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);r.set(c,i)}}return new Ai({typeName:Te.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...Le(s)})}}function ga(n,e){const t=is(n),s=is(e);if(n===e)return{valid:!0,data:n};if(t===oe.object&&s===oe.object){const r=Ze.objectKeys(e),i=Ze.objectKeys(n).filter(c=>r.indexOf(c)!==-1),l={...n,...e};for(const c of i){const g=ga(n[c],e[c]);if(!g.valid)return{valid:!1};l[c]=g.data}return{valid:!0,data:l}}else if(t===oe.array&&s===oe.array){if(n.length!==e.length)return{valid:!1};const r=[];for(let i=0;i<n.length;i++){const l=n[i],c=e[i],g=ga(l,c);if(!g.valid)return{valid:!1};r.push(g.data)}return{valid:!0,data:r}}else return t===oe.date&&s===oe.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class wr extends Be{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=(i,l)=>{if(ha(i)||ha(l))return Se;const c=ga(i.value,l.value);return c.valid?((pa(i)||pa(l))&&t.dirty(),{status:t.value,value:c.data}):(ae(s,{code:Y.invalid_intersection_types}),Se)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,l])=>r(i,l)):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}wr.create=(n,e,t)=>new wr({left:n,right:e,typeName:Te.ZodIntersection,...Le(t)});class kn extends Be{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==oe.array)return ae(s,{code:Y.invalid_type,expected:oe.array,received:s.parsedType}),Se;if(s.data.length<this._def.items.length)return ae(s,{code:Y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Se;!this._def.rest&&s.data.length>this._def.items.length&&(ae(s,{code:Y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...s.data].map((l,c)=>{const g=this._def.items[c]||this._def.rest;return g?g._parse(new Pn(s,l,s.path,c)):null}).filter(l=>!!l);return s.common.async?Promise.all(i).then(l=>kt.mergeArray(t,l)):kt.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new kn({...this._def,rest:e})}}kn.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new kn({items:n,typeName:Te.ZodTuple,rest:null,...Le(e)})};class Er extends Be{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==oe.object)return ae(s,{code:Y.invalid_type,expected:oe.object,received:s.parsedType}),Se;const r=[],i=this._def.keyType,l=this._def.valueType;for(const c in s.data)r.push({key:i._parse(new Pn(s,c,s.path,c)),value:l._parse(new Pn(s,s.data[c],s.path,c)),alwaysSet:c in s.data});return s.common.async?kt.mergeObjectAsync(t,r):kt.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof Be?new Er({keyType:e,valueType:t,typeName:Te.ZodRecord,...Le(s)}):new Er({keyType:pn.create(),valueType:e,typeName:Te.ZodRecord,...Le(t)})}}class vi extends Be{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==oe.map)return ae(s,{code:Y.invalid_type,expected:oe.map,received:s.parsedType}),Se;const r=this._def.keyType,i=this._def.valueType,l=[...s.data.entries()].map(([c,g],f)=>({key:r._parse(new Pn(s,c,s.path,[f,"key"])),value:i._parse(new Pn(s,g,s.path,[f,"value"]))}));if(s.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const g of l){const f=await g.key,h=await g.value;if(f.status==="aborted"||h.status==="aborted")return Se;(f.status==="dirty"||h.status==="dirty")&&t.dirty(),c.set(f.value,h.value)}return{status:t.value,value:c}})}else{const c=new Map;for(const g of l){const f=g.key,h=g.value;if(f.status==="aborted"||h.status==="aborted")return Se;(f.status==="dirty"||h.status==="dirty")&&t.dirty(),c.set(f.value,h.value)}return{status:t.value,value:c}}}}vi.create=(n,e,t)=>new vi({valueType:e,keyType:n,typeName:Te.ZodMap,...Le(t)});class $s extends Be{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==oe.set)return ae(s,{code:Y.invalid_type,expected:oe.set,received:s.parsedType}),Se;const r=this._def;r.minSize!==null&&s.data.size<r.minSize.value&&(ae(s,{code:Y.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&s.data.size>r.maxSize.value&&(ae(s,{code:Y.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const i=this._def.valueType;function l(g){const f=new Set;for(const h of g){if(h.status==="aborted")return Se;h.status==="dirty"&&t.dirty(),f.add(h.value)}return{status:t.value,value:f}}const c=[...s.data.values()].map((g,f)=>i._parse(new Pn(s,g,s.path,f)));return s.common.async?Promise.all(c).then(g=>l(g)):l(c)}min(e,t){return new $s({...this._def,minSize:{value:e,message:ve.toString(t)}})}max(e,t){return new $s({...this._def,maxSize:{value:e,message:ve.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}$s.create=(n,e)=>new $s({valueType:n,minSize:null,maxSize:null,typeName:Te.ZodSet,...Le(e)});class Qs extends Be{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==oe.function)return ae(t,{code:Y.invalid_type,expected:oe.function,received:t.parsedType}),Se;function s(c,g){return pi({data:c,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,hi(),er].filter(f=>!!f),issueData:{code:Y.invalid_arguments,argumentsError:g}})}function r(c,g){return pi({data:c,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,hi(),er].filter(f=>!!f),issueData:{code:Y.invalid_return_type,returnTypeError:g}})}const i={errorMap:t.common.contextualErrorMap},l=t.data;if(this._def.returns instanceof nr){const c=this;return $t(async function(...g){const f=new qt([]),h=await c._def.args.parseAsync(g,i).catch(C=>{throw f.addIssue(s(g,C)),f}),p=await Reflect.apply(l,this,h);return await c._def.returns._def.type.parseAsync(p,i).catch(C=>{throw f.addIssue(r(p,C)),f})})}else{const c=this;return $t(function(...g){const f=c._def.args.safeParse(g,i);if(!f.success)throw new qt([s(g,f.error)]);const h=Reflect.apply(l,this,f.data),p=c._def.returns.safeParse(h,i);if(!p.success)throw new qt([r(h,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Qs({...this._def,args:kn.create(e).rest(Cs.create())})}returns(e){return new Qs({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new Qs({args:e||kn.create([]).rest(Cs.create()),returns:t||Cs.create(),typeName:Te.ZodFunction,...Le(s)})}}class Tr extends Be{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Tr.create=(n,e)=>new Tr({getter:n,typeName:Te.ZodLazy,...Le(e)});class Sr extends Be{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ae(t,{received:t.data,code:Y.invalid_literal,expected:this._def.value}),Se}return{status:"valid",value:e.data}}get value(){return this._def.value}}Sr.create=(n,e)=>new Sr({value:n,typeName:Te.ZodLiteral,...Le(e)});function Go(n,e){return new hs({values:n,typeName:Te.ZodEnum,...Le(e)})}class hs extends Be{constructor(){super(...arguments),dr.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return ae(t,{expected:Ze.joinValues(s),received:t.parsedType,code:Y.invalid_type}),Se}if(gi(this,dr)||Vo(this,dr,new Set(this._def.values)),!gi(this,dr).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return ae(t,{received:t.data,code:Y.invalid_enum_value,options:s}),Se}return $t(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return hs.create(e,{...this._def,...t})}exclude(e,t=this._def){return hs.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}}dr=new WeakMap;hs.create=Go;class Ir extends Be{constructor(){super(...arguments),hr.set(this,void 0)}_parse(e){const t=Ze.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==oe.string&&s.parsedType!==oe.number){const r=Ze.objectValues(t);return ae(s,{expected:Ze.joinValues(r),received:s.parsedType,code:Y.invalid_type}),Se}if(gi(this,hr)||Vo(this,hr,new Set(Ze.getValidEnumValues(this._def.values))),!gi(this,hr).has(e.data)){const r=Ze.objectValues(t);return ae(s,{received:s.data,code:Y.invalid_enum_value,options:r}),Se}return $t(e.data)}get enum(){return this._def.values}}hr=new WeakMap;Ir.create=(n,e)=>new Ir({values:n,typeName:Te.ZodNativeEnum,...Le(e)});class nr extends Be{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==oe.promise&&t.common.async===!1)return ae(t,{code:Y.invalid_type,expected:oe.promise,received:t.parsedType}),Se;const s=t.parsedType===oe.promise?t.data:Promise.resolve(t.data);return $t(s.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}}nr.create=(n,e)=>new nr({type:n,typeName:Te.ZodPromise,...Le(e)});class yn extends Be{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Te.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:l=>{ae(s,l),l.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),r.type==="preprocess"){const l=r.transform(s.data,i);if(s.common.async)return Promise.resolve(l).then(async c=>{if(t.value==="aborted")return Se;const g=await this._def.schema._parseAsync({data:c,path:s.path,parent:s});return g.status==="aborted"?Se:g.status==="dirty"||t.value==="dirty"?Js(g.value):g});{if(t.value==="aborted")return Se;const c=this._def.schema._parseSync({data:l,path:s.path,parent:s});return c.status==="aborted"?Se:c.status==="dirty"||t.value==="dirty"?Js(c.value):c}}if(r.type==="refinement"){const l=c=>{const g=r.refinement(c,i);if(s.common.async)return Promise.resolve(g);if(g instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(s.common.async===!1){const c=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return c.status==="aborted"?Se:(c.status==="dirty"&&t.dirty(),l(c.value),{status:t.value,value:c.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(c=>c.status==="aborted"?Se:(c.status==="dirty"&&t.dirty(),l(c.value).then(()=>({status:t.value,value:c.value}))))}if(r.type==="transform")if(s.common.async===!1){const l=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!gr(l))return l;const c=r.transform(l.value,i);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:c}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(l=>gr(l)?Promise.resolve(r.transform(l.value,i)).then(c=>({status:t.value,value:c})):l);Ze.assertNever(r)}}yn.create=(n,e,t)=>new yn({schema:n,typeName:Te.ZodEffects,effect:e,...Le(t)});yn.createWithPreprocess=(n,e,t)=>new yn({schema:e,effect:{type:"preprocess",transform:n},typeName:Te.ZodEffects,...Le(t)});class Rn extends Be{_parse(e){return this._getType(e)===oe.undefined?$t(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Rn.create=(n,e)=>new Rn({innerType:n,typeName:Te.ZodOptional,...Le(e)});class ps extends Be{_parse(e){return this._getType(e)===oe.null?$t(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ps.create=(n,e)=>new ps({innerType:n,typeName:Te.ZodNullable,...Le(e)});class Ar extends Be{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===oe.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ar.create=(n,e)=>new Ar({innerType:n,typeName:Te.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Le(e)});class Or extends Be{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return mr(r)?r.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new qt(s.common.issues)},input:s.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new qt(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Or.create=(n,e)=>new Or({innerType:n,typeName:Te.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Le(e)});class bi extends Be{_parse(e){if(this._getType(e)!==oe.nan){const s=this._getOrReturnCtx(e);return ae(s,{code:Y.invalid_type,expected:oe.nan,received:s.parsedType}),Se}return{status:"valid",value:e.data}}}bi.create=n=>new bi({typeName:Te.ZodNaN,...Le(n)});const Yc=Symbol("zod_brand");class Oa extends Be{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class Rr extends Be{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?Se:i.status==="dirty"?(t.dirty(),Js(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const r=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?Se:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:s.path,parent:s})}}static create(e,t){return new Rr({in:e,out:t,typeName:Te.ZodPipeline})}}class xr extends Be{_parse(e){const t=this._def.innerType._parse(e),s=r=>(gr(r)&&(r.value=Object.freeze(r.value)),r);return mr(t)?t.then(r=>s(r)):s(t)}unwrap(){return this._def.innerType}}xr.create=(n,e)=>new xr({innerType:n,typeName:Te.ZodReadonly,...Le(e)});function xa(n,e={},t){return n?tr.create().superRefine((s,r)=>{var i,l;if(!n(s)){const c=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,g=(l=(i=c.fatal)!==null&&i!==void 0?i:t)!==null&&l!==void 0?l:!0,f=typeof c=="string"?{message:c}:c;r.addIssue({code:"custom",...f,fatal:g})}}):tr.create()}const Xc={object:lt.lazycreate};var Te;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Te||(Te={}));const Jc=(n,e={message:`Input not instance of ${n.name}`})=>xa(t=>t instanceof n,e),A=pn.create,be=fs.create,Qc=bi.create,Zo=ds.create,xe=yr.create,eu=Us.create,tu=mi.create,nu=vr.create,Da=br.create,su=tr.create,Dr=Cs.create,ru=zn.create,iu=yi.create,Ge=gn.create,se=lt.create,au=lt.strictCreate,Na=_r.create,ou=Ai.create,lu=wr.create,cu=kn.create,uu=Er.create,fu=vi.create,du=$s.create,hu=Qs.create,pu=Tr.create,wt=Sr.create,gu=hs.create,ir=Ir.create,mu=nr.create,so=yn.create,zo=Rn.create,yu=ps.create,Wo=yn.createWithPreprocess,vu=Rr.create,bu=()=>A().optional(),_u=()=>be().optional(),wu=()=>xe().optional(),Eu={string:n=>pn.create({...n,coerce:!0}),number:n=>fs.create({...n,coerce:!0}),boolean:n=>yr.create({...n,coerce:!0}),bigint:n=>ds.create({...n,coerce:!0}),date:n=>Us.create({...n,coerce:!0})},Tu=Se;var ge=Object.freeze({__proto__:null,defaultErrorMap:er,setErrorMap:kc,getErrorMap:hi,makeIssue:pi,EMPTY_PATH:Lc,addIssueToContext:ae,ParseStatus:kt,INVALID:Se,DIRTY:Js,OK:$t,isAborted:ha,isDirty:pa,isValid:gr,isAsync:mr,get util(){return Ze},get objectUtil(){return da},ZodParsedType:oe,getParsedType:is,ZodType:Be,datetimeRegex:Ho,ZodString:pn,ZodNumber:fs,ZodBigInt:ds,ZodBoolean:yr,ZodDate:Us,ZodSymbol:mi,ZodUndefined:vr,ZodNull:br,ZodAny:tr,ZodUnknown:Cs,ZodNever:zn,ZodVoid:yi,ZodArray:gn,ZodObject:lt,ZodUnion:_r,ZodDiscriminatedUnion:Ai,ZodIntersection:wr,ZodTuple:kn,ZodRecord:Er,ZodMap:vi,ZodSet:$s,ZodFunction:Qs,ZodLazy:Tr,ZodLiteral:Sr,ZodEnum:hs,ZodNativeEnum:Ir,ZodPromise:nr,ZodEffects:yn,ZodTransformer:yn,ZodOptional:Rn,ZodNullable:ps,ZodDefault:Ar,ZodCatch:Or,ZodNaN:bi,BRAND:Yc,ZodBranded:Oa,ZodPipeline:Rr,ZodReadonly:xr,custom:xa,Schema:Be,ZodSchema:Be,late:Xc,get ZodFirstPartyTypeKind(){return Te},coerce:Eu,any:su,array:Ge,bigint:Zo,boolean:xe,date:eu,discriminatedUnion:ou,effect:so,enum:gu,function:hu,instanceof:Jc,intersection:lu,lazy:pu,literal:wt,map:fu,nan:Qc,nativeEnum:ir,never:ru,null:Da,nullable:yu,number:be,object:se,oboolean:wu,onumber:_u,optional:zo,ostring:bu,pipeline:vu,preprocess:Wo,promise:mu,record:uu,set:du,strictObject:au,string:A,symbol:tu,transformer:so,tuple:cu,undefined:nu,union:Na,unknown:Dr,void:iu,NEVER:Tu,ZodIssueCode:Y,quotelessJson:Pc,ZodError:qt}),Ko={exports:{}};(function(n){var e=function(t){var s=1e7,r=7,i=9007199254740992,l=Z(i),c="0123456789abcdefghijklmnopqrstuvwxyz",g=typeof BigInt=="function";function f(d,b,S,D){return typeof d>"u"?f[0]:typeof b<"u"?+b==10&&!S?Ee(d):_n(d,b,S,D):Ee(d)}function h(d,b){this.value=d,this.sign=b,this.isSmall=!1}h.prototype=Object.create(f.prototype);function p(d){this.value=d,this.sign=d<0,this.isSmall=!0}p.prototype=Object.create(f.prototype);function T(d){this.value=d}T.prototype=Object.create(f.prototype);function C(d){return-i<d&&d<i}function Z(d){return d<1e7?[d]:d<1e14?[d%1e7,Math.floor(d/1e7)]:[d%1e7,Math.floor(d/1e7)%1e7,Math.floor(d/1e14)]}function V(d){j(d);var b=d.length;if(b<4&&we(d,l)<0)switch(b){case 0:return 0;case 1:return d[0];case 2:return d[0]+d[1]*s;default:return d[0]+(d[1]+d[2]*s)*s}return d}function j(d){for(var b=d.length;d[--b]===0;);d.length=b+1}function me(d){for(var b=new Array(d),S=-1;++S<d;)b[S]=0;return b}function ne(d){return d>0?Math.floor(d):Math.ceil(d)}function de(d,b){var S=d.length,D=b.length,M=new Array(S),L=0,$=s,H,z;for(z=0;z<D;z++)H=d[z]+b[z]+L,L=H>=$?1:0,M[z]=H-L*$;for(;z<S;)H=d[z]+L,L=H===$?1:0,M[z++]=H-L*$;return L>0&&M.push(L),M}function Ae(d,b){return d.length>=b.length?de(d,b):de(b,d)}function Ke(d,b){var S=d.length,D=new Array(S),M=s,L,$;for($=0;$<S;$++)L=d[$]-M+b,b=Math.floor(L/M),D[$]=L-b*M,b+=1;for(;b>0;)D[$++]=b%M,b=Math.floor(b/M);return D}h.prototype.add=function(d){var b=Ee(d);if(this.sign!==b.sign)return this.subtract(b.negate());var S=this.value,D=b.value;return b.isSmall?new h(Ke(S,Math.abs(D)),this.sign):new h(Ae(S,D),this.sign)},h.prototype.plus=h.prototype.add,p.prototype.add=function(d){var b=Ee(d),S=this.value;if(S<0!==b.sign)return this.subtract(b.negate());var D=b.value;if(b.isSmall){if(C(S+D))return new p(S+D);D=Z(Math.abs(D))}return new h(Ke(D,Math.abs(S)),S<0)},p.prototype.plus=p.prototype.add,T.prototype.add=function(d){return new T(this.value+Ee(d).value)},T.prototype.plus=T.prototype.add;function tt(d,b){var S=d.length,D=b.length,M=new Array(S),L=0,$=s,H,z;for(H=0;H<D;H++)z=d[H]-L-b[H],z<0?(z+=$,L=1):L=0,M[H]=z;for(H=D;H<S;H++){if(z=d[H]-L,z<0)z+=$;else{M[H++]=z;break}M[H]=z}for(;H<S;H++)M[H]=d[H];return j(M),M}function nt(d,b,S){var D;return we(d,b)>=0?D=tt(d,b):(D=tt(b,d),S=!S),D=V(D),typeof D=="number"?(S&&(D=-D),new p(D)):new h(D,S)}function ct(d,b,S){var D=d.length,M=new Array(D),L=-b,$=s,H,z;for(H=0;H<D;H++)z=d[H]+L,L=Math.floor(z/$),z%=$,M[H]=z<0?z+$:z;return M=V(M),typeof M=="number"?(S&&(M=-M),new p(M)):new h(M,S)}h.prototype.subtract=function(d){var b=Ee(d);if(this.sign!==b.sign)return this.add(b.negate());var S=this.value,D=b.value;return b.isSmall?ct(S,Math.abs(D),this.sign):nt(S,D,this.sign)},h.prototype.minus=h.prototype.subtract,p.prototype.subtract=function(d){var b=Ee(d),S=this.value;if(S<0!==b.sign)return this.add(b.negate());var D=b.value;return b.isSmall?new p(S-D):ct(D,Math.abs(S),S>=0)},p.prototype.minus=p.prototype.subtract,T.prototype.subtract=function(d){return new T(this.value-Ee(d).value)},T.prototype.minus=T.prototype.subtract,h.prototype.negate=function(){return new h(this.value,!this.sign)},p.prototype.negate=function(){var d=this.sign,b=new p(-this.value);return b.sign=!d,b},T.prototype.negate=function(){return new T(-this.value)},h.prototype.abs=function(){return new h(this.value,!1)},p.prototype.abs=function(){return new p(Math.abs(this.value))},T.prototype.abs=function(){return new T(this.value>=0?this.value:-this.value)};function st(d,b){var S=d.length,D=b.length,M=S+D,L=me(M),$=s,H,z,ue,Pe,Ie;for(ue=0;ue<S;++ue){Pe=d[ue];for(var De=0;De<D;++De)Ie=b[De],H=Pe*Ie+L[ue+De],z=Math.floor(H/$),L[ue+De]=H-z*$,L[ue+De+1]+=z}return j(L),L}function Ye(d,b){var S=d.length,D=new Array(S),M=s,L=0,$,H;for(H=0;H<S;H++)$=d[H]*b+L,L=Math.floor($/M),D[H]=$-L*M;for(;L>0;)D[H++]=L%M,L=Math.floor(L/M);return D}function Qe(d,b){for(var S=[];b-- >0;)S.push(0);return S.concat(d)}function $e(d,b){var S=Math.max(d.length,b.length);if(S<=30)return st(d,b);S=Math.ceil(S/2);var D=d.slice(S),M=d.slice(0,S),L=b.slice(S),$=b.slice(0,S),H=$e(M,$),z=$e(D,L),ue=$e(Ae(M,D),Ae($,L)),Pe=Ae(Ae(H,Qe(tt(tt(ue,H),z),S)),Qe(z,2*S));return j(Pe),Pe}function k(d,b){return-.012*d-.012*b+15e-6*d*b>0}h.prototype.multiply=function(d){var b=Ee(d),S=this.value,D=b.value,M=this.sign!==b.sign,L;if(b.isSmall){if(D===0)return f[0];if(D===1)return this;if(D===-1)return this.negate();if(L=Math.abs(D),L<s)return new h(Ye(S,L),M);D=Z(L)}return k(S.length,D.length)?new h($e(S,D),M):new h(st(S,D),M)},h.prototype.times=h.prototype.multiply;function ee(d,b,S){return d<s?new h(Ye(b,d),S):new h(st(b,Z(d)),S)}p.prototype._multiplyBySmall=function(d){return C(d.value*this.value)?new p(d.value*this.value):ee(Math.abs(d.value),Z(Math.abs(this.value)),this.sign!==d.sign)},h.prototype._multiplyBySmall=function(d){return d.value===0?f[0]:d.value===1?this:d.value===-1?this.negate():ee(Math.abs(d.value),this.value,this.sign!==d.sign)},p.prototype.multiply=function(d){return Ee(d)._multiplyBySmall(this)},p.prototype.times=p.prototype.multiply,T.prototype.multiply=function(d){return new T(this.value*Ee(d).value)},T.prototype.times=T.prototype.multiply;function J(d){var b=d.length,S=me(b+b),D=s,M,L,$,H,z;for($=0;$<b;$++){H=d[$],L=0-H*H;for(var ue=$;ue<b;ue++)z=d[ue],M=2*(H*z)+S[$+ue]+L,L=Math.floor(M/D),S[$+ue]=M-L*D;S[$+b]=L}return j(S),S}h.prototype.square=function(){return new h(J(this.value),!1)},p.prototype.square=function(){var d=this.value*this.value;return C(d)?new p(d):new h(J(Z(Math.abs(this.value))),!1)},T.prototype.square=function(d){return new T(this.value*this.value)};function q(d,b){var S=d.length,D=b.length,M=s,L=me(b.length),$=b[D-1],H=Math.ceil(M/(2*$)),z=Ye(d,H),ue=Ye(b,H),Pe,Ie,De,Et,Fe,wn,bt;for(z.length<=S&&z.push(0),ue.push(0),$=ue[D-1],Ie=S-D;Ie>=0;Ie--){for(Pe=M-1,z[Ie+D]!==$&&(Pe=Math.floor((z[Ie+D]*M+z[Ie+D-1])/$)),De=0,Et=0,wn=ue.length,Fe=0;Fe<wn;Fe++)De+=Pe*ue[Fe],bt=Math.floor(De/M),Et+=z[Ie+Fe]-(De-bt*M),De=bt,Et<0?(z[Ie+Fe]=Et+M,Et=-1):(z[Ie+Fe]=Et,Et=0);for(;Et!==0;){for(Pe-=1,De=0,Fe=0;Fe<wn;Fe++)De+=z[Ie+Fe]-M+ue[Fe],De<0?(z[Ie+Fe]=De+M,De=0):(z[Ie+Fe]=De,De=1);Et+=De}L[Ie]=Pe}return z=pe(z,H)[0],[V(L),V(z)]}function Q(d,b){for(var S=d.length,D=b.length,M=[],L=[],$=s,H,z,ue,Pe,Ie;S;){if(L.unshift(d[--S]),j(L),we(L,b)<0){M.push(0);continue}z=L.length,ue=L[z-1]*$+L[z-2],Pe=b[D-1]*$+b[D-2],z>D&&(ue=(ue+1)*$),H=Math.ceil(ue/Pe);do{if(Ie=Ye(b,H),we(Ie,L)<=0)break;H--}while(H);M.push(H),L=tt(L,Ie)}return M.reverse(),[V(M),V(L)]}function pe(d,b){var S=d.length,D=me(S),M=s,L,$,H,z;for(H=0,L=S-1;L>=0;--L)z=H*M+d[L],$=ne(z/b),H=z-$*b,D[L]=$|0;return[D,H|0]}function Oe(d,b){var S,D=Ee(b);if(g)return[new T(d.value/D.value),new T(d.value%D.value)];var M=d.value,L=D.value,$;if(L===0)throw new Error("Cannot divide by zero");if(d.isSmall)return D.isSmall?[new p(ne(M/L)),new p(M%L)]:[f[0],d];if(D.isSmall){if(L===1)return[d,f[0]];if(L==-1)return[d.negate(),f[0]];var H=Math.abs(L);if(H<s){S=pe(M,H),$=V(S[0]);var z=S[1];return d.sign&&(z=-z),typeof $=="number"?(d.sign!==D.sign&&($=-$),[new p($),new p(z)]):[new h($,d.sign!==D.sign),new p(z)]}L=Z(H)}var ue=we(M,L);if(ue===-1)return[f[0],d];if(ue===0)return[f[d.sign===D.sign?1:-1],f[0]];M.length+L.length<=200?S=q(M,L):S=Q(M,L),$=S[0];var Pe=d.sign!==D.sign,Ie=S[1],De=d.sign;return typeof $=="number"?(Pe&&($=-$),$=new p($)):$=new h($,Pe),typeof Ie=="number"?(De&&(Ie=-Ie),Ie=new p(Ie)):Ie=new h(Ie,De),[$,Ie]}h.prototype.divmod=function(d){var b=Oe(this,d);return{quotient:b[0],remainder:b[1]}},T.prototype.divmod=p.prototype.divmod=h.prototype.divmod,h.prototype.divide=function(d){return Oe(this,d)[0]},T.prototype.over=T.prototype.divide=function(d){return new T(this.value/Ee(d).value)},p.prototype.over=p.prototype.divide=h.prototype.over=h.prototype.divide,h.prototype.mod=function(d){return Oe(this,d)[1]},T.prototype.mod=T.prototype.remainder=function(d){return new T(this.value%Ee(d).value)},p.prototype.remainder=p.prototype.mod=h.prototype.remainder=h.prototype.mod,h.prototype.pow=function(d){var b=Ee(d),S=this.value,D=b.value,M,L,$;if(D===0)return f[1];if(S===0)return f[0];if(S===1)return f[1];if(S===-1)return b.isEven()?f[1]:f[-1];if(b.sign)return f[0];if(!b.isSmall)throw new Error("The exponent "+b.toString()+" is too large.");if(this.isSmall&&C(M=Math.pow(S,D)))return new p(ne(M));for(L=this,$=f[1];D&!0&&($=$.times(L),--D),D!==0;)D/=2,L=L.square();return $},p.prototype.pow=h.prototype.pow,T.prototype.pow=function(d){var b=Ee(d),S=this.value,D=b.value,M=BigInt(0),L=BigInt(1),$=BigInt(2);if(D===M)return f[1];if(S===M)return f[0];if(S===L)return f[1];if(S===BigInt(-1))return b.isEven()?f[1]:f[-1];if(b.isNegative())return new T(M);for(var H=this,z=f[1];(D&L)===L&&(z=z.times(H),--D),D!==M;)D/=$,H=H.square();return z},h.prototype.modPow=function(d,b){if(d=Ee(d),b=Ee(b),b.isZero())throw new Error("Cannot take modPow with modulus 0");var S=f[1],D=this.mod(b);for(d.isNegative()&&(d=d.multiply(f[-1]),D=D.modInv(b));d.isPositive();){if(D.isZero())return f[0];d.isOdd()&&(S=S.multiply(D).mod(b)),d=d.divide(2),D=D.square().mod(b)}return S},T.prototype.modPow=p.prototype.modPow=h.prototype.modPow;function we(d,b){if(d.length!==b.length)return d.length>b.length?1:-1;for(var S=d.length-1;S>=0;S--)if(d[S]!==b[S])return d[S]>b[S]?1:-1;return 0}h.prototype.compareAbs=function(d){var b=Ee(d),S=this.value,D=b.value;return b.isSmall?1:we(S,D)},p.prototype.compareAbs=function(d){var b=Ee(d),S=Math.abs(this.value),D=b.value;return b.isSmall?(D=Math.abs(D),S===D?0:S>D?1:-1):-1},T.prototype.compareAbs=function(d){var b=this.value,S=Ee(d).value;return b=b>=0?b:-b,S=S>=0?S:-S,b===S?0:b>S?1:-1},h.prototype.compare=function(d){if(d===1/0)return-1;if(d===-1/0)return 1;var b=Ee(d),S=this.value,D=b.value;return this.sign!==b.sign?b.sign?1:-1:b.isSmall?this.sign?-1:1:we(S,D)*(this.sign?-1:1)},h.prototype.compareTo=h.prototype.compare,p.prototype.compare=function(d){if(d===1/0)return-1;if(d===-1/0)return 1;var b=Ee(d),S=this.value,D=b.value;return b.isSmall?S==D?0:S>D?1:-1:S<0!==b.sign?S<0?-1:1:S<0?1:-1},p.prototype.compareTo=p.prototype.compare,T.prototype.compare=function(d){if(d===1/0)return-1;if(d===-1/0)return 1;var b=this.value,S=Ee(d).value;return b===S?0:b>S?1:-1},T.prototype.compareTo=T.prototype.compare,h.prototype.equals=function(d){return this.compare(d)===0},T.prototype.eq=T.prototype.equals=p.prototype.eq=p.prototype.equals=h.prototype.eq=h.prototype.equals,h.prototype.notEquals=function(d){return this.compare(d)!==0},T.prototype.neq=T.prototype.notEquals=p.prototype.neq=p.prototype.notEquals=h.prototype.neq=h.prototype.notEquals,h.prototype.greater=function(d){return this.compare(d)>0},T.prototype.gt=T.prototype.greater=p.prototype.gt=p.prototype.greater=h.prototype.gt=h.prototype.greater,h.prototype.lesser=function(d){return this.compare(d)<0},T.prototype.lt=T.prototype.lesser=p.prototype.lt=p.prototype.lesser=h.prototype.lt=h.prototype.lesser,h.prototype.greaterOrEquals=function(d){return this.compare(d)>=0},T.prototype.geq=T.prototype.greaterOrEquals=p.prototype.geq=p.prototype.greaterOrEquals=h.prototype.geq=h.prototype.greaterOrEquals,h.prototype.lesserOrEquals=function(d){return this.compare(d)<=0},T.prototype.leq=T.prototype.lesserOrEquals=p.prototype.leq=p.prototype.lesserOrEquals=h.prototype.leq=h.prototype.lesserOrEquals,h.prototype.isEven=function(){return(this.value[0]&1)===0},p.prototype.isEven=function(){return(this.value&1)===0},T.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},h.prototype.isOdd=function(){return(this.value[0]&1)===1},p.prototype.isOdd=function(){return(this.value&1)===1},T.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},h.prototype.isPositive=function(){return!this.sign},p.prototype.isPositive=function(){return this.value>0},T.prototype.isPositive=p.prototype.isPositive,h.prototype.isNegative=function(){return this.sign},p.prototype.isNegative=function(){return this.value<0},T.prototype.isNegative=p.prototype.isNegative,h.prototype.isUnit=function(){return!1},p.prototype.isUnit=function(){return Math.abs(this.value)===1},T.prototype.isUnit=function(){return this.abs().value===BigInt(1)},h.prototype.isZero=function(){return!1},p.prototype.isZero=function(){return this.value===0},T.prototype.isZero=function(){return this.value===BigInt(0)},h.prototype.isDivisibleBy=function(d){var b=Ee(d);return b.isZero()?!1:b.isUnit()?!0:b.compareAbs(2)===0?this.isEven():this.mod(b).isZero()},T.prototype.isDivisibleBy=p.prototype.isDivisibleBy=h.prototype.isDivisibleBy;function Ve(d){var b=d.abs();if(b.isUnit())return!1;if(b.equals(2)||b.equals(3)||b.equals(5))return!0;if(b.isEven()||b.isDivisibleBy(3)||b.isDivisibleBy(5))return!1;if(b.lesser(49))return!0}function Me(d,b){for(var S=d.prev(),D=S,M=0,L,$,H;D.isEven();)D=D.divide(2),M++;e:for($=0;$<b.length;$++)if(!d.lesser(b[$])&&(H=e(b[$]).modPow(D,d),!(H.isUnit()||H.equals(S)))){for(L=M-1;L!=0;L--){if(H=H.square().mod(d),H.isUnit())return!1;if(H.equals(S))continue e}return!1}return!0}h.prototype.isPrime=function(d){var b=Ve(this);if(b!==t)return b;var S=this.abs(),D=S.bitLength();if(D<=64)return Me(S,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var M=Math.log(2)*D.toJSNumber(),L=Math.ceil(d===!0?2*Math.pow(M,2):M),$=[],H=0;H<L;H++)$.push(e(H+2));return Me(S,$)},T.prototype.isPrime=p.prototype.isPrime=h.prototype.isPrime,h.prototype.isProbablePrime=function(d,b){var S=Ve(this);if(S!==t)return S;for(var D=this.abs(),M=d===t?5:d,L=[],$=0;$<M;$++)L.push(e.randBetween(2,D.minus(2),b));return Me(D,L)},T.prototype.isProbablePrime=p.prototype.isProbablePrime=h.prototype.isProbablePrime,h.prototype.modInv=function(d){for(var b=e.zero,S=e.one,D=Ee(d),M=this.abs(),L,$,H;!M.isZero();)L=D.divide(M),$=b,H=D,b=S,D=M,S=$.subtract(L.multiply(S)),M=H.subtract(L.multiply(M));if(!D.isUnit())throw new Error(this.toString()+" and "+d.toString()+" are not co-prime");return b.compare(0)===-1&&(b=b.add(d)),this.isNegative()?b.negate():b},T.prototype.modInv=p.prototype.modInv=h.prototype.modInv,h.prototype.next=function(){var d=this.value;return this.sign?ct(d,1,this.sign):new h(Ke(d,1),this.sign)},p.prototype.next=function(){var d=this.value;return d+1<i?new p(d+1):new h(l,!1)},T.prototype.next=function(){return new T(this.value+BigInt(1))},h.prototype.prev=function(){var d=this.value;return this.sign?new h(Ke(d,1),!0):ct(d,1,this.sign)},p.prototype.prev=function(){var d=this.value;return d-1>-i?new p(d-1):new h(l,!0)},T.prototype.prev=function(){return new T(this.value-BigInt(1))};for(var rt=[1];2*rt[rt.length-1]<=s;)rt.push(2*rt[rt.length-1]);var yt=rt.length,xt=rt[yt-1];function Fs(d){return Math.abs(d)<=s}h.prototype.shiftLeft=function(d){var b=Ee(d).toJSNumber();if(!Fs(b))throw new Error(String(b)+" is too large for shifting.");if(b<0)return this.shiftRight(-b);var S=this;if(S.isZero())return S;for(;b>=yt;)S=S.multiply(xt),b-=yt-1;return S.multiply(rt[b])},T.prototype.shiftLeft=p.prototype.shiftLeft=h.prototype.shiftLeft,h.prototype.shiftRight=function(d){var b,S=Ee(d).toJSNumber();if(!Fs(S))throw new Error(String(S)+" is too large for shifting.");if(S<0)return this.shiftLeft(-S);for(var D=this;S>=yt;){if(D.isZero()||D.isNegative()&&D.isUnit())return D;b=Oe(D,xt),D=b[1].isNegative()?b[0].prev():b[0],S-=yt-1}return b=Oe(D,rt[S]),b[1].isNegative()?b[0].prev():b[0]},T.prototype.shiftRight=p.prototype.shiftRight=h.prototype.shiftRight;function Cn(d,b,S){b=Ee(b);for(var D=d.isNegative(),M=b.isNegative(),L=D?d.not():d,$=M?b.not():b,H=0,z=0,ue=null,Pe=null,Ie=[];!L.isZero()||!$.isZero();)ue=Oe(L,xt),H=ue[1].toJSNumber(),D&&(H=xt-1-H),Pe=Oe($,xt),z=Pe[1].toJSNumber(),M&&(z=xt-1-z),L=ue[0],$=Pe[0],Ie.push(S(H,z));for(var De=S(D?1:0,M?1:0)!==0?e(-1):e(0),Et=Ie.length-1;Et>=0;Et-=1)De=De.multiply(xt).add(e(Ie[Et]));return De}h.prototype.not=function(){return this.negate().prev()},T.prototype.not=p.prototype.not=h.prototype.not,h.prototype.and=function(d){return Cn(this,d,function(b,S){return b&S})},T.prototype.and=p.prototype.and=h.prototype.and,h.prototype.or=function(d){return Cn(this,d,function(b,S){return b|S})},T.prototype.or=p.prototype.or=h.prototype.or,h.prototype.xor=function(d){return Cn(this,d,function(b,S){return b^S})},T.prototype.xor=p.prototype.xor=h.prototype.xor;var Re=1<<30,bn=(s&-s)*(s&-s)|Re;function Vt(d){var b=d.value,S=typeof b=="number"?b|Re:typeof b=="bigint"?b|BigInt(Re):b[0]+b[1]*s|bn;return S&-S}function Gt(d,b){if(b.compareTo(d)<=0){var S=Gt(d,b.square(b)),D=S.p,M=S.e,L=D.multiply(b);return L.compareTo(d)<=0?{p:L,e:M*2+1}:{p:D,e:M*2}}return{p:e(1),e:0}}h.prototype.bitLength=function(){var d=this;return d.compareTo(e(0))<0&&(d=d.negate().subtract(e(1))),d.compareTo(e(0))===0?e(0):e(Gt(d,e(2)).e).add(e(1))},T.prototype.bitLength=p.prototype.bitLength=h.prototype.bitLength;function vs(d,b){return d=Ee(d),b=Ee(b),d.greater(b)?d:b}function Wn(d,b){return d=Ee(d),b=Ee(b),d.lesser(b)?d:b}function js(d,b){if(d=Ee(d).abs(),b=Ee(b).abs(),d.equals(b))return d;if(d.isZero())return b;if(b.isZero())return d;for(var S=f[1],D,M;d.isEven()&&b.isEven();)D=Wn(Vt(d),Vt(b)),d=d.divide(D),b=b.divide(D),S=S.multiply(D);for(;d.isEven();)d=d.divide(Vt(d));do{for(;b.isEven();)b=b.divide(Vt(b));d.greater(b)&&(M=b,b=d,d=M),b=b.subtract(d)}while(!b.isZero());return S.isUnit()?d:d.multiply(S)}function bs(d,b){return d=Ee(d).abs(),b=Ee(b).abs(),d.divide(js(d,b)).multiply(b)}function _s(d,b,S){d=Ee(d),b=Ee(b);var D=S||Math.random,M=Wn(d,b),L=vs(d,b),$=L.subtract(M).add(1);if($.isSmall)return M.add(Math.floor(D()*$));for(var H=vt($,s).value,z=[],ue=!0,Pe=0;Pe<H.length;Pe++){var Ie=ue?H[Pe]+(Pe+1<H.length?H[Pe+1]/s:0):s,De=ne(D()*Ie);z.push(De),De<H[Pe]&&(ue=!1)}return M.add(f.fromArray(z,s,!1))}var _n=function(d,b,S,D){S=S||c,d=String(d),D||(d=d.toLowerCase(),S=S.toLowerCase());var M=d.length,L,$=Math.abs(b),H={};for(L=0;L<S.length;L++)H[S[L]]=L;for(L=0;L<M;L++){var z=d[L];if(z!=="-"&&z in H&&H[z]>=$){if(z==="1"&&$===1)continue;throw new Error(z+" is not a valid digit in base "+b+".")}}b=Ee(b);var ue=[],Pe=d[0]==="-";for(L=Pe?1:0;L<d.length;L++){var z=d[L];if(z in H)ue.push(Ee(H[z]));else if(z==="<"){var Ie=L;do L++;while(d[L]!==">"&&L<d.length);ue.push(Ee(d.slice(Ie+1,L)))}else throw new Error(z+" is not a valid character")}return ws(ue,b,Pe)};function ws(d,b,S){var D=f[0],M=f[1],L;for(L=d.length-1;L>=0;L--)D=D.add(d[L].times(M)),M=M.times(b);return S?D.negate():D}function Kn(d,b){return b=b||c,d<b.length?b[d]:"<"+d+">"}function vt(d,b){if(b=e(b),b.isZero()){if(d.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(b.equals(-1)){if(d.isZero())return{value:[0],isNegative:!1};if(d.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-d.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var S=Array.apply(null,Array(d.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return S.unshift([1]),{value:[].concat.apply([],S),isNegative:!1}}var D=!1;if(d.isNegative()&&b.isPositive()&&(D=!0,d=d.abs()),b.isUnit())return d.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(d.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:D};for(var M=[],L=d,$;L.isNegative()||L.compareAbs(b)>=0;){$=L.divmod(b),L=$.quotient;var H=$.remainder;H.isNegative()&&(H=b.minus(H).abs(),L=L.next()),M.push(H.toJSNumber())}return M.push(L.toJSNumber()),{value:M.reverse(),isNegative:D}}function ln(d,b,S){var D=vt(d,b);return(D.isNegative?"-":"")+D.value.map(function(M){return Kn(M,S)}).join("")}h.prototype.toArray=function(d){return vt(this,d)},p.prototype.toArray=function(d){return vt(this,d)},T.prototype.toArray=function(d){return vt(this,d)},h.prototype.toString=function(d,b){if(d===t&&(d=10),d!==10||b)return ln(this,d,b);for(var S=this.value,D=S.length,M=String(S[--D]),L="0000000",$;--D>=0;)$=String(S[D]),M+=L.slice($.length)+$;var H=this.sign?"-":"";return H+M},p.prototype.toString=function(d,b){return d===t&&(d=10),d!=10||b?ln(this,d,b):String(this.value)},T.prototype.toString=p.prototype.toString,T.prototype.toJSON=h.prototype.toJSON=p.prototype.toJSON=function(){return this.toString()},h.prototype.valueOf=function(){return parseInt(this.toString(),10)},h.prototype.toJSNumber=h.prototype.valueOf,p.prototype.valueOf=function(){return this.value},p.prototype.toJSNumber=p.prototype.valueOf,T.prototype.valueOf=T.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function Es(d){if(C(+d)){var b=+d;if(b===ne(b))return g?new T(BigInt(b)):new p(b);throw new Error("Invalid integer: "+d)}var S=d[0]==="-";S&&(d=d.slice(1));var D=d.split(/e/i);if(D.length>2)throw new Error("Invalid integer: "+D.join("e"));if(D.length===2){var M=D[1];if(M[0]==="+"&&(M=M.slice(1)),M=+M,M!==ne(M)||!C(M))throw new Error("Invalid integer: "+M+" is not a valid exponent.");var L=D[0],$=L.indexOf(".");if($>=0&&(M-=L.length-$-1,L=L.slice(0,$)+L.slice($+1)),M<0)throw new Error("Cannot include negative exponent part for integers");L+=new Array(M+1).join("0"),d=L}var H=/^([0-9][0-9]*)$/.test(d);if(!H)throw new Error("Invalid integer: "+d);if(g)return new T(BigInt(S?"-"+d:d));for(var z=[],ue=d.length,Pe=r,Ie=ue-Pe;ue>0;)z.push(+d.slice(Ie,ue)),Ie-=Pe,Ie<0&&(Ie=0),ue-=Pe;return j(z),new h(z,S)}function Hs(d){if(g)return new T(BigInt(d));if(C(d)){if(d!==ne(d))throw new Error(d+" is not an integer.");return new p(d)}return Es(d.toString())}function Ee(d){return typeof d=="number"?Hs(d):typeof d=="string"?Es(d):typeof d=="bigint"?new T(d):d}for(var Yt=0;Yt<1e3;Yt++)f[Yt]=Ee(Yt),Yt>0&&(f[-Yt]=Ee(-Yt));return f.one=f[1],f.zero=f[0],f.minusOne=f[-1],f.max=vs,f.min=Wn,f.gcd=js,f.lcm=bs,f.isInstance=function(d){return d instanceof h||d instanceof p||d instanceof T},f.randBetween=_s,f.fromArray=function(d,b,S){return ws(d.map(Ee),Ee(b||10),S)},f}();n.hasOwnProperty("exports")&&(n.exports=e)})(Ko);var Su=Ko.exports,qo=Aa(Su);const Yo=64,ma=16,as=Yo/ma;function Iu(){try{return!0}catch{return!1}}function Au(n,e,t){let s=0;for(let r=0;r<t;r++){const i=n[e+r];if(i===void 0)break;s+=i*16**r}return s}function Xo(n){const e=[];for(let t=0;t<n.length;t++){let s=Number(n[t]);for(let r=0;s||r<e.length;r++)s+=(e[r]||0)*10,e[r]=s%16,s=(s-e[r])/16}return e}function Ou(n){const e=Xo(n),t=Array(as);for(let s=0;s<as;s++)t[as-1-s]=Au(e,s*as,as);return t}class On{static fromString(e){return new On(Ou(e),e)}static fromBit(e){const t=Array(as),s=Math.floor(e/ma);for(let r=0;r<as;r++)t[as-1-r]=r===s?1<<e-s*ma:0;return new On(t)}constructor(e,t){this.parts=e,this.str=t}and({parts:e}){return new On(this.parts.map((t,s)=>t&e[s]))}or({parts:e}){return new On(this.parts.map((t,s)=>t|e[s]))}xor({parts:e}){return new On(this.parts.map((t,s)=>t^e[s]))}not(){return new On(this.parts.map(e=>~e))}equals({parts:e}){return this.parts.every((t,s)=>t===e[s])}toString(){if(this.str!=null)return this.str;const e=new Array(Yo/4);return this.parts.forEach((t,s)=>{const r=Xo(t.toString());for(let i=0;i<4;i++)e[i+s*4]=r[3-i]||0}),this.str=qo.fromArray(e,16).toString()}toJSON(){return this.toString()}}const ys=Iu();ys&&BigInt.prototype.toJSON==null&&(BigInt.prototype.toJSON=function(){return this.toString()});const si={},Jo=ys?function(e){return BigInt(e)}:function(e){return e instanceof On?e:(typeof e=="number"&&(e=e.toString()),si[e]!=null||(si[e]=On.fromString(e)),si[e])},Nt=Jo(0),Oi=ys?function(e=Nt,t=Nt){return e&t}:function(e=Nt,t=Nt){return e.and(t)},Qo=ys?function(e=Nt,t=Nt){return e|t}:function(e=Nt,t=Nt){return e.or(t)},xu=ys?function(e=Nt,t=Nt){return e^t}:function(e=Nt,t=Nt){return e.xor(t)},Du=ys?function(e=Nt){return~e}:function(e=Nt){return e.not()},Ra=ys?function(e,t){return e===t}:function(e,t){return e==null||t==null?e==t:e.equals(t)};function Nu(...n){let e=n[0];for(let t=1;t<n.length;t++)e=Qo(e,n[t]);return e}function Ru(n,e){return Ra(Oi(n,e),e)}function Pu(n,e){return!Ra(Oi(n,e),Nt)}function ku(n,e){return e===Nt?n:Qo(n,e)}function Lu(n,e){return e===Nt?n:xu(n,Oi(n,e))}const Bu=ys?function(e){return BigInt(1)<<BigInt(e)}:function(e){return On.fromBit(e)};var ro={combine:Nu,add:ku,remove:Lu,filter:Oi,invert:Du,has:Ru,hasAny:Pu,equals:Ra,deserialize:Jo,getFlag:Bu},io;(function(n){n[n.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",n[n.CLOSE_UNSUPPORTED=1003]="CLOSE_UNSUPPORTED",n[n.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",n[n.INVALID_CLIENTID=4e3]="INVALID_CLIENTID",n[n.INVALID_ORIGIN=4001]="INVALID_ORIGIN",n[n.RATELIMITED=4002]="RATELIMITED",n[n.TOKEN_REVOKED=4003]="TOKEN_REVOKED",n[n.INVALID_VERSION=4004]="INVALID_VERSION",n[n.INVALID_ENCODING=4005]="INVALID_ENCODING"})(io||(io={}));var ya;(function(n){n[n.INVALID_PAYLOAD=4e3]="INVALID_PAYLOAD",n[n.INVALID_COMMAND=4002]="INVALID_COMMAND",n[n.INVALID_EVENT=4004]="INVALID_EVENT",n[n.INVALID_PERMISSIONS=4006]="INVALID_PERMISSIONS"})(ya||(ya={}));var va;(function(n){n.LANDSCAPE="landscape",n.PORTRAIT="portrait"})(va||(va={}));var Hn;(function(n){n.MOBILE="mobile",n.DESKTOP="desktop"})(Hn||(Hn={}));Object.freeze({CREATE_INSTANT_INVITE:ro.getFlag(0),ADMINISTRATOR:ro.getFlag(3)});function Lt(n){return Wo(e=>{var t;const[s]=(t=Object.entries(n).find(([,r])=>r===e))!==null&&t!==void 0?t:[];return e!=null&&s===void 0?n.UNHANDLED:e},A().or(be()))}function Cu(n){const e=xa().transform(t=>{const s=n.safeParse(t);return s.success?s.data:n._def.defaultValue()});return e.overlayType=n,e}const Mu=ge.object({image_url:ge.string()}),Uu=ge.object({mediaUrl:ge.string().max(1024)}),$u=ge.object({access_token:ge.union([ge.string(),ge.null()]).optional()}),el=ge.object({access_token:ge.string(),user:ge.object({username:ge.string(),discriminator:ge.string(),id:ge.string(),avatar:ge.union([ge.string(),ge.null()]).optional(),public_flags:ge.number(),global_name:ge.union([ge.string(),ge.null()]).optional()}),scopes:ge.array(Cu(ge.enum(["identify","email","connections","guilds","guilds.join","guilds.members.read","guilds.channels.read","gdm.join","bot","rpc","rpc.notifications.read","rpc.voice.read","rpc.voice.write","rpc.video.read","rpc.video.write","rpc.screenshare.read","rpc.screenshare.write","rpc.activities.write","webhook.incoming","messages.read","applications.builds.upload","applications.builds.read","applications.commands","applications.commands.permissions.update","applications.commands.update","applications.store.update","applications.entitlements","activities.read","activities.write","relationships.read","relationships.write","voice","dm_channels.read","role_connections.write","presences.read","presences.write","openid","dm_channels.messages.read","dm_channels.messages.write","gateway.connect","account.global_name.update","payment_sources.country_code","sdk.social_layer"]).or(ge.literal(-1)).default(-1))),expires:ge.string(),application:ge.object({description:ge.string(),icon:ge.union([ge.string(),ge.null()]).optional(),id:ge.string(),rpc_origins:ge.array(ge.string()).optional(),name:ge.string()})}),tl=ge.object({participants:ge.array(ge.object({id:ge.string(),username:ge.string(),global_name:ge.union([ge.string(),ge.null()]).optional(),discriminator:ge.string(),avatar:ge.union([ge.string(),ge.null()]).optional(),flags:ge.number(),bot:ge.boolean(),avatar_decoration_data:ge.union([ge.object({asset:ge.string(),skuId:ge.string().optional()}),ge.null()]).optional(),premium_type:ge.union([ge.number(),ge.null()]).optional(),nickname:ge.string().optional()}))});var Dn;(function(n){n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.AUTHENTICATE="AUTHENTICATE",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(Dn||(Dn={}));const Vu=ge.object({}).optional().nullable(),ao=ge.void(),nl={[Dn.INITIATE_IMAGE_UPLOAD]:{request:ao,response:Mu},[Dn.OPEN_SHARE_MOMENT_DIALOG]:{request:Uu,response:Vu},[Dn.AUTHENTICATE]:{request:$u,response:el},[Dn.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS]:{request:ao,response:tl}},Fu="DISPATCH";var _e;(function(n){n.AUTHORIZE="AUTHORIZE",n.AUTHENTICATE="AUTHENTICATE",n.GET_GUILDS="GET_GUILDS",n.GET_GUILD="GET_GUILD",n.GET_CHANNEL="GET_CHANNEL",n.GET_CHANNELS="GET_CHANNELS",n.SELECT_VOICE_CHANNEL="SELECT_VOICE_CHANNEL",n.SELECT_TEXT_CHANNEL="SELECT_TEXT_CHANNEL",n.SUBSCRIBE="SUBSCRIBE",n.UNSUBSCRIBE="UNSUBSCRIBE",n.CAPTURE_SHORTCUT="CAPTURE_SHORTCUT",n.SET_CERTIFIED_DEVICES="SET_CERTIFIED_DEVICES",n.SET_ACTIVITY="SET_ACTIVITY",n.GET_SKUS="GET_SKUS",n.GET_ENTITLEMENTS="GET_ENTITLEMENTS",n.GET_SKUS_EMBEDDED="GET_SKUS_EMBEDDED",n.GET_ENTITLEMENTS_EMBEDDED="GET_ENTITLEMENTS_EMBEDDED",n.START_PURCHASE="START_PURCHASE",n.SET_CONFIG="SET_CONFIG",n.SEND_ANALYTICS_EVENT="SEND_ANALYTICS_EVENT",n.USER_SETTINGS_GET_LOCALE="USER_SETTINGS_GET_LOCALE",n.OPEN_EXTERNAL_LINK="OPEN_EXTERNAL_LINK",n.ENCOURAGE_HW_ACCELERATION="ENCOURAGE_HW_ACCELERATION",n.CAPTURE_LOG="CAPTURE_LOG",n.SET_ORIENTATION_LOCK_STATE="SET_ORIENTATION_LOCK_STATE",n.OPEN_INVITE_DIALOG="OPEN_INVITE_DIALOG",n.GET_PLATFORM_BEHAVIORS="GET_PLATFORM_BEHAVIORS",n.GET_CHANNEL_PERMISSIONS="GET_CHANNEL_PERMISSIONS",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS"})(_e||(_e={}));const ar=se({cmd:A(),data:Dr(),evt:Da(),nonce:A()}).passthrough(),ju=Object.assign(Object.assign({},el.shape.scopes.element.overlayType._def.innerType.options[0].Values),{UNHANDLED:-1});Lt(ju);const gs=se({id:A(),username:A(),discriminator:A(),global_name:A().optional().nullable(),avatar:A().optional().nullable(),avatar_decoration_data:se({asset:A(),sku_id:A().optional()}).nullable(),bot:xe(),flags:be().optional().nullable(),premium_type:be().optional().nullable()}),Pa=se({user:gs,nick:A().optional().nullable(),roles:Ge(A()),joined_at:A(),deaf:xe(),mute:xe()}),Hu=se({user_id:A(),nick:A().optional().nullable(),guild_id:A(),avatar:A().optional().nullable(),avatar_decoration_data:se({asset:A(),sku_id:A().optional().nullable()}).optional().nullable(),color_string:A().optional().nullable()}),ka=se({id:A(),name:A().optional().nullable(),roles:Ge(A()).optional().nullable(),user:gs.optional().nullable(),require_colons:xe().optional().nullable(),managed:xe().optional().nullable(),animated:xe().optional().nullable(),available:xe().optional().nullable()}),sl=se({mute:xe(),deaf:xe(),self_mute:xe(),self_deaf:xe(),suppress:xe()}),rl=se({mute:xe(),nick:A(),user:gs,voice_state:sl,volume:be()}),Gu={UNHANDLED:-1,IDLE:"idle",DND:"dnd",ONLINE:"online",OFFLINE:"offline"},ri=Lt(Gu),pr=se({name:A(),type:be(),url:A().optional().nullable(),created_at:be().optional().nullable(),timestamps:se({start:be(),end:be()}).partial().optional().nullable(),application_id:A().optional().nullable(),details:A().optional().nullable(),state:A().optional().nullable(),emoji:ka.optional().nullable(),party:se({id:A().optional().nullable(),size:Ge(be()).optional().nullable()}).optional().nullable(),assets:se({large_image:A().nullable(),large_text:A().nullable(),small_image:A().nullable(),small_text:A().nullable()}).partial().optional().nullable(),secrets:se({join:A(),match:A()}).partial().optional().nullable(),instance:xe().optional().nullable(),flags:be().optional().nullable()}),Zu={UNHANDLED:-1,ROLE:0,MEMBER:1},zu=se({id:A(),type:Lt(Zu),allow:A(),deny:A()}),La={UNHANDLED:-1,DM:1,GROUP_DM:3,GUILD_TEXT:0,GUILD_VOICE:2,GUILD_CATEGORY:4,GUILD_ANNOUNCEMENT:5,GUILD_STORE:6,ANNOUNCEMENT_THREAD:10,PUBLIC_THREAD:11,PRIVATE_THREAD:12,GUILD_STAGE_VOICE:13,GUILD_DIRECTORY:14,GUILD_FORUM:15},il=se({id:A(),type:Lt(La),guild_id:A().optional().nullable(),position:be().optional().nullable(),permission_overwrites:Ge(zu).optional().nullable(),name:A().optional().nullable(),topic:A().optional().nullable(),nsfw:xe().optional().nullable(),last_message_id:A().optional().nullable(),bitrate:be().optional().nullable(),user_limit:be().optional().nullable(),rate_limit_per_user:be().optional().nullable(),recipients:Ge(gs).optional().nullable(),icon:A().optional().nullable(),owner_id:A().optional().nullable(),application_id:A().optional().nullable(),parent_id:A().optional().nullable(),last_pin_timestamp:A().optional().nullable()}),Wu=se({user:gs,guild_id:A(),status:ri,activities:Ge(pr),client_status:se({desktop:ri,mobile:ri,web:ri}).partial()}),Ku=se({id:A(),name:A(),color:be(),hoist:xe(),position:be(),permissions:A(),managed:xe(),mentionable:xe()});se({id:A(),name:A(),owner_id:A(),icon:A().nullable(),icon_hash:A().optional().nullable(),splash:A().nullable(),discovery_splash:A().nullable(),owner:xe().optional().nullable(),permissions:A().optional().nullable(),region:A(),afk_channel_id:A().nullable(),afk_timeout:be(),widget_enabled:xe().optional().nullable(),widget_channel_id:A().optional().nullable(),verification_level:be(),default_message_notifications:be(),explicit_content_filter:be(),roles:Ge(Ku),emojis:Ge(ka),features:Ge(A()),mfa_level:be(),application_id:A().nullable(),system_channel_id:A().nullable(),system_channel_flags:be(),rules_channel_id:A().nullable(),joined_at:A().optional().nullable(),large:xe().optional().nullable(),unavailable:xe().optional().nullable(),member_count:be().optional().nullable(),voice_states:Ge(sl).optional().nullable(),members:Ge(Pa).optional().nullable(),channels:Ge(il).optional().nullable(),presences:Ge(Wu).optional().nullable(),max_presences:be().optional().nullable(),max_members:be().optional().nullable(),vanity_url_code:A().nullable(),description:A().nullable(),banner:A().nullable(),premium_tier:be(),premium_subscription_count:be().optional().nullable(),preferred_locale:A(),public_updates_channel_id:A().nullable(),max_video_channel_users:be().optional().nullable(),approximate_member_count:be().optional().nullable(),approximate_presence_count:be().optional().nullable()});const qu=se({id:A(),guild_id:A(),type:be(),name:A()}),Yu=se({id:A(),filename:A(),size:be(),url:A(),proxy_url:A(),height:be().optional().nullable(),width:be().optional().nullable()}),Xu=se({text:A(),icon_url:A().optional().nullable(),proxy_icon_url:A().optional().nullable()}),ba=se({url:A().optional().nullable(),proxy_url:A().optional().nullable(),height:be().optional().nullable(),width:be().optional().nullable()}),Ju=ba.omit({proxy_url:!0}),Qu=se({name:A().optional().nullable(),url:A().optional().nullable()}),ef=se({name:A().optional().nullable(),url:A().optional().nullable(),icon_url:A().optional().nullable(),proxy_icon_url:A().optional().nullable()}),tf=se({name:A(),value:A(),inline:xe()}),nf=se({title:A().optional().nullable(),type:A().optional().nullable(),description:A().optional().nullable(),url:A().optional().nullable(),timestamp:A().optional().nullable(),color:be().optional().nullable(),footer:Xu.optional().nullable(),image:ba.optional().nullable(),thumbnail:ba.optional().nullable(),video:Ju.optional().nullable(),provider:Qu.optional().nullable(),author:ef.optional().nullable(),fields:Ge(tf).optional().nullable()}),sf=se({count:be(),me:xe(),emoji:ka}),rf=se({type:be(),party_id:A().optional().nullable()}),af=se({id:A(),cover_image:A().optional().nullable(),description:A(),icon:A().optional().nullable(),name:A()}),of=se({message_id:A().optional().nullable(),channel_id:A().optional().nullable(),guild_id:A().optional().nullable()}),lf=se({id:A(),channel_id:A(),guild_id:A().optional().nullable(),author:gs.optional().nullable(),member:Pa.optional().nullable(),content:A(),timestamp:A(),edited_timestamp:A().optional().nullable(),tts:xe(),mention_everyone:xe(),mentions:Ge(gs),mention_roles:Ge(A()),mention_channels:Ge(qu),attachments:Ge(Yu),embeds:Ge(nf),reactions:Ge(sf).optional().nullable(),nonce:Na([A(),be()]).optional().nullable(),pinned:xe(),webhook_id:A().optional().nullable(),type:be(),activity:rf.optional().nullable(),application:af.optional().nullable(),message_reference:of.optional().nullable(),flags:be().optional().nullable(),stickers:Ge(Dr()).optional().nullable(),referenced_message:Dr().optional().nullable()}),cf=se({id:A(),name:A()}),uf={UNHANDLED:-1,KEYBOARD_KEY:0,MOUSE_BUTTON:1,KEYBOARD_MODIFIER_KEY:2,GAMEPAD_BUTTON:3},al=se({type:Lt(uf),code:be(),name:A()}),ff={UNHANDLED:-1,PUSH_TO_TALK:"PUSH_TO_TALK",VOICE_ACTIVITY:"VOICE_ACTIVITY"},df=se({type:Lt(ff),auto_threshold:xe(),threshold:be(),shortcut:Ge(al),delay:be()}),oo=se({device_id:A(),volume:be(),available_devices:Ge(cf)}),hf={UNHANDLED:-1,AUDIO_INPUT:"AUDIO_INPUT",AUDIO_OUTPUT:"AUDIO_OUTPUT",VIDEO_INPUT:"VIDEO_INPUT"};se({type:Lt(hf),id:A(),vendor:se({name:A(),url:A()}),model:se({name:A(),url:A()}),related:Ge(A()),echo_cancellation:xe().optional().nullable(),noise_suppression:xe().optional().nullable(),automatic_gain_control:xe().optional().nullable(),hardware_mute:xe().optional().nullable()});const pf={UNHANDLED:-1,APPLICATION:1,DLC:2,CONSUMABLE:3,BUNDLE:4,SUBSCRIPTION:5},gf=se({id:A(),name:A(),type:Lt(pf),price:se({amount:be(),currency:A()}),application_id:A(),flags:be(),release_date:A().nullable()}),mf={UNHANDLED:-1,PURCHASE:1,PREMIUM_SUBSCRIPTION:2,DEVELOPER_GIFT:3,TEST_MODE_PURCHASE:4,FREE_PURCHASE:5,USER_GIFT:6,PREMIUM_PURCHASE:7},Ba=se({id:A(),sku_id:A(),application_id:A(),user_id:A(),gift_code_flags:be(),type:Lt(mf),gifter_user_id:A().optional().nullable(),branches:Ge(A()).optional().nullable(),starts_at:A().optional().nullable(),ends_at:A().optional().nullable(),parent_id:A().optional().nullable(),consumed:xe().optional().nullable(),deleted:xe().optional().nullable(),gift_code_batch_id:A().optional().nullable()}),yf={UNHANDLED:-1,UNLOCKED:1,PORTRAIT:2,LANDSCAPE:3};Lt(yf);const vf={UNHANDLED:-1,NOMINAL:0,FAIR:1,SERIOUS:2,CRITICAL:3},bf=Lt(vf),ol={UNHANDLED:-1,PORTRAIT:0,LANDSCAPE:1};Lt(ol);const ll={UNHANDLED:-1,FOCUSED:0,PIP:1,GRID:2};Lt(ll);const Ca="ERROR";var We;(function(n){n.READY="READY",n.VOICE_STATE_UPDATE="VOICE_STATE_UPDATE",n.SPEAKING_START="SPEAKING_START",n.SPEAKING_STOP="SPEAKING_STOP",n.ACTIVITY_LAYOUT_MODE_UPDATE="ACTIVITY_LAYOUT_MODE_UPDATE",n.ORIENTATION_UPDATE="ORIENTATION_UPDATE",n.CURRENT_USER_UPDATE="CURRENT_USER_UPDATE",n.CURRENT_GUILD_MEMBER_UPDATE="CURRENT_GUILD_MEMBER_UPDATE",n.ENTITLEMENT_CREATE="ENTITLEMENT_CREATE",n.THERMAL_STATE_UPDATE="THERMAL_STATE_UPDATE",n.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE="ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE"})(We||(We={}));const Wt=ar.extend({evt:ir(We),nonce:A().nullable(),cmd:wt(Fu),data:se({}).passthrough()}),cl=ar.extend({evt:wt(Ca),data:se({code:be(),message:A().optional()}).passthrough(),cmd:ir(_e),nonce:A().nullable()}),_f=Wt.extend({evt:A()}),wf=Na([Wt,_f,cl]);function Ef(n){const e=n.evt;if(!(e in We))throw new Error(`Unrecognized event type ${n.evt}`);return Tf[e].payload.parse(n)}const Tf={[We.READY]:{payload:Wt.extend({evt:wt(We.READY),data:se({v:be(),config:se({cdn_host:A().optional(),api_endpoint:A(),environment:A()}),user:se({id:A(),username:A(),discriminator:A(),avatar:A().optional()}).optional()})})},[We.VOICE_STATE_UPDATE]:{payload:Wt.extend({evt:wt(We.VOICE_STATE_UPDATE),data:rl}),subscribeArgs:se({channel_id:A()})},[We.SPEAKING_START]:{payload:Wt.extend({evt:wt(We.SPEAKING_START),data:se({lobby_id:A().optional(),channel_id:A().optional(),user_id:A()})}),subscribeArgs:se({lobby_id:A().nullable().optional(),channel_id:A().nullable().optional()})},[We.SPEAKING_STOP]:{payload:Wt.extend({evt:wt(We.SPEAKING_STOP),data:se({lobby_id:A().optional(),channel_id:A().optional(),user_id:A()})}),subscribeArgs:se({lobby_id:A().nullable().optional(),channel_id:A().nullable().optional()})},[We.ACTIVITY_LAYOUT_MODE_UPDATE]:{payload:Wt.extend({evt:wt(We.ACTIVITY_LAYOUT_MODE_UPDATE),data:se({layout_mode:Lt(ll)})})},[We.ORIENTATION_UPDATE]:{payload:Wt.extend({evt:wt(We.ORIENTATION_UPDATE),data:se({screen_orientation:Lt(ol),orientation:ir(va)})})},[We.CURRENT_USER_UPDATE]:{payload:Wt.extend({evt:wt(We.CURRENT_USER_UPDATE),data:gs})},[We.CURRENT_GUILD_MEMBER_UPDATE]:{payload:Wt.extend({evt:wt(We.CURRENT_GUILD_MEMBER_UPDATE),data:Hu}),subscribeArgs:se({guild_id:A()})},[We.ENTITLEMENT_CREATE]:{payload:Wt.extend({evt:wt(We.ENTITLEMENT_CREATE),data:se({entitlement:Ba})})},[We.THERMAL_STATE_UPDATE]:{payload:Wt.extend({evt:wt(We.THERMAL_STATE_UPDATE),data:se({thermal_state:bf})})},[We.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE]:{payload:Wt.extend({evt:wt(We.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE),data:se({participants:tl.shape.participants})})}};function Sf(n,e){throw e}const Pr=se({}).nullable(),ul=se({code:A()}),If=se({guilds:Ge(se({id:A(),name:A()}))}),Af=se({id:A(),name:A(),icon_url:A().optional(),members:Ge(Pa)}),sr=se({id:A(),type:Lt(La),guild_id:A().optional().nullable(),name:A().optional().nullable(),topic:A().optional().nullable(),bitrate:be().optional().nullable(),user_limit:be().optional().nullable(),position:be().optional().nullable(),voice_states:Ge(rl),messages:Ge(lf)}),Of=se({channels:Ge(il)});sr.nullable();const xf=sr.nullable(),Df=sr.nullable();se({input:oo,output:oo,mode:df,automatic_gain_control:xe(),echo_cancellation:xe(),noise_suppression:xe(),qos:xe(),silence_warning:xe(),deaf:xe(),mute:xe()});const Nf=se({evt:A()}),Rf=se({shortcut:al}),fl=pr,dl=se({skus:Ge(gf)}),hl=se({entitlements:Ge(Ba)}),pl=Ge(Ba).nullable(),gl=se({use_interactive_pip:xe()}),ml=se({locale:A()}),yl=se({enabled:xe()}),vl=se({permissions:Zo().or(A())}),bl=se({iosKeyboardResizesView:zo(xe())}),Pf=ar.extend({cmd:ir(_e),evt:Da()});function kf({cmd:n,data:e}){switch(n){case _e.AUTHORIZE:return ul.parse(e);case _e.CAPTURE_SHORTCUT:return Rf.parse(e);case _e.ENCOURAGE_HW_ACCELERATION:return yl.parse(e);case _e.GET_CHANNEL:return sr.parse(e);case _e.GET_CHANNELS:return Of.parse(e);case _e.GET_CHANNEL_PERMISSIONS:return vl.parse(e);case _e.GET_GUILD:return Af.parse(e);case _e.GET_GUILDS:return If.parse(e);case _e.GET_PLATFORM_BEHAVIORS:return bl.parse(e);case _e.GET_CHANNEL:return sr.parse(e);case _e.SELECT_TEXT_CHANNEL:return Df.parse(e);case _e.SELECT_VOICE_CHANNEL:return xf.parse(e);case _e.SET_ACTIVITY:return fl.parse(e);case _e.GET_SKUS_EMBEDDED:return dl.parse(e);case _e.GET_ENTITLEMENTS_EMBEDDED:return hl.parse(e);case _e.SET_CONFIG:return gl.parse(e);case _e.START_PURCHASE:return pl.parse(e);case _e.SUBSCRIBE:case _e.UNSUBSCRIBE:return Nf.parse(e);case _e.USER_SETTINGS_GET_LOCALE:return ml.parse(e);case _e.OPEN_EXTERNAL_LINK:case _e.SET_ORIENTATION_LOCK_STATE:case _e.SET_CERTIFIED_DEVICES:case _e.SEND_ANALYTICS_EVENT:case _e.OPEN_INVITE_DIALOG:case _e.CAPTURE_LOG:case _e.GET_SKUS:case _e.GET_ENTITLEMENTS:return Pr.parse(e);case _e.AUTHENTICATE:case _e.INITIATE_IMAGE_UPLOAD:case _e.OPEN_SHARE_MOMENT_DIALOG:case _e.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS:const{response:t}=nl[n];return t.parse(e);default:Sf(n,new Error(`Unrecognized command ${n}`))}}function Lf(n){return Object.assign(Object.assign({},n),{data:kf(n)})}se({frame_id:A(),platform:ir(Hn).optional().nullable()});se({v:wt(1),encoding:wt("json").optional(),client_id:A(),frame_id:A()});const Bf=se({code:be(),message:A().optional()}),Cf=se({evt:A().nullable(),nonce:A().nullable(),data:Dr().nullable(),cmd:A()}).passthrough();function Mf(n){const e=Cf.parse(n);return e.evt!=null?e.evt===Ca?cl.parse(e):Ef(wf.parse(e)):Lf(Pf.passthrough().parse(e))}function Ht(n,e,t,s=()=>{}){const r=ar.extend({cmd:wt(e),data:t});return async i=>{const l=await n({cmd:e,args:i,transfer:s(i)});return r.parse(l).data}}function xi(n,e=()=>{}){const t=nl[n].response,s=ar.extend({cmd:wt(n),data:t});return r=>async i=>{const l=await r({cmd:n,args:i,transfer:e(i)});return s.parse(l).data}}const Uf=xi(Dn.AUTHENTICATE),$f=n=>Ht(n,_e.AUTHORIZE,ul),Vf=n=>Ht(n,_e.CAPTURE_LOG,Pr),Ff=n=>Ht(n,_e.ENCOURAGE_HW_ACCELERATION,yl),jf=n=>Ht(n,_e.GET_ENTITLEMENTS_EMBEDDED,hl),Hf=n=>Ht(n,_e.GET_SKUS_EMBEDDED,dl),Gf=n=>Ht(n,_e.GET_CHANNEL_PERMISSIONS,vl),Zf=n=>Ht(n,_e.GET_PLATFORM_BEHAVIORS,bl),zf=n=>Ht(n,_e.OPEN_EXTERNAL_LINK,Pr),Wf=n=>Ht(n,_e.OPEN_INVITE_DIALOG,Pr),Kf=xi(Dn.OPEN_SHARE_MOMENT_DIALOG);pr.pick({state:!0,details:!0,timestamps:!0,assets:!0,party:!0,secrets:!0,instance:!0,type:!0}).extend({type:pr.shape.type.optional(),instance:pr.shape.instance.optional()}).nullable();const qf=n=>Ht(n,_e.SET_ACTIVITY,fl),Yf=n=>Ht(n,_e.SET_CONFIG,gl);function Xf({sendCommand:n,cmd:e,response:t,fallbackTransform:s,transferTransform:r=()=>{}}){const i=ar.extend({cmd:wt(e),data:t});return async l=>{try{const c=await n({cmd:e,args:l,transfer:r(l)});return i.parse(c).data}catch(c){if(c.code===ya.INVALID_PAYLOAD){const g=s(l),f=await n({cmd:e,args:g,transfer:r(g)});return i.parse(f).data}else throw c}}}const Jf=n=>({lock_state:n.lock_state,picture_in_picture_lock_state:n.picture_in_picture_lock_state}),Qf=n=>Xf({sendCommand:n,cmd:_e.SET_ORIENTATION_LOCK_STATE,response:Pr,fallbackTransform:Jf}),ed=n=>Ht(n,_e.START_PURCHASE,pl),td=n=>Ht(n,_e.USER_SETTINGS_GET_LOCALE,ml),nd=xi(Dn.INITIATE_IMAGE_UPLOAD),sd=n=>Ht(n,_e.GET_CHANNEL,sr),rd=xi(Dn.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS);function id(n){return{authenticate:Uf(n),authorize:$f(n),captureLog:Vf(n),encourageHardwareAcceleration:Ff(n),getChannel:sd(n),getChannelPermissions:Gf(n),getEntitlements:jf(n),getPlatformBehaviors:Zf(n),getSkus:Hf(n),openExternalLink:zf(n),openInviteDialog:Wf(n),openShareMomentDialog:Kf(n),setActivity:qf(n),setConfig:Yf(n),setOrientationLockState:Qf(n),startPurchase:ed(n),userSettingsGetLocale:td(n),initiateImageUpload:nd(n),getInstanceConnectedParticipants:rd(n)}}class ad extends Error{constructor(e,t=""){super(t),this.code=e,this.message=t,this.name="Discord SDK Error"}}function _l(){return{disableConsoleLogOverride:!1}}const od=["log","warn","debug","info","error"];function ld(n,e,t){const s=n[e],r=n;s&&(n[e]=function(){const i=[].slice.call(arguments),l=""+i.join(" ");t(e,l),s.apply(r,i)})}var cd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),lo={randomUUID:cd},ii,ud=new Uint8Array(16);function fd(){if(!ii&&(ii=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ii))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ii(ud)}var Dt=[];for(var Qi=0;Qi<256;++Qi)Dt.push((Qi+256).toString(16).slice(1));function dd(n,e=0){return(Dt[n[e+0]]+Dt[n[e+1]]+Dt[n[e+2]]+Dt[n[e+3]]+"-"+Dt[n[e+4]]+Dt[n[e+5]]+"-"+Dt[n[e+6]]+Dt[n[e+7]]+"-"+Dt[n[e+8]]+Dt[n[e+9]]+"-"+Dt[n[e+10]]+Dt[n[e+11]]+Dt[n[e+12]]+Dt[n[e+13]]+Dt[n[e+14]]+Dt[n[e+15]]).toLowerCase()}function co(n,e,t){if(lo.randomUUID&&!e&&!n)return lo.randomUUID();n=n||{};var s=n.random||(n.rng||fd)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,dd(s)}var jn;(function(n){n[n.HANDSHAKE=0]="HANDSHAKE",n[n.FRAME=1]="FRAME",n[n.CLOSE=2]="CLOSE",n[n.HELLO=3]="HELLO"})(jn||(jn={}));const hd=new Set(pd());function pd(){return typeof window>"u"?[]:[window.location.origin,"https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]}function gd(){var n;return[(n=window.parent.opener)!==null&&n!==void 0?n:window.parent,document.referrer?document.referrer:"*"]}class md{getTransfer(e){var t;switch(e.cmd){case _e.SUBSCRIBE:case _e.UNSUBSCRIBE:return;default:return(t=e.transfer)!==null&&t!==void 0?t:void 0}}constructor(e,t){if(this.source=null,this.sourceOrigin="",this.eventBus=new Uo,this.pendingCommands=new Map,this.sendCommand=c=>{var g;if(this.source==null)throw new Error("Attempting to send message before initialization");const f=co();return(g=this.source)===null||g===void 0||g.postMessage([jn.FRAME,Object.assign(Object.assign({},c),{nonce:f})],this.sourceOrigin,this.getTransfer(c)),new Promise((p,T)=>{this.pendingCommands.set(f,{resolve:p,reject:T})})},this.commands=id(this.sendCommand),this.handleMessage=c=>{if(!hd.has(c.origin))return;const g=c.data;if(!Array.isArray(g))return;const[f,h]=g;switch(f){case jn.HELLO:return;case jn.CLOSE:return this.handleClose(h);case jn.HANDSHAKE:return this.handleHandshake();case jn.FRAME:return this.handleFrame(h);default:throw new Error("Invalid message format")}},this.isReady=!1,this.clientId=e,this.configuration=t??_l(),typeof window<"u"&&window.addEventListener("message",this.handleMessage),typeof window>"u"){this.frameId="",this.instanceId="",this.platform=Hn.DESKTOP,this.guildId=null,this.channelId=null;return}const s=new URLSearchParams(this._getSearch()),r=s.get("frame_id");if(!r)throw new Error("frame_id query param is not defined");this.frameId=r;const i=s.get("instance_id");if(!i)throw new Error("instance_id query param is not defined");this.instanceId=i;const l=s.get("platform");if(l){if(l!==Hn.DESKTOP&&l!==Hn.MOBILE)throw new Error(`Invalid query param "platform" of "${l}". Valid values are "${Hn.DESKTOP}" or "${Hn.MOBILE}"`)}else throw new Error("platform query param is not defined");this.platform=l,this.guildId=s.get("guild_id"),this.channelId=s.get("channel_id"),[this.source,this.sourceOrigin]=gd(),this.addOnReadyListener(),this.handshake()}close(e,t){var s;window.removeEventListener("message",this.handleMessage);const r=co();(s=this.source)===null||s===void 0||s.postMessage([jn.CLOSE,{code:e,message:t,nonce:r}],this.sourceOrigin)}async subscribe(e,t,...s){const[r]=s,i=this.eventBus.listenerCount(e),l=this.eventBus.on(e,t);return Object.values(We).includes(e)&&e!==We.READY&&i===0&&await this.sendCommand({cmd:_e.SUBSCRIBE,args:r,evt:e}),l}async unsubscribe(e,t,...s){const[r]=s;return e!==We.READY&&this.eventBus.listenerCount(e)===1&&await this.sendCommand({cmd:_e.UNSUBSCRIBE,evt:e,args:r}),this.eventBus.off(e,t)}async ready(){this.isReady||await new Promise(e=>{this.eventBus.once(We.READY,e)})}handshake(){var e;(e=this.source)===null||e===void 0||e.postMessage([jn.HANDSHAKE,{v:1,encoding:"json",client_id:this.clientId,frame_id:this.frameId}],this.sourceOrigin)}addOnReadyListener(){this.eventBus.once(We.READY,()=>{this.overrideConsoleLogging(),this.isReady=!0})}overrideConsoleLogging(){if(this.configuration.disableConsoleLogOverride)return;const e=(t,s)=>{this.commands.captureLog({level:t,message:s})};od.forEach(t=>{ld(console,t,e)})}handleClose(e){Bf.parse(e)}handleHandshake(){}handleFrame(e){var t,s;let r;try{r=Mf(e)}catch(i){console.error("Failed to parse",e),console.error(i);return}if(r.cmd==="DISPATCH")this.eventBus.emit(r.evt,r.data);else{if(r.evt===Ca){if(r.nonce!=null){(t=this.pendingCommands.get(r.nonce))===null||t===void 0||t.reject(r.data),this.pendingCommands.delete(r.nonce);return}this.eventBus.emit("error",new ad(r.data.code,r.data.message))}if(r.nonce==null){console.error("Missing nonce",e);return}(s=this.pendingCommands.get(r.nonce))===null||s===void 0||s.resolve(r),this.pendingCommands.delete(r.nonce)}}_getSearch(){return typeof window>"u"?"":window.location.search}}var or=1e9,yd={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Al,at=!0,on="[DecimalError] ",Ms=on+"Invalid argument: ",Ma=on+"Exponent out of range: ",lr=Math.floor,Bs=Math.pow,vd=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Kt,At=1e7,it=7,wl=9007199254740991,_i=lr(wl/it),le={};le.absoluteValue=le.abs=function(){var n=new this.constructor(this);return n.s&&(n.s=1),n};le.comparedTo=le.cmp=function(n){var e,t,s,r,i=this;if(n=new i.constructor(n),i.s!==n.s)return i.s||-n.s;if(i.e!==n.e)return i.e>n.e^i.s<0?1:-1;for(s=i.d.length,r=n.d.length,e=0,t=s<r?s:r;e<t;++e)if(i.d[e]!==n.d[e])return i.d[e]>n.d[e]^i.s<0?1:-1;return s===r?0:s>r^i.s<0?1:-1};le.decimalPlaces=le.dp=function(){var n=this,e=n.d.length-1,t=(e-n.e)*it;if(e=n.d[e],e)for(;e%10==0;e/=10)t--;return t<0?0:t};le.dividedBy=le.div=function(n){return Gn(this,new this.constructor(n))};le.dividedToIntegerBy=le.idiv=function(n){var e=this,t=e.constructor;return Je(Gn(e,new t(n),0,1),t.precision)};le.equals=le.eq=function(n){return!this.cmp(n)};le.exponent=function(){return mt(this)};le.greaterThan=le.gt=function(n){return this.cmp(n)>0};le.greaterThanOrEqualTo=le.gte=function(n){return this.cmp(n)>=0};le.isInteger=le.isint=function(){return this.e>this.d.length-2};le.isNegative=le.isneg=function(){return this.s<0};le.isPositive=le.ispos=function(){return this.s>0};le.isZero=function(){return this.s===0};le.lessThan=le.lt=function(n){return this.cmp(n)<0};le.lessThanOrEqualTo=le.lte=function(n){return this.cmp(n)<1};le.logarithm=le.log=function(n){var e,t=this,s=t.constructor,r=s.precision,i=r+5;if(n===void 0)n=new s(10);else if(n=new s(n),n.s<1||n.eq(Kt))throw Error(on+"NaN");if(t.s<1)throw Error(on+(t.s?"NaN":"-Infinity"));return t.eq(Kt)?new s(0):(at=!1,e=Gn(Nr(t,i),Nr(n,i),i),at=!0,Je(e,r))};le.minus=le.sub=function(n){var e=this;return n=new e.constructor(n),e.s==n.s?Sl(e,n):El(e,(n.s=-n.s,n))};le.modulo=le.mod=function(n){var e,t=this,s=t.constructor,r=s.precision;if(n=new s(n),!n.s)throw Error(on+"NaN");return t.s?(at=!1,e=Gn(t,n,0,1).times(n),at=!0,t.minus(e)):Je(new s(t),r)};le.naturalExponential=le.exp=function(){return Tl(this)};le.naturalLogarithm=le.ln=function(){return Nr(this)};le.negated=le.neg=function(){var n=new this.constructor(this);return n.s=-n.s||0,n};le.plus=le.add=function(n){var e=this;return n=new e.constructor(n),e.s==n.s?El(e,n):Sl(e,(n.s=-n.s,n))};le.precision=le.sd=function(n){var e,t,s,r=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Ms+n);if(e=mt(r)+1,s=r.d.length-1,t=s*it+1,s=r.d[s],s){for(;s%10==0;s/=10)t--;for(s=r.d[0];s>=10;s/=10)t++}return n&&e>t?e:t};le.squareRoot=le.sqrt=function(){var n,e,t,s,r,i,l,c=this,g=c.constructor;if(c.s<1){if(!c.s)return new g(0);throw Error(on+"NaN")}for(n=mt(c),at=!1,r=Math.sqrt(+c),r==0||r==1/0?(e=Nn(c.d),(e.length+n)%2==0&&(e+="0"),r=Math.sqrt(e),n=lr((n+1)/2)-(n<0||n%2),r==1/0?e="5e"+n:(e=r.toExponential(),e=e.slice(0,e.indexOf("e")+1)+n),s=new g(e)):s=new g(r.toString()),t=g.precision,r=l=t+3;;)if(i=s,s=i.plus(Gn(c,i,l+2)).times(.5),Nn(i.d).slice(0,l)===(e=Nn(s.d)).slice(0,l)){if(e=e.slice(l-3,l+1),r==l&&e=="4999"){if(Je(i,t+1,0),i.times(i).eq(c)){s=i;break}}else if(e!="9999")break;l+=4}return at=!0,Je(s,t)};le.times=le.mul=function(n){var e,t,s,r,i,l,c,g,f,h=this,p=h.constructor,T=h.d,C=(n=new p(n)).d;if(!h.s||!n.s)return new p(0);for(n.s*=h.s,t=h.e+n.e,g=T.length,f=C.length,g<f&&(i=T,T=C,C=i,l=g,g=f,f=l),i=[],l=g+f,s=l;s--;)i.push(0);for(s=f;--s>=0;){for(e=0,r=g+s;r>s;)c=i[r]+C[s]*T[r-s-1]+e,i[r--]=c%At|0,e=c/At|0;i[r]=(i[r]+e)%At|0}for(;!i[--l];)i.pop();return e?++t:i.shift(),n.d=i,n.e=t,at?Je(n,p.precision):n};le.toDecimalPlaces=le.todp=function(n,e){var t=this,s=t.constructor;return t=new s(t),n===void 0?t:(Ln(n,0,or),e===void 0?e=s.rounding:Ln(e,0,8),Je(t,n+mt(t)+1,e))};le.toExponential=function(n,e){var t,s=this,r=s.constructor;return n===void 0?t=Vs(s,!0):(Ln(n,0,or),e===void 0?e=r.rounding:Ln(e,0,8),s=Je(new r(s),n+1,e),t=Vs(s,!0,n+1)),t};le.toFixed=function(n,e){var t,s,r=this,i=r.constructor;return n===void 0?Vs(r):(Ln(n,0,or),e===void 0?e=i.rounding:Ln(e,0,8),s=Je(new i(r),n+mt(r)+1,e),t=Vs(s.abs(),!1,n+mt(s)+1),r.isneg()&&!r.isZero()?"-"+t:t)};le.toInteger=le.toint=function(){var n=this,e=n.constructor;return Je(new e(n),mt(n)+1,e.rounding)};le.toNumber=function(){return+this};le.toPower=le.pow=function(n){var e,t,s,r,i,l,c=this,g=c.constructor,f=12,h=+(n=new g(n));if(!n.s)return new g(Kt);if(c=new g(c),!c.s){if(n.s<1)throw Error(on+"Infinity");return c}if(c.eq(Kt))return c;if(s=g.precision,n.eq(Kt))return Je(c,s);if(e=n.e,t=n.d.length-1,l=e>=t,i=c.s,l){if((t=h<0?-h:h)<=wl){for(r=new g(Kt),e=Math.ceil(s/it+4),at=!1;t%2&&(r=r.times(c),fo(r.d,e)),t=lr(t/2),t!==0;)c=c.times(c),fo(c.d,e);return at=!0,n.s<0?new g(Kt).div(r):Je(r,s)}}else if(i<0)throw Error(on+"NaN");return i=i<0&&n.d[Math.max(e,t)]&1?-1:1,c.s=1,at=!1,r=n.times(Nr(c,s+f)),at=!0,r=Tl(r),r.s=i,r};le.toPrecision=function(n,e){var t,s,r=this,i=r.constructor;return n===void 0?(t=mt(r),s=Vs(r,t<=i.toExpNeg||t>=i.toExpPos)):(Ln(n,1,or),e===void 0?e=i.rounding:Ln(e,0,8),r=Je(new i(r),n,e),t=mt(r),s=Vs(r,n<=t||t<=i.toExpNeg,n)),s};le.toSignificantDigits=le.tosd=function(n,e){var t=this,s=t.constructor;return n===void 0?(n=s.precision,e=s.rounding):(Ln(n,1,or),e===void 0?e=s.rounding:Ln(e,0,8)),Je(new s(t),n,e)};le.toString=le.valueOf=le.val=le.toJSON=le[Symbol.for("nodejs.util.inspect.custom")]=function(){var n=this,e=mt(n),t=n.constructor;return Vs(n,e<=t.toExpNeg||e>=t.toExpPos)};function El(n,e){var t,s,r,i,l,c,g,f,h=n.constructor,p=h.precision;if(!n.s||!e.s)return e.s||(e=new h(n)),at?Je(e,p):e;if(g=n.d,f=e.d,l=n.e,r=e.e,g=g.slice(),i=l-r,i){for(i<0?(s=g,i=-i,c=f.length):(s=f,r=l,c=g.length),l=Math.ceil(p/it),c=l>c?l+1:c+1,i>c&&(i=c,s.length=1),s.reverse();i--;)s.push(0);s.reverse()}for(c=g.length,i=f.length,c-i<0&&(i=c,s=f,f=g,g=s),t=0;i;)t=(g[--i]=g[i]+f[i]+t)/At|0,g[i]%=At;for(t&&(g.unshift(t),++r),c=g.length;g[--c]==0;)g.pop();return e.d=g,e.e=r,at?Je(e,p):e}function Ln(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Ms+n)}function Nn(n){var e,t,s,r=n.length-1,i="",l=n[0];if(r>0){for(i+=l,e=1;e<r;e++)s=n[e]+"",t=it-s.length,t&&(i+=rs(t)),i+=s;l=n[e],s=l+"",t=it-s.length,t&&(i+=rs(t))}else if(l===0)return"0";for(;l%10===0;)l/=10;return i+l}var Gn=function(){function n(s,r){var i,l=0,c=s.length;for(s=s.slice();c--;)i=s[c]*r+l,s[c]=i%At|0,l=i/At|0;return l&&s.unshift(l),s}function e(s,r,i,l){var c,g;if(i!=l)g=i>l?1:-1;else for(c=g=0;c<i;c++)if(s[c]!=r[c]){g=s[c]>r[c]?1:-1;break}return g}function t(s,r,i){for(var l=0;i--;)s[i]-=l,l=s[i]<r[i]?1:0,s[i]=l*At+s[i]-r[i];for(;!s[0]&&s.length>1;)s.shift()}return function(s,r,i,l){var c,g,f,h,p,T,C,Z,V,j,me,ne,de,Ae,Ke,tt,nt,ct,st=s.constructor,Ye=s.s==r.s?1:-1,Qe=s.d,$e=r.d;if(!s.s)return new st(s);if(!r.s)throw Error(on+"Division by zero");for(g=s.e-r.e,nt=$e.length,Ke=Qe.length,C=new st(Ye),Z=C.d=[],f=0;$e[f]==(Qe[f]||0);)++f;if($e[f]>(Qe[f]||0)&&--g,i==null?ne=i=st.precision:l?ne=i+(mt(s)-mt(r))+1:ne=i,ne<0)return new st(0);if(ne=ne/it+2|0,f=0,nt==1)for(h=0,$e=$e[0],ne++;(f<Ke||h)&&ne--;f++)de=h*At+(Qe[f]||0),Z[f]=de/$e|0,h=de%$e|0;else{for(h=At/($e[0]+1)|0,h>1&&($e=n($e,h),Qe=n(Qe,h),nt=$e.length,Ke=Qe.length),Ae=nt,V=Qe.slice(0,nt),j=V.length;j<nt;)V[j++]=0;ct=$e.slice(),ct.unshift(0),tt=$e[0],$e[1]>=At/2&&++tt;do h=0,c=e($e,V,nt,j),c<0?(me=V[0],nt!=j&&(me=me*At+(V[1]||0)),h=me/tt|0,h>1?(h>=At&&(h=At-1),p=n($e,h),T=p.length,j=V.length,c=e(p,V,T,j),c==1&&(h--,t(p,nt<T?ct:$e,T))):(h==0&&(c=h=1),p=$e.slice()),T=p.length,T<j&&p.unshift(0),t(V,p,j),c==-1&&(j=V.length,c=e($e,V,nt,j),c<1&&(h++,t(V,nt<j?ct:$e,j))),j=V.length):c===0&&(h++,V=[0]),Z[f++]=h,c&&V[0]?V[j++]=Qe[Ae]||0:(V=[Qe[Ae]],j=1);while((Ae++<Ke||V[0]!==void 0)&&ne--)}return Z[0]||Z.shift(),C.e=g,Je(C,l?i+mt(C)+1:i)}}();function Tl(n,e){var t,s,r,i,l,c,g=0,f=0,h=n.constructor,p=h.precision;if(mt(n)>16)throw Error(Ma+mt(n));if(!n.s)return new h(Kt);for(e==null?(at=!1,c=p):c=e,l=new h(.03125);n.abs().gte(.1);)n=n.times(l),f+=5;for(s=Math.log(Bs(2,f))/Math.LN10*2+5|0,c+=s,t=r=i=new h(Kt),h.precision=c;;){if(r=Je(r.times(n),c),t=t.times(++g),l=i.plus(Gn(r,t,c)),Nn(l.d).slice(0,c)===Nn(i.d).slice(0,c)){for(;f--;)i=Je(i.times(i),c);return h.precision=p,e==null?(at=!0,Je(i,p)):i}i=l}}function mt(n){for(var e=n.e*it,t=n.d[0];t>=10;t/=10)e++;return e}function ea(n,e,t){if(e>n.LN10.sd())throw at=!0,t&&(n.precision=t),Error(on+"LN10 precision limit exceeded");return Je(new n(n.LN10),e)}function rs(n){for(var e="";n--;)e+="0";return e}function Nr(n,e){var t,s,r,i,l,c,g,f,h,p=1,T=10,C=n,Z=C.d,V=C.constructor,j=V.precision;if(C.s<1)throw Error(on+(C.s?"NaN":"-Infinity"));if(C.eq(Kt))return new V(0);if(e==null?(at=!1,f=j):f=e,C.eq(10))return e==null&&(at=!0),ea(V,f);if(f+=T,V.precision=f,t=Nn(Z),s=t.charAt(0),i=mt(C),Math.abs(i)<15e14){for(;s<7&&s!=1||s==1&&t.charAt(1)>3;)C=C.times(n),t=Nn(C.d),s=t.charAt(0),p++;i=mt(C),s>1?(C=new V("0."+t),i++):C=new V(s+"."+t.slice(1))}else return g=ea(V,f+2,j).times(i+""),C=Nr(new V(s+"."+t.slice(1)),f-T).plus(g),V.precision=j,e==null?(at=!0,Je(C,j)):C;for(c=l=C=Gn(C.minus(Kt),C.plus(Kt),f),h=Je(C.times(C),f),r=3;;){if(l=Je(l.times(h),f),g=c.plus(Gn(l,new V(r),f)),Nn(g.d).slice(0,f)===Nn(c.d).slice(0,f))return c=c.times(2),i!==0&&(c=c.plus(ea(V,f+2,j).times(i+""))),c=Gn(c,new V(p),f),V.precision=j,e==null?(at=!0,Je(c,j)):c;c=g,r+=2}}function uo(n,e){var t,s,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(s=e.search(/e/i))>0?(t<0&&(t=s),t+=+e.slice(s+1),e=e.substring(0,s)):t<0&&(t=e.length),s=0;e.charCodeAt(s)===48;)++s;for(r=e.length;e.charCodeAt(r-1)===48;)--r;if(e=e.slice(s,r),e){if(r-=s,t=t-s-1,n.e=lr(t/it),n.d=[],s=(t+1)%it,t<0&&(s+=it),s<r){for(s&&n.d.push(+e.slice(0,s)),r-=it;s<r;)n.d.push(+e.slice(s,s+=it));e=e.slice(s),s=it-e.length}else s-=r;for(;s--;)e+="0";if(n.d.push(+e),at&&(n.e>_i||n.e<-_i))throw Error(Ma+t)}else n.s=0,n.e=0,n.d=[0];return n}function Je(n,e,t){var s,r,i,l,c,g,f,h,p=n.d;for(l=1,i=p[0];i>=10;i/=10)l++;if(s=e-l,s<0)s+=it,r=e,f=p[h=0];else{if(h=Math.ceil((s+1)/it),i=p.length,h>=i)return n;for(f=i=p[h],l=1;i>=10;i/=10)l++;s%=it,r=s-it+l}if(t!==void 0&&(i=Bs(10,l-r-1),c=f/i%10|0,g=e<0||p[h+1]!==void 0||f%i,g=t<4?(c||g)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||g||t==6&&(s>0?r>0?f/Bs(10,l-r):0:p[h-1])%10&1||t==(n.s<0?8:7))),e<1||!p[0])return g?(i=mt(n),p.length=1,e=e-i-1,p[0]=Bs(10,(it-e%it)%it),n.e=lr(-e/it)||0):(p.length=1,p[0]=n.e=n.s=0),n;if(s==0?(p.length=h,i=1,h--):(p.length=h+1,i=Bs(10,it-s),p[h]=r>0?(f/Bs(10,l-r)%Bs(10,r)|0)*i:0),g)for(;;)if(h==0){(p[0]+=i)==At&&(p[0]=1,++n.e);break}else{if(p[h]+=i,p[h]!=At)break;p[h--]=0,i=1}for(s=p.length;p[--s]===0;)p.pop();if(at&&(n.e>_i||n.e<-_i))throw Error(Ma+mt(n));return n}function Sl(n,e){var t,s,r,i,l,c,g,f,h,p,T=n.constructor,C=T.precision;if(!n.s||!e.s)return e.s?e.s=-e.s:e=new T(n),at?Je(e,C):e;if(g=n.d,p=e.d,s=e.e,f=n.e,g=g.slice(),l=f-s,l){for(h=l<0,h?(t=g,l=-l,c=p.length):(t=p,s=f,c=g.length),r=Math.max(Math.ceil(C/it),c)+2,l>r&&(l=r,t.length=1),t.reverse(),r=l;r--;)t.push(0);t.reverse()}else{for(r=g.length,c=p.length,h=r<c,h&&(c=r),r=0;r<c;r++)if(g[r]!=p[r]){h=g[r]<p[r];break}l=0}for(h&&(t=g,g=p,p=t,e.s=-e.s),c=g.length,r=p.length-c;r>0;--r)g[c++]=0;for(r=p.length;r>l;){if(g[--r]<p[r]){for(i=r;i&&g[--i]===0;)g[i]=At-1;--g[i],g[r]+=At}g[r]-=p[r]}for(;g[--c]===0;)g.pop();for(;g[0]===0;g.shift())--s;return g[0]?(e.d=g,e.e=s,at?Je(e,C):e):new T(0)}function Vs(n,e,t){var s,r=mt(n),i=Nn(n.d),l=i.length;return e?(t&&(s=t-l)>0?i=i.charAt(0)+"."+i.slice(1)+rs(s):l>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(r<0?"e":"e+")+r):r<0?(i="0."+rs(-r-1)+i,t&&(s=t-l)>0&&(i+=rs(s))):r>=l?(i+=rs(r+1-l),t&&(s=t-r-1)>0&&(i=i+"."+rs(s))):((s=r+1)<l&&(i=i.slice(0,s)+"."+i.slice(s)),t&&(s=t-l)>0&&(r+1===l&&(i+="."),i+=rs(s))),n.s<0?"-"+i:i}function fo(n,e){if(n.length>e)return n.length=e,!0}function Il(n){var e,t,s;function r(i){var l=this;if(!(l instanceof r))return new r(i);if(l.constructor=r,i instanceof r){l.s=i.s,l.e=i.e,l.d=(i=i.d)?i.slice():i;return}if(typeof i=="number"){if(i*0!==0)throw Error(Ms+i);if(i>0)l.s=1;else if(i<0)i=-i,l.s=-1;else{l.s=0,l.e=0,l.d=[0];return}if(i===~~i&&i<1e7){l.e=0,l.d=[i];return}return uo(l,i.toString())}else if(typeof i!="string")throw Error(Ms+i);if(i.charCodeAt(0)===45?(i=i.slice(1),l.s=-1):l.s=1,vd.test(i))uo(l,i);else throw Error(Ms+i)}if(r.prototype=le,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.clone=Il,r.config=r.set=bd,n===void 0&&(n={}),n)for(s=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<s.length;)n.hasOwnProperty(t=s[e++])||(n[t]=this[t]);return r.config(n),r}function bd(n){if(!n||typeof n!="object")throw Error(on+"Object expected");var e,t,s,r=["precision",1,or,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<r.length;e+=3)if((s=n[t=r[e]])!==void 0)if(lr(s)===s&&s>=r[e+1]&&s<=r[e+2])this[t]=s;else throw Error(Ms+t+": "+s);if((s=n[t="LN10"])!==void 0)if(s==Math.LN10)this[t]=new this(s);else throw Error(Ms+t+": "+s);return this}var Al=Il(yd);Kt=new Al(1);var O;(function(n){n.AED="aed",n.AFN="afn",n.ALL="all",n.AMD="amd",n.ANG="ang",n.AOA="aoa",n.ARS="ars",n.AUD="aud",n.AWG="awg",n.AZN="azn",n.BAM="bam",n.BBD="bbd",n.BDT="bdt",n.BGN="bgn",n.BHD="bhd",n.BIF="bif",n.BMD="bmd",n.BND="bnd",n.BOB="bob",n.BOV="bov",n.BRL="brl",n.BSD="bsd",n.BTN="btn",n.BWP="bwp",n.BYN="byn",n.BYR="byr",n.BZD="bzd",n.CAD="cad",n.CDF="cdf",n.CHE="che",n.CHF="chf",n.CHW="chw",n.CLF="clf",n.CLP="clp",n.CNY="cny",n.COP="cop",n.COU="cou",n.CRC="crc",n.CUC="cuc",n.CUP="cup",n.CVE="cve",n.CZK="czk",n.DJF="djf",n.DKK="dkk",n.DOP="dop",n.DZD="dzd",n.EGP="egp",n.ERN="ern",n.ETB="etb",n.EUR="eur",n.FJD="fjd",n.FKP="fkp",n.GBP="gbp",n.GEL="gel",n.GHS="ghs",n.GIP="gip",n.GMD="gmd",n.GNF="gnf",n.GTQ="gtq",n.GYD="gyd",n.HKD="hkd",n.HNL="hnl",n.HRK="hrk",n.HTG="htg",n.HUF="huf",n.IDR="idr",n.ILS="ils",n.INR="inr",n.IQD="iqd",n.IRR="irr",n.ISK="isk",n.JMD="jmd",n.JOD="jod",n.JPY="jpy",n.KES="kes",n.KGS="kgs",n.KHR="khr",n.KMF="kmf",n.KPW="kpw",n.KRW="krw",n.KWD="kwd",n.KYD="kyd",n.KZT="kzt",n.LAK="lak",n.LBP="lbp",n.LKR="lkr",n.LRD="lrd",n.LSL="lsl",n.LTL="ltl",n.LVL="lvl",n.LYD="lyd",n.MAD="mad",n.MDL="mdl",n.MGA="mga",n.MKD="mkd",n.MMK="mmk",n.MNT="mnt",n.MOP="mop",n.MRO="mro",n.MUR="mur",n.MVR="mvr",n.MWK="mwk",n.MXN="mxn",n.MXV="mxv",n.MYR="myr",n.MZN="mzn",n.NAD="nad",n.NGN="ngn",n.NIO="nio",n.NOK="nok",n.NPR="npr",n.NZD="nzd",n.OMR="omr",n.PAB="pab",n.PEN="pen",n.PGK="pgk",n.PHP="php",n.PKR="pkr",n.PLN="pln",n.PYG="pyg",n.QAR="qar",n.RON="ron",n.RSD="rsd",n.RUB="rub",n.RWF="rwf",n.SAR="sar",n.SBD="sbd",n.SCR="scr",n.SDG="sdg",n.SEK="sek",n.SGD="sgd",n.SHP="shp",n.SLL="sll",n.SOS="sos",n.SRD="srd",n.SSP="ssp",n.STD="std",n.SVC="svc",n.SYP="syp",n.SZL="szl",n.THB="thb",n.TJS="tjs",n.TMT="tmt",n.TND="tnd",n.TOP="top",n.TRY="try",n.TTD="ttd",n.TWD="twd",n.TZS="tzs",n.UAH="uah",n.UGX="ugx",n.USD="usd",n.USN="usn",n.USS="uss",n.UYI="uyi",n.UYU="uyu",n.UZS="uzs",n.VEF="vef",n.VND="vnd",n.VUV="vuv",n.WST="wst",n.XAF="xaf",n.XAG="xag",n.XAU="xau",n.XBA="xba",n.XBB="xbb",n.XBC="xbc",n.XBD="xbd",n.XCD="xcd",n.XDR="xdr",n.XFU="xfu",n.XOF="xof",n.XPD="xpd",n.XPF="xpf",n.XPT="xpt",n.XSU="xsu",n.XTS="xts",n.XUA="xua",n.YER="yer",n.ZAR="zar",n.ZMW="zmw",n.ZWL="zwl"})(O||(O={}));O.AED+"",O.AFN+"",O.ALL+"",O.AMD+"",O.ANG+"",O.AOA+"",O.ARS+"",O.AUD+"",O.AWG+"",O.AZN+"",O.BAM+"",O.BBD+"",O.BDT+"",O.BGN+"",O.BHD+"",O.BIF+"",O.BMD+"",O.BND+"",O.BOB+"",O.BOV+"",O.BRL+"",O.BSD+"",O.BTN+"",O.BWP+"",O.BYR+"",O.BYN+"",O.BZD+"",O.CAD+"",O.CDF+"",O.CHE+"",O.CHF+"",O.CHW+"",O.CLF+"",O.CLP+"",O.CNY+"",O.COP+"",O.COU+"",O.CRC+"",O.CUC+"",O.CUP+"",O.CVE+"",O.CZK+"",O.DJF+"",O.DKK+"",O.DOP+"",O.DZD+"",O.EGP+"",O.ERN+"",O.ETB+"",O.EUR+"",O.FJD+"",O.FKP+"",O.GBP+"",O.GEL+"",O.GHS+"",O.GIP+"",O.GMD+"",O.GNF+"",O.GTQ+"",O.GYD+"",O.HKD+"",O.HNL+"",O.HRK+"",O.HTG+"",O.HUF+"",O.IDR+"",O.ILS+"",O.INR+"",O.IQD+"",O.IRR+"",O.ISK+"",O.JMD+"",O.JOD+"",O.JPY+"",O.KES+"",O.KGS+"",O.KHR+"",O.KMF+"",O.KPW+"",O.KRW+"",O.KWD+"",O.KYD+"",O.KZT+"",O.LAK+"",O.LBP+"",O.LKR+"",O.LRD+"",O.LSL+"",O.LTL+"",O.LVL+"",O.LYD+"",O.MAD+"",O.MDL+"",O.MGA+"",O.MKD+"",O.MMK+"",O.MNT+"",O.MOP+"",O.MRO+"",O.MUR+"",O.MVR+"",O.MWK+"",O.MXN+"",O.MXV+"",O.MYR+"",O.MZN+"",O.NAD+"",O.NGN+"",O.NIO+"",O.NOK+"",O.NPR+"",O.NZD+"",O.OMR+"",O.PAB+"",O.PEN+"",O.PGK+"",O.PHP+"",O.PKR+"",O.PLN+"",O.PYG+"",O.QAR+"",O.RON+"",O.RSD+"",O.RUB+"",O.RWF+"",O.SAR+"",O.SBD+"",O.SCR+"",O.SDG+"",O.SEK+"",O.SGD+"",O.SHP+"",O.SLL+"",O.SOS+"",O.SRD+"",O.SSP+"",O.STD+"",O.SVC+"",O.SYP+"",O.SZL+"",O.THB+"",O.TJS+"",O.TMT+"",O.TND+"",O.TOP+"",O.TRY+"",O.TTD+"",O.TWD+"",O.TZS+"",O.UAH+"",O.UGX+"",O.USD+"",O.USN+"",O.USS+"",O.UYI+"",O.UYU+"",O.UZS+"",O.VEF+"",O.VND+"",O.VUV+"",O.WST+"",O.XAF+"",O.XAG+"",O.XAU+"",O.XBA+"",O.XBB+"",O.XBC+"",O.XBD+"",O.XCD+"",O.XDR+"",O.XFU+"",O.XOF+"",O.XPD+"",O.XPF+"",O.XPT+"",O.XSU+"",O.XTS+"",O.XUA+"",O.YER+"",O.ZAR+"",O.ZMW+"",O.ZWL+"";var wi={exports:{}};wi.exports;(function(n,e){var t=200,s="Expected a function",r="__lodash_hash_undefined__",i=1,l=2,c=1/0,g=9007199254740991,f="[object Arguments]",h="[object Array]",p="[object Boolean]",T="[object Date]",C="[object Error]",Z="[object Function]",V="[object GeneratorFunction]",j="[object Map]",me="[object Number]",ne="[object Object]",de="[object Promise]",Ae="[object RegExp]",Ke="[object Set]",tt="[object String]",nt="[object Symbol]",ct="[object WeakMap]",st="[object ArrayBuffer]",Ye="[object DataView]",Qe="[object Float32Array]",$e="[object Float64Array]",k="[object Int8Array]",ee="[object Int16Array]",J="[object Int32Array]",q="[object Uint8Array]",Q="[object Uint8ClampedArray]",pe="[object Uint16Array]",Oe="[object Uint32Array]",we=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ve=/^\w*$/,Me=/^\./,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,yt=/[\\^$.*+?()[\]{}|]/g,xt=/\\(\\)?/g,Fs=/^\[object .+?Constructor\]$/,Cn=/^(?:0|[1-9]\d*)$/,Re={};Re[Qe]=Re[$e]=Re[k]=Re[ee]=Re[J]=Re[q]=Re[Q]=Re[pe]=Re[Oe]=!0,Re[f]=Re[h]=Re[st]=Re[p]=Re[Ye]=Re[T]=Re[C]=Re[Z]=Re[j]=Re[me]=Re[ne]=Re[Ae]=Re[Ke]=Re[tt]=Re[ct]=!1;var bn=typeof ni=="object"&&ni&&ni.Object===Object&&ni,Vt=typeof self=="object"&&self&&self.Object===Object&&self,Gt=bn||Vt||Function("return this")(),vs=e&&!e.nodeType&&e,Wn=vs&&!0&&n&&!n.nodeType&&n,js=Wn&&Wn.exports===vs,bs=js&&bn.process,_s=function(){try{return bs&&bs.binding("util")}catch{}}(),_n=_s&&_s.isTypedArray;function ws(y,E){for(var U=-1,te=y?y.length:0;++U<te&&E(y[U],U,y)!==!1;);return y}function Kn(y,E){for(var U=-1,te=y?y.length:0;++U<te;)if(E(y[U],U,y))return!0;return!1}function vt(y){return function(E){return E==null?void 0:E[y]}}function ln(y,E){for(var U=-1,te=Array(y);++U<y;)te[U]=E(U);return te}function Es(y){return function(E){return y(E)}}function Hs(y,E){return y==null?void 0:y[E]}function Ee(y){var E=!1;if(y!=null&&typeof y.toString!="function")try{E=!!(y+"")}catch{}return E}function Yt(y){var E=-1,U=Array(y.size);return y.forEach(function(te,Ne){U[++E]=[Ne,te]}),U}function d(y,E){return function(U){return y(E(U))}}function b(y){var E=-1,U=Array(y.size);return y.forEach(function(te){U[++E]=te}),U}var S=Array.prototype,D=Function.prototype,M=Object.prototype,L=Gt["__core-js_shared__"],$=function(){var y=/[^.]+$/.exec(L&&L.keys&&L.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),H=D.toString,z=M.hasOwnProperty,ue=M.toString,Pe=RegExp("^"+H.call(z).replace(yt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ie=Gt.Symbol,De=Gt.Uint8Array,Et=d(Object.getPrototypeOf,Object),Fe=Object.create,wn=M.propertyIsEnumerable,bt=S.splice,Cr=d(Object.keys,Object),_t=R(Gt,"DataView"),Xt=R(Gt,"Map"),Ts=R(Gt,"Promise"),Gs=R(Gt,"Set"),qn=R(Gt,"WeakMap"),Yn=R(Object,"create"),Mr=qe(_t),cr=qe(Xt),Ur=qe(Ts),Zs=qe(Gs),$i=qe(qn),Ss=Ie?Ie.prototype:void 0,ur=Ss?Ss.valueOf:void 0,Is=Ss?Ss.toString:void 0;function En(y){var E=-1,U=y?y.length:0;for(this.clear();++E<U;){var te=y[E];this.set(te[0],te[1])}}function $r(){this.__data__=Yn?Yn(null):{}}function Vi(y){return this.has(y)&&delete this.__data__[y]}function Jt(y){var E=this.__data__;if(Yn){var U=E[y];return U===r?void 0:U}return z.call(E,y)?E[y]:void 0}function Vr(y){var E=this.__data__;return Yn?E[y]!==void 0:z.call(E,y)}function Fr(y,E){var U=this.__data__;return U[y]=Yn&&E===void 0?r:E,this}En.prototype.clear=$r,En.prototype.delete=Vi,En.prototype.get=Jt,En.prototype.has=Vr,En.prototype.set=Fr;function Tt(y){var E=-1,U=y?y.length:0;for(this.clear();++E<U;){var te=y[E];this.set(te[0],te[1])}}function cn(){this.__data__=[]}function Fi(y){var E=this.__data__,U=Mn(E,y);if(U<0)return!1;var te=E.length-1;return U==te?E.pop():bt.call(E,U,1),!0}function jr(y){var E=this.__data__,U=Mn(E,y);return U<0?void 0:E[U][1]}function Zt(y){return Mn(this.__data__,y)>-1}function Hr(y,E){var U=this.__data__,te=Mn(U,y);return te<0?U.push([y,E]):U[te][1]=E,this}Tt.prototype.clear=cn,Tt.prototype.delete=Fi,Tt.prototype.get=jr,Tt.prototype.has=Zt,Tt.prototype.set=Hr;function un(y){var E=-1,U=y?y.length:0;for(this.clear();++E<U;){var te=y[E];this.set(te[0],te[1])}}function ji(){this.__data__={hash:new En,map:new(Xt||Tt),string:new En}}function Gr(y){return _(this,y).delete(y)}function zs(y){return _(this,y).get(y)}function Hi(y){return _(this,y).has(y)}function Zr(y,E){return _(this,y).set(y,E),this}un.prototype.clear=ji,un.prototype.delete=Gr,un.prototype.get=zs,un.prototype.has=Hi,un.prototype.set=Zr;function As(y){var E=-1,U=y?y.length:0;for(this.__data__=new un;++E<U;)this.add(y[E])}function ut(y){return this.__data__.set(y,r),this}function zr(y){return this.__data__.has(y)}As.prototype.add=As.prototype.push=ut,As.prototype.has=zr;function Qt(y){this.__data__=new Tt(y)}function Os(){this.__data__=new Tt}function Wr(y){return this.__data__.delete(y)}function Kr(y){return this.__data__.get(y)}function xs(y){return this.__data__.has(y)}function Tn(y,E){var U=this.__data__;if(U instanceof Tt){var te=U.__data__;if(!Xt||te.length<t-1)return te.push([y,E]),this;U=this.__data__=new un(te)}return U.set(y,E),this}Qt.prototype.clear=Os,Qt.prototype.delete=Wr,Qt.prototype.get=Kr,Qt.prototype.has=xs,Qt.prototype.set=Tn;function Gi(y,E){var U=Un(y)||fn(y)?ln(y.length,String):[],te=U.length,Ne=!!te;for(var ye in y)z.call(y,ye)&&!(Ne&&(ye=="length"||G(ye,te)))&&U.push(ye);return U}function Mn(y,E){for(var U=y.length;U--;)if(gt(y[U][0],E))return U;return-1}function qr(y){return qs(y)?Fe(y):{}}var Yr=a();function Zi(y,E){return y&&Yr(y,E,Jr)}function Ws(y,E){E=X(E,y)?[E]:v(E);for(var U=0,te=E.length;y!=null&&U<te;)y=y[He(E[U++])];return U&&U==te?y:void 0}function Xn(y){return ue.call(y)}function Jn(y,E){return y!=null&&E in Object(y)}function Sn(y,E,U,te,Ne){return y===E?!0:y==null||E==null||!qs(y)&&!Xr(E)?y!==y&&E!==E:zi(y,E,Sn,U,te,Ne)}function zi(y,E,U,te,Ne,ye){var Ce=Un(y),dt=Un(E),ft=h,Rt=h;Ce||(ft=P(y),ft=ft==f?ne:ft),dt||(Rt=P(E),Rt=Rt==f?ne:Rt);var Ft=ft==ne&&!Ee(y),jt=Rt==ne&&!Ee(E),Ct=ft==Rt;if(Ct&&!Ft)return ye||(ye=new Qt),Ce||eo(y)?o(y,E,U,te,Ne,ye):u(y,E,ft,U,te,Ne,ye);if(!(Ne&l)){var tn=Ft&&z.call(y,"__wrapped__"),nn=jt&&z.call(E,"__wrapped__");if(tn||nn){var ts=tn?y.value():y,$n=nn?E.value():E;return ye||(ye=new Qt),U(ts,$n,te,Ne,ye)}}return Ct?(ye||(ye=new Qt),m(y,E,U,te,Ne,ye)):!1}function Wi(y,E,U,te){var Ne=U.length,ye=Ne;if(y==null)return!ye;for(y=Object(y);Ne--;){var Ce=U[Ne];if(Ce[2]?Ce[1]!==y[Ce[0]]:!(Ce[0]in y))return!1}for(;++Ne<ye;){Ce=U[Ne];var dt=Ce[0],ft=y[dt],Rt=Ce[1];if(Ce[2]){if(ft===void 0&&!(dt in y))return!1}else{var Ft=new Qt,jt;if(!(jt===void 0?Sn(Rt,ft,te,i|l,Ft):jt))return!1}}return!0}function Ki(y){if(!qs(y)||he(y))return!1;var E=qi(y)||Ee(y)?Pe:Fs;return E.test(qe(y))}function en(y){return Xr(y)&&Yi(y.length)&&!!Re[ue.call(y)]}function zt(y){return typeof y=="function"?y:y==null?Dc:typeof y=="object"?Un(y)?Qn(y[0],y[1]):Ds(y):Nc(y)}function In(y){if(!ce(y))return Cr(y);var E=[];for(var U in Object(y))z.call(y,U)&&U!="constructor"&&E.push(U);return E}function Ds(y){var E=I(y);return E.length==1&&E[0][2]?K(E[0][0],E[0][1]):function(U){return U===y||Wi(U,y,E)}}function Qn(y,E){return X(y)&&re(E)?K(He(y),E):function(U){var te=Ac(U,y);return te===void 0&&te===E?Oc(U,y):Sn(E,te,void 0,i|l)}}function es(y){return function(E){return Ws(E,y)}}function Ks(y){if(typeof y=="string")return y;if(Xi(y))return Is?Is.call(y):"";var E=y+"";return E=="0"&&1/y==-c?"-0":E}function v(y){return Un(y)?y:fe(y)}function a(y){return function(E,U,te){for(var Ne=-1,ye=Object(E),Ce=te(E),dt=Ce.length;dt--;){var ft=Ce[++Ne];if(U(ye[ft],ft,ye)===!1)break}return E}}function o(y,E,U,te,Ne,ye){var Ce=Ne&l,dt=y.length,ft=E.length;if(dt!=ft&&!(Ce&&ft>dt))return!1;var Rt=ye.get(y);if(Rt&&ye.get(E))return Rt==E;var Ft=-1,jt=!0,Ct=Ne&i?new As:void 0;for(ye.set(y,E),ye.set(E,y);++Ft<dt;){var tn=y[Ft],nn=E[Ft];if(te)var ts=Ce?te(nn,tn,Ft,E,y,ye):te(tn,nn,Ft,y,E,ye);if(ts!==void 0){if(ts)continue;jt=!1;break}if(Ct){if(!Kn(E,function($n,Ns){if(!Ct.has(Ns)&&(tn===$n||U(tn,$n,te,Ne,ye)))return Ct.add(Ns)})){jt=!1;break}}else if(!(tn===nn||U(tn,nn,te,Ne,ye))){jt=!1;break}}return ye.delete(y),ye.delete(E),jt}function u(y,E,U,te,Ne,ye,Ce){switch(U){case Ye:if(y.byteLength!=E.byteLength||y.byteOffset!=E.byteOffset)return!1;y=y.buffer,E=E.buffer;case st:return!(y.byteLength!=E.byteLength||!te(new De(y),new De(E)));case p:case T:case me:return gt(+y,+E);case C:return y.name==E.name&&y.message==E.message;case Ae:case tt:return y==E+"";case j:var dt=Yt;case Ke:var ft=ye&l;if(dt||(dt=b),y.size!=E.size&&!ft)return!1;var Rt=Ce.get(y);if(Rt)return Rt==E;ye|=i,Ce.set(y,E);var Ft=o(dt(y),dt(E),te,Ne,ye,Ce);return Ce.delete(y),Ft;case nt:if(ur)return ur.call(y)==ur.call(E)}return!1}function m(y,E,U,te,Ne,ye){var Ce=Ne&l,dt=Jr(y),ft=dt.length,Rt=Jr(E),Ft=Rt.length;if(ft!=Ft&&!Ce)return!1;for(var jt=ft;jt--;){var Ct=dt[jt];if(!(Ce?Ct in E:z.call(E,Ct)))return!1}var tn=ye.get(y);if(tn&&ye.get(E))return tn==E;var nn=!0;ye.set(y,E),ye.set(E,y);for(var ts=Ce;++jt<ft;){Ct=dt[jt];var $n=y[Ct],Ns=E[Ct];if(te)var to=Ce?te(Ns,$n,Ct,E,y,ye):te($n,Ns,Ct,y,E,ye);if(!(to===void 0?$n===Ns||U($n,Ns,te,Ne,ye):to)){nn=!1;break}ts||(ts=Ct=="constructor")}if(nn&&!ts){var Qr=y.constructor,ei=E.constructor;Qr!=ei&&"constructor"in y&&"constructor"in E&&!(typeof Qr=="function"&&Qr instanceof Qr&&typeof ei=="function"&&ei instanceof ei)&&(nn=!1)}return ye.delete(y),ye.delete(E),nn}function _(y,E){var U=y.__data__;return W(E)?U[typeof E=="string"?"string":"hash"]:U.map}function I(y){for(var E=Jr(y),U=E.length;U--;){var te=E[U],Ne=y[te];E[U]=[te,Ne,re(Ne)]}return E}function R(y,E){var U=Hs(y,E);return Ki(U)?U:void 0}var P=Xn;(_t&&P(new _t(new ArrayBuffer(1)))!=Ye||Xt&&P(new Xt)!=j||Ts&&P(Ts.resolve())!=de||Gs&&P(new Gs)!=Ke||qn&&P(new qn)!=ct)&&(P=function(y){var E=ue.call(y),U=E==ne?y.constructor:void 0,te=U?qe(U):void 0;if(te)switch(te){case Mr:return Ye;case cr:return j;case Ur:return de;case Zs:return Ke;case $i:return ct}return E});function F(y,E,U){E=X(E,y)?[E]:v(E);for(var te,Ne=-1,Ce=E.length;++Ne<Ce;){var ye=He(E[Ne]);if(!(te=y!=null&&U(y,ye)))break;y=y[ye]}if(te)return te;var Ce=y?y.length:0;return!!Ce&&Yi(Ce)&&G(ye,Ce)&&(Un(y)||fn(y))}function G(y,E){return E=E??g,!!E&&(typeof y=="number"||Cn.test(y))&&y>-1&&y%1==0&&y<E}function X(y,E){if(Un(y))return!1;var U=typeof y;return U=="number"||U=="symbol"||U=="boolean"||y==null||Xi(y)?!0:Ve.test(y)||!we.test(y)||E!=null&&y in Object(E)}function W(y){var E=typeof y;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?y!=="__proto__":y===null}function he(y){return!!$&&$ in y}function ce(y){var E=y&&y.constructor,U=typeof E=="function"&&E.prototype||M;return y===U}function re(y){return y===y&&!qs(y)}function K(y,E){return function(U){return U==null?!1:U[y]===E&&(E!==void 0||y in Object(U))}}var fe=pt(function(y){y=Ic(y);var E=[];return Me.test(y)&&E.push(""),y.replace(rt,function(U,te,Ne,ye){E.push(Ne?ye.replace(xt,"$1"):te||U)}),E});function He(y){if(typeof y=="string"||Xi(y))return y;var E=y+"";return E=="0"&&1/y==-c?"-0":E}function qe(y){if(y!=null){try{return H.call(y)}catch{}try{return y+""}catch{}}return""}function pt(y,E){if(typeof y!="function"||E&&typeof E!="function")throw new TypeError(s);var U=function(){var te=arguments,Ne=E?E.apply(this,te):te[0],ye=U.cache;if(ye.has(Ne))return ye.get(Ne);var Ce=y.apply(this,te);return U.cache=ye.set(Ne,Ce),Ce};return U.cache=new(pt.Cache||un),U}pt.Cache=un;function gt(y,E){return y===E||y!==y&&E!==E}function fn(y){return Sc(y)&&z.call(y,"callee")&&(!wn.call(y,"callee")||ue.call(y)==f)}var Un=Array.isArray;function Qa(y){return y!=null&&Yi(y.length)&&!qi(y)}function Sc(y){return Xr(y)&&Qa(y)}function qi(y){var E=qs(y)?ue.call(y):"";return E==Z||E==V}function Yi(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=g}function qs(y){var E=typeof y;return!!y&&(E=="object"||E=="function")}function Xr(y){return!!y&&typeof y=="object"}function Xi(y){return typeof y=="symbol"||Xr(y)&&ue.call(y)==nt}var eo=_n?Es(_n):en;function Ic(y){return y==null?"":Ks(y)}function Ac(y,E,U){var te=y==null?void 0:Ws(y,E);return te===void 0?U:te}function Oc(y,E){return y!=null&&F(y,E,Jn)}function Jr(y){return Qa(y)?Gi(y):In(y)}function xc(y,E,U){var te=Un(y)||eo(y);if(E=zt(E),U==null)if(te||qs(y)){var Ne=y.constructor;te?U=Un(y)?new Ne:[]:U=qi(Ne)?qr(Et(y)):{}}else U={};return(te?ws:Zi)(y,function(ye,Ce,dt){return E(U,ye,Ce,dt)}),U}function Dc(y){return y}function Nc(y){return X(y)?vt(He(y)):es(y)}n.exports=xc})(wi,wi.exports);var _d=wi.exports,wd=Aa(_d);class Ol{constructor(e,t,s){this.platform=Hn.DESKTOP,this.instanceId="123456789012345678",this.configuration=_l(),this.source=null,this.sourceOrigin="",this.frameId="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",this.eventBus=new Uo,this.clientId=e,this.commands=this._updateCommandMocks({}),this.guildId=t,this.channelId=s}_updateCommandMocks(e){return this.commands=wd(Object.assign({},Ed,e),(t,s,r)=>{t[r]=async(...i)=>(console.info(`DiscordSDKMock: ${String(r)}(${JSON.stringify(i)})`),await s(...i))}),this.commands}emitReady(){this.emitEvent("READY",void 0)}close(...e){console.info(`DiscordSDKMock: close(${JSON.stringify(e)})`)}ready(){return Promise.resolve()}async subscribe(e,t,...s){return await this.eventBus.on(e,t)}async unsubscribe(e,t,...s){return await this.eventBus.off(e,t)}emitEvent(e,t){this.eventBus.emit(e,t)}}const Ed={authorize:()=>Promise.resolve({code:"mock_code"}),authenticate:()=>Promise.resolve({access_token:"mock_token",user:{username:"mock_user_username",discriminator:"mock_user_discriminator",id:"mock_user_id",avatar:null,public_flags:1},scopes:[],expires:new Date(2121,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}}),setActivity:()=>Promise.resolve({name:"mock_activity_name",type:0}),getChannel:()=>Promise.resolve({id:"mock_channel_id",name:"mock_channel_name",type:La.GUILD_TEXT,voice_states:[],messages:[]}),getSkus:()=>Promise.resolve({skus:[]}),getEntitlements:()=>Promise.resolve({entitlements:[]}),startPurchase:()=>Promise.resolve([]),setConfig:()=>Promise.resolve({use_interactive_pip:!1}),userSettingsGetLocale:()=>Promise.resolve({locale:""}),openExternalLink:()=>Promise.resolve(null),encourageHardwareAcceleration:()=>Promise.resolve({enabled:!0}),captureLog:()=>Promise.resolve(null),setOrientationLockState:()=>Promise.resolve(null),openInviteDialog:()=>Promise.resolve(null),getPlatformBehaviors:()=>Promise.resolve({iosKeyboardResizesView:!0}),getChannelPermissions:()=>Promise.resolve({permissions:qo(1234567890)}),openShareMomentDialog:()=>Promise.resolve(null),initiateImageUpload:()=>Promise.resolve({image_url:"https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0b52aa9e99b832574a53_full_logo_blurple_RGB.png"}),getInstanceConnectedParticipants:()=>Promise.resolve({participants:[]})};var mn={};ArrayBuffer.isView||(ArrayBuffer.isView=n=>n!==null&&typeof n=="object"&&n.buffer instanceof ArrayBuffer);typeof FormData>"u"&&(Co.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var Ua={},_a=function(n,e){return _a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])},_a(n,e)};function xl(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");_a(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ei=function(){return Ei=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ei.apply(this,arguments)};function Dl(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t}function Nl(n,e,t,s){var r=arguments.length,i=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,s);else for(var c=n.length-1;c>=0;c--)(l=n[c])&&(i=(r<3?l(i):r>3?l(e,t,i):l(e,t))||i);return r>3&&i&&Object.defineProperty(e,t,i),i}function Rl(n,e){return function(t,s){e(t,s,n)}}function Td(n,e,t,s,r,i){function l(me){if(me!==void 0&&typeof me!="function")throw new TypeError("Function expected");return me}for(var c=s.kind,g=c==="getter"?"get":c==="setter"?"set":"value",f=!e&&n?s.static?n:n.prototype:null,h=e||(f?Object.getOwnPropertyDescriptor(f,s.name):{}),p,T=!1,C=t.length-1;C>=0;C--){var Z={};for(var V in s)Z[V]=V==="access"?{}:s[V];for(var V in s.access)Z.access[V]=s.access[V];Z.addInitializer=function(me){if(T)throw new TypeError("Cannot add initializers after decoration has completed");i.push(l(me||null))};var j=(0,t[C])(c==="accessor"?{get:h.get,set:h.set}:h[g],Z);if(c==="accessor"){if(j===void 0)continue;if(j===null||typeof j!="object")throw new TypeError("Object expected");(p=l(j.get))&&(h.get=p),(p=l(j.set))&&(h.set=p),(p=l(j.init))&&r.unshift(p)}else(p=l(j))&&(c==="field"?r.unshift(p):h[g]=p)}f&&Object.defineProperty(f,s.name,h),T=!0}function Sd(n,e,t){for(var s=arguments.length>2,r=0;r<e.length;r++)t=s?e[r].call(n,t):e[r].call(n);return s?t:void 0}function Id(n){return typeof n=="symbol"?n:"".concat(n)}function Ad(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function Pl(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function kl(n,e,t,s){function r(i){return i instanceof t?i:new t(function(l){l(i)})}return new(t||(t=Promise))(function(i,l){function c(h){try{f(s.next(h))}catch(p){l(p)}}function g(h){try{f(s.throw(h))}catch(p){l(p)}}function f(h){h.done?i(h.value):r(h.value).then(c,g)}f((s=s.apply(n,e||[])).next())})}function Ll(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,r,i,l;return l={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function c(f){return function(h){return g([f,h])}}function g(f){if(s)throw new TypeError("Generator is already executing.");for(;l&&(l=0,f[0]&&(t=0)),t;)try{if(s=1,r&&(i=f[0]&2?r.return:f[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,f[1])).done)return i;switch(r=0,i&&(f=[f[0]&2,i.value]),f[0]){case 0:case 1:i=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,r=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){t.label=f[1];break}if(f[0]===6&&t.label<i[1]){t.label=i[1],i=f;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(f);break}i[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(n,t)}catch(h){f=[6,h],r=0}finally{s=i=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}var Di=Object.create?function(n,e,t,s){s===void 0&&(s=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,r)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]};function Bl(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Di(e,n,t)}function Ti(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function $a(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var s=t.call(n),r,i=[],l;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(c){l={error:c}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(l)throw l.error}}return i}function Cl(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat($a(arguments[e]));return n}function Ml(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var s=Array(n),r=0,e=0;e<t;e++)for(var i=arguments[e],l=0,c=i.length;l<c;l++,r++)s[r]=i[l];return s}function Ul(n,e,t){if(t||arguments.length===2)for(var s=0,r=e.length,i;s<r;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return n.concat(i||Array.prototype.slice.call(e))}function rr(n){return this instanceof rr?(this.v=n,this):new rr(n)}function $l(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),r,i=[];return r={},l("next"),l("throw"),l("return"),r[Symbol.asyncIterator]=function(){return this},r;function l(T){s[T]&&(r[T]=function(C){return new Promise(function(Z,V){i.push([T,C,Z,V])>1||c(T,C)})})}function c(T,C){try{g(s[T](C))}catch(Z){p(i[0][3],Z)}}function g(T){T.value instanceof rr?Promise.resolve(T.value.v).then(f,h):p(i[0][2],T)}function f(T){c("next",T)}function h(T){c("throw",T)}function p(T,C){T(C),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Vl(n){var e,t;return e={},s("next"),s("throw",function(r){throw r}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(r,i){e[r]=n[r]?function(l){return(t=!t)?{value:rr(n[r](l)),done:!1}:i?i(l):l}:i}}function Fl(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Ti=="function"?Ti(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=n[i]&&function(l){return new Promise(function(c,g){l=n[i](l),r(c,g,l.done,l.value)})}}function r(i,l,c,g){Promise.resolve(g).then(function(f){i({value:f,done:c})},l)}}function jl(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var Od=Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e};function Hl(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Di(e,n,t);return Od(e,n),e}function Gl(n){return n&&n.__esModule?n:{default:n}}function Zl(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)}function zl(n,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t}function Wl(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function Kl(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose]}if(typeof s!="function")throw new TypeError("Object not disposable.");n.stack.push({value:e,dispose:s,async:t})}else t&&n.stack.push({async:!0});return e}var xd=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var s=new Error(t);return s.name="SuppressedError",s.error=n,s.suppressed=e,s};function ql(n){function e(s){n.error=n.hasError?new xd(s,n.error,"An error was suppressed during disposal."):s,n.hasError=!0}function t(){for(;n.stack.length;){var s=n.stack.pop();try{var r=s.dispose&&s.dispose.call(s.value);if(s.async)return Promise.resolve(r).then(t,function(i){return e(i),t()})}catch(i){e(i)}}if(n.hasError)throw n.error}return t()}const Dd={__extends:xl,__assign:Ei,__rest:Dl,__decorate:Nl,__param:Rl,__metadata:Pl,__awaiter:kl,__generator:Ll,__createBinding:Di,__exportStar:Bl,__values:Ti,__read:$a,__spread:Cl,__spreadArrays:Ml,__spreadArray:Ul,__await:rr,__asyncGenerator:$l,__asyncDelegator:Vl,__asyncValues:Fl,__makeTemplateObject:jl,__importStar:Hl,__importDefault:Gl,__classPrivateFieldGet:Zl,__classPrivateFieldSet:zl,__classPrivateFieldIn:Wl,__addDisposableResource:Kl,__disposeResources:ql},Nd=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Kl,get __assign(){return Ei},__asyncDelegator:Vl,__asyncGenerator:$l,__asyncValues:Fl,__await:rr,__awaiter:kl,__classPrivateFieldGet:Zl,__classPrivateFieldIn:Wl,__classPrivateFieldSet:zl,__createBinding:Di,__decorate:Nl,__disposeResources:ql,__esDecorate:Td,__exportStar:Bl,__extends:xl,__generator:Ll,__importDefault:Gl,__importStar:Hl,__makeTemplateObject:jl,__metadata:Pl,__param:Rl,__propKey:Id,__read:$a,__rest:Dl,__runInitializers:Sd,__setFunctionName:Ad,__spread:Cl,__spreadArray:Ul,__spreadArrays:Ml,__values:Ti,default:Dd},Symbol.toStringTag,{value:"Module"})),Ni=Ia(Nd);var kr={};(function(n){n.CloseCode=void 0,function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(n.CloseCode||(n.CloseCode={}));class e extends Error{constructor(s,r){super(r),this.name="ServerError",this.code=s}}n.ServerError=e})(kr);var Va={},Yl={},Xl={},wa={exports:{}};(function(n,e){(function(t,s){s(e)})(Co,function(t){t.OPERATION=void 0,function(v){v[v.ADD=128]="ADD",v[v.REPLACE=0]="REPLACE",v[v.DELETE=64]="DELETE",v[v.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",v[v.MOVE_AND_ADD=160]="MOVE_AND_ADD",v[v.DELETE_AND_ADD=192]="DELETE_AND_ADD",v[v.CLEAR=10]="CLEAR",v[v.REVERSE=15]="REVERSE",v[v.MOVE=32]="MOVE",v[v.DELETE_BY_REFID=33]="DELETE_BY_REFID",v[v.ADD_BY_REFID=129]="ADD_BY_REFID"}(t.OPERATION||(t.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const i=Symbol("$track"),l=Symbol("$encoder"),c=Symbol("$decoder"),g=Symbol("$filter"),f=Symbol("$getByIndex"),h=Symbol("$deleteByIndex"),p=Symbol("$changes"),T=Symbol("$childType"),C=Symbol("$onEncodeEnd"),Z=Symbol("$onDecodeEnd"),V=Symbol("$descriptors"),j="$__numFields",me="$__refTypeFieldIndexes",ne="$__viewFieldIndexes",de="$__fieldIndexesByViewTag";let Ae;try{Ae=new TextEncoder}catch{}const Ke=new ArrayBuffer(8),tt=new Int32Array(Ke),nt=new Float32Array(Ke),ct=new Float64Array(Ke),st=new BigInt64Array(Ke),Qe=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(v,a){for(var o=0,u=0,m=0,_=v.length;m<_;m++)o=v.charCodeAt(m),o<128?u+=1:o<2048?u+=2:o<55296||o>=57344?u+=3:(m++,u+=4);return u};function $e(v,a,o){for(var u=0,m=0,_=a.length;m<_;m++)u=a.charCodeAt(m),u<128?v[o.offset++]=u:u<2048?(v[o.offset]=192|u>>6,v[o.offset+1]=128|u&63,o.offset+=2):u<55296||u>=57344?(v[o.offset]=224|u>>12,v[o.offset+1]=128|u>>6&63,v[o.offset+2]=128|u&63,o.offset+=3):(m++,u=65536+((u&1023)<<10|a.charCodeAt(m)&1023),v[o.offset]=240|u>>18,v[o.offset+1]=128|u>>12&63,v[o.offset+2]=128|u>>6&63,v[o.offset+3]=128|u&63,o.offset+=4)}function k(v,a,o){v[o.offset++]=a&255}function ee(v,a,o){v[o.offset++]=a&255}function J(v,a,o){v[o.offset++]=a&255,v[o.offset++]=a>>8&255}function q(v,a,o){v[o.offset++]=a&255,v[o.offset++]=a>>8&255}function Q(v,a,o){v[o.offset++]=a&255,v[o.offset++]=a>>8&255,v[o.offset++]=a>>16&255,v[o.offset++]=a>>24&255}function pe(v,a,o){const u=a>>24,m=a>>16,_=a>>8,I=a;v[o.offset++]=I&255,v[o.offset++]=_&255,v[o.offset++]=m&255,v[o.offset++]=u&255}function Oe(v,a,o){const u=Math.floor(a/Math.pow(2,32)),m=a>>>0;pe(v,m,o),pe(v,u,o)}function we(v,a,o){const u=a/Math.pow(2,32)>>0,m=a>>>0;pe(v,m,o),pe(v,u,o)}function Ve(v,a,o){st[0]=BigInt.asIntN(64,a),Q(v,tt[0],o),Q(v,tt[1],o)}function Me(v,a,o){st[0]=BigInt.asIntN(64,a),Q(v,tt[0],o),Q(v,tt[1],o)}function rt(v,a,o){nt[0]=a,Q(v,tt[0],o)}function yt(v,a,o){ct[0]=a,Q(v,tt[0],o),Q(v,tt[1],o)}function xt(v,a,o){v[o.offset++]=a?1:0}function Fs(v,a,o){a||(a="");let u=Qe(a,"utf8"),m=0;if(u<32)v[o.offset++]=u|160,m=1;else if(u<256)v[o.offset++]=217,v[o.offset++]=u%255,m=2;else if(u<65536)v[o.offset++]=218,q(v,u,o),m=3;else if(u<4294967296)v[o.offset++]=219,pe(v,u,o),m=5;else throw new Error("String too long");return $e(v,a,o),m+u}function Cn(v,a,o){if(isNaN(a))return Cn(v,0,o);if(isFinite(a)){if(a!==(a|0))return Math.abs(a)<=34028235e31&&(nt[0]=a,Math.abs(Math.abs(nt[0])-Math.abs(a))<1e-4)?(v[o.offset++]=202,rt(v,a,o),5):(v[o.offset++]=203,yt(v,a,o),9)}else return Cn(v,a>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,o);return a>=0?a<128?(v[o.offset++]=a&255,1):a<256?(v[o.offset++]=204,v[o.offset++]=a&255,2):a<65536?(v[o.offset++]=205,q(v,a,o),3):a<4294967296?(v[o.offset++]=206,pe(v,a,o),5):(v[o.offset++]=207,we(v,a,o),9):a>=-32?(v[o.offset++]=224|a+32,1):a>=-128?(v[o.offset++]=208,k(v,a,o),2):a>=-32768?(v[o.offset++]=209,J(v,a,o),3):a>=-2147483648?(v[o.offset++]=210,Q(v,a,o),5):(v[o.offset++]=211,Oe(v,a,o),9)}const Re={int8:k,uint8:ee,int16:J,uint16:q,int32:Q,uint32:pe,int64:Oe,uint64:we,bigint64:Ve,biguint64:Me,float32:rt,float64:yt,boolean:xt,string:Fs,number:Cn,utf8Write:$e,utf8Length:Qe},bn=new ArrayBuffer(8),Vt=new Int32Array(bn),Gt=new Float32Array(bn),vs=new Float64Array(bn),Wn=new BigUint64Array(bn),js=new BigInt64Array(bn);function bs(v,a,o){for(var u="",m=0,_=a.offset,I=a.offset+o;_<I;_++){var R=v[_];if(!(R&128)){u+=String.fromCharCode(R);continue}if((R&224)===192){u+=String.fromCharCode((R&31)<<6|v[++_]&63);continue}if((R&240)===224){u+=String.fromCharCode((R&15)<<12|(v[++_]&63)<<6|(v[++_]&63)<<0);continue}if((R&248)===240){m=(R&7)<<18|(v[++_]&63)<<12|(v[++_]&63)<<6|(v[++_]&63)<<0,m>=65536?(m-=65536,u+=String.fromCharCode((m>>>10)+55296,(m&1023)+56320)):u+=String.fromCharCode(m);continue}console.error("Invalid byte "+R.toString(16))}return a.offset+=o,u}function _s(v,a){return _n(v,a)<<24>>24}function _n(v,a){return v[a.offset++]}function ws(v,a){return Kn(v,a)<<16>>16}function Kn(v,a){return v[a.offset++]|v[a.offset++]<<8}function vt(v,a){return v[a.offset++]|v[a.offset++]<<8|v[a.offset++]<<16|v[a.offset++]<<24}function ln(v,a){return vt(v,a)>>>0}function Es(v,a){return Vt[0]=vt(v,a),Gt[0]}function Hs(v,a){return Vt[0]=vt(v,a),Vt[1]=vt(v,a),vs[0]}function Ee(v,a){const o=ln(v,a);return vt(v,a)*Math.pow(2,32)+o}function Yt(v,a){const o=ln(v,a);return ln(v,a)*Math.pow(2,32)+o}function d(v,a){return Vt[0]=vt(v,a),Vt[1]=vt(v,a),js[0]}function b(v,a){return Vt[0]=vt(v,a),Vt[1]=vt(v,a),Wn[0]}function S(v,a){return _n(v,a)>0}function D(v,a){const o=v[a.offset++];let u;return o<192?u=o&31:o===217?u=_n(v,a):o===218?u=Kn(v,a):o===219&&(u=ln(v,a)),bs(v,a,u)}function M(v,a){const o=v[a.offset++];if(o<128)return o;if(o===202)return Es(v,a);if(o===203)return Hs(v,a);if(o===204)return _n(v,a);if(o===205)return Kn(v,a);if(o===206)return ln(v,a);if(o===207)return Yt(v,a);if(o===208)return _s(v,a);if(o===209)return ws(v,a);if(o===210)return vt(v,a);if(o===211)return Ee(v,a);if(o>223)return(255-o+1)*-1}function L(v,a){const o=v[a.offset];return o<192&&o>160||o===217||o===218||o===219}const $={utf8Read:bs,int8:_s,uint8:_n,int16:ws,uint16:Kn,int32:vt,uint32:ln,float32:Es,float64:Hs,int64:Ee,uint64:Yt,bigint64:d,biguint64:b,boolean:S,string:D,number:M,stringCheck:L},H={},z=new Map;function ue(v,a){a.constructor&&(z.set(a.constructor,v),H[v]=a),a.encode&&(Re[v]=a.encode),a.decode&&($[v]=a.decode)}function Pe(v){return H[v]}function Ie(v){for(const a in v)ue(a,v[a]);return a=>Zt(a)}const en=class en{static register(a){const o=Object.getPrototypeOf(a);if(o!==ut){let u=en.inheritedTypes.get(o);u||(u=new Set,en.inheritedTypes.set(o,u)),u.add(a)}}static cache(a){let o=en.cachedContexts.get(a);return o||(o=new en(a),en.cachedContexts.set(a,o)),o}constructor(a){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},a&&this.discoverTypes(a)}has(a){return this.schemas.has(a)}get(a){return this.types[a]}add(a,o=this.schemas.size){return this.schemas.has(a)?!1:(this.types[o]=a,a[Symbol.metadata]===void 0&&Fe.initialize(a),this.schemas.set(a,o),!0)}getTypeId(a){return this.schemas.get(a)}discoverTypes(a,o,u,m){var R,P;if(m&&this.registerFilteredByParent(a,o,u),!this.add(a))return;(R=en.inheritedTypes.get(a))==null||R.forEach(F=>{this.discoverTypes(F,o,u,m)});let _=a;for(;(_=Object.getPrototypeOf(_))&&_!==ut&&_!==Function.prototype;)this.discoverTypes(_);const I=a[P=Symbol.metadata]??(a[P]={});I[ne]&&(this.hasFilters=!0);for(const F in I){const G=F,X=I[G].type,W=I[G].tag!==void 0;if(typeof X!="string")if(Array.isArray(X)){const he=X[0];if(he==="string")continue;this.discoverTypes(he,a,G,m||W)}else if(typeof X=="function")this.discoverTypes(X,a,G,m||W);else{const he=Object.values(X)[0];if(typeof he=="string")continue;this.discoverTypes(he,a,G,m||W)}}}registerFilteredByParent(a,o,u){let _=`${this.schemas.get(a)??this.schemas.size}`;o&&(_+=`-${this.schemas.get(o)}`),_+=`-${u}`,this.parentFiltered[_]=!0}debug(){let a="";for(const o in this.parentFiltered){const u=o.split("-").map(Number),m=u.pop();a+=`
		`,a+=`${o}: ${u.reverse().map((_,I)=>{const R=this.types[_],P=R[Symbol.metadata];let F=R.name;return I===0&&(F+=`[${P[m].name}]`),`${F}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${a}`}};en.inheritedTypes=new Map,en.cachedContexts=new Map;let De=en;function Et(v){return Array.isArray(v)?{array:v[0]}:typeof v.type<"u"?v.type:v}const Fe={addField(v,a,o,u,m){if(a>64)throw new Error(`Can't define field '${o}'.
Schema instances may only have up to 64 fields.`);v[a]=Object.assign(v[a]||{},{type:Et(u),index:a,name:o}),Object.defineProperty(v,V,{value:v[V]||{},enumerable:!1,configurable:!0}),m?(v[V][o]=m,v[V][`_${o}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):v[V][o]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(v,j,{value:a,enumerable:!1,configurable:!0}),Object.defineProperty(v,o,{value:a,enumerable:!1,configurable:!0}),typeof v[a].type!="string"&&(v[me]===void 0&&Object.defineProperty(v,me,{value:[],enumerable:!1,configurable:!0}),v[me].push(a))},setTag(v,a,o){const u=v[a],m=v[u];m.tag=o,v[ne]||(Object.defineProperty(v,ne,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(v,de,{value:{},enumerable:!1,configurable:!0})),v[ne].push(u),v[de][o]||(v[de][o]=[]),v[de][o].push(u)},setFields(v,a){const o=v.prototype.constructor;De.register(o);const u=Object.getPrototypeOf(o),m=u&&u[Symbol.metadata],_=Fe.initialize(o);o[i]||(o[i]=ut[i]),o[l]||(o[l]=ut[l]),o[c]||(o[c]=ut[c]),o.prototype.toJSON||(o.prototype.toJSON=ut.prototype.toJSON);let I=_[j]??(m&&m[j])??-1;I++;for(const R in a){const P=a[R],F=Array.isArray(P)?Pe("array"):typeof Object.keys(P)[0]=="string"&&Pe(Object.keys(P)[0]),G=F?Object.values(P)[0]:Et(P);Fe.addField(_,I,R,P,Hr(`_${R}`,I,G,F)),I++}return v},isDeprecated(v,a){return v[a].deprecated===!0},init(v){const a={};v[Symbol.metadata]=a,Object.defineProperty(a,j,{value:0,enumerable:!1,configurable:!0})},initialize(v){const a=Object.getPrototypeOf(v),o=a[Symbol.metadata];let u=v[Symbol.metadata]??Object.create(null);return a!==ut&&u===o&&(u=Object.create(null),o&&(Object.setPrototypeOf(u,o),Object.defineProperty(u,j,{value:o[j],enumerable:!1,configurable:!0,writable:!0}),o[ne]!==void 0&&(Object.defineProperty(u,ne,{value:[...o[ne]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(u,de,{value:{...o[de]},enumerable:!1,configurable:!0,writable:!0})),o[me]!==void 0&&Object.defineProperty(u,me,{value:[...o[me]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(u,V,{value:{...o[V]},enumerable:!1,configurable:!0,writable:!0}))),v[Symbol.metadata]=u,u},isValidInstance(v){return v.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(v.constructor[Symbol.metadata],j)},getFields(v){const a=v[Symbol.metadata],o={};for(let u=0;u<=a[j];u++)o[a[u].name]=a[u].type;return o},hasViewTagAtIndex(v,a){var o;return(o=v==null?void 0:v[ne])==null?void 0:o.includes(a)}};function wn(){return{indexes:{},operations:[]}}function bt(v,a){const o=v.indexes[a];o===void 0?v.indexes[a]=v.operations.push(a)-1:v.operations[o]=a}function Cr(v,a){var u;let o=v.indexes[a];o===void 0&&(o=Object.values(v.indexes).at(-1),a=(u=Object.entries(v.indexes).find(([m,_])=>_===o))==null?void 0:u[0]),v.operations[o]=void 0,delete v.indexes[a]}function _t(v,a,o,u=a[o].queueRootIndex){if(v)v[o][u]!==a&&(a[o].queueRootIndex=v[o].push(a)-1);else return}class Xt{constructor(a){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=a;const o=a.constructor[Symbol.metadata];o!=null&&o[ne]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(a){var u;this.root=a,this.checkIsFiltered(this.parent,this.parentIndex);const o=this.ref.constructor[Symbol.metadata];o?(u=o[me])==null||u.forEach(m=>{const _=o[m],I=this.ref[_.name];I==null||I[p].setRoot(a)}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((m,_)=>{m[p].setRoot(a)})}setParent(a,o,u){var _;if(this.parent=a,this.parentIndex=u,!o)return;o!==this.root?(this.root=o,this.checkIsFiltered(a,u)):o.add(this);const m=this.ref.constructor[Symbol.metadata];m?(_=m[me])==null||_.forEach(I=>{const R=m[I],P=this.ref[R.name];P==null||P[p].setParent(this.ref,o,I)}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((I,R)=>{I[p].setParent(this.ref,o,this.indexes[R]??R)})}forEachChild(a){var u;const o=this.ref.constructor[Symbol.metadata];o?(u=o[me])==null||u.forEach(m=>{const _=o[m],I=this.ref[_.name];I&&a(I[p],m)}):this.ref[T]&&typeof this.ref[T]!="string"&&this.ref.forEach((m,_)=>{a(m[p],this.indexes[_]??_)})}operation(a){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-a),_t(this.root,this,"filteredChanges")):(this.changes.operations.push(-a),_t(this.root,this,"changes"))}change(a,o=t.OPERATION.ADD){var R;const u=this.ref.constructor[Symbol.metadata],m=this.isFiltered||((R=u==null?void 0:u[a])==null?void 0:R.tag)!==void 0,_=m?this.filteredChanges:this.changes,I=this.indexedOperations[a];if(!I||I===t.OPERATION.DELETE){const P=I&&I===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:o;this.indexedOperations[a]=P}bt(_,a),m?(bt(this.allFilteredChanges,a),this.root&&(_t(this.root,this,"filteredChanges"),_t(this.root,this,"allFilteredChanges"))):(bt(this.allChanges,a),_t(this.root,this,"changes"))}shiftChangeIndexes(a){const o=this.isFiltered?this.filteredChanges:this.changes,u={},m={};for(const _ in this.indexedOperations)u[Number(_)+a]=this.indexedOperations[_],m[Number(_)+a]=o.indexes[_];this.indexedOperations=u,o.indexes=m,o.operations=o.operations.map(_=>_+a)}shiftAllChangeIndexes(a,o=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(a,o,this.allFilteredChanges),this._shiftAllChangeIndexes(a,o,this.allChanges)):this._shiftAllChangeIndexes(a,o,this.allChanges)}_shiftAllChangeIndexes(a,o=0,u){const m={};let _=0;for(const I in u.indexes)m[_++]=u.indexes[I];u.indexes=m;for(let I=0;I<u.operations.length;I++){const R=u.operations[I];R>o&&(u.operations[I]=R+a)}}indexedOperation(a,o,u=a){this.indexedOperations[a]=o,this.filteredChanges!==void 0?(bt(this.allFilteredChanges,u),bt(this.filteredChanges,a),_t(this.root,this,"filteredChanges")):(bt(this.allChanges,u),bt(this.changes,a),_t(this.root,this,"changes"))}getType(a){return Fe.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][a].type:this.ref[T]}getChange(a){return this.indexedOperations[a]}getValue(a,o=!1){return this.ref[f](a,o)}delete(a,o,u=a){var I;if(a===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${a}'`)}catch(R){console.warn(R)}return}const m=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[a]=o??t.OPERATION.DELETE,bt(m,a),Cr(this.allChanges,u);const _=this.getValue(a);return _&&_[p]&&((I=this.root)==null||I.remove(_[p])),this.filteredChanges!==void 0?(Cr(this.allFilteredChanges,u),_t(this.root,this,"filteredChanges")):_t(this.root,this,"changes"),_}endEncode(a){var o,u;this.indexedOperations={},this[a].indexes={},this[a].operations.length=0,this[a].queueRootIndex=void 0,(u=(o=this.ref)[C])==null||u.call(o),this.isNew=!1}discard(a=!1){var o,u;(u=(o=this.ref)[C])==null||u.call(o),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),a&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((m,_)=>{var I;return(I=this.root)==null?void 0:I.remove(m)}))}discardAll(){const a=Object.keys(this.indexedOperations);for(let o=0,u=a.length;o<u;o++){const m=this.getValue(Number(a[o]));m&&m[p]&&m[p].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(a,o){const u=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(a,o),this.filteredChanges!==void 0&&(_t(this.root,this,"filteredChanges"),u&&this.root.allFilteredChanges.push(this))),this.isFiltered||(_t(this.root,this,"changes"),u&&this.root.allChanges.push(this))}_checkFilteredByParent(a,o){if(!a)return;const u=Fe.isValidInstance(this.ref)?this.ref.constructor:this.ref[T];let m,_=!Fe.isValidInstance(a);_?(m=a[p],a=m.parent,o=m.parentIndex):m=a[p];const I=a.constructor;let R=`${this.root.types.getTypeId(u)}`;I&&(R+=`-${this.root.types.schemas.get(I)}`),R+=`-${o}`;const P=Fe.hasViewTagAtIndex(I==null?void 0:I[Symbol.metadata],o);this.isFiltered=a[p].isFiltered||this.root.types.parentFiltered[R]||P,this.isFiltered&&(this.isVisibilitySharedWithParent=m.isFiltered&&typeof u!="string"&&!P&&_,this.filteredChanges||(this.filteredChanges=wn(),this.allFilteredChanges=wn()),this.changes.operations.length>0&&(this.changes.operations.forEach(F=>bt(this.filteredChanges,F)),this.allChanges.operations.forEach(F=>bt(this.allFilteredChanges,F)),this.changes=wn(),this.allChanges=wn()))}}function Ts(v,a,o,u,m,_){var I;typeof o=="string"?(I=Re[o])==null||I.call(Re,a,u,_):o[Symbol.metadata]!==void 0?(Re.number(a,u[p].refId,_),(m&t.OPERATION.ADD)===t.OPERATION.ADD&&v.tryEncodeTypeId(a,o,u.constructor,_)):Re.number(a,u[p].refId,_)}const Gs=function(v,a,o,u,m,_,I,R,P){if(a[_.offset++]=(u|m)&255,m===t.OPERATION.DELETE)return;const F=o.ref,G=P[u];Ts(v,a,P[u].type,F[G.name],m,_)},qn=function(v,a,o,u,m,_){if(a[_.offset++]=m&255,m===t.OPERATION.CLEAR||(Re.number(a,u,_),m===t.OPERATION.DELETE))return;const I=o.ref;if((m&t.OPERATION.ADD)===t.OPERATION.ADD&&typeof I.set=="function"){const F=o.ref.$indexes.get(u);Re.string(a,F,_)}const R=I[T],P=I[f](u);Ts(v,a,R,P,m,_)},Yn=function(v,a,o,u,m,_,I,R){const P=o.ref,F=R&&o.isFiltered&&typeof o.getType(u)!="string";let G;if(F?(G=P.tmpItems[u][p].refId,m===t.OPERATION.DELETE?m=t.OPERATION.DELETE_BY_REFID:m===t.OPERATION.ADD&&(m=t.OPERATION.ADD_BY_REFID)):G=u,a[_.offset++]=m&255,m===t.OPERATION.CLEAR||m===t.OPERATION.REVERSE||(Re.number(a,G,_),m===t.OPERATION.DELETE||m===t.OPERATION.DELETE_BY_REFID))return;const X=o.getType(u),W=o.getValue(u,I);Ts(v,a,X,W,m,_)},Mr=-1;function cr(v,a,o,u,m,_,I,R){const P=v.root,F=o[f](u);let G;if((a&t.OPERATION.DELETE)===t.OPERATION.DELETE){const X=P.refIds.get(F);X!==void 0&&P.removeRef(X),a!==t.OPERATION.DELETE_AND_ADD&&o[h](u),G=void 0}if(a!==t.OPERATION.DELETE)if(ut.is(m)){const X=$.number(_,I);if(G=P.refs.get(X),(a&t.OPERATION.ADD)===t.OPERATION.ADD){const W=v.getInstanceType(_,I,m);G||(G=v.createInstanceOfType(W)),P.addRef(X,G,G!==F||a===t.OPERATION.DELETE_AND_ADD&&G===F)}}else if(typeof m=="string")G=$[m](_,I);else{const X=Pe(Object.keys(m)[0]),W=$.number(_,I),he=P.refs.has(W)?F||P.refs.get(W):new X.constructor;if(G=he.clone(!0),G[T]=Object.values(m)[0],F){let ce=P.refIds.get(F);if(ce!==void 0&&W!==ce){const re=F.entries();let K;for(;(K=re.next())&&!K.done;){const[fe,He]=K.value;typeof He=="object"&&(ce=P.refIds.get(He),P.removeRef(ce)),R.push({ref:F,refId:ce,op:t.OPERATION.DELETE,field:fe,value:void 0,previousValue:He})}}}P.addRef(W,G,he!==F||a===t.OPERATION.DELETE_AND_ADD&&he===F)}return{value:G,previousValue:F}}const Ur=function(v,a,o,u,m){const _=a[o.offset++],I=u.constructor[Symbol.metadata],R=_>>6<<6,P=_%(R||255),F=I[P];if(F===void 0)return console.warn("@colyseus/schema: field not defined at",{index:P,ref:u.constructor.name,metadata:I}),Mr;const{value:G,previousValue:X}=cr(v,R,u,P,F.type,a,o,m);G!=null&&(u[F.name]=G),X!==G&&m.push({ref:u,refId:v.currentRefId,op:R,field:F.name,value:G,previousValue:X})},Zs=function(v,a,o,u,m){const _=a[o.offset++];if(_===t.OPERATION.CLEAR){v.removeChildRefs(u,m),u.clear();return}const I=$.number(a,o),R=u[T];let P;(_&t.OPERATION.ADD)===t.OPERATION.ADD?typeof u.set=="function"?(P=$.string(a,o),u.setIndex(I,P)):P=I:P=u.getIndex(I);const{value:F,previousValue:G}=cr(v,_,u,I,R,a,o,m);if(F!=null){if(typeof u.set=="function")u.$items.set(P,F);else if(typeof u.$setAt=="function")u.$setAt(I,F,_);else if(typeof u.add=="function"){const X=u.add(F);typeof X=="number"&&u.setIndex(X,X)}}G!==F&&m.push({ref:u,refId:v.currentRefId,op:_,field:"",dynamicIndex:P,value:F,previousValue:G})},$i=function(v,a,o,u,m){let _=a[o.offset++],I;if(_===t.OPERATION.CLEAR){v.removeChildRefs(u,m),u.clear();return}else if(_===t.OPERATION.REVERSE){u.reverse();return}else if(_===t.OPERATION.DELETE_BY_REFID){const X=$.number(a,o),W=v.root.refs.get(X);I=u.findIndex(he=>he===W),u[h](I),m.push({ref:u,refId:v.currentRefId,op:t.OPERATION.DELETE,field:"",dynamicIndex:I,value:void 0,previousValue:W});return}else if(_===t.OPERATION.ADD_BY_REFID){const X=$.number(a,o),W=v.root.refs.get(X);W&&(I=u.findIndex(he=>he===W)),(I===-1||I===void 0)&&(I=u.length)}else I=$.number(a,o);const R=u[T];let P=I;const{value:F,previousValue:G}=cr(v,_,u,I,R,a,o,m);F!=null&&F!==G&&u.$setAt(I,F,_),G!==F&&m.push({ref:u,refId:v.currentRefId,op:_,field:"",dynamicIndex:P,value:F,previousValue:G})};class Ss extends Error{}function ur(v,a,o,u){let m,_=!1;switch(a){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":m="number",isNaN(v)&&console.log(`trying to encode "NaN" in ${o.constructor.name}#${u}`);break;case"bigint64":case"biguint64":m="bigint";break;case"string":m="string",_=!0;break;case"boolean":return;default:return}if(typeof v!==m&&(!_||_&&v!==null)){let I=`'${JSON.stringify(v)}'${v&&v.constructor&&` (${v.constructor.name})`||""}`;throw new Ss(`a '${m}' was expected, but ${I} was provided in ${o.constructor.name}#${u}`)}}function Is(v,a,o,u){if(!(v instanceof a))throw new Ss(`a '${a.name}' was expected, but '${v&&v.constructor.name}' was provided in ${o.constructor.name}#${u}`)}var En,$r;const Vi=(v,a)=>{const o=v.toString(),u=a.toString();return o<u?-1:o>u?1:0},zt=class zt{static[(En=l,$r=c,g)](a,o,u){var m;return!u||typeof a[T]=="string"||u.isChangeTreeVisible((m=a.tmpItems[o])==null?void 0:m[p])}static is(a){return Array.isArray(a)||a.array!==void 0}static from(a){return new zt(...Array.from(a))}constructor(...a){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const o=new Proxy(this,{get:(u,m)=>typeof m!="symbol"&&!isNaN(m)?this.items[m]:Reflect.get(u,m),set:(u,m,_)=>{var I;if(typeof m!="symbol"&&!isNaN(m)){if(_==null)u.$deleteAt(m);else{if(_[p]){Is(_,u[T],u,m);const R=u.items[m];u.isMovingItems?(R!==void 0?_[p].isNew?u[p].indexedOperation(Number(m),t.OPERATION.MOVE_AND_ADD):(u[p].getChange(Number(m))&t.OPERATION.DELETE)===t.OPERATION.DELETE?u[p].indexedOperation(Number(m),t.OPERATION.DELETE_AND_MOVE):u[p].indexedOperation(Number(m),t.OPERATION.MOVE):_[p].isNew&&u[p].indexedOperation(Number(m),t.OPERATION.ADD),_[p].setParent(this,u[p].root,m)):u.$changeAt(Number(m),_),R!==void 0&&((I=R[p].root)==null||I.remove(R[p]))}else u.$changeAt(Number(m),_);u.items[m]=_,u.tmpItems[m]=_}return!0}else return Reflect.set(u,m,_)},deleteProperty:(u,m)=>(typeof m=="number"?u.$deleteAt(m):delete u[m],!0),has:(u,m)=>typeof m!="symbol"&&!isNaN(Number(m))?Reflect.has(this.items,m):Reflect.has(u,m)});return this[p]=new Xt(o),this[p].indexes={},a.length>0&&this.push(...a),o}set length(a){a===0?this.clear():a<this.items.length?this.splice(a,this.length-a):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...a){var m;let o=this.tmpItems.length;const u=this[p];for(let _=0,I=a.length;_<a.length;_++,o++){const R=a[_];if(R==null)return;typeof R=="object"&&this[T]&&Is(R,this[T],this,_),u.indexedOperation(o,t.OPERATION.ADD,this.items.length),this.items.push(R),this.tmpItems.push(R),(m=R[p])==null||m.setParent(this,u.root,o)}return o}pop(){let a=-1;for(let o=this.tmpItems.length-1;o>=0;o--)if(this.deletedIndexes[o]!==!0){a=o;break}if(!(a<0))return this[p].delete(a,void 0,this.items.length-1),this.deletedIndexes[a]=!0,this.items.pop()}at(a){return a<0&&(a+=this.length),this.items[a]}$changeAt(a,o){var _;if(o==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[a]===o)return;const u=this.items[a]!==void 0?typeof o=="object"?t.OPERATION.DELETE_AND_ADD:t.OPERATION.REPLACE:t.OPERATION.ADD,m=this[p];m.change(a,u),(_=o[p])==null||_.setParent(this,m.root,a)}$deleteAt(a,o){this[p].delete(a,o)}$setAt(a,o,u){a===0&&u===t.OPERATION.ADD&&this.items[a]!==void 0?this.items.unshift(o):u===t.OPERATION.DELETE_AND_MOVE?(this.items.splice(a,1),this.items[a]=o):this.items[a]=o}clear(){if(this.items.length===0)return;const a=this[p];a.forEachChild((o,u)=>{o.discard(!0);const m=o.root;m!==void 0&&(m.removeChangeFromChangeSet("changes",o),m.removeChangeFromChangeSet("allChanges",o),m.removeChangeFromChangeSet("allFilteredChanges",o))}),a.discard(!0),a.operation(t.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...a){return new zt(...this.items.concat(...a))}join(a){return this.items.join(a)}reverse(){return this[p].operation(t.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const a=this[p],o=this.tmpItems.findIndex(m=>m===this.items[0]),u=this.items.findIndex(m=>m===this.items[0]);return a.delete(o,t.OPERATION.DELETE,u),a.shiftAllChangeIndexes(-1,u),this.items.shift()}slice(a,o){const u=new zt;return u.push(...this.items.slice(a,o)),u}sort(a=Vi){this.isMovingItems=!0;const o=this[p];return this.items.sort(a).forEach((m,_)=>o.change(_,t.OPERATION.REPLACE)),this.tmpItems.sort(a),this.isMovingItems=!1,this}splice(a,o,...u){var F;const m=this[p],_=this.items.length,I=this.tmpItems.length,R=u.length,P=[];for(let G=0;G<I;G++)this.deletedIndexes[G]!==!0&&P.push(G);if(_>a){o===void 0&&(o=_-a);for(let G=a;G<a+o;G++){const X=P[G];m.delete(X,t.OPERATION.DELETE),this.deletedIndexes[X]=!0}}else o=0;if(R>0){if(R>o)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let G=0;G<R;G++){const X=(P[a]??_)+G;m.indexedOperation(X,this.deletedIndexes[X]?t.OPERATION.DELETE_AND_ADD:t.OPERATION.ADD),(F=u[G][p])==null||F.setParent(this,m.root,X)}}return o>R&&m.shiftAllChangeIndexes(-(o-R),P[a+R]),m.filteredChanges!==void 0?_t(m.root,m,"filteredChanges"):_t(m.root,m,"changes"),this.items.splice(a,o,...u)}unshift(...a){const o=this[p];return o.shiftChangeIndexes(a.length),o.isFiltered?bt(o.filteredChanges,this.items.length):bt(o.allChanges,this.items.length),a.forEach((u,m)=>{o.change(m,t.OPERATION.ADD)}),this.tmpItems.unshift(...a),this.items.unshift(...a)}indexOf(a,o){return this.items.indexOf(a,o)}lastIndexOf(a,o=this.length-1){return this.items.lastIndexOf(a,o)}every(a,o){return this.items.every(a,o)}some(a,o){return this.items.some(a,o)}forEach(a,o){return this.items.forEach(a,o)}map(a,o){return this.items.map(a,o)}filter(a,o){return this.items.filter(a,o)}reduce(a,o){return this.items.reduce(a,o)}reduceRight(a,o){return this.items.reduceRight(a,o)}find(a,o){return this.items.find(a,o)}findIndex(a,o){return this.items.findIndex(a,o)}fill(a,o,u){throw new Error("ArraySchema#fill() not implemented")}copyWithin(a,o,u){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return zt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(a,o){return this.items.includes(a,o)}flatMap(a,o){throw new Error("ArraySchema#flatMap() is not supported.")}flat(a){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...a){return this.items.findLastIndex.apply(this.items,arguments)}with(a,o){const u=this.items.slice();return a<0&&(a+=this.length),u[a]=o,new zt(...u)}toReversed(){return this.items.slice().reverse()}toSorted(a){return this.items.slice().sort(a)}toSpliced(a,o,...u){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(a=>{let o=this.items.length;for(;o!=0;){let u=Math.floor(Math.random()*o);o--,[this[o],this[u]]=[this[u],this[o]]}})}move(a){return this.isMovingItems=!0,a(this),this.isMovingItems=!1,this}[f](a,o=!1){return o?this.items[a]:this.deletedIndexes[a]?this.items[a]:this.tmpItems[a]||this.items[a]}[h](a){this.items[a]=void 0,this.tmpItems[a]=void 0}[C](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[Z](){this.items=this.items.filter(a=>a!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(a=>typeof a.toJSON=="function"?a.toJSON():a)}clone(a){let o;return a?(o=new zt,o.push(...this.items)):o=new zt(...this.map(u=>u[p]?u.clone():u)),o}};zt[En]=Yn,zt[$r]=$i;let Jt=zt;ue("array",{constructor:Jt});var Vr,Fr;const In=class In{static[(Vr=l,Fr=c,g)](a,o,u){return!u||typeof a[T]=="string"||u.isChangeTreeVisible((a[f](o)??a.deletedItems[o])[p])}static is(a){return a.map!==void 0}constructor(a){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[p]=new Xt(this),this[p].indexes={},a)if(a instanceof Map||a instanceof In)a.forEach((o,u)=>this.set(u,o));else for(const o in a)this.set(o,a[o]);Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return In}set(a,o){var R;if(o==null)throw new Error(`MapSchema#set('${a}', ${o}): trying to set ${o} value on '${a}'.`);typeof o=="object"&&this[T]&&Is(o,this[T],this,a),a=a.toString();const u=this[p],m=o[p]!==void 0;let _,I;if(typeof u.indexes[a]<"u"){_=u.indexes[a],I=t.OPERATION.REPLACE;const P=this.$items.get(a);if(P===o)return;m&&(I=t.OPERATION.DELETE_AND_ADD,P!==void 0&&((R=P[p].root)==null||R.remove(P[p])))}else _=u.indexes[j]??0,I=t.OPERATION.ADD,this.$indexes.set(_,a),u.indexes[a]=_,u.indexes[j]=_+1;return this.$items.set(a,o),u.change(_,I),m&&o[p].setParent(this,u.root,_),this}get(a){return this.$items.get(a)}delete(a){const o=this[p].indexes[a];return this.deletedItems[o]=this[p].delete(o),this.$items.delete(a)}clear(){const a=this[p];a.discard(!0),a.indexes={},this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){return this.$items.has(a)}forEach(a){this.$items.forEach(a)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(a,o){this.$indexes.set(a,o)}getIndex(a){return this.$indexes.get(a)}[f](a){return this.$items.get(this.$indexes.get(a))}[h](a){const o=this.$indexes.get(a);this.$items.delete(o),this.$indexes.delete(a)}[C](){this.deletedItems={}}toJSON(){const a={};return this.forEach((o,u)=>{a[u]=typeof o.toJSON=="function"?o.toJSON():o}),a}clone(a){let o;return a?o=Object.assign(new In,this):(o=new In,this.forEach((u,m)=>{u[p]?o.set(m,u.clone()):o.set(m,u)})),o}};In[Vr]=qn,In[Fr]=Zs;let Tt=In;ue("map",{constructor:Tt});const cn=-1;function Fi(v){return De.register(v),v}function jr(v=cn){return function(a,o){var R;const u=a.constructor,_=Object.getPrototypeOf(u)[Symbol.metadata],I=u[R=Symbol.metadata]??(u[R]=Object.assign({},u[Symbol.metadata],_??Object.create(null)));Fe.setTag(I,o,v)}}function Zt(v,a){return function(o,u){const m=o.constructor;if(!v)throw new Error(`${m.name}: @type() reference provided for "${u}" is undefined. Make sure you don't have any circular dependencies.`);De.register(m);const I=Object.getPrototypeOf(m)[Symbol.metadata],R=Fe.initialize(m);let P=R[u];if(R[P]!==void 0){if(R[P].deprecated)return;if(R[P].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${u}' definition on '${m.name}'.
Check @type() annotation`)}catch(F){const G=F.stack.split(`
`)[4].trim();throw new Error(`${F.message} ${G}`)}}else P=R[j]??(I&&I[j])??-1,P++;if(a&&a.manual)Fe.addField(R,P,u,v,{enumerable:!0,configurable:!0,writable:!0});else{const F=Array.isArray(v)?Pe("array"):typeof Object.keys(v)[0]=="string"&&Pe(Object.keys(v)[0]),G=F?Object.values(v)[0]:v;Fe.addField(R,P,u,v,Hr(`_${u}`,P,G,F))}}}function Hr(v,a,o,u){return{get:function(){return this[v]},set:function(m){var I,R;const _=this[v]??void 0;if(m!==_){if(m!=null){u?(u.constructor===Jt&&!(m instanceof Jt)&&(m=new Jt(...m)),u.constructor===Tt&&!(m instanceof Tt)&&(m=new Tt(m)),m[T]=o):typeof o!="string"?Is(m,o,this,v.substring(1)):ur(m,o,this,v.substring(1));const P=this[p];_!==void 0&&_[p]?((I=P.root)==null||I.remove(_[p]),this.constructor[i](P,a,t.OPERATION.DELETE_AND_ADD)):this.constructor[i](P,a,t.OPERATION.ADD),(R=m[p])==null||R.setParent(this,P.root,a)}else _!==void 0&&this[p].delete(a);this[v]=m}},enumerable:!0,configurable:!0}}function un(v=!0){return function(a,o){var P;const u=a.constructor,_=Object.getPrototypeOf(u)[Symbol.metadata],I=u[P=Symbol.metadata]??(u[P]=Object.assign({},u[Symbol.metadata],_??Object.create(null))),R=I[o];I[R].deprecated=!0,v&&(I[V]??(I[V]={}),I[V][o]={get:function(){throw new Error(`${o} is deprecated.`)},set:function(F){},enumerable:!1,configurable:!0}),Object.defineProperty(I,R,{value:I[R],enumerable:!1,configurable:!0})}}function ji(v,a,o){for(let u in a)Zt(a[u],o)(v.prototype,u);return v}function Gr(v,a,o=ut){const u={},m={};for(let I in v){const R=v[I];typeof R=="object"&&(R.default!==void 0&&(u[I]=R.default),R.view!==void 0&&(m[I]=typeof R.view=="boolean"?cn:R.view))}const _=Fe.setFields(class extends o{constructor(...I){I[0]=Object.assign({},u,I[0]),super(...I)}},v);for(let I in m)jr(m[I])(_.prototype,I);return a&&Object.defineProperty(_,"name",{value:a}),_.extends=(I,R)=>Gr(I,R,_),_}function zs(v){return new Array(v).fill(0).map((a,o)=>o===v-1?"└─ ":"   ").join("")}function Hi(v){const a=v[p].root,o={ops:{},refs:[]};return a.changes.forEach(u=>{if(u===void 0)return;const m=u.indexedOperations;o.refs.push(`refId#${u.refId}`);for(const _ in m){const I=m[_],R=t.OPERATION[I];o.ops[R]||(o.ops[R]=0),o.ops[t.OPERATION[I]]++}}),o}var Zr,As;const Ds=class Ds{static initialize(a){var o;Object.defineProperty(a,p,{value:new Xt(a),enumerable:!1,writable:!0}),Object.defineProperties(a,((o=a.constructor[Symbol.metadata])==null?void 0:o[V])||{})}static is(a){return typeof a[Symbol.metadata]=="object"}static[(Zr=l,As=c,i)](a,o,u=t.OPERATION.ADD){a.change(o,u)}static[g](a,o,u){var I,R;const _=(I=a.constructor[Symbol.metadata][o])==null?void 0:I.tag;if(u===void 0)return _===void 0;if(_===void 0)return!0;if(_===cn)return u.isChangeTreeVisible(a[p]);{const P=(R=u.tags)==null?void 0:R.get(a[p]);return P&&P.has(_)}}constructor(...a){Ds.initialize(this),a[0]&&Object.assign(this,a[0])}assign(a){return Object.assign(this,a),this}setDirty(a,o){const u=this.constructor[Symbol.metadata];this[p].change(u[u[a]].index,o)}clone(){var u;const a=new this.constructor,o=this.constructor[Symbol.metadata];for(const m in o){const _=o[m].name;typeof this[_]=="object"&&typeof((u=this[_])==null?void 0:u.clone)=="function"?a[_]=this[_].clone():a[_]=this[_]}return a}toJSON(){const a={},o=this.constructor[Symbol.metadata];for(const u in o){const m=o[u],_=m.name;!m.deprecated&&this[_]!==null&&typeof this[_]<"u"&&(a[_]=typeof this[_].toJSON=="function"?this[_].toJSON():this[_])}return a}discardAllChanges(){this[p].discardAll()}[f](a){const o=this.constructor[Symbol.metadata];return this[o[a].name]}[h](a){const o=this.constructor[Symbol.metadata];this[o[a].name]=void 0}static debugRefIds(a,o=!1,u=0){const m=o?` - ${JSON.stringify(a.toJSON())}`:"",_=a[p],I=_.refId;let R="";return R+=`${zs(u)}${a.constructor.name} (refId: ${I})${m}
`,_.forEachChild(P=>R+=this.debugRefIds(P.ref,o,u+1)),R}static debugChanges(a,o=!1){const u=a[p],m=o?u.allChanges:u.changes,_=o?"allChanges":"changes";let I=`${a.constructor.name} (${u.refId}) -> .${_}:
`;function R(P){P.operations.filter(F=>F).forEach(F=>{const G=u.indexedOperations[F];console.log({index:F,operation:G}),I+=`- [${F}]: ${t.OPERATION[G]} (${JSON.stringify(u.getValue(Number(F),o))})
`})}return R(m),!o&&u.filteredChanges&&u.filteredChanges.operations.filter(P=>P).length>0&&(I+=`${a.constructor.name} (${u.refId}) -> .filteredChanges:
`,R(u.filteredChanges)),o&&u.allFilteredChanges&&u.allFilteredChanges.operations.filter(P=>P).length>0&&(I+=`${a.constructor.name} (${u.refId}) -> .allFilteredChanges:
`,R(u.allFilteredChanges)),I}static debugChangesDeep(a,o="changes"){var G,X;let u="";const m=a[p],_=m.root,I=new Map,R=[];let P=0;for(const[W,he]of Object.entries(_[o])){const ce=_.changeTrees[W];let re=!1,K=[],fe=(G=ce.parent)==null?void 0:G[p];if(ce===m)re=!0;else for(;fe!==void 0;){if(K.push(fe),fe.ref===a){re=!0;break}fe=(X=fe.parent)==null?void 0:X[p]}re&&(R.push(ce.refId),P+=Object.keys(he).length,I.set(ce,K.reverse()))}u+=`---
`,u+=`root refId: ${m.refId}
`,u+=`Total instances: ${R.length} (refIds: ${R.join(", ")})
`,u+=`Total changes: ${P}
`,u+=`---
`;const F=new WeakSet;for(const[W,he]of I.entries()){he.forEach((He,qe)=>{F.has(He)||(u+=`${zs(qe)}${He.ref.constructor.name} (refId: ${He.refId})
`,F.add(He))});const ce=W.indexedOperations,re=he.length,K=zs(re),fe=re>0?`(${W.parentIndex}) `:"";u+=`${K}${fe}${W.ref.constructor.name} (refId: ${W.refId}) - changes: ${Object.keys(ce).length}
`;for(const He in ce){const qe=ce[He];u+=`${zs(re+1)}${t.OPERATION[qe]}: ${He}
`}}return`${u}`}};Ds[Zr]=Gs,Ds[As]=Ur;let ut=Ds;var zr,Qt;const Qn=class Qn{static[(zr=l,Qt=c,g)](a,o,u){return!u||typeof a[T]=="string"||u.isChangeTreeVisible((a[f](o)??a.deletedItems[o])[p])}static is(a){return a.collection!==void 0}constructor(a){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[p]=new Xt(this),this[p].indexes={},a&&a.forEach(o=>this.add(o)),Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(a){const o=this.$refId++;return a[p]!==void 0&&a[p].setParent(this,this[p].root,o),this[p].indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,a),this[p].change(o),o}at(a){const o=Array.from(this.$items.keys())[a];return this.$items.get(o)}entries(){return this.$items.entries()}delete(a){const o=this.$items.entries();let u,m;for(;(m=o.next())&&!m.done;)if(a===m.value[1]){u=m.value[0];break}return u===void 0?!1:(this.deletedItems[u]=this[p].delete(u),this.$indexes.delete(u),this.$items.delete(u))}clear(){const a=this[p];a.discard(!0),a.indexes={},this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){return Array.from(this.$items.values()).some(o=>o===a)}forEach(a){this.$items.forEach((o,u,m)=>a(o,u,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(a,o){this.$indexes.set(a,o)}getIndex(a){return this.$indexes.get(a)}[f](a){return this.$items.get(this.$indexes.get(a))}[h](a){const o=this.$indexes.get(a);this.$items.delete(o),this.$indexes.delete(a)}[C](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const a=[];return this.forEach((o,u)=>{a.push(typeof o.toJSON=="function"?o.toJSON():o)}),a}clone(a){let o;return a?o=Object.assign(new Qn,this):(o=new Qn,this.forEach(u=>{u[p]?o.add(u.clone()):o.add(u)})),o}};Qn[zr]=qn,Qn[Qt]=Zs;let Os=Qn;ue("collection",{constructor:Os});var Wr,Kr;const es=class es{static[(Wr=l,Kr=c,g)](a,o,u){return!u||typeof a[T]=="string"||u.visible.has((a[f](o)??a.deletedItems[o])[p])}static is(a){return a.set!==void 0}constructor(a){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[p]=new Xt(this),this[p].indexes={},a&&a.forEach(o=>this.add(o)),Object.defineProperty(this,T,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(a){var m;if(this.has(a))return!1;const o=this.$refId++;a[p]!==void 0&&a[p].setParent(this,this[p].root,o);const u=((m=this[p].indexes[o])==null?void 0:m.op)??t.OPERATION.ADD;return this[p].indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,a),this[p].change(o,u),o}entries(){return this.$items.entries()}delete(a){const o=this.$items.entries();let u,m;for(;(m=o.next())&&!m.done;)if(a===m.value[1]){u=m.value[0];break}return u===void 0?!1:(this.deletedItems[u]=this[p].delete(u),this.$indexes.delete(u),this.$items.delete(u))}clear(){const a=this[p];a.discard(!0),a.indexes={},this.$indexes.clear(),this.$items.clear(),a.operation(t.OPERATION.CLEAR)}has(a){const o=this.$items.values();let u=!1,m;for(;(m=o.next())&&!m.done;)if(a===m.value){u=!0;break}return u}forEach(a){this.$items.forEach((o,u,m)=>a(o,u,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(a,o){this.$indexes.set(a,o)}getIndex(a){return this.$indexes.get(a)}[f](a){return this.$items.get(this.$indexes.get(a))}[h](a){const o=this.$indexes.get(a);this.$items.delete(o),this.$indexes.delete(a)}[C](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const a=[];return this.forEach((o,u)=>{a.push(typeof o.toJSON=="function"?o.toJSON():o)}),a}clone(a){let o;return a?o=Object.assign(new es,this):(o=new es,this.forEach(u=>{u[p]?o.add(u.clone()):o.add(u)})),o}};es[Wr]=qn,es[Kr]=Zs;let xs=es;ue("set",{constructor:xs});function Tn(v,a,o,u){var m=arguments.length,_=m<3?a:u===null?u=Object.getOwnPropertyDescriptor(a,o):u,I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(v,a,o,u);else for(var R=v.length-1;R>=0;R--)(I=v[R])&&(_=(m<3?I(_):m>3?I(a,o,_):I(a,o))||_);return m>3&&_&&Object.defineProperty(a,o,_),_}typeof SuppressedError=="function"&&SuppressedError;class Gi{constructor(a){this.types=a,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(a){a.ensureRefId();const o=this.changeTrees[a.refId]===void 0;o&&(this.changeTrees[a.refId]=a);const u=this.refCount[a.refId];if(u===0){const m=a.allChanges.operations;let _=m.length;for(;_--;)a.indexedOperations[m[_]]=t.OPERATION.ADD,bt(a.changes,_)}return this.refCount[a.refId]=(u||0)+1,o}remove(a){const o=this.refCount[a.refId]-1;return o<=0?(a.root=void 0,delete this.changeTrees[a.refId],this.removeChangeFromChangeSet("allChanges",a),this.removeChangeFromChangeSet("changes",a),a.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",a),this.removeChangeFromChangeSet("filteredChanges",a)),this.refCount[a.refId]=0):(this.refCount[a.refId]=o,a.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",a),_t(this,a,"filteredChanges")):(this.removeChangeFromChangeSet("changes",a),_t(this,a,"changes"))),a.forEachChild((u,m)=>this.remove(u)),o}removeChangeFromChangeSet(a,o){const u=this[a],m=u.indexOf(o);if(m!==-1)return o[a].queueRootIndex=-1,u[m]=void 0,!0}clear(){this.changes.length=0}}const Ks=class Ks{constructor(a){this.sharedBuffer=Buffer.allocUnsafe(Ks.BUFFER_SIZE),this.context=De.cache(a.constructor),this.root=new Gi(this.context),this.setState(a)}setState(a){this.state=a,this.state[p].setRoot(this.root)}encode(a={offset:0},o,u=this.sharedBuffer,m="changes",_=m==="allChanges",I=a.offset){const R=o!==void 0,P=this.state[p],F=this.root[m];for(let G=0,X=F.length;G<X;G++){const W=F[G];if(!W)continue;if(R){if(!o.isChangeTreeVisible(W)){o.invisible.add(W);continue}o.invisible.delete(W)}const he=W[m],ce=W.ref,re=he.operations.length;if(re===0)continue;const K=ce.constructor,fe=K[l],He=K[g],qe=K[Symbol.metadata];(R||a.offset>I||W!==P)&&(u[a.offset++]=255,Re.number(u,W.refId,a));for(let pt=0;pt<re;pt++){const gt=he.operations[pt],fn=gt<0?Math.abs(gt):_?t.OPERATION.ADD:W.indexedOperations[gt];gt===void 0||fn===void 0||He&&!He(ce,gt,o)||fe(this,u,W,gt,fn,a,_,R,qe)}}if(a.offset>u.byteLength){const G=Math.ceil(a.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(G/1024)} * 1024; // ${Math.round(G/1024)} KB
`),u=Buffer.alloc(G,u),u===this.sharedBuffer&&(this.sharedBuffer=u),this.encode({offset:I},o,u,m,_)}else return u.subarray(0,a.offset)}encodeAll(a={offset:0},o=this.sharedBuffer){return this.encode(a,void 0,o,"allChanges",!0)}encodeAllView(a,o,u,m=this.sharedBuffer){const _=u.offset;return this.encode(u,a,m,"allFilteredChanges",!0,_),Buffer.concat([m.subarray(0,o),m.subarray(_,u.offset)])}debugChanges(a){(typeof a=="string"?this.root[a]:a).forEach(u=>{const m=u[a],_=u.ref.constructor[Symbol.metadata];console.log("->",{ref:u.ref.constructor.name,refId:u.refId,changes:Object.keys(m).length});for(const I in m){const R=m[I];console.log("  ->",{index:I,field:_==null?void 0:_[I],op:t.OPERATION[R]})}})}encodeView(a,o,u,m=this.sharedBuffer){const _=u.offset;for(const[I,R]of a.changes){const P=this.root.changeTrees[I];if(P===void 0){a.changes.delete(I);continue}const F=Object.keys(R);if(F.length===0)continue;const X=P.ref.constructor,W=X[l],he=X[Symbol.metadata];m[u.offset++]=255,Re.number(m,P.refId,u);for(let ce=0,re=F.length;ce<re;ce++){const K=Number(F[ce]),He=P.ref[f](K)!==void 0&&R[K]||t.OPERATION.DELETE;W(this,m,P,K,He,u,!1,!0,he)}}return a.changes.clear(),this.encode(u,a,m,"filteredChanges",!1,_),Buffer.concat([m.subarray(0,o),m.subarray(_,u.offset)])}discardChanges(){var o,u;let a=this.root.changes.length;if(a>0){for(;a--;)(o=this.root.changes[a])==null||o.endEncode("changes");this.root.changes.length=0}if(a=this.root.filteredChanges.length,a>0){for(;a--;)(u=this.root.filteredChanges[a])==null||u.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(a,o,u,m){const _=this.context.getTypeId(o),I=this.context.getTypeId(u);if(I===void 0){console.warn(`@colyseus/schema WARNING: Class "${u.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}_!==I&&(a[m.offset++]=213,Re.number(a,I,m))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};Ks.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let Mn=Ks;function qr(v,a){if(a===-1||a>=v.length)return!1;const o=v.length-1;for(let u=a;u<o;u++)v[u]=v[u+1];return v.length=o,!0}class Yr extends Error{constructor(a){super(a),this.name="DecodingWarning"}}class Zi{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(a,o,u=!0){this.refs.set(a,o),this.refIds.set(o,a),u&&(this.refCounts[a]=(this.refCounts[a]||0)+1),this.deletedRefs.has(a)&&this.deletedRefs.delete(a)}removeRef(a){const o=this.refCounts[a];if(o===void 0){try{throw new Yr("trying to remove refId that doesn't exist: "+a)}catch(u){console.warn(u)}return}if(o===0){try{const u=this.refs.get(a);throw new Yr(`trying to remove refId '${a}' with 0 refCount (${u.constructor.name}: ${JSON.stringify(u)})`)}catch(u){console.warn(u)}return}(this.refCounts[a]=o-1)<=0&&this.deletedRefs.add(a)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(a=>{if(this.refCounts[a]>0)return;const o=this.refs.get(a);if(o.constructor[Symbol.metadata]!==void 0){const u=o.constructor[Symbol.metadata];for(const m in u){const _=u[m].name,I=typeof o[_]=="object"&&this.refIds.get(o[_]);I&&!this.deletedRefs.has(I)&&this.removeRef(I)}}else typeof o[T]=="function"&&Array.from(o.values()).forEach(u=>{const m=this.refIds.get(u);this.deletedRefs.has(m)||this.removeRef(m)});this.refs.delete(a),delete this.refCounts[a],delete this.callbacks[a]}),this.deletedRefs.clear()}addCallback(a,o,u){if(a===void 0){const m=typeof o=="number"?t.OPERATION[o]:o;throw new Error(`Can't addCallback on '${m}' (refId is undefined)`)}return this.callbacks[a]||(this.callbacks[a]={}),this.callbacks[a][o]||(this.callbacks[a][o]=[]),this.callbacks[a][o].push(u),()=>this.removeCallback(a,o,u)}removeCallback(a,o,u){var _,I,R;const m=(R=(I=(_=this.callbacks)==null?void 0:_[a])==null?void 0:I[o])==null?void 0:R.indexOf(u);m!==-1&&qr(this.callbacks[a][o],m)}}class Ws{constructor(a,o){this.currentRefId=0,this.setState(a),this.context=o||new De(a.constructor)}setState(a){this.state=a,this.root=new Zi,this.root.addRef(0,a)}decode(a,o={offset:0},u=this.state){var P,F,G;const m=[],_=this.root,I=a.byteLength;let R=u.constructor[c];for(this.currentRefId=0;o.offset<I;){if(a[o.offset]==255){o.offset++,this.currentRefId=$.number(a,o);const W=_.refs.get(this.currentRefId);if(!W)throw new Error(`"refId" not found: ${this.currentRefId}`);(P=u[Z])==null||P.call(u),u=W,R=u.constructor[c];continue}if(R(this,a,o,u,m)===Mr){console.warn("@colyseus/schema: definition mismatch");const W={offset:o.offset};for(;o.offset<I&&!(a[o.offset]===255&&(W.offset=o.offset+1,_.refs.has($.number(a,W))));)o.offset++;continue}}return(F=u[Z])==null||F.call(u),(G=this.triggerChanges)==null||G.call(this,m),_.garbageCollectDeletedRefs(),m}getInstanceType(a,o,u){let m;if(a[o.offset]===213){o.offset++;const _=$.number(a,o);m=this.context.get(_)}return m||u}createInstanceOfType(a){return new a}removeChildRefs(a,o){const u=typeof a[T]!="string",m=this.root.refIds.get(a);a.forEach((_,I)=>{o.push({ref:a,refId:m,op:t.OPERATION.DELETE,field:I,value:void 0,previousValue:_}),u&&this.root.removeRef(this.root.refIds.get(_))})}}class Xn extends ut{}Tn([Zt("string")],Xn.prototype,"name",void 0),Tn([Zt("string")],Xn.prototype,"type",void 0),Tn([Zt("number")],Xn.prototype,"referencedType",void 0);class Jn extends ut{constructor(){super(...arguments),this.fields=new Jt}}Tn([Zt("number")],Jn.prototype,"id",void 0),Tn([Zt("number")],Jn.prototype,"extendsId",void 0),Tn([Zt([Xn])],Jn.prototype,"fields",void 0);class Sn extends ut{constructor(){super(...arguments),this.types=new Jt}static encode(a,o={offset:0}){const u=a.context,m=new Sn,_=new Mn(m),I=u.schemas.get(a.state.constructor);I>0&&(m.rootType=I);const R=new Set,P={},F=X=>{if(X.extendsId===void 0||R.has(X.extendsId)){R.add(X.id),m.types.push(X);const W=P[X.id];W!==void 0&&(delete P[X.id],W.forEach(he=>F(he)))}else P[X.extendsId]===void 0&&(P[X.extendsId]=[]),P[X.extendsId].push(X)};u.schemas.forEach((X,W)=>{const he=new Jn;he.id=Number(X);const ce=Object.getPrototypeOf(W);ce!==ut&&(he.extendsId=u.schemas.get(ce));const re=W[Symbol.metadata];if(re!==ce[Symbol.metadata])for(const K in re){const fe=Number(K),He=re[fe].name;if(!Object.prototype.hasOwnProperty.call(re,He))continue;const qe=new Xn;qe.name=He;let pt;const gt=re[fe];if(typeof gt.type=="string")pt=gt.type;else{let fn;ut.is(gt.type)?(pt="ref",fn=gt.type):(pt=Object.keys(gt.type)[0],typeof gt.type[pt]=="string"?pt+=":"+gt.type[pt]:fn=gt.type[pt]),qe.referencedType=fn?u.getTypeId(fn):-1}qe.type=pt,he.fields.push(qe)}F(he)});for(const X in P)P[X].forEach(W=>m.types.push(W));const G=_.encodeAll(o);return Buffer.from(G,0,o.offset)}static decode(a,o){const u=new Sn;new Ws(u).decode(a,o);const _=new De;u.types.forEach(P=>{const F=_.get(P.extendsId)??ut,G=class extends F{};De.register(G),_.add(G,P.id)},{});const I=(P,F,G)=>{F.fields.forEach((X,W)=>{const he=G+W;if(X.referencedType!==void 0){let ce=X.type,re=_.get(X.referencedType);if(!re){const K=X.type.split(":");ce=K[0],re=K[1]}ce==="ref"?Fe.addField(P,he,X.name,re):Fe.addField(P,he,X.name,{[ce]:re})}else Fe.addField(P,he,X.name,X.type)})};u.types.forEach(P=>{const F=_.get(P.id),G=Fe.initialize(F),X=[];let W=P;do X.push(W),W=u.types.find(ce=>ce.id===W.extendsId);while(W);let he=0;X.reverse().forEach(ce=>{I(G,ce,he),he+=ce.fields.length})});const R=new(_.get(u.rootType||0));return new Ws(R,_)}}Tn([Zt([Jn])],Sn.prototype,"types",void 0),Tn([Zt("number")],Sn.prototype,"rootType",void 0);function zi(v){const a=v.root,o=a.callbacks,u=new WeakMap;let m;v.triggerChanges=function(R){var F;const P=new Set;for(let G=0,X=R.length;G<X;G++){const W=R[G],he=W.refId,ce=W.ref,re=o[he];if(re){if((W.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&W.previousValue instanceof ut){const K=(F=o[a.refIds.get(W.previousValue)])==null?void 0:F[t.OPERATION.DELETE];for(let fe=(K==null?void 0:K.length)-1;fe>=0;fe--)K[fe]()}if(ce instanceof ut){if(!P.has(he)){const K=re==null?void 0:re[t.OPERATION.REPLACE];for(let fe=(K==null?void 0:K.length)-1;fe>=0;fe--)K[fe]()}if(re.hasOwnProperty(W.field)){const K=re[W.field];for(let fe=(K==null?void 0:K.length)-1;fe>=0;fe--)K[fe](W.value,W.previousValue)}}else{if((W.op&t.OPERATION.DELETE)===t.OPERATION.DELETE){if(W.previousValue!==void 0){const K=re[t.OPERATION.DELETE];for(let fe=(K==null?void 0:K.length)-1;fe>=0;fe--)K[fe](W.previousValue,W.dynamicIndex??W.field)}if((W.op&t.OPERATION.ADD)===t.OPERATION.ADD){const K=re[t.OPERATION.ADD];for(let fe=(K==null?void 0:K.length)-1;fe>=0;fe--)K[fe](W.value,W.dynamicIndex??W.field)}}else if((W.op&t.OPERATION.ADD)===t.OPERATION.ADD&&W.previousValue!==W.value){const K=re[t.OPERATION.ADD];for(let fe=(K==null?void 0:K.length)-1;fe>=0;fe--)K[fe](W.value,W.dynamicIndex??W.field)}if(W.value!==W.previousValue&&(W.value!==void 0||W.previousValue!==void 0)){const K=re[t.OPERATION.REPLACE];for(let fe=(K==null?void 0:K.length)-1;fe>=0;fe--)K[fe](W.value,W.dynamicIndex??W.field)}}P.add(he)}}};function _(R,P){var X;let F=((X=P.instance)==null?void 0:X.constructor[Symbol.metadata])||R,G=P.instance&&typeof P.instance.forEach=="function"||R&&typeof R[Symbol.metadata]>"u";if(F&&!G){const W=function(he,ce,re,K){return K&&P.instance[ce]!==void 0&&!u.has(m)&&re(P.instance[ce],void 0),a.addCallback(a.refIds.get(he),ce,re)};return new Proxy({listen:function(ce,re,K=!0){if(P.instance)return W(P.instance,ce,re,K);{let fe=()=>{};return P.onInstanceAvailable((He,qe)=>{fe=W(He,ce,re,K&&qe&&!u.has(m))}),()=>fe()}},onChange:function(ce){return a.addCallback(a.refIds.get(P.instance),t.OPERATION.REPLACE,ce)},bindTo:function(ce,re){return re||(re=Object.keys(F).map(K=>F[K].name)),a.addCallback(a.refIds.get(P.instance),t.OPERATION.REPLACE,()=>{re.forEach(K=>ce[K]=P.instance[K])})}},{get(he,ce){var K;const re=F[F[ce]];if(re){const fe=(K=P.instance)==null?void 0:K[ce],He=qe=>{const pt=I(P.instance).listen(ce,(gt,fn)=>{qe(gt,!1),pt==null||pt()},!1);a.refIds.get(fe)!==void 0&&qe(fe,!0)};return _(re.type,{instance:a.refIds.get(fe)&&fe,parentInstance:P.instance,onInstanceAvailable:He})}else return he[ce]},has(he,ce){return F[ce]!==void 0},set(he,ce,re){throw new Error("not allowed")},deleteProperty(he,ce){throw new Error("not allowed")}})}else{const W=function(re,K,fe){return fe&&re.forEach((He,qe)=>K(He,qe)),a.addCallback(a.refIds.get(re),t.OPERATION.ADD,(He,qe)=>{u.set(K,!0),m=K,K(He,qe),u.delete(K),m=void 0})},he=function(re,K){return a.addCallback(a.refIds.get(re),t.OPERATION.DELETE,K)},ce=function(re,K){return a.addCallback(a.refIds.get(re),t.OPERATION.REPLACE,K)};return new Proxy({onAdd:function(re,K=!0){if(P.instance)return W(P.instance,re,K&&!u.has(m));if(P.onInstanceAvailable){let fe=()=>{};return P.onInstanceAvailable((He,qe)=>{fe=W(He,re,K&&qe&&!u.has(m))}),()=>fe()}},onRemove:function(re){if(P.instance)return he(P.instance,re);if(P.onInstanceAvailable){let K=()=>{};return P.onInstanceAvailable(fe=>{K=he(fe,re)}),()=>K()}},onChange:function(re){if(P.instance)return ce(P.instance,re);if(P.onInstanceAvailable){let K=()=>{};return P.onInstanceAvailable(fe=>{K=ce(fe,re)}),()=>K()}}},{get(re,K){if(!re[K])throw new Error(`Can't access '${K}' through callback proxy. access the instance directly.`);return re[K]},has(re,K){return re[K]!==void 0},set(re,K,fe){throw new Error("not allowed")},deleteProperty(re,K){throw new Error("not allowed")}})}}function I(R){return _(void 0,{instance:R})}return I}function Wi(v,a){v.triggerChanges=a}class Ki{constructor(a=!1){this.iterable=a,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,a&&(this.items=[])}add(a,o=cn,u=!0){var R,P;const m=a==null?void 0:a[p];if(m){if(!m.parent&&m.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${m.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",a),this;const _=a.constructor[Symbol.metadata];this.visible.add(m),this.iterable&&u&&this.items.push(a),u&&m.parent&&this.addParentOf(m,o);let I=this.changes.get(m.refId);if(I===void 0&&(I={},this.changes.set(m.refId,I)),o!==cn){this.tags||(this.tags=new WeakMap);let F;this.tags.has(m)?F=this.tags.get(m):(F=new Set,this.tags.set(m,F)),F.add(o),(P=(R=_==null?void 0:_[de])==null?void 0:R[o])==null||P.forEach(G=>{m.getChange(G)!==t.OPERATION.DELETE&&(I[G]=t.OPERATION.ADD)})}else{const F=this.invisible.has(m),G=m.filteredChanges!==void 0?m.allFilteredChanges:m.allChanges;for(let X=0,W=G.operations.length;X<W;X++){const he=G.operations[X];if(he===void 0)continue;const ce=m.indexedOperations[he]??t.OPERATION.ADD,re=_==null?void 0:_[he].tag;!m.isNew&&(F||re===void 0||re===o)&&ce!==t.OPERATION.DELETE&&(I[he]=ce)}}return m.forEachChild((F,G)=>{_&&_[G].tag!==void 0&&_[G].tag!==o||this.add(F.ref,o,!1)}),this}addParentOf(a,o){var _;const u=a.parent[p],m=a.parentIndex;if(!this.visible.has(u)){this.visible.add(u);const I=(_=u.parent)==null?void 0:_[p];I&&I.filteredChanges!==void 0&&this.addParentOf(u,o)}if(u.getChange(m)!==t.OPERATION.DELETE){let I=this.changes.get(u.refId);I===void 0&&(I={},this.changes.set(u.refId,I)),this.tags||(this.tags=new WeakMap);let R;this.tags.has(u)?R=this.tags.get(u):(R=new Set,this.tags.set(u,R)),R.add(o),I[m]=t.OPERATION.ADD}}remove(a,o=cn,u=!1){var P;const m=a[p];if(!m)return console.warn("StateView#remove(), invalid object:",a),this;this.visible.delete(m),this.iterable&&!u&&qr(this.items,this.items.indexOf(a));const I=m.ref.constructor[Symbol.metadata];let R=this.changes.get(m.refId);if(R===void 0&&(R={},this.changes.set(m.refId,R)),o===cn){const F=m.parent;if(!Fe.isValidInstance(F)&&m.isFiltered){const G=F[p];let X=this.changes.get(G.refId);X===void 0&&(X={},this.changes.set(G.refId,X)),X[m.parentIndex]=t.OPERATION.DELETE}else(P=I==null?void 0:I[ne])==null||P.forEach(G=>R[G]=t.OPERATION.DELETE)}else I==null||I[de][o].forEach(F=>R[F]=t.OPERATION.DELETE);if(this.tags&&this.tags.has(m)){const F=this.tags.get(m);o===void 0?this.tags.delete(m):(F.delete(o),F.size===0&&this.tags.delete(m))}return this}has(a){return this.visible.has(a[p])}hasTag(a,o=cn){var m;const u=(m=this.tags)==null?void 0:m.get(a[p]);return(u==null?void 0:u.has(o))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let a=0,o=this.items.length;a<o;a++)this.remove(this.items[a],cn,!0);this.items.length=0}isChangeTreeVisible(a){let o=this.visible.has(a);return!o&&a.isVisibilitySharedWithParent&&this.visible.has(a.parent[p])&&(this.visible.add(a),o=!0),o}}ue("map",{constructor:Tt}),ue("array",{constructor:Jt}),ue("set",{constructor:xs}),ue("collection",{constructor:Os}),t.$changes=p,t.$childType=T,t.$decoder=c,t.$deleteByIndex=h,t.$encoder=l,t.$filter=g,t.$getByIndex=f,t.$track=i,t.ArraySchema=Jt,t.ChangeTree=Xt,t.CollectionSchema=Os,t.Decoder=Ws,t.Encoder=Mn,t.MapSchema=Tt,t.Metadata=Fe,t.Reflection=Sn,t.ReflectionField=Xn,t.ReflectionType=Jn,t.Schema=ut,t.SetSchema=xs,t.StateView=Ki,t.TypeContext=De,t.decode=$,t.decodeKeyValueOperation=Zs,t.decodeSchemaOperation=Ur,t.defineCustomTypes=Ie,t.defineTypes=ji,t.deprecated=un,t.dumpChanges=Hi,t.encode=Re,t.encodeArray=Yn,t.encodeKeyValueOperation=qn,t.encodeSchemaOperation=Gs,t.entity=Fi,t.getDecoderStateCallbacks=zi,t.getRawChangesCallback=Wi,t.registerType=ue,t.schema=Gr,t.type=Zt,t.view=jr})})(wa,wa.exports);var Fa=wa.exports,ho=Ni,Rs=Fa;class Rd{constructor(e){this.events=e,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(e,t={}){const s=t.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(t.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(e,s),this.wt.ready.then(r=>{console.log("WebTransport ready!",r),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(l=>{this.reader=l.value.readable.getReader(),this.writer=l.value.writable.getWriter(),this.sendSeatReservation(t.room.roomId,t.sessionId,t.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(l=>{console.error("failed to read incoming stream",l),console.error("TODO: close the connection")})}).catch(r=>{console.log("WebTransport not ready!",r),this._close()}),this.wt.closed.then(r=>{console.log("WebTransport closed w/ success",r),this.events.onclose({code:r.closeCode,reason:r.reason})}).catch(r=>{console.log("WebTransport closed w/ error",r),this.events.onerror(r),this.events.onclose({code:r.closeCode,reason:r.reason})}).finally(()=>{this._close()})}send(e){const t=Rs.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),s=new Uint8Array(t+e.length);s.set(this.lengthPrefixBuffer.subarray(0,t),0),s.set(e,t),this.writer.write(s)}sendUnreliable(e){const t=Rs.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),s=new Uint8Array(t+e.length);s.set(this.lengthPrefixBuffer.subarray(0,t),0),s.set(e,t),this.unreliableWriter.write(s)}close(e,t){try{this.wt.close({closeCode:e,reason:t})}catch(s){console.error(s)}}readIncomingData(){return ho.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.reader.read();const t=e.value,s={offset:0};do{const r=Rs.decode.number(t,s);this.events.onmessage({data:t.subarray(s.offset,s.offset+r)}),s.offset+=r}while(s.offset<t.length)}catch(t){t.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",t);break}if(e.done)break}})}readIncomingUnreliableData(){return ho.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.unreliableReader.read();const t=e.value,s={offset:0};do{const r=Rs.decode.number(t,s);this.events.onmessage({data:t.subarray(s.offset,s.offset+r)}),s.offset+=r}while(s.offset<t.length)}catch(t){t.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",t);break}if(e.done)break}})}sendSeatReservation(e,t,s){const r={offset:0},i=[];Rs.encode.string(i,e,r),Rs.encode.string(i,t,r),s&&Rs.encode.string(i,s,r),this.writer.write(new Uint8Array(i).buffer)}_close(){this.isOpen=!1}}Xl.H3TransportTransport=Rd;var Jl={},Pd=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},kd=Pd;const ta=globalThis.WebSocket||kd;let Ld=class{constructor(e){this.events=e}send(e){this.ws.send(e)}sendUnreliable(e){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(e,t){try{this.ws=new ta(e,{headers:t,protocols:this.protocols})}catch{this.ws=new ta(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,t){this.ws.close(e,t)}get isOpen(){return this.ws.readyState===ta.OPEN}};Jl.WebSocketTransport=Ld;var Bd=Xl,Cd=Jl;let Md=class{constructor(e){switch(this.events={},e){case"h3":this.transport=new Bd.H3TransportTransport(this.events);break;default:this.transport=new Cd.WebSocketTransport(this.events);break}}connect(e,t){this.transport.connect.call(this.transport,e,t)}send(e){this.transport.send(e)}sendUnreliable(e){this.transport.sendUnreliable(e)}close(e,t){this.transport.close(e,t)}get isOpen(){return this.transport.isOpen}};Yl.Connection=Md;var ja={};(function(n){n.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(n.Protocol||(n.Protocol={})),n.ErrorCode=void 0,function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(n.ErrorCode||(n.ErrorCode={}))})(ja);var Ri={};const Ql={};function Ud(n,e){Ql[n]=e}function $d(n){const e=Ql[n];if(!e)throw new Error("missing serializer: "+n);return e}Ri.getSerializer=$d;Ri.registerSerializer=Ud;var Ha={};const Vd=()=>({emit(n,...e){let t=this.events[n]||[];for(let s=0,r=t.length;s<r;s++)t[s](...e)},events:{},on(n,e){var t;return!((t=this.events[n])===null||t===void 0)&&t.push(e)||(this.events[n]=[e]),()=>{var s;this.events[n]=(s=this.events[n])===null||s===void 0?void 0:s.filter(r=>e!==r)}}});Ha.createNanoEvents=Vd;var Ga={};class ec{constructor(){this.handlers=[]}register(e,t=!1){return this.handlers.push(e),this}invoke(...e){this.handlers.forEach(t=>t.apply(this,e))}invokeAsync(...e){return Promise.all(this.handlers.map(t=>t.apply(this,e)))}remove(e){const t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function Fd(){const n=new ec;function e(t){return n.register(t,this===null)}return e.once=t=>{const s=function(...r){t.apply(this,r),n.remove(s)};n.register(s)},e.remove=t=>n.remove(t),e.invoke=(...t)=>n.invoke(...t),e.invokeAsync=(...t)=>n.invokeAsync(...t),e.clear=()=>n.clear(),e}Ga.EventEmitter=ec;Ga.createSignal=Fd;var Pi={},ci=Fa;function jd(n){try{return ci.getDecoderStateCallbacks(n.serializer.decoder)}catch{return}}let Hd=class{setState(e,t){this.decoder.decode(e,t)}getState(){return this.state}patch(e,t){return this.decoder.decode(e,t)}teardown(){this.decoder.root.clearRefs()}handshake(e,t){this.state?(ci.Reflection.decode(e,t),this.decoder=new ci.Decoder(this.state)):(this.decoder=ci.Reflection.decode(e,t),this.state=this.decoder.state)}};Pi.SchemaSerializer=Hd;Pi.getStateCallbacks=jd;var Ea;try{Ea=new TextDecoder}catch{}var ie,an,x=0,Xe={},je,os,rn=0,xn=0,Ot,Zn,Bt=[],Ue,po={useRecords:!1,mapsAsObjects:!0};class tc{}const Za=new tc;Za.name="MessagePack 0xC1";var us=!1,nc=2,go;try{new Function("")}catch{nc=1/0}class ms{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(ie)return lc(()=>(Si(),this?this.unpack(e,t):ms.prototype.unpack.call(po,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof t=="object"?(an=t.end||e.length,x=t.start||0):(x=0,an=t>-1?t:e.length),xn=0,os=null,Ot=null,ie=e;try{Ue=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(s){throw ie=null,e instanceof Uint8Array?s:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof ms){if(Xe=this,this.structures)return je=this.structures,ai(t);(!je||je.length>0)&&(je=[])}else Xe=po,(!je||je.length>0)&&(je=[]);return ai(t)}unpackMultiple(e,t){let s,r=0;try{us=!0;let i=e.length,l=this?this.unpack(e,i):Li.unpack(e,i);if(t){if(t(l,r,x)===!1)return;for(;x<i;)if(r=x,t(ai(),r,x)===!1)return}else{for(s=[l];x<i;)r=x,s.push(ai());return s}}catch(i){throw i.lastPosition=r,i.values=s,i}finally{us=!1,Si()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(s=>s.slice(0)));for(let s=0,r=e.length;s<r;s++){let i=e[s];i&&(i.isShared=!0,s>=32&&(i.highByte=s-32>>5))}e.sharedLength=e.length;for(let s in t||[])if(s>=0){let r=e[s],i=t[s];i&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[s]=r),e[s]=i)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function ai(n){try{if(!Xe.trusted&&!us){let t=je.sharedLength||0;t<je.length&&(je.length=t)}let e;if(Xe.randomAccessStructure&&ie[x]<64&&ie[x]>=32&&go?(e=go(ie,x,an,Xe),ie=null,!(n&&n.lazy)&&e&&(e=e.toJSON()),x=an):e=ht(),Ot&&(x=Ot.postBundlePosition,Ot=null),us&&(je.restoreStructures=null),x==an)je&&je.restoreStructures&&mo(),je=null,ie=null,Zn&&(Zn=null);else{if(x>an)throw new Error("Unexpected end of MessagePack data");if(!us){let t;try{t=JSON.stringify(e,(s,r)=>typeof r=="bigint"?`${r}n`:r).slice(0,100)}catch(s){t="(JSON view not available "+s+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw je&&je.restoreStructures&&mo(),Si(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||x>an)&&(e.incomplete=!0),e}}function mo(){for(let n in je.restoreStructures)je[n]=je.restoreStructures[n];je.restoreStructures=null}function ht(){let n=ie[x++];if(n<160)if(n<128){if(n<64)return n;{let e=je[n&63]||Xe.getStructures&&sc()[n&63];return e?(e.read||(e.read=za(e,n&63)),e.read()):n}}else if(n<144)if(n-=128,Xe.mapsAsObjects){let e={};for(let t=0;t<n;t++){let s=ic();s==="__proto__"&&(s="__proto_"),e[s]=ht()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(ht(),ht());return e}else{n-=144;let e=new Array(n);for(let t=0;t<n;t++)e[t]=ht();return Xe.freezeData?Object.freeze(e):e}else if(n<192){let e=n-160;if(xn>=x)return os.slice(x-rn,(x+=e)-rn);if(xn==0&&an<140){let t=e<16?Wa(e):rc(e);if(t!=null)return t}return Ta(e)}else{let e;switch(n){case 192:return null;case 193:return Ot?(e=ht(),e>0?Ot[1].slice(Ot.position1,Ot.position1+=e):Ot[0].slice(Ot.position0,Ot.position0-=e)):Za;case 194:return!1;case 195:return!0;case 196:if(e=ie[x++],e===void 0)throw new Error("Unexpected end of buffer");return na(e);case 197:return e=Ue.getUint16(x),x+=2,na(e);case 198:return e=Ue.getUint32(x),x+=4,na(e);case 199:return Ps(ie[x++]);case 200:return e=Ue.getUint16(x),x+=2,Ps(e);case 201:return e=Ue.getUint32(x),x+=4,Ps(e);case 202:if(e=Ue.getFloat32(x),Xe.useFloat32>2){let t=ki[(ie[x]&127)<<1|ie[x+1]>>7];return x+=4,(t*e+(e>0?.5:-.5)>>0)/t}return x+=4,e;case 203:return e=Ue.getFloat64(x),x+=8,e;case 204:return ie[x++];case 205:return e=Ue.getUint16(x),x+=2,e;case 206:return e=Ue.getUint32(x),x+=4,e;case 207:return Xe.int64AsType==="number"?(e=Ue.getUint32(x)*4294967296,e+=Ue.getUint32(x+4)):Xe.int64AsType==="string"?e=Ue.getBigUint64(x).toString():Xe.int64AsType==="auto"?(e=Ue.getBigUint64(x),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Ue.getBigUint64(x),x+=8,e;case 208:return Ue.getInt8(x++);case 209:return e=Ue.getInt16(x),x+=2,e;case 210:return e=Ue.getInt32(x),x+=4,e;case 211:return Xe.int64AsType==="number"?(e=Ue.getInt32(x)*4294967296,e+=Ue.getUint32(x+4)):Xe.int64AsType==="string"?e=Ue.getBigInt64(x).toString():Xe.int64AsType==="auto"?(e=Ue.getBigInt64(x),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Ue.getBigInt64(x),x+=8,e;case 212:if(e=ie[x++],e==114)return Eo(ie[x++]&63);{let t=Bt[e];if(t)return t.read?(x++,t.read(ht())):t.noBuffer?(x++,t()):t(ie.subarray(x,++x));throw new Error("Unknown extension "+e)}case 213:return e=ie[x],e==114?(x++,Eo(ie[x++]&63,ie[x++])):Ps(2);case 214:return Ps(4);case 215:return Ps(8);case 216:return Ps(16);case 217:return e=ie[x++],xn>=x?os.slice(x-rn,(x+=e)-rn):Zd(e);case 218:return e=Ue.getUint16(x),x+=2,xn>=x?os.slice(x-rn,(x+=e)-rn):zd(e);case 219:return e=Ue.getUint32(x),x+=4,xn>=x?os.slice(x-rn,(x+=e)-rn):Wd(e);case 220:return e=Ue.getUint16(x),x+=2,vo(e);case 221:return e=Ue.getUint32(x),x+=4,vo(e);case 222:return e=Ue.getUint16(x),x+=2,bo(e);case 223:return e=Ue.getUint32(x),x+=4,bo(e);default:if(n>=224)return n-256;if(n===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+n)}}}const Gd=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function za(n,e){function t(){if(t.count++>nc){let r=n.read=new Function("r","return function(){return "+(Xe.freezeData?"Object.freeze":"")+"({"+n.map(i=>i==="__proto__"?"__proto_:r()":Gd.test(i)?i+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"})}")(ht);return n.highByte===0&&(n.read=yo(e,n.read)),r()}let s={};for(let r=0,i=n.length;r<i;r++){let l=n[r];l==="__proto__"&&(l="__proto_"),s[l]=ht()}return Xe.freezeData?Object.freeze(s):s}return t.count=0,n.highByte===0?yo(e,t):t}const yo=(n,e)=>function(){let t=ie[x++];if(t===0)return e();let s=n<32?-(n+(t<<5)):n+(t<<5),r=je[s]||sc()[s];if(!r)throw new Error("Record id is not defined for "+s);return r.read||(r.read=za(r,n)),r.read()};function sc(){let n=lc(()=>(ie=null,Xe.getStructures()));return je=Xe._mergeStructures(n,je)}var Ta=Lr,Zd=Lr,zd=Lr,Wd=Lr;let Kd=!1;function Lr(n){let e;if(n<16&&(e=Wa(n)))return e;if(n>64&&Ea)return Ea.decode(ie.subarray(x,x+=n));const t=x+n,s=[];for(e="";x<t;){const r=ie[x++];if(!(r&128))s.push(r);else if((r&224)===192){const i=ie[x++]&63;s.push((r&31)<<6|i)}else if((r&240)===224){const i=ie[x++]&63,l=ie[x++]&63;s.push((r&31)<<12|i<<6|l)}else if((r&248)===240){const i=ie[x++]&63,l=ie[x++]&63,c=ie[x++]&63;let g=(r&7)<<18|i<<12|l<<6|c;g>65535&&(g-=65536,s.push(g>>>10&1023|55296),g=56320|g&1023),s.push(g)}else s.push(r);s.length>=4096&&(e+=It.apply(String,s),s.length=0)}return s.length>0&&(e+=It.apply(String,s)),e}function vo(n){let e=new Array(n);for(let t=0;t<n;t++)e[t]=ht();return Xe.freezeData?Object.freeze(e):e}function bo(n){if(Xe.mapsAsObjects){let e={};for(let t=0;t<n;t++){let s=ic();s==="__proto__"&&(s="__proto_"),e[s]=ht()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(ht(),ht());return e}}var It=String.fromCharCode;function rc(n){let e=x,t=new Array(n);for(let s=0;s<n;s++){const r=ie[x++];if((r&128)>0){x=e;return}t[s]=r}return It.apply(String,t)}function Wa(n){if(n<4)if(n<2){if(n===0)return"";{let e=ie[x++];if((e&128)>1){x-=1;return}return It(e)}}else{let e=ie[x++],t=ie[x++];if((e&128)>0||(t&128)>0){x-=2;return}if(n<3)return It(e,t);let s=ie[x++];if((s&128)>0){x-=3;return}return It(e,t,s)}else{let e=ie[x++],t=ie[x++],s=ie[x++],r=ie[x++];if((e&128)>0||(t&128)>0||(s&128)>0||(r&128)>0){x-=4;return}if(n<6){if(n===4)return It(e,t,s,r);{let i=ie[x++];if((i&128)>0){x-=5;return}return It(e,t,s,r,i)}}else if(n<8){let i=ie[x++],l=ie[x++];if((i&128)>0||(l&128)>0){x-=6;return}if(n<7)return It(e,t,s,r,i,l);let c=ie[x++];if((c&128)>0){x-=7;return}return It(e,t,s,r,i,l,c)}else{let i=ie[x++],l=ie[x++],c=ie[x++],g=ie[x++];if((i&128)>0||(l&128)>0||(c&128)>0||(g&128)>0){x-=8;return}if(n<10){if(n===8)return It(e,t,s,r,i,l,c,g);{let f=ie[x++];if((f&128)>0){x-=9;return}return It(e,t,s,r,i,l,c,g,f)}}else if(n<12){let f=ie[x++],h=ie[x++];if((f&128)>0||(h&128)>0){x-=10;return}if(n<11)return It(e,t,s,r,i,l,c,g,f,h);let p=ie[x++];if((p&128)>0){x-=11;return}return It(e,t,s,r,i,l,c,g,f,h,p)}else{let f=ie[x++],h=ie[x++],p=ie[x++],T=ie[x++];if((f&128)>0||(h&128)>0||(p&128)>0||(T&128)>0){x-=12;return}if(n<14){if(n===12)return It(e,t,s,r,i,l,c,g,f,h,p,T);{let C=ie[x++];if((C&128)>0){x-=13;return}return It(e,t,s,r,i,l,c,g,f,h,p,T,C)}}else{let C=ie[x++],Z=ie[x++];if((C&128)>0||(Z&128)>0){x-=14;return}if(n<15)return It(e,t,s,r,i,l,c,g,f,h,p,T,C,Z);let V=ie[x++];if((V&128)>0){x-=15;return}return It(e,t,s,r,i,l,c,g,f,h,p,T,C,Z,V)}}}}}function _o(){let n=ie[x++],e;if(n<192)e=n-160;else switch(n){case 217:e=ie[x++];break;case 218:e=Ue.getUint16(x),x+=2;break;case 219:e=Ue.getUint32(x),x+=4;break;default:throw new Error("Expected string")}return Lr(e)}function na(n){return Xe.copyBuffers?Uint8Array.prototype.slice.call(ie,x,x+=n):ie.subarray(x,x+=n)}function Ps(n){let e=ie[x++];if(Bt[e]){let t;return Bt[e](ie.subarray(x,t=x+=n),s=>{x=s;try{return ht()}finally{x=t}})}else throw new Error("Unknown extension type "+e)}var wo=new Array(4096);function ic(){let n=ie[x++];if(n>=160&&n<192){if(n=n-160,xn>=x)return os.slice(x-rn,(x+=n)-rn);if(!(xn==0&&an<180))return Ta(n)}else return x--,ac(ht());let e=(n<<5^(n>1?Ue.getUint16(x):n>0?ie[x]:0))&4095,t=wo[e],s=x,r=x+n-3,i,l=0;if(t&&t.bytes==n){for(;s<r;){if(i=Ue.getUint32(s),i!=t[l++]){s=1879048192;break}s+=4}for(r+=3;s<r;)if(i=ie[s++],i!=t[l++]){s=1879048192;break}if(s===r)return x=s,t.string;r-=3,s=x}for(t=[],wo[e]=t,t.bytes=n;s<r;)i=Ue.getUint32(s),t.push(i),s+=4;for(r+=3;s<r;)i=ie[s++],t.push(i);let c=n<16?Wa(n):rc(n);return c!=null?t.string=c:t.string=Ta(n)}function ac(n){if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";if(Xe.allowArraysInMapKeys&&Array.isArray(n)&&n.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return n.flat().toString();throw new Error(`Invalid property type for record: ${typeof n}`)}const Eo=(n,e)=>{let t=ht().map(ac),s=n;e!==void 0&&(n=n<32?-((e<<5)+n):(e<<5)+n,t.highByte=e);let r=je[n];return r&&(r.isShared||us)&&((je.restoreStructures||(je.restoreStructures=[]))[n]=r),je[n]=t,t.read=za(t,s),t.read()};Bt[0]=()=>{};Bt[0].noBuffer=!0;Bt[66]=n=>{let e=n.length,t=BigInt(n[0]&128?n[0]-256:n[0]);for(let s=1;s<e;s++)t<<=BigInt(8),t+=BigInt(n[s]);return t};let qd={Error,TypeError,ReferenceError};Bt[101]=()=>{let n=ht();return(qd[n[0]]||Error)(n[1],{cause:n[2]})};Bt[105]=n=>{if(Xe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Ue.getUint32(x-4);Zn||(Zn=new Map);let t=ie[x],s;t>=144&&t<160||t==220||t==221?s=[]:s={};let r={target:s};Zn.set(e,r);let i=ht();return r.used?Object.assign(s,i):(r.target=i,i)};Bt[112]=n=>{if(Xe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Ue.getUint32(x-4),t=Zn.get(e);return t.used=!0,t.target};Bt[115]=()=>new Set(ht());const oc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(n=>n+"Array");let Yd=typeof globalThis=="object"?globalThis:window;Bt[116]=n=>{let e=n[0],t=oc[e];if(!t){if(e===16){let s=new ArrayBuffer(n.length-1);return new Uint8Array(s).set(n.subarray(1)),s}throw new Error("Could not find typed array for code "+e)}return new Yd[t](Uint8Array.prototype.slice.call(n,1).buffer)};Bt[120]=()=>{let n=ht();return new RegExp(n[0],n[1])};const Xd=[];Bt[98]=n=>{let e=(n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3],t=x;return x+=e-n.length,Ot=Xd,Ot=[_o(),_o()],Ot.position0=0,Ot.position1=0,Ot.postBundlePosition=x,x=t,ht()};Bt[255]=n=>n.length==4?new Date((n[0]*16777216+(n[1]<<16)+(n[2]<<8)+n[3])*1e3):n.length==8?new Date(((n[0]<<22)+(n[1]<<14)+(n[2]<<6)+(n[3]>>2))/1e6+((n[3]&3)*4294967296+n[4]*16777216+(n[5]<<16)+(n[6]<<8)+n[7])*1e3):n.length==12?new Date(((n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3])/1e6+((n[4]&128?-281474976710656:0)+n[6]*1099511627776+n[7]*4294967296+n[8]*16777216+(n[9]<<16)+(n[10]<<8)+n[11])*1e3):new Date("invalid");function lc(n){let e=an,t=x,s=rn,r=xn,i=os,l=Zn,c=Ot,g=new Uint8Array(ie.slice(0,an)),f=je,h=je.slice(0,je.length),p=Xe,T=us,C=n();return an=e,x=t,rn=s,xn=r,os=i,Zn=l,Ot=c,ie=g,us=T,je=f,je.splice(0,je.length,...h),Xe=p,Ue=new DataView(ie.buffer,ie.byteOffset,ie.byteLength),C}function Si(){ie=null,Zn=null,je=null}function Jd(n){n.unpack?Bt[n.type]=n.unpack:Bt[n.type]=n}const ki=new Array(147);for(let n=0;n<256;n++)ki[n]=+("1e"+Math.floor(45.15-n*.30103));const Qd=ms;var Li=new ms({useRecords:!1});const eh=Li.unpack,th=Li.unpackMultiple,nh=Li.unpack,uc={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let fc=new Float32Array(1),To=new Uint8Array(fc.buffer,0,4);function sh(n){fc[0]=n;let e=ki[(To[3]&127)<<1|To[2]>>7];return(e*n+(n>0?.5:-.5)>>0)/e}let ui;try{ui=new TextEncoder}catch{}let Ii,Ka;const Bi=typeof Buffer<"u",oi=Bi?function(n){return Buffer.allocUnsafeSlow(n)}:Uint8Array,dc=Bi?Buffer:Uint8Array,So=Bi?4294967296:2144337920;let B,fr,et,N=0,Mt,ot=null,rh;const ih=21760,ah=/[\u0080-\uFFFF]/,Ys=Symbol("record-id");class Br extends ms{constructor(e){super(e),this.offset=0;let t,s,r,i,l=dc.prototype.utf8Write?function(k,ee){return B.utf8Write(k,ee,B.byteLength-ee)}:ui&&ui.encodeInto?function(k,ee){return ui.encodeInto(k,B.subarray(ee)).written}:!1,c=this;e||(e={});let g=e&&e.sequential,f=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=f?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let p=e.maxOwnStructures;p==null&&(p=f?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let T=h>32||p+h>64,C=h+64,Z=h+p+64;if(Z>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let V=[],j=0,me=0;this.pack=this.encode=function(k,ee){if(B||(B=new oi(8192),et=B.dataView||(B.dataView=new DataView(B.buffer,0,8192)),N=0),Mt=B.length-10,Mt-N<2048?(B=new oi(B.length),et=B.dataView||(B.dataView=new DataView(B.buffer,0,B.length)),Mt=B.length-10,N=0):N=N+7&2147483640,t=N,ee&mc&&(N+=ee&255),i=c.structuredClone?new Map:null,c.bundleStrings&&typeof k!="string"?(ot=[],ot.size=1/0):ot=null,r=c.structures,r){r.uninitialized&&(r=c._mergeStructures(c.getStructures()));let q=r.sharedLength||0;if(q>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+r.sharedLength);if(!r.transitions){r.transitions=Object.create(null);for(let Q=0;Q<q;Q++){let pe=r[Q];if(!pe)continue;let Oe,we=r.transitions;for(let Ve=0,Me=pe.length;Ve<Me;Ve++){let rt=pe[Ve];Oe=we[rt],Oe||(Oe=we[rt]=Object.create(null)),we=Oe}we[Ys]=Q+64}this.lastNamedStructuresLength=q}g||(r.nextId=q+64)}s&&(s=!1);let J;try{c.randomAccessStructure&&k&&k.constructor&&k.constructor===Object?$e(k):Ae(k);let q=ot;if(ot&&Oo(t,Ae,0),i&&i.idsToInsert){let Q=i.idsToInsert.sort((Ve,Me)=>Ve.offset>Me.offset?1:-1),pe=Q.length,Oe=-1;for(;q&&pe>0;){let Ve=Q[--pe].offset+t;Ve<q.stringsPosition+t&&Oe===-1&&(Oe=0),Ve>q.position+t?Oe>=0&&(Oe+=6):(Oe>=0&&(et.setUint32(q.position+t,et.getUint32(q.position+t)+Oe),Oe=-1),q=q.previous,pe++)}Oe>=0&&q&&et.setUint32(q.position+t,et.getUint32(q.position+t)+Oe),N+=Q.length*6,N>Mt&&st(N),c.offset=N;let we=lh(B.subarray(t,N),Q);return i=null,we}return c.offset=N,ee&pc?(B.start=t,B.end=N,B):B.subarray(t,N)}catch(q){throw J=q,q}finally{if(r&&(ne(),s&&c.saveStructures)){let q=r.sharedLength||0,Q=B.subarray(t,N),pe=uh(r,c);if(!J)return c.saveStructures(pe,pe.isCompatible)===!1?c.pack(k,ee):(c.lastNamedStructuresLength=q,B.length>1073741824&&(B=null),Q)}B.length>1073741824&&(B=null),ee&gc&&(N=t)}};const ne=()=>{me<10&&me++;let k=r.sharedLength||0;if(r.length>k&&!g&&(r.length=k),j>1e4)r.transitions=null,me=0,j=0,V.length>0&&(V=[]);else if(V.length>0&&!g){for(let ee=0,J=V.length;ee<J;ee++)V[ee][Ys]=0;V=[]}},de=k=>{var ee=k.length;ee<16?B[N++]=144|ee:ee<65536?(B[N++]=220,B[N++]=ee>>8,B[N++]=ee&255):(B[N++]=221,et.setUint32(N,ee),N+=4);for(let J=0;J<ee;J++)Ae(k[J])},Ae=k=>{N>Mt&&(B=st(N));var ee=typeof k,J;if(ee==="string"){let q=k.length;if(ot&&q>=4&&q<4096){if((ot.size+=q)>ih){let we,Ve=(ot[0]?ot[0].length*3+ot[1].length:0)+10;N+Ve>Mt&&(B=st(N+Ve));let Me;ot.position?(Me=ot,B[N]=200,N+=3,B[N++]=98,we=N-t,N+=4,Oo(t,Ae,0),et.setUint16(we+t-3,N-t-we)):(B[N++]=214,B[N++]=98,we=N-t,N+=4),ot=["",""],ot.previous=Me,ot.size=0,ot.position=we}let Oe=ah.test(k);ot[Oe?0:1]+=k,B[N++]=193,Ae(Oe?-q:q);return}let Q;q<32?Q=1:q<256?Q=2:q<65536?Q=3:Q=5;let pe=q*3;if(N+pe>Mt&&(B=st(N+pe)),q<64||!l){let Oe,we,Ve,Me=N+Q;for(Oe=0;Oe<q;Oe++)we=k.charCodeAt(Oe),we<128?B[Me++]=we:we<2048?(B[Me++]=we>>6|192,B[Me++]=we&63|128):(we&64512)===55296&&((Ve=k.charCodeAt(Oe+1))&64512)===56320?(we=65536+((we&1023)<<10)+(Ve&1023),Oe++,B[Me++]=we>>18|240,B[Me++]=we>>12&63|128,B[Me++]=we>>6&63|128,B[Me++]=we&63|128):(B[Me++]=we>>12|224,B[Me++]=we>>6&63|128,B[Me++]=we&63|128);J=Me-N-Q}else J=l(k,N+Q);J<32?B[N++]=160|J:J<256?(Q<2&&B.copyWithin(N+2,N+1,N+1+J),B[N++]=217,B[N++]=J):J<65536?(Q<3&&B.copyWithin(N+3,N+2,N+2+J),B[N++]=218,B[N++]=J>>8,B[N++]=J&255):(Q<5&&B.copyWithin(N+5,N+3,N+3+J),B[N++]=219,et.setUint32(N,J),N+=4),N+=J}else if(ee==="number")if(k>>>0===k)k<32||k<128&&this.useRecords===!1||k<64&&!this.randomAccessStructure?B[N++]=k:k<256?(B[N++]=204,B[N++]=k):k<65536?(B[N++]=205,B[N++]=k>>8,B[N++]=k&255):(B[N++]=206,et.setUint32(N,k),N+=4);else if(k>>0===k)k>=-32?B[N++]=256+k:k>=-128?(B[N++]=208,B[N++]=k+256):k>=-32768?(B[N++]=209,et.setInt16(N,k),N+=2):(B[N++]=210,et.setInt32(N,k),N+=4);else{let q;if((q=this.useFloat32)>0&&k<4294967296&&k>=-2147483648){B[N++]=202,et.setFloat32(N,k);let Q;if(q<4||(Q=k*ki[(B[N]&127)<<1|B[N+1]>>7])>>0===Q){N+=4;return}else N--}B[N++]=203,et.setFloat64(N,k),N+=8}else if(ee==="object"||ee==="function")if(!k)B[N++]=192;else{if(i){let Q=i.get(k);if(Q){if(!Q.id){let pe=i.idsToInsert||(i.idsToInsert=[]);Q.id=pe.push(Q)}B[N++]=214,B[N++]=112,et.setUint32(N,Q.id),N+=4;return}else i.set(k,{offset:N-t})}let q=k.constructor;if(q===Object)ct(k);else if(q===Array)de(k);else if(q===Map)if(this.mapAsEmptyObject)B[N++]=128;else{J=k.size,J<16?B[N++]=128|J:J<65536?(B[N++]=222,B[N++]=J>>8,B[N++]=J&255):(B[N++]=223,et.setUint32(N,J),N+=4);for(let[Q,pe]of k)Ae(Q),Ae(pe)}else{for(let Q=0,pe=Ii.length;Q<pe;Q++){let Oe=Ka[Q];if(k instanceof Oe){let we=Ii[Q];if(we.write){we.type&&(B[N++]=212,B[N++]=we.type,B[N++]=0);let xt=we.write.call(this,k);xt===k?Array.isArray(k)?de(k):ct(k):Ae(xt);return}let Ve=B,Me=et,rt=N;B=null;let yt;try{yt=we.pack.call(this,k,xt=>(B=Ve,Ve=null,N+=xt,N>Mt&&st(N),{target:B,targetView:et,position:N-xt}),Ae)}finally{Ve&&(B=Ve,et=Me,N=rt,Mt=B.length-10)}yt&&(yt.length+N>Mt&&st(yt.length+N),N=oh(yt,B,N,we.type));return}}if(Array.isArray(k))de(k);else{if(k.toJSON){const Q=k.toJSON();if(Q!==k)return Ae(Q)}if(ee==="function")return Ae(this.writeFunction&&this.writeFunction(k));ct(k)}}}else if(ee==="boolean")B[N++]=k?195:194;else if(ee==="bigint"){if(k<BigInt(1)<<BigInt(63)&&k>=-(BigInt(1)<<BigInt(63)))B[N++]=211,et.setBigInt64(N,k);else if(k<BigInt(1)<<BigInt(64)&&k>0)B[N++]=207,et.setBigUint64(N,k);else if(this.largeBigIntToFloat)B[N++]=203,et.setFloat64(N,Number(k));else{if(this.largeBigIntToString)return Ae(k.toString());if(this.useBigIntExtension&&k<BigInt(2)**BigInt(1023)&&k>-(BigInt(2)**BigInt(1023))){B[N++]=199,N++,B[N++]=66;let q=[],Q;do{let pe=k&BigInt(255);Q=(pe&BigInt(128))===(k<BigInt(0)?BigInt(128):BigInt(0)),q.push(pe),k>>=BigInt(8)}while(!((k===BigInt(0)||k===BigInt(-1))&&Q));B[N-2]=q.length;for(let pe=q.length;pe>0;)B[N++]=Number(q[--pe]);return}else throw new RangeError(k+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}N+=8}else if(ee==="undefined")this.encodeUndefinedAsNil?B[N++]=192:(B[N++]=212,B[N++]=0,B[N++]=0);else throw new Error("Unknown type: "+ee)},Ke=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?k=>{let ee;if(this.skipValues){ee=[];for(let Q in k)(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(Q))&&!this.skipValues.includes(k[Q])&&ee.push(Q)}else ee=Object.keys(k);let J=ee.length;J<16?B[N++]=128|J:J<65536?(B[N++]=222,B[N++]=J>>8,B[N++]=J&255):(B[N++]=223,et.setUint32(N,J),N+=4);let q;if(this.coercibleKeyAsNumber)for(let Q=0;Q<J;Q++){q=ee[Q];let pe=Number(q);Ae(isNaN(pe)?q:pe),Ae(k[q])}else for(let Q=0;Q<J;Q++)Ae(q=ee[Q]),Ae(k[q])}:k=>{B[N++]=222;let ee=N-t;N+=2;let J=0;for(let q in k)(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(q))&&(Ae(q),Ae(k[q]),J++);if(J>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');B[ee+++t]=J>>8,B[ee+t]=J&255},tt=this.useRecords===!1?Ke:e.progressiveRecords&&!T?k=>{let ee,J=r.transitions||(r.transitions=Object.create(null)),q=N++-t,Q;for(let pe in k)if(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(pe)){if(ee=J[pe],ee)J=ee;else{let Oe=Object.keys(k),we=J;J=r.transitions;let Ve=0;for(let Me=0,rt=Oe.length;Me<rt;Me++){let yt=Oe[Me];ee=J[yt],ee||(ee=J[yt]=Object.create(null),Ve++),J=ee}q+t+1==N?(N--,Ye(J,Oe,Ve)):Qe(J,Oe,q,Ve),Q=!0,J=we[pe]}Ae(k[pe])}if(!Q){let pe=J[Ys];pe?B[q+t]=pe:Qe(J,Object.keys(k),q,0)}}:k=>{let ee,J=r.transitions||(r.transitions=Object.create(null)),q=0;for(let pe in k)(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(pe))&&(ee=J[pe],ee||(ee=J[pe]=Object.create(null),q++),J=ee);let Q=J[Ys];Q?Q>=96&&T?(B[N++]=((Q-=96)&31)+96,B[N++]=Q>>5):B[N++]=Q:Ye(J,J.__keys__||Object.keys(k),q);for(let pe in k)(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(pe))&&Ae(k[pe])},nt=typeof this.useRecords=="function"&&this.useRecords,ct=nt?k=>{nt(k)?tt(k):Ke(k)}:tt,st=k=>{let ee;if(k>16777216){if(k-t>So)throw new Error("Packed buffer would be larger than maximum buffer size");ee=Math.min(So,Math.round(Math.max((k-t)*(k>67108864?1.25:2),4194304)/4096)*4096)}else ee=(Math.max(k-t<<2,B.length-1)>>12)+1<<12;let J=new oi(ee);return et=J.dataView||(J.dataView=new DataView(J.buffer,0,ee)),k=Math.min(k,B.length),B.copy?B.copy(J,0,t,k):J.set(B.slice(t,k)),N-=t,t=0,Mt=J.length-10,B=J},Ye=(k,ee,J)=>{let q=r.nextId;q||(q=64),q<C&&this.shouldShareStructure&&!this.shouldShareStructure(ee)?(q=r.nextOwnId,q<Z||(q=C),r.nextOwnId=q+1):(q>=Z&&(q=C),r.nextId=q+1);let Q=ee.highByte=q>=96&&T?q-96>>5:-1;k[Ys]=q,k.__keys__=ee,r[q-64]=ee,q<C?(ee.isShared=!0,r.sharedLength=q-63,s=!0,Q>=0?(B[N++]=(q&31)+96,B[N++]=Q):B[N++]=q):(Q>=0?(B[N++]=213,B[N++]=114,B[N++]=(q&31)+96,B[N++]=Q):(B[N++]=212,B[N++]=114,B[N++]=q),J&&(j+=me*J),V.length>=p&&(V.shift()[Ys]=0),V.push(k),Ae(ee))},Qe=(k,ee,J,q)=>{let Q=B,pe=N,Oe=Mt,we=t;B=fr,N=0,t=0,B||(fr=B=new oi(8192)),Mt=B.length-10,Ye(k,ee,q),fr=B;let Ve=N;if(B=Q,N=pe,Mt=Oe,t=we,Ve>1){let Me=N+Ve-1;Me>Mt&&st(Me);let rt=J+t;B.copyWithin(rt+Ve,rt+1,N),B.set(fr.slice(0,Ve),rt),N=Me}else B[J+t]=fr[0]},$e=k=>{let ee=rh(k,B,t,N,r,st,(J,q,Q)=>{if(Q)return s=!0;N=q;let pe=B;return Ae(J),ne(),pe!==B?{position:N,targetView:et,target:B}:N},this);if(ee===0)return ct(k);N=ee}}useBuffer(e){B=e,B.dataView||(B.dataView=new DataView(B.buffer,B.byteOffset,B.byteLength)),N=0}set position(e){N=e}get position(){return N}set buffer(e){B=e}get buffer(){return B}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Ka=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,tc];Ii=[{pack(n,e,t){let s=n.getTime()/1e3;if((this.useTimestamp32||n.getMilliseconds()===0)&&s>=0&&s<4294967296){let{target:r,targetView:i,position:l}=e(6);r[l++]=214,r[l++]=255,i.setUint32(l,s)}else if(s>0&&s<4294967296){let{target:r,targetView:i,position:l}=e(10);r[l++]=215,r[l++]=255,i.setUint32(l,n.getMilliseconds()*4e6+(s/1e3/4294967296>>0)),i.setUint32(l+4,s)}else if(isNaN(s)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:r,targetView:i,position:l}=e(3);r[l++]=212,r[l++]=255,r[l++]=255}else{let{target:r,targetView:i,position:l}=e(15);r[l++]=199,r[l++]=12,r[l++]=255,i.setUint32(l,n.getMilliseconds()*1e6),i.setBigInt64(l+4,BigInt(Math.floor(s)))}}},{pack(n,e,t){if(this.setAsEmptyObject)return e(0),t({});let s=Array.from(n),{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=115,r[i++]=0),t(s)}},{pack(n,e,t){let{target:s,position:r}=e(this.moreTypes?3:0);this.moreTypes&&(s[r++]=212,s[r++]=101,s[r++]=0),t([n.name,n.message,n.cause])}},{pack(n,e,t){let{target:s,position:r}=e(this.moreTypes?3:0);this.moreTypes&&(s[r++]=212,s[r++]=120,s[r++]=0),t([n.source,n.flags])}},{pack(n,e){this.moreTypes?Io(n,16,e):Ao(Bi?Buffer.from(n):new Uint8Array(n),e)}},{pack(n,e){let t=n.constructor;t!==dc&&this.moreTypes?Io(n,oc.indexOf(t.name),e):Ao(n,e)}},{pack(n,e){let{target:t,position:s}=e(1);t[s]=193}}];function Io(n,e,t,s){let r=n.byteLength;if(r+1<256){var{target:i,position:l}=t(4+r);i[l++]=199,i[l++]=r+1}else if(r+1<65536){var{target:i,position:l}=t(5+r);i[l++]=200,i[l++]=r+1>>8,i[l++]=r+1&255}else{var{target:i,position:l,targetView:c}=t(7+r);i[l++]=201,c.setUint32(l,r+1),l+=4}i[l++]=116,i[l++]=e,n.buffer||(n=new Uint8Array(n)),i.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),l)}function Ao(n,e){let t=n.byteLength;var s,r;if(t<256){var{target:s,position:r}=e(t+2);s[r++]=196,s[r++]=t}else if(t<65536){var{target:s,position:r}=e(t+3);s[r++]=197,s[r++]=t>>8,s[r++]=t&255}else{var{target:s,position:r,targetView:i}=e(t+5);s[r++]=198,i.setUint32(r,t),r+=4}s.set(n,r)}function oh(n,e,t,s){let r=n.length;switch(r){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:r<256?(e[t++]=199,e[t++]=r):r<65536?(e[t++]=200,e[t++]=r>>8,e[t++]=r&255):(e[t++]=201,e[t++]=r>>24,e[t++]=r>>16&255,e[t++]=r>>8&255,e[t++]=r&255)}return e[t++]=s,e.set(n,t),t+=r,t}function lh(n,e){let t,s=e.length*6,r=n.length-s;for(;t=e.pop();){let i=t.offset,l=t.id;n.copyWithin(i+s,i,r),s-=6;let c=i+s;n[c++]=214,n[c++]=105,n[c++]=l>>24,n[c++]=l>>16&255,n[c++]=l>>8&255,n[c++]=l&255,r=i}return n}function Oo(n,e,t){if(ot.length>0){et.setUint32(ot.position+n,N+t-ot.position-n),ot.stringsPosition=N-n;let s=ot;ot=null,e(s[0]),e(s[1])}}function ch(n){if(n.Class){if(!n.pack&&!n.write)throw new Error("Extension has no pack or write function");if(n.pack&&!n.type)throw new Error("Extension has no type (numeric code to identify the extension)");Ka.unshift(n.Class),Ii.unshift(n)}Jd(n)}function uh(n,e){return n.isCompatible=t=>{let s=!t||(e.lastNamedStructuresLength||0)===t.length;return s||e._mergeStructures(t),s},n}let hc=new Br({useRecords:!1});const fh=hc.pack,dh=hc.pack,hh=Br,{NEVER:ph,ALWAYS:gh,DECIMAL_ROUND:mh,DECIMAL_FIT:yh}=uc,pc=512,gc=1024,mc=2048;function vh(n,e={}){if(!n||typeof n!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof n[Symbol.iterator]=="function")return bh(n,e);if(typeof n.then=="function"||typeof n[Symbol.asyncIterator]=="function")return _h(n,e);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*bh(n,e){const t=new Br(e);for(const s of n)yield t.pack(s)}async function*_h(n,e){const t=new Br(e);for await(const s of n)yield t.pack(s)}function wh(n,e={}){if(!n||typeof n!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const t=new ms(e);let s;const r=i=>{let l;s&&(i=Buffer.concat([s,i]),s=void 0);try{l=t.unpackMultiple(i)}catch(c){if(c.incomplete)s=i.slice(c.lastPosition),l=c.values;else throw c}return l};if(typeof n[Symbol.iterator]=="function")return function*(){for(const l of n)yield*r(l)}();if(typeof n[Symbol.asyncIterator]=="function")return async function*(){for await(const l of n)yield*r(l)}()}const Eh=wh,Th=vh,Sh=!1,Ih=!0,Ah=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:gh,C1:Za,DECIMAL_FIT:yh,DECIMAL_ROUND:mh,Decoder:Qd,Encoder:hh,FLOAT32_OPTIONS:uc,NEVER:ph,Packr:Br,RESERVE_START_SPACE:mc,RESET_BUFFER_MODE:gc,REUSE_BUFFER_MODE:pc,Unpackr:ms,addExtension:ch,clearSource:Si,decode:nh,decodeIter:Eh,encode:dh,encodeIter:Th,isNativeAccelerationEnabled:Kd,mapsAsObjects:Ih,pack:fh,roundFloat32:sh,unpack:eh,unpackMultiple:th,useRecords:Sh},Symbol.toStringTag,{value:"Module"})),Oh=Ia(Ah);var xh=Yl,sn=ja,xo=Ri,Dh=Ha,li=Ga,Pt=Fa,Nh=Pi,Do=kr,No=Oh;let Rh=class yc{constructor(e,t){this.onStateChange=li.createSignal(),this.onError=li.createSignal(),this.onLeave=li.createSignal(),this.onJoin=li.createSignal(),this.hasJoined=!1,this.onMessageHandlers=Dh.createNanoEvents(),this.roomId=null,this.name=e,this.packr=new No.Packr,this.packr.encode(void 0),t&&(this.serializer=new(xo.getSerializer("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError((s,r)=>{var i;return(i=console.warn)===null||i===void 0?void 0:i.call(console,`colyseus.js - onError => (${s}) ${r}`)}),this.onLeave(()=>this.removeAllListeners())}connect(e,t,s=this,r,i){const l=new xh.Connection(r.protocol);if(s.connection=l,l.events.onmessage=yc.prototype.onMessageCallback.bind(s),l.events.onclose=function(c){var g;if(!s.hasJoined){(g=console.warn)===null||g===void 0||g.call(console,`Room connection was closed unexpectedly (${c.code}): ${c.reason}`),s.onError.invoke(c.code,c.reason);return}c.code===Do.CloseCode.DEVMODE_RESTART&&t?t():(s.onLeave.invoke(c.code,c.reason),s.destroy())},l.events.onerror=function(c){var g;(g=console.warn)===null||g===void 0||g.call(console,`Room, onError (${c.code}): ${c.reason}`),s.onError.invoke(c.code,c.reason)},r.protocol==="h3"){const c=new URL(e);l.connect(c.origin,r)}else l.connect(e,i)}leave(e=!0){return new Promise(t=>{this.onLeave(s=>t(s)),this.connection?e?(this.packr.buffer[0]=sn.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(Do.CloseCode.CONSENTED)})}onMessage(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)}send(e,t){const s={offset:1};this.packr.buffer[0]=sn.Protocol.ROOM_DATA,typeof e=="string"?Pt.encode.string(this.packr.buffer,e,s):Pt.encode.number(this.packr.buffer,e,s),this.packr.position=0;const r=t!==void 0?this.packr.pack(t,2048+s.offset):this.packr.buffer.subarray(0,s.offset);this.connection.send(r)}sendUnreliable(e,t){const s={offset:1};this.packr.buffer[0]=sn.Protocol.ROOM_DATA,typeof e=="string"?Pt.encode.string(this.packr.buffer,e,s):Pt.encode.number(this.packr.buffer,e,s),this.packr.position=0;const r=t!==void 0?this.packr.pack(t,2048+s.offset):this.packr.buffer.subarray(0,s.offset);this.connection.sendUnreliable(r)}sendBytes(e,t){const s={offset:1};if(this.packr.buffer[0]=sn.Protocol.ROOM_DATA_BYTES,typeof e=="string"?Pt.encode.string(this.packr.buffer,e,s):Pt.encode.number(this.packr.buffer,e,s),t.byteLength+s.offset>this.packr.buffer.byteLength){const r=new Uint8Array(s.offset+t.byteLength);r.set(this.packr.buffer),this.packr.useBuffer(r)}this.packr.buffer.set(t,s.offset),this.connection.send(this.packr.buffer.subarray(0,s.offset+t.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof Nh.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(e){const t=new Uint8Array(e.data),s={offset:1},r=t[0];if(r===sn.Protocol.JOIN_ROOM){const i=Pt.decode.utf8Read(t,s,t[s.offset++]);if(this.serializerId=Pt.decode.utf8Read(t,s,t[s.offset++]),!this.serializer){const l=xo.getSerializer(this.serializerId);this.serializer=new l}t.byteLength>s.offset&&this.serializer.handshake&&this.serializer.handshake(t,s),this.reconnectionToken=`${this.roomId}:${i}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=sn.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(r===sn.Protocol.ERROR){const i=Pt.decode.number(t,s),l=Pt.decode.string(t,s);this.onError.invoke(i,l)}else if(r===sn.Protocol.LEAVE_ROOM)this.leave();else if(r===sn.Protocol.ROOM_STATE)this.serializer.setState(t,s),this.onStateChange.invoke(this.serializer.getState());else if(r===sn.Protocol.ROOM_STATE_PATCH)this.serializer.patch(t,s),this.onStateChange.invoke(this.serializer.getState());else if(r===sn.Protocol.ROOM_DATA){const i=Pt.decode.stringCheck(t,s)?Pt.decode.string(t,s):Pt.decode.number(t,s),l=t.byteLength>s.offset?No.unpack(t,{start:s.offset}):void 0;this.dispatchMessage(i,l)}else if(r===sn.Protocol.ROOM_DATA_BYTES){const i=Pt.decode.stringCheck(t,s)?Pt.decode.string(t,s):Pt.decode.number(t,s);this.dispatchMessage(i,t.subarray(s.offset))}}dispatchMessage(e,t){var s;const r=this.getMessageHandlerKey(e);this.onMessageHandlers.events[r]?this.onMessageHandlers.emit(r,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):(s=console.warn)===null||s===void 0||s.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}};Va.Room=Rh;var vc={};function Ro(n,e){e.headers=n.headers||{},e.statusMessage=n.statusText,e.statusCode=n.status,e.data=n.response}function vn(n,e,t){return new Promise(function(s,r){t=t||{};var i=new XMLHttpRequest,l,c,g,f=t.body,h=t.headers||{};t.timeout&&(i.timeout=t.timeout),i.ontimeout=i.onerror=function(p){p.timeout=p.type=="timeout",r(p)},i.open(n,e.href||e),i.onload=function(){for(g=i.getAllResponseHeaders().trim().split(/[\r\n]+/),Ro(i,i);c=g.shift();)c=c.split(": "),i.headers[c.shift().toLowerCase()]=c.join(": ");if(c=i.headers["content-type"],c&&~c.indexOf("application/json"))try{i.data=JSON.parse(i.data,t.reviver)}catch(p){return Ro(i,p),r(p)}(i.status>=400?r:s)(i)},typeof FormData<"u"&&f instanceof FormData||f&&typeof f=="object"&&(h["content-type"]="application/json",f=JSON.stringify(f)),i.withCredentials=!!t.withCredentials;for(l in h)i.setRequestHeader(l,h[l]);i.send(f)})}var Ph=vn.bind(vn,"GET"),kh=vn.bind(vn,"POST"),Lh=vn.bind(vn,"PATCH"),Bh=vn.bind(vn,"DELETE"),Ch=vn.bind(vn,"PUT");const Mh=Object.freeze(Object.defineProperty({__proto__:null,del:Bh,get:Ph,patch:Lh,post:kh,put:Ch,send:vn},Symbol.toStringTag,{value:"Module"})),Uh=Ia(Mh);var $h=kr,Vh=Uh;function Fh(n){var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var s=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,s.get?s:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,Object.freeze(e)}var jh=Fh(Vh);let Hh=class{constructor(e,t={}){this.client=e,this.headers=t}get(e,t={}){return this.request("get",e,t)}post(e,t={}){return this.request("post",e,t)}del(e,t={}){return this.request("del",e,t)}put(e,t={}){return this.request("put",e,t)}request(e,t,s={}){return jh[e](this.client.getHttpEndpoint(t),this.getOptions(s)).catch(r=>{var i;const l=r.statusCode,c=((i=r.data)===null||i===void 0?void 0:i.error)||r.statusMessage||r.message;throw!l&&!c?r:new $h.ServerError(l,c)})}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}};vc.HTTP=Hh;var qa={},Ci={},Po=Ni;let ks;function Ya(){if(!ks)try{ks=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!ks&&typeof globalThis.indexedDB<"u"&&(ks=new Wh),ks||(ks={cache:{},setItem:function(n,e){this.cache[n]=e},getItem:function(n){this.cache[n]},removeItem:function(n){delete this.cache[n]}}),ks}function Gh(n,e){Ya().setItem(n,e)}function Zh(n){Ya().removeItem(n)}function zh(n,e){const t=Ya().getItem(n);typeof Promise>"u"||!(t instanceof Promise)?e(t):t.then(s=>e(s))}class Wh{constructor(){this.dbPromise=new Promise(e=>{const t=indexedDB.open("_colyseus_storage",1);t.onupgradeneeded=()=>t.result.createObjectStore("store"),t.onsuccess=()=>e(t.result)})}tx(e,t){return Po.__awaiter(this,void 0,void 0,function*(){const r=(yield this.dbPromise).transaction("store",e).objectStore("store");return t(r)})}setItem(e,t){return this.tx("readwrite",s=>s.put(t,e)).then()}getItem(e){return Po.__awaiter(this,void 0,void 0,function*(){const t=yield this.tx("readonly",s=>s.get(e));return new Promise(s=>{t.onsuccess=()=>s(t.result)})})}removeItem(e){return this.tx("readwrite",t=>t.delete(e)).then()}}Ci.getItem=zh;Ci.removeItem=Zh;Ci.setItem=Gh;var St=Ni,sa=Ci,Kh=Ha,fi,Sa,ss,di;let qh=class{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},fi.set(this,!1),Sa.set(this,void 0),ss.set(this,void 0),di.set(this,Kh.createNanoEvents()),sa.getItem(this.settings.key,t=>this.token=t)}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){const t=St.__classPrivateFieldGet(this,di,"f").on("change",e);return St.__classPrivateFieldGet(this,fi,"f")||St.__classPrivateFieldSet(this,Sa,new Promise((s,r)=>{this.getUserData().then(i=>{this.emitChange(Object.assign(Object.assign({},i),{token:this.token}))}).catch(i=>{this.emitChange({user:null,token:void 0})}).finally(()=>{s()})}),"f"),St.__classPrivateFieldSet(this,fi,!0,"f"),t}getUserData(){return St.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(e,t,s){return St.__awaiter(this,void 0,void 0,function*(){const r=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:t,options:s}})).data;return this.emitChange(r),r})}signInWithEmailAndPassword(e,t){return St.__awaiter(this,void 0,void 0,function*(){const s=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:t}})).data;return this.emitChange(s),s})}signInAnonymously(e){return St.__awaiter(this,void 0,void 0,function*(){const t=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(t),t})}sendPasswordResetEmail(e){return St.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data})}signInWithProvider(e){return St.__awaiter(this,arguments,void 0,function*(t,s={}){return new Promise((r,i)=>{const l=s.width||480,c=s.height||768,g=this.token?`?token=${this.token}`:"",f=`Login with ${t[0].toUpperCase()+t.substring(1)}`,h=this.http.client.getHttpEndpoint(`${s.prefix||`${this.settings.path}/provider`}/${t}${g}`),p=screen.width/2-l/2,T=screen.height/2-c/2;St.__classPrivateFieldSet(this,ss,window.open(h,f,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+l+", height="+c+", top="+T+", left="+p),"f");const C=V=>{V.data.user===void 0&&V.data.token===void 0||(clearInterval(Z),St.__classPrivateFieldGet(this,ss,"f").close(),St.__classPrivateFieldSet(this,ss,void 0,"f"),window.removeEventListener("message",C),V.data.error!==void 0?i(V.data.error):(r(V.data),this.emitChange(V.data)))},Z=setInterval(()=>{(!St.__classPrivateFieldGet(this,ss,"f")||St.__classPrivateFieldGet(this,ss,"f").closed)&&(St.__classPrivateFieldSet(this,ss,void 0,"f"),i("cancelled"),window.removeEventListener("message",C))},200);window.addEventListener("message",C)})})}signOut(){return St.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(e){e.token!==void 0&&(this.token=e.token,e.token===null?sa.removeItem(this.settings.key):sa.setItem(this.settings.key,e.token)),St.__classPrivateFieldGet(this,di,"f").emit("change",e)}};fi=new WeakMap,Sa=new WeakMap,ss=new WeakMap,di=new WeakMap;qa.Auth=qh;var bc={};function Yh(n){var e;const t=((e=window==null?void 0:window.location)===null||e===void 0?void 0:e.hostname)||"localhost",s=n.hostname.split("."),r=!n.hostname.includes("trycloudflare.com")&&!n.hostname.includes("discordsays.com")&&s.length>2?`/${s[0]}`:"";return n.pathname.startsWith("/.proxy")?`${n.protocol}//${t}${r}${n.pathname}${n.search}`:`${n.protocol}//${t}/.proxy/colyseus${r}${n.pathname}${n.search}`}bc.discordURLBuilder=Yh;var Vn=Ni,Xh=kr,Jh=Va,Qh=vc,ep=qa,tp=bc,ra;class Mi extends Error{constructor(e,t){super(e),this.code=t,this.name="MatchMakeError",Object.setPrototypeOf(this,Mi.prototype)}}const ko=typeof window<"u"&&typeof((ra=window==null?void 0:window.location)===null||ra===void 0?void 0:ra.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class _c{constructor(e=ko,t){var s,r;if(typeof e=="string"){const i=e.startsWith("/")?new URL(e,ko):new URL(e),l=i.protocol==="https:"||i.protocol==="wss:",c=Number(i.port||(l?443:80));this.settings={hostname:i.hostname,pathname:i.pathname,port:c,secure:l}}else e.port===void 0&&(e.port=e.secure?443:80),e.pathname===void 0&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new Qh.HTTP(this,(t==null?void 0:t.headers)||{}),this.auth=new ep.Auth(this.http),this.urlBuilder=t==null?void 0:t.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((r=(s=window==null?void 0:window.location)===null||s===void 0?void 0:s.hostname)===null||r===void 0)&&r.includes("discordsays.com"))&&(this.urlBuilder=tp.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e){return Vn.__awaiter(this,arguments,void 0,function*(t,s={},r){return yield this.createMatchMakeRequest("joinOrCreate",t,s,r)})}create(e){return Vn.__awaiter(this,arguments,void 0,function*(t,s={},r){return yield this.createMatchMakeRequest("create",t,s,r)})}join(e){return Vn.__awaiter(this,arguments,void 0,function*(t,s={},r){return yield this.createMatchMakeRequest("join",t,s,r)})}joinById(e){return Vn.__awaiter(this,arguments,void 0,function*(t,s={},r){return yield this.createMatchMakeRequest("joinById",t,s,r)})}reconnect(e,t){return Vn.__awaiter(this,void 0,void 0,function*(){if(typeof e=="string"&&typeof t=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[s,r]=e.split(":");if(!s||!r)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",s,{reconnectionToken:r},t)})}consumeSeatReservation(e,t,s){return Vn.__awaiter(this,void 0,void 0,function*(){const r=this.createRoom(e.room.name,t);r.roomId=e.room.roomId,r.sessionId=e.sessionId;const i={sessionId:r.sessionId};e.reconnectionToken&&(i.reconnectionToken=e.reconnectionToken);const l=s||r;return r.connect(this.buildEndpoint(e.room,i,e.protocol),e.devMode&&(()=>Vn.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${r.roomId}'...`);let c=0,g=8;const f=()=>Vn.__awaiter(this,void 0,void 0,function*(){c++;try{yield this.consumeSeatReservation(e,t,l),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${r.roomId}'`)}catch{c<g?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${c} out of ${g})`),setTimeout(f,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(f,2e3)})),l,e,this.http.headers),new Promise((c,g)=>{const f=(h,p)=>g(new Xh.ServerError(h,p));l.onError.once(f),l.onJoin.once(()=>{l.onError.remove(f),c(l)})})})}createMatchMakeRequest(e,t){return Vn.__awaiter(this,arguments,void 0,function*(s,r,i={},l,c){const g=(yield this.http.post(`matchmake/${s}/${r}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).data;if(g.error)throw new Mi(g.error,g.code);return s==="reconnect"&&(g.reconnectionToken=i.reconnectionToken),yield this.consumeSeatReservation(g,l,c)})}createRoom(e,t){return new Jh.Room(e,t)}buildEndpoint(e,t={},s="ws"){const r=[];this.http.authToken&&(t._authToken=this.http.authToken);for(const c in t)t.hasOwnProperty(c)&&r.push(`${c}=${t[c]}`);s==="h3"&&(s="http");let i=this.settings.secure?`${s}s://`:`${s}://`;e.publicAddress?i+=`${e.publicAddress}`:i+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const l=`${i}/${e.processId}/${e.roomId}?${r.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(l)):l}getHttpEndpoint(e=""){const t=e.startsWith("/")?e:`/${e}`,s=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${t}`;return this.urlBuilder?this.urlBuilder(new URL(s)):s}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}_c.VERSION="0.16.16";Ua.Client=_c;Ua.MatchMakeError=Mi;var wc={};class np{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}}wc.NoneSerializer=np;(function(n){var e=Ua,t=ja,s=Va,r=qa,i=kr,l=Pi,c=wc,g=Ri;g.registerSerializer("schema",l.SchemaSerializer),g.registerSerializer("none",c.NoneSerializer),n.Client=e.Client,n.MatchMakeError=e.MatchMakeError,Object.defineProperty(n,"ErrorCode",{enumerable:!0,get:function(){return t.ErrorCode}}),Object.defineProperty(n,"Protocol",{enumerable:!0,get:function(){return t.Protocol}}),n.Room=s.Room,n.Auth=r.Auth,n.ServerError=i.ServerError,n.SchemaSerializer=l.SchemaSerializer,n.getStateCallbacks=l.getStateCallbacks,n.registerSerializer=g.registerSerializer})(mn);let w=null,Lo=null,ls=new Map;async function Xa(){return w?new Promise(n=>{const e=setTimeout(()=>{console.error("loadAllCardData: Timeout while waiting for card data"),n(!1)},5e3);w.send("getAllCards"),w.onMessage("allCards",t=>{clearTimeout(e),console.log(`Received ${t.length} cards from server`),ls.clear(),t.forEach(s=>{ls.set(s.id,s)}),n(!0)})}):!1}async function Ec(n,e){const t=location.host.includes("localhost")?"ws://localhost:4001":`wss://${location.host}/.proxy/api`;Lo=new mn.Client(t);try{console.log("Attempting to join or create Colyseus room..."),w=await Lo.joinOrCreate("game",{accessToken:n,username:e}),console.log("Successfully joined room:",w.roomId),console.log("Session ID:",w.sessionId),console.log("Initial room state:",w.state.toJSON()),console.log("Loading all card data..."),await Xa(),console.log("Card data loaded, cache size:",ls.size),w.onStateChange(s=>{}),w.onError((s,r)=>{console.error("Colyseus room error:",s,r),w=null}),w.onLeave(s=>{console.log("Left Colyseus room, code:",s),w=null})}catch(s){throw console.error("Failed to connect to Colyseus:",s),s instanceof ProgressEvent?(console.error("Connection failed: Network error (ProgressEvent). Potential causes:"),console.error("- Colyseus server might not be running or accessible at the target URL:",t),console.error("- WebSocket connection blocked by firewall or proxy."),console.error("- Incorrect WebSocket proxy configuration on the deployment server (if applicable)."),alert("Failed to connect to game server: Network Error. Please ensure the server is running and accessible.")):s instanceof Error?(console.error("Connection failed due to error:",s.message),alert(`Failed to connect to game server: ${s.message}`)):(console.error("Connection failed due to unknown error:",s),alert("Failed to connect to game server: An unknown error occurred.")),w=null,s}}let Ut;const Tc=new URLSearchParams(window.location.search),Ja=Tc.get("frame_id")!=null;let cs;const ia=Ui("user_id"),sp=Ui("guild_id"),rp=Ui("channel_id"),ip=async()=>{if(Ja){const n="1363939642289946886";console.log("Discord SDK: Using embedded client ID:",n),cs=new md(n),await cs.ready()}else{cs=new Ol("1363939642289946886",sp,rp);const n=String(ia.charCodeAt(0)%5),e={access_token:"mock_token",user:{username:ia,discriminator:n,id:ia,avatar:null,public_flags:1},scopes:[],expires:new Date(2112,1,1).toString(),application:{description:"mock_app_description",icon:"mock_app_icon",id:"mock_app_id",name:"mock_app_name"}};cs._updateCommandMocks({authenticate:async()=>(Ut=e,console.log("Mock Authentication successful:",Ut),await Ec(Ut.access_token,Ut.user.username),e),authorize:async()=>(console.log("Mock Authorize called"),{code:"mock_code"})})}},ap=async()=>{if(!Ja){console.log("Running locally, attempting mock authentication...");try{return await cs.commands.authenticate(),!0}catch(e){return console.error("Mock authentication failed:",e),!1}}let n="authorize";try{console.log("Requesting Discord authorization...");const{code:e}=await cs.commands.authorize({client_id:"1363939642289946886",response_type:"code",state:"",prompt:"none",scope:["identify","guilds"]});console.log("Authorization code received:",e),n="fetchToken",console.log("Fetching access token from /.proxy/api/token...");const t=await fetch("/.proxy/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(console.log("Token fetch response received. Status:",t.status),!t.ok){const r=await t.text();throw console.error("Token fetch failed:",t.status,t.statusText,r),new Error(`Token fetch failed: ${t.status} ${t.statusText} - ${r}`)}const{access_token:s}=await t.json();if(console.log("Access token received successfully."),n="discordAuthenticate",console.log("Authenticating with Discord SDK..."),Ut=await cs.commands.authenticate({access_token:s}),!(Ut!=null&&Ut.user))throw console.error("Discord SDK Authentication failed: No user data received.",Ut),new Error("Discord SDK Authentication failed to return user data.");console.log("Discord SDK Authentication successful:",Ut.user.username),n="connectColyseus",console.log("Connecting to Colyseus...");try{await Ec(Ut.access_token,Ut.user.username),console.log("Colyseus connection successful.")}catch(r){throw console.error("Colyseus connection failed:",r),r}return!0}catch(e){return console.error(`Error during step: ${n}`),console.error("Discord authorization or Colyseus connection failed:",e),e instanceof ProgressEvent?console.error("Network error (ProgressEvent) occurred, likely during fetch."):e.message&&e.message.includes("Token fetch failed")?console.error("Error specifically during token fetch step."):n==="connectColyseus"&&console.error("Error specifically during Colyseus connection step."),Ut=null,!1}},op=()=>Ut?Ut.user.username:!Ja&&cs instanceof Ol?Ui("user_id")||"MockUser":"User";function Ui(n){const e=Tc.get(n);if(e!=null)return e;const t=sessionStorage.getItem(n);if(t!=null)return t;const s=Math.random().toString(36).slice(2,10);return sessionStorage.setItem(n,s),s}class lp extends Bn.Scene{constructor(){super("Boot")}preload(){this.load.setPath("assets/")}create(){this.scene.start("Preloader")}}class cp extends Bn.Scene{constructor(){super("Game")}async create(){this.scene.launch("background"),this.add.image(this.cameras.main.width*.5,this.cameras.main.height*.4,"grid").setScale(.6),await this.connect(),this.room.state.draggables.onAdd((t,s)=>{const r=this.add.image(t.x,t.y,s).setInteractive();r.name=s,r.setScale(.8),this.input.setDraggable(r),r.on("drag",(i,l,c)=>{this.room&&(r.x=Phaser.Math.Clamp(l,r.displayWidth/2,Number(this.game.config.width)-r.displayWidth/2),r.y=Phaser.Math.Clamp(c,r.displayHeight/2,Number(this.game.config.height)-r.displayHeight/2),this.room.send("move",{imageId:s,x:r.x,y:r.y}))})}),this.add.text(this.cameras.main.width*.5,this.cameras.main.height*.95,`Connected as: ${op()}`,{font:"14px Arial",color:"#000000"}).setOrigin(.5)}async connect(){const e=location.host==="localhost:3000"?"ws://localhost:3001":`wss://${location.host}/.proxy/api/colyseus`,t=new mn.Client(`${e}`);try{this.room=await t.joinOrCreate("some_other_room",{screenWidth:this.game.config.width,screenHeight:this.game.config.height}),this.room.onMessage("move",s=>{}),console.log("Successfully connected!")}catch(s){console.log(`Could not connect with the server: ${s}`)}}}class up extends Bn.Scene{constructor(){super("MainMenu")}create(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let t=this.cameras.main.width/e.width+.2,s=this.cameras.main.height/e.height+.2,r=Math.max(t,s);e.setScale(r).setScrollFactor(0),this.add.text(Number(this.game.config.width)*.5,300,"Legends of the Friendgroup",{fontFamily:"Arial Black",fontSize:58,color:"#ffff00",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(Number(this.game.config.width)*.5,460,"Click to Start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,520,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.input.once("pointerdown",async()=>{this.statusText.setText("Authorizing with Discord..."),await ap()?(this.statusText.setText("Connecting to server..."),await new Promise(l=>setTimeout(l,1e3)),w?(this.statusText.setText("Loading game data..."),await Xa()?(this.statusText.setText("Connected! Entering Lobby..."),this.scene.start("Lobby")):this.statusText.setText("Failed to load game data. Please try again.")):this.statusText.setText("Failed to connect to server. Please try again.")):this.statusText.setText("Discord authorization failed. Please try again.")})}}class fp extends Bn.Scene{constructor(){super("Preloader")}init(){const e=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"background");let t=this.cameras.main.width/e.width+.2,s=this.cameras.main.height/e.height+.2,r=Math.max(t,s);e.setScale(r).setScrollFactor(0),this.add.rectangle(Number(this.game.config.width)*.5,Number(this.game.config.height)*.5,468,32).setStrokeStyle(1,16777215);const i=this.add.rectangle(Number(this.game.config.width)*.5-230,Number(this.game.config.height)*.5,4,28,16777215);this.load.on("progress",l=>{i.width=4+460*l})}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("cardFullTier1","CardFullTier1.png"),this.load.image("cardMinionTier1","CardMinionTier1.png")}create(){this.scene.start("MainMenu")}}class dp extends Bn.Scene{constructor(){super("background")}create(){this.cameras.main.setBackgroundColor(11393254),this.scene.sendToBack()}}var ke=(n=>(n.Lobby="Lobby",n.Shop="Shop",n.Preparation="Preparation",n.Battle="Battle",n.BattleEnd="BattleEnd",n.GameOver="GameOver",n))(ke||{});class hp extends Bn.Scene{constructor(){super("Lobby"),this.playerTextObjects=new Map,this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerStateListeners=new Map,this.listenersAttached=!1}create(){if(this.scene.launch("background"),this.listenersAttached=!1,!w||!w.sessionId){console.error("Lobby Scene: Not connected to Colyseus room or no session ID!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Not connected to server.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{w==null||w.leave()}catch{}this.scene.start("MainMenu")});return}this.add.text(this.cameras.main.centerX,100,"Lobby",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,200,"Players in Lobby:",{fontFamily:"Arial",fontSize:32,color:"#dddddd",align:"center"}).setOrigin(.5),this.statusText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-100,"Connecting to lobby...",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5),this.readyButton=this.add.text(this.cameras.main.centerX,this.cameras.main.height-150,"Ready Up",{fontFamily:"Arial Black",fontSize:40,color:"#888888",backgroundColor:"#333333",padding:{x:20,y:10},stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setVisible(!1).disableInteractive(),this.waitingText=this.add.text(this.cameras.main.centerX,this.cameras.main.height-110,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.readyButton.on("pointerdown",()=>{var e;w&&((e=this.readyButton.input)!=null&&e.enabled)&&(console.log("Lobby: Sending playerReady message."),w.send("playerReady"))}),this.readyButton.on("pointerover",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled&&this.readyButton.setColor("#55ff55")}),this.readyButton.on("pointerout",()=>{var e;(e=this.readyButton.input)!=null&&e.enabled?this.readyButton.setColor("#00ff00"):this.readyButton.setColor("#888888")}),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}attachMainListenersAndUI(){if(this.listenersAttached){console.log("Lobby: Main listeners and UI setup already performed, skipping.");return}if(!this.scene.isActive()){console.warn("Lobby: attachMainListenersAndUI called but scene is not active. Aborting.");return}if(!w||!w.state){console.warn("Lobby: attachMainListenersAndUI called but Colyseus room or state is not ready. Aborting.");return}console.log("Lobby: Attaching main Colyseus listeners and performing initial UI update."),this.attachMainListeners(),this.updateLobbyUI(),this.listenersAttached=!0}setupColyseusListeners(){if(!w){console.error("Lobby: setupColyseusListeners called but colyseusRoom is null.");return}console.log("Lobby: Setting up Colyseus general listeners."),w.state&&!this.listenersAttached&&(console.log("Lobby: State already available on setup. Scheduling attachMainListenersAndUI."),this.time.delayedCall(1,this.attachMainListenersAndUI,[],this)),w.onStateChange.once(e=>{if(console.log("Lobby: Initial state received via onStateChange.once."),!this.scene.isActive()){console.log("Lobby: Scene became inactive before onStateChange.once processing could complete.");return}this.attachMainListenersAndUI()})}attachMainListeners(){if(!w||!w.state){console.error("Lobby: attachMainListeners - colyseusRoom or state is null.");return}const e=mn.getStateCallbacks(w);this.phaseListenerUnsub&&this.phaseListenerUnsub(),this.phaseListenerUnsub=e(w.state).listen("currentPhase",(t,s)=>{this.scene.isActive()&&(console.log(`Lobby: Phase changed from ${s} to: ${t}`),t===ke.Shop?(this.statusText.setText("Starting Game!"),this.time.delayedCall(500,()=>{this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"))})):t===ke.Lobby?this.updateLobbyUI():t===ke.GameOver&&(this.statusText.setText("Game Over. Returning to Main Menu."),this.time.delayedCall(1500,()=>{if(this.scene.isActive()){try{w==null||w.leave()}catch{}this.scene.stop(),this.scene.start("MainMenu")}})))}),this.playerAddListenerUnsub&&this.playerAddListenerUnsub(),this.playerAddListenerUnsub=e(w.state.players).onAdd((t,s)=>{this.scene.isActive()&&(console.log(`Lobby: Player joined: ${t.username} (${s})`),this.addPlayerStateListener(t,s),this.updateLobbyUI())}),this.playerRemoveListenerUnsub&&this.playerRemoveListenerUnsub(),this.playerRemoveListenerUnsub=e(w.state.players).onRemove((t,s)=>{this.scene.isActive()&&(console.log(`Lobby: Player left: ${t.username} (${s})`),this.removePlayerStateListener(s),this.updateLobbyUI())}),w.state.players.forEach((t,s)=>{this.addPlayerStateListener(t,s)})}addPlayerStateListener(e,t){var i;if(!w)return;const s=mn.getStateCallbacks(w);(i=this.playerStateListeners.get(t))==null||i(),console.log(`Lobby: Adding 'isReady' listener for player ${t}`);const r=s(e).listen("isReady",(l,c)=>{console.log(`Lobby: isReady changed for player ${t}: ${c} -> ${l}`),this.scene.isActive()&&this.updateLobbyUI()});this.playerStateListeners.set(t,r)}removePlayerStateListener(e){const t=this.playerStateListeners.get(e);t&&(console.log(`Lobby: Removing 'isReady' listener for player ${e}`),t(),this.playerStateListeners.delete(e))}updateLobbyUI(){if(!this.scene.isActive()){console.warn("Lobby: updateLobbyUI called but scene is NOT ACTIVE. Aborting UI update.");return}if(!w){console.warn("Lobby: updateLobbyUI called but colyseusRoom is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Connection lost.");return}if(!w.state){console.warn("Lobby: updateLobbyUI called but colyseusRoom.state is NULL. Aborting UI update."),this.statusText&&this.statusText.active&&this.statusText.setText("Error: Game state unavailable.");return}ls.size===0&&(console.log("Lobby: Card data not loaded yet. Loading..."),Xa().then(h=>{h?console.log("Lobby: Card data loaded successfully"):console.warn("Lobby: Failed to load card data")}));const e=w.state.players,t=w.sessionId,s=e.size,r=250,i=40;this.playerTextObjects.forEach(h=>h.destroy()),this.playerTextObjects.clear();let l=0,c=s>0,g=!1;const f=e.get(t);f&&(g=f.isReady),e.forEach((h,p)=>{const T=p===t,C=h.isReady?" [Ready]":" [Not Ready]",Z=`${h.username||"Joining..."}${T?" (You)":""}${C}`,V=this.add.text(this.cameras.main.centerX,r+l*i,Z,{fontFamily:"Arial",fontSize:24,color:h.isReady?"#00ff00":"#ffffff",align:"center"}).setOrigin(.5);this.playerTextObjects.set(p,V),l++,h.isReady||(c=!1)}),s<2?(this.statusText.setText("Waiting for opponent..."),this.readyButton.setVisible(!1).disableInteractive(),this.waitingText.setVisible(!1)):(this.readyButton.setVisible(!0),g?(this.statusText.setText("Waiting for opponent to ready up..."),this.readyButton.setText("Waiting...").setColor("#888888").disableInteractive(),this.waitingText.setText(c?"Starting game...":"Waiting for opponent...").setVisible(!0)):(this.statusText.setText("Lobby full. Ready up!"),this.readyButton.setText("Ready Up").setColor("#00ff00").setInteractive({useHandCursor:!0}),this.waitingText.setVisible(!1)),c&&(this.statusText.setText("Starting game..."),this.readyButton.setVisible(!1),this.waitingText.setVisible(!1)))}shutdown(){var e,t,s,r,i,l,c,g,f;console.log("Lobby scene shutting down."),this.listenersAttached=!1,(e=this.phaseListenerUnsub)==null||e.call(this),(t=this.playerAddListenerUnsub)==null||t.call(this),(s=this.playerRemoveListenerUnsub)==null||s.call(this),this.playerStateListeners.forEach(h=>h()),this.playerStateListeners.clear(),this.phaseListenerUnsub=null,this.playerAddListenerUnsub=null,this.playerRemoveListenerUnsub=null,this.playerTextObjects.forEach(h=>h.destroy()),this.playerTextObjects.clear(),(r=this.statusText)==null||r.destroy(),(i=this.readyButton)==null||i.destroy(),(l=this.waitingText)==null||l.destroy(),(c=this.readyButton)==null||c.off("pointerdown"),(g=this.readyButton)==null||g.off("pointerover"),(f=this.readyButton)==null||f.off("pointerout"),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const An=120,Ls=168;class pp extends Bn.Scene{constructor(){super("Shop"),this.shopCardObjects=[],this.cardDataCache=new Map,this.shopOffersVisible=!0,this.phaseListenerUnsub=null,this.playerStateListenersUnsub=new Map,this.shopOfferListenersUnsub=[],this.listeners=[]}create(){var c;if(this.scene.launch("background"),(c=this.scene.get("BoardView"))!=null&&c.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!w||!w.state||!w.sessionId){console.error("Shop Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{w==null||w.leave(!0)}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,t=this.cameras.main.centerY,s=this.cameras.main.width,r=this.cameras.main.height;this.createShopCardsDisplay(e,t,s),this.setupDragAndDrop(),this.requestMissingCardData();const i=w.state.players.get(w.sessionId),l=(i==null?void 0:i.shopRefreshCost)||2;this.refreshButton=this.add.text(s-150,180,`Refresh: ${l} 🍺`,{fontFamily:"Arial",fontSize:18,color:"#FFFFFF",backgroundColor:"#4444AA",padding:{x:10,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.refreshButton.on("pointerdown",()=>{const g=w==null?void 0:w.state.players.get(w.sessionId);w&&g&&g.brews>=g.shopRefreshCost&&w.send("refreshShop")}),this.refreshButton.on("pointerover",()=>{var g;(g=this.refreshButton.input)!=null&&g.enabled&&this.refreshButton.setBackgroundColor("#6666CC")}),this.refreshButton.on("pointerout",()=>{var g;(g=this.refreshButton.input)!=null&&g.enabled&&this.refreshButton.setBackgroundColor("#4444AA")}),this.updateRefreshButtonState(),this.continueButton=this.add.text(e,r-50,"Continue",{fontFamily:"Arial Black",fontSize:40,color:"#00ff00",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.continueButton.on("pointerdown",()=>{const g=w==null?void 0:w.state.players.get(w.sessionId);w&&g&&!g.isReady&&w.state.currentPhase===ke.Shop&&w.send("playerReady")}),this.continueButton.on("pointerover",()=>{var g;(g=this.continueButton.input)!=null&&g.enabled&&this.continueButton.setColor("#55ff55")}),this.continueButton.on("pointerout",()=>{var g;(g=this.continueButton.input)!=null&&g.enabled?this.continueButton.setColor("#00ff00"):this.continueButton.setColor("#888888")}),this.waitingText=this.add.text(e,r-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(50,()=>this.createShopCardsDisplay(e,t,s)),this.toggleShopButton=this.add.text(s-100,t-250,"Toggle Shop",{fontFamily:"Arial",fontSize:16,color:"#FFFFFF",backgroundColor:"#555555",padding:{x:5,y:5}}).setOrigin(1,.5).setInteractive({useHandCursor:!0}),this.toggleShopButton.on("pointerdown",()=>{this.shopOffersVisible=!this.shopOffersVisible,this.shopOffersContainer.setVisible(this.shopOffersVisible),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop")}),this.toggleShopButton.setText(this.shopOffersVisible?"Hide Shop":"Show Shop"),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createShopCardsDisplay(e,t,s){var C;(C=this.shopOffersContainer)==null||C.destroy(),this.shopOffersContainer=this.add.container(0,0),this.shopOffersContainer.setVisible(this.shopOffersVisible),this.shopCardObjects.forEach(Z=>Z.destroy()),this.shopCardObjects=[];const r=w==null?void 0:w.state.players.get(w.sessionId),i=r==null?void 0:r.shopOfferIds;if(!i||i.length===0){console.log("Shop: No shop offers from server."),this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.setVisible(!1);return}const l=20,c=i.length>0?i.length:4,g=t,f=c*An+(c-1)*l,h=e-f/2+An/2,p=f+l*2,T=Ls+l*2;this.shopOffersBackground&&this.shopOffersBackground.active&&this.shopOffersBackground.destroy(),this.shopOffersBackground=this.add.rectangle(e,g,p,T,51,.6),this.shopOffersContainer.add(this.shopOffersBackground),i.forEach((Z,V)=>{const j=this.getCardDataFromServer(Z);if(!j){console.warn(`Shop: Card data not found for ID: ${Z}`);return}const me=h+V*(An+l),ne=this.add.container(me,g),de=this.add.image(0,0,"cardFullTier1").setOrigin(.5).setDisplaySize(An,Ls);ne.add(de);const Ae=this.add.text(0,-20,j.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:An-20}}).setOrigin(.5,.5);ne.add(Ae);const Ke=this.add.text(-An/2+32,Ls*.03,`${j.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(0,.5);ne.add(Ke);const tt=this.add.text(An/2-18,6,`${j.health}/${j.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,.5);ne.add(tt);const nt=this.add.text(0,Ls/2-50,`${j.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);ne.add(nt);const ct=this.add.text(An/2-8,-Ls/2+8,`${j.brewCost}B`,{fontFamily:"Arial",fontSize:14,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"right"}).setOrigin(1,0);ne.add(ct),ne.setSize(An,Ls),ne.setSize(An,Ls),ne.setInteractive({useHandCursor:!0}),ne.setData("cardId",j.id),ne.setData("cardData",j),this.input.setDraggable(ne),ne.off("pointerdown").on("pointerdown",st=>{var Ye;(Ye=ne.input)!=null&&Ye.enabled&&ne.setData("isBeingDragged",!1)}),ne.off("pointerup").on("pointerup",st=>{var $e;if(!(($e=ne.input)!=null&&$e.enabled)||!w||!w.sessionId)return;if(ne.getData("isBeingDragged")===!0){ne.setData("isBeingDragged",!1);return}const Ye=w.state.players.get(w.sessionId);if(!Ye)return;let Qe=-1;for(let k=0;k<5;k++)if(!Ye.hand.has(String(k))){Qe=k;break}if(Qe!==-1){const k=ne.getData("cardId"),ee=ne.getData("cardData");k&&ee&&Ye.brews>=ee.brewCost?(console.log(`Shop: Click-to-buy card ${k} (Cost: ${ee.brewCost}) into hand slot ${Qe}. Brews: ${Ye.brews}`),w.send("buyCard",{cardId:k,handSlotIndex:Qe})):ee&&Ye.brews<ee.brewCost?console.log(`Shop: Not enough brews (${Ye.brews}) to click-buy card ${k} (Cost: ${ee.brewCost}).`):console.log(`Shop: Click-to-buy failed for card ${k}. CardData: ${!!ee}`)}else console.log("Shop: Hand is full, cannot click-buy.")}),this.shopCardObjects.push(ne),this.shopOffersContainer.add(ne)})}requestMissingCardData(){if(!w||!w.state||!w.sessionId)return;const e=w.state.players.get(w.sessionId);if(!e)return;const t=e.shopOfferIds;if(t&&t.length>0){const s=[];t.forEach(r=>{ls.has(r)||s.push(r)}),s.length>0&&(console.log("Requesting missing cards from server:",s),w.send("getCardsByIds",{cardIds:s}))}}getCardDataFromServer(e){if(ls.has(e))return ls.get(e);if(!w||!w.state)return;let t;return w.state.players.forEach(s=>{s.hand.forEach(r=>{r.cardId===e&&(t={id:r.cardId,name:r.name,attack:r.attack,speed:r.speed,health:r.health,brewCost:r.brewCost,description:r.description,isLegend:r.isLegend})}),s.battlefield.forEach(r=>{r.cardId===e&&(t={id:r.cardId,name:r.name,attack:r.attack,speed:r.speed,health:r.health,brewCost:r.brewCost,description:r.description,isLegend:r.isLegend})})}),t||(t={id:e,name:`Card ${e.split("_").pop()}`,attack:1,speed:1,health:1,brewCost:1,description:"Loading card details...",isLegend:!1},console.warn(`Shop: Card data not found for ID: ${e} in global cache or state`)),t}setupDragAndDrop(){this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),this.input.off("pointerdown"),this.input.off("pointerup"),this.shopCardObjects.forEach(e=>{e.off("pointerdown"),e.off("pointerup")}),this.input.on("dragstart",(e,t)=>{var s;!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)||(s=t.input)!=null&&s.enabled&&(this.children.bringToTop(t),t.setAlpha(.7),t.setData("startX",t.x),t.setData("startY",t.y),t.setData("isBeingDragged",!0))}),this.input.on("drag",(e,t,s,r)=>{var i;!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)||(i=t.input)!=null&&i.enabled&&t.getData("isBeingDragged")===!0&&(t.x=s,t.y=r)}),this.input.on("dragend",(e,t)=>{if(!w||!(t instanceof Phaser.GameObjects.Container)||!this.shopCardObjects.includes(t)){t instanceof Phaser.GameObjects.Container&&t.setData("isBeingDragged",!1);return}t.setAlpha(1);let s=!1;if(t.getData("isBeingDragged")===!0){const r=t.x,i=t.y,l=this.scene.get("BoardView");for(let c=0;c<5;c++){const g=l==null?void 0:l.getSlotPixelPosition(!0,"hand",c);if(g){const f=new Phaser.Geom.Rectangle(g.x-50,g.y-70,100,140);if(Phaser.Geom.Rectangle.Contains(f,r,i)){const h=w.state.players.get(w.sessionId);if(h&&!h.hand.has(String(c))){const p=t.getData("cardId"),T=t.getData("cardData");p&&T&&h.brews>=T.brewCost?(w.send("buyCard",{cardId:p,handSlotIndex:c}),s=!0):console.log("Shop: Drag-to-buy failed (not enough brews or card data missing).")}break}}}s||t.active&&(t.x=t.getData("startX"),t.y=t.getData("startY"))}t.setData("isBeingDragged",!1)})}updateRefreshButtonState(){if(!w||!this.refreshButton||!this.refreshButton.active)return;const e=w.state.players.get(w.sessionId);if(!e)return;this.refreshButton.setText(`Refresh: ${e.shopRefreshCost} 🍺`),e.brews>=e.shopRefreshCost&&w.state.currentPhase===ke.Shop?(this.refreshButton.setColor("#FFFFFF"),this.refreshButton.setBackgroundColor("#4444AA"),this.refreshButton.setInteractive({useHandCursor:!0})):(this.refreshButton.setColor("#AAAAAA"),this.refreshButton.setBackgroundColor("#555555"),this.refreshButton.disableInteractive())}setupColyseusListeners(){if(!w||!w.sessionId)return;const e=mn.getStateCallbacks(w),t=w.sessionId;this.phaseListenerUnsub=e(w.state).listen("currentPhase",r=>{this.scene.isActive()&&(r===ke.Preparation?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Preparation")):r!==ke.Shop&&this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby")),this.updateWaitingStatus())}),w.state.players.forEach((r,i)=>{const l=e(r).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(i,l)}),this.listeners.push(e(w.state.players).onAdd((r,i)=>{var c;this.playerStateListenersUnsub.has(i)&&((c=this.playerStateListenersUnsub.get(i))==null||c());const l=e(r).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.playerStateListenersUnsub.set(i,l),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(e(w.state.players).onRemove((r,i)=>{var l;(l=this.playerStateListenersUnsub.get(i))==null||l(),this.playerStateListenersUnsub.delete(i),this.scene.isActive()&&this.updateWaitingStatus()})),this.listeners.push(w.onMessage("cardsByIds",r=>{if(this.scene.isActive()){Object.entries(r).forEach(([g,f])=>{ls.set(g,f)});const i=this.cameras.main.centerX,l=this.cameras.main.centerY,c=this.cameras.main.width;this.createShopCardsDisplay(i,l,c)}}));const s=w.state.players.get(t);if(s){const r=()=>{if(!this.scene.isActive())return;this.requestMissingCardData();const i=this.cameras.main.centerX,l=this.cameras.main.centerY,c=this.cameras.main.width;this.createShopCardsDisplay(i,l,c)};this.shopOfferListenersUnsub.push(e(s.shopOfferIds).onAdd(r)),this.shopOfferListenersUnsub.push(e(s.shopOfferIds).onRemove(r)),r(),this.listeners.push(e(s).listen("brews",()=>{this.scene.isActive()&&this.updateRefreshButtonState()})),this.listeners.push(e(s).listen("shopRefreshCost",()=>{this.scene.isActive()&&this.updateRefreshButtonState()}))}}cleanupListeners(){var e,t,s,r;console.log("Shop Scene: Cleaning up listeners."),(e=this.phaseListenerUnsub)==null||e.call(this),this.phaseListenerUnsub=null,this.playerStateListenersUnsub.forEach(i=>i()),this.playerStateListenersUnsub.clear(),this.shopOfferListenersUnsub.forEach(i=>i()),this.shopOfferListenersUnsub=[],this.listeners.forEach(i=>i()),this.listeners=[],this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(t=this.continueButton)==null||t.off("pointerdown"),(s=this.continueButton)==null||s.off("pointerover"),(r=this.continueButton)==null||r.off("pointerout")}updateWaitingStatus(){if(!w||!w.sessionId||!this.continueButton||!this.waitingText||!this.scene.isActive())return;const e=w.state.players.get(w.sessionId);if(!e)return;let t=!0;w.state.players.forEach(l=>{l.isReady||(t=!1)});const s=e.isReady,r=w.state.currentPhase===ke.Shop,i=!s&&r;this.continueButton.setInteractive(i),this.continueButton.input&&(this.continueButton.input.useHandCursor=i),this.continueButton.setColor(i?"#00ff00":"#888888"),s&&!t&&r?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.continueButton.setText("Waiting...")):r?(this.waitingText.setVisible(!1),this.continueButton.setText("Continue")):(this.waitingText.setText(`Waiting for ${w.state.currentPhase} phase...`).setVisible(!0),this.continueButton.setText("Continue")),this.shopCardObjects.forEach(l=>{l.input&&(l.input.enabled=i)})}shutdown(){var e,t,s,r,i,l,c,g;console.log("Shop scene shutting down."),this.cleanupListeners(),this.shopCardObjects.forEach(f=>f.destroy()),this.shopCardObjects=[],(e=this.continueButton)==null||e.destroy(),(t=this.waitingText)==null||t.destroy(),(s=this.refreshButton)==null||s.off("pointerdown"),(r=this.refreshButton)==null||r.off("pointerover"),(i=this.refreshButton)==null||i.off("pointerout"),(l=this.refreshButton)==null||l.destroy(),(c=this.toggleShopButton)==null||c.destroy(),(g=this.shopOffersContainer)==null||g.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class gp extends Bn.Scene{constructor(){super("Preparation"),this.playerStateListener=null,this.handListener=null,this.battlefieldListener=null,this.phaseListener=null,this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerChangeListeners=new Map,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.clientSideCardLayout=new Map}create(){var r;if(this.scene.launch("background"),(r=this.scene.get("BoardView"))!=null&&r.scene.isActive()||this.scene.launch("BoardView"),this.scene.bringToTop(),!w||!w.state||!w.sessionId){console.error("Preparation Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center"}).setOrigin(.5),this.input.once("pointerdown",()=>this.scene.start("MainMenu"));return}const e=this.cameras.main.centerX;this.cameras.main.centerY;const t=this.cameras.main.height;this.cameras.main.width;const s=w.state.players.get(w.sessionId);s?console.log("Preparation Create: Initial myPlayerState.hand contents:",JSON.stringify(Object.fromEntries(s.hand.entries()))):console.log("Preparation Create: myPlayerState not found initially."),this.add.text(e,80,"Preparation Phase",{fontFamily:"Arial Black",fontSize:48,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.startBattleButton=this.add.text(e,t-50,"Start Battle",{fontFamily:"Arial Black",fontSize:40,color:"#888888",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.startBattleButton.setColor("#888888").disableInteractive(),this.waitingText=this.add.text(e,t-20,"",{fontFamily:"Arial",fontSize:18,color:"#ffff00",align:"center"}).setOrigin(.5).setVisible(!1),this.setupColyseusListeners(),this.updateWaitingStatus(),this.time.delayedCall(100,this.updateStartButtonState,[],this),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!w||!w.sessionId)return;const e=w.sessionId,t=mn.getStateCallbacks(w),s=w.state.players.get(e);s?(this.playerStateListenerUnsub=t(s).onChange(()=>{this.scene.isActive()&&this.updateWaitingStatus()}),this.handAddUnsub=t(s.hand).onAdd((r,i)=>{console.log(`Preparation Scene: player.hand.onAdd triggered for key: ${i}, card: ${r==null?void 0:r.name}. Scene active: ${this.scene.isActive()}`),this.scene.isActive()&&this.updateStartButtonState()}),this.handRemoveUnsub=t(s.hand).onRemove((r,i)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldAddUnsub=t(s.battlefield).onAdd((r,i)=>{this.scene.isActive()&&this.updateStartButtonState()}),this.battlefieldRemoveUnsub=t(s.battlefield).onRemove((r,i)=>{this.scene.isActive()&&this.updateStartButtonState()})):console.error("Preparation Scene: My player state not found on init."),this.phaseListenerUnsub=t(w.state).listen("currentPhase",r=>{this.scene.isActive()&&(console.log(`Preparation Scene: Phase changed to ${r}`),r===ke.Battle?this.scene.isActive()&&(this.scene.stop(),this.scene.start("Battle")):r!==ke.Preparation&&(console.warn(`Preparation Scene: Unexpected phase change to ${r}. Returning to Lobby.`),this.scene.isActive()&&(this.scene.stop(),this.scene.start("Lobby"))),this.updateWaitingStatus())}),this.otherPlayerAddUnsub=t(w.state.players).onAdd((r,i)=>{if(this.scene.isActive()){if(i!==e){const l=t(r).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(i,l)}this.updateWaitingStatus()}}),this.otherPlayerRemoveUnsub=t(w.state.players).onRemove((r,i)=>{if(this.scene.isActive()){const l=this.otherPlayerChangeListeners.get(i);l==null||l(),this.otherPlayerChangeListeners.delete(i),this.updateWaitingStatus()}}),w.state.players.forEach((r,i)=>{if(i!==e){const l=t(r).listen("isReady",()=>{this.scene.isActive()&&this.updateWaitingStatus()});this.otherPlayerChangeListeners.set(i,l)}})}cleanupListeners(){var e,t,s,r,i,l,c,g,f,h,p,T,C;console.log("Preparation Scene: Cleaning up listeners."),(e=this.playerStateListenerUnsub)==null||e.call(this),(t=this.handAddUnsub)==null||t.call(this),(s=this.handRemoveUnsub)==null||s.call(this),(r=this.handChangeUnsub)==null||r.call(this),(i=this.battlefieldAddUnsub)==null||i.call(this),(l=this.battlefieldRemoveUnsub)==null||l.call(this),(c=this.battlefieldChangeUnsub)==null||c.call(this),(g=this.phaseListenerUnsub)==null||g.call(this),(f=this.otherPlayerAddUnsub)==null||f.call(this),(h=this.otherPlayerRemoveUnsub)==null||h.call(this),this.otherPlayerChangeListeners.forEach(Z=>Z()),this.playerStateListenerUnsub=null,this.handAddUnsub=null,this.handRemoveUnsub=null,this.handChangeUnsub=null,this.battlefieldAddUnsub=null,this.battlefieldRemoveUnsub=null,this.battlefieldChangeUnsub=null,this.phaseListenerUnsub=null,this.otherPlayerAddUnsub=null,this.otherPlayerRemoveUnsub=null,this.otherPlayerChangeListeners.clear(),this.input.off("dragstart"),this.input.off("drag"),this.input.off("dragend"),(p=this.startBattleButton)==null||p.off("pointerdown"),(T=this.startBattleButton)==null||T.off("pointerover"),(C=this.startBattleButton)==null||C.off("pointerout")}makeLocalPlayerCardsDraggable(){if(!w||!w.sessionId||!this.scene.isActive()){console.warn("Preparation: Cannot make cards draggable, room/session/scene inactive.");return}const e=w.sessionId,t=w.state.players.get(e),s=this.scene.get("BoardView");if(!t||!s){console.warn("Preparation: Player state or BoardView not found for making cards draggable.");return}this.clientSideCardLayout.forEach(i=>{i.gameObject&&i.gameObject.input&&this.input.disable(i.gameObject)}),this.clientSideCardLayout.clear();const r=(i,l)=>{i.forEach((c,g)=>{const f=s.getCardGameObjectByInstanceId(c.instanceId);f?(f.setInteractive({useHandCursor:!0}),this.input.setDraggable(f),this.clientSideCardLayout.set(c.instanceId,{area:l,slotKey:g,gameObject:f})):console.warn(`Preparation: Could not find GameObject in BoardView for card instance ${c.instanceId}`)})};r(t.hand,"hand"),r(t.battlefield,"battlefield"),console.log("Preparation: Made local player cards draggable and initialized clientSideCardLayout.",this.clientSideCardLayout),this.updateStartButtonState()}updateWaitingStatus(){if(!w||!w.sessionId||!this.startBattleButton||!this.waitingText)return;const e=w.state.players.get(w.sessionId);if(!e)return;let t=!0;w.state.players.forEach(r=>{r.isReady||(t=!1)});const s=e.isReady;!s&&(w.state.currentPhase,ke.Preparation),this.updateStartButtonState(),s&&!t?(this.waitingText.setText("Waiting for other player(s)...").setVisible(!0),this.startBattleButton.setText("Waiting..."),this.startBattleButton.disableInteractive().setColor("#888888")):(this.waitingText.setVisible(!1),this.startBattleButton.setText("Start Battle"),this.updateStartButtonState())}updateStartButtonState(){if(!this.startBattleButton||!this.startBattleButton.active){console.warn("updateStartButtonState called but button is null or inactive.");return}let e=0;const t=this.scene.get("BoardView");t&&t.scene.isActive()&&t.getLocalPlayerLayoutData().forEach(f=>{f.area==="battlefield"&&e++});const s=e>0,r=w==null?void 0:w.state.players.get(w==null?void 0:w.sessionId),i=(r==null?void 0:r.isReady)??!1,l=(w==null?void 0:w.state.currentPhase)===ke.Preparation;s&&!i&&l?(this.startBattleButton.setColor("#00ff00"),this.startBattleButton.setInteractive({useHandCursor:!0}),this.startBattleButton.off("pointerdown"),this.startBattleButton.once("pointerdown",this.confirmPreparation,this),this.startBattleButton.on("pointerover",()=>this.startBattleButton.setColor("#55ff55")),this.startBattleButton.on("pointerout",()=>this.startBattleButton.setColor("#00ff00"))):(this.waitingText&&!this.waitingText.visible&&this.startBattleButton.setColor("#888888"),this.startBattleButton.disableInteractive(),this.startBattleButton.off("pointerdown"),this.startBattleButton.off("pointerover"),this.startBattleButton.off("pointerout"))}confirmPreparation(){if(!w)return;console.log("Confirming preparation layout...");const e=this.scene.get("BoardView");if(!e||!e.scene.isActive()){console.error("Preparation: BoardView not available to get layout data.");return}const{handLayout:t,battlefieldLayout:s}=e.getCardLayouts();console.log("Sending preparation layout to server:",{handLayout:t,battlefieldLayout:s}),w.send("setPreparation",{handLayout:t,battlefieldLayout:s}),this.updateWaitingStatus()}shutdown(){var e,t;console.log("Preparation scene shutting down explicitly."),this.cleanupListeners(),(e=this.startBattleButton)==null||e.destroy(),(t=this.waitingText)==null||t.destroy(),this.clientSideCardLayout.clear(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}class mp extends Bn.Scene{constructor(){super("Battle"),this.handCardDisplayObjects=new Map,this.battleOver=!1,this.phaseListenerUnsubscribe=null}create(){if(this.scene.launch("background"),this.battleOver=!1,!w||!w.state||!w.sessionId){console.error("Battle Scene: Colyseus room not available!"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Error: Connection lost.
Please return to Main Menu.`,{color:"#ff0000",fontSize:"24px",align:"center",backgroundColor:"#000000"}).setOrigin(.5),this.input.once("pointerdown",()=>{try{w==null||w.leave()}catch{}this.scene.start("MainMenu")});return}const e=this.cameras.main.centerX,t=this.cameras.main.centerY,s=this.cameras.main.height;this.cameras.main.width,this.resultText=this.add.text(e,t,"",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setAlpha(0),this.statusText=this.add.text(e,s-50,"",{fontFamily:"Arial",fontSize:24,color:"#ffff00",align:"center"}).setOrigin(.5).setAlpha(0),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}setupColyseusListeners(){if(!w||!w.state)return;const e=mn.getStateCallbacks(w);this.phaseListenerUnsubscribe=e(w.state).listen("currentPhase",t=>{if(this.scene.isActive()){if(console.log(`Battle Scene: Phase changed to ${t}`),t===ke.BattleEnd)this.handleBattleEnd();else if(t===ke.Shop)this.scene.isActive()&&(this.scene.stop(),this.scene.start("Shop"));else if(t===ke.GameOver)this.handleGameOver();else if(t!==ke.Battle&&(console.warn(`Battle Scene: Unexpected phase change to ${t}. Returning to Lobby.`),this.scene.isActive())){try{w==null||w.leave()}catch{}this.scene.stop(),this.scene.start("Lobby")}}})}cleanupListeners(){var e;console.log("Battle Scene: Cleaning up listeners."),(e=this.phaseListenerUnsubscribe)==null||e.call(this),this.phaseListenerUnsubscribe=null}handleBattleEnd(){var i,l;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Battle ended (server signal received). Displaying results.");const e=w==null?void 0:w.state.players.get(w.sessionId);let t;w==null||w.state.players.forEach((c,g)=>{g!==(w==null?void 0:w.sessionId)&&(t=c)});let s="Battle Ended",r="#ffffff";e&&t?e.health>t.health?(s="Victory!",r="#88ff88"):t.health>e.health?(s="Defeat!",r="#ff8888"):(s="Draw!",r="#ffff88"):(s="Battle Ended (Opponent Left?)",r="#ffffff"),(i=this.resultText)!=null&&i.active&&this.resultText.setText(s).setColor(r).setAlpha(1),(l=this.statusText)!=null&&l.active&&this.statusText.setText("Waiting for next round...").setAlpha(1)}handleGameOver(){var i,l;if(this.battleOver||!this.scene.isActive())return;this.battleOver=!0,console.log("Game Over signal received.");const e=w==null?void 0:w.state.players.get(w.sessionId);let t;w==null||w.state.players.forEach((c,g)=>{g!==(w==null?void 0:w.sessionId)&&(t=c)});let s="Game Over!",r="#ffffff";e&&t?e.health>t.health?(s="You Win!",r="#00ff00"):t.health>e.health?(s="You Lose!",r="#ff0000"):(s="Draw!",r="#ffff00"):e?(s="You Win! (Opponent Left)",r="#00ff00"):(s="Game Over (Error?)",r="#ff0000"),(i=this.resultText)!=null&&i.active&&this.resultText.setText(s).setColor(r).setAlpha(1),(l=this.statusText)!=null&&l.active&&this.statusText.setText("Click to return to Main Menu").setAlpha(1),this.input.once("pointerdown",()=>{try{w==null||w.leave()}catch{}this.scene.stop("Background"),this.scene.start("MainMenu")})}shutdown(){var e,t;console.log("Battle scene shutting down explicitly."),this.cleanupListeners(),this.handCardDisplayObjects.forEach(s=>{s==null||s.forEach(r=>r==null?void 0:r.destroy())}),this.handCardDisplayObjects.clear(),(e=this.resultText)==null||e.destroy(),(t=this.statusText)==null||t.destroy(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}const ns=100,aa=140,dn=120,hn=168,Bo=15,oa=580,la=420,ca=100,ua=260;class yp extends Bn.Scene{constructor(){super("BoardView"),this.playerVisuals=new Map,this.currentPhase=ke.Lobby,this.listeners=[],this.cardSchemaListeners=new Map}updateCardHpVisuals(e,t,s){if(!e||!e.active)return;const r=e.getData("hpTextObject"),i=e.getData("mainCardImage");if(r&&r.active){r.setText(`${t}/${s}`);const c=s>0?t/s:0;t<=0?r.setColor("#ff0000"):c<.3?r.setColor("#ff8888"):c<.6?r.setColor("#ffff88"):r.setColor("#88ff88")}const l=e.alpha<1;t<=0?l||(e.setAlpha(.6),i&&i.active&&typeof i.setTint=="function"&&i.setTint(7829367)):l&&(e.setAlpha(1),i&&i.active&&typeof i.clearTint=="function"?i.clearTint():i&&i.active&&console.warn("BoardView: updateCardHpVisuals - clearTint method not found on mainCardImage for card.",e.getData("instanceId"),i))}preload(){if(!this.textures.exists("cardBack")){const e=this.make.graphics({x:0,y:0});e.fillStyle(5253758),e.fillRect(0,0,dn,hn),e.lineStyle(2,12428501),e.strokeRect(0,0,dn,hn),e.generateTexture("cardBack",dn,hn),e.destroy()}}create(){console.log("BoardView creating..."),this.createNavbar(),this.createSellZone(),this.setupColyseusListeners(),this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}createNavbar(){const e=this.cameras.main.centerX,t=this.cameras.main.width,s=30;this.add.rectangle(e,s,t,50,0,.7).setDepth(1e3);const i={fontFamily:"Arial",fontSize:16,color:"#ffffff",align:"left"};this.playerHealthText=this.add.text(t*.05,s,"You: -- HP",{...i,color:"#00ff00"}).setOrigin(0,.5).setDepth(1001),this.playerBrewsText=this.add.text(t*.95,s,"Brews: --",{...i,color:"#ffff00",align:"right"}).setOrigin(1,.5).setDepth(1001),this.opponentUsernameText=this.add.text(t*.25,s-10,"Opponent: --",{...i,fontSize:14}).setOrigin(0,.5).setDepth(1001),this.opponentHealthText=this.add.text(t*.25,s+10,"-- HP",{...i,color:"#ff0000"}).setOrigin(0,.5).setDepth(1001),this.dayPhaseText=this.add.text(e,s,"Day -- - Phase --",{...i,fontSize:20,align:"center"}).setOrigin(.5).setDepth(1001)}showAttackAnimation(e){const t=this.getCardGameObjectByInstanceId(e);if(t&&t.active){const s=t.scaleX,r=t.scaleY;this.tweens.add({targets:t,scaleX:s*1.15,scaleY:r*1.15,duration:100,yoyo:!0,ease:"Sine.easeInOut"})}}showDamageNumber(e,t){const s=this.getCardGameObjectByInstanceId(e);if(s&&s.active&&t>0){const r=this.add.text(s.x+Phaser.Math.Between(-10,10),s.y-hn/2-10,`-${t}`,{fontFamily:"Arial Black",fontSize:24,color:"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(s.depth+1);this.tweens.add({targets:r,y:r.y-50,alpha:0,duration:1e3,ease:"Power1",onComplete:()=>{r.destroy()}})}}drawAttackLine(e,t){const s=this.getCardGameObjectByInstanceId(e),r=this.getCardGameObjectByInstanceId(t);if(s&&s.active&&r&&r.active){const i=this.add.line(0,0,s.x,s.y,r.x,r.y,16724787,.7).setOrigin(0,0).setLineWidth(2).setDepth(s.depth);this.time.delayedCall(250,()=>{i.destroy()})}}setupColyseusListeners(){if(!w||!w.state){console.error("BoardView: Colyseus room or state not available!"),this.time.delayedCall(100,this.setupColyseusListeners,[],this);return}const e=mn.getStateCallbacks(w);this.listeners.push(e(w.state).listen("currentDay",()=>this.updateNavbarText())),this.listeners.push(e(w.state).listen("currentPhase",(t,s)=>{this.currentPhase=t,this.updateNavbarText(),t===ke.Shop||t===ke.Preparation?this.sellZone.setVisible(!0):this.sellZone.setVisible(!1);const r=(i,l,c,g)=>{if(!i.active)return;const f=i.getData("cooldownBarBg"),h=i.getData("cooldownBarFill");if(t===ke.Battle){if(i.getData("area")==="battlefield")if(l)if(f&&h){f.setVisible(!0),h.setVisible(!0);const T=i.getData("cooldownBarBaseWidth"),C=typeof T=="number"?T:ns-10;h.setSize(C,6);const Z=(l.speed>0?l.speed:1.5)*1e3;i.setData("maxAttackCooldown",Z),i.setData("attackCooldownTimer",Z)}else console.warn(`BoardView: Battle Phase - Card ${l.instanceId} (Owner: ${c}, Slot: ${g}) missing cooldown bar elements in data. Bg: ${!!f}, Fill: ${!!h}`);else console.warn(`BoardView: Battle Phase - Battlefield card container (Owner: ${c}, Slot: ${g}) has no cardSchema. No cooldown bar shown.`)}else f&&f.setVisible(!1),h&&h.setVisible(!1);if((s===ke.Battle||s===ke.BattleEnd)&&t!==ke.Battle&&t!==ke.BattleEnd&&l&&l.currentHp>0){i.setAlpha(1);const p=i.getData("backgroundRectangle");p&&p.active&&typeof p.clearTint=="function"&&p.clearTint()}};this.playerVisuals.forEach((i,l)=>{i.battlefield.forEach((c,g)=>{var h;const f=(h=w==null?void 0:w.state.players.get(l))==null?void 0:h.battlefield.get(g);r(c,f,l,g)}),i.hand.forEach((c,g)=>{var h;const f=(h=w==null?void 0:w.state.players.get(l))==null?void 0:h.hand.get(g);if((s===ke.Battle||s===ke.BattleEnd)&&t!==ke.Battle&&t!==ke.BattleEnd&&f&&f.currentHp>0){c.setAlpha(1);const p=c.getData("backgroundRectangle");p&&p.active&&typeof p.clearTint=="function"&&p.clearTint()}})})})),this.listeners.push(e(w.state.players).onAdd((t,s)=>{console.log(`BoardView: Player added ${s}`),this.addPlayerVisuals(s),this.addPlayerListeners(t,s),this.updatePlayerSlots(t,s),this.updateNavbarText()})),this.listeners.push(e(w.state.players).onRemove((t,s)=>{console.log(`BoardView: Player removed ${s}`),this.removePlayerVisuals(s),this.updateNavbarText()})),this.listeners.push(w.onMessage("battleAttackEvent",t=>{if(this.currentPhase!==ke.Battle||!this.scene.isActive())return;console.log("BoardView: Received battleAttackEvent",t);const s=this.getCardGameObjectByInstanceId(t.attackerInstanceId),r=this.getCardGameObjectByInstanceId(t.targetInstanceId);if(s&&s.active&&r&&r.active){this.drawAttackLine(t.attackerInstanceId,t.targetInstanceId),this.showAttackAnimation(t.attackerInstanceId),this.showDamageNumber(t.targetInstanceId,t.damageDealt);const i=s.getData("maxAttackCooldown");if(i>0){s.setData("attackCooldownTimer",i);const f=s.getData("cooldownBarFill"),h=s.getData("cooldownBarBaseWidth")||ns-10;f&&f.setSize(h,6)}const l=r.getData("ownerSessionId"),c=r.getData("slotKey"),g=r.getData("area");if(l===t.targetPlayerId&&g==="battlefield"&&c){const f=w.state.players.get(t.targetPlayerId),h=f==null?void 0:f.battlefield.get(c);if(h&&h.instanceId===t.targetInstanceId){const p=Math.max(0,h.currentHp-t.damageDealt);this.updateCardHpVisuals(r,p,h.health)}else console.warn(`BoardView: battleAttackEvent - Target card schema not found or instanceId mismatch for player ${t.targetPlayerId}, slot ${c}, instance ${t.targetInstanceId}.`)}else console.warn(`BoardView: battleAttackEvent - Target card container data inconsistent or not on battlefield. Owner: ${l}, Area: ${g}, Slot: ${c}`)}else console.warn("BoardView: Attacker or target not found/active for battleAttackEvent",t)})),w.state.players.forEach((t,s)=>{this.addPlayerVisuals(s),this.addPlayerListeners(t,s),this.updatePlayerSlots(t,s)}),this.updateNavbarText()}update(e,t){!this.scene.isActive()||this.currentPhase!==ke.Battle||!w||!w.state||this.playerVisuals.forEach(s=>{s.battlefield.forEach(r=>{if(!r.active)return;const i=r.getData("maxAttackCooldown");let l=r.getData("attackCooldownTimer");const c=r.getData("cooldownBarBaseWidth")||ns-10;if(i>0){l-=t,l<0&&(l=0),r.setData("attackCooldownTimer",l);const g=r.getData("cooldownBarFill");if(g&&g.visible){const f=l/i;g.setSize(c*Math.max(0,f),6)}}})})}addPlayerListeners(e,t){const s=mn.getStateCallbacks(w),r=[];r.push(s(e).listen("health",()=>this.updateNavbarText())),r.push(s(e).listen("brews",()=>this.updateNavbarText())),r.push(s(e).listen("username",()=>this.updateNavbarText())),r.push(s(e.hand).onAdd((i,l)=>{this.updateCardVisual(t,"hand",l,i),this.addCardSchemaListeners(i)})),r.push(s(e.hand).onRemove((i,l)=>{this.removeCardVisual(t,"hand",l)})),e.hand.forEach((i,l)=>{this.addCardSchemaListeners(i)}),r.push(s(e.battlefield).onAdd((i,l)=>{this.updateCardVisual(t,"battlefield",l,i),this.addCardSchemaListeners(i)})),r.push(s(e.battlefield).onRemove((i,l)=>{this.removeCardVisual(t,"battlefield",l)})),e.battlefield.forEach((i,l)=>{this.addCardSchemaListeners(i)}),this.listeners.push(...r)}addCardSchemaListeners(e){if(!e||!e.instanceId)return;const t=mn.getStateCallbacks(w),s=this.cardSchemaListeners.get(e.instanceId);s&&(s.forEach(l=>l()),this.cardSchemaListeners.delete(e.instanceId));const r=[],i=t(e).listen("currentHp",(l,c)=>{const g=this.getCardGameObjectByInstanceId(e.instanceId);g&&this.updateCardHpVisuals(g,l,e.health)});r.push(i),r.length>0&&this.cardSchemaListeners.set(e.instanceId,r)}updatePlayerSlots(e,t){e.hand.forEach((s,r)=>this.updateCardVisual(t,"hand",r,s)),e.battlefield.forEach((s,r)=>this.updateCardVisual(t,"battlefield",r,s))}addPlayerVisuals(e){if(!this.playerVisuals.has(e)){const t=[],s=[],r=e===(w==null?void 0:w.sessionId);for(let i=0;i<5;i++){const l=this.calculateSlotX(i,"hand"),c=r?oa:ca,g=this.add.rectangle(l,c,dn,hn).setStrokeStyle(2,r?11184810:7829367,.8).setDepth(0);t.push(g);const f=this.calculateSlotX(i,"battlefield"),h=r?la:ua,p=this.add.rectangle(f,h,ns,aa).setStrokeStyle(2,r?16777215:11184810,1).setDepth(0);s.push(p)}this.playerVisuals.set(e,{hand:new Map,battlefield:new Map,handSlotOutlines:t,battlefieldSlotOutlines:s})}}removePlayerVisuals(e){const t=this.playerVisuals.get(e);t&&(t.hand.forEach(s=>s.destroy()),t.battlefield.forEach(s=>s.destroy()),t.handSlotOutlines.forEach(s=>s.destroy()),t.battlefieldSlotOutlines.forEach(s=>s.destroy())),this.playerVisuals.delete(e)}updateCardVisual(e,t,s,r){if(!this.scene.isActive()||!w||!w.state)return;this.removeCardVisual(e,t,s);const i=this.playerVisuals.get(e);if(!i)return;const l=e===(w==null?void 0:w.sessionId),c=this.calculateSlotX(parseInt(s,10),t);let g,f=!1;t==="hand"?(g=l?oa:ca,l||(f=!0)):g=l?la:ua;const h=this.createCardGameObject(r,c,g,f,l,t);if(h.setData("instanceId",r.instanceId),h.setData("slotKey",s),h.setData("area",t),h.setData("ownerSessionId",e),h.setDepth(1),r.currentHp<=0){h.setAlpha(.6);const p=h.getData("mainCardImage");p&&p.active&&typeof p.setTint=="function"&&p.setTint(7829367);const T=h.getData("hpTextObject");T&&T.active&&T.setColor("#ff0000")}t==="hand"?i.hand.set(s,h):i.battlefield.set(s,h),this.addCardSchemaListeners(r),l&&this.makeCardInteractive(h)}removeCardVisual(e,t,s){const r=this.playerVisuals.get(e);if(r){const i=t==="hand"?r.hand:r.battlefield,l=i.get(s);if(l){const c=l.getData("instanceId");if(c){const g=this.cardSchemaListeners.get(c);g&&(console.log(`BoardView: Cleaning up ${g.length} listeners for card instance ${c} during removeCardVisual.`),g.forEach(f=>{if(typeof f=="function")try{f()}catch(h){console.warn(`BoardView: Error unsubscribing card listener for ${c}`,h)}}),this.cardSchemaListeners.delete(c))}l.input&&l.input.enabled&&this.input.disable(l),this.time.delayedCall(1,()=>{l.active&&l.destroy()}),i.delete(s)}}}calculateSlotX(e,t){const s=t==="hand"?dn:ns,r=5*s+4*Bo;return(this.cameras.main.width-r)/2+s/2+e*(s+Bo)}createCardGameObject(e,t,s,r,i,l){const c=this.add.container(t,s),g=l==="hand"?dn:ns,f=l==="hand"?hn:aa;if(c.setData("displayCardWidth",g),c.setData("displayCardHeight",f),r){const T=this.add.image(0,0,"cardBack").setOrigin(.5).setDisplaySize(dn,hn);return c.add(T),c}const h=l==="hand"?"cardFullTier1":"cardMinionTier1",p=this.add.image(0,0,h).setOrigin(.5);if(p.setDisplaySize(g,f),c.add(p),c.setData("mainCardImage",p),l==="hand"){const T=this.add.text(0,-20,e.name,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:g-20}}).setOrigin(.5,.5);c.add(T);const C=this.add.text(-ns/2+32,aa*.03,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);c.add(C);const Z=this.add.text(ns/2-18,6,`${e.currentHp}  ${e.health}`,{fontFamily:"Arial",fontSize:16,color:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(1,.5);c.add(Z),c.setData("hpTextObject",Z);const V=this.add.text(0,f/2-50,`${e.speed}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5,1);c.add(V)}else{const T=this.add.text(0,-f/2+5,e.name,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center",wordWrap:{width:g}}).setOrigin(.5,0);c.add(T);const C=this.add.text(-g/2+32,32,`${e.attack}`,{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(0,.5);c.add(C);const Z=this.add.text(0,43,`${e.speed}`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(1,0);c.add(Z);const V=this.add.text(g/2-10,f/2-30,`${e.currentHp}/${e.health}`,{fontFamily:"Arial",fontSize:14,color:"#00ff00",stroke:"#000000",strokeThickness:3}).setOrigin(1,1);c.add(V),c.setData("hpTextObject",V);const j=f/2-15,me=g-10,ne=this.add.rectangle(0,j,me,6,0,.5).setVisible(!1),de=this.add.rectangle(-me/2,j,me,6,4521796).setOrigin(0,.5).setVisible(!1);c.add(ne),c.add(de),c.setData("cooldownBarBg",ne),c.setData("cooldownBarFill",de),c.setData("attackCooldownTimer",0),c.setData("maxAttackCooldown",0),c.setData("cooldownBarBaseWidth",me)}return c}getCardGameObjectByInstanceId(e){for(const[t,s]of this.playerVisuals){for(const[r,i]of s.hand)if(i.getData("instanceId")===e)return i;for(const[r,i]of s.battlefield)if(i.getData("instanceId")===e)return i}}getSlotPixelPosition(e,t,s){if(s<0||s>4)return;const r=this.calculateSlotX(s,t);let i;return t==="hand"?i=e?oa:ca:i=e?la:ua,{x:r,y:i}}makeCardInteractive(e){const t=e.getData("displayCardWidth"),s=e.getData("displayCardHeight");if(!t||!s){console.warn("BoardView: makeCardInteractive - displayCardWidth/Height not found on container.",e.getData("instanceId"));return}const r=new Phaser.Geom.Rectangle(-t/2,-s/2,t,s);e.setInteractive({hitArea:r,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}),this.input.setDraggable(e),e.input&&(e.input.enabled=!0),e.on("dragstart",i=>{this.currentPhase!==ke.Shop&&this.currentPhase!==ke.Preparation||!e.input||!e.input.enabled||(this.children.bringToTop(e),e.setAlpha(.7),e.setData("isDragging",!0),e.setData("originalX",e.x),e.setData("originalY",e.y),e.setData("originalAreaOnDragStart",e.getData("area")),e.setData("originalSlotKeyOnDragStart",e.getData("slotKey")))}),e.on("drag",(i,l,c)=>{if(e.getData("isDragging"))if(e.x=l,e.y=c,(this.currentPhase===ke.Shop||this.currentPhase===ke.Preparation)&&this.sellZone.visible)if(this.isDroppedOnSellZone(e)){const g=e.getData("instanceId"),f=e.getData("originalAreaOnDragStart"),h=e.getData("originalSlotKeyOnDragStart"),p=e.getData("ownerSessionId"),T=w==null?void 0:w.state.players.get(p);let C;if(T&&(f==="hand"?C=T.hand.get(h):C=T.battlefield.get(h)),C&&C.instanceId===g){const Z=Math.max(1,Math.floor(C.brewCost/2));this.brewGainText.setText(`Sell: +${Z} 🍺`),this.brewGainText.setAlpha(1)}else this.brewGainText.setAlpha(0)}else this.brewGainText.setAlpha(0);else this.brewGainText.setAlpha(0)}),e.on("dragend",i=>{if(!e.getData("isDragging"))return;e.setAlpha(1),e.setData("isDragging",!1),this.brewGainText.setAlpha(0);const l=e.getData("instanceId"),c=e.getData("originalAreaOnDragStart"),g=e.getData("originalSlotKeyOnDragStart"),f=e.getData("ownerSessionId");if((this.currentPhase===ke.Shop||this.currentPhase===ke.Preparation)&&this.sellZone.visible&&this.isDroppedOnSellZone(e)){const C=w==null?void 0:w.state.players.get(w==null?void 0:w.sessionId);let Z;if(c==="hand"&&(C!=null&&C.hand.has(g))?Z=C.hand.get(g):c==="battlefield"&&(C!=null&&C.battlefield.has(g))&&(Z=C.battlefield.get(g)),Z&&Z.instanceId===l){const V=Math.max(1,Math.floor(Z.brewCost/2));w==null||w.send("sellCard",{instanceId:l,area:c,slotKey:g}),this.showBrewGain(V);return}}let h=!1,p,T;for(let C=0;C<5;C++){const Z=String(C),V=this.getSlotPixelPosition(!0,"hand",C);if(V){const j=new Phaser.Geom.Rectangle(V.x-dn/2,V.y-hn/2,dn,hn);if(Phaser.Geom.Rectangle.Contains(j,e.x,e.y)){if(this.isSlotEmpty(f,"hand",Z,l)){let me=!1;if(this.currentPhase===ke.Shop?c==="hand"&&(me=!0):this.currentPhase===ke.Preparation&&c==="hand"&&(me=!0),me){e.x=V.x,e.y=V.y;const ne=c!=="hand";if(e.setData("area","hand"),e.setData("slotKey",Z),this.updateVisualMaps(f,c,g,"hand",Z,e),ne){const de=w==null?void 0:w.state.players.get(f),Ae=(de==null?void 0:de.hand.get(Z))||(c==="battlefield"?de==null?void 0:de.battlefield.get(g):void 0)||(c==="hand"?de==null?void 0:de.hand.get(g):void 0);Ae&&Ae.instanceId===l&&this.updateCardVisual(f,"hand",Z,Ae)}h=!0,p="hand",T=Z,this.currentPhase===ke.Shop&&(c!=="hand"||g!==Z)&&(w==null||w.send("moveCardInHand",{instanceId:l,fromSlotKey:g,toSlotKey:Z}))}}if(h)break}}}if(!h&&this.currentPhase===ke.Preparation)for(let C=0;C<5;C++){const Z=String(C),V=this.getSlotPixelPosition(!0,"battlefield",C);if(V){const j=new Phaser.Geom.Rectangle(V.x-dn/2,V.y-hn/2,dn,hn);if(Phaser.Geom.Rectangle.Contains(j,e.x,e.y)){if(this.isSlotEmpty(f,"battlefield",Z,l)){e.x=V.x,e.y=V.y;const me=c!=="battlefield";if(e.setData("area","battlefield"),e.setData("slotKey",Z),this.updateVisualMaps(f,c,g,"battlefield",Z,e),me){const ne=w==null?void 0:w.state.players.get(f),de=(ne==null?void 0:ne.battlefield.get(Z))||(ne==null?void 0:ne.hand.get(g));de&&de.instanceId===l&&this.updateCardVisual(f,"battlefield",Z,de)}h=!0,p="battlefield",T=Z}break}}}if(h?this.currentPhase===ke.Preparation&&p&&T&&(c!==p||g!==T)&&(w==null||w.send("updatePrepLayout",{instanceId:l,newArea:p,newSlotKey:T})):(e.x=e.getData("originalX"),e.y=e.getData("originalY"),e.setData("area",c),e.setData("slotKey",g)),this.currentPhase===ke.Preparation){const C=this.scene.get("Preparation");C&&C.scene.isActive()&&C.updateStartButtonState&&C.updateStartButtonState()}})}getCardLayouts(){const e={},t={};if(!w||!w.sessionId){for(let i=0;i<5;i++)e[String(i)]=null,t[String(i)]=null;return{handLayout:e,battlefieldLayout:t}}const s=w.sessionId,r=this.playerVisuals.get(s);for(let i=0;i<5;i++){const l=String(i);if(r&&r.hand.has(l)){const c=r.hand.get(l);e[l]=(c==null?void 0:c.getData("instanceId"))||null}else e[l]=null;if(r&&r.battlefield.has(l)){const c=r.battlefield.get(l);t[l]=(c==null?void 0:c.getData("instanceId"))||null}else t[l]=null}return{handLayout:e,battlefieldLayout:t}}isSlotEmpty(e,t,s,r){const i=this.playerVisuals.get(e);if(!i)return!1;const c=(t==="hand"?i.hand:i.battlefield).get(s);return c?c.getData("instanceId")===r:!0}isDroppedOnSellZone(e){return this.sellZone.visible?new Phaser.Geom.Rectangle(this.sellZone.x-this.sellZoneRect.width/2-20,this.sellZone.y-this.sellZoneRect.height/2-20,this.sellZoneRect.width+40,this.sellZoneRect.height+40).contains(e.x,e.y):!1}showBrewGain(e){this.brewGainText.setText(`+${e} 🍺`),this.brewGainText.setAlpha(1),this.brewGainText.y=-50,this.brewGainText.x=0,this.tweens.add({targets:this.brewGainText,scaleX:1.5,scaleY:1.5,duration:100,yoyo:!0,ease:"Cubic.easeOut",onComplete:()=>{this.tweens.add({targets:this.brewGainText,y:this.brewGainText.y-80,alpha:0,duration:1500,ease:"Power2"})}}),this.tweens.add({targets:this.sellZoneRect,fillAlpha:.7,duration:200,yoyo:!0,repeat:1,ease:"Cubic.easeOut"})}updateVisualMaps(e,t,s,r,i,l){const c=this.playerVisuals.get(e);if(!c)return;const g=t==="hand"?c.hand:c.battlefield;g.get(s)===l&&g.delete(s),(r==="hand"?c.hand:c.battlefield).set(i,l)}getPlayerCardGameObjects(e){const t=[],s=this.playerVisuals.get(e);return s&&(s.hand.forEach(r=>t.push(r)),s.battlefield.forEach(r=>t.push(r))),t}getLocalPlayerLayoutData(){const e=[];if(!w||!w.sessionId)return e;const t=w.sessionId,s=this.playerVisuals.get(t);return s&&(s.hand.forEach((r,i)=>{e.push({instanceId:r.getData("instanceId"),area:"hand",slotKey:r.getData("slotKey")})}),s.battlefield.forEach((r,i)=>{e.push({instanceId:r.getData("instanceId"),area:"battlefield",slotKey:r.getData("slotKey")})})),e}createSellZone(){this.sellZone=this.add.container(this.cameras.main.width-80,this.cameras.main.height/2),this.sellZone.setDepth(1e3),this.sellZoneRect=this.add.rectangle(0,0,120,160,16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1),this.sellZone.add(this.sellZoneRect),this.sellZoneText=this.add.text(0,0,"SELL",{fontFamily:"Arial Black",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.sellZone.add(this.sellZoneText),this.brewGainText=this.add.text(0,-50,"",{fontFamily:"Arial Black",fontSize:20,color:"#ffff00",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setAlpha(0),this.sellZone.add(this.brewGainText);const e=this.add.text(0,50,`Drag cards here
to sell`,{fontFamily:"Arial",fontSize:14,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5);this.sellZone.add(e),this.input.on("dragenter",(t,s,r)=>{s instanceof Phaser.GameObjects.Container&&this.sellZone.visible&&this.isDroppedOnSellZone(s)&&(this.sellZoneRect.setFillStyle(16711680,.5),this.sellZoneRect.setStrokeStyle(3,16733525,1))}),this.input.on("dragleave",(t,s,r)=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.input.on("drop",()=>{this.sellZoneRect.setFillStyle(16711680,.3),this.sellZoneRect.setStrokeStyle(2,16711680,1)}),this.sellZone.setVisible(!1)}updateNavbarText(){if(!w||!w.state||!this.playerHealthText||!this.playerHealthText.active)return;const e=w.sessionId,t=w.state.players.get(e);let s,r="Opponent: --";w.state.players.forEach((c,g)=>{g!==e&&(s=c,r=`Opponent: ${c.username||"Connecting..."}`)}),this.playerHealthText.setText(`You: ${(t==null?void 0:t.health)??"--"} HP`),this.playerBrewsText.setText(`Brews: ${(t==null?void 0:t.brews)??"--"}`),this.opponentUsernameText.setText(r),this.opponentHealthText.setText(`${(s==null?void 0:s.health)??"--"} HP`);const i=w.state.currentDay,l=w.state.currentPhase;this.dayPhaseText.setText(`Day ${i} - ${l}`)}cleanupListeners(){var e,t,s,r,i,l,c;console.log("BoardView: Cleaning up listeners."),this.listeners.forEach(g=>{if(typeof g=="function")try{g()}catch(f){console.warn("BoardView: Error cleaning up listener:",f)}}),this.listeners=[],this.cardSchemaListeners.forEach((g,f)=>{console.log(`BoardView cleanup: Cleaning up ${g.length} listeners for card instance ${f}`),g.forEach(h=>{if(typeof h=="function")try{h()}catch(p){console.warn(`BoardView: Error unsubscribing card listener for ${f}`,p)}})}),this.cardSchemaListeners.clear(),this.playerVisuals.forEach(g=>{g.hand.forEach(f=>f.destroy()),g.battlefield.forEach(f=>f.destroy())}),this.playerVisuals.clear(),(e=this.playerHealthText)==null||e.destroy(),(t=this.opponentHealthText)==null||t.destroy(),(s=this.playerBrewsText)==null||s.destroy(),(r=this.dayPhaseText)==null||r.destroy(),(i=this.opponentUsernameText)==null||i.destroy(),(l=this.sellZone)==null||l.destroy(),(c=this.brewGainText)==null||c.destroy(),this.input.off("dragenter"),this.input.off("dragleave"),this.input.off("drop")}shutdown(){console.log("BoardView shutting down..."),this.cleanupListeners(),this.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}}(async()=>(await ip(),new fa({type:Phaser.AUTO,parent:"gameParent",width:1280,height:720,backgroundColor:"#000000",roundPixels:!1,pixelArt:!1,scene:[lp,fp,up,hp,pp,gp,mp,yp,cp,dp]})))();
